<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>请求处理 | Xiayf的技术笔记</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.3.0">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../../../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../../../gitbook/style.css">
    
    

        
    
    
    <link rel="next" href="../../../language/go/reading-net-http.html" />
    
    
    <link rel="prev" href="../../../language/go/beego/run.html" />
    

        
    </head>
    <body>
        
        
    <div class="book" data-level="3.3.3.3" data-basepath="../../.." data-revision="Mon Mar 27 2017 18:14:47 GMT+0800 (CST)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
        

        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../../../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="arch/index.html">
            
                
                    <a href="../../../arch/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        架构
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="arch/tumblr-arch.html">
            
                
                    <a href="../../../arch/tumblr-arch.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Tumblr架构设计
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="arch/latency-output-cost.html">
            
                
                    <a href="../../../arch/latency-output-cost.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        &lt;延迟、吞吐、成本那些事&gt;课程笔记
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="arch/reference.html">
            
                
                    <a href="../../../arch/reference.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                        资料
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="basic/index.html">
            
                
                    <a href="../../../basic/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        基础
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="basic/system.html">
            
                
                    <a href="../../../basic/system.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        系统编程
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="basic/system/tlpi.html">
            
                
                    <a href="../../../basic/system/tlpi.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.1.</b>
                        
                        读书笔记：Linux/UNIX系统编程手册
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="basic/algorithm.html">
            
                
                    <a href="../../../basic/algorithm.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        算法
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" data-path="basic/algorithm/introduction-to-algorithm.html">
            
                
                    <a href="../../../basic/algorithm/introduction-to-algorithm.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.1.</b>
                        
                        读书笔记：算法导论
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="basic/network.html">
            
                
                    <a href="../../../basic/network.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        网络
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="basic/compiler.html">
            
            <span><b>2.4.</b> 编译</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.4.1" data-path="basic/compiler/flex-bison.html">
            
                
                    <a href="../../../basic/compiler/flex-bison.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.4.1.</b>
                        
                        读书笔记：flex与bison
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="basic/storage.html">
            
            <span><b>2.5.</b> 存储</span>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="language/index.html">
            
                
                    <a href="../../../language/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        编程语言
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="language/python.html">
            
                
                    <a href="../../../language/python.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        Python
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="language/python/flask.html">
            
                
                    <a href="../../../language/python/flask.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.1.</b>
                        
                        Flask
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="language/python/tornado.html">
            
                
                    <a href="../../../language/python/tornado.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.2.</b>
                        
                        Tornado
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="language/python/django.html">
            
                
                    <a href="../../../language/python/django.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.3.</b>
                        
                        Django
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="language/php.html">
            
                
                    <a href="../../../language/php.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        PHP
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1" data-path="language/php/yii.html">
            
            <span><b>3.2.1.</b> Yii</span>
            
            
        </li>
    
        <li class="chapter " data-level="3.2.2" data-path="language/php/symfony.html">
            
            <span><b>3.2.2.</b> Symfony</span>
            
            
        </li>
    
        <li class="chapter " data-level="3.2.3" data-path="language/php/internal.html">
            
                
                    <a href="../../../language/php/internal.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.3.</b>
                        
                        读书笔记：深入理解PHP内核
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="language/go.html">
            
                
                    <a href="../../../language/go.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        Go
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.3.1" data-path="language/go/effective-go.html">
            
                
                    <a href="../../../language/go/effective-go.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.1.</b>
                        
                        Effective Go
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3.2" data-path="language/go/learning-go.html">
            
                
                    <a href="../../../language/go/learning-go.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.2.</b>
                        
                        读书笔记：Go学习笔记
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3.3" data-path="language/go/reading-beego.html">
            
                
                    <a href="../../../language/go/reading-beego.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.3.</b>
                        
                        Beego源码阅读
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.3.3.1" data-path="language/go/beego/summary.html">
            
                
                    <a href="../../../language/go/beego/summary.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.3.1.</b>
                        
                        概述
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3.3.2" data-path="language/go/beego/run.html">
            
                
                    <a href="../../../language/go/beego/run.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.3.2.</b>
                        
                        启动流程
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="3.3.3.3" data-path="language/go/beego/handle-request.html">
            
                
                    <a href="../../../language/go/beego/handle-request.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.3.3.</b>
                        
                        请求处理
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.3.4" data-path="language/go/reading-net-http.html">
            
                
                    <a href="../../../language/go/reading-net-http.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.4.</b>
                        
                        net/http 阅读笔记
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="language/js.html">
            
                
                    <a href="../../../language/js.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                        JavaScript
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.4.1" data-path="language/js/frontend-dv.html">
            
                
                    <a href="../../../language/js/frontend-dv.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.1.</b>
                        
                        前端数据可视化
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.4.2" data-path="language/js/modular.html">
            
                
                    <a href="../../../language/js/modular.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.2.</b>
                        
                        前端模块化
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.4.3" data-path="language/js/tools.html">
            
                
                    <a href="../../../language/js/tools.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.3.</b>
                        
                        前端工具
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.4.4" data-path="language/js/hybrid-mobile.html">
            
                
                    <a href="../../../language/js/hybrid-mobile.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.4.</b>
                        
                        混合移动开发
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.4.5" data-path="language/js/node.html">
            
                
                    <a href="../../../language/js/node.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.5.</b>
                        
                        NodeJS
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.4.5.1" data-path="language/js/node/reading-node.html">
            
                
                    <a href="../../../language/js/node/reading-node.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.5.1.</b>
                        
                        NodeJS源码阅读笔记
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="language/css.html">
            
                
                    <a href="../../../language/css.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.</b>
                        
                        CSS
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="language/c.html">
            
                
                    <a href="../../../language/c.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.6.</b>
                        
                        C
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.6.1" data-path="language/c/learning-c.html">
            
                
                    <a href="../../../language/c/learning-c.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.6.1.</b>
                        
                        读书笔记：C学习笔记
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="language/lua.html">
            
                
                    <a href="../../../language/lua.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.7.</b>
                        
                        Lua
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.8" data-path="language/java.html">
            
                
                    <a href="../../../language/java.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.8.</b>
                        
                        Java/Scala
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.8.1" data-path="language/java/learning-java.html">
            
                
                    <a href="../../../language/java/learning-java.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.8.1.</b>
                        
                        读书笔记：Java核心技术（卷1）
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.8.2" data-path="language/java/spring.html">
            
                
                    <a href="../../../language/java/spring.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.8.2.</b>
                        
                        Spring
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.8.3" data-path="language/java/spark.html">
            
                
                    <a href="../../../language/java/spark.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.8.3.</b>
                        
                        Spark
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.9" data-path="language/others.html">
            
                
                    <a href="../../../language/others.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.9.</b>
                        
                        others
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="operation/index.html">
            
                
                    <a href="../../../operation/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        运维
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="operation/os.html">
            
                
                    <a href="../../../operation/os.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        操作系统
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="operation/sql.html">
            
                
                    <a href="../../../operation/sql.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        SQL
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.1" data-path="operation/sql/mysql.html">
            
                
                    <a href="../../../operation/sql/mysql.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.1.</b>
                        
                        MySQL
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2.2" data-path="operation/sql/high-performance-mysql.html">
            
                
                    <a href="../../../operation/sql/high-performance-mysql.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.2.</b>
                        
                        读书笔记：高性能MySQL
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2.3" data-path="operation/sql/sqlite.html">
            
                
                    <a href="../../../operation/sql/sqlite.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.3.</b>
                        
                        SQLite
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="operation/nosql.html">
            
                
                    <a href="../../../operation/nosql.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.3.</b>
                        
                        NoSQL
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.3.1" data-path="operation/nosql/redis-design-implementation.html">
            
                
                    <a href="../../../operation/nosql/redis-design-implementation.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.3.1.</b>
                        
                        读书笔记：Redis设计与实现
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="operation/mq.html">
            
                
                    <a href="../../../operation/mq.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.4.</b>
                        
                        MQ
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="operation/nginx.html">
            
                
                    <a href="../../../operation/nginx.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.5.</b>
                        
                        Nginx
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.5.1" data-path="operation/nginx/openresty.html">
            
                
                    <a href="../../../operation/nginx/openresty.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.5.1.</b>
                        
                        OpenResty
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="operation/haproxy.html">
            
                
                    <a href="../../../operation/haproxy.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.6.</b>
                        
                        HAProxy
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.6.1" data-path="operation/haproxy/conf-manual.html">
            
                
                    <a href="../../../operation/haproxy/conf-manual.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.6.1.</b>
                        
                        HAProxy文档精简翻译版
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.7" data-path="operation/others.html">
            
                
                    <a href="../../../operation/others.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.</b>
                        
                        其他
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" data-path="others/index.html">
            
                
                    <a href="../../../others/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        其他
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="others/refactoring.html">
            
                
                    <a href="../../../others/refactoring.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        读书笔记：重构
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="others/sicp.html">
            
                
                    <a href="../../../others/sicp.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        读书笔记：计算机程序的构造与解释
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="others/quotes.html">
            
                
                    <a href="../../../others/quotes.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.3.</b>
                        
                        启示语录
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="others/web.html">
            
                
                    <a href="../../../others/web.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.4.</b>
                        
                        Web开发
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="others/ds.html">
            
                
                    <a href="../../../others/ds.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.5.</b>
                        
                        分布式系统
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.6" data-path="others/security.html">
            
                
                    <a href="../../../others/security.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.6.</b>
                        
                        信息安全
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.7" data-path="others/stackoverflow-collection.html">
            
                
                    <a href="../../../others/stackoverflow-collection.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.7.</b>
                        
                        StackOverflow问答精选
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.8" data-path="others/other.html">
            
                
                    <a href="../../../others/other.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.8.</b>
                        
                        碎碎念
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.8.1" data-path="others/other/inspired.html">
            
                
                    <a href="../../../others/other/inspired.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.8.1.</b>
                        
                        启示录
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.8.2" data-path="others/other/taobao-ten-years.html">
            
                
                    <a href="../../../others/other/taobao-ten-years.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.8.2.</b>
                        
                        读书笔记：淘宝技术这十年
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                Published with GitBook
            </a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    
    


    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../../" >Xiayf的技术笔记</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86%E4%B8%BB%E6%B5%81%E7%A8%8B">&#x8BF7;&#x6C42;&#x5904;&#x7406;&#x4E3B;&#x6D41;&#x7A0B;</h1>
<p>&#x63A5;&#x7740; <em>&#x542F;&#x52A8;&#x6D41;&#x7A0B;</em>&#xFF0C;&#x6765;&#x770B;&#x770B;&#x8BF7;&#x6C42;&#x5904;&#x7406;&#x6D41;&#x7A0B;&#x3002;</p>
<p><code>app.Handlers</code>&#x7684;&#x7C7B;&#x578B;&#x4E3A;&#xFF1A;<code>*ControllerRegistor</code>&#xFF0C;&#x5176;<code>ServeHTTP</code>&#x65B9;&#x6CD5;&#xFF0C;&#x4E5F;&#x5373;&#x8BF7;&#x6C42;&#x5904;&#x7406;&#x7684;&#x5165;&#x53E3;&#xFF0C;&#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-go"><span class="hljs-comment">// Implement http.Handler interface.</span>
<span class="hljs-keyword">func</span> (p *ControllerRegister) ServeHTTP(rw http.ResponseWriter, r *http.Request) {
    <span class="hljs-comment">// &#x8BF7;&#x6C42;&#x5904;&#x7406;&#x5F00;&#x59CB;&#x65F6;&#x95F4;</span>
    startTime := time.Now()
    <span class="hljs-keyword">var</span> (
        runRouter  reflect.Type
        findRouter <span class="hljs-typename">bool</span>
        runMethod  <span class="hljs-typename">string</span>
        routerInfo *controllerInfo
    )
    context := p.pool.Get().(*beecontext.Context)
    context.Reset(rw, r)
    <span class="hljs-keyword">defer</span> p.pool.Put(context)
    <span class="hljs-comment">// &#x5904;&#x7406;&#x51FA;&#x9519;&#x65F6;&#xFF0C;&#x4EA4;&#x7ED9;recoverPanic&#x6765;&#x505A;&#x9519;&#x8BEF;&#x5904;&#x7406;&#xFF0C;&#x5E76;&#x54CD;&#x5E94;</span>
   <span class="hljs-comment">// &#x8FD8;&#x8BB0;&#x5F97; **&#x542F;&#x52A8;&#x6D41;&#x7A0B;** &#x4E2D;&#x7684; registerDefaultErrorHandler() &#x5417;&#xFF1F;</span>
    <span class="hljs-keyword">defer</span> p.recoverPanic(context)

    context.Output.EnableGzip = BConfig.EnableGzip

    <span class="hljs-keyword">if</span> BConfig.RunMode == DEV {
        context.Output.Header(<span class="hljs-string">&quot;Server&quot;</span>, BConfig.ServerName)
    }

    <span class="hljs-keyword">var</span> urlPath <span class="hljs-typename">string</span>
    <span class="hljs-keyword">if</span> !BConfig.RouterCaseSensitive {
        urlPath = strings.ToLower(r.URL.Path)
    } <span class="hljs-keyword">else</span> {
        urlPath = r.URL.Path
    }

    <span class="hljs-comment">// filter wrong http method</span>
    <span class="hljs-keyword">if</span> _, ok := HTTPMETHOD[r.Method]; !ok {
        http.Error(rw, <span class="hljs-string">&quot;Method Not Allowed&quot;</span>, <span class="hljs-number">405</span>)
        <span class="hljs-keyword">goto</span> Admin
    }

    <span class="hljs-comment">// filter for static file</span>
    <span class="hljs-keyword">if</span> p.execFilter(context, BeforeStatic, urlPath) {
        <span class="hljs-keyword">goto</span> Admin
    }

    <span class="hljs-comment">// &#x5C1D;&#x8BD5;&#x5904;&#x7406;&#x9759;&#x6001;&#x6587;&#x4EF6;&#x8BF7;&#x6C42;</span>
    serverStaticRouter(context)
    <span class="hljs-comment">// &#x5F53;&#x524D;&#x8BF7;&#x6C42;&#x7684;&#x53EF;&#x80FD;&#x786E;&#x5B9E;&#x662F;&#x4E2A;&#x9759;&#x6001;&#x6587;&#x4EF6;&#xFF0C;&#x6240;&#x4EE5;&#x5728;serverStaticRouter&#x4E2D;&#x5DF2;&#x7ECF;&#x505A;&#x51FA;&#x4E86;&#x54CD;&#x5E94;</span>
    <span class="hljs-keyword">if</span> context.ResponseWriter.Started {
       <span class="hljs-comment">// &#x90A3;&#x4E48;&#x4EE5;&#x4E0B;&#x4E5F;&#x5C31;&#x4E0D;&#x7528;&#x518D;&#x63A5;&#x7740;&#x53BB;&#x67E5;&#x627E;&#x975E;&#x9759;&#x6001;&#x6587;&#x4EF6;&#x7684;&#x8DEF;&#x7531;&#x4E86;</span>
        findRouter = <span class="hljs-constant">true</span>
        <span class="hljs-keyword">goto</span> Admin
    }

    <span class="hljs-comment">// session init</span>
    <span class="hljs-keyword">if</span> BConfig.WebConfig.Session.SessionOn {
        <span class="hljs-keyword">var</span> err error
        context.Input.CruSession, err = GlobalSessions.SessionStart(rw, r)
        <span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> {
            Error(err)
            exception(<span class="hljs-string">&quot;503&quot;</span>, context)
            <span class="hljs-keyword">return</span>
        }
        <span class="hljs-comment">// &#x5F97;&#x8BB0;&#x5F97;&#x91CA;&#x653E;&#x5440;</span>
        <span class="hljs-keyword">defer</span> <span class="hljs-keyword">func</span>() {
            context.Input.CruSession.SessionRelease(rw)
        }()
    }

    <span class="hljs-comment">// &#x89E3;&#x6790;&#x8BF7;&#x6C42;&#x4F53;</span>
    <span class="hljs-keyword">if</span> r.Method != <span class="hljs-string">&quot;GET&quot;</span> &amp;&amp; r.Method != <span class="hljs-string">&quot;HEAD&quot;</span> {
        <span class="hljs-keyword">if</span> BConfig.CopyRequestBody &amp;&amp; !context.Input.IsUpload() {
            context.Input.CopyBody(BConfig.MaxMemory)
        }
        context.Input.ParseFormOrMulitForm(BConfig.MaxMemory)
    }

    <span class="hljs-keyword">if</span> p.execFilter(context, BeforeRouter, urlPath) {
        <span class="hljs-keyword">goto</span> Admin
    }

    <span class="hljs-keyword">if</span> !findRouter {
        httpMethod := r.Method
        <span class="hljs-keyword">if</span> t, ok := p.routers[httpMethod]; ok {
            <span class="hljs-comment">// &#x5982;&#x4F55;&#x5339;&#x914D;&#x7684;&#xFF1F;</span>
            runObject := t.Match(urlPath, context)
            <span class="hljs-comment">// &#x8FD9;&#x91CC;&#x8C8C;&#x4F3C;&#x5F88;&#x725B;&#x903C;&#x7684;&#x6837;&#x5B50;</span>
            <span class="hljs-keyword">if</span> r, ok := runObject.(*controllerInfo); ok {
                routerInfo = r
                findRouter = <span class="hljs-constant">true</span>
                <span class="hljs-keyword">if</span> splat := context.Input.Param(<span class="hljs-string">&quot;:splat&quot;</span>); splat != <span class="hljs-string">&quot;&quot;</span> {
                    <span class="hljs-keyword">for</span> k, v := <span class="hljs-keyword">range</span> strings.Split(splat, <span class="hljs-string">&quot;/&quot;</span>) {
                        context.Input.SetParam(strconv.Itoa(k), v)
                    }
                }
            }
        }

    }

    <span class="hljs-comment">//if no matches to url, throw a not found exception</span>
    <span class="hljs-keyword">if</span> !findRouter {
        exception(<span class="hljs-string">&quot;404&quot;</span>, context)
        <span class="hljs-keyword">goto</span> Admin
    }

    <span class="hljs-keyword">if</span> findRouter {
        <span class="hljs-comment">//execute middleware filters</span>
        <span class="hljs-keyword">if</span> p.execFilter(context, BeforeExec, urlPath) {
            <span class="hljs-keyword">goto</span> Admin
        }
        isRunnable := <span class="hljs-constant">false</span>
        <span class="hljs-keyword">if</span> routerInfo != <span class="hljs-constant">nil</span> {
            <span class="hljs-keyword">if</span> routerInfo.routerType == routerTypeRESTFul {
                <span class="hljs-keyword">if</span> _, ok := routerInfo.methods[r.Method]; ok {
                    isRunnable = <span class="hljs-constant">true</span>
                    routerInfo.runFunction(context)
                } <span class="hljs-keyword">else</span> {
                    exception(<span class="hljs-string">&quot;405&quot;</span>, context)
                    <span class="hljs-keyword">goto</span> Admin
                }
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> routerInfo.routerType == routerTypeHandler {
                isRunnable = <span class="hljs-constant">true</span>
                routerInfo.handler.ServeHTTP(rw, r)
            } <span class="hljs-keyword">else</span> {
                runRouter = routerInfo.controllerType
                method := r.Method
                <span class="hljs-keyword">if</span> r.Method == <span class="hljs-string">&quot;POST&quot;</span> &amp;&amp; context.Input.Query(<span class="hljs-string">&quot;_method&quot;</span>) == <span class="hljs-string">&quot;PUT&quot;</span> {
                    method = <span class="hljs-string">&quot;PUT&quot;</span>
                }
                <span class="hljs-keyword">if</span> r.Method == <span class="hljs-string">&quot;POST&quot;</span> &amp;&amp; context.Input.Query(<span class="hljs-string">&quot;_method&quot;</span>) == <span class="hljs-string">&quot;DELETE&quot;</span> {
                    method = <span class="hljs-string">&quot;DELETE&quot;</span>
                }
                <span class="hljs-keyword">if</span> m, ok := routerInfo.methods[method]; ok {
                    runMethod = m
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> m, ok = routerInfo.methods[<span class="hljs-string">&quot;*&quot;</span>]; ok {
                    runMethod = m
                } <span class="hljs-keyword">else</span> {
                    runMethod = method
                }
            }
        }

        <span class="hljs-comment">// also defined runRouter &amp; runMethod from filter</span>
        <span class="hljs-keyword">if</span> !isRunnable {
            <span class="hljs-comment">//Invoke the request handler</span>
            vc := reflect.New(runRouter)
            execController, ok := vc.Interface().(ControllerInterface)
            <span class="hljs-keyword">if</span> !ok {
                <span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;controller is not ControllerInterface&quot;</span>)
            }

            <span class="hljs-comment">//call the controller init function</span>
            execController.Init(context, runRouter.Name(), runMethod, vc.Interface())

            <span class="hljs-comment">//call prepare function</span>
            execController.Prepare()

            <span class="hljs-comment">//if XSRF is Enable then check cookie where there has any cookie in the  request&apos;s cookie _csrf</span>
            <span class="hljs-keyword">if</span> BConfig.WebConfig.EnableXSRF {
                execController.XSRFToken()
                <span class="hljs-keyword">if</span> r.Method == <span class="hljs-string">&quot;POST&quot;</span> || r.Method == <span class="hljs-string">&quot;DELETE&quot;</span> || r.Method == <span class="hljs-string">&quot;PUT&quot;</span> ||
                    (r.Method == <span class="hljs-string">&quot;POST&quot;</span> &amp;&amp; (context.Input.Query(<span class="hljs-string">&quot;_method&quot;</span>) == <span class="hljs-string">&quot;DELETE&quot;</span> || context.Input.Query(<span class="hljs-string">&quot;_method&quot;</span>) == <span class="hljs-string">&quot;PUT&quot;</span>)) {
                    execController.CheckXSRFCookie()
                }
            }

            execController.URLMapping()

            <span class="hljs-keyword">if</span> !context.ResponseWriter.Started {
                <span class="hljs-comment">//exec main logic</span>
                <span class="hljs-keyword">switch</span> runMethod {
                <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;GET&quot;</span>:
                    execController.Get()
                <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;POST&quot;</span>:
                    execController.Post()
                <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;DELETE&quot;</span>:
                    execController.Delete()
                <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;PUT&quot;</span>:
                    execController.Put()
                <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;HEAD&quot;</span>:
                    execController.Head()
                <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;PATCH&quot;</span>:
                    execController.Patch()
                <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;OPTIONS&quot;</span>:
                    execController.Options()
                <span class="hljs-keyword">default</span>:
                    <span class="hljs-keyword">if</span> !execController.HandlerFunc(runMethod) {
                        <span class="hljs-keyword">var</span> in []reflect.Value
                        method := vc.MethodByName(runMethod)
                        method.Call(in)
                    }
                }

                <span class="hljs-comment">//render template</span>
                <span class="hljs-keyword">if</span> !context.ResponseWriter.Started &amp;&amp; context.Output.Status == <span class="hljs-number">0</span> {
                    <span class="hljs-keyword">if</span> BConfig.WebConfig.AutoRender {
                        <span class="hljs-keyword">if</span> err := execController.Render(); err != <span class="hljs-constant">nil</span> {
                            <span class="hljs-built_in">panic</span>(err)
                        }
                    }
                }
            }

            <span class="hljs-comment">// finish all runRouter. release resource</span>
            execController.Finish()
        }

        <span class="hljs-comment">//execute middleware filters</span>
        <span class="hljs-keyword">if</span> p.execFilter(context, AfterExec, urlPath) {
            <span class="hljs-keyword">goto</span> Admin
        }
    }

    p.execFilter(context, FinishRouter, urlPath)

Admin:
    timeDur := time.Since(startTime)
    <span class="hljs-comment">//admin module record QPS</span>
    <span class="hljs-keyword">if</span> BConfig.Listen.EnableAdmin {
        <span class="hljs-keyword">if</span> FilterMonitorFunc(r.Method, r.URL.Path, timeDur) {
            <span class="hljs-keyword">if</span> runRouter != <span class="hljs-constant">nil</span> {
                <span class="hljs-keyword">go</span> toolbox.StatisticsMap.AddStatistics(r.Method, r.URL.Path, runRouter.Name(), timeDur)
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">go</span> toolbox.StatisticsMap.AddStatistics(r.Method, r.URL.Path, <span class="hljs-string">&quot;&quot;</span>, timeDur)
            }
        }
    }

    <span class="hljs-keyword">if</span> BConfig.RunMode == DEV || BConfig.Log.AccessLogs {
        <span class="hljs-keyword">var</span> devInfo <span class="hljs-typename">string</span>
        <span class="hljs-keyword">if</span> findRouter {
            <span class="hljs-keyword">if</span> routerInfo != <span class="hljs-constant">nil</span> {
                devInfo = fmt.Sprintf(<span class="hljs-string">&quot;| % -10s | % -40s | % -16s | % -10s | % -40s |&quot;</span>, r.Method, r.URL.Path, timeDur.String(), <span class="hljs-string">&quot;match&quot;</span>, routerInfo.pattern)
            } <span class="hljs-keyword">else</span> {
                devInfo = fmt.Sprintf(<span class="hljs-string">&quot;| % -10s | % -40s | % -16s | % -10s |&quot;</span>, r.Method, r.URL.Path, timeDur.String(), <span class="hljs-string">&quot;match&quot;</span>)
            }
        } <span class="hljs-keyword">else</span> {
            devInfo = fmt.Sprintf(<span class="hljs-string">&quot;| % -10s | % -40s | % -16s | % -10s |&quot;</span>, r.Method, r.URL.Path, timeDur.String(), <span class="hljs-string">&quot;notmatch&quot;</span>)
        }
        <span class="hljs-keyword">if</span> DefaultAccessLogFilter == <span class="hljs-constant">nil</span> || !DefaultAccessLogFilter.Filter(context) {
            Debug(devInfo)
        }
    }

    <span class="hljs-comment">// Call WriteHeader if status code has been set changed</span>
    <span class="hljs-keyword">if</span> context.Output.Status != <span class="hljs-number">0</span> {
        context.ResponseWriter.WriteHeader(context.Output.Status)
    }
}
</code></pre>
<hr>
<p>&#x4E0A;&#x8FF0;&#x4EE3;&#x7801;&#x4E2D;&#x4F7F;&#x7528;&#x4E86; <code>responseWriter</code>&#xFF0C;&#x5176;&#x5B9A;&#x4E49;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-go"><span class="hljs-comment">//responseWriter is a wrapper for the http.ResponseWriter</span>
<span class="hljs-comment">//started set to true if response was written to then don&apos;t execute other handler</span>
<span class="hljs-keyword">type</span> responseWriter <span class="hljs-keyword">struct</span> {
    writer  http.ResponseWriter
    started <span class="hljs-typename">bool</span>
    status  <span class="hljs-typename">int</span>
}
</code></pre>
<hr>
<p>&#x9759;&#x6001;&#x6587;&#x4EF6;&#x8BF7;&#x6C42;&#x5904;&#x7406;&#x51FD;&#x6570; <code>serverStaticRouter</code> &#x5B9A;&#x4E49;&#x5728;&#x6587;&#x4EF6; <code>staticfile.go</code>&#x4E2D;&#xFF0C;&#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> serverStaticRouter(ctx *context.Context) {
    <span class="hljs-comment">// &#x975E;GET&#x3001;HEAD&#x8BF7;&#x6C42;&#x4E0D;&#x8BA4;&#x4E3A;&#x662F;&#x9759;&#x6001;&#x6587;&#x4EF6;&#x8BF7;&#x6C42;</span>
    <span class="hljs-keyword">if</span> ctx.Input.Method() != <span class="hljs-string">&quot;GET&quot;</span> &amp;&amp; ctx.Input.Method() != <span class="hljs-string">&quot;HEAD&quot;</span> {
        <span class="hljs-keyword">return</span>
    }

    forbidden, filePath, fileInfo, err := lookupFile(ctx)
    <span class="hljs-keyword">if</span> err == errNotStaticRequest {
        <span class="hljs-keyword">return</span>
    }

    <span class="hljs-keyword">if</span> forbidden {
        exception(<span class="hljs-string">&quot;403&quot;</span>, ctx)
        <span class="hljs-keyword">return</span>
    }

    <span class="hljs-keyword">if</span> filePath == <span class="hljs-string">&quot;&quot;</span> || fileInfo == <span class="hljs-constant">nil</span> {
        <span class="hljs-keyword">if</span> BConfig.RunMode == DEV {
            Warn(<span class="hljs-string">&quot;Can&apos;t find/open the file:&quot;</span>, filePath, err)
        }
        http.NotFound(ctx.ResponseWriter, ctx.Request)
        <span class="hljs-keyword">return</span>
    }
    <span class="hljs-keyword">if</span> fileInfo.IsDir() {
        <span class="hljs-comment">//serveFile will list dir</span>
        http.ServeFile(ctx.ResponseWriter, ctx.Request, filePath)
        <span class="hljs-keyword">return</span>
    }

    <span class="hljs-keyword">var</span> enableCompress = BConfig.EnableGzip &amp;&amp; isStaticCompress(filePath)
    <span class="hljs-keyword">var</span> acceptEncoding <span class="hljs-typename">string</span>
    <span class="hljs-keyword">if</span> enableCompress {
        acceptEncoding = context.ParseEncoding(ctx.Request)
    }
    b, n, sch, err := openFile(filePath, fileInfo, acceptEncoding)
    <span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> {
        <span class="hljs-keyword">if</span> BConfig.RunMode == DEV {
            Warn(<span class="hljs-string">&quot;Can&apos;t compress the file:&quot;</span>, filePath, err)
        }
        http.NotFound(ctx.ResponseWriter, ctx.Request)
        <span class="hljs-keyword">return</span>
    }

    <span class="hljs-keyword">if</span> b {
        ctx.Output.Header(<span class="hljs-string">&quot;Content-Encoding&quot;</span>, n)
    } <span class="hljs-keyword">else</span> {
        ctx.Output.Header(<span class="hljs-string">&quot;Content-Length&quot;</span>, strconv.FormatInt(sch.size, <span class="hljs-number">10</span>))
    }

    http.ServeContent(ctx.ResponseWriter, ctx.Request, filePath, sch.modTime, sch)
    <span class="hljs-keyword">return</span>
}
</code></pre>
<hr>
<p>&#x5F00;&#x542F;session&#x7684; <code>context.Input.CruSession, err = GlobalSessions.SessionStart(w, r)</code> &#x4E00;&#x884C;&#x4E2D;&#x7684; <code>GlobalSessions</code> &#x60F3;&#x5FC5;&#x8FD8;&#x8BB0;&#x5F97;&#x5427;&#xFF1F;&#x5728;<strong>&#x542F;&#x52A8;&#x6D41;&#x7A0B;</strong>&#x4E2D;&#x6709; <code>GlobalSessions, err = session.NewManager(SessionProvider, sessionConfig)</code> &#x4E00;&#x884C;&#x3002; <code>GlobalSessions.SessionStart</code> &#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<pre><code class="lang-go"><span class="hljs-comment">// Start session. generate or read the session id from http request.</span>
<span class="hljs-comment">// if session id exists, return SessionStore with this id.</span>
<span class="hljs-keyword">func</span> (manager *Manager) SessionStart(w http.ResponseWriter, r *http.Request) (session SessionStore, err error) {
   <span class="hljs-comment">// &#x770B;&#x770B;&#x8BF7;&#x6C42;&#x5934;&#x4E2D;&#x662F;&#x5426;&#x6709;session id&#x7684;cookie</span>
    cookie, errs := r.Cookie(manager.config.CookieName)
    <span class="hljs-keyword">if</span> errs != <span class="hljs-constant">nil</span> || cookie.Value == <span class="hljs-string">&quot;&quot;</span> {
       <span class="hljs-comment">// &#x6CA1;&#x6709;&#x5219;&#x65B0;&#x751F;&#x6210;&#x4E00;&#x4E2A;</span>
        sid, errs := manager.sessionId(r)
        <span class="hljs-keyword">if</span> errs != <span class="hljs-constant">nil</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-constant">nil</span>, errs
        }
        session, err = manager.provider.SessionRead(sid)
        cookie = &amp;http.Cookie{
            Name:     manager.config.CookieName,
            Value:    url.QueryEscape(sid),
            Path:     <span class="hljs-string">&quot;/&quot;</span>,
            HttpOnly: <span class="hljs-constant">true</span>,
            Secure:   manager.isSecure(r),
            Domain:   manager.config.Domain,
        }
        <span class="hljs-keyword">if</span> manager.config.CookieLifeTime &gt; <span class="hljs-number">0</span> {
            cookie.MaxAge = manager.config.CookieLifeTime
            cookie.Expires = time.Now().Add(time.Duration(manager.config.CookieLifeTime) * time.Second)
        }
        <span class="hljs-keyword">if</span> manager.config.EnableSetCookie {
            http.SetCookie(w, cookie)
        }
        r.AddCookie(cookie)
    } <span class="hljs-keyword">else</span> {
       <span class="hljs-comment">// &#x6709;&#xFF0C;&#x5219;&#x53D6;&#x51FA;&#x76EE;&#x6807;session id&#xFF0C;&#x63A5;&#x7740;&#x8BFB;&#x53D6;session&#x6570;&#x636E;</span>
        sid, errs := url.QueryUnescape(cookie.Value)
        <span class="hljs-keyword">if</span> errs != <span class="hljs-constant">nil</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-constant">nil</span>, errs
        }
        <span class="hljs-comment">// &#x4F46;&#x53EF;&#x80FD;&#x76EE;&#x6807;session&#x5DF2;&#x7ECF;&#x8FC7;&#x671F;&#xFF0C;&#x4E0D;&#x5B58;&#x5728;&#x4E86;&#xFF0C;&#x5219;&#x4E5F;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x65B0;&#x7684;</span>
        <span class="hljs-keyword">if</span> manager.provider.SessionExist(sid) {
            session, err = manager.provider.SessionRead(sid)
        } <span class="hljs-keyword">else</span> {
           <span class="hljs-comment">// &#x8FD9;&#x4EE3;&#x7801;&#x62F7;&#x8D1D;&#x5F97;&#x8BA9;&#x6211;&#x6709;&#x4E9B;&#x4E0D;&#x723D;&#x5440;</span>
            sid, err = manager.sessionId(r)
            <span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-constant">nil</span>, err
            }
            session, err = manager.provider.SessionRead(sid)
            cookie = &amp;http.Cookie{
                Name:     manager.config.CookieName,
                Value:    url.QueryEscape(sid),
                Path:     <span class="hljs-string">&quot;/&quot;</span>,
                HttpOnly: <span class="hljs-constant">true</span>,
                Secure:   manager.isSecure(r),
                Domain:   manager.config.Domain,
            }
            <span class="hljs-keyword">if</span> manager.config.CookieLifeTime &gt; <span class="hljs-number">0</span> {
                cookie.MaxAge = manager.config.CookieLifeTime
                cookie.Expires = time.Now().Add(time.Duration(manager.config.CookieLifeTime) * time.Second)
            }
            <span class="hljs-comment">// &#x8FD9;&#x662F;&#x5565;&#x610F;&#x601D;&#xFF1F;</span>
            <span class="hljs-keyword">if</span> manager.config.EnableSetCookie {
                http.SetCookie(w, cookie)
            }
            r.AddCookie(cookie)
        }
    }
    <span class="hljs-keyword">return</span>
}
</code></pre>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../../../language/go/beego/run.html" class="navigation navigation-prev " aria-label="Previous page: 启动流程"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../../../language/go/reading-net-http.html" class="navigation navigation-next " aria-label="Next page: net/http 阅读笔记"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../../../gitbook/app.js"></script>

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
