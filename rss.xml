<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>BitPacking</title>
        <description>ç²¾è¿›ï¼Œæ±‚è¯¸å·±èº«</description>
        <link>https://blog.xiayf.cn/</link>
        <atom:link href="https://blog.xiayf.cn/rss.xml" rel="self" type="application/rss+xml"/>
        <pubDate>2025-06-05T00:50:46.911686+08:00</pubDate>
        <lastBuildDate>2025-06-05T00:50:46.911686+08:00</lastBuildDate>
        <generator>LingDong</generator>
        
        <item>
            <title>RaBitQ äºŒå€¼é‡åŒ–å…¥é—¨ï¼ˆè¯‘ï¼‰</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;åŸæ–‡:  &lt;a href=&apos;https://www.elastic.co/search-labs/blog/rabitq-explainer-101&apos;&gt;RaBitQ binary quantization 101&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;ä¸€ã€å¼•è¨€&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ­£å¦‚æˆ‘ä»¬ä¹‹å‰åœ¨ &lt;a href=&apos;https://blog.xiayf.cn/posts/scalar-quantization-101.html&apos;&gt;æ ‡é‡é‡åŒ–å…¥é—¨&lt;/a&gt; ä¸­è®¨è®ºçš„é‚£æ ·ï¼Œå¤§å¤šæ•°åµŒå…¥æ¨¡å‹è¾“å‡º$float32$ç±»å‹å‘é‡å€¼ï¼Œè¿™ä¸ªç²¾åº¦å¯¹äºè¡¨å¾å‘é‡ç©ºé—´æ¥è¯´é€šå¸¸è¿‡äºå†—ä½™ã€‚æ ‡é‡é‡åŒ–æŠ€æœ¯å¤§å¤§å‡å°‘äº†è¡¨å¾è¿™äº›å‘é‡æ‰€éœ€çš„å­˜å‚¨ç©ºé—´ã€‚ä¹‹å‰æˆ‘ä»¬ä¹Ÿè®¨è®ºè¿‡ &lt;a href=&apos;https://www.elastic.co/search-labs/blog/bit-vectors-in-elasticsearch&apos;&gt;Elasticsearch ä¸­çš„æ¯”ç‰¹å‘é‡&lt;/a&gt;ï¼Œä»¥åŠäºŒå€¼é‡åŒ–å¯¼è‡´çš„æŸå¤±é€šå¸¸æ˜¯ä¸å¯æ¥å—çš„ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å€ŸåŠ© &lt;a href=&apos;https://arxiv.org/pdf/2405.12497&apos;&gt;RaBitQ è®ºæ–‡&lt;/a&gt;ä¸­æå‡ºçš„äºŒå€¼é‡åŒ–æŠ€æœ¯ï¼Œå¯ä»¥è§£å†³å°†æ•°æ®ç®€å•é‡åŒ–ä¸ºæ¯”ç‰¹å‘é‡ï¼ˆbit vectorï¼‰è¿‡ç¨‹ä¸­æ‰€é‡åˆ°çš„é—®é¢˜ï¼Œé€šè¿‡æ›´ç»†è‡´åœ°åˆ’åˆ†ç©ºé—´ä»¥åŠä¿ç•™å˜æ¢çš„æ®‹å·®ï¼Œå®ç°ä¸æ ‡é‡é‡åŒ–ç›¸è¿‘çš„ç²¾åº¦è´¨é‡ã€‚ç›¸æ¯”å…¶ä»–ç±»ä¼¼æŠ€æœ¯ï¼Œæ¯”å¦‚&lt;a href=&apos;http://hal.archives-ouvertes.fr/docs/00/51/44/62/PDF/paper_hal.pdf&apos;&gt;ä¹˜ç§¯é‡åŒ–(PQ)&lt;/a&gt;ï¼Œè¿™äº›æ–°æŠ€æœ¯èƒ½å¤Ÿå®ç°æ€§èƒ½æ›´ä¼˜çš„è·ç¦»è®¡ç®—ï¼Œé€šå¸¸å¾—åˆ°çš„è®¡ç®—ç»“æœä¹Ÿæ›´å‡†ï¼Œä¹Ÿèƒ½å®ç°æ ‡é‡é‡åŒ–é€šå¸¸ä¸å¯èƒ½å®ç°çš„32å€å‹ç¼©ï¼ˆ32x level of compressionï¼‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è§£é‡ŠäºŒå€¼é‡åŒ–çš„ä¸€äº›æ ¸å¿ƒè¦ç´ ï¼Œç›¸å…³çš„æ•°å­¦ç»†èŠ‚è¯·å‚é˜… &lt;a href=&apos;https://arxiv.org/pdf/2405.12497&apos;&gt;RaBitQ è®ºæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2&gt;äºŒã€æ„å»ºæ¯”ç‰¹å‘é‡&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äºè·ç¦»è®¡ç®—ï¼Œå¯ä»¥æ›´é«˜æ•ˆåœ°é¢„è®¡ç®—æŸäº›éƒ¨åˆ†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯¹ç´¢å¼•æ„å»ºå’ŒæŸ¥è¯¢æ„é€ ä¸¤ä¸ªç¯èŠ‚åŒºåˆ†å¤„ç†ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä»¥ä¸‰ä¸ªéå¸¸ç®€å•çš„äºŒç»´å‘é‡ $v_1$ã€$v_2$å’Œ$v_3$ çš„ç´¢å¼•æ„å»ºï¼ˆindexingï¼‰ä¸ºä¾‹ï¼Œçœ‹çœ‹å¦‚ä½•å¯¹ä»–ä»¬è¿›è¡Œè½¬æ¢å’Œå­˜å‚¨ï¼Œå®ç°æŸ¥è¯¢æ—¶çš„é«˜æ•ˆè·ç¦»è®¡ç®—ã€‚&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$v_1=[0.56,0.82]$$&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$v_2=[1.23,0.71]$$&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$v_3=[-3.28,2.13]$$&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å°†è¿™äº›å‘é‡è½¬æ¢ä¸ºæ›´å°çš„è¡¨å¾å½¢å¼ï¼Œæ”¯æŒï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ä»¥åˆç†çš„å½¢å¼å¿«é€Ÿåœ°ä¼°ç®—å‘é‡è·ç¦»&lt;/li&gt;
&lt;li&gt;ä¹Ÿç¡®ä¿ç©ºé—´ä¸­çš„å‘é‡åˆ†å¸ƒèƒ½å¤Ÿå°†å¬å›å®é™…çš„æœ€è¿‘é‚»æ‰€éœ€è¦å¤„ç†çš„æ•°æ®å‘é‡æ€»æ•°é™ä¸‹æ¥&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å°†æ¯ä¸ªå‘é‡å˜æ¢ç§»åŠ¨åˆ°è¶…çƒä½“å†…éƒ¨ï¼Œå¯¹äºæˆ‘ä»¬çš„ä¾‹å­æ¥è¯´ï¼Œè¶…çƒä½“æ˜¯ä¸€ä¸ªäºŒç»´åœ†ï¼Œå•ä½åœ†&lt;/li&gt;
&lt;li&gt;å°†æ¯ä¸ªå‘é‡åˆ†åˆ«å¸é™„ï¼ˆsnappingï¼‰åˆ°åœ†å†…æŸä¸ªåŒºåŸŸçš„å•ä¸ªä»£è¡¨æ€§ç‚¹ä¸Š&lt;/li&gt;
&lt;li&gt;ä¿ç•™æ ¡æ­£å› å­ä»¥ä¾¿æ›´å‡†ç¡®åœ°è¿‘ä¼¼è®¡ç®—æ¯ä¸ªå‘é‡ä¸æŸ¥è¯¢å‘é‡ä¹‹é—´çš„è·ç¦»&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸‹é¢åˆ†æ­¥éª¤è§£æè¿™ä¸ªè¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h2&gt;ä¸‰ã€æ‰¾ä¸€ä¸ªä»£è¡¨æ€§è´¨å¿ƒ&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸ºäº†åˆ’åˆ†æ¯ä¸€ç»´ï¼Œéœ€è¦é€‰æ‹©ä¸€ä¸ªæ¢è½´ç‚¹ï¼ˆpivot pointï¼‰ã€‚ä¸ºäº†ç®€åŒ–ï¼Œå°†é€‰æ‹©ä¸€ä¸ªç‚¹æ¥è½¬æ¢æˆ‘ä»¬æ‰€æœ‰çš„æ•°æ®å‘é‡ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äºç¤ºä¾‹å‘é‡$v_1$ã€$v_2$å’Œ$v_3$ï¼Œé€‰æ‹©å®ƒä»¬çš„è´¨å¿ƒä½œä¸ºæ¢è½´ç‚¹ã€‚&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$v_{1}=[0.56,0.82]$$&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$v_{2}=[1.23,0.71]$$&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$v_{3}=[-3.28,2.13]$$&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$c=[(0.56+1.23+-3.28)/3,(0.82+0.71+2.13)/3]$$&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$c=[-0.49, 1.22]$$&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å°†æ‰€æœ‰è¿™äº›ç‚¹ä¸€èµ·ç»˜åˆ¶å‡ºæ¥ï¼š&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/t9BEZycxnGLmuKd.webp&apos; title=&apos;rabitq-101-pic-1&apos; alt=&apos;rabitq-101-pic-1&apos; width=&apos;600&apos;/&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;å›¾ 1ï¼šåŸºäºç¤ºä¾‹å‘é‡åŠå…¶æ´¾ç”Ÿè´¨å¿ƒç»˜åˆ¶çš„äºŒç»´å¹³é¢å›¾ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å°†æ®‹å·®å‘é‡åšå½’ä¸€åŒ–åï¼Œåˆ†åˆ«å‘½åä¸º $v_{c1}$ã€$v_{c2}$å’Œ$v_{c3}$ã€‚&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$
\begin{array}{l}
v_{c1}=(v_{1}-c) /\| v_{1}-c\|\\
v_{c2}=(v_{2}-c) /\| v_{2}-c\|\\
v_{c3}=(v_{3}-c) /\| v_{3}-c\|
\end{array}
$$&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹å…¶ä¸­ä¸€ä¸ªå‘é‡åšæ•°å­¦è¿ç®—ï¼š&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$v_{c1}=(v_{1}-c)/\| v_{1}-c\|$$&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$\begin{aligned}
v_{1}-c&amp;=[0.56,0.82]-[-0.49,1.22]\\
&amp;=[1.05,-0.39]
\end{aligned}$$&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$
\| v_{1}-c\| =1.13
$$&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$\begin{aligned}
v_{c1}&amp;=(v_{1}-c)/\| v_{1}-c\|\\
&amp;=([1.05,-0.39])/\| [1.05,-0.39]\|\\
&amp;=([1.05,-0.39])/1.13\\
&amp;=[0.94,-0.35]
\end{aligned}$$&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹å¦å¤–ä¸¤ä¸ªå‘é‡åšåŒæ ·çš„æ•°å­¦è¿ç®—ï¼Œç»“æœåˆ†åˆ«ä¸ºï¼š&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$
\begin{aligned}v_{c2}&amp;=\left[ 0.96,-0.28 \right]\\ v_{c3}&amp;=\left[ -0.95,0.31 \right]\end{aligned}
$$&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸‹é¢è¿™ä¸ªåŠ¨æ€å›¾ï¼Œå¯ä»¥æ–¹ä¾¿æˆ‘ä»¬å½¢è±¡åœ°ç†è§£è¿™ä¸ªè½¬æ¢å’Œå½’ä¸€åŒ–è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/Ls2nz3BpexGFfyD.gif&apos; title=&apos;rabitq-101-pic-2&apos; alt=&apos;rabitq-101-pic-2&apos; width=&apos;600&apos;/&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;å›¾ 2ï¼šç¤ºä¾‹å‘é‡åŠå…¶æ´¾ç”Ÿè´¨å¿ƒåœ¨å•ä½åœ†å†…çš„å˜æ¢åŠ¨ç”»ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;h2&gt;å››ã€ä»…ä½¿ç”¨ 1 æ¯”ç‰¹&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å°†æ•°æ®å‘é‡é›†ä¸­å’Œå½’ä¸€åŒ–ä¹‹åï¼Œå¯ä»¥åº”ç”¨æ ‡å‡†çš„&lt;a href=&apos;https://www.elastic.co/search-labs/blog/bit-vectors-in-elasticsearch&apos;&gt;äºŒå€¼é‡åŒ–&lt;/a&gt;ç¼–ç  - å¯¹äºç»è¿‡è½¬æ¢çš„å‘é‡çš„æ¯ä¸ªåˆ†é‡ï¼Œå¦‚æœå…¶ä¸ºè´Ÿæ•°ï¼Œåˆ™ç¼–ç ä¸º0ï¼Œæ­£æ•°åˆ™ç¼–ç ä¸º1ã€‚åœ¨æˆ‘ä»¬çš„äºŒç»´ç¤ºä¾‹ä¸­ï¼Œå³å°†å•ä½åœ†åˆ†æˆå››ä¸ªè±¡é™ï¼Œ$v_{c1}$ã€$v_{c2}$å’Œ$v_{c3}$å¯¹åº”çš„äºŒå€¼å‘é‡åˆ†åˆ«å˜ä¸º$r_1=[1,0],r_2=[1,0],r_3=[0,1]$ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ€åå°†æ¯ä¸ªæ•°æ®å‘é‡åˆ†åˆ«å¸é™„ï¼ˆsnappingï¼‰åˆ°å¯¹åº”åŒºåŸŸçš„ä¸€ä¸ªä»£è¡¨æ€§ç‚¹ä¸Šï¼Œç¡®åˆ‡æ¥è¯´ï¼Œè¿™äº›ä»£è¡¨æ€§ç‚¹ä¸ºå•ä½åœ†ä¸Šä¸æ¯ä¸ªè½´è·ç¦»ç›¸ç­‰çš„ç‚¹ï¼š$\pm \frac{1}{\sqrt{d}}$ &lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot; role=&quot;doc-noteref&quot;&gt;[1]&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å°†ç»è¿‡çš„é‡åŒ–çš„ä¸‰ä¸ªå‘é‡åˆ†åˆ«è¡¨ç¤ºä¸º$\overline{v}_1$ã€$\overline{v}_2$å’Œ$\overline{v}_3$ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é‚£ä¹ˆï¼Œä»¥ $v_{c1}$  ä¸ºä¾‹ï¼Œå°†å…¶å¸é™„åˆ°å¯¹åº”åŒºåŸŸä¸­çš„ä»£è¡¨æ€§ç‚¹ $r_1$ï¼Œåˆ™å¾—åˆ°ï¼š&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$\begin{aligned}
\overline{v}_1&amp;=\frac{1}{\sqrt{d}} \left( 2r_{1}-1 \right)\\
&amp;=\frac{1}{\sqrt{2}} [1,-1]\\
&amp;=\left[ \frac{1}{\sqrt{2}} ,-\frac{1}{\sqrt{2}} \right]
\end{aligned}$$&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚ä¸‹æ˜¯ $v_2$å’Œ$v_3$ è¿™2ä¸ªåŸå§‹æ•°æ®å‘é‡ï¼ˆè¯‘æ³¨ï¼šä¹Ÿå°±æ˜¯ $v_{c2}$ å’Œ $v_{c3}$ï¼‰çš„é‡åŒ–å½¢å¼ï¼š&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$\begin{aligned}
\overline{v}_2&amp;=\left[ \frac{1}{\sqrt{2}} ,-\frac{1}{\sqrt{2}} \right]\\
\overline{v}_3&amp;=\left[ -\frac{1}{\sqrt{2}} ,\frac{1}{\sqrt{2}} \right]
\end{aligned}$$&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚ &lt;a href=&apos;https://arxiv.org/pdf/2405.12497&apos;&gt;RaBitQ è®ºæ–‡&lt;/a&gt; æ‰€è¿°ï¼Œé€‰å–çš„è¿™äº›ä»£è¡¨æ€§ç‚¹å…·å¤‡ä¸€äº›ä¸é”™çš„æ•°å­¦æ€§è´¨ï¼Œä¸&lt;a href=&apos;http://hal.archives-ouvertes.fr/docs/00/51/44/62/PDF/paper_hal.pdf&apos;&gt;ä¹˜ç§¯é‡åŒ–ï¼ˆPQï¼‰&lt;/a&gt; çš„ç æœ¬ç±»ä¼¼ï¼ˆnot unlikeï¼‰ã€‚&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/FwhH1C3vxcgKBzJ.gif&apos; title=&apos;rabitq-101-pic-3&apos; alt=&apos;rabitq-101-pic-3&apos; width=&apos;600&apos;/&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;å›¾ 3ï¼šäºŒå€¼é‡åŒ–åçš„å‘é‡å¸é™„åˆ°å¯¹åº”åŒºåŸŸä¸­ä»£è¡¨æ€§ç‚¹çš„è¿‡ç¨‹ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è‡³æ­¤ï¼Œå¯¹äºå‘é‡çš„æ¯ä¸ªåˆ†é‡éƒ½æœ‰ä¸€ä¸ª1æ¯”ç‰¹çš„è¿‘ä¼¼å€¼ï¼Œå°½ç®¡ç›´æ¥ç”¨äºè®¡ç®—æ¯”è¾ƒè·ç¦»æœ‰äº›ä¸å¤ªå‡†ç¡®ï¼ˆsomewhat fuzzyï¼‰ã€‚æ˜¾ç„¶ï¼Œåœ¨å½“å‰è¿™ä¸ªé‡åŒ–çŠ¶æ€ä¸‹ï¼Œ$\overline{v}_1$å’Œ$\overline{v}_2$æ˜¯ç›¸åŒçš„ï¼Œè¿™æ ·ä¸å¤ªç†æƒ³ï¼Œé—®é¢˜ç±»ä¼¼äºä¹‹å‰è®¨è®ºå°†æµ®ç‚¹æ•°å‘é‡ç¼–ç ä¸º &lt;a href=&apos;https://www.elastic.co/search-labs/blog/bit-vectors-in-elasticsearch&apos;&gt;ElasticSearch ä¸­çš„æ¯”ç‰¹å‘é‡&lt;/a&gt; æ˜¯è¯´çš„ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ç§æ–¹æ³•çš„ä¼˜é›…ä¹‹å¤„åœ¨äºï¼ŒæŸ¥è¯¢æ—¶å¯ä»¥ä½¿ç”¨ç±»ä¼¼äºç‚¹ç§¯çš„ä¸œè¥¿è®¡ç®—è¿‘ä¼¼è·ç¦»æ¥å¿«é€Ÿæ¯”è¾ƒæ¯ä¸ªæ•°æ®å‘é‡å’Œæ¯ä¸ªæŸ¥è¯¢å‘é‡ã€‚åæ–‡ä¸­è®¨è®ºå¤„ç†æŸ¥è¯¢æ—¶ä¼šè¯¦ç»†ä»‹ç»ã€‚&lt;/p&gt;
&lt;h2&gt;äº”ã€é—®é¢˜ä¸æ–¹æ¡ˆ&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚ä¸Šæ‰€è¿°ï¼Œå°†æµ®ç‚¹æ•°å‘é‡è½¬æ¢ä¸ºæ¯”ç‰¹å‘é‡æ—¶ä¼šä¸¢å¤±å¤§é‡ä¿¡æ¯ã€‚æˆ‘ä»¬éœ€è¦ä¸€äº›é¢å¤–çš„ä¿¡æ¯æ¥å¸®åŠ©è¡¥å¿è¿™ç§æŸå¤±ä»¥åŠæ ¡æ­£è·ç¦»ä¼°ç®—ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸ºäº†æ¢å¤ä¿çœŸåº¦ï¼ˆfidelityï¼‰ï¼Œæˆ‘ä»¬å°†æ¯ä¸ªå‘é‡åˆ°è´¨å¿ƒçš„è·ç¦»ä»¥åŠå‘é‡ï¼ˆä¾‹å¦‚$v_{c1}$ï¼‰ä¸å…¶é‡åŒ–å½¢å¼ï¼ˆä¾‹å¦‚$\overline{v}_1$ï¼‰çš„æŠ•å½±ï¼ˆç‚¹ç§¯ï¼‰å­˜å‚¨ä¸ºä¸¤ä¸ª$float32$å€¼ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åˆ°è´¨å¿ƒçš„æ¬§å¼è·ç¦»æ¯”è¾ƒç®€å•ç›´è§‚ï¼Œä¹‹å‰åœ¨é‡åŒ–æ¯ä¸ªå‘é‡æ—¶å·²ç»è®¡ç®—è¿‡ï¼š&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$\begin{aligned}
\left\| v_{1}-c \right\|&amp;=1.13\\
\left\| v_{2}-c \right\|&amp;=1.79\\
\left\| v_{3}-c \right\|&amp;=2.92
\end{aligned}$$&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é¢„å…ˆè®¡ç®—æ¯ä¸ªæ•°æ®å‘é‡åˆ°è´¨å¿ƒçš„è·ç¦»å¯ä»¥æ¢å¤å‘é‡çš„ä¸­å¿ƒåŒ–å˜æ¢ã€‚ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬å°†è®¡ç®—æŸ¥è¯¢å‘é‡åˆ°è´¨å¿ƒçš„è·ç¦»ã€‚ç›´è§‚ä¸Šï¼Œè´¨å¿ƒå……å½“äº†ä¸€ä¸ªä¸­ä»‹ï¼Œè€Œä¸æ˜¯ç›´æ¥è®¡ç®—æŸ¥è¯¢å‘é‡å’Œæ•°æ®å‘é‡ä¹‹é—´çš„è·ç¦»ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å‘é‡ä¸å…¶é‡åŒ–å‘é‡çš„ç‚¹ç§¯æ˜¯ï¼š&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$\begin{aligned}
v_{c1}\cdot \bar{v}_{1}&amp;=v_{c1}\cdot \frac{1}{\sqrt{2}} \left( 2r_{1}-1 \right)\\
&amp;=[0.94,-0.35]\cdot \left[ \frac{1}{\sqrt{2}} ,-\frac{1}{\sqrt{2}} \right]\\
&amp;=0.90\end{aligned}
$$&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦å¤–ä¸¤ä¸ªå‘é‡çš„ç»“æœä¸ºï¼š&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$\begin{aligned}
v_{c2}\cdot \overline{v}_2&amp;=0.95\\
v_{c3}\cdot \overline{v}_3&amp;=0.89
\end{aligned}$$&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é‡åŒ–å‘é‡ä¸åŸå§‹å‘é‡çš„ç‚¹ç§¯ï¼Œä½œä¸ºç¬¬äºŒä¸ªæ ¡æ­£å› å­ï¼Œæ•æ‰äº†é‡åŒ–å‘é‡ä¸å…¶åŸå§‹ä½ç½®çš„è·ç¦»ã€‚&lt;a href=&apos;https://arxiv.org/pdf/2405.12497&apos;&gt;RaBitQ è®ºæ–‡&lt;/a&gt; çš„ 3.2 èŠ‚è¯´æ˜é‡åŒ–æ•°æ®ä¸æŸ¥è¯¢å‘é‡ä¹‹é—´ä»¥æœ´ç´ æ–¹å¼ï¼ˆin a naive fashionï¼‰è®¡ç®—çš„ç‚¹ç§¯å­˜åœ¨åå·®ã€‚è¿™ä¸ªå› å­æ­£å¥½è¡¥å¿äº†å®ƒã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘ä»¬åšè¿™ç§é‡åŒ–è½¬æ¢æ˜¯ä¸ºäº†å‡å°‘æ•°æ®å‘é‡çš„æ€»å¤§å°å¹¶é™ä½å‘é‡æ¯”è¾ƒçš„å¼€é”€ã€‚è™½ç„¶åœ¨æˆ‘ä»¬äºŒç»´ç¤ºä¾‹ä¸­ï¼Œè¿™äº›æ ¡æ­£å› å­çœ‹ä¼¼å¾ˆå¤§ï¼Œä½†éšç€å‘é‡ç»´åº¦çš„å¢åŠ ï¼Œå®ƒä»¬ä¼šå˜å¾—å¾®ä¸è¶³é“ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª 1024 ç»´çš„å‘é‡ï¼Œå¦‚æœä»¥$float32$å½¢å¼å­˜å‚¨ï¼Œéœ€è¦å ç”¨ 4096 å­—èŠ‚ã€‚å¦‚æœä»¥è¿™ç§æ¯”ç‰¹å‹ç¼©å’Œæ ¡æ­£å› å­å½¢å¼å­˜å‚¨ï¼Œåªå ç”¨ 136 å­—èŠ‚ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è‹¥æƒ³æ›´å¥½åœ°ç†è§£æˆ‘ä»¬ä¸ºä»€ä¹ˆä½¿ç”¨è¿™äº›å› å­ï¼Œè¯·å‚é˜… &lt;a href=&apos;https://arxiv.org/pdf/2405.12497&apos;&gt;RaBitQ è®ºæ–‡&lt;/a&gt;ï¼Œå®ƒè¯¦ç»†ä»‹ç»äº†æ¶‰åŠçš„æ•°å­¦çŸ¥è¯†ã€‚&lt;/p&gt;
&lt;h2&gt;å…­ã€æŸ¥è¯¢å‘é‡&lt;/h2&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$q=[0.68, -1.72]$$&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸ºäº†èƒ½å¤Ÿå°†æˆ‘ä»¬çš„é‡åŒ–æ•°æ®å‘é‡ä¸æŸ¥è¯¢å‘é‡è¿›è¡Œæ¯”è¾ƒï¼Œé¦–å…ˆå¿…é¡»å°†æŸ¥è¯¢å‘é‡ç›¸å¯¹äºå•ä½åœ†è¿›è¡Œåç§»ï¼Œè½¬æ¢ä¸ºé‡åŒ–å½¢å¼ã€‚æˆ‘ä»¬å°†æŸ¥è¯¢å‘é‡ç§°ä¸º$q$ï¼Œè½¬æ¢åçš„å‘é‡ç§°ä¸º$q_c$ï¼Œæ ‡é‡é‡åŒ–åçš„å‘é‡ç§°ä¸º$\overline{q}$ã€‚&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$\begin{aligned}
q-c&amp;=[(0.68- -0.49),(-1.72-1.22)]\\
&amp;=[1.17,-2.95]
\end{aligned}$$&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$\begin{aligned}
q_{c}&amp;=(q-c)/\| q-c\|\\
&amp;=[1.17,-2.95]/3.17\\
&amp;=[0.37,-0.92]
\end{aligned}$$&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æŸ¥è¯¢å‘é‡æ ‡é‡é‡åŒ–åˆ°4ä¸ªæ¯”ç‰¹ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªå‘é‡ç§°ä¸º$\overline{q}$ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä¸æ˜¯ç›´æ¥é‡åŒ–åˆ°æ¯”ç‰¹è¡¨ç¤ºï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€ä¸ª$int4$æ ‡é‡é‡åŒ–ï¼Œ$\overline{q}$ä½œä¸º $int4$ å­—èŠ‚æ•°ç»„ï¼Œç”¨äºä¼°è®¡è·ç¦»ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ç§éå¯¹ç§°é‡åŒ–åœ¨ä¸å¢åŠ é¢å¤–å­˜å‚¨çš„æƒ…å†µä¸‹ä¿ç•™æ›´å¤šä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$lower = -0.92$$&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$upper = 0.37$$&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$\begin{aligned}
width&amp;=\left( upper-lower \right) /\left( 2^{4}-1 \right)\\
&amp;=(0.37--0.92)/15\\
&amp;=0.08
\end{aligned}$$&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$\begin{aligned}
\bar{q}&amp;=\lfloor (q_{c}-lower )/width \rfloor\\
&amp;=\lfloor ([0.37,-0.92]-[-0.92,-0.92])/0.08\rfloor\\
&amp;=[15,0]
\end{aligned}$$&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/z9jOGPw7oiAqv2f.gif&apos; title=&apos;rabitq-101-pic-4&apos; alt=&apos;rabitq-101-pic-4&apos; width=&apos;600&apos;/&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;å›¾ 4ï¼šå¯¹æŸ¥è¯¢å‘é‡åº”ç”¨è´¨å¿ƒè½¬æ¢çš„è¿‡ç¨‹ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æ‚¨æ‰€è§ï¼Œå› ä¸ºæˆ‘ä»¬åªæœ‰ä¸¤ä¸ªç»´åº¦ï¼Œæˆ‘ä»¬çš„é‡åŒ–æŸ¥è¯¢å‘é‡ç”±å¤„äº$int4$å–å€¼èŒƒå›´å†…ä¸¤ä¸ªå€¼ç»„æˆã€‚å¯¹äºæ›´é•¿çš„å‘é‡ï¼Œä½ ä¼šçœ‹åˆ°å„ç§ $int4$ å€¼ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæ˜¯å–å€¼èŒƒå›´çš„æœ€å¤§å€¼ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯æœ€å°å€¼ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç°åœ¨å¯ä»¥æ‰§è¡Œè·ç¦»è®¡ç®—ï¼Œå¯¹æ¯ä¸ªç´¢å¼•æ•°æ®å‘é‡ä¸è¿™ä¸ªæŸ¥è¯¢å‘é‡åšæ¯”è¾ƒ - å°†é‡åŒ–æ•°æ®å‘é‡æ¯ä¸€ç»´åˆ†åˆ«ä¸é‡åŒ–æŸ¥è¯¢å‘é‡çš„å¯¹åº”ç»´ç›¸ä¹˜ï¼Œå†å°†æ‰€æœ‰ç»´çš„ä¹˜ç§¯ç›¸åŠ ã€‚åŸºæœ¬ä¸Šï¼Œå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ç‚¹ç§¯ï¼Œä½†ä½¿ç”¨çš„æ˜¯æ¯”ç‰¹å€¼å’Œå­—èŠ‚å€¼ï¼ˆbits and bytesï¼‰ã€‚&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$\begin{aligned}
\overline{q} \cdot r_{1}&amp;=\left[ 15,0 \right] \cdot \left[ 1,0 \right]\\
&amp;=15
\end{aligned}$$&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ¥ç€åº”ç”¨æ ¡æ­£å› å­æ¥è§£å¼€ï¼ˆunrollï¼‰é‡åŒ–ï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªæ›´å‡†ç¡®çš„è·ç¦»ä¼°è®¡ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¦å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬è¦ä»é‡åŒ–æŸ¥è¯¢å‘é‡ä¸­æ‹¿åˆ°å–å€¼èŒƒå›´çš„ä¸Šä¸‹ç•Œï¼ˆå¯¹æŸ¥è¯¢å‘é‡åšæ ‡é‡é‡åŒ–æ—¶è¡ç”Ÿå‡ºæ¥çš„ï¼‰ã€‚æ­¤å¤–ï¼Œè¿˜éœ€è¦æŸ¥è¯¢å‘é‡åˆ°è´¨å¿ƒçš„è·ç¦»ã€‚ç”±äºå‰é¢è®¡ç®—è¿‡æŸ¥è¯¢å‘é‡ä¸è´¨å¿ƒä¹‹é—´çš„è·ç¦»ï¼Œæ­¤å¤„å¼•ç”¨è¿‡æ¥å³å¯ï¼š&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$\|q-c\| = 3.17$$&lt;/p&gt;
&lt;h2&gt;ä¸ƒã€ä¼°ç®—è·ç¦»&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¥½çš„ï¼æˆ‘ä»¬å·²ç»å¯¹ç´¢å¼•æ•°æ®å‘é‡å’ŒæŸ¥è¯¢å‘é‡åšäº†é‡åŒ–å¹¶æ”¶é›†äº†æ ¡æ­£å› å­ã€‚ç°åœ¨å¯ä»¥è®¡ç®—$v_1$å’Œ$q$ä¹‹é—´çš„ä¼°è®¡è·ç¦»äº†ã€‚æˆ‘ä»¬å°†æ¬§å‡ é‡Œå¾—è·ç¦»è®¡ç®—å…¬å¼è½¬æ¢ä¸ºä¸€ä¸ªå…·æœ‰æ›´å¤šè®¡ç®—å‹å¥½é¡¹çš„æ–¹ç¨‹ï¼š&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$\begin{aligned}dist(v_{1},q)&amp;=\| v_{1}-q\|\\
&amp;=\sqrt{\| (v_{1}-c)-(q-c)\|^{2}}\\
&amp;=\sqrt{\| v_{1}-c\|^{2} +\| q-c\|^{2} -2\times \| v_{1}-c\| \times \| q-c\| \times (q_{c}\cdot v_{c1})}
\end{aligned}$$&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ç§å½¢å¼ä¸­ï¼Œå¤šæ•°å› å­ï¼Œæˆ‘ä»¬ä¹‹å‰æ¨å¯¼è¿‡ï¼Œæ¯”å¦‚ $\|v_1âˆ’c\|$ï¼Œæ˜æ˜¾å¯ä»¥åœ¨æŸ¥è¯¢ä¹‹å‰æå‰è®¡ç®—å¥½ï¼Œæˆ–è€…ä¹Ÿä¸æ˜¯ç›´æ¥å¯¹æŸ¥è¯¢å‘é‡å’Œä»»ä¸€ç»™å®šæ•°æ®å‘é‡ï¼ˆæ¯”å¦‚ $v_1$ï¼‰ åšæ¯”è¾ƒè®¡ç®—ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç„¶è€Œæˆ‘ä»¬ä»ç„¶éœ€è¦è®¡ç®—$q_câ‹…v_{c1}$.ã€‚å¯ä»¥åˆ©ç”¨æ ¡æ­£å› å­å’ŒäºŒå€¼é‡åŒ–è·ç¦»åº¦é‡$\overline{q}â‹…r_1$æ¥åˆç†ä¸”å¿«é€Ÿåœ°ä¼°ç®—è¿™ä¸ªå€¼ã€‚ä¸‹é¢æˆ‘ä»¬æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$q_{c}\cdot v_{c1}\approx (q_{c}\cdot \overline{v}_{1} )/(v_{c1}\cdot \overline{v}_{1} )$$&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å…ˆä¼°ç®—$q_câ‹…\overline{v}_1$ï¼Œè¿™ä¸ªä¼°ç®—å…¬å¼æœ¬è´¨ä¸Šæ˜¯ä½¿ç”¨ä¹‹å‰å®šä¹‰çš„ä»£è¡¨ç‚¹æ¥è§£å¼€ï¼ˆunrollï¼‰è½¬æ¢ï¼š&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$q_{c}\cdot \overline{v}_{1} \approx (lower+width\cdot \overline{q} )\cdot (\frac{1}{\sqrt{d}} (2r_{1}-1))$$&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å…·ä½“æ¥è¯´ï¼Œ$(\frac{1}{\sqrt{d}} (2r_{1}-1)$å°†äºŒå€¼åŒ–çš„æ•°å€¼æ˜ å°„å›ä»£è¡¨ç‚¹ï¼Œ$lower+width\cdot \overline{q}$ åˆ™æ’¤é”€äº†ç”¨äºè®¡ç®—æ ‡é‡é‡åŒ–æŸ¥è¯¢å‘é‡éƒ¨åˆ†çš„ç§»ä½å’Œç¼©æ”¾ï¼ˆshift and scaleï¼‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯ä»¥å°†è¿™ä¸ªä¼°ç®—å…¬å¼é‡å†™ä¸ºæ›´åˆ©äºè®¡ç®—çš„å½¢å¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸è¿‡ï¼Œæˆ‘ä»¬å…ˆå®šä¹‰å‡ ä¸ªè¾…åŠ©å˜é‡ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å°† $r_1$ä¸­ 1 çš„æ€»ä½æ•°å®šä¹‰ä¸º$\overline{v}_{b1}$ï¼Œå½“å‰ä¾‹å­ä¸­ç­‰äº $1$&lt;/li&gt;
&lt;li&gt;å°† $\overline{q}$&lt;sup id=&quot;fnref:2&quot;&gt;&lt;a href=&quot;#fn:2&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot; role=&quot;doc-noteref&quot;&gt;[2]&lt;/a&gt;&lt;/sup&gt;ä¸­æ‰€æœ‰é‡åŒ–å€¼çš„æ€»å’Œï¼ˆtotal numberï¼‰å®šä¹‰ä¸º$\overline{q}_b$ï¼Œå½“å‰ä¾‹å­ä¸­ç­‰äº $15$&lt;/li&gt;&lt;/ul&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$\begin{aligned}
q_{c}\cdot \overline{v}_{1}&amp;\approx \frac{2\times \textit{width}}{\sqrt{d}} \times (\overline{q} \cdot r_{1})+\frac{2\times \textit{lower}}{\sqrt{d}} \times \overline{v}_{b1} -\frac{\textit{width}}{\sqrt{d}} \times \overline{q}_{b} -\sqrt{d} \times \textit{lower}\\
&amp;\approx \frac{2\times 0.08}{\sqrt{2}} \times 15+\frac{2\times -0.92}{\sqrt{2}} \times 1-\frac{0.08}{\sqrt{2}} \times 15-\sqrt{2} \times -0.92\\
&amp;\approx 0.92
\end{aligned}$$&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åˆ©ç”¨è¿™ä¸ªå€¼å’Œ$v_{c1}â‹…\overline{v}_1$ï¼ˆåœ¨å¯¹æ•°æ®å‘é‡å»ºç´¢å¼•æ—¶é¢„å…ˆè®¡ç®—å¥½ï¼‰ï¼Œä»£å…¥å…¬å¼ï¼Œè®¡ç®—$q_c\cdot v_{c1}$çš„è¿‘ä¼¼å€¼ï¼š&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$\begin{aligned}
q_{c}\cdot v_{c1}&amp;\approx (q_{c}\cdot \overline{v}_{1} )/(v_{c1}\cdot \overline{v}_{1} )\\
&amp;\approx 0.92/0.90\\
&amp;\approx 1.01
\end{aligned}$$&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ€åï¼Œå°†è¿™ä¸ªè¿‘ä¼¼å€¼ä»£å…¥å‰é¢é‚£ä¸ªæ›´å¤§çš„è·ç¦»å…¬å¼ä¸­ï¼ˆæ³¨æ„ï¼šæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯$q_câ‹…v_{c1}$çš„ä¼°è®¡å€¼ï¼‰ï¼š&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$\begin{aligned}
dist(v_{1},q)&amp;=\sqrt{\| v_{1}-c\|^{2} +\| q-c\|^{2} -2\times \| v_{1}-c\| \times \| q-c\| \times (q_{c}\cdot v_{c1})}\\ est\_ dist(v_{1},q)&amp;=\sqrt{1.13^{2}+3.17^{2}-2\times 1.13\times 3.17\times 1.01}
\end{aligned}$$&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åº”ç”¨æ‰€æœ‰æ ¡æ­£å› å­åï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸¤ä¸ªå‘é‡ä¹‹é—´è·ç¦»çš„ä¸€ä¸ªåˆç†çš„ä¼°è®¡å€¼ã€‚ä¾‹å¦‚ï¼Œå½“å‰ä¾‹å­ä¸­ï¼ŒåŸå§‹æ•°æ®å‘é‡$v_1$ã€$v_2$ã€$v_3$ ä¸$q$  ä¹‹é—´çš„ä¼°è®¡è·ç¦»ä¸çœŸå®è·ç¦»çš„æ¯”è¾ƒå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$\begin{aligned}
est\_ dist(v_{1},q)&amp;=2.02\\
est\_ dist(v_{2},q)&amp;=1.15\\
est\_ dist(v_{3},q)&amp;=6.15
\end{aligned}$$&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$\begin{aligned}
eucl\_ dist(v_{1},q)&amp;=2.55\\
eucl\_ dist(v_{2},q)&amp;=2.50\\
eucl\_ dist(v_{3},q)&amp;=5.52
\end{aligned}$$&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å…³äºçº¿æ€§ä»£æ•°åº”ç”¨æ—¶å¦‚ä½•æ¨å¯¼æˆ–ç®€åŒ–çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… &lt;a href=&apos;https://arxiv.org/pdf/2405.12497&apos;&gt;RaBitQ è®ºæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2&gt;å…«ã€é‡æ–°æ’åº&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä»ä¸Šä¸€èŠ‚çš„ç»“æœå¯ä»¥çœ‹å‡ºï¼Œè¿™äº›ä¼°è®¡è·ç¦»ç¡®å®æ˜¯ä¼°è®¡å€¼ã€‚äºŒå€¼é‡åŒ–äº§å‡ºçš„å‘é‡ï¼Œå¯¹å…¶è®¡ç®—å‡ºæ¥çš„å‘é‡è·ç¦»ï¼Œå³ä½¿åº”ç”¨é¢å¤–çš„æ ¡æ­£å› å­ï¼Œä¹Ÿä»…ä»…æ˜¯åŸå§‹å‘é‡ä¹‹é—´è·ç¦»çš„è¿‘ä¼¼å€¼ã€‚å®éªŒè¯æ˜ï¼Œé€šè¿‡å¼•å…¥ä¸€ä¸ªå¤šé˜¶æ®µè¿‡ç¨‹ï¼Œå¯ä»¥å®ç°é«˜å¬å›ç‡ã€‚è¿™è¯å®äº†&lt;a href=&apos;https://arxiv.org/pdf/2405.12497&apos;&gt;RaBitQ è®ºæ–‡&lt;/a&gt;ä¸­çš„å‘ç°ï¼ˆfindingsï¼‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å› æ­¤ï¼Œä¸ºäº†è·å¾—é«˜è´¨é‡çš„ç»“æœï¼ŒäºŒå€¼é‡åŒ–å¬å›çš„ç»“æœå¿…é¡»ä½¿ç”¨æ›´ç²¾ç¡®çš„è·ç¦»è®¡ç®—è¿›è¡Œé‡æ–°æ’åºã€‚å®é™…åº”ç”¨ä¸­ï¼Œè¿™ä¸ªå€™é€‰å­é›†å¯ä»¥å¾ˆå°ï¼Œé€šå¸¸ä½¿ç”¨ 100 ä¸ªæˆ–æ›´å°‘çš„å€™é€‰è€…å³å¯å®ç°å¤§å‹æ•°æ®é›†ï¼ˆ&gt;1mï¼‰&gt;95%çš„å¬å›ç‡ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½¿ç”¨ RaBitQï¼Œä¸­é—´ç»“æœåœ¨æœç´¢æ“ä½œè¿‡ç¨‹ä¸­ä¼šæŒç»­é‡æ–°æ’åºã€‚åœ¨æˆ‘ä»¬çš„å®éªŒä¸­ï¼Œä¸ºäº†å®ç°æ›´å¯æ‰©å±•çš„äºŒå€¼é‡åŒ–ï¼Œæˆ‘ä»¬å°†é‡æ’åºæ­¥éª¤è§£è€¦å‡ºæ¥ã€‚è™½ç„¶ RaBitQ èƒ½å¤Ÿåœ¨æœç´¢è¿‡ç¨‹ä¸­é€šè¿‡é‡æ–°æ’åºæ¥ç»´æŠ¤æ›´å¥½çš„å‰$N$å€™é€‰åˆ—è¡¨ï¼Œä»£ä»·æ˜¯éœ€è¦ä¸æ–­åŠ è½½å®Œæ•´çš„$float32$å‘é‡ï¼Œè¿™å¯¹äºç”Ÿäº§ç¯å¢ƒä¸­ä¸€äº›è¾ƒå¤§çš„æ•°æ®é›†æ¥è¯´æ˜¯ä¸å¯è¡Œçš„ã€‚&lt;/p&gt;
&lt;h2&gt;ä¹ã€æ€»ç»“&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å“‡ï¼ä½ é¡ºåˆ©åœ°è¯»å®Œäº†ï¼è¿™ç¯‡åšå®¢ç¡®å®å¾ˆé•¿ã€‚å¯¹äºè¿™ä¸ªæ–°ç®—æ³•æˆ‘ä»¬éå¸¸å…´å¥‹ï¼Œå®ƒå¯ä»¥ç¼“è§£ä¹˜ç§¯é‡åŒ–ï¼ˆä¾‹å¦‚ç æœ¬æ„å»ºæˆæœ¬ã€è·ç¦»ä¼°è®¡æ…¢ç­‰ï¼‰çš„è®¸å¤šç—›ç‚¹ï¼Œå¹¶æä¾›å‡ºè‰²çš„å¬å›ç‡å’Œæ£€ç´¢é€Ÿåº¦ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;&lt;ol&gt;&lt;li id=&quot;fn:1&quot;&gt;&lt;p&gt;è¯‘æ³¨ï¼šæ²¡çœ‹æ‡‚è¿™ä¸ªå…¬å¼ ğŸ˜…&lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;â†©&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn:2&quot;&gt;&lt;p&gt;è¯‘æ³¨ï¼šåŸæ–‡æœ‰è¯¯ï¼Œå°† $\overline{q}$ å†™æˆäº† $\overline{q}_b$&lt;a href=&quot;#fnref:2&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;â†©&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/div&gt;</description>
            <pubDate>2025-05-20</pubDate>
            <link>https://blog.xiayf.cn/posts/rabitq-explainer-101.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/rabitq-explainer-101.html</guid>
        </item>
        
        <item>
            <title>æ ‡é‡é‡åŒ–å…¥é—¨ï¼ˆè¯‘ï¼‰</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;åŸæ–‡ï¼š&lt;a href=&apos;https://www.elastic.co/search-labs/blog/scalar-quantization-101&apos;&gt;Scalar quantization 101&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;ç®€ä»‹&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¤šæ•°åµŒå…¥ï¼ˆembeddingï¼‰æ¨¡å‹ä¼šè¾“å‡º $float32$ æ•°å€¼ç²¾åº¦çš„å‘é‡ã€‚è¿™ä¸ªç²¾åº¦è™½ç„¶æä¾›äº†ä¿¡æ¯é«˜ä¿çœŸï¼Œä½†åœ¨çœŸæ­£é‡è¦çš„ä¿¡æ¯ä¹‹å¤–ä¹Ÿå¸¦æ¥ä¸€äº›èµ„æºæµªè´¹ã€‚å¯¹äºç»™å®šçš„æ•°æ®é›†ï¼ŒåµŒå…¥ä¸å¯èƒ½åœ¨å•ä¸ªç»´åº¦éœ€è¦20äº¿ç§å–å€¼ï¼Œç‰¹åˆ«æ˜¯å¯¹äºé«˜ç»´åº¦å‘é‡è€Œè¨€ï¼ˆæ¯”å¦‚ï¼š386ç»´åŠä»¥ä¸Šï¼‰ã€‚é‡åŒ–ä»¥ä¸€ç§æœ‰æŸçš„æ–¹å¼å¯¹å‘é‡è¿›è¡Œç¼–ç ï¼Œè½»å¾®é™ä½ä¿¡æ¯ä¿çœŸè€Œæ˜æ˜¾åœ°é™ä½å­˜å‚¨ç©ºé—´å ç”¨ã€‚&lt;/p&gt;
&lt;h2&gt;ç†è§£æ ‡é‡é‡åŒ–çš„åˆ†æ¡¶&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ ‡é‡é‡åŒ–ä½¿ç”¨æ›´å°çš„æ•°æ®ç±»å‹å¯¹å‘é‡æ¯ä¸€ç»´çš„å–å€¼è¿›è¡Œåˆ†æ¡¶ã€‚æœ¬æ–‡çš„ä½™ä¸‹éƒ¨åˆ†å°†å‡è®¾å°† $float32$ é‡åŒ–åˆ° $int8$ ã€‚ä¸ºäº†å‡†ç¡®åœ°å¯¹å€¼è¿›è¡Œåˆ†æ¡¶ï¼Œä¸èƒ½ç®€å•åœ°å°†å€¼å››èˆäº”å…¥åˆ°æœ€è¿‘çš„æ•´æ•°ã€‚è®¸å¤šæ¨¡å‹è¾“å‡ºå‘é‡çš„ç»´åº¦å–å€¼ç©ºé—´ä¸º $[-1.0, 1.0]$ï¼Œå¦‚æœç®€å•ç²—æš´åœ°å››èˆäº”å…¥å¤„ç†ï¼Œé‚£ä¹ˆ 0.123 å’Œ 0.321 è¿™ä¸¤ä¸ªä¸åŒçš„å‘é‡ç»´åº¦å–å€¼éƒ½ä¼šå‘ä¸‹å–æ•´åˆ° 0ã€‚æœ€ç»ˆï¼Œä¸€ä¸ªå‘é‡ä»…ä¼šä½¿ç”¨ $int8$ å¯ç”¨ 255 ä¸ªæ¡¶ä¸­çš„2ä¸ªæ¡¶ï¼Œè¿™æ ·å°±ä¸¢å¤±å¤ªå¤šä¿¡æ¯äº†ã€‚&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2025/06/05/92bnmVKzjqe3GOJ.jpg&apos; title=&apos;float32-to-int8-buckets.jpeg&apos; alt=&apos;float32-to-int8-buckets.jpeg&apos; width=&apos;500&apos;/&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;å›¾1ï¼šé‡åŒ–ç›®æ ‡å›¾è§£ - å°† -1.0 åˆ° 1.0 ä¹‹é—´çš„è¿ç»­å€¼åˆ†æ¡¶åˆ°ç¦»æ•£çš„ $int8$ æ•°å€¼ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ç§æ•°å€¼è½¬æ¢èƒŒåçš„æ•°å­¦åŸç†å¹¶ä¸å¤ªå¤æ‚ã€‚æˆ‘ä»¬å¯ä»¥å…ˆè®¡ç®—æµ®ç‚¹æ•°å–å€¼åŒºé—´çš„æœ€å°å’Œæœ€å¤§å€¼ï¼Œç„¶åä½¿ç”¨ &lt;a href=&apos;https://en.wikipedia.org/wiki/Feature_scaling#Rescaling_(min-max_normalization&apos;&gt;æœ€å°-æœ€å¤§å½’ä¸€åŒ–&lt;/a&gt;) å¯¹å€¼è¿›è¡Œçº¿æ€§å˜æ¢ï¼ˆlinearly shiftï¼‰ã€‚&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$int8\approx \frac{127}{max-min} \  \times \left( float32-min \right)$$&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$float32\approx \frac{max-min}{127} \times int8+min$$&lt;/p&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;å›¾2ï¼š$int8$ å’Œ $float32$ ä¹‹é—´çš„å˜æ¢å…¬å¼ã€‚æ³¨æ„ï¼šè¿™ä¸¤ä¸ªå˜æ¢æ˜¯æœ‰æŸçš„ï¼Œå¹¶ä¸æ˜¯ç²¾ç¡®å˜æ¢ã€‚ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œä»…ä½¿ç”¨ $int8$ å–å€¼ç©ºé—´çš„æ­£æ•°éƒ¨åˆ†ã€‚Lucene çš„å®ç°ä¹Ÿæ˜¯è¿™æ ·çš„ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;h2&gt;æ ‡é‡é‡åŒ–çš„ç»Ÿè®¡è§†è§’&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;a href=&apos;https://en.wikipedia.org/wiki/Quantile&apos;&gt;åˆ†ä½ç‚¹ï¼ˆquantileï¼‰&lt;/a&gt; æ˜¯æŒ‡æ•°å€¼åˆ†å¸ƒçš„ä¸€ä¸ªåˆ‡ç‰‡ï¼Œè¿™ä¸ªåˆ‡ç‰‡åŒ…å«ä¸€å®šæ•°é‡æ¯”ä¾‹çš„å€¼ã€‚ä¾‹å¦‚ï¼šä¸€ç§æµ®ç‚¹æ•°å–å€¼åˆ†å¸ƒä¸‹ 99% çš„å€¼è½åœ¨ $[-0.75, 0.86]$ è¿™ä¸ªåˆ†ä½ç‚¹åŒºé—´å†…ï¼Œå°äº $-0.75$ å’Œå¤§äº $0.86$ çš„å€¼éƒ½è¢«è§†ä¸ºç¦»ç¾¤å€¼/å¼‚å¸¸å€¼ï¼ˆoutliersï¼‰ï¼Œå› æ­¤å°† $-0.75$ å’Œ $0.86$ åˆ†åˆ«è§†ä¸ºå®é™…çš„æœ€å°å€¼å’Œæœ€å¤§å€¼ã€‚å¦‚æœé‡åŒ–æ—¶å°†ç¦»ç¾¤å€¼åŒ…å«åœ¨å†…ï¼Œå°±æ„å‘³ç€é‚£äº›æœ€å¸¸è§çš„å€¼å¯ç”¨çš„æ¡¶åå°‘äº†ï¼Œå¯ç”¨æ¡¶å°‘äº†ä¹Ÿå°±æ„å‘³ç€ç²¾åº¦æ›´å·®ï¼Œä¿¡æ¯æŸå¤±æ›´å¤šã€‚&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/19/PhYvL58SluIskbe.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;500&apos;/&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;å›¾3:å›¾è§£ 99%  &lt;a href=&apos;https://en.wikipedia.org/wiki/Confidence_interval&apos;&gt;ç½®ä¿¡åŒºé—´(confidence interval)&lt;/a&gt;åŠå¯¹åº”çš„åˆ†ä½ç‚¹æ•°å€¼ï¼Œå³ 99% çš„å€¼è½åœ¨ $[-0.75, 0.86]$ è¿™ä¸ªèŒƒå›´å†…ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸é”™ï¼Œæˆ‘ä»¬ç°åœ¨çŸ¥é“å¦‚ä½•å¯¹æµ®ç‚¹å€¼è¿›è¡Œé‡åŒ–äº†ï¼Œé‚£ä¹ˆåˆåº”è¯¥å¦‚ä½•è®¡ç®—ä¸¤ä¸ªé‡åŒ–åå‘é‡çš„è·ç¦»å‘¢ï¼Ÿå°±åƒå¸¸è§„çš„&lt;a href=&apos;https://en.wikipedia.org/wiki/Dot_product&apos;&gt;ç‚¹ç§¯&lt;/a&gt;è®¡ç®—ä¸€æ ·ç®€å•å—ï¼Ÿ&lt;/p&gt;
&lt;h2&gt;æ ‡é‡é‡åŒ–çš„ä»£æ•°è§†è§’&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç›®å‰ä¸ºæ­¢ä»ç„¶ç¼ºå¤±å…³é”®çš„ä¸€å—æ‹¼å›¾ - å¦‚ä½•è®¡ç®—ä¸¤ä¸ªé‡åŒ–åå‘é‡ä¹‹é—´çš„è·ç¦»ã€‚æœ¬æ–‡å¹¶æ²¡æœ‰æœ‰æ„é¿å¼€æ•°å­¦å…¬å¼ï¼Œä¸‹é¢ä¹Ÿä¼šå‡ºç°æ›´å¤šæ•°å­¦å†…å®¹ã€‚æ‹¿å‡ºä½ çš„é“…ç¬”ï¼Œå›å¿†ä¸€ä¸‹&lt;a href=&apos;https://en.wikipedia.org/wiki/Polynomial&apos;&gt;å¤šé¡¹å¼&lt;/a&gt; å’ŒåŸºç¡€ä»£æ•°ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;a href=&apos;https://en.wikipedia.org/wiki/Dot_product&apos;&gt;ç‚¹ç§¯&lt;/a&gt;å’Œ&lt;a href=&apos;https://en.wikipedia.org/wiki/Cosine_similarity&apos;&gt;ä½™å¼¦ç›¸ä¼¼åº¦&lt;/a&gt;çš„è®¡ç®—é€»è¾‘æ˜¯å°†ä¸¤ä¸ªå‘é‡å¯¹åº”ç»´åº¦ä¸Šçš„æµ®ç‚¹å€¼ç›¸ä¹˜ï¼Œç„¶åå°†æ‰€æœ‰ç»´åº¦ä¸Šçš„ç»“æœç›¸åŠ ã€‚æˆ‘ä»¬å·²ç»çŸ¥é“å¦‚ä½•åœ¨ $float32$ å’Œ $int8$ å€¼ä¹‹é—´åšå˜æ¢ï¼Œé‚£ä¹ˆåº”ç”¨å˜æ¢åçš„ä¹˜æ³•å…¬å¼æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$float32_{i}\times float32_{i}^{\prime}\approx \left( \frac{max-min}{127} \times int8_{i}+min \right) \times \left( \frac{max-min}{127} \times int8_{i}^{\prime}+min \right)$$&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å°†è¿™ä¸ªä¹˜æ³•å…¬å¼å±•å¼€åï¼ˆä¸ºäº†ç®€åŒ–ï¼Œä»¥ $\alpha$ æ›¿ä»£ $\frac{max-min}{127}$ï¼‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$\alpha^{2} \times int8_{i}\times int8_{i}^{\prime}+\alpha \times int8_{i}\times min+\alpha \times int8_{i}^{\prime}\times min+min^{2}$$&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ¥ä¸‹æ¥å°±æ›´æœ‰æ„æ€äº† - è¿™ä¸ªç®—å¼ä¸­ä»…æœ‰ä¸€ä¸ªéƒ¨åˆ†è¦æ±‚åŒæ—¶æä¾›ä¸¤ä¸ªå˜é‡å€¼ã€‚ç„¶è€Œï¼Œç‚¹ç§¯å¹¶ä¸åªæ˜¯ä¸¤ä¸ªæµ®ç‚¹æ•°ç›¸ä¹˜ï¼Œè€Œæ˜¯ä¸¤ä¸ªå‘é‡çš„æ¯ä¸€ç»´å¯¹åº”çš„æµ®ç‚¹å€¼ç›¸ä¹˜ã€‚å‡è®¾å‘é‡çš„ç»´åº¦ä¸º $dim$ï¼Œé‚£ä¹ˆä»¥ä¸‹éƒ¨åˆ†ç®—å¼éƒ½å¯ä»¥æå‰è®¡ç®—å¥½å­˜ä¸‹æ¥ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;$dim\times \alpha^{2}$ å³ $dim\times \left( \frac{max-min}{127} \right)^{2}$ ï¼Œå¯ä»¥æå‰è®¡ç®—å¥½å­˜ä¸ºå•ä¸ªæµ®ç‚¹æ•°ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;$\sum_{i=0}^{dim-1} min\times \alpha \times int8_{i}$ å’Œ $\sum_{i=0}^{dim-1} min\times \alpha \times int8_{i}^{\prime}$ éƒ½å¯ä»¥åˆ†åˆ«æå‰è®¡ç®—å¥½å­˜ä¸ºå•ä¸ªæµ®ç‚¹æ•°ï¼Œæˆ–è€…åœ¨æ£€ç´¢æ—¶è®¡ç®—ä¸€æ¬¡ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;$dim\times min^{2}$ ä¹Ÿå¯ä»¥æå‰è®¡ç®—å¥½å­˜ä¸ºå•ä¸ªæµ®ç‚¹æ•°ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é‚£ä¹ˆï¼š&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$dim\times \alpha^{2} \times dotProduct\left( int8,int8^{\prime} \right) +\sum_{i=0}^{dim-1} min\times \alpha \times int8_{i}+\sum_{i=0}^{dim-1} min\times \alpha \times int8_{i}^{\prime}+dim\times min^{2}$$&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç‚¹ç§¯çš„æ•´ä¸ªç®—å¼ä¸­ä»… $dotProduct\left( int8,int8^{\prime} \right)$ éƒ¨åˆ†éœ€è¦åœ¨æ£€ç´¢æ—¶è®¡ç®—ï¼ŒåŠ ä¸Šå…¶ä»–æå‰è®¡ç®—å¥½çš„éƒ¨åˆ†å°±èƒ½å¾—åˆ°ç»“æœã€‚&lt;/p&gt;
&lt;h2&gt;é‡åŒ–çš„ç²¾åº¦ä¿è¯&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é‚£ä¹ˆï¼Œè¿™æ ·é‡åŒ–è®¡ç®—çš„å‡†ç¡®æ€§å¦‚ä½•ï¼Ÿé‡åŒ–åæŸå¤±ä¿¡æ¯æ²¡æœ‰ï¼Ÿæ˜¯çš„ï¼ŒæŸå¤±äº†ä¸€äº›ä¿¡æ¯ï¼Œä¸è¿‡é‡åŒ–æ­£æ˜¯åŸºäºæˆ‘ä»¬äº‹å®ä¸Šå¹¶ä¸éœ€è¦æ‰€æœ‰ä¿¡æ¯çš„å‡è®¾ã€‚å¯¹äºè®­ç»ƒå¾—åˆ°çš„åµŒå…¥æ¨¡å‹ï¼Œå‘é‡å„ä¸ªç»´åº¦çš„å€¼åˆ†å¸ƒé€šå¸¸ä¸å­˜åœ¨&lt;a href=&apos;https://en.wikipedia.org/wiki/Fat-tailed_distribution&apos;&gt;åšå°¾æ€§(fat-tails)&lt;/a&gt;ã€‚è¿™æ„å‘³ç€å€¼åˆ†å¸ƒå­˜åœ¨ä¸€å®šçš„å±€éƒ¨æ€§å’Œä¸€è‡´æ€§ã€‚æ­¤å¤–ï¼Œé‡åŒ–å¯¹æ¯ä¸€ç»´åº¦å¼•å…¥çš„è¯¯å·®æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œè¿™æ„å‘³ç€å¯¹äºå‘é‡çš„å…¸å‹è¿ç®—ï¼ˆæ¯”å¦‚ç‚¹ç§¯ï¼‰ï¼Œè¯¯å·®ä¸€å®šç¨‹åºä¸Šä¼šæŠµæ¶ˆã€‚&lt;/p&gt;
&lt;h2&gt;æ€»ç»“&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å“Ÿï¼Œä¸€å†™å°±å†™äº†ä¸€å †å†…å®¹ã€‚ç°åœ¨ä½ åº”è¯¥å¾ˆå¥½åœ°ç†è§£äº†é‡åŒ–çš„æŠ€æœ¯ä¼˜åŠ¿ï¼Œå…¶èƒŒåçš„æ•°å­¦åŸç†ï¼Œä»¥åŠå¦‚ä½•å°†çº¿æ€§å˜æ¢è€ƒè™‘åœ¨å†…è®¡ç®—å‘é‡ä¹‹é—´çš„è·ç¦»ã€‚&lt;/p&gt;</description>
            <pubDate>2025-01-13</pubDate>
            <link>https://blog.xiayf.cn/posts/scalar-quantization-101.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/scalar-quantization-101.html</guid>
        </item>
        
        <item>
            <title>k-NN ä¹˜ç§¯é‡åŒ–å™¨æ•™ç¨‹-ç¬¬2éƒ¨åˆ†ï¼ˆè¯‘ï¼‰</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;&lt;a href=&apos;http://mccormickml.com/2017/10/13/product-quantizer-tutorial-part-1/&apos;&gt;æœ¬æ•™ç¨‹çš„ç¬¬1éƒ¨åˆ†&lt;/a&gt; è®²è§£äº†ä¹˜ç§¯é‡åŒ–å™¨çš„æœ€åŸºç¡€å½¢å¼ã€‚æœ¬æ–‡å°†è®²è§£ &lt;a href=&apos;https://github.com/facebookresearch/faiss/wiki/Getting-started-tutorial&apos;&gt;FAISS åº“çš„ IndexIVFPQ ç´¢å¼•&lt;/a&gt;ï¼Œè¯¥ç´¢å¼•ç±»å‹ä½¿ç”¨ä¸€ä¸ªä¹˜ç§¯é‡åŒ–å™¨ä»¥åŠ &lt;a href=&apos;https://lear.inrialpes.fr/pubs/2011/JDS11/jegou_searching_with_quantization.pdf&apos;&gt;2011 å¹´å‘è¡¨çš„è¿™ç¯‡è®ºæ–‡&lt;/a&gt;ä»‹ç»çš„ä¸€äº›é¢å¤–çš„æŠ€æœ¯ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸‹é¢å…ˆç®€è¦ä»‹ç»ä¸€ä¸‹è¯¥ç´¢å¼•å¼•å…¥çš„ä¸¤ä¸ªç‰¹æ€§ï¼Œä¹‹åä¼šå†è¯¦ç»†è§£é‡Šã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;em&gt;å€’æ’æ–‡ä»¶ç´¢å¼•ï¼ˆIVFï¼‰&lt;/em&gt;  - IVF å°±æ˜¯ä¸€ç§æ•°æ®é›†é¢„è¿‡æ»¤çš„æŠ€æœ¯ï¼Œé¿å…å¯¹æ‰€æœ‰å‘é‡è¿›è¡Œç©·ä¸¾æœç´¢ã€‚å®ƒçš„åŸç†ç›¸å½“ç›´è§‚ - ä½¿ç”¨ k-means èšç±»ç®—æ³•æå‰å°†æ•°æ®é›†èšç±»æˆä¸€å®šæ•°é‡çš„æ•°æ®é›†åˆ†åŒºï¼Œç„¶ååœ¨æ£€ç´¢æ—¶ï¼Œå…ˆå°†æŸ¥è¯¢å‘é‡ä¸æ¯ä¸ªåˆ†åŒºçš„è´¨å¿ƒåšæ¯”è¾ƒï¼Œæ‰¾åˆ°æœ€è¿‘çš„è‹¥å¹²ä¸ªèšç±»ï¼Œç„¶ååªåœ¨è¿™äº›èšç±»åˆ†åŒºå†…åšå‘é‡æœç´¢ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;em&gt;æ®‹å·®ç¼–ç &lt;/em&gt; - è¿™æ˜¯å¯¹ä¹˜ç§¯é‡åŒ–å™¨åŸºç¡€å½¢å¼çš„ä¸€ç§å¢å¼ºæ–¹å¼ - åŠ å…¥ IVF æ­¥éª¤çš„ä¸€äº›ä¿¡æ¯ã€‚å¯¹äºæ¯ä¸ªæ•°æ®åº“å‘é‡ï¼Œä¸å†ä½¿ç”¨ PQ ç¼–ç åŸå§‹çš„æ•°æ®åº“å‘é‡ï¼Œè€Œæ˜¯å¯¹å‘é‡ç›¸å¯¹äºæ‰€å±åˆ†åŒºçš„è´¨å¿ƒçš„åç§»é‡ï¼ˆoffsetï¼‰è¿›è¡Œç¼–ç ã€‚åç»­ç« èŠ‚ä¼šè§£é‡Šå…¶åŸç†å’Œæ”¶ç›Šã€‚&lt;/p&gt;
&lt;h2&gt;å€’æ’æ–‡ä»¶ç´¢å¼•ï¼ˆInverted File Indexï¼‰&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è®¡ç®—æœºç§‘å­¦é¢†åŸŸï¼Œç‰¹åˆ«æ˜¯ä¿¡æ¯æ£€ç´¢é¢†åŸŸï¼Œä¸€ä¸ªâ€œå€’æ’ç´¢å¼•â€æ˜¯æŒ‡å°†è¯æ±‡è¡¨ä¸­çš„æ¯ä¸ªå•è¯æ˜ å°„åˆ°æ•°æ®åº“ä¸­æ‰€æœ‰æ–‡æ¡£ä¸­è¯¥å•è¯å‡ºç°çš„æ‰€æœ‰ä½ç½®ï¼Œå®ƒéå¸¸ç±»ä¼¼äºè¯¾æœ¬ä¸­åé¢çš„ç´¢å¼•è¡¨ - å°†å•è¯æˆ–æ¦‚å¿µæ˜ å°„åˆ°é¡µå·ï¼Œæ‰€ä»¥å¤§å®¶å°†è¿™ç§æ•°æ®ç»“æ„ç§°ä¸ºâ€œå€’æ’ç´¢å¼•â€è®©æˆ‘æœ‰äº›å›°æ‰°ï¼ˆå› ä¸ºäºæˆ‘è€Œè¨€å®ƒå°±æ˜¯ä¸€ç§æ™®é€šçš„ç´¢å¼•ï¼ï¼‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸ç®¡æ€æ ·ï¼Œåœ¨å½“å‰ä¸Šä¸‹æ–‡ä¸­ï¼Œè¿™ä¸ªæŠ€æœ¯å®é™…å°±æ˜¯ä½¿ç”¨ k-means èšç±»å¯¹æ•°æ®é›†åšåˆ†å‰²ï¼Œè¿™æ ·å°±å¯ä»¥ä»…å¯¹éƒ¨åˆ†åˆ†åŒºåšæœç´¢è€Œå¿½ç•¥å…¶ä½™çš„ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ„å»ºç´¢å¼•æ—¶ï¼Œä½¿ç”¨ k-means èšç±»ç®—æ³•å°†æ•°æ®é›†èšç±»æˆä¸€å®šæ•°é‡çš„åˆ†åŒºã€‚æ•°æ®é›†ä¸­æ¯ä¸ªå‘é‡ä»…ä¼šè¢«å½’å±åˆ°ä¸€ä¸ªèšç±»/åˆ†åŒºä¸­ã€‚æ¯ä¸ªåˆ†åŒºåŒ…å«å½’å±äºå®ƒçš„ä¸€ç»„å‘é‡ï¼ˆä¹Ÿå°±æ˜¯ FAISS ä½œè€…è¯´çš„â€œå€’æ’æ–‡ä»¶åˆ—è¡¨â€ï¼‰ã€‚ä¹Ÿç”±æ­¤å¾—åˆ°æ‰€æœ‰åˆ†åŒºçš„è´¨å¿ƒç»„æˆçš„ä¸€ä¸ªçŸ©é˜µï¼Œç”¨äºè®¡ç®—åº”è¯¥å¯¹å“ªäº›åˆ†åŒºè¿›è¡Œæœç´¢ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æŒ‰ç…§è¿™ç§æ–¹å¼å¯¹æ•°æ®é›†è¿›è¡Œåˆ†å‰²ï¼Œå¹¶ä¸å®Œç¾ï¼Œå› ä¸ºå¦‚æœä¸€ä¸ªæŸ¥è¯¢å‘é‡å®é™…ä½äºæœ€è¿‘èšç±»çš„è¾¹ç¼˜ä½ç½®ï¼Œé‚£ä¹ˆæŸ¥è¯¢å‘é‡çš„æœ€è¿‘é‚»å±…å¯èƒ½å®é™…ä½äºå¤šä¸ªé™„è¿‘çš„èšç±»ä¸­ã€‚è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆæ˜¯ç®€å•åœ°å¤šæœç´¢å‡ ä¸ªåˆ†åŒºã€‚æœç´¢å¤šä¸ªé™„è¿‘çš„åˆ†åŒºæ˜¾ç„¶ä¼šå ç”¨æ›´å¤šçš„æ£€ç´¢æ—¶é—´ï¼Œä½†æ˜¯å‡†ç¡®æ€§ä¹Ÿä¼šæ›´å¥½ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœç´¢çš„æ—¶å€™ï¼Œå°†æŸ¥è¯¢å‘é‡ä¸æ‰€æœ‰åˆ†åŒºçš„è´¨å¿ƒåšæ¯”è¾ƒï¼Œæ‰¾åˆ°æœ€è¿‘çš„è‹¥å¹²ä¸ªåˆ†åŒºè´¨å¿ƒï¼Œå®é™…çš„æ•°é‡å¯ä»¥é…ç½®ã€‚ä¸€æ—¦æ‰¾åˆ°äº†æœ€è¿‘çš„è‹¥å¹²ä¸ªåˆ†åŒºè´¨å¿ƒï¼Œå°±å¯ä»¥ä»…å¯¹è¿™äº›åˆ†åŒºçš„æ•°æ®åº“å‘é‡ä½¿ç”¨ä¹˜ç§¯é‡åŒ–å™¨åš k-NN æœç´¢ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ³¨æ„è¯¥ç´¢å¼•ç±»å‹ä¸­ä½¿ç”¨çš„å¦‚ä¸‹æœ¯è¯­ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;â€œprobeï¼ˆæœå¯»ï¼‰â€ è¿™ä¸ªåŠ¨è¯ï¼Œåœ¨å½“å‰ä¸Šä¸‹æ–‡ä¸­ï¼Œæ˜¯æŒ‡é€‰å®šå¾…æœç´¢çš„ç›®æ ‡åˆ†åŒºã€‚å› æ­¤åœ¨ä»£ç ä¸­ä½ ä¼šçœ‹åˆ°ç´¢å¼•å‚æ•°â€œnprobeâ€ - æ„æ€å°±æ˜¯â€œå¾…æœå¯»çš„åˆ†åŒºæ•°é‡â€ã€‚&lt;/li&gt;
&lt;li&gt;FAISS çš„ä½œè€…ä»¬å–œæ¬¢ä½¿ç”¨â€œVoronoi å•å…ƒï¼ˆcellsï¼‰â€è¿™ä¸ªè¯è¯­ï¼Œè€Œä¸æ˜¯æˆ‘åœ¨æœ¬æ–‡ä¸­ä½¿ç”¨çš„â€œæ•°æ®é›†åˆ†åŒºï¼ˆdataset partitionsï¼‰â€ã€‚ä¸€ä¸ª Voronoi å•å…ƒå°±æ˜¯å±äºä¸€ä¸ªèšç±»çš„ç©ºé—´åŒºåŸŸï¼Œä¹Ÿå°±æ˜¯ï¼Œè¿™ä¸ªç©ºé—´åŒºåŸŸæ¶µç›–äº†å¯¹åº”èšç±»çš„æ‰€æœ‰ç‚¹ï¼Œè¿™äº›ç‚¹çš„å‘é‡ä¸è¿™ä¸ªèšç±»çš„è´¨å¿ƒçš„è·ç¦»ï¼Œæ¯”å…¶ä»–èšç±»çš„è´¨å¿ƒéƒ½è¦è¿‘ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;h2&gt;æ®‹å·®ç¼–ç ï¼ˆEncoding Residualsï¼‰&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸ªç‰¹æ€§ä¹Ÿæ˜¯ç›¸å¯¹æ¯”è¾ƒç›´è§‚çš„ï¼Œä¸è¿‡å¦‚æœä½ æ²¡æœ‰ç†è§£çš„è¯å¯èƒ½ä¼šè§‰å¾—æœ‰ç‚¹å¥‡æ€ªã€‚å…¶æƒ³æ³•æ˜¯å°† IVF é˜¶æ®µçš„ä¸€äº›ä¿¡æ¯åŠ å…¥åˆ°ä¹˜ç§¯é‡åŒ–å™¨ä¸­ï¼Œå€Ÿæ­¤æå‡å‡†ç¡®æ€§ï¼ˆå› æ­¤è¿™ä¸ªæ¦‚å¿µæ˜¯å»ºç«‹åœ¨æ•°æ®é›†åˆ†åŒºæŠ€æœ¯ä¹‹ä¸Šçš„ï¼‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å…ˆå®šä¹‰ä¸€ä¸‹ä»€ä¹ˆæ˜¯â€œæ®‹å·®â€å‘é‡ã€‚æš‚æ—¶æŠ›å¼€ä¹˜ç§¯é‡åŒ–å™¨ä¸è°ˆï¼ˆå› ä¸ºå®ƒä¼šå¢å¤§ç†è§£çš„å›°éš¾ï¼Œåé¢æˆ‘ä»¬å†æŠŠå®ƒåŠ å›æ¥ï¼‰ã€‚å‡è®¾æˆ‘ä»¬è¦åšæ ‡å‡†çš„æš´åŠ› k-NN æœç´¢ï¼Œä¸è¿‡æ˜¯ç”¨æ•°æ®é›†åˆ†åŒºæŠ€æœ¯æ¥å‰Šå‡å¾…æœç´¢å‘é‡çš„æ•°é‡ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å‡è®¾æˆ‘ä»¬æ˜¯ç”¨ k-means å°†æ•°æ®é›†èšç±»æˆ 100 ä¸ªèšç±»ï¼ˆæˆ–è€…å«â€œæ•°æ®é›†åˆ†åŒºâ€ï¼‰ã€‚ç»™å®šæ•°æ®é›†ä¸­çš„ä¸€ä¸ªå‘é‡ï¼Œå…¶æ®‹å·®å³æ˜¯å®ƒç›¸å¯¹äºæ‰€å±åˆ†åŒºçš„è´¨å¿ƒçš„åç§»ï¼ˆoffsetï¼‰ã€‚ä¹Ÿå°±æ˜¯ï¼Œå°†æ•°æ®é›†ä¸­çš„è¿™ä¸ªå‘é‡ä¸å…¶æ‰€å±èšç±»çš„è´¨å¿ƒçš„å‘é‡ç›¸å‡ã€‚è´¨å¿ƒå³æ˜¯èšç±»çš„å‡å€¼ï¼Œé‚£ä¹ˆå¯¹ä¸€ç»„ç‚¹å‡å‡å»å®ƒä»¬çš„å‡å€¼ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿç°åœ¨è¿™äº›ç‚¹å°±å›´ç»•ç€ 0 ç‚¹äº†ã€‚å¦‚ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„äºŒç»´ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/VJ7siPxgmBhNvFA.png&apos; title=&apos;residuals_one_partition.png&apos; alt=&apos;residuals_one_partition.png&apos; width=&apos;800&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¼€å§‹æœ‰è¶£èµ·æ¥äº†ã€‚å‡è®¾å°†ä¸€ä¸ªæ•°æ®é›†åˆ†åŒºä¸­çš„æ‰€æœ‰å‘é‡éƒ½æ›¿æ¢ä¸ºå„è‡ªçš„æ®‹å·®å‘é‡ï¼Œæ€ä¹ˆä»è¿™ä¸ªæ•°æ®é›†åˆ†åŒºä¸­æ‰¾åˆ°æŸ¥è¯¢å‘é‡çš„æœ€è¿‘é‚»ï¼Ÿå…ˆè®¡ç®—æŸ¥è¯¢å‘é‡çš„æ®‹å·®ï¼ˆç›¸å¯¹äºåˆ†åŒºè´¨å¿ƒçš„åç§»ï¼‰ï¼Œç„¶åå¯¹è¿™ä¸ªæ•°æ®é›†åˆ†åŒºçš„æ‰€æœ‰æ®‹å·®å‘é‡åšæœ€è¿‘é‚»æœç´¢ï¼Œå¾—åˆ°çš„ç»“æœä¸ä½¿ç”¨åŸå§‹å‘é‡åšæœç´¢æ˜¯ä¸€æ ·çš„ï¼&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åŸºäºä¸Šé¢çš„å›¾ç¤ºï¼Œå‡­ç›´è§‰å¯èƒ½å°±èƒ½ç†è§£ï¼Œä¸è¿‡è¿˜æ˜¯å†çœ‹çœ‹ä¸‹é¢çš„ç­‰å¼åŠ æ·±ç†è§£ã€‚&apos;x&apos; å’Œ &apos;y&apos; è¿™ä¸¤ä¸ªå‘é‡çš„é•¿åº¦ä¸º &apos;n&apos;ï¼Œå®ƒä»¬çš„ L2 è·ç¦»è®¡ç®—å…¬å¼ä¸ºï¼š&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$dist_{L2}\left( x,y \right) =\sqrt{\sum_{i}^{n} \left( x_{i}-y_{i} \right)^{2}}$$&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœå¯¹ &apos;x&apos; å’Œ &apos;y&apos; éƒ½å‡å»è´¨å¿ƒå‘é‡ &apos;c&apos;ï¼Œçœ‹èµ·æ¥æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ&lt;/p&gt;
&lt;p style=&quot;text-align: center&quot;&gt;$$dist_{L2}\left( x-c,y-c \right) =\sqrt{\sum_{i}^{n} \left( (x_{i}-c_{i})-(y_{i}-c_{i}) \right)^{2}} =\sqrt{\sum_{i}^{n} \left( x_{i}-y_{i} \right)^{2}}$$&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è´¨å¿ƒéƒ¨åˆ†è¢«æŠµæ¶ˆæ‰äº†ï¼&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ³¨æ„ä½¿ç”¨æ®‹å·®è®¡ç®—å‡ºæ¥çš„è·ç¦»ä¸åªæ˜¯ç›¸å¯¹è€Œè¨€ï¼ˆæ¯”å¦‚è·ç¦»çš„åºï¼‰æ˜¯ç›¸ç­‰çš„ï¼Œå¹¶ä¸”ç¡®å®æ˜¯æ­£ç¡®åœ°è®¡ç®—å‡ºäº†å‘é‡ä¹‹é—´çš„ L2 è·ç¦»ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯èƒ½ä½ ä¹‹å‰å°±ä½¿ç”¨è¿‡è¿™ç§ç­‰ä»·å…³ç³»ï¼Œå‡å€¼å½’ä¸€åŒ–ï¼ˆå¯¹å‘é‡å‡å»å‡å€¼ï¼‰æ˜¯ä¸€ç§å¸¸è§çš„é¢„å¤„ç†æŠ€æœ¯ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸è¿‡ç›®å‰ä¸ºæ­¢è¯´çš„éƒ½æ˜¯å•ä¸ªåˆ†åŒºå†…çš„è®¡ç®—ã€‚å°†ä¸åŒåˆ†åŒºå†…çš„å‘é‡åšæ¯”è¾ƒåˆä¼šæ˜¯ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿä»ç„¶ç®¡ç”¨ï¼Œåªè¦é’ˆå¯¹æ¯ä¸ªåˆ†åŒºåˆ†åˆ«è®¡ç®—æŸ¥è¯¢å‘é‡çš„æ®‹å·®å³å¯ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸‹é¢è¿™ä¸ªå›¾è§£ä¸­åŒ…å«ä¸¤ä¸ªæ•°æ®é›†åˆ†åŒºã€‚è®¡ç®—æ®‹å·®ä¹‹åï¼Œä¸¤ä¸ªåˆ†åŒºçš„æ‰€æœ‰ç‚¹éƒ½å›´ç»•åœ¨ 0 ç‚¹å‘¨å›´äº†ã€‚ä¸è¿‡ç°åœ¨æ˜¯æœ‰ä¸¤ä¸ªæŸ¥è¯¢å‘é‡çš„æ®‹å·® - ä¸€ä¸ªæ˜¯ä¸è“è‰²ç‚¹é›†ï¼ˆåˆ†åŒº 1ï¼‰æ¯”è¾ƒå¾—åˆ°çš„ï¼Œå¦ä¸€ä¸ªæ˜¯ä¸ç»¿è‰²ç‚¹é›†ï¼ˆåˆ†åŒº 2ï¼‰æ¯”è¾ƒå¾—åˆ°çš„ã€‚&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/iLmu5s84ZvGQUo9.png&apos; title=&apos;residuals_two_partitions.png&apos; alt=&apos;residuals_two_partitions.png&apos; width=&apos;800&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å‰é¢è§£é‡Šè¿‡æŸ¥è¯¢å‘é‡å’Œæ•°æ®åº“å‘é‡ä¹‹é—´çš„è·ç¦»ï¼Œä½¿ç”¨åŸå§‹å‘é‡è®¡ç®—å’Œä½¿ç”¨æ®‹å·®å‘é‡è®¡ç®—ï¼Œç»“æœæ˜¯ä¸€æ ·çš„ï¼Œè¿˜è®°å¾—å§ï¼Ÿ&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¾ˆæœ‰æ„æ€ï¼Œä¸è¿‡ç›®å‰ä¸ºæ­¢è¿˜æ˜¯æ— ç”¨åŠŸ - å°šæœªæ”¹å˜ç»“æœçš„å‡†ç¡®æ€§ä¹Ÿæ²¡æœ‰å‡å°‘è®¡ç®—æˆæœ¬ã€‚ç°åœ¨å°† PQ é‡æ–°æ”¾è¿›æ¥ä¸€èµ·è€ƒè™‘ï¼Œå°±ä¼šå‘ç°å¥½å¤„åœ¨å“ªäº†ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨è®­ç»ƒä¹˜ç§¯é‡åŒ–å™¨ä¹‹å‰ï¼Œå…ˆè®¡ç®—æ•°æ®é›†æ‰€æœ‰åˆ†åŒºæ‰€æœ‰å‘é‡çš„æ®‹å·®å‘é‡ã€‚æ®‹å·®å‘é‡é›†åˆä¿æŒåŸæœ‰åˆ†åŒºï¼ˆä¸ä¼šåˆå¹¶åœ¨ä¸€èµ·ï¼‰ï¼Œä¸è¿‡ç°åœ¨æ‰€æœ‰æ®‹å·®å‘é‡éƒ½å›´ç»•ç€ 0 ç‚¹ï¼Œç›¸å¯¹ç´§å‡‘åœ°èšé›†åœ¨ä¸€èµ·ã€‚æˆ‘ä»¬æŠ›å¼ƒæ‰åŸå§‹çš„æ•°æ®é›†å‘é‡ï¼Œåªå­˜å‚¨æ®‹å·®å‘é‡é›†ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨æ‰€æœ‰è¿™äº›æ®‹å·®å‘é‡ä¹‹ä¸Šè®­ç»ƒä¹ å¾—ä¸€ä¸ªä¹˜ç§¯é‡åŒ–å™¨ï¼Œä¸å†ä½¿ç”¨åŸå§‹å‘é‡ã€‚é‚£æœ‰ä»€ä¹ˆä¸åŒä¹‹å¤„å—ï¼Ÿå›æƒ³ä¸€ä¸‹ï¼šä¹˜ç§¯é‡åŒ–å™¨çš„è®­ç»ƒè¿‡ç¨‹æ˜¯å…ˆå°†å‘é‡åˆ†å‰²æˆå­å‘é‡ï¼Œåœ¨æ¯éƒ¨åˆ†å­å‘é‡ä¹‹ä¸Šè¿›è¡Œ k-means èšç±»ï¼Œå­¦ä¹ åˆ°ä¸€ç»„åŸå‹/è´¨å¿ƒï¼ˆæˆ–è€…å«â€œç æœ¬â€ï¼‰ç”¨äºè¡¨å¾æ‰€æœ‰å‘é‡ã€‚ä½¿ç”¨å¯¹åº”çš„æ®‹å·®å‘é‡æ¥æ›¿æ¢åŸå§‹å‘é‡ï¼Œèƒ½å¤Ÿé™ä½æ•°æ®é›†ä¸­å‘é‡çš„å¤šæ ·æ€§ï¼ˆthe variety in the datasetï¼‰ï¼ˆè®ºæ–‡ä¸­ï¼Œå°†æ­¤æè¿°ä¸ºï¼šç›¸å¯¹äºåŸå§‹å‘é‡ï¼Œæ®‹å·®å‘é‡â€œåŒ…å«æ›´å°çš„èƒ½é‡ï¼ˆhave less energyï¼‰â€ï¼‰ã€‚ä¹‹å‰ï¼Œèšç±»å­˜åœ¨äºç©ºé—´çš„å„ä¸ªåŒºåŸŸï¼Œç°åœ¨èšç±»éƒ½å›´ç»•ç€ 0 ç‚¹ï¼Œå¹¶ä¸”ç›¸äº’ä¹‹é—´è¿˜å­˜åœ¨éƒ¨åˆ†é‡åˆã€‚é™ä½äº†æ•°æ®é›†ä¸­å‘é‡çš„å¤šæ ·æ€§ï¼Œå°±å¯èƒ½ä½¿ç”¨æ›´å°‘çš„åŸå‹/è´¨å¿ƒï¼ˆæˆ–è€…è¯´â€œä»£ç â€ï¼‰æ¥æœ‰æ•ˆåœ°è¡¨å¾å‘é‡ï¼æˆ–è€…ï¼Œæ¢ä¸ªè§’åº¦æ¥è¯´ï¼ŒPQ ä¸­æ•°é‡æœ‰é™çš„ä»£ç ç°åœ¨æ›´åŠ å‡†ç¡®äº†ï¼Œå› ä¸ºè¿™äº›ä»£ç æ‰€è¦æè¿°çš„å‘é‡ï¼Œç›¸æ¯”ä¹‹å‰ï¼Œç›¸äº’ä¹‹é—´åŒºåˆ«æ›´å°äº†ï¼ˆless distinctï¼‰ã€‚æˆ‘ä»¬å¾—åˆ°äº†æ›´å¤šçš„å›æŠ¥ï¼ˆmore bang for our buckï¼‰ï¼&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸è¿‡ï¼Œä¹Ÿæ˜¯æœ‰ä»£ä»·çš„ã€‚å›æƒ³ä¸€ä¸‹ï¼šä¹˜ç§¯é‡åŒ–å™¨çš„é­”åŠ›åœ¨äºä»…éœ€è¦å°†æŸ¥è¯¢å‘é‡åˆ†å—ä¸ç æœ¬ä»£ç ä¹‹é—´çš„éƒ¨åˆ†è·ç¦»è®¡ç®—å‡ºæ¥å­˜ä¸ºä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒå°çš„è¡¨ - å‰©ä¸‹çš„æ“ä½œå°±æ˜¯æŸ¥è¡¨å’ŒåŠ æ³•ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç°åœ¨ï¼Œä½¿ç”¨æ®‹å·®å‘é‡ï¼Œå¯¹äºæ¯ä¸ªæ•°æ®é›†åˆ†åŒºè€Œè¨€ï¼ŒæŸ¥è¯¢å‘é‡éƒ½æ˜¯ä¸åŒçš„ - å¯¹äºæ¯ä¸ªæ•°æ®é›†åˆ†åŒºï¼ŒæŸ¥è¯¢å‘é‡å¯¹åº”çš„æ®‹å·®å‘é‡éƒ½éœ€è¦åŸºäºåˆ†åŒºçš„è´¨å¿ƒé‡æ–°è®¡ç®—ã€‚å› æ­¤ï¼Œå¯¹äºå¾…æœå¯»çš„æ¯ä¸ªåˆ†åŒºï¼Œéƒ½å¿…é¡»å•ç‹¬è®¡ç®—ä¸€ä¸ªè·ç¦»è¡¨ï¼&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸è¿‡ï¼Œè¿™ä¸ªå–èˆæ˜¾ç„¶æ˜¯å€¼å¾—çš„ï¼Œå®é™…åº”ç”¨ä¸­ï¼ŒIndexIVFPQ ç´¢å¼•çš„è¡¨ç°éƒ½å¾ˆä¸é”™ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å°±æ˜¯è¿™æ ·ã€‚è™½ç„¶æ•°æ®åº“å‘é‡éƒ½è¢«å„è‡ªçš„æ®‹å·®å‘é‡æ›¿ä»£äº†ï¼Œä¸è¿‡å¯¹äºä¹˜ç§¯é‡åŒ–å™¨æ¥è¯´ï¼Œæ²¡ä»€ä¹ˆä¸åŒã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ³¨æ„ï¼šæ•°æ®é›†åˆ†åŒºå¹¶ä¸ä¼šè€ƒè™‘ï¼ˆfactor in toï¼‰ç æœ¬è®­ç»ƒï¼Œæˆ‘ä»¬ä»ç„¶è·¨è¶Šåˆ†åŒºä½¿ç”¨æ‰€æœ‰æ•°æ®é›†å‘é‡ä¸ºæ¯éƒ¨åˆ†å­å‘é‡ä¹ å¾—ä¸€ä¸ªç æœ¬ã€‚ä½ ä¹Ÿå¯ä»¥ä¸ºæ¯ä¸ªæ•°æ®é›†åˆ†åŒºå•ç‹¬è®­ç»ƒä¸€ä¸ª PQï¼Œä¸è¿‡ FAISS åº“çš„ä½œè€…ä¸èµæˆè¿™æ ·åšï¼Œå› ä¸ºåˆ†åŒºçš„æ•°é‡é€šå¸¸æ¯”è¾ƒå¤§ï¼Œé‚£ä¹ˆå­˜å‚¨è¿™äº›ç æœ¬çš„å†…å­˜å¼€é”€ä¼šæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚æ‰€ä»¥ï¼Œè·¨åˆ†åŒºåœ¨æ‰€æœ‰æ•°æ®åº“å‘é‡ä¹‹ä¸Šè®­ç»ƒä¹ å¾—ä¸€ä¸ª PQ æ›´å¥½ä¸€äº›ã€‚&lt;/p&gt;</description>
            <pubDate>2025-01-10</pubDate>
            <link>https://blog.xiayf.cn/posts/product-quantizer-tutorial-part-2.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/product-quantizer-tutorial-part-2.html</guid>
        </item>
        
        <item>
            <title>k-NN ä¹˜ç§¯é‡åŒ–å™¨æ•™ç¨‹-ç¬¬1éƒ¨åˆ†ï¼ˆè¯‘ï¼‰</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;ä¹˜ç§¯é‡åŒ–å™¨æ˜¯ä¸€ç§â€œå‘é‡é‡åŒ–å™¨â€ï¼ˆåé¢æˆ‘ä¼šè§£é‡Šè¿™æ˜¯å•¥æ„æ€ï¼‰ï¼Œå¯ä»¥ç”¨äºåŠ é€Ÿè¿‘ä¼¼æœ€è¿‘é‚»æ£€ç´¢ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;2017å¹´3æœˆå‘å¸ƒçš„ &lt;a href=&apos;https://code.facebook.com/posts/1373769912645926/faiss-a-library-for-efficient-similarity-search/&apos;&gt;Facebook AI ç›¸ä¼¼æ€§æ£€ç´¢ï¼ˆFAISSï¼‰åº“&lt;/a&gt;ï¼Œé£é¡ä¸€æ—¶ï¼Œä¹˜ç§¯é‡åŒ–å™¨æ˜¯å…¶æ ¸å¿ƒç»„ä»¶ï¼Œå¸å¼•äº†å¾ˆå¤šäººå…³æ³¨ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ¬æ•™ç¨‹çš„ç¬¬ä¸€éƒ¨åˆ†å°†è§£é‡Šä¹˜ç§¯é‡åŒ–å™¨çš„æœ€åŸºç¡€å½¢å¼ï¼ŒANN æ£€ç´¢ä¸­é€šå¸¸æ˜¯è¿™æ ·å®ç°ã€‚ç¬¬äºŒéƒ¨åˆ†å°†è§£é‡Š FAISS ä¸­çš„ â€œIndexIVFPQâ€ ç´¢å¼•ï¼Œè¿™ç§ç´¢å¼•åœ¨åŸºç¡€å½¢å¼çš„ä¹˜ç§¯é‡åŒ–å™¨ä¸Šæ·»åŠ äº†ä¸å°‘ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;h2&gt;è¿‘ä¼¼è·ç¦»ç©·ä¸¾æœç´¢&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸åŒäº ANN ä½¿ç”¨çš„åŸºäºæ ‘çš„ç´¢å¼•ï¼Œå•ç‹¬ä½¿ç”¨ä¹˜ç§¯é‡åŒ–å™¨çš„ k-NN æ£€ç´¢ä»ç„¶æ˜¯ä¸€ç§â€œç©·ä¸¾æœç´¢â€ï¼Œè¿™æ„å‘³ç€ä¹˜ç§¯é‡åŒ–å™¨ä»ç„¶éœ€è¦å°†æŸ¥è¯¢å‘é‡ï¼ˆquery vectorï¼‰å’Œæ•°æ®åº“ä¸­æ‰€æœ‰å‘é‡åšæ¯”è¾ƒã€‚ä¹˜ç§¯é‡åŒ–å™¨çš„æ ¸å¿ƒæ˜¯è¿‘ä¼¼åœ°ä¸”æ˜¾è‘—åœ°ç®€åŒ–å‘é‡çš„è·ç¦»è®¡ç®—ã€‚&lt;/p&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;æ³¨æ„ï¼šFAISS ä¸­çš„ IndexIVFPQ ç´¢å¼•åœ¨ä½¿ç”¨ä¹˜ç§¯é‡åŒ–å™¨ä¹‹å‰ä¼šé¢„å…ˆè¿‡æ»¤æ•°æ®é›† - ç¬¬äºŒéƒ¨åˆ†ä¼šè§£é‡Šã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;h2&gt;ä»¥ç¤ºä¾‹è§£é‡Š&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¹˜ç§¯é‡åŒ–å™¨æ–¹æ³•çš„ä½œè€…ä»¬æ˜¯ä¿¡å·å¤„ç†å’Œå‹ç¼©æŠ€æœ¯èƒŒæ™¯çš„ï¼Œæ‰€ä»¥å¦‚æœä½ æ˜¯æœºå™¨å­¦ä¹ æ–¹å‘çš„ï¼Œå¯èƒ½å¯¹ä»–ä»¬çš„ç”¨è¯å’Œæœ¯è¯­æ¯”è¾ƒé™Œç”Ÿã€‚ä¸è¿‡ï¼Œå¦‚æœä½ ç†Ÿæ‚‰ k-means èšç±»ï¼ˆä¸”æ‘’å¼ƒæ‰€æœ‰å‹ç¼©å‘½åæ³•çš„è¯æ±‡ï¼‰ï¼Œä½¿ç”¨ä¸€ä¸ªç¤ºä¾‹ä½ å°±èƒ½è½»æ¾ç†è§£ä¹˜ç§¯é‡åŒ–å™¨çš„åŸºç¡€çŸ¥è¯†ã€‚ä¹‹åï¼Œæˆ‘ä»¬å†å›å¤´æ¥çœ‹å‹ç¼©æŠ€æœ¯ç›¸å…³æœ¯è¯­ã€‚&lt;/p&gt;
&lt;h2&gt;æ•°æ®é›†å‹ç¼©&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å‡è®¾ä½ æœ‰ä¸€ä¸ª 50,000 å¼ çš„å›¾ç‰‡é›†ï¼Œä½¿ç”¨ä¸€ä¸ªå·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰å®Œæˆä¸€äº›ç‰¹å¾çš„æŠ½å–ã€‚è¿™æ ·ä½ ç°åœ¨å°±å¾—åˆ°ä¸€ä¸ª 50,000ä¸ªç‰¹å¾å‘é‡çš„æ•°æ®é›†ï¼Œæ¯ä¸ªç‰¹å¾å‘é‡æœ‰ 1024 ç»´ã€‚&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/GYq3ZzBRHSQMCyL.png&apos; title=&apos;image_vectors.png&apos; alt=&apos;image_vectors.png&apos; width=&apos;300&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘ä»¬è¦åšçš„ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯å‹ç¼©æ•°æ®é›†ã€‚å‘é‡çš„æ•°é‡ä¿æŒä¸å˜ï¼Œä½†æ˜¯å¯ä»¥å‡å°‘æ¯ä¸ªå‘é‡éœ€è¦çš„å­˜å‚¨ç©ºé—´ã€‚æ³¨æ„ï¼šæˆ‘ä»¬è¦åšçš„äº‹æƒ…ä¸åŒäºâ€œé™ç»´ï¼ˆdimensionality reductionï¼‰â€ï¼è¿™æ˜¯å› ä¸ºå‹ç¼©åçš„å‘é‡ä¸­çš„å€¼å…¶å®æ˜¯ç¬¦å·è€Œä¸æ˜¯æ•°å€¼ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥æ¯”è¾ƒå‹ç¼©åçš„å‘é‡ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å‹ç¼©æ•°æ®é›†æœ‰ä¸¤å¤§å¥½å¤„ï¼šï¼ˆ1ï¼‰å†…å­˜è®¿é—®è€—æ—¶é€šå¸¸æ˜¯å¤„ç†é€Ÿåº¦çš„é™åˆ¶å› ç´ ï¼Œï¼ˆ2ï¼‰å¯¹å¤§æ•°æ®é›†è€Œè¨€å†…å­˜å®¹é‡æ˜¯ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å‹ç¼©çš„åŸç†å¦‚ä¸‹æ‰€è¿°ï¼šå¯¹äºæˆ‘ä»¬çš„ç¤ºä¾‹æ•°æ®é›†ï¼Œå°†æ‰€æœ‰å‘é‡ä¸€èµ·åˆ‡æˆ8ä¸ªå­å‘é‡ï¼Œæ¯ä¸ªå­å‘é‡çš„é•¿åº¦ä¸º 128ï¼ˆ8ä¸ªå­å‘é‡ $\times$ æ¯ä¸ªå­å‘é‡128ç»´ = åŸå§‹å‘é‡çš„ 1024 ç»´ï¼‰ã€‚è¿™æ ·å°±å°†æ•°æ®é›†åˆ†æˆ8ä¸ªçŸ©é˜µï¼Œæ¯ä¸ªçŸ©é˜µå¤§å°ä¸º $[50K \times 128]$ã€‚&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/19/WJq2XenwRcoSAtM.png&apos; title=&apos;vector_slice.png&apos; alt=&apos;vector_slice.png&apos; width=&apos;500&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç„¶åå¯¹è¿™8ä¸ªçŸ©é˜µçš„æ¯ä¸€ä¸ªå•ç‹¬è¿›è¡Œ k-means èšç±»ï¼Œk = 256ã€‚è¿™æ ·ï¼Œå¯¹äºå‘é‡çš„8ä¸ªå­æ®µçš„æ¯1ä¸ªéƒ½å­˜åœ¨256ä¸ªè´¨å¿ƒ - ä¸€å…±8ç»„è´¨å¿ƒï¼Œæ¯ç»„åŒ…å«256ä¸ªè´¨å¿ƒã€‚&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/23/wQHcVTzs6ftJFeg.png&apos; title=&apos;kmeans_clustering.png&apos; alt=&apos;kmeans_clustering.png&apos; width=&apos;500&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™äº›è´¨å¿ƒç±»ä¼¼äºâ€œåŸå‹â€ã€‚å®ƒä»¬ä»£è¡¨æ•°æ®é›†å­å‘é‡ä¸­æœ€å¸¸è§çš„æ¨¡å¼ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯ä»¥ä½¿ç”¨è¿™äº›è´¨å¿ƒæ¥å‹ç¼©å‘é‡æ•°æ®é›† - ä½¿ç”¨æœ€æ¥è¿‘/æœ€ç›¸ä¼¼çš„ç½®ä¿¡æ¥æ›¿ä»£å‘é‡ä¸­å¯¹åº”çš„æ¯ä¸ªå­éƒ¨åˆ†ï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªä¸åŒäºåŸå§‹å‘é‡çš„ä¸€ä¸ªæ–°å‘é‡ï¼Œä¸è¿‡å®ƒä»¬ä¹‹é—´åº”è¯¥è¿˜æ˜¯ç›¸è¿‘çš„ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™æ ·æˆ‘ä»¬å°±èƒ½æ›´åŠ é«˜æ•ˆåœ°å­˜å‚¨è¿™äº›å‘é‡ - ä¸ç”¨å­˜å‚¨åŸå§‹çš„æµ®ç‚¹æ•°å€¼ï¼Œåªè¦å­˜å‚¨èšç±»ä¸­å¿ƒ ID å³å¯ - å¯¹æ¯ä¸ªå­å‘é‡ï¼Œæ‰¾åˆ°æœ€è¿‘çš„è´¨å¿ƒï¼Œå­˜å‚¨è¯¥è´¨å¿ƒçš„ IDã€‚æ¯ä¸ªå‘é‡ä¹Ÿå°±è¢«æ›¿æ¢ä¸º8ä¸ªè´¨å¿ƒ ID çš„ä¸€ä¸ªåºåˆ—ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ³¨æ„ï¼šå¯¹äº8ä¸ªå­éƒ¨åˆ†çŸ©é˜µçš„æ¯ä¸€ä¸ªå­¦ä¹ åˆ°çš„è´¨å¿ƒé›†åˆæ˜¯ä¸åŒçš„ã€‚ä½¿ç”¨æœ€è¿‘è´¨å¿ƒ id æ›¿æ¢å­å‘é‡æ—¶ï¼Œåªèƒ½ä¸å¯¹åº”å­éƒ¨åˆ†çš„ 256 ä¸ªè´¨å¿ƒåšæ¯”è¾ƒã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ¯ä¸ªå­éƒ¨åˆ†åªæœ‰ 256 ä¸ªè´¨å¿ƒï¼Œæ‰€ä»¥ä»…éœ€ 8 æ¯”ç‰¹å°±èƒ½å­˜å‚¨ä¸€ä¸ªè´¨å¿ƒ IDã€‚æ¯ä¸ªå‘é‡ï¼ŒåŸæœ¬åŒ…å« 1024 ä¸ª 32 æµ®ç‚¹æ•°ï¼ˆ4,096 å­—èŠ‚ï¼‰ï¼Œç°åœ¨ä»…æ˜¯ 8 ä¸ª 8 æ¯”ç‰¹æ•´æ•°çš„åºåˆ—ï¼ˆæ¯ä¸ªå‘é‡åªè¦8å­—èŠ‚çš„å­˜å‚¨ç©ºé—´ï¼ï¼‰ã€‚&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/19/eTMGdN4Vfbrhyl5.png&apos; title=&apos;compression.png&apos; alt=&apos;compression.png&apos; width=&apos;100%&apos;/&gt;
&lt;h2&gt;æœ€è¿‘é‚»æœç´¢&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¾ˆæ£’ï¼å‘é‡ç»è¿‡å‹ç¼©äº†ã€‚ä¸è¿‡æ— æ³•å¯¹ç»è¿‡å‹ç¼©çš„å‘é‡ç›´æ¥è®¡ç®— L2 è·ç¦» - è´¨å¿ƒ ID ä¹‹é—´çš„è·ç¦»æ˜¯ä»»æ„ä¸”æ²¡æœ‰å®é™…æ„ä¹‰çš„ï¼ï¼ˆè¿™å°±æ˜¯å‹ç¼©ä¸é™ç»´çš„ä¸åŒä¹‹å¤„ï¼‰&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ¥ä¸‹æ¥è¯´è¯´æ€ä¹ˆè¿›è¡Œæœ€è¿‘é‚»æœç´¢ï¼Œè™½ä»æ˜¯ç©·ä¸¾æœç´¢ï¼ˆä¸æ‰€æœ‰å‘é‡è®¡ç®—è·ç¦»å¹¶æ’åºï¼‰ï¼Œä¸è¿‡å¯ä»¥æ›´é«˜æ•ˆåœ°è®¡ç®—è·ç¦» - åªéœ€è¿›è¡Œè¡¨æŸ¥æ‰¾ä»¥åŠæŸç§åŠ æ³•å³å¯ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæŸ¥è¯¢å‘é‡ï¼ŒæœŸæœ›æ‰¾åˆ°å®ƒçš„æœ€è¿‘é‚»å±…ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸€ç§ä¸å¤ªèªæ˜çš„æ–¹å¼æ˜¯å…ˆè§£å‹ç¼©æ•°æ®é›†å‘é‡ï¼Œç„¶åè®¡ç®— L2 è·ç¦»ã€‚ä¹Ÿå°±æ˜¯ï¼Œé€šè¿‡ä¸²æ¥ä¸åŒç»´åº¦çš„è´¨å¿ƒé‡å»ºå‡ºå‘é‡ã€‚ä¸‹é¢æˆ‘ä»¬ä¹Ÿä¼šè¿™æ ·å¹²ï¼Œä¸è¿‡æ¯”å®é™…åœ°è§£å‹ç¼©æ‰€æœ‰å‘é‡åœ¨è®¡ç®—ä¸Šè¦é«˜æ•ˆå¾—å¤šã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é¦–å…ˆï¼Œå¯¹æŸ¥è¯¢å‘é‡çš„æ¯ä¸ªå­å‘é‡ï¼Œä¸è¯¥å­æ®µçš„ 256 ä¸ªè´¨å¿ƒä¸­æ¯ä¸€ä¸ªè®¡ç®— L2 è·ç¦»çš„å¹³æ–¹ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™æ„å‘³ç€è¦æ„å»ºä¸€ä¸ªå­å‘é‡è·ç¦»è¡¨ï¼Œè¿™ä¸ªè¡¨æœ‰ 256 è¡Œï¼ˆä¸€ä¸ªè´¨å¿ƒå¯¹åº”ä¸€è¡Œï¼‰ 8 åˆ—ï¼ˆä¸€ä¸ªå­æ®µå¯¹åº”ä¸€åˆ—ï¼‰ã€‚æ„å»ºè¿™ä¸ªè¡¨æˆæœ¬æœ‰å¤šå¤§ï¼Ÿç›¸å½“äºè®¡ç®—æŸ¥è¯¢å‘é‡ä¸ 256 ä¸ªæ•°æ®é›†å‘é‡çš„ L2 è·ç¦»æ‰€éœ€è¦çš„æ•°å­¦è¿ç®—æ¬¡æ•°ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸€æ—¦æœ‰äº†è¿™ä¸ªè¡¨ï¼Œå°±å¯ä»¥å¼€å§‹è®¡ç®—æŸ¥è¯¢å‘é‡ä¸ 50k ä¸ªæ•°æ®åº“å‘é‡ä¸­æ¯ä¸€ä¸ªçš„è¿‘ä¼¼è·ç¦»äº†ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ¯ä¸ªæ•°æ®åº“å‘é‡ç°åœ¨åªæ˜¯ 8 ä¸ªè´¨å¿ƒ  ID çš„åºåˆ—ã€‚å› æ­¤è¦è®¡ç®—ä¸€ä¸ªæ•°æ®åº“å‘é‡ä¸æŸ¥è¯¢å‘é‡ä¹‹é—´çš„ç›¸ä¼¼è·ç¦»ï¼Œåªéœ€ä½¿ç”¨è¿™äº›è´¨å¿ƒ ID ä»è¡¨ä¸­æŸ¥æ‰¾å‡ºå¯¹åº”çš„éƒ¨åˆ†è·ç¦»ï¼Œå¹¶å°†å®ƒä»¬åŠ å’Œåœ¨ä¸€èµ·ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åªéœ€è¦å°†è¿™äº›éƒ¨åˆ†å€¼åŠ èµ·æ¥å°±å®Œæˆäº†ï¼Ÿæ˜¯çš„ï¼è®°ä½æˆ‘ä»¬åœ¨å¤„ç†çš„æ˜¯ L2 è·ç¦»çš„å¹³æ–¹ï¼Œæ‰€ä»¥æ— éœ€å¹³æ–¹æ ¹æ“ä½œã€‚è®¡ç®— L2 çš„å¹³æ–¹ï¼Œå°±æ˜¯å°†æ¯ä¸ªå­éƒ¨åˆ†çš„å·®å¹³æ–¹ï¼ˆsquared differencesï¼‰ç›¸åŠ ï¼Œè¿™äº›åŠ æ³•æ“ä½œçš„æ¬¡åºä¹Ÿæ— å…³ç´§è¦ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ç§æŸ¥è¡¨æ–¹å¼ï¼Œä¸å¯¹è§£å‹ç¼©å‘é‡è®¡ç®—è·ç¦»çš„æ–¹å¼ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯è®¡ç®—æˆæœ¬è¦å°å¾—å¤šã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ€åä¸€æ­¥ï¼Œä¸å¸¸è§„çš„æœ€è¿‘é‚»æœç´¢ä¸€æ · - å¯¹è·ç¦»è¿›è¡Œæ’åºåæ‰¾åˆ°æœ€å°çš„è·ç¦»ï¼Œå¯¹åº”çš„è¿™äº›æ•°æ®åº“å‘é‡å°±æ˜¯æœ€è¿‘çš„é‚»å±…ã€‚æ‰“å®Œæ”¶å·¥ï¼&lt;/p&gt;
&lt;h2&gt;å‹ç¼©æŠ€æœ¯ç›¸å…³æœ¯è¯­&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘ä»¬ç†è§£äº† PQ çš„é€»è¾‘åŸç†ï¼Œç°åœ¨å›è¿‡å¤´æ¥å­¦ä¹ ç›¸å…³æœ¯è¯­å°±ç®€å•äº†ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¹¿ä¹‰ä¸Šè€Œè¨€ï¼Œé‡åŒ–å™¨å°±æ˜¯èƒ½å¤Ÿå‡å°‘å˜é‡å–å€¼ç©ºé—´ï¼ˆthe number of possible values that a variable hasï¼‰çš„ä¸€ç§ä¸œè¥¿ã€‚æ„å»ºä¸€ä¸ªæŸ¥æ‰¾è¡¨æ¥å‡å°‘ä¸€å¼ å›¾ç‰‡çš„é¢œè‰²æ•°é‡ï¼ˆthe number of colorsï¼‰ï¼Œåº”è¯¥æ˜¯ä¸€ä¸ªä¸é”™çš„ä¾‹å­ - æ‰¾åˆ°å›¾ç‰‡ä¸­æœ€å¸¸è§çš„ 256 ä¸ªé¢œè‰²æ•°å€¼ï¼Œæ”¾åˆ°ä¸€å¼ è¡¨ä¸­ï¼Œå°† 24 æ¯”ç‰¹ RGB è‰²å€¼æ˜ å°„åˆ°ä¸€ä¸ª 8 æ¯”ç‰¹æ•´æ•°ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘ä»¬è·å–æ‰€æœ‰æ•°æ®åº“å‘é‡çš„å¼€å§‹ 128 ä¸ªå€¼ï¼ˆ8ä¸ªå­æ®µä¸­ç¬¬1ä¸ªï¼‰ï¼Œå¯¹è¿™äº› 128 ä¸ªå€¼ï¼ˆæ•°é‡ $50k \times 128$ï¼‰è¿›è¡Œèšç±»è®­ç»ƒï¼Œå¾—åˆ° 256 ä¸ªè´¨å¿ƒï¼Œè¿™ 256 ä¸ªè´¨å¿ƒå°±æ„æˆäº†æˆ‘ä»¬æ‰€è¯´çš„â€œç æœ¬ï¼ˆcodebookï¼‰â€ã€‚æ¯ä¸ªè´¨å¿ƒï¼ˆä¸€ä¸ªåŒ…å«128ä¸ªæµ®ç‚¹æ•°çš„å‘é‡ï¼‰è¢«ç§°ä¸ºä¸€ä¸ªâ€œä»£ç ï¼ˆcodeï¼‰â€ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™äº›è´¨å¿ƒæ˜¯ç”¨æ¥è¡¨å¾æ•°æ®åº“å‘é‡çš„ï¼Œå› æ­¤è¿™äº›ä»£ç ä¹Ÿå¯ç§°ä¹‹ä¸ºâ€œå†ç”Ÿäº§å€¼ï¼ˆreproduction valuesï¼‰â€ æˆ–â€œé‡å»ºå€¼ï¼ˆreconstruction valuesï¼‰â€ã€‚å°†è´¨å¿ƒ ID å¯¹åº”çš„ä»£ç ä¸²æ¥æˆåºåˆ—å°±èƒ½åˆ›å»ºä¸€ä¸ªæ•°æ®åº“å‘é‡ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;8 ä¸ªå­æ®µæ˜¯åˆ†åˆ«è¿›è¡Œ k-means èšç±»çš„ï¼Œæ‰€ä»¥å®é™…åˆ›å»ºäº† 8 ä¸ªç‹¬ç«‹çš„ç æœ¬ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åŸºäºè¿™ 8 ä¸ªç æœ¬ï¼Œç»„åˆä»£ç èƒ½å¤Ÿåˆ›å»º $256^8$ ç§å¯èƒ½çš„å‘é‡ï¼å› æ­¤ï¼Œå®é™…ä¸Šæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªéå¸¸å·¨å¤§çš„ç æœ¬ï¼ŒåŒ…å« $256^8$ ä¸ªä»£ç ã€‚ç›´æ¥ä¹ å¾—å¹¶å­˜å‚¨å¦‚æ­¤å¤§çš„å•ä¸ªç æœ¬æ˜¯ä¸å¯èƒ½çš„äº‹æƒ…ï¼Œç”±æ­¤å¯è§ä¹˜ç§¯é‡åŒ–å™¨çš„é­”åŠ›ã€‚&lt;/p&gt;
&lt;h2&gt;é¢„è¿‡æ»¤&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;a href=&apos;http://mccormickml.com/2017/10/22/product-quantizer-tutorial-part-2/&apos;&gt;æœ¬æ•™ç¨‹çš„ç¬¬2éƒ¨åˆ†&lt;/a&gt;ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹  FAISS åº“ä¸­çš„ IndexIVFPQ ç´¢å¼•ï¼Œè¿™ç§ç´¢å¼•åœ¨ä½¿ç”¨ä¹˜ç§¯é‡åŒ–å™¨ä¹‹å‰å°†æ•°æ®é›†å…ˆåˆ†å‰²ä¸ºå¤šä¸ªåˆ†åŒºï¼Œè¿™æ ·å¯¹äºæ¯ä¸ªæŸ¥è¯¢ä»…éœ€è¦æœç´¢éƒ¨åˆ†åˆ†åŒºã€‚FAISS å‘å¸ƒäº 2017 å¹´ï¼ŒIndexIVFPQ ç´¢å¼•ä½¿ç”¨çš„ä¹˜ç§¯é‡åŒ–å™¨æ–¹æ³•æŠ€æœ¯é¦–æ¬¡è§äº &lt;a href=&apos;https://www.irisa.fr/texmex/people/jegou/papers/jegou_searching_with_quantization.pdf&apos;&gt;2011 å¹´çš„è¿™ç¯‡è®ºæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;</description>
            <pubDate>2025-01-09</pubDate>
            <link>https://blog.xiayf.cn/posts/product-quantizer-tutorial-part-1.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/product-quantizer-tutorial-part-1.html</guid>
        </item>
        
        <item>
            <title>Arrow åˆ—å­˜æ ¼å¼-åºåˆ—åŒ–ä¸è¿›ç¨‹é—´é€šä¿¡ï¼ˆè¯‘ï¼‰</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;åŸæ–‡ï¼š&lt;a href=&apos;https://arrow.apache.org/docs/format/Columnar.html#serialization-and-interprocess-communication-ipc&apos;&gt;Arrow Columnar Format-Serialization and Interprocess Communication (IPC)&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;åºåˆ—åŒ–ä¸è¿›ç¨‹é—´é€šä¿¡(IPC)&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ¬åˆ—å­˜æ ¼å¼å®šä¹‰ä¸­ï¼Œåºåˆ—åŒ–æ•°æ®çš„åŸºæœ¬å•å…ƒæ˜¯â€œæˆæ‰¹è®°å½•ï¼ˆrecord batchï¼‰â€ã€‚è¯­ä¹‰ä¸Šï¼Œä¸€ä¸ªæˆæ‰¹è®°å½•æ˜¯è‹¥å¹²æ•°ç»„çš„ä¸€ä¸ªæœ‰åºé›†åˆï¼Œä¸€ä¸ªæ•°ç»„å¯¹åº”ä¸€ä¸ªå­—æ®µåˆ—ï¼ˆfieldï¼‰ï¼Œè¿™äº›æ•°ç»„çš„é•¿åº¦ç›¸åŒï¼Œä½†æ•°æ®ç±»å‹å¯èƒ½ä¸åŒã€‚ä¸€ä¸ªæˆæ‰¹è®°å½•ä¸­å­—æ®µåˆ—çš„åç§°å’Œç±»å‹ä¿¡æ¯å…±åŒå½¢æˆè¯¥æ‰¹çš„ &lt;em&gt;schema&lt;/em&gt;ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ¬å°èŠ‚ï¼Œæˆ‘ä»¬å°†å®šä¹‰ä¸€ç§åè®®ï¼Œçº¦å®šå¦‚ä½•å°†è‹¥å¹²è®°å½•æ‰¹åºåˆ—åŒ–æˆä¸€ä¸ªäºŒè¿›åˆ¶è½½è·çš„æµï¼Œä»¥åŠå¦‚ä½•æ— éœ€å†…å­˜æ‹·è´å°±èƒ½ä»è¿™äº›è½½è·é‡å»ºå‡ºè®°å½•æ‰¹ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ¬åˆ—å­˜è¿›ç¨‹é—´é€šä¿¡åè®®ä½¿ç”¨å¦‚ä¸‹è¿™äº›ç±»å‹çš„äºŒè¿›åˆ¶æ¶ˆæ¯æ ¼å¼æ¥æ„å»ºä¸€ä¸ªå•å‘æµçš„å®šä¹‰ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;Schema&lt;/li&gt;
&lt;li&gt;RecordBatch&lt;/li&gt;
&lt;li&gt;DictionaryBatch&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ç§æˆ‘ä»¬ç§°ä¹‹ä¸ºè¿›ç¨‹é—´é€šä¿¡å¯†å°æ¶ˆæ¯çš„æ ¼å¼ï¼ŒåŒ…å«ä¸€ä¸ªç»åºåˆ—åŒ–çš„ Flatbuffer ç±»å‹å…ƒæ•°æ®ï¼Œåæ¥ä¸€ä¸ªå¯é€‰çš„æ¶ˆæ¯ä½“ã€‚åœ¨æè¿°å¦‚ä½•åºåˆ—åŒ–å¦‚ä¸Šä¸‰ç§è¿›ç¨‹é—´é€šä¿¡æ¶ˆæ¯ç±»å‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå®šä¹‰æ¸…æ¥šè¿™ç§æ¶ˆæ¯æ ¼å¼ã€‚&lt;/p&gt;
&lt;h3&gt;å¯†å°æ¶ˆæ¯æ ¼å¼&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äºç®€å•çš„æµå¼åºåˆ—åŒ–å’ŒåŸºäºæ–‡ä»¶çš„åºåˆ—åŒ–ï¼Œæˆ‘ä»¬ä¸ºè¿›ç¨‹é—´é€šä¿¡å®šä¹‰ä¸€ç§â€œå¯†å°çš„â€æ¶ˆæ¯æ ¼å¼ã€‚è¿™ç§æ¶ˆæ¯ï¼Œä»…éœ€æ£€æŸ¥æ¶ˆæ¯çš„å…ƒæ•°æ®ï¼Œå°±èƒ½â€œè¢«ååºåˆ—åŒ–â€æˆå†…å­˜ä¸­çš„ Arrow æ•°ç»„å¯¹è±¡ï¼Œæ— éœ€å¯¹å®é™…æ•°æ®è¿›è¡Œæ‹·è´æˆ–ç§»åŠ¨ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ç§å¯†å°äºŒè¿›åˆ¶æ¶ˆæ¯æ ¼å¼å¦‚ä¸‹æ‰€è¿°ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ä¸€ä¸ª 32 æ¯”ç‰¹é•¿åº¦çš„å†å¼€å§‹æ ‡è¯†ã€‚å…¶å€¼ä¸º &lt;code&gt;0xFFFFFFFF&lt;/code&gt;ï¼Œè¡¨ç¤ºé‡æ–°å¼€å§‹ä¸€ä¸ªæœ‰æ•ˆæ¶ˆæ¯ã€‚è¿™ä¸€éƒ¨åˆ†æ˜¯åœ¨ç‰ˆæœ¬ 0.15.0 å¼•å…¥çš„ï¼Œéƒ¨åˆ†åŸå› æ˜¯ä¸ºäº†è§£å†³ Flatbuffers è¦æ±‚8å­—èŠ‚å¯¹é½çš„é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯å…ƒæ•°æ®éƒ¨åˆ†çš„å¤§å°ï¼Œ32 æ¯”ç‰¹é•¿åº¦ï¼Œå°ç«¯ç¼–ç ã€‚&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯å…ƒæ•°æ®ï¼Œç±»å‹ä¸º &lt;a href=&apos;&quot;https://github.com/apache/arrow/blob/main/format/Message.fbs&quot;&apos;&gt;Message.fbs&lt;/a&gt;æ–‡ä»¶ä¸­å®šä¹‰çš„ &lt;code&gt;Message&lt;/code&gt; ç±»å‹ã€‚&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯ä½“ï¼Œå…¶é•¿åº¦å¿…é¡»æ˜¯8å­—èŠ‚çš„å€æ•°ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¯­ä¹‰ä¸Šï¼Œæ¶ˆæ¯æ ¼å¼å½¢å¦‚ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;&amp;amp;lt;å†å¼€å§‹æ ‡è¯†: 0xFFFFFFFF&amp;amp;gt;
&amp;amp;lt;å…ƒæ•°æ®å¤§å°: int32&amp;amp;gt;
&amp;amp;lt;flatbuffer åºåˆ—åŒ–çš„å…ƒæ•°æ®: bytes&amp;amp;gt;
&amp;amp;lt;å¡«å……&amp;amp;gt;
&amp;amp;lt;æ¶ˆæ¯ä½“&amp;amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç»åºåˆ—åŒ–çš„å®Œæ•´æ¶ˆæ¯ï¼Œé•¿åº¦å¿…é¡»æ˜¯8å­—èŠ‚çš„å€æ•°ï¼Œè¿™æ ·æ¶ˆæ¯å¯ä»¥è·¨å¤šä¸ªæµå®ç°å†…å­˜é‡å®šä½ï¼ˆè¯‘æ³¨ï¼šæ€ä¹ˆç†è§£ï¼Ÿï¼‰ã€‚å¦åˆ™ï¼Œå…ƒæ•°æ®å’Œæ¶ˆæ¯ä½“ä¹‹é—´å¡«å……é‡æ˜¯ä¸ç¡®å®šçš„ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;â€œå…ƒæ•°æ®å¤§å°â€ ç­‰äº &lt;code&gt;Message&lt;/code&gt; ç±»å‹çš„å¤§å°åŠ ä¸Šå¡«å……çš„å¤§å°ã€‚â€œflatbuffer åºåˆ—åŒ–çš„å…ƒæ•°æ®â€å³æ˜¯ä¸€ä¸ª Flatbuffer &lt;code&gt;Message&lt;/code&gt; ç±»å‹çš„å€¼åºåˆ—åŒ–åçš„ç»“æœï¼Œå…¶å†…éƒ¨åŒ…å«å¦‚ä¸‹éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ç‰ˆæœ¬å·&lt;/li&gt;
&lt;li&gt;ç‰¹å®šçš„æ¶ˆæ¯ç±»å‹å€¼ï¼ˆ&lt;code&gt;Schema&lt;/code&gt;ã€&lt;code&gt;RecordBatch&lt;/code&gt;ã€&lt;code&gt;DictionaryBatch&lt;/code&gt; ä¸‰è€…ä¹‹ä¸€ï¼‰&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯ä½“çš„å¤§å°&lt;/li&gt;
&lt;li&gt;åº”ç”¨è®¾ç½®çš„â€œè‡ªå®šä¹‰å…ƒæ•°æ®â€å­—æ®µã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨è¯»å–ä¸€ä¸ªè¾“å…¥æµæ—¶ï¼Œé€šå¸¸å…ˆè§£æ &lt;code&gt;Message&lt;/code&gt; å…ƒæ•°æ®ï¼Œç»éªŒè¯åè·å–åˆ°æ¶ˆæ¯ä½“çš„å¤§å°ï¼Œç„¶åè¯»å–æ¶ˆæ¯ä½“ã€‚&lt;/p&gt;
&lt;h3&gt;Schema æ¶ˆæ¯&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;a href=&apos;&quot;https://github.com/apache/arrow/blob/main/format/Schema.fbs&quot;&apos;&gt;Schema.fbs&lt;/a&gt; è¿™ä¸ª Flatbuffers æ–‡ä»¶åŒ…å«æ‰€æœ‰å†…ç½®ç±»å‹çš„å®šä¹‰ï¼Œä»¥åŠç”¨äºè¡¨è¾¾ä¸€ä¸ªç»™å®šæˆæ‰¹è®°å½• schema çš„ &lt;code&gt;Schema&lt;/code&gt; å…ƒæ•°æ®ç±»å‹ã€‚schema æ˜¯è‹¥å¹²å­—æ®µåˆ—ï¼ˆ&lt;code&gt;Field&lt;/code&gt;ï¼‰å®šä¹‰çš„æœ‰åºåºåˆ—ï¼Œæ¯ä¸ªå­—æ®µåˆ—å®šä¹‰åŒ…å«åˆ—åç§°å’Œåˆ—æ•°æ®ç±»å‹ã€‚&lt;code&gt;Schema&lt;/code&gt; ç±»å‹çš„å€¼ç»åºåˆ—åŒ–åä¸ä¼šåŒ…å«ä»»ä½•æ•°æ®ç¼“å†²åŒºï¼Œä»…åŒ…å«ç±»å‹å…ƒæ•°æ®ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;Field&lt;/code&gt; è¿™ä¸ª Flatbuffers ç±»å‹åŒ…å«å•ä¸ªæ•°ç»„çš„çš„å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬å¦‚ä¸‹ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å­—æ®µåˆ—çš„åç§°&lt;/li&gt;
&lt;li&gt;å­—æ®µåˆ—çš„æ•°æ®ç±»å‹&lt;/li&gt;
&lt;li&gt;è¯¥å­—æ®µåˆ—è¯­ä¹‰ä¸Šæ˜¯å¦å¯ä»¥ä¸º nullã€‚è¿™ä¸ªå’Œæ•°ç»„çš„ç‰©ç†å†…å­˜å¸ƒå±€æ— å…³ï¼Œä¸€äº›ç³»ç»Ÿä¼šæ˜ç¡®åŒºåˆ†å¯ä¸º null çš„å­—æ®µåˆ—å’Œä¸å¯ä¸º null çš„å­—æ®µåˆ—ï¼Œæˆ‘ä»¬å¸Œæœ›ä¿ç•™è¿™ä¸ªå…ƒæ•°æ®ä»¥ä¾¿å®Œæ•´æ— ç¼ºåœ°è¡¨è¾¾ schema&lt;/li&gt;
&lt;li&gt;å¯¹äºåµŒå¥—ç±»å‹ï¼Œè¿˜åŒ…å«ä¸€ç»„å­ç±»å‹ &lt;code&gt;Field&lt;/code&gt; å…ƒæ•°æ®&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªåä¸º &lt;code&gt;dictionary&lt;/code&gt; çš„å±æ€§ï¼Œæ ‡è¯†å½“å‰å­—æ®µåˆ—æ˜¯å¦å­—å…¸ç¼–ç è¿‡çš„ã€‚å¦‚æœæ˜¯çš„è¯ï¼Œä¼šæœ‰ä¸€ä¸ªå­—å…¸â€œidâ€ èµ‹å€¼äºæ­¤ï¼Œå¦‚æ­¤ä¾¿å¯ä¸ºè¿™ä¸ªå­—æ®µåˆ—åŒ¹é…åç»­çš„å­—å…¸ç¼–ç çš„ IPC æ¶ˆæ¯ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦å¤–ï¼Œæˆ‘ä»¬è¿˜æä¾› schema çº§åˆ«å’Œå­—æ®µåˆ—çº§åˆ«çš„ &lt;code&gt;custom_metadata&lt;/code&gt; å±æ€§å­—æ®µï¼Œæ–¹ä¾¿åº”ç”¨ç³»ç»Ÿæ’å…¥è‡ªå·±çš„åº”ç”¨å…ƒæ•°æ®ï¼Œä»¥æ­¤è‡ªå®šä¹‰è¡Œä¸ºã€‚&lt;/p&gt;
&lt;h3&gt;RecordBatch æ¶ˆæ¯&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸€ä¸ª RecordBatch æ¶ˆæ¯åŒ…å«è‹¥å¹²å®é™…çš„æ•°æ®ç¼“å†²åŒºï¼Œå…¶ç‰©ç†å†…å­˜å¸ƒå±€ç”± schema å†³å®šã€‚è¿™ç§æ¶ˆæ¯çš„å…ƒæ•°æ®æä¾›äº†æ¯ä¸ªç¼“å†²åŒºçš„ä½ç½®å’Œå¤§å°ä¿¡æ¯ï¼Œå¦‚æ­¤ï¼Œä½¿ç”¨æŒ‡é’ˆè®¡ç®—å°±èƒ½é‡å»ºå‡ºé‚£äº›æ•°ç»„æ•°æ®ç»“æ„ï¼Œä¹Ÿæ— éœ€å†…å­˜æ‹·è´ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆæ‰¹è®°å½•çš„åºåˆ—åŒ–åå½¢å¼å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;â€œæ¶ˆæ¯å¤´éƒ¨â€éƒ¨åˆ†ï¼Œå®šä¹‰è§ &lt;a href=&apos;&quot;https://github.com/apache/arrow/blob/main/format/Message.fbs&quot;&apos;&gt;Message.fbs&lt;/a&gt; ä¸­çš„ &lt;code&gt;RecordBatch&lt;/code&gt; ç±»å‹ã€‚&lt;/li&gt;
&lt;li&gt;â€œæ¶ˆæ¯ä½“â€éƒ¨åˆ†ï¼Œè‹¥å¹²å†…å­˜ç¼“å†²åŒºçš„ä¸€ä¸ªå¹³é“ºåºåˆ—ï¼Œä¾æ¬¡é€ä¸ªå†™å…¥ï¼Œä¸­é—´åŠ ä¸Šé€‚å½“çš„å¡«å……ä»¥ç¡®ä¿8å­—èŠ‚å¯¹é½ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ•°æ®å¤´éƒ¨åŒ…å«å¦‚ä¸‹ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;æˆæ‰¹è®°å½•ä¸­ï¼Œæ¯ä¸ªå¹³é“ºå­—æ®µåˆ—çš„é•¿åº¦å’Œ null å€¼çš„æ•°é‡ã€‚&lt;/li&gt;
&lt;li&gt;æˆæ‰¹è®°å½•æ¶ˆæ¯ä½“ä¸­æ¯ä¸ªâ€œç¼“å†²åŒºâ€çš„å†…å­˜åç§»ä½ç½®å’Œé•¿åº¦ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™äº›å­—æ®µåˆ—ä¿¡æ¯å’Œç¼“å†²åŒºæ˜¯å¯¹æˆæ‰¹è®°å½•ä¸­çš„å­—æ®µåˆ—æŒ‰ç…§åŸæœ‰é¡ºåºè¿›è¡Œæ·±åº¦ä¼˜å…ˆéå†å¹³é“ºå¾—åˆ°çš„ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä¸‹ schemaï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;col1: Struct&amp;amp;lt;a: Int32, b: List&amp;amp;lt;item: Int64&amp;amp;gt;, c: Float64&amp;amp;gt;
col2: Utf8&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å…¶å¹³é“ºç‰ˆæœ¬å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;FieldNode 0: Struct name=&amp;amp;apos;col1&amp;amp;apos;
FieldNode 1: Int32 name=&amp;amp;apos;a&amp;amp;apos;
FieldNode 2: List name=&amp;amp;apos;b&amp;amp;apos;
FieldNode 3: Int64 name=&amp;amp;apos;item&amp;amp;apos;
FieldNode 4: Float64 name=&amp;amp;apos;c&amp;amp;apos;
FieldNode 5: Utf8 name=&amp;amp;apos;col2&amp;amp;apos;&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹åº”ç”Ÿæˆçš„ç¼“å†²åŒºå¹³é“ºåºåˆ—ï¼Œåˆ™å¦‚ä¸‹æ‰€ç¤ºï¼ˆå‚è€ƒä¸Šé¢çš„è¡¨å®šä¹‰ï¼‰ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;buffer 0: field 0 validity
buffer 1: field 1 validity
buffer 2: field 1 values
buffer 3: field 2 validity
buffer 4: field 2 offsets
buffer 5: field 3 validity
buffer 6: field 3 values
buffer 7: field 4 validity
buffer 8: field 4 values
buffer 9: field 5 validity
buffer 10: field 5 offsets
buffer 11: field 5 data&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;Buffer&lt;/code&gt; çš„ Flatbuffers å€¼æè¿°äº†æ¯å—å†…å­˜çš„ä½ç½®å’Œå¤§å°ï¼ŒæŒ‰ç…§å‰æ–‡å®šä¹‰çš„å¯†å°æ¶ˆæ¯æ ¼å¼è¿›è¡Œè§£æã€‚&lt;/p&gt;
&lt;h3&gt;å¯å˜æ•°é‡ç¼“å†²åŒºï¼ˆVariadic buffersï¼‰&lt;/h3&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;Arrow åˆ—å­˜æ ¼å¼ 1.4 ç‰ˆæœ¬æ–°å¢ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¯¸å¦‚ Utf8View è¿™äº›ç±»å‹ï¼Œä½¿ç”¨ä¸å®šæ•°é‡çš„ç¼“å†²åŒºæ¥è¡¨ç°ã€‚æŒ‰ç…§é¢„å…ˆé¡ºåºæ‹å¹³çš„é€»è¾‘ schema ä¸­çš„è¿™ç±»å­—æ®µåˆ—åœ¨ RecordBatch çš„&lt;code&gt;variadicBufferCounts&lt;/code&gt; å±æ€§ä¸­éƒ½å¯¹åº”ä¸€ä¸ªå€¼æ¥è¡¨ç¤ºå½“å‰ RecordBatch ä¸­å±äºé‚£ä¸ªå­—æ®µåˆ—çš„ç¼“å†²åŒºçš„æ•°é‡ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¾‹å¦‚ï¼Œæ¥çœ‹çœ‹å¦‚ä¸‹ schemaï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;col1: Struct&amp;amp;lt;a: Int32, b: BinaryView, c: Float64&amp;amp;gt;
col2: Utf8View&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å…¶ä¸­æœ‰ä¸¤ä¸ªå­—æ®µåˆ—æ˜¯æœ‰å¯å˜æ•°é‡ç¼“å†²åŒºçš„ï¼Œå› æ­¤ RecordBatch çš„ &lt;code&gt;variadicBufferCounts&lt;/code&gt; å±æ€§ä¸­å¯¹åº”æœ‰2ä¸ªå€¼ã€‚è‹¥è¯¥ schema çš„ä¸€ä¸ª RecordBatch ä¸­ &lt;code&gt;variadicBufferCounts = [3, 2]&lt;/code&gt;ï¼Œé‚£ä¹ˆå¹³é“ºçš„ç¼“å†²åŒºåºåˆ—å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;buffer 0:  col1    validity
buffer 1:  col1.a  validity
buffer 2:  col1.a  values
buffer 3:  col1.b  validity
buffer 4:  col1.b  views
buffer 5:  col1.b  data
buffer 6:  col1.b  data
buffer 7:  col1.b  data
buffer 8:  col1.c  validity
buffer 9:  col1.c  values
buffer 10: col2    validity
buffer 11: col2    views
buffer 12: col2    data
buffer 13: col2    data&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;å‹ç¼©&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äºæˆæ‰¹è®°å½•çš„æ¶ˆæ¯ä½“ç¼“å†²åŒºå†…å®¹æœ‰3ç§å‹ç¼©æ–¹å¼å¯é€‰ï¼šä¸å‹ç¼©ã€ä½¿ç”¨ &lt;code&gt;lz4&lt;/code&gt; å‹ç¼©ã€ä½¿ç”¨ &lt;code&gt;zstd&lt;/code&gt; å‹ç¼©ã€‚æ¶ˆæ¯ä½“ä¸­å¹³é“ºçš„ç¼“å†²åŒºåºåˆ—ï¼Œæ¯ä¸ªç¼“å†²åŒºéœ€è¦ä½¿ç”¨ç›¸åŒçš„å‹ç¼©ç¼–ç æ–¹å¼å•ç‹¬å‹ç¼©ã€‚å‹ç¼©å¤„ç†åçš„ç¼“å†²åŒºåºåˆ—ä¸­æŸäº›ç¼“å†²åŒºå¯èƒ½æ²¡æœ‰è¢«å‹ç¼©ï¼ˆä¾‹å¦‚ï¼ŒæŸäº›ç¼“å†²åŒºç»å‹ç¼©åå…¶å¤§å°ä¸ä¼šæ˜æ˜¾å˜å°ï¼‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;RecordBatch â€œæ¶ˆæ¯å¤´â€ä¸­çš„ &lt;code&gt;compression&lt;/code&gt; å±æ€§ç”¨äºæ ‡è®°ä½¿ç”¨çš„å‹ç¼©ç±»å‹ï¼Œè¯¥å±æ€§å¯é€‰ï¼Œé»˜è®¤å€¼ä¸ºä¸å‹ç¼©ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹ç¼“å†²åŒºè¿›è¡Œå‹ç¼©æˆ–ä¸è¿›è¡Œå‹ç¼©ï¼ŒåŒºåˆ«ä¹‹å¤„åœ¨ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å¦‚æœ &lt;a href=&apos;&quot;https://arrow.apache.org/docs/format/Columnar.html#ipc-recordbatch-message&quot;&apos;&gt;RecordBatch æ¶ˆæ¯&lt;/a&gt;ä¸­ç¼“å†²åŒºç»è¿‡å‹ç¼©
&lt;ul&gt;&lt;li&gt;â€œæ¶ˆæ¯å¤´â€ä¸­é™¤äº†åŒ…å«æˆæ‰¹è®°å½•æ¶ˆæ¯ä½“ä¸­æ¯ä¸ªå‹ç¼©è¿‡çš„ç¼“å†²åŒºçš„å¤§å°å’Œå†…å­˜åç§»é‡ä¹‹å¤–ï¼Œè¿˜ä¼šåŒ…å«ä½¿ç”¨çš„å‹ç¼©ç±»å‹ã€‚&lt;/li&gt;
&lt;li&gt;â€œæ¶ˆæ¯ä½“â€åŒ…å«ç»è¿‡å‹ç¼©çš„ç¼“å†²åŒºå¹³é“ºåºåˆ—ï¼Œåºåˆ—ä¸­æ¯ä¸ªç¼“å†²åŒºçš„èµ·å§‹8ä¸ªå­—èŠ‚å­˜å‚¨ç¼“å†²åŒºæœªç»å‹ç¼©æ—¶çš„é•¿åº¦ï¼Œè¿™ä¸ªé•¿åº¦æ˜¯å°ç«¯å­—èŠ‚åºç¼–ç çš„64æ¯”ç‰¹æœ‰ç¬¦å·æ•´æ•°ã€‚å¦‚æœè¿™ä¸ªé•¿åº¦ä¸º &lt;code&gt;-1&lt;/code&gt;ï¼Œåˆ™è¡¨ç¤ºå½“å‰ buffer å®é™…æœªç»å‹ç¼©ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;ul&gt;&lt;li&gt;å¦‚æœ &lt;a href=&apos;&quot;https://arrow.apache.org/docs/format/Columnar.html#ipc-recordbatch-message&quot;&apos;&gt;RecordBatch æ¶ˆæ¯&lt;/a&gt;ä¸­ç¼“å†²åŒºæœªç»å‹ç¼©
&lt;ul&gt;&lt;li&gt;â€œæ¶ˆæ¯å¤´â€ä¸­ä»…åŒ…å«æˆæ‰¹è®°å½•æ¶ˆæ¯ä½“ä¸­æ¯ä¸ªæœªç»å‹ç¼©ç¼“å†²åŒºçš„å¤§å°å’Œå†…å­˜åç§»é‡ã€‚&lt;/li&gt;
&lt;li&gt;â€œæ¶ˆæ¯ä½“â€åˆ™ç®€å•åœ°åŒ…å«æœªç»å‹ç¼©ç¼“å†²åŒºçš„å¹³é“ºåºåˆ—ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;&lt;a href=&apos;&quot;https://en.wikipedia.org/wiki/Endianness&quot;&apos;&gt;å­—èŠ‚åº&lt;/a&gt;&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Arrow åˆ—å­˜æ ¼å¼é»˜è®¤ä½¿ç”¨å°ç«¯åºå­—èŠ‚ç¼–ç ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Schema åºåˆ—åŒ–åçš„å…ƒæ•°æ®ä¸­åŒ…å«ä¸€ä¸ª &lt;code&gt;endianness&lt;/code&gt; å±æ€§ï¼Œè¡¨ç¤ºæˆæ‰¹è®°å½•ä½¿ç”¨å“ªç§å­—èŠ‚åºç¼–ç ã€‚é€šå¸¸å°±æ˜¯ç”Ÿæˆè¯¥ RecordBatch çš„ç³»ç»Ÿä½¿ç”¨çš„å­—èŠ‚åºã€‚è¯¥å±æ€§çš„ä¸»è¦ç”¨å¤„æ˜¯ç¡®ä¿åœ¨ä½¿ç”¨ç›¸åŒå­—èŠ‚åºçš„ç³»ç»Ÿä¹‹é—´ä¼ è¾“æˆæ‰¹è®°å½•æ•°æ®ã€‚å¦‚æœç³»ç»Ÿåœ¨è¯»å– Schema æ—¶å‘ç°å­—èŠ‚åºå’Œè‡ªå·±ä¸åŒ¹é…ï¼Œåˆ™åº”è¯¥æŠ¥é”™ã€‚&lt;/p&gt;
&lt;h3&gt;IPC æµå¼ç¼–ç æ ¼å¼&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘ä»¬ä¸ºæˆæ‰¹è®°å½•åºåˆ—æä¾›äº†ä¸€ç§æµå¼ç¼–ç åè®®æˆ–è€…è¯´â€œæ ¼å¼â€ï¼Œå…¶è¡¨ç°ä¸ºä¸€ä¸ªå¯†å°æ¶ˆæ¯åºåˆ—ï¼Œæ¯ä¸ªå¯†å°æ¶ˆæ¯éƒ½éµå¾ªå‰æ–‡æ‰€å±çš„æ ¼å¼ã€‚æµä¸­ï¼Œå…ˆæ”¾å…¥ schemaï¼Œåé¢æ”¾å…¥çš„æ‰€æœ‰æˆæ‰¹è®°å½• schema éƒ½æ˜¯åŒä¸€ä¸ªã€‚å¦‚æœ schema ä¸­ä»»ä¸€å­—æ®µåˆ—ä½¿ç”¨å­—å…¸ç¼–ç ï¼Œé‚£ä¹ˆæµä¸­ä¼šåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª &lt;code&gt;DictionaryBatch&lt;/code&gt; æ¶ˆæ¯ã€‚&lt;code&gt;DictionaryBatch&lt;/code&gt; æ¶ˆæ¯å’Œ &lt;code&gt;RecordBatch&lt;/code&gt; æ¶ˆæ¯å¯èƒ½ä¼šäº¤ç»‡å‡ºç°ï¼Œä½†æ˜¯ &lt;code&gt;RecordBatch&lt;/code&gt; ä¸­ä½¿ç”¨çš„æ‰€æœ‰å­—å…¸ id éƒ½åº”è¯¥åœ¨å…¶å‰é¢çš„ &lt;code&gt;DictionaryBatch&lt;/code&gt; æ¶ˆæ¯ä¸­å®šä¹‰å¥½ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;&amp;amp;lt;SCHEMA&amp;amp;gt;
&amp;amp;lt;DICTIONARY 0&amp;amp;gt;
...
&amp;amp;lt;DICTIONARY k - 1&amp;amp;gt;
&amp;amp;lt;RECORD BATCH 0&amp;amp;gt;
...
&amp;amp;lt;DICTIONARY x DELTA&amp;amp;gt;
...
&amp;amp;lt;DICTIONARY y DELTA&amp;amp;gt;
...
&amp;amp;lt;RECORD BATCH n - 1&amp;amp;gt;
&amp;amp;lt;EOS [optional]: 0xFFFFFFFF 0x00000000&amp;amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;æ³¨è§£ï¼š&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å­—å…¸å’Œæ•°æ®æˆæ‰¹è®°å½•äº¤ç»‡å‡ºç°çš„è§„åˆ™æœ‰ä¸€ä¸ªç‰¹æ®Šæƒ…å†µ - å¦‚æœå­—å…¸æˆæ‰¹è®°å½•ä¸­çš„å‘é‡å®Œå…¨ä¸ºç©ºï¼Œé‚£ä¹ˆæ•°æ®åˆ—æ‰€ä½¿ç”¨çš„å­—å…¸å¯èƒ½ä¼šå‡ºç°é¦–ä¸ªæ•°æ®æˆæ‰¹è®°å½•çš„åé¢ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å®ç°ä¸€ä¸ªæµè¯»å–å™¨ï¼Œåœ¨è¯»å–æ¯æ¡æ¶ˆæ¯åï¼Œéœ€è¦å…ˆè¯»å–æ¥ä¸‹æ¥çš„8ä¸ªå­—èŠ‚æ¥ç¡®å®šæµæ˜¯å¦ç»§ç»­ä»¥åŠä¸‹ä¸€æ¡æ¶ˆæ¯çš„å…ƒæ•°æ®å¤§å°ã€‚ä¸€æ—¦è¯»åˆ°äº†æ¶ˆæ¯çš„ flatbuffer ç¼–ç å…ƒæ•°æ®ï¼Œå°±å¯ä»¥ç»§ç»­è¯»å–æ¶ˆæ¯ä½“éƒ¨åˆ†äº†ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æµå†™å…¥å™¨ï¼Œå¯ä»¥å†™å…¥ 4å­—èŠ‚çš„å†å¼€å§‹æ ‡è¯†ï¼ˆ&lt;code&gt;0xFFFFFFFF&lt;/code&gt;ï¼‰æ‹¼æ¥ä¸Š4å­—èŠ‚çš„å…ƒæ•°æ®é•¿åº¦ 0ï¼ˆ&lt;code&gt;0x00000000&lt;/code&gt;ï¼‰ æ¥æ ‡è¯†æµç»“æŸï¼ˆEOSï¼‰ï¼Œæˆ–è€…ç®€å•å…³é—­æµæ¥å£ã€‚å¯¹äºæµæ ¼å¼ï¼Œæˆ‘ä»¬æ¨èä½¿ç”¨ â€œ.arrowsâ€ æ–‡ä»¶æ‰©å±•åï¼Œè™½ç„¶è®¸å¤šæƒ…å†µä¸‹æµå¹¶ä¸ä¼šå­˜ä¸ºæ–‡ä»¶ã€‚&lt;/p&gt;
&lt;h3&gt;IPC æ–‡ä»¶æ ¼å¼&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘ä»¬å®šä¹‰ä¸€ç§æ”¯æŒéšæœºè®¿é—®çš„â€œæ–‡ä»¶æ ¼å¼â€ï¼Œä½œä¸ºæµå¼ç¼–ç æ ¼å¼çš„ä¸€ç§æ‰©å±•ã€‚æ–‡ä»¶çš„èµ·å§‹å’Œæœ«å°¾å‡æ˜¯ä¸€ä¸ªé­”æœ¯å­—ç¬¦ä¸² &lt;code&gt;ARROW1&lt;/code&gt;(åŠ ä¸Šå¡«å……)ã€‚èµ·å§‹é­”æœ¯å­—ç¬¦ä¸²ä¹‹åç´§è·Ÿæ˜¯æµå¼ç¼–ç æ ¼å¼çš„å†…å®¹ï¼Œä¹‹ååœ¨æœ«å°¾é­”æœ¯å­—ç¬¦ä¸²ä¹‹å‰ï¼Œå…ˆå†™å…¥ä¸€ä¸ªå°¾éƒ¨ï¼ˆfooterï¼‰ - åŒ…å« schemaï¼ˆæµå¼ç¼–ç æ ¼å¼çš„ä¸€éƒ¨åˆ†ï¼‰ çš„ä¸€ä¸ªæ‹·è´ï¼ŒåŠ ä¸Šæ–‡ä»¶ä¸­æ¯ä¸ªæ•°æ®å—çš„å†…å­˜åç§»é‡å’Œå¤§å°ä¿¡æ¯ã€‚è¿™æ ·å°±èƒ½å¤Ÿéšæœºè®¿é—®æ–‡ä»¶ä¸­çš„ä»»ä¸€æˆæ‰¹è®°å½•ã€‚å¯ä»¥æŸ¥çœ‹ &lt;a href=&apos;&quot;https://github.com/apache/arrow/blob/main/format/File.fbs&quot;&apos;&gt;File.fbs&lt;/a&gt; æ–‡ä»¶äº†è§£æ–‡ä»¶å°¾éƒ¨çš„å®šä¹‰ç»†èŠ‚ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¯­ä¹‰ä¸Šï¼Œæ–‡ä»¶æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;&amp;amp;lt;magic number &amp;amp;quot;ARROW1&amp;amp;quot;&amp;amp;gt;
&amp;amp;lt;empty padding bytes [to 8 byte boundary]&amp;amp;gt;
&amp;amp;lt;STREAMING FORMAT with EOS&amp;amp;gt;
&amp;amp;lt;FOOTER&amp;amp;gt;
&amp;amp;lt;FOOTER SIZE: int32&amp;amp;gt;
&amp;amp;lt;magic number &amp;amp;quot;ARROW1&amp;amp;quot;&amp;amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸ªæ–‡ä»¶æ ¼å¼å¹¶ä¸è¦æ±‚ &lt;code&gt;RecordBatch&lt;/code&gt; ä¸­ä½¿ç”¨çš„å­—å…¸ id è¦å®šä¹‰åœ¨å‰é¢çš„ &lt;code&gt;DictionaryBatch&lt;/code&gt; ä¸­ï¼Œä¸»è¦è¿™äº› id å®šä¹‰åœ¨æ–‡ä»¶çš„æŸå¤„å³å¯ã€‚æ­¤å¤–ï¼Œæ¯ä¸ªå­—å…¸ ID å¦‚æœå­˜åœ¨å¤šä¸ªéå¢é‡å­—å…¸ä¹Ÿæ˜¯æ— æ•ˆçš„ï¼ˆæ¯”å¦‚ï¼šä¸æ”¯æŒå­—å…¸è¦†ç›–æ›¿æ¢ï¼‰ã€‚å¢é‡å­—å…¸æŒ‰ç…§ä»–ä»¬åœ¨æ–‡ä»¶å°¾éƒ¨ä¸­å‡ºç°çš„é¡ºåºåº”ç”¨ç”Ÿæ•ˆã€‚ä»¥è¿™ç§æ ¼å¼åˆ›å»ºçš„æ–‡ä»¶æ¨èä½¿ç”¨ â€œ.arrowâ€ æ–‡ä»¶æ‰©å±•åã€‚è¯·æ³¨æ„è¿™ç§æ ¼å¼åˆ›å»ºçš„æ–‡ä»¶æœ‰æ—¶ä¹Ÿè¢«ç§°ä¸ºâ€œFeature V2â€ï¼Œä½¿ç”¨ â€œ.featureâ€ æ–‡ä»¶æ‰©å±•åï¼Œè¿™ä¸ªåç§°å’Œæ‰©å±•åæºè‡ªâ€œFeature ï¼ˆV1ï¼‰â€ - Arrow é¡¹ç›®æ—©æœŸä¸º Pythonï¼ˆPandasï¼‰ å’Œ R è¯­è¨€çš„è¯­è¨€æ— å…³å¿«é€Ÿæ•°æ®æ¡†ï¼ˆdata frameï¼‰å­˜å‚¨åšçš„ä¸€ä¸ªæ¦‚å¿µéªŒè¯ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦é™„ - File.fbs ä¸­ Footer å®šä¹‰ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;include &amp;amp;quot;Schema.fbs&amp;amp;quot;;

namespace org.apache.arrow.flatbuf;

/// ----------------------------------------------------------------------
/// Arrow æ–‡ä»¶å…ƒæ•°æ®
///

table Footer {
  version: org.apache.arrow.flatbuf.MetadataVersion;
  schema: org.apache.arrow.flatbuf.Schema;
  dictionaries: [ Block ];
  recordBatches: [ Block ];
  /// ç”¨æˆ·è‡ªå®šä¹‰å…ƒæ•°æ®
  custom_metadata: [ KeyValue ];
}

struct Block {
  /// Index to the start of the RecordBlock (note this is past the Message header)
  offset: long;
  /// Length of the metadata
  metaDataLength: int;
  /// Length of the data (this is aligned so there can be a gap between this and
  /// the metadata).
  bodyLength: long;
}

root_type Footer;&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;å­—å…¸ç¼–ç æ¶ˆæ¯&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å­—å…¸æ˜¯ä»¥æˆæ‰¹è®°å½•åºåˆ—çš„å½¢å¼å†™å…¥æµæˆ–è€…æ–‡ä»¶æ ¼å¼çš„ï¼Œå…¶æˆæ‰¹è®°å½•ä¸­ä»…åŒ…å«å•ä¸ªå­—æ®µåˆ—ã€‚å› æ­¤ï¼Œä¸€ä¸ªå­—å…¸æˆæ‰¹è®°å½•åºåˆ—çš„å®Œæ•´è¯­ä¹‰ schema åŒ…æ‹¬æ‰€æœ‰å­—å…¸å¸¦çš„ schemaã€‚æ‰€ä»¥å¿…é¡»å…ˆä»å­—å…¸æˆæ‰¹è®°å½•çš„ schema ä¸­è¯»å–å­—å…¸ç±»å‹ä¿¡æ¯ï¼Œæ‰èƒ½æ­£ç¡®åœ°å¯¹å­—å…¸æ•°æ®è¿›è¡Œè§£æç¿»è¯‘ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;table DictionaryBatch {
  id: long;
  data: RecordBatch;
  isDelta: boolean = false;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å­—å…¸æ¶ˆæ¯å…ƒæ•°æ®ä¸­çš„å­—å…¸ &lt;code&gt;id&lt;/code&gt; å¯ä»¥åœ¨æ•°æ®æˆæ‰¹è®°å½•çš„ schema ä¸­è¢«å¤šæ¬¡å¼•ç”¨ï¼Œå› æ­¤åŒä¸€ä¸ªå­—å…¸å¯ä»¥è¢«å¤šä¸ªæ•°æ®å­—æ®µåˆ—ä½¿ç”¨ã€‚å¯ä»¥é˜…è¯»&lt;a href=&apos;&quot;https://arrow.apache.org/docs/format/Columnar.html#dictionary-encoded-layout&quot;&apos;&gt;å­—å…¸ç¼–ç å†…å­˜å¸ƒå±€&lt;/a&gt;ä¸€èŠ‚äº†è§£å­—å…¸ç¼–ç æ•°æ®çš„è¯­ä¹‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å­—å…¸ &lt;code&gt;isDelta&lt;/code&gt; æ ‡å¿—ä½å…è®¸å¯¹å‰é¢å­˜åœ¨çš„å­—å…¸è¿›è¡Œæ‰©å±•ï¼Œä»¥ä¾¿æ”¯æŒåç»­æˆæ‰¹è®°å½•çš„è§£æã€‚å¦‚æœä¸€ä¸ªå­—å…¸æˆæ‰¹è®°å½•çš„ &lt;code&gt;isDelta&lt;/code&gt; è®¾ç½®ä¸ºçœŸï¼ˆtrueï¼‰ï¼Œåˆ™è¡¨ç¤ºå®ƒçš„å‘é‡æ•°æ®åº”è¯¥å’Œå‰é¢åŒ id çš„å­—å…¸æˆæ‰¹è®°å½•æ‹¼æ¥åœ¨ä¸€èµ·ã€‚å‡è®¾å¯¹ä¸€åˆ—æ•°æ®è¿›è¡Œæµå¼ç¼–ç ï¼Œè¯¥åˆ—æ•°æ®ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ &lt;code&gt;[&amp;quot;A&amp;quot;, &amp;quot;B&amp;quot;, &amp;quot;C&amp;quot;, &amp;quot;B&amp;quot;, &amp;quot;D&amp;quot;, &amp;quot;C&amp;quot;, &amp;quot;E&amp;quot;, &amp;quot;A&amp;quot;]&lt;/code&gt;ï¼Œå…¶å¢é‡ï¼ˆdeltaï¼‰å­—å…¸æˆæ‰¹è®°å½•çš„å½¢å¼å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;&amp;amp;lt;SCHEMA&amp;amp;gt;
&amp;amp;lt;DICTIONARY 0&amp;amp;gt;
(0) &amp;amp;quot;A&amp;amp;quot;
(1) &amp;amp;quot;B&amp;amp;quot;
(2) &amp;amp;quot;C&amp;amp;quot;

&amp;amp;lt;RECORD BATCH 0&amp;amp;gt;
0
1
2
1

&amp;amp;lt;DICTIONARY 0 DELTA&amp;amp;gt;
(3) &amp;amp;quot;D&amp;amp;quot;
(4) &amp;amp;quot;E&amp;amp;quot;

&amp;amp;lt;RECORD BATCH 1&amp;amp;gt;
3
2
4
0
EOS&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ–è€…ï¼Œå¦‚æœ &lt;code&gt;isDelta&lt;/code&gt; è¢«è®¾ç½®ä¸ºå‡ï¼ˆfalseï¼‰ï¼Œé‚£ä¹ˆåŒ ID çš„å­—å…¸ï¼Œåé¢çš„ä¼šè¦†ç›–æ›¿æ¢å‰é¢çš„ã€‚åŒæ ·ä½¿ç”¨å¦‚ä¸Šçš„ä¾‹å­ï¼Œå¯¹åº”ç¼–ç å½¢å¼å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;&amp;amp;lt;SCHEMA&amp;amp;gt;
&amp;amp;lt;DICTIONARY 0&amp;amp;gt;
(0) &amp;amp;quot;A&amp;amp;quot;
(1) &amp;amp;quot;B&amp;amp;quot;
(2) &amp;amp;quot;C&amp;amp;quot;

&amp;amp;lt;RECORD BATCH 0&amp;amp;gt;
0
1
2
1

&amp;amp;lt;DICTIONARY 0&amp;amp;gt;
(0) &amp;amp;quot;A&amp;amp;quot;
(1) &amp;amp;quot;C&amp;amp;quot;
(2) &amp;amp;quot;D&amp;amp;quot;
(3) &amp;amp;quot;E&amp;amp;quot;

&amp;amp;lt;RECORD BATCH 1&amp;amp;gt;
2
1
3
0
EOS&lt;/code&gt;&lt;/pre&gt;</description>
            <pubDate>2024-12-07</pubDate>
            <link>https://blog.xiayf.cn/posts/arrow-ipc.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/arrow-ipc.html</guid>
        </item>
        
        <item>
            <title>è¯»ç ï¼šLevelDB - æ‚é¡¹</title>
            <description>&lt;h2&gt;10ã€å…¶ä»–&lt;/h2&gt;
&lt;h3&gt;10.1 Env&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;leveldb å°† æ–‡ä»¶ç³»ç»Ÿ/æ—¶é—´/çº¿ç¨‹ ç­‰å’Œåº•å±‚ç³»ç»Ÿç›¸å…³çš„æ“ä½œéƒ½æŠ½è±¡å°è£…åˆ° Env ç±»ç»§æ‰¿ä½“ç³»ä¸­ï¼Œæå‡å¯ç§»æ¤æ€§ï¼Œé»˜è®¤æä¾›å¯¹ Posix å…¼å®¹ç³»ç»Ÿï¼ˆUnix/Linuxï¼‰çš„æ”¯æŒã€‚&lt;/p&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;Env* Env::Default() {  
  static PosixDefaultEnv env_container;  
  return env_container.env();  
}

// An implementation of Env that forwards all calls to another Env.  
// May be useful to clients who wish to override just part of the  
// functionality of another Env.  
class EnvWrapper : public Env {}
// A wrapper that allows injection of errors.  
class ErrorEnv : public EnvWrapper {}
class InMemoryEnv : public EnvWrapper {}
// Special Env used to delay background operations.  
class SpecialEnv : public EnvWrapper {
// Test Env to override default Env behavior for testing.  
class TestEnv : public EnvWrapper {

class PosixEnv : public Env {}&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;10.2 æ–‡ä»¶é”&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;leveldb åŸºäºæ–‡ä»¶é”æ¥é˜²æ­¢å¤šä¸ªè¿›ç¨‹æ‰“å¼€åŒä¸€ä¸ªæ•°æ®åº“ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ–‡ä»¶é”ä½¿ç”¨çš„æ–‡ä»¶åç§°ä¸º &lt;code&gt;LOCK&lt;/code&gt;ï¼Œå¯¹è¿™ä¸ªæ–‡ä»¶åŠ é”æˆåŠŸä¹‹åï¼Œæ‰èƒ½æ‰§è¡Œåç»­çš„é€»è¾‘ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;assert(db_lock_ == nullptr);
Status s = env_-&amp;amp;gt;LockFile(LockFileName(dbname_), &amp;amp;amp;db_lock_);  
if (!s.ok()) {  
  return s;  
}&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;// Lock the specified file.  Used to prevent concurrent access to  
// the same db by multiple processes.  On failure, stores nullptr in  
// *lock and returns non-OK.  
//  
// On success, stores a pointer to the object that represents the  
// acquired lock in *lock and returns OK.  The caller should call  
// UnlockFile(*lock) to release the lock.  If the process exits,  
// the lock will be automatically released.  
//  
// If somebody else already holds the lock, finishes immediately  
// with a failure.  I.e., this call does not wait for existing locks  
// to go away.  
//  
// May create the named file if it does not already exist.  
virtual Status LockFile(const std::string&amp;amp;amp; fname, FileLock** lock) = 0;&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åŸç†å‚è§ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;https://man7.org/linux/man-pages/man2/fcntl.2.html çš„ â€œAdvisory record lockingâ€ éƒ¨åˆ†&lt;/li&gt;
&lt;li&gt;&lt;a href=&apos;https://www.cnblogs.com/nufangrensheng/p/3554168.html&apos;&gt;é«˜çº§ I/O ä¹‹è®°å½•é”&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;int LockOrUnlock(int fd, bool lock) {  
  errno = 0;  
  struct ::flock file_lock_info;  
  std::memset(&amp;amp;amp;file_lock_info, 0, sizeof(file_lock_info));  
  file_lock_info.l_type = (lock ? F_WRLCK : F_UNLCK);  
  file_lock_info.l_whence = SEEK_SET;  
  file_lock_info.l_start = 0;  
  file_lock_info.l_len = 0;  // Lock/unlock entire file.  
  return ::fcntl(fd, F_SETLK, &amp;amp;amp;file_lock_info);  
}&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;cat client åŸºäº flock å‡½æ•°æ¥å®ç°æ–‡ä»¶é”ï¼ˆOpen file description locks (non-POSIX)ï¼‰ã€‚ä¸ leveldb é‡‡ç”¨çš„æ–‡ä»¶é”æ–¹å¼ï¼ŒåŒºåˆ«è§ fcntl æ–‡æ¡£è¯´æ˜ï¼š&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Open file description locks are advisory byte-range locks whose operation is in most respects identical to the traditional record locks described above.  This lock type is Linux-specific, and available since Linux 3.15.&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;The principal difference between the two lock types is that whereas traditional record locks are associated with a process, open file description locks are associated with the open file description on which they are acquired, much like locks acquired with &lt;a href=&apos;https://man7.org/linux/man-pages/man2/flock.2.html&apos;&gt;flock(2)&lt;/a&gt;.  Consequently (and unlike traditional advisory record locks), open file description locks are inherited across &lt;a href=&apos;https://man7.org/linux/man-pages/man2/fork.2.html&apos;&gt;fork(2)&lt;/a&gt; (and &lt;a href=&apos;https://man7.org/linux/man-pages/man2/clone.2.html&apos;&gt;clone(2)&lt;/a&gt; with &lt;strong&gt;CLONE_FILES&lt;/strong&gt;), and are only automatically released on the last close of the open file description, instead of being released on any close of the file.&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;...&lt;/p&gt;&lt;/blockquote&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;// cat-clientä¸­æ–‡ä»¶é”çš„å®ç°æ–¹å¼

try {
  lock_file_name_ = FLAGS_cat_multi_process ? std::to_string(getpid()) + FLAGS_cat_id_lock_file
                                            : FLAGS_cat_id_lock_file;

  file_lock_ = new FileLock(lock_file_name_);
  if (!file_lock_-&amp;amp;gt;TryLock()) {
    throw runtime_error(lock_file_name_ + &amp;amp;quot; is locked by another process&amp;amp;quot;);
  }
}
//
bool FileLock::TryLock() {
  //mode_t m = umask(0);
  fd_ = open(file_name_.c_str(), O_RDWR | O_CREAT, 0666);
  if (fd_ &amp;amp;gt;= 0 &amp;amp;amp;&amp;amp;amp; flock(fd_, LOCK_EX | LOCK_NB) &amp;amp;lt; 0) {
    close(fd_);
    fd_ = -1;
    return false;
  }
  return true;
}

bool FileLock::Unlock() {
  if (fd_ &amp;amp;lt; 0) {
    return true;
  }
  remove(file_name_.c_str());
  close(fd_);
  fd_ = -1;
  return true;
}&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;10.3 æ•´æ•°ç¼–ç &lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å®šé•¿ç¼–ç æ¯”è¾ƒç®€å•ï¼Œä½¿ç”¨å°ç«¯æ–¹å¼ï¼Œå°† 32 æ¯”ç‰¹æ•´æ•°æ‹†æˆ 4ä¸ª char å­˜å‚¨ï¼Œå°† 64 æ¯”ç‰¹æ•´æ•°æ‹†æˆ 8ä¸ªchar å­˜å‚¨ã€‚&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/jNUdmrhJYcvGany.png&apos; title=&apos;leveldb-fixed-coding&apos; alt=&apos;leveldb-fixed-coding&apos; width=&apos;600&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸å®šé•¿ç¼–ç ç¨å¾®æœ‰ç‚¹éº»çƒ¦ï¼Œæ¯8ä¸ªæ¯”ç‰¹éœ€è¦ä½¿ç”¨1ä¸ªæ¯”ç‰¹ä½æ¥æ ‡è¯†å½“å‰è¿™ä¸ªå­—èŠ‚æ˜¯å¦æ˜¯æœ€åä¸€ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯ char åºåˆ—ä¸­ï¼Œæ¯ä¸ªchar åªæœ‰å°¾éƒ¨7ä¸ªæ¯”ç‰¹ç”¨æ¥å­˜å‚¨éƒ¨åˆ†å€¼ï¼Œå¤´éƒ¨1æ¯”ç‰¹æ˜¯çŠ¶æ€ä½ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™æ„å‘³ç€ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;æ— ç¬¦å·32æ¯”ç‰¹æ•´æ•°ï¼Œä¸€æ—¦å¤§äº $2^{28}-1$ï¼Œå°±éœ€è¦5ä¸ªå­—èŠ‚æ¥å­˜å‚¨&lt;/li&gt;
&lt;li&gt;æ— ç¬¦å·64æ¯”ç‰¹æ•´æ•°ï¼Œä¸€æ—¦å¤§äº $2^{56}-1$ï¼Œå°±éœ€è¦9ä¸ªå­—èŠ‚æ¥å­˜å‚¨&lt;/li&gt;
&lt;li&gt;ä»å­˜å‚¨ç©ºé—´æ¥çœ‹ï¼Œå°±ä¸åˆ’ç®—äº†&lt;/li&gt;&lt;/ul&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/cJgo1ABkU6nfhC5.png&apos; title=&apos;leveldb-varint-coding&apos; alt=&apos;leveldb-varint-coding&apos; width=&apos;800&apos;/&gt;
&lt;h3&gt;10.4 æ–‡ä»¶ ID&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é™¤äº† LOCK / CURRENT / LOG æ–‡ä»¶ï¼Œå¯¹äºâ€œldb æ•°æ®æ–‡ä»¶â€ã€â€œWAL log æ–‡ä»¶â€ã€â€œMANIFEST-ç‰ˆæœ¬å˜æ›´æ—¥å¿—æ–‡ä»¶â€éƒ½ä½¿ç”¨æ•´æ•° id æ¥å‘½å(å›ºå®š6ä¸ªå­—ç¬¦å®½åº¦)ï¼Œæ¯”å¦‚ id ä¸º 123ï¼Œæ–‡ä»¶åå½¢å¼å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ldb æ•°æ®æ–‡ä»¶ï¼š&lt;code&gt;000123.ldb&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;WAL log æ–‡ä»¶ï¼š&lt;code&gt;000123.log&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;MANIFEST-ç‰ˆæœ¬å˜æ›´æ—¥å¿—æ–‡ä»¶ï¼š&lt;code&gt;MANIFEST-000123&lt;/code&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;id å…¨å±€è‡ªå¢ï¼Œç»Ÿä¸€åˆ†é…ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;// Allocate and return a new file number  
uint64_t NewFileNumber() { return next_file_number_++; }&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™æ ·çš„å¥½å¤„åœ¨äºï¼Œé™¤éçœŸçš„éœ€è¦è¯»å–æ–‡ä»¶æ—¶ï¼Œå…¶ä»–æ—¶å€™çš„é€»è¾‘å¯¹äºåŒä¸€ç§æ–‡ä»¶ç±»å‹çš„ä¸åŒæ–‡ä»¶éƒ½ä½¿ç”¨æ•´æ•° id æ¥åŒºåˆ†ï¼Œæ’åº/æ¯”è¾ƒç­‰å¤„ç†é€»è¾‘æ•ˆç‡æ›´é«˜ã€‚&lt;/p&gt;
&lt;h3&gt;10.5 Slice&lt;/h3&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;Slice&lt;/code&gt; is a simple structure that contains a length and a pointer to an external byte array. Returning a &lt;code&gt;Slice&lt;/code&gt; is a cheaper alternative to returning a &lt;code&gt;std::string&lt;/code&gt; since we do not need to copy potentially large keys and values. In addition, &lt;code&gt;leveldb&lt;/code&gt; methods do not return null-terminated C-style strings since &lt;code&gt;leveldb&lt;/code&gt; keys and values are allowed to contain &apos;\0&apos; bytes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;h3&gt;10.6 ç¼–ç¨‹æŠ€å·§&lt;/h3&gt;
&lt;h4&gt;10.6.1 GUARDED_BY - çº¿ç¨‹å®‰å…¨æ³¨è§£&lt;/h4&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;#ifndef GUARDED_BY  
#define GUARDED_BY(x) THREAD_ANNOTATION_ATTRIBUTE__(guarded_by(x))  
#endif&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;https://clang.llvm.org/docs/ThreadSafetyAnalysis.html&lt;/p&gt;&lt;/blockquote&gt;
&lt;h4&gt;10.6.2 å¼•ç”¨è®¡æ•°&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç±»ä¼¼ C++11 ä¹‹åçš„å…±äº«æŒ‡é’ˆï¼Œleveldb å¯¹ä¸€äº›ç±»ä½¿ç”¨å¼•ç”¨è®¡æ•°æ¥ç®¡ç†ç”Ÿå‘½å‘¨æœŸå’Œèµ„æºé‡Šæ”¾ã€‚å½“ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°å½’0æ—¶ï¼Œä¼šåˆ é™¤è‡ªå·±ï¼ˆ&lt;code&gt;delete this&lt;/code&gt;ï¼‰ï¼Œè§¦å‘ææ„å‡½æ•°ï¼Œå®Œæˆèµ„æºæ¸…ç†æ“ä½œã€‚&lt;/p&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;// Increase reference count.  
void Ref() { ++refs_; }  
  
// Drop reference count.  Delete if no more references exist.  
void Unref() {  
  --refs_;  
  assert(refs_ &amp;amp;gt;= 0);  
  if (refs_ &amp;amp;lt;= 0) {  
    delete this;  
  }  
}&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;å‚è€ƒ&amp;æ¨è&lt;/h2&gt;
&lt;ul&gt;&lt;li&gt;&lt;a href=&apos;https://github.com/google/leveldb/blob/main/doc/index.md&apos;&gt;leveldb è¯´æ˜æ–‡æ¡£&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&apos;https://github.com/google/leveldb/blob/main/doc/impl.md&apos;&gt;leveldb é€»è¾‘å®ç°è¯´æ˜&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&apos;https://github.com/google/leveldb/blob/main/doc/table_format.md&apos;&gt;leveldb ldb æ•°æ®æ–‡ä»¶ç¼–ç æ ¼å¼&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&apos;https://github.com/google/leveldb/blob/main/doc/log_format.md&apos;&gt;leveldb WAL log ç¼–ç æ ¼å¼&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&apos;https://opendatastructures.org/newhtml/ods/latex-saved-html/skiplists.html&apos;&gt;Open Data Structures - Skiplists&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&apos;https://en.wikipedia.org/wiki/Bloom_filter&apos;&gt;Wikipedia - Bloom filter&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&apos;https://man7.org/linux/man-pages/man2/fcntl.2.html&apos;&gt;fcntl(2) â€” Linux manual page&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ã€ŠThe Linux Programming Interfaceã€‹&lt;/li&gt;&lt;/ul&gt;</description>
            <pubDate>2024-11-23</pubDate>
            <link>https://blog.xiayf.cn/posts/leveldb-note-5.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/leveldb-note-5.html</guid>
        </item>
        
        <item>
            <title>è¯»ç ï¼šLevelDB - å¢åˆ æ”¹æŸ¥</title>
            <description>&lt;h2&gt;9ã€å¢åˆ æ”¹æŸ¥&lt;/h2&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/9Gh1agVoq2x6pBU.png&apos; title=&apos;lsm&apos; alt=&apos;lsm&apos; width=&apos;800&apos;/&gt;
&lt;h3&gt;9.1 å¢åˆ æ”¹&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äº leveldbï¼ˆlsm-tree å­˜å‚¨ç»“æ„ï¼‰æ¥è¯´ï¼Œå¢æ”¹æ“ä½œç»Ÿä¸€ä¸º put æ“ä½œï¼ˆæ”¹ä¹Ÿæ˜¯æ’å…¥ä¸€æ¡æ–°è®°å½•ï¼‰ï¼Œput æ“ä½œå’Œåˆ é™¤æ“ä½œåˆç»Ÿä¸€ä¸º write æ“ä½œï¼ˆåˆ é™¤æ˜¯å€¼ä¸ºç©ºçš„å†™å…¥æ“ä½œï¼‰ã€‚write æ“ä½œè¿‡ç¨‹ä¸º&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1ã€å…ˆå°†æ“ä½œè®°å½•ï¼ˆåŒ…æ‹¬åŸå§‹é”®å€¼ï¼‰å†™åˆ° WAL log æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;2ã€å°†æ“ä½œè®°å½•åˆ°å†…å­˜ä¸­å¯å˜ Memtable çš„è·³è¡¨ç»“æ„ä¸­&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å†™å…¥è¿‡ç¨‹éå¸¸ç®€å•ï¼Œæ‰€ä»¥ leveldb çš„å†™å…¥ååå¯ä»¥éå¸¸é«˜ã€‚ä¸è¿‡æœ‰3ä¸ªæ€§èƒ½è°ƒä¼˜ç‚¹å¯ä»¥æ³¨æ„ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1ã€å†™å…¥æ“ä½œå¯ä»¥æŒ‡å®šæ˜¯åŒæ­¥çš„ï¼ˆsyncï¼‰æˆ–è€…å¼‚æ­¥çš„ï¼Œè¿™é‡Œè¯´çš„&lt;u&gt;åŒæ­¥å¼‚æ­¥æ˜¯é’ˆå¯¹ WAL log æ–‡ä»¶å†™å…¥è€Œè¨€çš„&lt;/u&gt;ï¼Œéœ€è¦åœ¨ååæ€§èƒ½å’Œæ•°æ®ä¸€è‡´æ€§ä¹‹é—´åšå¥½å¹³è¡¡ï¼š
&lt;ul&gt;&lt;li&gt;å¦‚æœå†™å…¥æ“ä½œæŒ‡å®šä¸ºåŒæ­¥ï¼Œé‚£ä¹ˆå°†æ“ä½œè®°å½•åˆ° WAL log æ–‡ä»¶åï¼Œè¿˜è¦&lt;u&gt;ç¡®ä¿æ–‡ä»¶å†…å®¹æŒä¹…åŒ–åˆ°ç£ç›˜&lt;/u&gt;ï¼Œè¿™ä¸ªæŒä¹…åŒ–æ“ä½œå¯¹ leveldb çš„å†™å…¥ååå½±å“ä¼šæ¯”è¾ƒå¤§ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœå†™å…¥æ“ä½œæŒ‡å®šä¸º&lt;u&gt;éåŒæ­¥ï¼Œé‚£ä¹ˆå¯¹ WAL log çš„æ–‡ä»¶å†™å…¥ï¼Œå®é™…åªæ˜¯å†™åˆ°å†…æ ¸çš„æ–‡ä»¶ç¼“å†²åŒº&lt;/u&gt;ã€‚å¦‚æœå†™å…¥æ“ä½œè®°å½•åˆ°å¯å˜ Memtable å¹¶è¿”å›å†™å…¥æˆåŠŸçŠ¶æ€ç»™è°ƒç”¨æ–¹åï¼Œå†…æ ¸ç¼“å†²åŒºå†…å®¹åˆ·å‡ºåˆ°ç£ç›˜ä¹‹å‰ï¼Œç³»ç»Ÿ crash æˆ–è€…æœºå™¨æ‰ç”µéƒ½ä¼šå¯¼è‡´å†™å…¥æ•°æ®ä¸¢å¤±ï¼Œå­˜åœ¨å…ˆå†™åè¯»çš„ä¸€è‡´æ€§é—®é¢˜ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;ul&gt;&lt;li&gt;2ã€leveldb çš„å®ç°ä¸­ï¼Œå¯å˜ Memtable å¯¹è±¡å’Œä¸å¯å˜ Memtable å¯¹è±¡å‡åªæœ‰ä¸€ä¸ªï¼Œå¹¶ä¸” Memtable å¯¹è±¡çš„å†…å­˜å ç”¨å­˜åœ¨ä¸Šé™é˜ˆå€¼ï¼Œä¸€æ—¦å¯å˜ Memtable å†™æ»¡ä¸”ä¸å¯å˜ Memtable è¿˜å­˜åœ¨ï¼ˆè¿˜æ²¡æ¥å¾—åŠ minor compaction æˆ $level_0$ æ•°æ®æ–‡ä»¶ï¼‰ï¼Œé‚£ä¹ˆå†™å…¥å°±ä¼šè¢«é˜»å¡ï¼Œé‚£ä¹ˆï¼š
&lt;ul&gt;&lt;li&gt;å¯ä»¥é€‚å½“è°ƒå¤§ Memtable å†…å­˜å ç”¨çš„ä¸Šé™é˜ˆå€¼ï¼Œä½†ä¹Ÿä¸èƒ½è°ƒå¾—å¾ˆå¤§ï¼Œå› ä¸ºè¿™ä¼šå¯¼è‡´ compaction å‹åŠ›ä¼šæ¯”è¾ƒå¤§ï¼Œé—´æ¥å½±å“è¯»/æ£€ç´¢çš„æ€§èƒ½ï¼š
&lt;ul&gt;&lt;li&gt;å¦‚æœ $level_0$ æ–‡ä»¶å¾ˆå¤šï¼Œæ¥ä¸åŠ major compactionï¼Œè€Œè¿™äº›æ–‡ä»¶çš„ key åŒºé—´åˆå­˜åœ¨é‡åˆï¼Œå°±å¯èƒ½éœ€è¦æ£€ç´¢å¤šä¸ª $level_0$ æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;major compaction æ¶‰åŠè¾ƒå¤šçš„æ–‡ä»¶ç£ç›˜ I/Oï¼Œä»è€Œå¯èƒ½å½±å“æ£€ç´¢æ—¶çš„æ–‡ä»¶è¯»å–ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;ul&gt;&lt;li&gt;3ã€â€œä¸å¯å˜ Memtable å¯¹è±¡å‡åªæœ‰ä¸€ä¸ªâ€ å¦‚æœè°ƒæ•´ leveldb å®ç°æ”¯æŒå­˜åœ¨å¤šä¸ª ä¸å¯å˜ Memtable å¯¹è±¡ï¼Œå¯èƒ½å­˜åœ¨ä¼˜åŒ–ç©ºé—´ï¼›compaction ç›®å‰æ˜¯å•çº¿ç¨‹å¤„ç†çš„ï¼Œå¦‚æœè°ƒæ•´æˆæŸç§å¤šçº¿ç¨‹å®ç°ï¼Œå¯èƒ½ä¹Ÿå­˜åœ¨ä¼˜åŒ–ç©ºé—´ï¼Œä¸è¿‡å®ç°èµ·æ¥åº”è¯¥è¦å¤æ‚å¾—å¤šï¼Œå¹¶ä¸”ç£ç›˜ I/O ä¹Ÿå®¹æ˜“æˆä¸ºæ£€ç´¢æ€§èƒ½é€€åŒ–çš„å› ç´ ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/n1X4jVK9iztOBSJ.png&apos; title=&apos;IO-buffering&apos; alt=&apos;IO-buffering&apos; width=&apos;800&apos;/&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;å›¾ç‰‡æ‘˜è‡ªã€ŠThe Linux Programming Interfaceã€‹ä¸€ä¹¦ 244 é¡µã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äº WAL log éåŒæ­¥å†™å…¥ï¼Œleveldb ä¼šå°†å†…å®¹å…ˆå†™åˆ°ä¸€å—ç”¨æˆ·æ€å†…å­˜ç¼“å†²åŒºä¸­ï¼Œå¦‚æœç¼“å†²åŒºæ»¡ï¼Œåˆ™å…ˆè°ƒç”¨ &lt;code&gt;write&lt;/code&gt; ç³»ç»Ÿè°ƒç”¨å°†ç”¨æˆ·æ€ç¼“å†²åŒºå†…å®¹å†™åˆ°å†…æ ¸ç¼“å†²åŒºï¼ˆKernel buffer cacheï¼‰ï¼Œå°†å†…å®¹çš„å‰©ä½™éƒ¨åˆ†ç»§ç»­å†™åˆ°ç”¨æˆ·æ€å†…å­˜ç¼“å†²åŒºåï¼Œå°±è¿”å›ï¼›&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœæ˜¯åŒæ­¥å†™å…¥ï¼Œåˆ™ä¼šå†å°†ç”¨æˆ·æ€ç¼“å†²åŒºå†…å®¹ &lt;code&gt;write&lt;/code&gt; åˆ°å†…æ ¸ç¼“å†²åŒºåï¼Œå†è°ƒç”¨ &lt;code&gt;fsync&lt;/code&gt; ç³»ç»Ÿè°ƒç”¨ï¼Œå°†å†…æ ¸ç¼“å†²åŒºå†…å®¹åˆ·åˆ°ç£ç›˜ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;h3&gt;9.2 æŸ¥/èŒƒå›´æ‰«æ&lt;/h3&gt;
&lt;h4&gt;9.2.1 å¿«ç…§/snapshot&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;leveldb ä¸­æ¯ä¸ª Put/Delete æ“ä½œéƒ½è¢«åˆ†é…äº†ä¸€ä¸ªåºåˆ—å·ï¼ˆSequenceNumï¼‰ï¼Œè¿™ä¸ªåºåˆ—å·æ˜¯ä¸€ç§â€œLamport æ—¶é’Ÿâ€ æˆ–è€…è¯´ â€œé€»è¾‘æ—¶é—´æˆ³â€ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;leveldb æ”¯æŒå¯¹æ•°æ®åº“åšä¸€ä¸ªå¿«ç…§ï¼Œè¿™ä¸ªå¿«ç…§æ“ä½œéå¸¸è½»é‡ - å°±æ˜¯æœ€æ–°åˆ†é…åˆ†é…åºåˆ—å·ï¼ˆLastSequenceï¼‰ã€‚è¿™ä¸ªå¿«ç…§çš„å«ä¹‰ï¼šåºåˆ—å·å°äºç­‰äºLastSequenceçš„æ“ä½œéƒ½å±äºè¿™ä¸ªå¿«ç…§çš„ï¼Œå¤§äº LastSequence çš„æ“ä½œåˆ™ä¸å±äºè¿™ä¸ªå¿«ç…§ï¼Œæ˜¯åœ¨è¿™ä¸ªå¿«ç…§å‘ç”Ÿä¹‹åå‘ç”Ÿçš„ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;const Snapshot* DBImpl::GetSnapshot() {  
  MutexLock l(&amp;amp;amp;mutex_);  
  return snapshots_.New(versions_-&amp;amp;gt;LastSequence());  
}

// Abstract handle to particular state of a DB.  
// A Snapshot is an immutable object and can therefore be safely  
// accessed from multiple threads without any external synchronization.  
class LEVELDB_EXPORT Snapshot {  
 protected:  
  virtual ~Snapshot();  
};

// Snapshots are kept in a doubly-linked list in the DB.  
// Each SnapshotImpl corresponds to a particular sequence number.  
class SnapshotImpl : public Snapshot {  
 public:  
  SnapshotImpl(SequenceNumber sequence_number)  
      : sequence_number_(sequence_number) {}  
  
  SequenceNumber sequence_number() const { return sequence_number_; }  
  
 private:   
  // SnapshotImpl is kept in a doubly-linked circular list. The SnapshotList  
  // implementation operates on the next/previous fields directly.  SnapshotImpl* prev_;  
  SnapshotImpl* next_;  
  
  const SequenceNumber sequence_number_;
};&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;DBImpl&lt;/code&gt; å¯¹è±¡çš„ &lt;code&gt;snapshots_&lt;/code&gt; å­—æ®µä¸Šç»´æŠ¤ç€å¿«ç…§çš„é“¾è¡¨ï¼Œæ˜¯é¿å… compaction è¿‡ç¨‹æ¸…é™¤æ‰äº†å¿«ç…§ä¾èµ–çš„é”®å€¼æ•°æ®ã€‚æ¯”å¦‚ï¼Œå‡è®¾ä¸€æ¬¡å¿«ç…§çš„åºåˆ—å·ä¸º 123456ï¼Œå¯¹äº UK å­˜åœ¨åºåˆ—å· 123455 å’Œ åºåˆ—å· 123457 ä¸¤æ¬¡æ“ä½œï¼Œå¯¹äºè¿™æ¬¡å¿«ç…§è€Œè¨€ï¼Œåºåˆ—å· 123457 çš„æ“ä½œæ˜¯ä¸å¯è§çš„ï¼Œè¿™ä¸ªå¿«ç…§å­˜åœ¨æœŸé—´çš„ compaction è¿‡ç¨‹éƒ½éœ€è¦åŒæ—¶ä¿ç•™ UK çš„è¿™ä¸¤æ¬¡æ“ä½œã€‚è¿™ä¸ªå¿«ç…§é‡Šæ”¾ä¹‹åï¼Œcompaction å°±å¯ä»¥æŠŠåºåˆ—å· 123455 çš„æ“ä½œæ¸…é™¤æ‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å› æ­¤ï¼Œå¿«ç…§æœ¬èº«è™½ç„¶å¾ˆè½»é‡ï¼Œä¸è¿‡å¦‚æœé•¿æ—¶é—´ä¸é‡Šæ”¾ï¼Œä¼šå¯¼è‡´ç£ç›˜ç©ºé—´å ç”¨è†¨èƒ€ï¼Œå¯¹æ£€ç´¢æ€§èƒ½ä¹Ÿä¼šæœ‰ä¸€å®šçš„å½±å“ã€‚&lt;/p&gt;
&lt;h4&gt;9.2.2 ç‚¹æŸ¥&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æŒ‡å®š key è¿›è¡Œç‚¹æŸ¥çš„é€»è¾‘é¡ºåºä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1ã€ä»å¯å˜ Memtable çš„è·³è¡¨ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°å°±è¿”å›ç»™è°ƒç”¨æ–¹ï¼ˆå¦‚æœæ‰¾åˆ°çš„æ˜¯éåˆ é™¤è®°å½•ï¼Œåˆ™è¿”å›åºåˆ—å·æœ€å¤§çš„é‚£ä¸ªè®°å½•çš„å€¼ï¼Œä¸”è¿”å›çŠ¶æ€ä¸ºé»˜è®¤å€¼â€œæ‰¾åˆ°â€ï¼Œå¦‚æœæ‰¾åˆ°çš„æ˜¯åˆ é™¤è®°å½•ï¼Œåˆ™ä¿ç•™è¿”å›å€¼ä¸ºç©ºï¼Œè¿”å›çŠ¶æ€ä¸ºâ€œæœªæ‰¾åˆ°â€ï¼‰&lt;/li&gt;
&lt;li&gt;2ã€1 ä¸­æ²¡æ‰¾åˆ°ï¼Œåˆ™ç»§ç»­ä»ä¸å¯å˜ Memtable çš„è·³è¡¨ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°å°±è¿”å›ç»™è°ƒç”¨æ–¹&lt;/li&gt;
&lt;li&gt;2ã€2 ä¸­æ²¡æ‰¾åˆ°ï¼Œåˆ™ä» $level_0$ å¼€å§‹ä¾æ¬¡é€å±‚åœ¨æ•°æ®æ–‡ä»¶ä¸­æŸ¥æ‰¾ï¼Œ
&lt;ul&gt;&lt;li&gt;å› ä¸º $level_0$ æ•°æ®æ–‡ä»¶çš„ key åŒºé—´å¯ä»¥å­˜åœ¨é‡åˆï¼Œæ‰€ä»¥åœ¨ $level_0$ å±‚æ£€ç´¢å¯èƒ½ä¼šæ¶‰åŠå¤šä¸ªæ•°æ®æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;$level_1$~$level_n$ æ•°æ®æ–‡ä»¶çš„ key åŒºé—´ä¸ä¼šé‡åˆï¼Œæ‰€ä»¥æ ¹æ®æœ€æ–°ç‰ˆæœ¬ç»´æŠ¤çš„å¯¹åº”å±‚æ•°æ®æ–‡ä»¶å…ƒä¿¡æ¯åˆ—è¡¨æ‰¾åˆ°ç›®æ ‡æ•°æ®æ–‡ä»¶å³å¯ï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œåˆ™åˆ°ä¸‹ä¸€å±‚ç»§ç»­æ£€ç´¢&lt;/li&gt;
&lt;li&gt;æ‰¾åˆ°ç›®æ ‡æ•°æ®æ–‡ä»¶åï¼Œå…ˆå¯¹ç´¢å¼•å—äºŒåˆ†æŸ¥æ‰¾æ‰¾åˆ°ç›®æ ‡æ•°æ®å—ï¼Œå¦‚æœç›®æ ‡æ•°æ®è¡¨æ˜¯ç»è¿‡å‹ç¼©çš„ï¼Œåˆ™éœ€è¦å…ˆç»è¿‡è§£å‹ï¼Œç„¶åæ ¹æ®æ•°æ®å—ä¸­çš„é‡ç½®ä½ç‚¹åˆ—è¡¨ä¿¡æ¯ï¼Œä¾æ¬¡è¿›è¡Œ delta è§£ç éå†&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç‚¹æŸ¥æ“ä½œï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªä¹‹å‰è·å–çš„å¿«ç…§ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œåˆ™é»˜è®¤ä½¿ç”¨æœ€æ–°åˆ†é…çš„åºåˆ—å·ä½œä¸ºå¿«ç…§ï¼Œå®é™…æŸ¥æ‰¾è¿‡ç¨‹ä¼š&lt;u&gt;å°†å¿«ç…§ä¸­çš„åºåˆ—å·å’Œå­˜å‚¨è®°å½•ä¸­çš„åºåˆ—å·è¿›è¡Œæ¯”è¾ƒï¼Œåºåˆ—å·å¤§äºå¿«ç…§åºåˆ—å·çš„è®°å½•éƒ½ä¼šè¢«å¿½ç•¥&lt;/u&gt;ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æŸ¥æ‰¾é”®ï¼ˆLookupKeyï¼‰çš„ç¼–ç æ–¹å¼ï¼š&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/RqzHL35VbtpE9DT.png&apos; title=&apos;lookup-key-encode&apos; alt=&apos;lookup-key-encode&apos; width=&apos;600&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸ Memtable ä¸­è·³è¡¨èŠ‚ç‚¹ä¸­çš„ Key çš„ç¼–ç çš„åŒºåˆ«ä»…åœ¨äºä¸åŒ…å« value çš„é•¿åº¦å’Œ value å€¼ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;// A helper class useful for DBImpl::Get()  
class LookupKey {
public:
  // Initialize *this for looking up user_key at a snapshot with  
  // the specified sequence number.  
  LookupKey(const Slice&amp;amp;amp; user_key, SequenceNumber sequence);

  // Return a key suitable for lookup in a MemTable.  
  Slice memtable_key() const { return Slice(start_, end_ - start_); }

  // Return an internal key (suitable for passing to an internal iterator)  
  Slice internal_key() const { return Slice(kstart_, end_ - kstart_); }

  // Return the user key  
  Slice user_key() const { return Slice(kstart_, end_ - kstart_ - 8); }

private:
  // We construct a char array of the form:  
  //    klength  varint32               &amp;amp;lt;-- start_  
  //    userkey  char[klength]          &amp;amp;lt;-- kstart_  
  //    tag      uint64  
  //                                    &amp;amp;lt;-- end_  
  // The array is a suitable MemTable key.  
  // The suffix starting with &amp;amp;quot;userkey&amp;amp;quot; can be used as an InternalKey.  
  const char* start_;  
  const char* kstart_;  
  const char* end_;  
  char space_[200];  // Avoid allocation for short keys
}

LookupKey::LookupKey(const Slice&amp;amp;amp; user_key, SequenceNumber s) {  
  size_t usize = user_key.size();  
  size_t needed = usize + 13;  // A conservative estimate  
  char* dst;  
  if (needed &amp;amp;lt;= sizeof(space_)) {  
    dst = space_;  
  } else {  
    dst = new char[needed];  
  }  
  start_ = dst;  
  dst = EncodeVarint32(dst, usize + 8);  
  kstart_ = dst;  
  std::memcpy(dst, user_key.data(), usize);  
  dst += usize;  
  EncodeFixed64(dst, PackSequenceAndType(s, kValueTypeForSeek));  
  dst += 8;  
  end_ = dst;  
}

static uint64_t PackSequenceAndType(uint64_t seq, ValueType t) {  
  assert(seq &amp;amp;lt;= kMaxSequenceNumber);  
  assert(t &amp;amp;lt;= kValueTypeForSeek);  
  return (seq &amp;amp;lt;&amp;amp;lt; 8) | t;  
}&lt;/code&gt;&lt;/pre&gt;
&lt;h4&gt;9.2.3 å…¨åº“/èŒƒå›´æœ‰åºæ‰«æï¼ˆéå†ï¼‰&lt;/h4&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;class DB {
public:
 // Return a heap-allocated iterator over the contents of the database.  
 // The result of NewIterator() is initially invalid (caller must  
 // call one of the Seek methods on the iterator before using it).  
 //  
 // Caller should delete the iterator when it is no longer needed.  
 // The returned iterator should be deleted before this db is deleted.  
 virtual Iterator* NewIterator(const ReadOptions&amp;amp;amp; options) = 0; // æ¥å£
}

// å®ç°
Iterator* DBImpl::NewIterator(const ReadOptions&amp;amp;amp; options) {  
  SequenceNumber latest_snapshot;  
  uint32_t seed;  
  Iterator* iter = NewInternalIterator(options, &amp;amp;amp;latest_snapshot, &amp;amp;amp;seed);  
  return NewDBIterator(this, user_comparator(), iter,  
                       (options.snapshot != nullptr  
                            ? static_cast&amp;amp;lt;const SnapshotImpl*&amp;amp;gt;(options.snapshot)  
                                  -&amp;amp;gt;sequence_number()  
                            : latest_snapshot),  
                       seed);  
}

// è¿­ä»£å™¨æ¥å£å®šä¹‰
class Iterator {
public:
  // An iterator is either positioned at a key/value pair, or  
  // not valid.  This method returns true iff the iterator is valid.  
  virtual bool Valid() const = 0;

  // Position at the first key in the source.  The iterator is Valid()  
  // after this call iff the source is not empty.  
  virtual void SeekToFirst() = 0;

  // Position at the last key in the source.  The iterator is  
  // Valid() after this call iff the source is not empty.  
  virtual void SeekToLast() = 0;

  // Position at the first key in the source that is at or past target.  
  // The iterator is Valid() after this call iff the source contains  
  // an entry that comes at or past target.  
  virtual void Seek(const Slice&amp;amp;amp; target) = 0;

  // Moves to the next entry in the source.  After this call, Valid() is  
  // true iff the iterator was not positioned at the last entry in the source.  
  // REQUIRES: Valid()  
  virtual void Next() = 0;  
  
  // Moves to the previous entry in the source.  After this call, Valid() is  
  // true iff the iterator was not positioned at the first entry in source.  
  // REQUIRES: Valid()  
  virtual void Prev() = 0;  
  
  // Return the key for the current entry.  The underlying storage for  
  // the returned slice is valid only until the next modification of  
  // the iterator.  
  // REQUIRES: Valid()  
  virtual Slice key() const = 0;  
  
  // Return the value for the current entry.  The underlying storage for  
  // the returned slice is valid only until the next modification of  
  // the iterator.  
  // REQUIRES: Valid() 
  virtual Slice value() const = 0;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ‰åºéå†æ¥å£çš„ä½¿ç”¨æ–¹å¼ä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1ã€è°ƒç”¨ NewIterator æ¥å£è·å¾—è¿­ä»£å™¨å¯¹è±¡æŒ‡é’ˆ - &lt;code&gt;Iterator* iter&lt;/code&gt;ï¼Œ&lt;code&gt;options&lt;/code&gt; å‚æ•°ä¸­å¯ä»¥æŒ‡å®šå¿«ç…§ï¼Œå¦‚æœæœªæŒ‡å®šï¼Œåˆ™é»˜è®¤ä»¥æœ€æ–°åˆ†é…çš„åºåˆ—å·ä¸ºå¿«ç…§ã€‚&lt;/li&gt;
&lt;li&gt;2ã€è°ƒç”¨ è¿­ä»£å™¨å¯¹è±¡æŒ‡é’ˆ çš„ Seek ç›¸å…³æ¥å£ï¼Œåˆå§‹åŒ–éå†èµ·å§‹ä½ç½®çŠ¶æ€ï¼š
&lt;ul&gt;&lt;li&gt;SeekToFirstï¼šä¸æŒ‡å®šèµ·å§‹ keyï¼Œä»å¤´éƒ¨é¡ºåºéå†ï¼ˆä¸æ–­è°ƒç”¨ Nextï¼‰&lt;/li&gt;
&lt;li&gt;SeekToLastï¼šä¸æŒ‡å®šèµ·å§‹ keyï¼Œä»å°¾éƒ¨é€†åºéå†ï¼ˆä¸æ–­è°ƒç”¨ Prevï¼‰&lt;/li&gt;
&lt;li&gt;Seekï¼šæŒ‡å®šèµ·å§‹ keyï¼Œä»èµ·å§‹ key å¼€å§‹é¡ºåºéå†ï¼ˆä¸æ–­è°ƒç”¨ Nextï¼‰&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;3ã€è°ƒç”¨æ–¹æ ¹æ®è¿­ä»£å™¨çš„ &lt;code&gt;Valid()&lt;/code&gt; æ–¹æ³•è¿”å›åˆ¤æ–­æ˜¯å¦éå†ç»“æŸï¼Œæˆ–è€…æ ¹æ®æœ€æ–°éå†åˆ°çš„ key å€¼åšåˆ¤æ–­æ˜¯å¦è¦ç»“æŸéå†ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ‰åºï¼ˆé¡ºåºï¼‰éå†çš„å®ç°é€»è¾‘ç±»ä¼¼äº compaction è¿‡ç¨‹çš„ N è·¯å½’å¹¶ç®—æ³•ï¼Œåªä¸è¿‡ compaction æ¶‰åŠçš„ level å±‚ å’Œ level+1 å±‚è¾“å…¥æ•°æ®æ–‡ä»¶çš„ N è·¯å½’å¹¶æ’åºï¼Œè€Œæœ‰åºéå†åˆ™æ¶µç›–â€œå¯å˜ memtableâ€/â€œä¸å¯å˜ memtableâ€/â€œ$level_0$~$level_n$ æ‰€æœ‰å±‚æ•°æ®æ–‡ä»¶â€æ•°æ®åº“å®Œæ•´çŠ¶æ€ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1ã€å…ˆé’ˆå¯¹å„éƒ¨åˆ†æ•°æ®åˆ›å»ºå„è‡ªçš„è¿­ä»£å™¨ï¼š
&lt;ul&gt;&lt;li&gt;â€œå¯å˜ memtableâ€ ä¸€ä¸ªè¿­ä»£å™¨&lt;/li&gt;
&lt;li&gt;â€œä¸å¯å˜ memtableâ€ ä¸€ä¸ªè¿­ä»£å™¨&lt;/li&gt;
&lt;li&gt;$level_0$ å±‚ï¼Œå› ä¸ºä¸åŒæ–‡ä»¶çš„ key åŒºé—´å¯èƒ½ä¼šé‡åˆï¼Œæ‰€ä»¥ä¸€ä¸ªæ–‡ä»¶ä¸€ä¸ªè¿­ä»£å™¨&lt;/li&gt;
&lt;li&gt;$level_1$~$level_n$ å±‚ï¼Œå› ä¸ºä¸åŒæ–‡ä»¶çš„ key åŒºé—´ä¸ä¼šé‡åˆï¼Œæ‰€ä»¥ä¸€å±‚ä¸€ä¸ªè¿­ä»£å™¨ï¼ŒåŒä¸€å±‚çš„æ•°æ®æ–‡ä»¶æŒ‰ç…§ key åŒºé—´ä»å°åˆ°å¤§æ’åºåä¾æ¬¡éå†å³å¯&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;2ã€SeekToFirst / Seek çš„é€»è¾‘ï¼Œå³æ˜¯è®©å„ä¸ªè¿­ä»£å™¨å…ˆå„è‡ªè¿›è¡Œ SeekToFirst / Seekï¼Œç„¶åå¯¹è¿™äº›è¿­ä»£å™¨çš„è¯»åˆ°çš„é¦–ä¸ªå…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œè·å¾—æœ€å°çš„é‚£ä¸ªè®°å½•&lt;/li&gt;
&lt;li&gt;3ã€Next çš„é€»è¾‘ï¼Œè®©ä¸Šæ¬¡å–å¾—æœ€å°å…ƒç´ çš„é‚£ä¸ªè¿­ä»£å™¨å…ˆ Next ä¸€æ¬¡ï¼Œç„¶åå¯¹è¿™äº›è¿­ä»£å™¨çš„è¯»åˆ°çš„é¦–ä¸ªå…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œè·å¾—æœ€å°çš„é‚£ä¸ªè®°å½•&lt;/li&gt;
&lt;li&gt;4ã€å¯¹äº 2/3 ä¸­å–åˆ°çš„æœ€å°è®°å½•ï¼Œå› ä¸ºå­˜åœ¨å¿«ç…§çº¦æŸä»¥åŠåŒä¸€ä¸ª key å¯èƒ½å­˜åœ¨å¤šæ¬¡å†™å…¥ï¼ˆPut æˆ– Deleteï¼‰ï¼Œæ‰€ä»¥éœ€è¦ï¼š
&lt;ul&gt;&lt;li&gt;è·³è¿‡åºåˆ—å·å¤§äºå¿«ç…§åºåˆ—å·çš„è®°å½•&lt;/li&gt;
&lt;li&gt;åŒä¸€ä¸ª keyï¼šå¦‚æœæœ€åä¸€æ¬¡å†™å…¥æ˜¯ Delete æ“ä½œï¼Œåˆ™è·³è¿‡è¯¥ key çš„æ‰€æœ‰è®°å½•ï¼›å¦‚æœæœ€åä¸€æ¬¡å†™å…¥æ˜¯ Put æ“ä½œï¼Œåˆ™è·³è¿‡æœ€åä¸€æ¬¡ä¹‹å‰çš„æ‰€æœ‰è®°å½•ï¼›ä»è€Œç¡®ä¿åŒä¸€ä¸ª key åªä¼šéå†è¿”å›æœ€æ–°æœ‰æ•ˆçš„è®°å½•ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/5yrW6aOe7q1Iz2F.png&apos; title=&apos;leveldb-db-iterator&apos; alt=&apos;leveldb-db-iterator&apos; width=&apos;830&apos;/&gt;
&lt;h3&gt;9.4 è¡¨ç¼“å­˜ &amp; å—ç¼“å­˜&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¤šçº¿ç¨‹å¹¶å‘å¯¹ leveldb æ•°æ®åº“æ£€ç´¢ï¼ˆç‚¹æŸ¥/æœ‰åºéå†ï¼‰æ—¶ï¼Œæœ‰ä¸€äº›æ•°æ®æ–‡ä»¶ä¼šè¢«é¢‘ç¹è®¿é—®ï¼ˆå¤šçº¿ç¨‹ä¹‹é—´ä»¥åŠæ—¶åºä¸Šï¼‰ï¼Œå°†è¿™äº›æ–‡ä»¶çš„å¥æŸ„ä»¥åŠæ•°æ®ç´¢å¼•ç­‰å…ƒä¿¡æ¯ç¼“å­˜èµ·æ¥è¿›è¡Œå¤ç”¨ï¼Œå¯ä»¥æé«˜æ£€ç´¢æ€§èƒ½ï¼Œé™ä½èµ„æºæ¶ˆè€—ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦å¤–ï¼ŒæŒ‰ç…§ ldb æ–‡ä»¶â€œå—â€æ ¼å¼ï¼Œæ•°æ®å—å†…å®¹å†™å…¥æ–‡ä»¶ä¹‹å‰å¯ä»¥å…ˆè¿›è¡Œå‹ç¼©ï¼Œå¯èƒ½å­˜åœ¨ä¸€äº›çƒ­ç‚¹æ•°æ®å—ï¼Œå¦‚æœæ¯æ¬¡æ£€ç´¢éƒ½æ ¹æ®ç´¢å¼•&lt;u&gt;ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®å—å¹¶è§£å‹&lt;/u&gt;å†åšè¿›ä¸€æ­¥æŸ¥æ‰¾ï¼Œå¯¹æ€§èƒ½å’Œèµ„æºå¼€é”€å½±å“ä¼šæ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥åœ¨æ•°æ®å—çº§åˆ«åšç¼“å­˜ã€‚&lt;/p&gt;
&lt;h4&gt;9.4.1 TableCache - è¡¨ç¼“å­˜&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;leveldb ä¸­å­˜åœ¨ä¸¤ç±»è¡¨/Tableï¼Œé€»è¾‘å«ä¹‰æ˜¯ä¸€è‡´ï¼Œä¸è¿‡æŒ‡ä»£çš„ä¸œè¥¿ä¸ä¸€æ ·ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;MemTable ä¸­çš„è·³è¡¨&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ª ldb æ•°æ®æ–‡ä»¶æ‰“å¼€åå…³è”çš„å†…å­˜å¯¹è±¡ï¼Œæ–¹ä¾¿æ£€ç´¢&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;TableCache æ˜¯å¯¹â€œä¸€ä¸ª ldb æ•°æ®æ–‡ä»¶æ‰“å¼€åå…³è”çš„å†…å­˜å¯¹è±¡â€è¿›è¡Œç¼“å­˜ - ç¼“å­˜çš„é”®ä¸º ldb æ•°æ®æ–‡ä»¶çš„ idï¼Œå€¼ä¸º ldb æ•°æ®æ–‡ä»¶çš„ Table å¯¹è±¡ã€‚å®é™…çš„ç¼“å­˜å®ç°é‡‡ç”¨åˆ†ç‰‡/åˆ†æ®µ LRU ç¼“å­˜ï¼Œæå‡å¹¶å‘æ’å…¥/æ·˜æ±°èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;leveldb å®ä¾‹åœ¨ç‰ˆæœ¬ä¿¡æ¯ä¸­ç»´æŠ¤äº†æ‰€æœ‰ level ldb æ•°æ®æ–‡ä»¶çš„å…ƒä¿¡æ¯ - key åŒºé—´æœ€å¤§å€¼æœ€å°å€¼ã€æ•°æ®æ–‡ä»¶çš„ id ç­‰ã€‚æ£€ç´¢æ—¶ï¼Œ&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1ã€å…ˆæ ¹æ® key åŒ¹é…åˆ°ç›®æ ‡æ•°æ®æ–‡ä»¶çš„å…ƒä¿¡æ¯&lt;/li&gt;
&lt;li&gt;2ã€æ ¹æ®å…ƒä¿¡æ¯ä¸­çš„æ•°æ®æ–‡ä»¶ idï¼Œå» TableCache ä¸­æŸ¥æ‰¾å¯¹åº”çš„ Table å¯¹è±¡ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å…ˆæ‰“å¼€æ•°æ®æ–‡ä»¶ï¼Œè¯»å–è§£æ footer / index / meta / meta index è¿™äº›ç´¢å¼•ä¿¡æ¯ï¼Œå‡†å¤‡å¥½ Table å¯¹è±¡ï¼Œç¼“å­˜åˆ° TableCache ä¸­&lt;/li&gt;
&lt;li&gt;3ã€åŸºäº Table å¯¹è±¡ç»§ç»­è¿›è¡Œæ•°æ®æ–‡ä»¶å†…çš„æ£€ç´¢æµç¨‹&lt;/li&gt;&lt;/ul&gt;
&lt;img src=&apos;../plantuml-images/308888399600238653.svg&apos; title=&apos;308888399600238653&apos; alt=&apos;308888399600238653&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;leveldb é»˜è®¤å‚æ•°æ”¯æŒç¼“å­˜ 990 ä¸ª Tableï¼ŒShardedLRUCache é»˜è®¤åˆ†ç‰‡æ•°ä¸º 16ï¼ŒæŒ‰ç…§å…¬å¼è®¡ç®—ï¼Œæ¯ä¸ªåˆ†ç‰‡æ”¯æŒ ç¼“å­˜ 62 ä¸ª Tableã€‚&lt;/p&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;struct Options {
  // çœç•¥
  // Number of open files that can be used by the DB.  You may need to  
  // increase this if your database has a large working set (budget  
  // one open file per 2MB of working set).  
  int max_open_files = 1000;
  // çœç•¥
}

const int kNumNonTableCacheFiles = 10;

static int TableCacheSize(const Options&amp;amp;amp; sanitized_options) {  
  // Reserve ten files or so for other uses and give the rest to TableCache.  
  return sanitized_options.max_open_files - kNumNonTableCacheFiles;  
}&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;explicit ShardedLRUCache(size_t capacity) : last_id_(0) {  
  const size_t per_shard = (capacity + (kNumShards - 1)) / kNumShards;  
  for (int s = 0; s &amp;amp;lt; kNumShards; s++) {  
    shard_[s].SetCapacity(per_shard);  
  }  
}&lt;/code&gt;&lt;/pre&gt;
&lt;h4&gt;9.4.2 BlockCache - å—ç¼“å­˜&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;BlockCache çš„ç¼“å­˜å®ç°æ–¹æ¡ˆï¼Œå¯ä»¥ç”±è°ƒç”¨æ–¹å®ç°ï¼Œå¹¶åœ¨æ‰“å¼€ leveldb æ•°æ®åº“æ—¶åœ¨ Options å‚æ•°ä¸­æŒ‡å®šã€‚å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™é»˜è®¤ä½¿ç”¨å’Œ TableCache ä¸€æ ·çš„ç¼“å­˜å®ç° - ShardedLRUCacheï¼Œå¯ç¼“å­˜çš„ key æ•°é‡ä¸º &lt;code&gt;8 &amp;lt;&amp;lt; 20&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¹¶ä¸”éœ€è¦åœ¨æ£€ç´¢æ—¶çš„ ReadOptions å‚æ•°ä¸­æŒ‡å®šå¯ç”¨å—ç¼“å­˜ï¼ˆé»˜è®¤æ˜¯å¯ç”¨ï¼‰ï¼Œæ‰ä¼šå°†å—ç¼“å­˜ä¸­æ‰¾ä¸åˆ°çš„æ•°æ®å—è¯»å–åæ’å…¥ç¼“å­˜ä¸­ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;// Should the data read for this iteration be cached in memory?  
// Callers may wish to set this field to false for bulk scans.  
bool fill_cache = true;&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å—ç¼“å­˜ä½¿ç”¨çš„é”®ä¸º â€œç¼“å­˜ idâ€ æ‹¼æ¥ä¸Š æ•°æ®å—åœ¨æ–‡ä»¶ä¸­çš„åç§»ä½ç½®ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;char cache_key_buffer[16];  
EncodeFixed64(cache_key_buffer, table-&amp;amp;gt;rep_-&amp;amp;gt;cache_id);  
EncodeFixed64(cache_key_buffer + 8, handle.offset());  
Slice key(cache_key_buffer, sizeof(cache_key_buffer));  
cache_handle = block_cache-&amp;amp;gt;Lookup(key);&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;â€œç¼“å­˜ idâ€ å’Œ Table å¯¹è±¡å…³è”ï¼Œä¸åŒ Table å¯¹è±¡çš„â€œç¼“å­˜ idâ€ ä¸åŒï¼Œæ‰€ä»¥â€œç¼“å­˜ idâ€ ç”¨äºåœ¨åŒä¸€ä¸ªç¼“å­˜ä¸­åŒºåˆ†ä¸åŒæ•°æ®æ–‡ä»¶çš„æ•°æ®å—ã€‚ShardedLRUCache ç¼“å­˜å®ç°ä»¥é€’å¢æ•´æ•°çš„æ–¹å¼åˆ†é…â€œç¼“å­˜ idâ€ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;uint64_t NewId() override {  
  MutexLock l(&amp;amp;amp;id_mutex_);  
  return ++(last_id_);  
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;compaction è¿‡ç¨‹ä¼šå¯¹è¾“å…¥æ•°æ®æ–‡ä»¶è¿›è¡Œéå†ï¼Œå¹¶ä¸”ä½¿ç”¨çš„ä¹Ÿæ˜¯åŒä¸€ä¸ª TableCache å®ä¾‹å’Œå„ä¸ª Table å®ä¾‹ï¼Œå¦‚æœè¿™ä¸ªè¿‡ç¨‹ä¹Ÿå¯ç”¨å—ç¼“å­˜ï¼Œåˆ™ä¼šå¯¼è‡´å¤§é‡éçƒ­ç‚¹çš„æ•°æ®å—ç¼“å­˜èµ·æ¥ï¼Œå¯¹æ­£å¸¸æ£€ç´¢é€ æˆå¹²æ‰°ã€‚æ‰€ä»¥ &lt;u&gt;compaction è¿‡ç¨‹ä¼šå°† fill_cache è®¾ç½®ä¸º falseï¼Œå…³é—­ compaction è¾“å…¥éå†çš„å—ç¼“å­˜&lt;/u&gt;ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;// Control over blocks (user data is stored in a set of blocks, and  
// a block is the unit of reading from disk).  
  
// If non-null, use the specified cache for blocks.  
// If null, leveldb will automatically create and use an 8MB internal cache.  
Cache* block_cache = nullptr;  
  
// Approximate size of user data packed per block.  Note that the  
// block size specified here corresponds to uncompressed data.  The  
// actual size of the unit read from disk may be smaller if  
// compression is enabled.  This parameter can be changed dynamically.  
size_t block_size = 4 * 1024;&lt;/code&gt;&lt;/pre&gt;
&lt;h4&gt;9.4.3 ShardedLRUCache&lt;/h4&gt;
&lt;img src=&apos;../plantuml-images/12631314437766535650.svg&apos; title=&apos;12631314437766535650&apos; alt=&apos;12631314437766535650&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;HandleTable æ˜¯ä¸€ä¸ªâ€œé“¾æ¥æ³•ï¼ˆchainingï¼‰â€ å®ç°çš„å“ˆå¸Œè¡¨ï¼Œé»˜è®¤åˆå§‹åŒ– 4 ä¸ª bucketsï¼Œæ¯ä¸ª bucket åˆå§‹å€¼ä¸ºç©ºæŒ‡é’ˆï¼ŒæŒ‡é’ˆç±»å‹ä¸º &lt;code&gt;LRUHandle*&lt;/code&gt;ï¼Œå³å“ˆå¸Œè¡¨èŠ‚ç‚¹ç±»å‹ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;HandleTable ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;code&gt;length_&lt;/code&gt;ï¼šè¡¨ç¤ºå“ˆå¸Œè¡¨çš„å½“å‰å®¹é‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;elems_&lt;/code&gt;ï¼šè¡¨ç¤ºå½“å‰å“ˆå¸Œè¡¨ä¸­å­˜å‚¨çš„å…ƒç´ /èŠ‚ç‚¹ä¸ªæ•°ï¼Œå¦‚æœ &lt;code&gt;elems_&lt;/code&gt; è¶…è¿‡ &lt;code&gt;length_&lt;/code&gt;ï¼Œåˆ™æŒ‰å½“å‰å®¹é‡çš„2å€æ‰©å®¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;list_&lt;/code&gt;ï¼šå³ bucket æ•°ç»„ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;LRUHandle ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;code&gt;next_hash&lt;/code&gt; å­—æ®µï¼šæŒ‡å‘å½“å‰èŠ‚ç‚¹æ‰€åœ¨ bucket é“¾è¡¨çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;&lt;code&gt;next&lt;/code&gt; &amp; &lt;code&gt;pre&lt;/code&gt; å­—æ®µï¼šæŒ‡å‘èŠ‚ç‚¹åœ¨ LRU é“¾è¡¨ä¸­çš„å‰ç½®èŠ‚ç‚¹å’Œåç½®èŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;&lt;code&gt;hash&lt;/code&gt; å­—æ®µï¼šå­˜å‚¨ key çš„å“ˆå¸Œå€¼ï¼Œç”¨äºåŠ é€Ÿåœ¨ bucket é“¾è¡¨ä¸­éå†æŸ¥æ‰¾è¿‡ç¨‹&lt;/li&gt;
&lt;li&gt;&lt;code&gt;refs&lt;/code&gt;ï¼šèŠ‚ç‚¹è‡ªå·±çš„å¼•ç”¨è®¡æ•°ï¼Œåˆå§‹åŒ–æ—¶ä¼šè®¾ç½®ä¸º 1ï¼Œè¡¨ç¤ºè¢«ç¼“å­˜å¼•ç”¨ï¼›è°ƒç”¨æ–¹ä»ç¼“å­˜ä¸­è·å–åˆ°è¿™ä¸ªèŠ‚ç‚¹æ—¶ï¼Œè®¡æ•°ä¼šåŠ 1ï¼›è°ƒç”¨æ–¹ä¸å†ä½¿ç”¨æ—¶ä¼šè°ƒç”¨ &lt;code&gt;ShardedLRUCache::Release&lt;/code&gt; -&gt; &lt;code&gt;LRUCache::Release&lt;/code&gt; -&gt; &lt;code&gt;LRUCache::Unref&lt;/code&gt; å°†è®¡æ•°å‡1ï¼Œå¦‚æœå¼•ç”¨è®¡æ•°é‡æ–°å˜ä¸º1ï¼Œåˆ™è¡¨ç¤ºå½“å‰è¿™ä¸ªèŠ‚ç‚¹æ²¡æœ‰ä»»ä½•è°ƒç”¨æ–¹åœ¨ä½¿ç”¨ï¼Œä»…ç¼“å­˜æŒæœ‰å¼•ç”¨ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ShardedLRUCache æ˜¯ä¸€ä¸ªå¤šåˆ†ç‰‡çš„ LRU ç¼“å­˜å®ç°ï¼Œé»˜è®¤16ä¸ªåˆ†ç‰‡ï¼Œé€šè¿‡åˆ†æ®µé”æ¥å‡å°‘å¹¶å‘å†²çªï¼Œæå‡æ€§èƒ½ã€‚LRU ç¼“å­˜çš„æ£€ç´¢(Lookup)æˆ–æ’å…¥(Insert)ï¼Œéƒ½å…ˆè®¡ç®— key çš„å“ˆå¸Œå€¼ï¼Œå°†å“ˆå¸Œå€¼çš„å¤´éƒ¨4ä¸ªæ¯”ç‰¹çš„å€¼ä½œä¸ºåˆ†ç‰‡ idï¼Œç„¶ååœ¨ç›®æ ‡åˆ†ç‰‡ LRU ç¼“å­˜ä¸­æ£€ç´¢æˆ–æ’å…¥ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;LRUCache æ˜¯å®é™…çš„ LRU ç¼“å­˜å®ç°ï¼Œ&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;code&gt;HandleTable table_&lt;/code&gt;ï¼š å®é™…å­˜æ”¾ç¼“å­˜é¡¹çš„å“ˆå¸Œè¡¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;LRUHandle in_use_&lt;/code&gt;ï¼šå¦‚æœä¸€ä¸ªç¼“å­˜é¡¹è¢«æŸä¸ªè°ƒç”¨æ–¹å¼•ç”¨ï¼ˆrefs &gt; 1ï¼‰ï¼Œåˆ™ä¼šè¢«æ”¾å…¥ &lt;code&gt;in_use_&lt;/code&gt; é“¾è¡¨ä¸­ã€‚è¿™äº›ç¼“å­˜é¡¹ä¸ä¼šè¢« LRU å›æ”¶ï¼Œå¯¹äºè°ƒç”¨æ–¹æ¥è¯´æ˜¯å†…å­˜å®‰å…¨çš„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;LRUHandle lru_&lt;/code&gt;ï¼šå¦‚æœä¸€ä¸ªç¼“å­˜é¡¹ï¼ˆLRUHandleï¼‰ä¸å†è¢«ä»»ä½•è°ƒç”¨æ–¹å¼•ç”¨ï¼ˆrefs=1ï¼‰ï¼Œåˆ™å°†ä» &lt;code&gt;in_use_&lt;/code&gt; é“¾è¡¨ä¸­ç§»é™¤ï¼Œè¢«æ”¾å…¥ &lt;code&gt;lru_&lt;/code&gt; åŒå‘é“¾è¡¨ä¸­ï¼š
&lt;ul&gt;&lt;li&gt;è¿™äº›ç¼“å­˜é¡¹è¿˜è¢«ç¼“å­˜å¼•ç”¨ï¼Œå­˜åœ¨ &lt;code&gt;table_&lt;/code&gt; ä¸­&lt;/li&gt;
&lt;li&gt;æœ€æ–°æ”¾å…¥çš„æ”¾åœ¨é˜Ÿå°¾ - è¿™æ„å‘³ç€å¯¹å¤´çš„ç¼“å­˜é¡¹æ˜¯æœ€ä¹…æœªè¢«ä½¿ç”¨çš„ï¼Œå½“ç¼“å­˜é¡¹æ•°é‡è¶…é¢æ—¶ï¼Œåˆ™ä» &lt;code&gt;lru_&lt;/code&gt; é“¾è¡¨çš„å¤´éƒ¨å¼€å§‹é€ä¸ªç¼“å­˜é¡¹å›æ”¶&lt;/li&gt;
&lt;li&gt;å¦‚æœå…¶ä¸­çš„ç¼“å­˜é¡¹åæ¥è¢«è°ƒç”¨æ–¹å†æ¬¡æ£€ç´¢å¼•ç”¨ï¼Œåˆ™ä¼šä» &lt;code&gt;lru_&lt;/code&gt; ä¸­ç§»é™¤ï¼Œé‡æ–°æ”¾åˆ° &lt;code&gt;in_use_&lt;/code&gt; é˜Ÿå°¾&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;// Dummy head of LRU list.  
// lru.prev is newest entry, lru.next is oldest entry.  
// Entries have refs==1 and in_cache==true.  
LRUHandle lru_ GUARDED_BY(mutex_);  
  
// Dummy head of in-use list.  
// Entries are in use by clients, and have refs &amp;amp;gt;= 2 and in_cache==true.  
LRUHandle in_use_ GUARDED_BY(mutex_);  
  
HandleTable table_ GUARDED_BY(mutex_);&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;LRU ç¼“å­˜çš„å¸¸è§„ä½¿ç”¨æ–¹å¼ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1ã€å…ˆä»ç¼“å­˜ä¸­æ£€ç´¢ï¼ˆLookupï¼‰ï¼Œå¦‚æœæœªæ£€ç´¢åˆ°ï¼Œåˆ™ï¼š&lt;/li&gt;
&lt;li&gt;2ã€å‡†å¤‡å¥½ç¼“å­˜çš„é”®å€¼ï¼Œæ’å…¥ç¼“å­˜ï¼ˆInsertï¼‰ï¼Œå¾—åˆ°ç¼“å­˜é¡¹&lt;/li&gt;
&lt;li&gt;3ã€ä½¿ç”¨å®Œç¼“å­˜é¡¹åï¼Œé‡Šæ”¾å¼•ç”¨ï¼ˆReleaseï¼‰&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Lookup è¿‡ç¨‹ - å¦‚æœ HandleTable å“ˆå¸Œè¡¨ä¸­æ£€ç´¢åˆ°ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å¦‚æœç¼“å­˜é¡¹çš„å¼•ç”¨è®¡æ•°ä¸º 1ï¼Œè¡¨ç¤ºå½“å‰ç¼“å­˜é¡¹ä»…è¢« LRU ç¼“å­˜å¼•ç”¨ï¼ŒæŒ‚æ¥åœ¨ &lt;code&gt;lru_&lt;/code&gt; é“¾è¡¨ä¸Šï¼Œæ‰€ä»¥å°†å½“å‰ç¼“å­˜é¡¹ä» &lt;code&gt;lru_&lt;/code&gt; é“¾è¡¨ä¸Šæ‘˜é™¤ï¼ŒæŒ‚æ¥åˆ° &lt;code&gt;in_use_&lt;/code&gt; é“¾è¡¨é˜Ÿå°¾ï¼Œå¹¶å°†å¼•ç”¨è®¡æ•°åŠ 1&lt;/li&gt;
&lt;li&gt;å¦åˆ™å°†å¼•ç”¨è®¡æ•°åŠ 1 å³å¯&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Insert è¿‡ç¨‹ -&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1ã€æ„å»ºç¼“å­˜é¡¹ - ç”³è¯·å†…å­˜ï¼Œè®¾ç½®å„ä¸ªå­—æ®µçš„å€¼ï¼Œå¼•ç”¨è®¡æ•°è®¾ç½®ä¸º 1ï¼ˆInsert ä¼šæŠŠç¼“å­˜é¡¹è¿”å›ç»™è°ƒç”¨æ–¹ä½¿ç”¨ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;2ã€å°†ç¼“å­˜é¡¹å¼•ç”¨è®¡æ•°åŠ 1ï¼Œå¹¶æŒ‚æ¥åˆ° &lt;code&gt;in_use_&lt;/code&gt; çš„é˜Ÿå°¾ã€‚&lt;/li&gt;
&lt;li&gt;3ã€å°†ç¼“å­˜é¡¹æ’å…¥ HandleTable å“ˆå¸Œè¡¨ã€‚å¦‚æœå“ˆå¸Œè¡¨ä¸­å·²å­˜åœ¨ç›¸åŒçš„ keyï¼Œåˆ™è¿˜éœ€è¦é‡Šæ”¾ç¼“å­˜è‡ªå·±å¯¹åŸæœ‰ç¼“å­˜é¡¹çš„å¼•ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;4ã€å¦‚æœç¼“å­˜é¡¹æ•°é‡è¶…é¢ï¼Œåˆ™ä» &lt;code&gt;lru_&lt;/code&gt; é“¾è¡¨çš„å¤´éƒ¨å¼€å§‹é€ä¸ªå›æ”¶ç¼“å­˜é¡¹ï¼ˆå› ä¸ºè¿™äº›ç¼“å­˜é¡¹ä»…è¢«ç¼“å­˜è‡ªå·±å¼•ç”¨ï¼Œæ‰€ä»¥å¯ä»¥å®‰å…¨åœ°è¿›è¡Œå†…å­˜å›æ”¶ï¼‰ï¼Œç›´åˆ°ç¼“å­˜é¡¹æ•°é‡æœªè¶…é¢ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Release çš„è¿‡ç¨‹ -&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1ã€å°†ç¼“å­˜é¡¹çš„å¼•ç”¨è®¡æ•°å‡1ã€‚&lt;/li&gt;
&lt;li&gt;2ã€å°†ç¼“å­˜é¡¹ä» &lt;code&gt;in_use_&lt;/code&gt; é“¾è¡¨ä¸­æ‘˜é™¤ï¼ŒæŒ‚æ¥åˆ° &lt;code&gt;lru_&lt;/code&gt; é“¾è¡¨é˜Ÿå°¾ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;9.5ã€è¿‡æ»¤ç­–ç•¥-å¸ƒéš†è¿‡æ»¤å™¨&lt;/h3&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/If15V9oNdJHp8kW.png&apos; title=&apos;Bloom_filter_speed&apos; alt=&apos;Bloom_filter_speed&apos; width=&apos;600&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿‡æ»¤å™¨åŒ¹é…è¿”å› falseï¼Œå°±ä¸€å®šä¸åœ¨å­˜å‚¨ä¸­ï¼›å¦‚æœè¿”å› trueï¼Œæœ‰å°æ¦‚ç‡ä¸å¯¹ï¼ˆfalse positiveï¼‰&lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot; role=&quot;doc-noteref&quot;&gt;[1]&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;
&lt;img src=&apos;../plantuml-images/11015249355168551956.svg&apos; title=&apos;11015249355168551956&apos; alt=&apos;11015249355168551956&apos;/&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;class FilterPolicy {
public:  
 virtual ~FilterPolicy();  
  
 // Return the name of this policy.  Note that if the filter encoding  
 // changes in an incompatible way, the name returned by this method
 // must be changed.  Otherwise, old incompatible filters may be
 // passed to methods of this type.
 virtual const char* Name() const = 0;  
  
 // keys[0,n-1] contains a list of keys (potentially with duplicates)  
 // that are ordered according to the user supplied comparator.
 // Append a filter that summarizes keys[0,n-1] to *dst.
 //
 // Warning: do not change the initial contents of *dst.  Instead,
 // append the newly constructed filter to *dst.
 virtual void CreateFilter(const Slice* keys, int n,  
                           std::string* dst) const = 0;  
  
 // &amp;amp;quot;filter&amp;amp;quot; contains the data appended by a preceding call to  
 // CreateFilter() on this class.  This method must return true if
 // the key was in the list of keys passed to CreateFilter().
 // This method may return true or false if the key was not on the
 // list, but it should aim to return false with a high probability.
 virtual bool KeyMayMatch(const Slice&amp;amp;amp; key, const Slice&amp;amp;amp; filter) const = 0;
}

// Return a new filter policy that uses a bloom filter with approximately  
// the specified number of bits per key.  A good value for bits_per_key  
// is 10, which yields a filter with ~ 1% false positive rate.  
//  
// Callers must delete the result after any database that is using the  
// result has been closed.  
//  
// Note: if you are using a custom comparator that ignores some parts  
// of the keys being compared, you must not use NewBloomFilterPolicy()  
// and must provide your own FilterPolicy that also ignores the  
// corresponding parts of the keys.  For example, if the comparator  
// ignores trailing spaces, it would be incorrect to use a  
// FilterPolicy (like NewBloomFilterPolicy) that does not ignore  
// trailing spaces in keys.
const FilterPolicy* NewBloomFilterPolicy(int bits_per_key);&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;static uint32_t BloomHash(const Slice&amp;amp;amp; key) {  
  return Hash(key.data(), key.size(), 0xbc9f1d34);  
}  
  
class BloomFilterPolicy : public FilterPolicy {  
 public:  
  explicit BloomFilterPolicy(int bits_per_key) : bits_per_key_(bits_per_key) {  
    // We intentionally round down to reduce probing cost a little bit 
    /* llama3ï¼š
    åœ¨Bloomè¿‡æ»¤å™¨ä¸­ï¼Œå“ˆå¸Œå‡½æ•°æ¬¡æ•° k æ˜¯ä¸€ä¸ªé‡è¦å‚æ•°ï¼Œå®ƒå†³å®šäº†è¿‡æ»¤å™¨çš„å¤§å°å’Œç²¾åº¦ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œkè¶Šå¤§ï¼Œè¿‡æ»¤å™¨è¶Šå¤§ï¼Œä½†ä¹Ÿè¶Šå‡†ç¡®ï¼›åä¹‹ï¼Œkè¶Šå°ï¼Œè¿‡æ»¤å™¨è¶Šå°ï¼Œä½†ä¹Ÿè¶Šä¸å‡†ç¡®ã€‚
    åœ¨è¿™ä¸ªå®ç°ä¸­ï¼Œä¹˜ä»¥ 0.69 çš„ç›®çš„æ˜¯ä¸ºäº†è®¡ç®—å‡ºä¸€ä¸ªåˆé€‚çš„ k å€¼ï¼Œä½¿å¾—è¿‡æ»¤å™¨çš„å¤§å°å’Œç²¾åº¦è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ã€‚å…·ä½“æ¥è¯´ï¼Œä¹˜ä»¥ 0.69 æ˜¯ä¸ºäº†å°† bits_per_key å€¼ä¹˜ä»¥ä¸€ä¸ªè¾ƒå°çš„å€æ•°ï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªè¾ƒå°çš„ k å€¼ã€‚
    å¥½å¤„æ˜¯ï¼š
	1ã€å‡å°‘è¿‡æ»¤å™¨å¤§å°ï¼šé€šè¿‡ä¹˜ä»¥ 0.69ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªè¾ƒå°çš„ k å€¼ï¼Œè¿™æ„å‘³ç€è¿‡æ»¤å™¨çš„å¤§å°ä¹Ÿä¼šç›¸åº”å‡å°ã€‚è¿™å¯¹äºå­˜å‚¨å’Œä¼ è¾“è¿‡æ»¤å™¨æ¥è¯´æ˜¯ä¸€ä¸ªé‡è¦çš„è€ƒè™‘å› ç´ ã€‚
	2ã€æé«˜åŒ¹é…æ•ˆç‡ï¼šè™½ç„¶è¾ƒå°çš„ k å€¼å¯èƒ½å¯¼è‡´è¿‡æ»¤å™¨ä¸å‡†ç¡®ï¼Œä½†åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™ä¸ªå½±å“å¾€å¾€æ˜¯å¯ä»¥æ¥å—çš„ã€‚å› ä¸ºåŒ¹é…æ•ˆç‡ä¼šå¤§å¹…æé«˜ï¼Œç‰¹åˆ«æ˜¯åœ¨è¿‡æ»¤å™¨å¤§å°ç›¸å¯¹è¾ƒå°æ—¶ã€‚
	3ã€å¹³è¡¡ç²¾åº¦å’Œå¤§å°ï¼šä¹˜ä»¥ 0.69 çš„æ–¹æ³•å¯ä»¥å¸®åŠ©æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„ k å€¼ï¼Œä½¿å¾—è¿‡æ»¤å™¨çš„å¤§å°å’Œç²¾åº¦è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ã€‚è¿™å¯¹äºå®é™…åº”ç”¨æ¥è¯´éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒå¯ä»¥ç¡®ä¿è¿‡æ»¤å™¨æ—¢èƒ½å‡†ç¡®åˆèƒ½é«˜æ•ˆã€‚
    */
    k_ = static_cast&amp;amp;lt;size_t&amp;amp;gt;(bits_per_key * 0.69);  // 0.69 =~ ln(2)  
    if (k_ &amp;amp;lt; 1) k_ = 1;  
    if (k_ &amp;amp;gt; 30) k_ = 30;  
  }  
  
  const char* Name() const override { return &amp;amp;quot;leveldb.BuiltinBloomFilter2&amp;amp;quot;; }  
  
  void CreateFilter(const Slice* keys, int n, std::string* dst) const override {  
    // Compute bloom filter size (in both bits and bytes)  
    size_t bits = n * bits_per_key_;  
  
    // For small n, we can see a very high false positive rate.  Fix it  
    // by enforcing a minimum bloom filter length.
    if (bits &amp;amp;lt; 64) bits = 64;  
  
    size_t bytes = (bits + 7) / 8;  
    bits = bytes * 8;  
  
    const size_t init_size = dst-&amp;amp;gt;size();  
    dst-&amp;amp;gt;resize(init_size + bytes, 0);  
    dst-&amp;amp;gt;push_back(static_cast&amp;amp;lt;char&amp;amp;gt;(k_));  // Remember # of probes in filter  
    char* array = &amp;amp;amp;(*dst)[init_size];  
    for (int i = 0; i &amp;amp;lt; n; i++) {  
      // Use double-hashing to generate a sequence of hash values.  
      // See analysis in [Kirsch,Mitzenmacher 2006].
      uint32_t h = BloomHash(keys[i]);  
      const uint32_t delta = (h &amp;amp;gt;&amp;amp;gt; 17) | (h &amp;amp;lt;&amp;amp;lt; 15);  // Rotate right 17 bits  
      for (size_t j = 0; j &amp;amp;lt; k_; j++) {  // ç®— k_ æ¬¡å“ˆå¸Œä»¥åŠè®¾ç½® k_ ä¸ªæ¯”ç‰¹ä½
        const uint32_t bitpos = h % bits;  
        // ç¬¬å‡ ä¸ªå­—èŠ‚ï¼Ÿbitpos / 8
        // ç›®æ ‡å­—èŠ‚ä¸­çš„ç¬¬å‡ ä¸ªæ¯”ç‰¹ï¼Ÿ bitpos % 8
        array[bitpos / 8] |= (1 &amp;amp;lt;&amp;amp;lt; (bitpos % 8));  
        h += delta;  // æ¯æ¬¡å“ˆå¸Œå€¼æœ‰å˜åŒ–
      }  
    }  
  }  
  
  bool KeyMayMatch(const Slice&amp;amp;amp; key, const Slice&amp;amp;amp; bloom_filter) const override {  
    const size_t len = bloom_filter.size();  
    if (len &amp;amp;lt; 2) return false;  
  
    const char* array = bloom_filter.data();  
    const size_t bits = (len - 1) * 8;  
  
    // Use the encoded k so that we can read filters generated by  
    // bloom filters created using different parameters.
    const size_t k = array[len - 1];  
    if (k &amp;amp;gt; 30) {  
      // Reserved for potentially new encodings for short bloom filters.  
      // Consider it a match.
      return true;  
    }  
  
    uint32_t h = BloomHash(key);  
    const uint32_t delta = (h &amp;amp;gt;&amp;amp;gt; 17) | (h &amp;amp;lt;&amp;amp;lt; 15);  // Rotate right 17 bits  
    for (size_t j = 0; j &amp;amp;lt; k; j++) {  
      const uint32_t bitpos = h % bits;  
      if ((array[bitpos / 8] &amp;amp;amp; (1 &amp;amp;lt;&amp;amp;lt; (bitpos % 8))) == 0) return false;  // ä»»ä¸€æ¯”ç‰¹ä½ä¸åŒ¹é…ï¼Œå°±ç®—ä¸åŒ¹é…ã€‚
      h += delta;  
    }  
    return true;  
  }  
  
 private:  
  size_t bits_per_key_;  
  size_t k_;  
};&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;const int32_t KEY_VALIDATOR_BYTE_SIZE = 128 * 1024 * 1024;  // 128M
const uint64_t KEY_VALIDATOR_VALUE_MASK = 0x3fffffff;  // 30bit
const uint64_t KEY_VALIDATOR_BIT_MASK = 0x07;  
const uint8_t KEY_VALIDATOR_ONE = 1;

const uint8_t KEY_VALIDATOR_LOCK_COUNT = 32;
const uint8_t KEY_VALIDATOR_LOCK_MASK = KEY_VALIDATOR_LOCK_COUNT - 1;

class KeyValidator {
public:
    static KeyValidator&amp;amp;amp; Instance() {
        static KeyValidator instance;
        return instance;
    }

    ~KeyValidator() {
        if (bitmap_data_) {
            delete [] bitmap_data_;
            bitmap_data_ = nullptr;
        }
    }

    bool IsInitialized() {
        return (bitmap_data_ != nullptr);
    }

    bool Init() {
        if (!bitmap_data_) {
            bitmap_data_ = new uint8_t[KEY_VALIDATOR_BYTE_SIZE];
        }
        std::memset(bitmap_data_, 0, KEY_VALIDATOR_BYTE_SIZE);
        // need to catch bad_alloc ?
        LOG(WARNING) &amp;amp;lt;&amp;amp;lt; &amp;amp;quot;KeyValidator initialized succ.&amp;amp;quot;;
        return true;
    }

    bool Update(uint64_t key_id) {
        if (!bitmap_data_) {
            LOG(ERROR) &amp;amp;lt;&amp;amp;lt; &amp;amp;quot;bitmap_data not initialized!&amp;amp;quot;;
            return false;
        }
        uint64_t byte_index = 0;
        uint8_t bit_mask = 0;
        GetByteIndex(key_id, byte_index, bit_mask);
        // lock to ensure multi-thread write
        auto&amp;amp;amp; lock = spin_locks[byte_index &amp;amp;amp; KEY_VALIDATOR_LOCK_MASK];
        lock.Lock();
        bitmap_data_[byte_index] |= bit_mask;
        lock.UnLock();
        return true;
    }

    bool IsValid(uint64_t key_id) {
        if (!bitmap_data_) {
            LOG(ERROR) &amp;amp;lt;&amp;amp;lt; &amp;amp;quot;bitmap_data not initialized!&amp;amp;quot;;
            return false;
        }
        uint64_t byte_index = 0;
        uint8_t bit_mask = 0;
        GetByteIndex(key_id, byte_index, bit_mask);
        return (bitmap_data_[byte_index] &amp;amp;amp; bit_mask);
    }


    bool GetValidKeys(const std::vector&amp;amp;lt;int64_t&amp;amp;gt;&amp;amp;amp; key_list,
                std::vector&amp;amp;lt;int64_t&amp;amp;gt;&amp;amp;amp; result) {
        result.clear();
        result.reserve(key_list.size());
        for (auto&amp;amp;amp; key_id : key_list) {
            if (IsValid(key_id)) {
                result.push_back(key_id);
            }
        }
        return true;
    }

private:
    uint8_t* bitmap_data_ = nullptr;
    std::vector&amp;amp;lt;psarlib::synchronization::SpinLock&amp;amp;gt; spin_locks;

    KeyValidator()
    : spin_locks(KEY_VALIDATOR_LOCK_COUNT) {}

    void GetByteIndex(uint64_t key_id, uint64_t&amp;amp;amp; byte_index, uint8_t&amp;amp;amp; bit_mask) {
        auto value = key_id &amp;amp;amp; KEY_VALIDATOR_VALUE_MASK;
        byte_index = value &amp;amp;gt;&amp;amp;gt; 3;                          // divide by 8
        auto bit_index = value &amp;amp;amp; KEY_VALIDATOR_BIT_MASK;  // mod by 8
        bit_mask = (KEY_VALIDATOR_ONE &amp;amp;lt;&amp;amp;lt; bit_index);
    }
};&lt;/code&gt;&lt;/pre&gt;
&lt;hr&gt;
&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;&lt;ol&gt;&lt;li id=&quot;fn:1&quot;&gt;&lt;p&gt;&lt;a href=&apos;https://hur.st/bloomfilter/&apos;&gt;Bloom Filter Calculator&lt;/a&gt;&lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;â†©&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/div&gt;</description>
            <pubDate>2024-11-20</pubDate>
            <link>https://blog.xiayf.cn/posts/leveldb-note-4.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/leveldb-note-4.html</guid>
        </item>
        
        <item>
            <title>è¯»ç ï¼šLevelDB - Compaction æµç¨‹</title>
            <description>&lt;h2&gt;6ã€$level_0$ &amp; $level_1$~$level_n$&lt;/h2&gt;
&lt;h3&gt;6.1 $level_0$&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;$level_0$ ldb æ•°æ®æ–‡ä»¶ï¼Œæ˜¯å°†å†…å­˜ä¸­ä¸å¯å˜ memtable çš„æ•°æ®è½åˆ°ç£ç›˜ç”Ÿæˆçš„ã€‚&lt;strong&gt;è¿™äº›æ•°æ®æ–‡ä»¶çš„ key èŒƒå›´ä¼šæœ‰é‡åˆ&lt;/strong&gt;ã€‚leveldb ä¼šè®°å½•æ¯ä¸ª ldb æ–‡ä»¶å¯¹åº”çš„ key æœ€å°å€¼å’Œæœ€å¤§å€¼ç­‰å…ƒä¿¡æ¯ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;class Version {
private:
  // List of files per level  
  std::vector&amp;amp;lt;FileMetaData*&amp;amp;gt; files_[config::kNumLevels];
}

struct FileMetaData {  
  FileMetaData() : refs(0), allowed_seeks(1 &amp;amp;lt;&amp;amp;lt; 30), file_size(0) {}  
  
  int refs;  
  int allowed_seeks;  // Seeks allowed until compaction  
  uint64_t number;  
  uint64_t file_size;    // File size in bytes  
  InternalKey smallest;  // Smallest internal key served by table  
  InternalKey largest;   // Largest internal key served by table  
};&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;$level_0$ ldb æ–‡ä»¶çš„æ•°æ®å†…å®¹æºè‡ªï¼šéå†â€œä¸å¯å˜ memtableâ€ ä¸­è·³è¡¨çš„ $L_0$ å±‚èŠ‚ç‚¹ï¼Œæ’å…¥â€œdata å—â€ã€‚è·³è¡¨çš„ $L_0$ å±‚èŠ‚ç‚¹é“¾è¡¨æœ¬å°±æ˜¯æœ‰åºçš„ï¼Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„ key å³ä¸º æœ€å° keyï¼Œæœ€åä¸€ä¸ªèŠ‚ç‚¹çš„ key å³ä¸º æœ€å¤§ keyã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Get key æ£€ç´¢æ—¶ï¼Œå¯¹äº $level_0$ å±‚ï¼Œå…ˆå¯¹æ‰€æœ‰ ldb æ–‡ä»¶çš„æœ€å° key æœ€å¤§ key è¿›è¡Œæ¯”è¾ƒï¼ŒåŒ¹é…åˆ°æ‰€æœ‰ç›®æ ‡ ldb æ–‡ä»¶ï¼Œå¹¶æŒ‰æ–‡ä»¶ id åºå·ä»å¤§åˆ°å°æ’åºï¼ˆ&lt;u&gt;æ–‡ä»¶ id åºå·è¶Šå¤§ï¼Œè¯´æ˜æ–‡ä»¶è¶Šæ–°&lt;/u&gt;ï¼‰ï¼Œä»æœ€æ–°çš„ç›®æ ‡ ldb æ–‡ä»¶å¼€å§‹æ£€ç´¢ï¼Œæ‰¾åˆ°äº†å°±è¿”å›ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸ºäº†ä¿éšœæ£€ç´¢æ•ˆç‡ï¼Œleveldb ä¼šé€šè¿‡ major compaction è¿‡ç¨‹å°½é‡æ§åˆ¶ä½ level0 çš„æ–‡ä»¶æ•°ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å¦‚æœ$level_0$ æ–‡ä»¶æ•°è¶…è¿‡ kL0_CompactionTriggerï¼ˆ=4ï¼‰ï¼Œå°±å¯ä»¥è§¦å‘ compactionã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœ $level_0$ æ–‡ä»¶æ•°è¶…è¿‡ kL0_SlowdownWritesTriggerï¼ˆ=8ï¼‰ï¼Œå°±ä¼šå¯¹å†™å…¥è¿›è¡Œé™é€Ÿå’Œæ”’æ‰¹ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœ $level_0$ æ–‡ä»¶æ•°è¶…è¿‡ kL0_StopWritesTriggerï¼ˆ=12ï¼‰ï¼Œå†™å…¥å°±ä¼šåœé¡¿ï¼Œç­‰å¾… compactionã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;6.2 $level_1$~$level_n$&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;$level_1$~$level_n$ çš„æ•°æ®æ–‡ä»¶æ˜¯ä» $level_0$ å¼€å§‹é€å±‚ compaction è€Œæ¥ï¼Œè¿™äº›æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;åŒä¸€å±‚å†…çš„æ–‡ä»¶ä¹‹é—´ key çš„åŒºé—´ä¸ä¼šå‡ºç°é‡åˆï¼Œè¿™æ ·å¯ä»¥å‡å°‘ç£ç›˜è¯»å–ï¼Œæå‡æ£€ç´¢æ•ˆç‡ï¼›ä¸åŒå±‚çš„æ–‡ä»¶ä¹‹é—´ key åŒºé—´å¯ä»¥é‡åˆã€‚ &lt;u&gt;compaction çš„é€»è¾‘éœ€è¦ä¿éšœè¿™ä¸ªæ€§è´¨&lt;/u&gt;ã€‚&lt;/li&gt;
&lt;li&gt;$level_k$ æ–‡ä»¶çš„å†…å®¹ä¸€å®šæ¯” $level_{k-1}$ æ–‡ä»¶çš„å†…å®¹æ—§ï¼Œæ‰€ä»¥å¦‚æœåœ¨ $level_{k-1}$ å±‚æ£€ç´¢æœ‰äº†ç»“æœï¼Œå°±ä¸å¿…åˆ° $level_k$ å±‚æ£€ç´¢ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ compaction è¿‡ç¨‹ä¸­å¯¹äºåŒä¸€ä¸ª key ä¼šå°½å¯èƒ½ä¸¢æ‰æ—§çš„é”®å€¼æ•°æ®ï¼Œä»¥æ­¤ï¼Œå‡å°‘ç£ç›˜å ç”¨ï¼Œæå‡æ£€ç´¢æ•ˆç‡ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;h2&gt;7ã€Compaction&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;compaction è¿‡ç¨‹ï¼Œä½œä¸ºä»»åŠ¡ï¼Œç”±ä¸€ä¸ªç‹¬ç«‹çš„åå°çº¿ç¨‹æ¥æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;compaction ä¸»è¦åˆ†ä¸¤ 2 ç§ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1ã€â€œminor compactionâ€ - å†…å­˜ä¸­çš„ â€œä¸å¯å˜ memtableâ€ è½¬å­˜åˆ° $level_0$ æ–‡ä»¶ã€‚è¿™ä¸ª compaction ä¼˜å…ˆçº§æ›´é«˜ï¼Œæ‰€ä»¥ä¸€æ—¦æ£€æµ‹åˆ°å­˜åœ¨â€œä¸å¯å˜ memtableâ€å°±ä¼˜å…ˆå¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;2ã€â€œmajor compactionâ€ - $level_0$ ~ $level_n$ é€å±‚ä¹‹é—´çš„ compactionã€‚å…¶ä¸­ $level_0$ ä¸ $level_1$ ~ $level_n$ ä¸åŒï¼Œ$level_0$ æ•°æ®æ–‡ä»¶ä¹‹é—´ key åŒºé—´å­˜åœ¨é‡åˆï¼Œå¤„ç†é€»è¾‘ä¸Šå­˜åœ¨ç‰¹æ®Šä¹‹å¤„ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;â€œminor compactionâ€ æµç¨‹æ¯”è¾ƒç®€å•ç›´æ¥ï¼Œåç»­ä¸ç»†è¯´ã€‚&lt;/p&gt;
&lt;h3&gt;7.1 major compaction è§¦å‘æ¡ä»¶&lt;/h3&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;// We prefer compactions triggered by too much data in a level over  
// the compactions triggered by seeks.  
const bool size_compaction = (current_-&amp;amp;gt;compaction_score_ &amp;amp;gt;= 1);  
const bool seek_compaction = (current_-&amp;amp;gt;file_to_compact_ != nullptr);&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;void VersionSet::Finalize(Version* v) {  
  // Precomputed best level for next compaction  
  int best_level = -1;  
  double best_score = -1;  
  
  for (int level = 0; level &amp;amp;lt; config::kNumLevels - 1; level++) {  
    double score;  
    if (level == 0) {  
      // We treat level-0 specially by bounding the number of files  
      // instead of number of bytes for two reasons:
      // 
      // (1) With larger write-buffer sizes, it is nice not to do too
      // many level-0 compactions.
      //
      // (2) The files in level-0 are merged on every read and
      // therefore we wish to avoid too many files when the individual
      // file size is small (perhaps because of a small write-buffer
      // setting, or very high compression ratios, or lots of
      // overwrites/deletions).
      score = v-&amp;amp;gt;files_[level].size() /  
              static_cast&amp;amp;lt;double&amp;amp;gt;(config::kL0_CompactionTrigger);  
    } else {  
      // Compute the ratio of current size to size limit.  
      const uint64_t level_bytes = TotalFileSize(v-&amp;amp;gt;files_[level]);  
      score =  
          static_cast&amp;amp;lt;double&amp;amp;gt;(level_bytes) / MaxBytesForLevel(options_, level);  
    }  
  
    if (score &amp;amp;gt; best_score) {  
      best_level = level;  
      best_score = score;  
    }  
  }  
  
  v-&amp;amp;gt;compaction_level_ = best_level;  
  v-&amp;amp;gt;compaction_score_ = best_score;  
}

static double MaxBytesForLevel(const Options* options, int level) {  
  // Note: the result for level zero is not really used since we set  
  // the level-0 compaction threshold based on number of files.  
  // Result for both level-0 and level-1
  double result = 10. * 1048576.0;  
  while (level &amp;amp;gt; 1) {  
    result *= 10;  
    level--;  
  }  
  return result;  
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;leveldb æ‰“å¼€/åˆå§‹åŒ–æœŸé—´æˆ–è€…æ¯æ¬¡ compaction ç»“æŸæ—¶éƒ½ä¼šè®¡ç®—ä¸‹æ¬¡ compaction æœ€åº”è¯¥å¤„ç†çš„å“ªä¸ª level çš„æ•°æ®æ–‡ä»¶ä»¥åŠç´§è¿«ç¨‹åº¦ï¼ˆ&lt;code&gt;compaction_score_&lt;/code&gt;ï¼‰ï¼Œä¸è¿‡å¯¹äº $level_0$ å’Œ å…¶ä»– level çš„è®¡ç®—é€»è¾‘æœ‰åŒºåˆ«ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1ã€$level_0$ compaction ç´§è¿«ç¨‹åº¦ï¼Œå–å†³äºæ–‡ä»¶æ•°å’Œ compaction é˜ˆå€¼ï¼ˆkL0_CompactionTrigger = 4ï¼‰çš„å€æ•°&lt;/li&gt;
&lt;li&gt;2ã€å…¶ä»– level åˆ™å–å†³äºæ–‡ä»¶å ç”¨çš„å­˜å‚¨ç©ºé—´å’Œé˜ˆå€¼çš„å€æ•°ï¼Œlevel è¶Šå¤§ï¼Œé˜ˆå€¼è¶Šå¤§ - $level_1$ é˜ˆå€¼ä¸º &lt;code&gt;10. * 1048576.0&lt;/code&gt; å­—èŠ‚ï¼ˆ10MBï¼‰ï¼Œç›¸é‚»å±‚ä¹‹é—´çš„é˜ˆå€¼ä¸º 10 å€å…³ç³»ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;bool Version::UpdateStats(const GetStats&amp;amp;amp; stats) {  
  FileMetaData* f = stats.seek_file;  
  if (f != nullptr) {  
    f-&amp;amp;gt;allowed_seeks--;  // allowed_seeks åˆå§‹å€¼ 1 &amp;amp;lt;&amp;amp;lt; 30
    if (f-&amp;amp;gt;allowed_seeks &amp;amp;lt;= 0 &amp;amp;amp;&amp;amp;amp; file_to_compact_ == nullptr) {  
      file_to_compact_ = f;  
      file_to_compact_level_ = stats.seek_file_level;  
      return true;  
    }  
  }  
  return false;  
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ¯æ¬¡ Get æ£€ç´¢çš„æœ€åéƒ½ä¼šå¯¹æœ¬æ¬¡æ£€ç´¢æ¶‰åŠçš„&lt;u&gt;ç¬¬ä¸€ä¸ªæ•°æ®æ–‡ä»¶&lt;/u&gt;è¿›è¡Œè®¡æ•°ï¼Œå¦‚æœæ–‡ä»¶çš„æ£€ç´¢æ¬¡æ•°è¾¾åˆ°ä¸Šé™ï¼Œå°±ä¼ºæœºè¿›è¡Œ compactionã€‚ä¸è¿‡è¿™ä¸ªæ¡ä»¶è§¦å‘ compaction çš„ä¼˜å…ˆçº§æ¯”è¾ƒä½ã€‚&lt;/p&gt;
&lt;h3&gt;7.2 major compaction è¿‡ç¨‹&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸è€ƒè™‘ä¸€äº›ç»†èŠ‚ä¼˜åŒ–ä¹‹å¤„ï¼Œcompaction çš„æ ¸å¿ƒæµç¨‹ä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1ã€æ ¹æ®è§¦å‘æ¡ä»¶ï¼Œç¡®å®šæœ¬æ¬¡ compaction å¯¹å“ªä¸ª level çš„æ•°æ®åº“æ–‡ä»¶å¤„ç†ï¼Œç„¶åè¿›ä¸€æ­¥ç¡®å®šä» level  å’Œ level+1 å±‚ä¸­é€‰æ‹©å“ªäº›æ•°æ®åº“æ–‡ä»¶ compactionï¼š
&lt;ul&gt;&lt;li&gt;ï¼ˆ1ï¼‰ã€æœ€ç®€å•çš„æƒ…å†µæ˜¯ï¼Œ å¦‚æœè¯¥ level æ˜¯ç¬¬ä¸€æ¬¡åš compactionï¼Œåˆ™é€‰æ‹©è¯¥ level çš„ç¬¬ä¸€ä¸ªæ•°æ®æ–‡ä»¶ï¼ˆä¹Ÿå°±æ˜¯æœ€å…ˆç”Ÿæˆçš„é‚£ä¸ªï¼‰ï¼Œä¸è¿‡ï¼š
&lt;ul&gt;&lt;li&gt;1)ã€å¦‚æœä¹‹å‰è¯¥ level åšè¿‡ major compactionï¼Œæš‚å­˜äº†çŠ¶æ€ï¼ˆå¤„ç†åˆ°å“ªä¸ªæœ€å¤§ keyï¼‰ï¼Œé‚£ä¹ˆæ ¹æ®æš‚å­˜çŠ¶æ€æœ€å¤§ key é€‰æ‹©ä¸‹ä¸€ä¸ªæ•°æ®æ–‡ä»¶å³å¯ï¼Œå¦‚æœæ²¡æœ‰ä¸‹ä¸€ä¸ªæ•°æ®æ–‡ä»¶äº†ï¼Œåˆ™ä»å¤´é€‰æ‹©è¯¥ level çš„ç¬¬ä¸€ä¸ªæ•°æ®æ–‡ä»¶ï¼ˆä¹Ÿå°±æ˜¯æœ€å…ˆç”Ÿæˆçš„é‚£ä¸ªï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;2)ã€&lt;code&gt;seek_compaction&lt;/code&gt; è§¦å‘çš„ compaction æ˜¯é’ˆå¯¹ç‰¹å®šæ•°æ®åº“æ–‡ä»¶çš„ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;(2)ã€å¦‚æœ level = 0ï¼Œå› ä¸º $level_0$ çš„æ•°æ®åº“æ–‡ä»¶ä¹‹é—´ key çš„èŒƒå›´å¯ä»¥é‡åˆï¼Œæ‰€ä»¥æ ¹æ® (1) é€‰å®šæ•°æ®æ–‡ä»¶çš„ key æœ€å¤§å€¼å’Œæœ€å°å€¼ï¼Œè¿˜éœ€è¦è¿›ä¸€æ­¥ç¡®å®šæ˜¯å¦åº”è¯¥æŠŠ $level_0$ çš„å…¶ä»–æ•°æ®åº“æ–‡ä»¶åŒ…å«è¿›æ¥ã€‚&lt;/li&gt;
&lt;li&gt;(3)ã€compaction è¾“å‡ºçš„æ•°æ®åº“å±äº level+1 å±‚ï¼Œå› ä¸º $level_1$ ~ $level_n$ åŒä¸€å±‚çš„æ•°æ®åº“æ–‡ä»¶ä¹‹é—´ key åŒºé—´ä¸èƒ½æœ‰é‡åˆï¼Œæ‰€ä»¥è¿˜éœ€è¦æ ¹æ® (1) å’Œ (2) é€‰å®šçš„æ•°æ®åº“æ–‡ä»¶çš„ key æœ€å¤§å€¼å’Œæœ€å°å€¼ï¼Œç¡®å®š level+1 å±‚æœ‰å“ªäº›æ•°æ®åº“æ–‡ä»¶éœ€è¦åŠ å…¥åˆ°æœ¬æ¬¡ compaction&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;// A Compaction encapsulates information about a compaction.
class Compaction {
private:
  int level_;  // compaction ç›®æ ‡ level
  uint64_t max_output_file_size_;  // compaction äº§ç”Ÿçš„æ–°æ–‡ä»¶å¤§å°é˜ˆå€¼ï¼Œå¦‚æœè¾¾åˆ°é˜ˆå€¼ï¼Œå°±ç»“æŸ compaction
  Version* input_version_;  // å½“å‰å¯¹å“ªä¸ª Version åš compactionï¼Ÿ
  VersionEdit edit_; // æ¯æ¬¡ compaction ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ Version

  // Each compaction reads inputs from &amp;amp;quot;level_&amp;amp;quot; and &amp;amp;quot;level_+1&amp;amp;quot;
  // compaction åªä¼šåœ¨ç›®æ ‡å±‚å’Œç›¸é‚»ä¸‹ä¸€å±‚ä¹‹é—´è¿›è¡Œ
  std::vector&amp;amp;lt;FileMetaData*&amp;amp;gt; inputs_[2];  // The two sets of inputs

  // State used to check for number of overlapping grandparent files  
  // (parent == level_ + 1, grandparent == level_ + 2)  
  std::vector&amp;amp;lt;FileMetaData*&amp;amp;gt; grandparents_;  // ç”¨äºåˆ¤æ–­æ˜¯å¦å¯ä»¥å°† level å±‚çš„æ–‡ä»¶ç›´æ¥ç§»åŠ¨åˆ° level+1 å±‚ï¼Œè§ bool Compaction::IsTrivialMove() const
  size_t grandparent_index_;  // Index in grandparent_starts_  
  bool seen_key_;             // Some output key has been seen  
  int64_t overlapped_bytes_;  // Bytes of overlap between current output  
                            // and grandparent files

  // State for implementing IsBaseLevelForKey  
  
  // level_ptrs_ holds indices into input_version_-&amp;amp;gt;levels_: our state  
  // is that we are positioned at one of the file ranges for each  
  // higher level than the ones involved in this compaction (i.e. for  
  // all L &amp;amp;gt;= level_ + 2).  
  size_t level_ptrs_[config::kNumLevels];
}&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;Compaction* VersionSet::PickCompaction() {  
  Compaction* c;  
  int level;  
  
  // We prefer compactions triggered by too much data in a level over  
  // the compactions triggered by seeks.
  const bool size_compaction = (current_-&amp;amp;gt;compaction_score_ &amp;amp;gt;= 1);
  const bool seek_compaction = (current_-&amp;amp;gt;file_to_compact_ != nullptr);  
  if (size_compaction) {  
    level = current_-&amp;amp;gt;compaction_level_;  
    assert(level &amp;amp;gt;= 0);  
    assert(level + 1 &amp;amp;lt; config::kNumLevels);  
    c = new Compaction(options_, level);  
  
    // Pick the first file that comes after compact_pointer_[level]  
    for (size_t i = 0; i &amp;amp;lt; current_-&amp;amp;gt;files_[level].size(); i++) {  
      FileMetaData* f = current_-&amp;amp;gt;files_[level][i];  
      if (compact_pointer_[level].empty() ||  
          icmp_.Compare(f-&amp;amp;gt;largest.Encode(), compact_pointer_[level]) &amp;amp;gt; 0) {  
        c-&amp;amp;gt;inputs_[0].push_back(f);  // é€‰æ‹©è¯¥ level ä¸Šæ¬¡ compaction çš„æ–‡ä»¶çš„ä¸‹ä¸€ä¸ªæ–‡ä»¶
        break;  
      }  
    }  
    if (c-&amp;amp;gt;inputs_[0].empty()) {  
      // Wrap-around to the beginning of the key space  
      c-&amp;amp;gt;inputs_[0].push_back(current_-&amp;amp;gt;files_[level][0]);  // å¦‚æœè¯¥ level æ•´ä¸ª key ç©ºé—´éƒ½ compaction è¿‡ï¼Œåˆ™ä»å¤´å¼€å§‹é€‰æ‹©ç¬¬ä¸€ä¸ªæ–‡ä»¶
    }  
  } else if (seek_compaction) {  
    level = current_-&amp;amp;gt;file_to_compact_level_;  
    c = new Compaction(options_, level);  
    c-&amp;amp;gt;inputs_[0].push_back(current_-&amp;amp;gt;file_to_compact_);  
  } else {  
    return nullptr;  
  }  
  
  c-&amp;amp;gt;input_version_ = current_;  
  c-&amp;amp;gt;input_version_-&amp;amp;gt;Ref();  
  
  // Files in level 0 may overlap each other, so pick up all overlapping ones  
  if (level == 0) {  
    InternalKey smallest, largest;  
    GetRange(c-&amp;amp;gt;inputs_[0], &amp;amp;amp;smallest, &amp;amp;amp;largest);  
    // Note that the next call will discard the file we placed in  
    // c-&amp;amp;gt;inputs_[0] earlier and replace it with an overlapping set
    // which will include the picked file.
    current_-&amp;amp;gt;GetOverlappingInputs(0, &amp;amp;amp;smallest, &amp;amp;amp;largest, &amp;amp;amp;c-&amp;amp;gt;inputs_[0]);  
    assert(!c-&amp;amp;gt;inputs_[0].empty());  
  }  
  
  SetupOtherInputs(c);  
  
  return c;  
}&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;&lt;li&gt;2ã€å¦‚æœé€‰å®šçš„è¾“å…¥æ–‡ä»¶ï¼Œä»…æœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œä¸”æ˜¯ level å±‚æ–‡ä»¶ï¼Œåˆ™ç›´æ¥å°†è¿™ä¸ªæ–‡ä»¶æ ‡è®°åœ¨ä¸ºæœ¬æ¬¡ compaction åä¸º level+1 å±‚æ–‡ä»¶ï¼Œä»è€Œé¿å…äº†ä¸å¿…è¦çš„æ–‡ä»¶è¯»å†™ã€‚&lt;/li&gt;
&lt;li&gt;3ã€å¦åˆ™ï¼Œå¯¹é€‰å®šå¥½çš„ level å’Œ level+1 å±‚æ•°æ®åº“æ–‡ä»¶ï¼Œæ‰“å¼€æ–‡ä»¶ï¼Œåˆ›å»ºå¥½æ•°æ®éå†è¯»å–çš„è¿­ä»£å™¨ï¼š
&lt;ul&gt;&lt;li&gt;(1)ã€å•ä¸ªæ–‡ä»¶çš„éå†è¯»å–å®é™…æ˜¯ä¸ªä¸¤å±‚éå†ï¼ˆ&lt;code&gt;TwoLevelIterator&lt;/code&gt;ï¼‰ - ç¬¬1å±‚éå†é’ˆå¯¹â€œindex å—â€ï¼Œç¬¬2å±‚éå†é’ˆå¯¹â€œdata å—â€ï¼Œæ ¹æ®â€œindex å—â€å¾—åˆ°â€œdata å—â€çš„ offset å’Œ sizeï¼Œéå†â€œdata å—â€ï¼Œè·å–å®é™…çš„é”®å€¼å¯¹æ•°æ®ï¼Œä¸€ä¸ªâ€œdata å—â€ éå†å®Œäº†ï¼Œåˆ™ä»â€œindex å—â€è·å–ä¸‹ä¸€ä¸ªâ€œdata å—â€çš„ offset å’Œ size ç»§ç»­éå†ã€‚&lt;/li&gt;
&lt;li&gt;ï¼ˆ2ï¼‰ã€å› ä¸º compaction è¾“å‡ºçš„æ•°æ®åº“æ–‡ä»¶å†…å®¹ä¹Ÿéœ€è¦ä¿æŒæŒ‰ key æœ‰åºçš„æ€§è´¨ï¼Œæ‰€ä»¥ compaction è¿‡ç¨‹å®é™…æ˜¯å¯¹å¤šä¸ªè¾“å…¥æ–‡ä»¶çš„æœ‰åºéå†ã€‚ä¸è¿‡ $level_0$ æ•°æ®åº“æ–‡ä»¶çš„ key åŒºé—´å¯ä»¥é‡åˆï¼Œæ‰€ä»¥å¤„ç†æ–¹å¼ä¹Ÿæœ‰æ‰€åŒºåˆ«
&lt;ul&gt;&lt;li&gt;1)ã€$level_0$ å±‚çš„å¤šä¸ªæ•°æ®åº“æ–‡ä»¶æœ‰åºéå†ï¼Œç±»ä¼¼äº N è·¯å½’å¹¶æ’åºç®—æ³• - æ¯æ¬¡å– N ä¸ªè¿­ä»£å™¨çš„å¤´éƒ¨å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œå–æœ€å°çš„é‚£ä¸ªå…ƒç´ è¿”å›ã€‚&lt;/li&gt;
&lt;li&gt;2)ã€$level_1$ ~ $level_n$ å±‚çš„æ•°æ®åº“æ–‡ä»¶ key åŒºé—´ä¸ä¼šæœ‰é‡åˆï¼Œæ‰€ä»¥æ¯”è¾ƒç®€å•ï¼ŒæŒ‰ç…§ key åŒºé—´å…ˆåšä¸€ä¸‹æ’åºï¼Œç„¶åé€ä¸ªæ–‡ä»¶éå†è¯»å–å°±å¯ä»¥ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;Iterator* VersionSet::MakeInputIterator(Compaction* c) {  
  ReadOptions options;  
  options.verify_checksums = options_-&amp;amp;gt;paranoid_checks;  
  options.fill_cache = false;  
  
  // Level-0 files have to be merged together.  For other levels,  
  // we will make a concatenating iterator per level.  // TODO(opt): use concatenating iterator for level-0 if there is no overlap  
  const int space = (c-&amp;amp;gt;level() == 0 ? c-&amp;amp;gt;inputs_[0].size() + 1 : 2);  
  Iterator** list = new Iterator*[space];  
  int num = 0;  
  for (int which = 0; which &amp;amp;lt; 2; which++) {  
    if (!c-&amp;amp;gt;inputs_[which].empty()) {  
      if (c-&amp;amp;gt;level() + which == 0) {  
        const std::vector&amp;amp;lt;FileMetaData*&amp;amp;gt;&amp;amp;amp; files = c-&amp;amp;gt;inputs_[which];  
        for (size_t i = 0; i &amp;amp;lt; files.size(); i++) {  
          list[num++] = table_cache_-&amp;amp;gt;NewIterator(options, files[i]-&amp;amp;gt;number,  
                                                  files[i]-&amp;amp;gt;file_size);  
        }  
      } else {  
        // Create concatenating iterator for the files from this level  
        list[num++] = NewTwoLevelIterator(  
            new Version::LevelFileNumIterator(icmp_, &amp;amp;amp;c-&amp;amp;gt;inputs_[which]),  
            &amp;amp;amp;GetFileIterator, table_cache_, options);  
      }  
    }  
  }  
  assert(num &amp;amp;lt;= space);  
  Iterator* result = NewMergingIterator(&amp;amp;amp;icmp_, list, num);  
  delete[] list;  
  return result;  
}&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;&lt;li&gt;4ã€leveldb åŸºäºçš„ lsm-treeï¼ˆLog Structured Merge Treeï¼‰ ç»“æ„ï¼Œå¹¶ä¸ä¼šå¯¹æ•°æ®è¿›è¡ŒåŸåœ°ä¿®æ”¹å’Œåˆ é™¤ - åŒ key çš„å¤šæ¬¡å†™å…¥ï¼ˆåŒ…æ‹¬åˆ é™¤ï¼‰ï¼Œéƒ½ä¼šåœ¨ç»“æ„ä¸­å¢åŠ ä¸€æ¡é”®å€¼è®°å½•ï¼Œæ£€ç´¢æ—¶ä»¥æœ€åä¸€æ¬¡å†™å…¥çš„å†…å®¹ä¸ºç»“æœã€‚é‚£ä¹ˆå¦‚æœç³»ç»Ÿ workloads ä¼šå¯¹ç›¸åŒçš„ key å­˜åœ¨å¤§é‡å†™å…¥ï¼Œå°±æ¯”è¾ƒæµªè´¹å­˜å‚¨ç©ºé—´ã€‚æ‰€ä»¥ compaction è¿‡ç¨‹ä¸­ä¼šå¯¹åŒä¸€ä¸ª key å¤šæ¬¡å†™å…¥åšæ¶ˆé™¤åˆå¹¶ï¼Œä»…ä¿ç•™æœ€åä¸€æ¬¡å†™å…¥çš„ï¼ˆå¦‚æœæœ€åä¸€æ¬¡æ˜¯åˆ é™¤æ“ä½œï¼Œå¹¶ä¸” level+2ï¼ˆåŒ…æ‹¬ï¼‰ä¹‹åæ‰€æœ‰å±‚çš„ key åŒºé—´éƒ½ä¸ä¼šåŒ…å«è¿™ä¸ª keyï¼Œåˆ™æœ€åä¸€æ¬¡çš„åˆ é™¤æ“ä½œä¹Ÿå¯ä»¥æ¶ˆé™¤æ‰ï¼‰ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;compaction çš„è¾“å…¥éå†æ˜¯æœ‰åºçš„ï¼Œé‚£ä¹ˆåŒä¸€ä¸ª key çš„å¤šæ¬¡å†™å…¥è®°å½•åœ¨éå†æ—¶æ˜¯è¿ç»­çš„ï¼Œå¹¶ä¸”&lt;code&gt;InternalKeyComparator&lt;/code&gt;æ¯”è¾ƒå™¨çš„æ¯”è¾ƒé€»è¾‘å†³å®šäº†åå†™å…¥çš„ä¼šè¢«å…ˆéå†åˆ°ã€‚ä»¥å¦‚ä¸‹å†™å…¥åºåˆ—æ¥è§£é‡Šæ¶ˆé™¤åˆå¹¶é€»è¾‘ï¼ˆä»¥ UK è¡¨ç¤ºç”¨æˆ·å†™å…¥çš„åŸå§‹ keyï¼Œä»¥$IK_k$ è¡¨ç¤ºå¸¦å†™å…¥åºåˆ—å·çš„å†…éƒ¨ keyï¼‰ï¼š&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&gt; - å‡è®¾å†™å…¥åºåˆ—ä¸ºï¼šâ€œPUT $IK_1$â€ -&gt; â€œPUT $IK_2$â€ï¼Œé‚£ä¹ˆ compaction éå†åºåˆ—ä¸ºâ€œPUT $IK_2$â€ -&gt; â€œPUT $IK_1$â€ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&gt;&gt;  - (1) å¤„ç† â€œPUT $IK_2$â€ æ—¶ï¼Œå‘ç°å‰é¢æ²¡å¤„ç†è¿‡ UK çš„è®°å½•ï¼Œåˆ™ä¿ç•™ â€œPUT $IK_2$â€è®°å½•å†™å…¥è¾“å‡ºä¸­ï¼ŒåŒæ—¶è®¾ç½®çŠ¶æ€ä½ - å¤„ç†è¿‡ UK çš„è®°å½•&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&gt;&gt;  - (2) å¤„ç† â€œPUT $IK_1$â€ æ—¶ï¼Œå‘ç°å‰é¢å¤„ç†è¿‡ UK çš„è®°å½•ï¼ˆå¹¶ä¸”è¿™æ¡è®°å½•ä¸å†è¢«ä»»ä½•å¿«ç…§ä¾èµ–ï¼‰ï¼Œåˆ™ç›´æ¥å°† â€œPUT $IK_1$â€ è®°å½•ä¸¢å¼ƒã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&gt; - å‡è®¾å†™å…¥åºåˆ—ä¸ºï¼šâ€œPUT $IK_1$â€ -&gt; â€œDEL $IK_2$â€ï¼Œé‚£ä¹ˆ compaction éå†åºåˆ—ä¸º â€œDEL $IK_2$â€ -&gt; â€œPUT $IK_1$â€ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&gt;&gt;  - (1) å¤„ç†â€œDEL $IK_2$â€ æ—¶ï¼Œå‘ç°å‰é¢æ²¡å¤„ç†è¿‡ UK çš„è®°å½•ï¼Œ&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&gt;&gt;&gt;   - 1) å¦‚æœ level+2ï¼ˆåŒ…æ‹¬ï¼‰ä¹‹åæ‰€æœ‰å±‚ä¹Ÿéƒ½ä¸åŒ…å« UK çš„è®°å½•ï¼ˆå¹¶ä¸”è¿™æ¡è®°å½•ä¸å†è¢«ä»»ä½•å¿«ç…§ä¾èµ–ï¼‰ï¼Œåˆ™ç›´æ¥ä¸¢å¼ƒï¼ˆ&lt;u&gt;ä»æ£€ç´¢æ€§èƒ½ä¸Šæ¥è¯´ï¼Œå¯èƒ½ä¸ä¸¢å¼ƒæ›´å¥½ä¸€ç‚¹ï¼Ÿ&lt;/u&gt;ï¼‰&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&gt;&gt;&gt;   - 2) å¦‚æœ level+2ï¼ˆåŒ…æ‹¬ï¼‰ä¹‹åå±‚ä¸­åŒ…å« UK çš„è®°å½•ï¼Œåˆ™ä¿ç•™ â€œDEL $IK_2$â€è®°å½•å†™åˆ°è¾“å‡ºä¸­ï¼ŒåŒæ—¶è®¾ç½®çŠ¶æ€ä½  - å¤„ç†è¿‡ UK çš„è®°å½•&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&gt;&gt;  - (2) å¤„ç†â€œPUT $IK_1$â€ æ—¶ï¼Œå‘ç°å‰é¢å¤„ç†è¿‡ UK çš„è®°å½•ï¼Œåˆ™ç›´æ¥å°† â€œPUT $IK_1$â€ è®°å½•ä¸¢å¼ƒã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&gt; - å¦‚æœå‘ç°å½“å‰å¤„ç†çš„ IK çš„ UK ä¸å‰ä¸€æ¬¡å¤„ç†çš„ IK çš„ UK ä¸ç›¸åŒï¼Œåˆ™é‡ç½®çŠ¶æ€ä½ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;// Handle key/value, add to state, etc.  
bool drop = false;  
if (!ParseInternalKey(key, &amp;amp;amp;ikey)) {  
  // Do not hide error keys  
  current_user_key.clear();  
  has_current_user_key = false;  
  last_sequence_for_key = kMaxSequenceNumber;  
} else {  
  if (!has_current_user_key ||  
      user_comparator()-&amp;amp;gt;Compare(ikey.user_key, Slice(current_user_key)) !=  
          0) {  
    // First occurrence of this user key  
    current_user_key.assign(ikey.user_key.data(), ikey.user_key.size());  
    has_current_user_key = true;  
    last_sequence_for_key = kMaxSequenceNumber;  
  }  
  
  if (last_sequence_for_key &amp;amp;lt;= compact-&amp;amp;gt;smallest_snapshot) {  
    // Hidden by an newer entry for same user key  
    drop = true;  // (A)  
  } else if (ikey.type == kTypeDeletion &amp;amp;amp;&amp;amp;amp;  
             ikey.sequence &amp;amp;lt;= compact-&amp;amp;gt;smallest_snapshot &amp;amp;amp;&amp;amp;amp;  
             compact-&amp;amp;gt;compaction-&amp;amp;gt;IsBaseLevelForKey(ikey.user_key)) {  
    // For this user key:  
    // (1) there is no data in higher levels
    // (2) data in lower levels will have larger sequence numbers
    // (3) data in layers that are being compacted here and have
    //     smaller sequence numbers will be dropped in the next
    //     few iterations of this loop (by rule (A) above).
    // Therefore this deletion marker is obsolete and can be dropped.
    drop = true;  
  }  
  
  last_sequence_for_key = ikey.sequence;  
}&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;int InternalKeyComparator::Compare(const Slice&amp;amp;amp; akey, const Slice&amp;amp;amp; bkey) const {  
  // Order by:  
  //    increasing user key (according to user-supplied comparator)
  //    decreasing sequence number
  //    decreasing type (though sequence# should be enough to disambiguate)
  int r = user_comparator_-&amp;amp;gt;Compare(ExtractUserKey(akey), ExtractUserKey(bkey));  // å…ˆæ¯”è¾ƒç”¨æˆ· key éƒ¨åˆ†
  if (r == 0) {  // å¦‚æœç”¨æˆ·key ç›¸åŒï¼Œåˆ™æ¯”è¾ƒåºåˆ—å·ï¼Œåºåˆ—å·å¤§çš„æ’åœ¨å‰é¢
    const uint64_t anum = DecodeFixed64(akey.data() + akey.size() - 8);  
    const uint64_t bnum = DecodeFixed64(bkey.data() + bkey.size() - 8);  
    if (anum &amp;amp;gt; bnum) {  
      r = -1;  
    } else if (anum &amp;amp;lt; bnum) {  
      r = +1;  
    }  
  }  
  return r;  
}&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;&lt;li&gt;5ã€å¦‚æœ compaction è¾“å‡ºçš„æ•°æ®æ–‡ä»¶å¤§å°è¾¾åˆ°é˜ˆå€¼ï¼ˆ2MBï¼‰ï¼Œåˆ™ç»“æŸè¯¥æ–‡ä»¶çš„å†™å…¥ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„ ldb æ•°æ®æ–‡ä»¶ï¼Œç»§ç»­ compaction å†™å…¥ã€‚åœ¨ compaction å®Œæˆæ—¶ï¼Œè¿™äº›è‹¥å¹²ä¸ªè¾“å‡ºçš„ ldb æ•°æ®æ–‡ä»¶ä¼šè¢«æ ‡è®°ä¸ºæ–°ç‰ˆæœ¬çš„ level+1 å±‚æ•°æ®æ–‡ä»¶ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;// Leveldb will write up to this amount of bytes to a file before  
// switching to a new one.  
// Most clients should leave this parameter alone.  However if your  
// filesystem is more efficient with larger files, you could  
// consider increasing the value.  The downside will be longer  
// compactions and hence longer latency/performance hiccups.  
// Another reason to increase this parameter might be when you are  
// initially populating a large database.  
size_t max_file_size = 2 * 1024 * 1024;&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;&lt;li&gt;6ã€ä¸€æ¬¡ compaction å®Œæˆåï¼Œè¾“å…¥æ–‡ä»¶çš„æœ‰æ•ˆå†…å®¹éƒ½å·²ç»å†™åˆ°è¾“å‡ºæ–‡ä»¶ï¼Œå¦‚æœä¸è€ƒè™‘å…¶ä»–å› ç´ ï¼Œè¿™äº›è¾“å…¥æ–‡ä»¶å¯ä»¥è¢«åˆ é™¤ï¼Œä¿ç•™è¾“å‡ºæ–‡ä»¶å³å¯ã€‚ä¸è¿‡å¯èƒ½å­˜åœ¨æ£€ç´¢æ“ä½œä¾èµ–è¿™äº›è¾“å…¥æ–‡ä»¶ï¼Œæ‰€ä»¥ä¸ä¼šå³åˆ»åˆ é™¤è¿™äº›è¾“å…¥æ–‡ä»¶ï¼Œè€Œæ˜¯ä»¥ç‰ˆæœ¬ä¿¡æ¯åœ¨é€»è¾‘ä¸Šç»´æŠ¤æ¯ä¸€å±‚æœ€æ–°åŒ…å«å“ªäº›æ–‡ä»¶ï¼ˆä»¥åŠå¦‚æœæœ¬æ¬¡ compaction æœªèƒ½å®Œæ•´åœ°å®Œæˆï¼Œåˆ™è¿˜éœ€è¦æŠŠå¤„ç†åˆ° level çš„å“ªä¸ª key ä¸ºæ­¢è®°å½•åˆ°ç‰ˆæœ¬ä¿¡æ¯ä¸­ï¼‰ã€‚æ‰€ä»¥&lt;u&gt;æ¯æ¬¡ compaction éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„é€»è¾‘ä¸Šçš„æ•°æ®ç‰ˆæœ¬ï¼Œå°†è¿™ä¸ªç‰ˆæœ¬åˆ‡æ¢ä¸º leveldb è¿è¡Œæ—¶ä¾èµ–çš„å½“å‰ç‰ˆæœ¬ï¼ˆ&lt;code&gt;VersionSet::current_&lt;/code&gt;ï¼‰ï¼Œåç»­çš„æ£€ç´¢æ“ä½œå°±éƒ½åœ¨è¿™ä¸ªæ–°ç‰ˆæœ¬æ‰€åŒ…å«æ•°æ®åº“æ–‡ä»¶ä¸­è¿›è¡Œ&lt;/u&gt;ã€‚å¦å¤–ï¼š
&lt;ul&gt;&lt;li&gt;1ã€é‡æ–°è®¡ç®—ä¸‹æ¬¡ compaction æœ€åº”è¯¥å¤„ç†çš„å“ªä¸ª level çš„æ•°æ®æ–‡ä»¶ä»¥åŠç´§è¿«ç¨‹åº¦ï¼ˆ&lt;code&gt;compaction_score_&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;2ã€å°†æ–°ç‰ˆæœ¬ä¿¡æ¯å†™å…¥ç‰ˆæœ¬æè¿° MANIFEST æ–‡ä»¶ä¸­ï¼ˆå¦‚æœå°šä¸å­˜åœ¨ï¼Œåˆ™æ–°å»ºä¸€ä¸ªï¼‰ï¼Œå¹¶ä¸”å¦‚æœç‰ˆæœ¬æè¿° MANIFEST æ–‡ä»¶æ˜¯æ–°åˆ›å»ºçš„ï¼Œåˆ™å°†è¯¥  MANIFEST æ–‡ä»¶åå­˜ä¸º CURRENT æ–‡ä»¶ã€‚è¿™æ ·ï¼Œå¦‚æœå½“å‰ leveldb è¿›ç¨‹æŒ‚äº†æˆ–è€…æœºå™¨èŠ‚ç‚¹å®•æœºï¼Œè¿˜å¯ä»¥åŸºäº CURRENT æ–‡ä»¶æŒ‡å‘çš„  MANIFEST æ–‡ä»¶ä¸­çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œæ¢å¤å‡ºæœ€æ–°æœ€æ–°ç‰ˆæœ¬çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;3ã€å¯¹å½“å‰ä¸å†ä¾èµ–ï¼ˆä¾èµ–å…³ç³»æ€ä¹ˆç»´æŠ¤çš„ï¼Ÿï¼‰çš„ ldb æ–‡ä»¶/MANIFEST æ–‡ä»¶/â€œWAL logâ€ æ–‡ä»¶è¿›è¡Œåˆ é™¤æ¸…ç†ã€‚
&lt;ul&gt;&lt;li&gt;ä¸è¢«ä»»ä½•ç‰ˆæœ¬ä¾èµ–çš„ ldb æ–‡ä»¶ï¼Œéƒ½å¯ä»¥åˆ é™¤&lt;/li&gt;
&lt;li&gt;ä¸è¢«å½“å‰ CURRENT æ–‡ä»¶æŒ‡å‘çš„ MANIFEST æ–‡ä»¶ï¼Œå¯ä»¥åˆ é™¤&lt;/li&gt;
&lt;li&gt;â€œWAL logâ€ æ–‡ä»¶ä¿ç•™æœ€æ–°çš„ä¸¤ä¸ªå³å¯ï¼ˆmemtable å’Œä¸å¯å˜ memtable å¯¹åº”çš„â€œWAL logâ€æ–‡ä»¶ï¼‰&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;Status DBImpl::InstallCompactionResults(CompactionState* compact) {  
  mutex_.AssertHeld();  
  Log(options_.info_log, &amp;amp;quot;Compacted %d@%d + %d@%d files =&amp;amp;gt; %lld bytes&amp;amp;quot;,  
      compact-&amp;amp;gt;compaction-&amp;amp;gt;num_input_files(0), compact-&amp;amp;gt;compaction-&amp;amp;gt;level(),  
      compact-&amp;amp;gt;compaction-&amp;amp;gt;num_input_files(1), compact-&amp;amp;gt;compaction-&amp;amp;gt;level() + 1,  
      static_cast&amp;amp;lt;long long&amp;amp;gt;(compact-&amp;amp;gt;total_bytes));  
  
  // Add compaction outputs  
  compact-&amp;amp;gt;compaction-&amp;amp;gt;AddInputDeletions(compact-&amp;amp;gt;compaction-&amp;amp;gt;edit());  
  const int level = compact-&amp;amp;gt;compaction-&amp;amp;gt;level();  
  for (size_t i = 0; i &amp;amp;lt; compact-&amp;amp;gt;outputs.size(); i++) {  
    const CompactionState::Output&amp;amp;amp; out = compact-&amp;amp;gt;outputs[i];  
    compact-&amp;amp;gt;compaction-&amp;amp;gt;edit()-&amp;amp;gt;AddFile(level + 1, out.number, out.file_size,  
                                         out.smallest, out.largest);  
  }  
  return versions_-&amp;amp;gt;LogAndApply(compact-&amp;amp;gt;compaction-&amp;amp;gt;edit(), &amp;amp;amp;mutex_);  
}&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;void DBImpl::RemoveObsoleteFiles() {  
  mutex_.AssertHeld();  
  
  if (!bg_error_.ok()) {  
    // After a background error, we don&amp;amp;apos;t know whether a new version may  
    // or may not have been committed, so we cannot safely garbage collect.
    return;  
  }  
  
  // Make a set of all of the live files  
  std::set&amp;amp;lt;uint64_t&amp;amp;gt; live = pending_outputs_;  
  versions_-&amp;amp;gt;AddLiveFiles(&amp;amp;amp;live);  
  
  std::vector&amp;amp;lt;std::string&amp;amp;gt; filenames;  
  env_-&amp;amp;gt;GetChildren(dbname_, &amp;amp;amp;filenames);  // Ignoring errors on purpose  
  uint64_t number;  
  FileType type;  
  std::vector&amp;amp;lt;std::string&amp;amp;gt; files_to_delete;  
  for (std::string&amp;amp;amp; filename : filenames) {  
    if (ParseFileName(filename, &amp;amp;amp;number, &amp;amp;amp;type)) {  
      bool keep = true;  
      switch (type) {  
        case kLogFile:  
          keep = ((number &amp;amp;gt;= versions_-&amp;amp;gt;LogNumber()) ||  
                  (number == versions_-&amp;amp;gt;PrevLogNumber()));  
          break;  
        case kDescriptorFile:  
          // Keep my manifest file, and any newer incarnations&amp;amp;apos;  
          // (in case there is a race that allows other incarnations)
		  keep = (number &amp;amp;gt;= versions_-&amp;amp;gt;ManifestFileNumber());  
          break;  
        case kTableFile:  
          keep = (live.find(number) != live.end());  
          break;  
        case kTempFile:  
          // Any temp files that are currently being written to must  
          // be recorded in pending_outputs_, which is inserted into &amp;amp;quot;live&amp;amp;quot;
          keep = (live.find(number) != live.end());  
          break;  
        case kCurrentFile:  
        case kDBLockFile:  
        case kInfoLogFile:  
          keep = true;  
          break;  
      }  
  
      if (!keep) {  
        files_to_delete.push_back(std::move(filename));  
        if (type == kTableFile) {  
          table_cache_-&amp;amp;gt;Evict(number);  
        }  
        Log(options_.info_log, &amp;amp;quot;Delete type=%d #%lld\n&amp;amp;quot;, static_cast&amp;amp;lt;int&amp;amp;gt;(type),  
            static_cast&amp;amp;lt;unsigned long long&amp;amp;gt;(number));  
      }  
    }  
  }  
  
  // While deleting all files unblock other threads. All files being deleted  
  // have unique names which will not collide with newly created files and
  // are therefore safe to delete while allowing other threads to proceed.
  mutex_.Unlock();  
  for (const std::string&amp;amp;amp; filename : files_to_delete) {  
    env_-&amp;amp;gt;RemoveFile(dbname_ + &amp;amp;quot;/&amp;amp;quot; + filename);  
  }  
  mutex_.Lock();  
}&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;8ã€ç‰ˆæœ¬&lt;/h2&gt;
&lt;h3&gt;8.1 MANIFEST - descriptor log æ–‡ä»¶&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚å‰æ‰€è¿°ï¼Œæ•°æ®ç‰ˆæœ¬å˜æ›´ä¿¡æ¯ï¼ˆVersionEditï¼‰ä¼šæŒä¹…åŒ–å­˜å‚¨åˆ° MANIFEST æ–‡ä»¶ä¸­ã€‚MANIFEST æ–‡ä»¶å†…å®¹çš„ç¼–ç ç»“æ„åŒ WAL logã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ•°æ®ç‰ˆæœ¬å˜æ›´ä¿¡æ¯åŒ…å«8ä¸ªéƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1ã€ç”¨æˆ·è‡ªå®šä¹‰ key æ¯”è¾ƒå™¨çš„åç§°ï¼ˆå¦‚æœç”¨æˆ·é…ç½®çš„è¯ï¼‰&lt;/li&gt;
&lt;li&gt;2ã€æœ€æ–° WAL log æ–‡ä»¶çš„ id&lt;/li&gt;
&lt;li&gt;3ã€å‰ä¸€ä¸ª WAL log æ–‡ä»¶çš„ id&lt;/li&gt;
&lt;li&gt;4ã€ä¸‹ä¸€ä¸ªå¯ç”¨çš„æ–‡ä»¶ id&lt;/li&gt;
&lt;li&gt;5ã€ä¸‹ä¸€ä¸ªå¯ç”¨çš„åºåˆ—å·&lt;/li&gt;
&lt;li&gt;6ã€æ¯ä¸ª level æœ€è¿‘ä¸€æ¬¡çš„ compaction æš‚å­˜ä¿¡æ¯ï¼ˆcompaction éå†çš„æœ€åä¸€ä¸ª keyï¼‰&lt;/li&gt;
&lt;li&gt;7ã€æ¯ä¸ª level å¯ä»¥åˆ é™¤çš„æ•°æ®æ–‡ä»¶çš„å…ƒæ•°æ®ï¼ˆcompaction çš„è¾“å…¥æ–‡ä»¶ï¼‰&lt;/li&gt;
&lt;li&gt;8ã€æ¯ä¸ª level æ–°å¢çš„æ•°æ®æ–‡ä»¶çš„å…ƒæ•°æ®ï¼ˆcompaction çš„è¾“å‡ºæ–‡ä»¶ï¼‰&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;// Tag numbers for serialized VersionEdit.  These numbers are written to  
// disk and should not be changed.  
enum Tag {  
  kComparator = 1,  
  kLogNumber = 2,  
  kNextFileNumber = 3,  
  kLastSequence = 4,  
  kCompactPointer = 5,  
  kDeletedFile = 6,  
  kNewFile = 7,  
  // 8 was used for large value refs  
  kPrevLogNumber = 9  
};

void VersionEdit::EncodeTo(std::string* dst) const {  
  if (has_comparator_) {  
    PutVarint32(dst, kComparator);  
    PutLengthPrefixedSlice(dst, comparator_);  
  }  
  if (has_log_number_) {  
    PutVarint32(dst, kLogNumber);  
    PutVarint64(dst, log_number_);  
  }  
  if (has_prev_log_number_) {  
    PutVarint32(dst, kPrevLogNumber);  
    PutVarint64(dst, prev_log_number_);  
  }  
  if (has_next_file_number_) {  
    PutVarint32(dst, kNextFileNumber);  
    PutVarint64(dst, next_file_number_);  
  }  
  if (has_last_sequence_) {  
    PutVarint32(dst, kLastSequence);  
    PutVarint64(dst, last_sequence_);  
  }  
  
  for (size_t i = 0; i &amp;amp;lt; compact_pointers_.size(); i++) {  
    PutVarint32(dst, kCompactPointer);  
    PutVarint32(dst, compact_pointers_[i].first);  // level  
    PutLengthPrefixedSlice(dst, compact_pointers_[i].second.Encode());  
  }  
  
  for (const auto&amp;amp;amp; deleted_file_kvp : deleted_files_) {  
    PutVarint32(dst, kDeletedFile);  
    PutVarint32(dst, deleted_file_kvp.first);   // level  
    PutVarint64(dst, deleted_file_kvp.second);  // file number  
  }  
  
  for (size_t i = 0; i &amp;amp;lt; new_files_.size(); i++) {  
    const FileMetaData&amp;amp;amp; f = new_files_[i].second;  
    PutVarint32(dst, kNewFile);  
    PutVarint32(dst, new_files_[i].first);  // level  
    PutVarint64(dst, f.number);  
    PutVarint64(dst, f.file_size);  
    PutLengthPrefixedSlice(dst, f.smallest.Encode());  
    PutLengthPrefixedSlice(dst, f.largest.Encode());  
  }  
}&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;8.2 CURRENT æ–‡ä»¶&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;CURRENT æ–‡ä»¶ä¸­å­˜å‚¨çš„æ˜¯æœ€æ–°æœ‰æ•ˆçš„ MANIFEST æ–‡ä»¶åã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ•°æ®åº“æ‰“å¼€ï¼Œæ¢å¤çŠ¶æ€çš„æµç¨‹ä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1ã€ä» CURRENT ä¸­è·å–æœ€æ–°æœ‰æ•ˆçš„ MANIFEST æ–‡ä»¶å&lt;/li&gt;
&lt;li&gt;2ã€ä»æœ€æ–°æœ‰æ•ˆçš„ MANIFEST æ–‡ä»¶ä¸­è¯»å–åˆ°&lt;u&gt;æœ€åä¸€ä¸ª VersionEdit ç‰ˆæœ¬ä¿¡æ¯&lt;/u&gt;&lt;/li&gt;
&lt;li&gt;3ã€æ ¹æ® VersionEdit ç‰ˆæœ¬ä¿¡æ¯ï¼Œè®¡ç®—å‡ºæœ€æ–°å¯ç”¨çš„ Version ä¿¡æ¯ï¼ˆä»…åŒ…å«æ¯ä¸ª level åŒ…å«å“ªäº›æ•°æ®æ–‡ä»¶ï¼‰ï¼Œå¹¶è®¡ç®—è¯¥ç‰ˆæœ¬ä¸‹ä¸€æ¬¡ compaction åº”è¯¥å¤„ç†å“ªä¸ª level çš„æ•°æ®æ–‡ä»¶ï¼ˆ&lt;code&gt;compaction_level_&lt;/code&gt;ï¼‰å’Œç´§è¿«ç¨‹åº¦ï¼ˆ&lt;code&gt;compaction_score_&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;4ã€å°†æœ€æ–°å¯ç”¨çš„ Version åŠ å…¥åˆ° &lt;code&gt;versions_&lt;/code&gt;ï¼ˆ&lt;code&gt;VersionSet&lt;/code&gt;ï¼‰ çš„ç‰ˆæœ¬é“¾ä¸­ï¼Œå¹¶æ¢å¤  &lt;code&gt;versions_&lt;/code&gt; çš„ä¸€äº›çŠ¶æ€ä¿¡æ¯ï¼Œä»¥åŠç¡®å®šæ˜¯å¦å¤ç”¨ CURRENTæŒ‡å‘çš„é‚£ä¸ª MANIFEST æ–‡ä»¶ï¼ˆå¦‚æœ MANIFEST æ–‡ä»¶å¤§å°è¶…è¿‡é˜ˆå€¼ï¼ˆ&lt;code&gt;size_t max_file_size = 2 * 1024 * 1024&lt;/code&gt;ï¼‰ åˆ™ä¸å¤ç”¨ï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ï¼‰&lt;/li&gt;
&lt;li&gt;5ã€æ ¹æ®ä»â€œæœ€åä¸€ä¸ª VersionEdit åŸå§‹ç‰ˆæœ¬ä¿¡æ¯â€ æ¢å¤åˆ° &lt;code&gt;versions_&lt;/code&gt; çš„â€œå‰ä¸€ä¸ª WAL log æ–‡ä»¶ idâ€- &lt;code&gt;min_log&lt;/code&gt; å’Œâ€œæœ€æ–°ä¸€ä¸ª WAL log æ–‡ä»¶ idâ€ - &lt;code&gt;prev_log&lt;/code&gt;ï¼Œ&lt;u&gt;å°†æ–‡ä»¶ id å¤§äºç­‰äº &lt;code&gt;min_log&lt;/code&gt; æˆ–è€…ç­‰äº &lt;code&gt;pre_log&lt;/code&gt; çš„æ‰€æœ‰ WAL log æ–‡ä»¶æ‰¾å‡ºæ¥ï¼ŒæŒ‰ç…§æ–‡ä»¶ id ä»å°å¤§åˆ°æ’åºï¼Œ ç„¶åé¡ºåºéå†è§£æï¼Œæ¢å¤å‡º memtable å†…å­˜çŠ¶æ€&lt;/u&gt;ï¼Œå¹¶åœ¨æœ€åç¡®ä¿æ‰€æœ‰å†…å­˜çŠ¶æ€æŒä¹…åŒ–è½åˆ° $level_0$ æ–‡ä»¶ä¸­ã€‚
&lt;ul&gt;&lt;li&gt;â€œå°†æ–‡ä»¶ id å¤§äºç­‰äº &lt;code&gt;min_log&lt;/code&gt; æˆ–è€…ç­‰äº &lt;code&gt;pre_log&lt;/code&gt; çš„æ‰€æœ‰ WAL log æ–‡ä»¶æ‰¾å‡ºæ¥ï¼ŒæŒ‰ç…§æ–‡ä»¶ id ä»å°å¤§åˆ°æ’åºï¼Œ ç„¶åé¡ºåºéå†è§£æï¼Œæ¢å¤å‡º memtable å†…å­˜çŠ¶æ€â€ï¼šè¿™ä¸ªé€»è¾‘ä¹Ÿæ„å‘³ç€å¹¶&lt;strong&gt;ä¸éœ€è¦&lt;/strong&gt;åœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„ WAL log æ–‡ä»¶æ—¶å°±äº§ç”Ÿä¸€ä¸ªæ–°çš„ç‰ˆæœ¬ï¼Œ&lt;strong&gt;ä¹Ÿä¸éœ€è¦&lt;/strong&gt;æŠŠæœ€æ–°ç‰ˆæœ¬ä¿¡æ¯æŒä¹…åŒ–å†™åˆ°  MANIFEST æ–‡ä»¶ ä¸­ã€‚å› æ­¤ä¹Ÿä¸ä¼šå’Œ compaction ç‰ˆæœ¬å˜æ›´å­˜åœ¨æ“ä½œå†²çªã€‚&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;8.3 VersionEdit &amp; VersionSet &amp; Version&lt;/h3&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;class VersionEdit {
public:
  // Add the specified file at the specified number.  
  // REQUIRES: This version has not been saved (see VersionSet::SaveTo)  
  // REQUIRES: &amp;amp;quot;smallest&amp;amp;quot; and &amp;amp;quot;largest&amp;amp;quot; are smallest and largest keys in file  
  void AddFile(int level, uint64_t file, uint64_t file_size,  
               const InternalKey&amp;amp;amp; smallest, const InternalKey&amp;amp;amp; largest) {  
    FileMetaData f;  
    f.number = file;  
    f.file_size = file_size;  
    f.smallest = smallest;  
    f.largest = largest;  
    new_files_.push_back(std::make_pair(level, f));  
  }  
  
  // Delete the specified &amp;amp;quot;file&amp;amp;quot; from the specified &amp;amp;quot;level&amp;amp;quot;.  
  void RemoveFile(int level, uint64_t file) {  
    deleted_files_.insert(std::make_pair(level, file));  
  }

private:
  typedef std::set&amp;amp;lt;std::pair&amp;amp;lt;int, uint64_t&amp;amp;gt;&amp;amp;gt; DeletedFileSet;  
  
  std::string comparator_;  
  uint64_t log_number_;  
  uint64_t prev_log_number_;  
  uint64_t next_file_number_;  
  SequenceNumber last_sequence_;  
  bool has_comparator_;  
  bool has_log_number_;  
  bool has_prev_log_number_;  
  bool has_next_file_number_;  
  bool has_last_sequence_;  
  
  std::vector&amp;amp;lt;std::pair&amp;amp;lt;int, InternalKey&amp;amp;gt;&amp;amp;gt; compact_pointers_;  
  DeletedFileSet deleted_files_;  
  std::vector&amp;amp;lt;std::pair&amp;amp;lt;int, FileMetaData&amp;amp;gt;&amp;amp;gt; new_files_;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;VersionEdit æ˜¯ Version ç‰ˆæœ¬ä¿¡æ¯å¤„äºç¼–è¾‘/å˜æ›´çš„çŠ¶æ€ï¼Œæ˜¯ Version ç‰ˆæœ¬ä¿¡æ¯æ“ä½œçš„ä¸€ç§æ—¥å¿—ç»“æ„ï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;compaction è¿‡ç¨‹æ¶‰åŠå¯¹æœ€æ–°ç‰ˆæœ¬çš„ä¸¤ä¸ª level å¯åˆ é™¤æ–‡ä»¶å’Œæ–°å¢æ–‡ä»¶çš„è®°å½•ï¼Œä»¥åŠ compaction æš‚å­˜çŠ¶æ€çš„è®°å½•ã€‚&lt;/li&gt;
&lt;li&gt;æŒä¹…åŒ–è®°å½•åˆ° MANIFEST æ–‡ä»¶ä¸­ï¼Œç”¨äºæ¢å¤æ•°æ®åº“çš„çŠ¶æ€ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;class VersionSet {
public:
  VersionSet(const std::string&amp;amp;amp; dbname, const Options* options,  
           TableCache* table_cache, const InternalKeyComparator*);

  // Apply *edit to the current version to form a new descriptor that  
  // is both saved to persistent state and installed as the new  
  // current version.  Will release *mu while actually writing to the file.  
  // REQUIRES: *mu is held on entry.  
  // REQUIRES: no other thread concurrently calls LogAndApply()  
  Status LogAndApply(VersionEdit* edit, port::Mutex* mu)  
      EXCLUSIVE_LOCKS_REQUIRED(mu);

  // Recover the last saved descriptor from persistent storage.  
  Status Recover(bool* save_manifest);

  // Return the current version.  
  Version* current() const { return current_; }  
  
  // Return the current manifest file number  
  uint64_t ManifestFileNumber() const { return manifest_file_number_; }  
  
  // Allocate and return a new file number  
  uint64_t NewFileNumber() { return next_file_number_++; }

  // Pick level and inputs for a new compaction.  
  // Returns nullptr if there is no compaction to be done.  
  // Otherwise returns a pointer to a heap-allocated object that  
  // describes the compaction.  Caller should delete the result.  
  Compaction* PickCompaction();

  // Create an iterator that reads over the compaction inputs for &amp;amp;quot;*c&amp;amp;quot;.  
  // The caller should delete the iterator when no longer needed.  
  Iterator* MakeInputIterator(Compaction* c);

private:
  Env* const env_;  
  const std::string dbname_;  
  const Options* const options_;  
  TableCache* const table_cache_;  
  const InternalKeyComparator icmp_;  
  uint64_t next_file_number_;  
  uint64_t manifest_file_number_;  
  uint64_t last_sequence_;  
  uint64_t log_number_;  
  uint64_t prev_log_number_;  // 0 or backing store for memtable being compacted  
  
  // Opened lazily  
  WritableFile* descriptor_file_;  
  log::Writer* descriptor_log_;  
  Version dummy_versions_;  // Head of circular doubly-linked list of versions.  
  Version* current_;        // == dummy_versions_.prev_  
  
  // Per-level key at which the next compaction at that level should start.  
  // Either an empty string, or a valid InternalKey.  
  std::string compact_pointer_[config::kNumLevels];
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;VersionSet å¯¹è±¡ç»´æŠ¤ç€ç‰ˆæœ¬åŒå‘é“¾è¡¨ä»¥åŠå…¶ä»–å¿…è¦ä¿¡æ¯ï¼Œç”¨äºæ”¯æŒ compaction æ“ä½œã€å¯¹ $level_0$~$level_n$ çš„æ£€ç´¢æ“ä½œ ç­‰ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;class Version {
public:
  // Lookup the value for key.  If found, store it in *val and  
  // return OK.  Else return a non-OK status.  Fills *stats.  
  // REQUIRES: lock is not held  
  Status Get(const ReadOptions&amp;amp;amp;, const LookupKey&amp;amp;amp; key, std::string* val,  
             GetStats* stats);

private:
  Iterator* NewConcatenatingIterator(const ReadOptions&amp;amp;amp;, int level) const;

  VersionSet* vset_;  // VersionSet to which this Version belongs  
  Version* next_;     // Next version in linked list  
  Version* prev_;     // Previous version in linked list  
  int refs_;          // Number of live refs to this version  
  
  // List of files per level  
  std::vector&amp;amp;lt;FileMetaData*&amp;amp;gt; files_[config::kNumLevels];  
  
  // Next file to compact based on seek stats.  
  FileMetaData* file_to_compact_;  
  int file_to_compact_level_;  
  
  // Level that should be compacted next and its compaction score.  
  // Score &amp;amp;lt; 1 means compaction is not strictly needed.  These fields  
  // are initialized by Finalize().  
  double compaction_score_;  
  int compaction_level_;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;compaction çš„è¾“å…¥æ–‡ä»¶åœ¨ compaction ä¹‹åæœ¬æ¥æ˜¯å¯ä»¥åˆ é™¤çš„ï¼Œä½†æ˜¯&lt;u&gt;è¿™äº›æ–‡ä»¶å¯èƒ½è¢«æ£€ç´¢/éå†ç­‰æ“ä½œæ‰€ä¾èµ–å¼•ç”¨&lt;/u&gt;ï¼Œæ‰€ä»¥åŸºäº Version ç‰ˆæœ¬æ¥è§£å†³æ–‡ä»¶ç²’åº¦çš„å¹¶å‘æ“ä½œå†²çªã€‚åªæœ‰å½“ä¸€ä¸ªç‰ˆæœ¬ä¸è¢«ä»»ä½•æ“ä½œæ‰€å¼•ç”¨æ—¶ï¼Œæ‰ä¼šè¢«é‡Šæ”¾ï¼Œåªæœ‰è¿™ä¸ªç‰ˆæœ¬ä¾èµ–çš„æ•°æ®æ–‡ä»¶ä¹Ÿæ‰å¯ä»¥è¢«åˆ é™¤ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å’Œ leveldb ä¸­å¾ˆå¤šç±»å®ç°çš„å¯¹è±¡ç”Ÿå‘½å‘¨æœŸç»´æŠ¤æ–¹å¼ä¸€æ ·ï¼Œ Version ä¹Ÿé‡‡ç”¨å¼•ç”¨è®¡æ•°çš„æ–¹å¼æ¥ç»´æŠ¤ç”Ÿå‘½å‘¨æœŸï¼Œå¦‚æœç‰ˆæœ¬å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å½’é›¶ï¼Œåˆ™è‡ªåŠ¨ææ„è‡ªå·±ï¼Œææ„çš„é€»è¾‘åŒ…æ‹¬ä»ç‰ˆæœ¬åŒé“¾è¡¨ä¸­ç§»é™¤è‡ªå·±ï¼ˆè¿™é‡Œå¯èƒ½å­˜åœ¨å¹¶å‘å†²çªå—ï¼Ÿï¼‰ï¼Œä»¥åŠç§»é™¤å¯¹å„ level æ–‡ä»¶å…ƒä¿¡æ¯çš„å¼•ç”¨ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;void Version::Ref() { ++refs_; }  
  
void Version::Unref() {  
  assert(this != &amp;amp;amp;vset_-&amp;amp;gt;dummy_versions_);  
  assert(refs_ &amp;amp;gt;= 1);  
  --refs_;  
  if (refs_ == 0) {
    delete this;  
  }  
}

Version::~Version() {  
  assert(refs_ == 0);  
  
  // Remove from linked list  
  prev_-&amp;amp;gt;next_ = next_;  
  next_-&amp;amp;gt;prev_ = prev_;  
  
  // Drop references to files  
  for (int level = 0; level &amp;amp;lt; config::kNumLevels; level++) {  
    for (size_t i = 0; i &amp;amp;lt; files_[level].size(); i++) {  
      FileMetaData* f = files_[level][i];  
      assert(f-&amp;amp;gt;refs &amp;amp;gt; 0);  
      f-&amp;amp;gt;refs--;  
      if (f-&amp;amp;gt;refs &amp;amp;lt;= 0) {  
        delete f;  
      }  
    }  
  }  
}&lt;/code&gt;&lt;/pre&gt;</description>
            <pubDate>2024-11-15</pubDate>
            <link>https://blog.xiayf.cn/posts/leveldb-note-3.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/leveldb-note-3.html</guid>
        </item>
        
        <item>
            <title>è¯»ç ï¼šLevelDB - ldb æ•°æ®æ–‡ä»¶æ ¼å¼</title>
            <description>&lt;h2&gt;5ã€leveldb æ•°æ®æ–‡ä»¶æ ¼å¼ - ldb&lt;/h2&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;&amp;amp;lt;beginning_of_file&amp;amp;gt;
[data block 1]
[data block 2]
...
[data block N]
[meta block 1]
...
[meta block K]
[metaindex block]
[index block]
[Footer]        (fixed size; starts at file_size - sizeof(Footer))
&amp;amp;lt;end_of_file&amp;amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;leveldb æ–‡ä»¶ï¼ˆæ–‡ä»¶åç¼€ &lt;code&gt;.ldb&lt;/code&gt;ï¼‰å†…å®¹ç”± N ä¸ª â€œdata å—â€ éƒ¨åˆ†ã€ K ä¸ª â€œmeta å—â€ éƒ¨åˆ†ã€1ä¸ª â€œmetaindex å—â€ éƒ¨åˆ†ã€1ä¸ª â€œindex å—â€éƒ¨åˆ†ã€1ä¸ª â€œFooterâ€ éƒ¨åˆ†ä¾æ¬¡æ„æˆã€‚&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/4jKOHEMRi6SYD9n.png&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;830&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ldb æ•°æ®æ–‡ä»¶çš„åŠ è½½è§£ææµç¨‹ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1ã€å–æ–‡ä»¶æœ«å°¾çš„ 28 ä¸ªå­—èŠ‚ï¼Œè§£æå‡º(1) metaindex block çš„ offset &amp; size (2) index block çš„ offset &amp; size&lt;/li&gt;
&lt;li&gt;2ã€æ ¹æ® metaindex block çš„ offset &amp; size è§£æå‡º â€œè¿‡æ»¤ç­–ç•¥åç§°â€ å’Œ meta block çš„ offset &amp; size
&lt;ul&gt;&lt;li&gt;æ ¹æ®â€œè¿‡æ»¤ç­–ç•¥åç§°â€ å®ä¾‹åŒ–è¿‡æ»¤ç­–ç•¥&lt;/li&gt;
&lt;li&gt;å¯¹äº meta block çš„è§£æï¼Œå…ˆè§£æå‡ºâ€œç¬¬3éƒ¨åˆ†â€ å’Œ â€œç¬¬4éƒ¨åˆ†â€çš„å€¼ï¼Œå¾—åˆ°â€œç¬¬1éƒ¨åˆ†â€çš„é•¿åº¦ï¼Œç»§è€Œå¾—åˆ°â€œç¬¬2ï¸éƒ¨åˆ†â€çš„åç§»ä½ç½®å’Œé•¿åº¦ï¼ˆä¹Ÿå³ &lt;code&gt;filter_offsets_&lt;/code&gt; çš„å†…å®¹ï¼‰&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;3ã€æ ¹æ® index block çš„ offset &amp; size è§£æå‡ºæ‰€æœ‰ data block çš„â€œkey åŒºé—´â€ã€offset å’Œ size&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;â€œç‚¹æŸ¥â€ï¼Œå¯¹äº ldb æ•°æ®æ–‡ä»¶çš„æ£€ç´¢æµç¨‹ä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1ã€ä½¿ç”¨ keyï¼Œä»æœ€æ–°ç‰ˆæœ¬ä¸­ä»å°åˆ°å¤§é€ä¸ª level åŒ¹é…å…¶æ–‡ä»¶å…ƒæ•°æ®&lt;/li&gt;
&lt;li&gt;2ã€å¯¹ç›®æ ‡ ldb æ–‡ä»¶ï¼Œä½¿ç”¨ key ä» index block ä¸­é€šè¿‡äºŒåˆ†æŸ¥æ‰¾åŒ¹é…åˆ°ç›®æ ‡ data block çš„ offset &amp; size&lt;/li&gt;
&lt;li&gt;3ã€æ ¹æ®ç›®æ ‡ data block çš„ offset å¯¹ meta block çš„ &lt;code&gt;filter_offsets_&lt;/code&gt; è®¡ç®—è€Œåå–åˆ°ç›®æ ‡è¿‡æ»¤æ•°æ®å—ï¼Œäº¤ç»™è¿‡æ»¤ç­–ç•¥å®ä¾‹è¿›è¡Œåˆæ­¥çš„åŒ¹é…ç­›é€‰&lt;/li&gt;
&lt;li&gt;4ã€å¦‚æœ 3 ä¸­æ²¡æœ‰åŒ¹é…åˆ°ï¼Œåˆ™æ ¹æ®ç›®æ ‡ data block çš„ offset è®¡ç®—å–åˆ° data block çš„â€œé‡ç½®ä½ç‚¹åºåˆ—â€ï¼Œç»§è€Œå¯¹ data block çš„â€œé”®å€¼å¯¹åºåˆ—â€è¿›è¡Œè§£æéå†åŒ¹é…&lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;5.1 â€œFooterâ€éƒ¨åˆ†&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é•¿åº¦ä¸ºå›ºå®šå€¼ &lt;code&gt;kEncodedLength&lt;/code&gt;ï¼ˆ$2 * BlockHandle::kMaxEncodedLength + 8 = 28$ï¼‰&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å…ˆåå­˜å…¥ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1ã€â€œmetaindex å—â€åœ¨æ–‡ä»¶ä¸­çš„åç§»ä½ç½® offset å’Œ å—å¤§å° sizeã€‚&lt;/li&gt;
&lt;li&gt;2ã€â€œindexâ€ å—åœ¨æ–‡ä»¶ä¸­çš„åç§»ä½ç½® offset å’Œ å—å¤§å° sizeã€‚&lt;/li&gt;
&lt;li&gt;3ã€å°†â€œFooterâ€é•¿åº¦å¡«å…… åˆ° $2 * BlockHandle::kMaxEncodedLength = 20$ é•¿åº¦ã€‚&lt;/li&gt;
&lt;li&gt;4ã€ä»¥å°ç«¯åºå†™å…¥ä¸€ä¸ª64æ¯”ç‰¹çš„é­”æ³•æ•°ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/9fXToy6AGZe4C82.png&apos; title=&apos;ldb-footer&apos; alt=&apos;ldb-footer&apos; width=&apos;600&apos;/&gt;
&lt;h3&gt;5.2 â€œå—â€çš„æ ¼å¼&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å°†é”®å€¼å†™å…¥å—çš„å†…å­˜ç¼“å†²åŒºæ—¶ï¼Œæ¯è¿ç»­ 16 ï¼ˆé»˜è®¤å€¼ï¼Œå¯é…ç½®ï¼‰ä¸ªé”®ä¼šè¿›è¡Œ delta ç¼–ç å‹ç¼©ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1ã€å…ˆè®¡ç®—å½“å‰é”®ä¸å‰ä¸€æ¬¡å†™å…¥é”®çš„å…±åŒå‰ç¼€é•¿åº¦&lt;/li&gt;
&lt;li&gt;2ã€ä¾æ¬¡å†™å…¥â€œé”®å…±åŒå‰ç¼€é•¿åº¦â€ã€â€œå½“å‰é”®å»æ‰å…±åŒå‰ç¼€åçš„é•¿åº¦â€ã€â€œå€¼çš„é•¿åº¦â€ã€â€œå½“å‰é”®å»æ‰å…±åŒå‰ç¼€åçš„å†…å®¹â€ã€â€œå€¼å†…å®¹â€&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœè¿ç»­â€œdelta ç¼–ç å‹ç¼©â€çš„é”®æ•°/å†™å…¥æ¬¡æ•°è¾¾åˆ°é˜ˆå€¼ 16ï¼Œåˆ™å°†å½“å‰å†…å­˜ç¼“å†²åŒºçš„å¤§å°è®°å½•åˆ°â€œé‡ç½®ä½ç‚¹åˆ—è¡¨â€ï¼ˆ&lt;code&gt;restarts_&lt;/code&gt;ï¼‰ä¸­ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å°†å—çš„å†…å­˜ç¼“å­˜åŒºå†…å®¹è½åˆ°æ–‡ä»¶çš„æµç¨‹ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1ã€æŠŠ&lt;u&gt;â€œé‡ç½®ä½ç‚¹åˆ—è¡¨â€ä¸­çš„å…ƒç´ &lt;/u&gt;ä¾æ¬¡é€ä¸ªæ·»åŠ åˆ°ç¼“å†²åŒºå°¾éƒ¨ã€‚&lt;/li&gt;
&lt;li&gt;2ã€å°†&lt;u&gt;â€œé‡ç½®ä½ç‚¹â€æ•°é‡&lt;/u&gt;ä»¥å›ºå®š32æ¯”ç‰¹é•¿åº¦æ·»åŠ åˆ°ç¼“å†²åŒºå°¾éƒ¨ã€‚&lt;/li&gt;
&lt;li&gt;3ã€å°†ç¼“å†²åŒºå†…å®¹æ•´ä½“åšä¸€æ¬¡é€šç”¨å‹ç¼©ï¼ˆå¯é…ç½® ä¸å‹ç¼©ã€snappy å‹ç¼©ã€zstd å‹ç¼©ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;4ã€å°†å‹ç¼©åçš„å­—èŠ‚åºåˆ—å†™å…¥æ–‡ä»¶åï¼Œå†å°† å‹ç¼©ç±»å‹(CompressionTypeï¼Œ1å­—èŠ‚) å’Œ â€œå‹ç¼©åçš„å­—èŠ‚åºåˆ— ä¸ å‹ç¼©ç±»å‹â€ çš„ crc32 æ ¡éªŒç ï¼ˆ4å­—èŠ‚ï¼‰å†™åˆ°æ–‡ä»¶çš„å°¾éƒ¨ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;enum CompressionType {  
  // NOTE: do not change the values of existing entries, as these are  
  // part of the persistent format on disk.
  kNoCompression = 0x0,  
  kSnappyCompression = 0x1,  
  kZstdCompression = 0x2,  
};&lt;/code&gt;&lt;/pre&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/UzgZTxtOsaqYn9w.png&apos; title=&apos;ldb-block-encode&apos; alt=&apos;ldb-block-encode&apos; width=&apos;800&apos;/&gt;
&lt;h3&gt;5.3 â€œdata å—â€&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;leveldb æ–‡ä»¶ä¸­â€œdata å—â€æ•°æ®æ˜¯æŒ‰ç…§ key æœ‰åºå­˜å‚¨çš„ã€‚åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå—ä¸å—ä¹‹é—´æœ‰åºï¼Œå—ä¹‹é—´ key èŒƒå›´ä¸ä¼šæœ‰é‡åˆï¼Œå—å†…å†…å®¹ä¹Ÿæ˜¯æŒ‰ key æœ‰åºå­˜å‚¨ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å› ä¸ºæœ‰åºï¼Œ ä½¿ç”¨é»˜è®¤çš„ BytewiseComparatorï¼Œdelta ç¼–ç å‹ç¼©æ•ˆæœé€šå¸¸ä¼šæ˜æ˜¾ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äºâ€œdata å—â€ï¼Œå¦‚æœå—çš„å†…å­˜ç¼“å†²åŒºå†…å®¹å¤§å°ï¼ˆé€šç”¨å‹ç¼©å‰çš„åŸå§‹å†…å®¹å¤§å°+é‡ç½®ä½ç‚¹æ•°ç»„å¤§å°+é‡ç½®ä½ç‚¹æ•°ç»„é•¿åº¦ï¼‰è¶…è¿‡ 4KBï¼ˆå¯é…ç½®ï¼Œé…ç½®é¡¹ &lt;code&gt;block_size&lt;/code&gt;ï¼‰ï¼Œå°±ä¼šå°†å—çš„å†…å­˜ç¼“å†²åŒºä½œä¸ºä¸€ä¸ªâ€œdata å—â€è½åˆ°æ–‡ä»¶ä¸­ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;// Approximate size of user data packed per block.  Note that the  
// block size specified here corresponds to uncompressed data.  The  
// actual size of the unit read from disk may be smaller if  
// compression is enabled.  This parameter can be changed dynamically.  
size_t block_size = 4 * 1024;&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;5.4 â€œindex å—â€&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;â€œindex å—â€ å­˜å‚¨ â€œdata å—â€ çš„ç´¢å¼•ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å½“ä¸€ä¸ªâ€œdata å—â€ä»å†…å­˜ç¼“å­˜åŒºè½åˆ°æ–‡ä»¶åï¼Œå°†è¯¥â€œdata å—â€æœ€å/æœ€å¤§çš„ keyï¼ˆç»å­˜å‚¨ä¼˜åŒ–å¤„ç†åï¼‰ ä½œä¸º é”®ï¼ˆ&lt;u&gt;å¤§è‡´å«ä¹‰-å½“å‰å—ä¸­æ‰€æœ‰ key éƒ½å°äºè¯¥é”®ï¼Œä¸‹ä¸€ä¸ªå—ä¸­æ‰€æœ‰ key éƒ½å¤§äºç­‰äºè¯¥é”®&lt;/u&gt;ï¼‰ï¼Œè¯¥â€œdata å—â€åœ¨æ–‡ä»¶ä¸­çš„åç§»ä½ç½® offset å’Œ å—å¤§å° size æ‰“åŒ…åä½œä¸ºå€¼ï¼Œå†™å…¥â€œindex å—â€å†…å­˜ç¼“å†²åŒºã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å½“ leveldb æ–‡ä»¶çš„æ‰€æœ‰â€œdata å—â€éƒ½å†™å…¥æ–‡ä»¶åï¼Œä¼šå°†â€œindex å—â€å†…å­˜ç¼“å†²åŒºå†…å®¹ä¹ŸæŒ‰ç…§â€œå—â€æ ¼å¼å†™å…¥æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Get key æ£€ç´¢æ—¶ï¼Œ&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1ã€å…ˆä» â€œFooterâ€ éƒ¨åˆ†å–å‡ºâ€œindex å—çš„â€ offer å’Œ sizeï¼Œ&lt;/li&gt;
&lt;li&gt;2ã€ç„¶ååœ¨â€œindex å—â€è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œæ‰¾åˆ°ç›®æ ‡â€œdata å—â€ï¼Œ&lt;/li&gt;
&lt;li&gt;3ã€ä»ç›®æ ‡â€œdata å—â€ä¸­è§£æå‡ºæ¥é‡ç½®ä½ç‚¹æ•°ç»„ï¼Œç»§ç»­è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;5.5 â€œmeta å—â€ &amp; â€œmetaindex å—â€&lt;/h3&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;// A FilterBlockBuilder is used to construct all of the filters for a  
// particular Table.  It generates a single string which is stored as  
// a special block in the Table.  
//  
// The sequence of calls to FilterBlockBuilder must match the regexp:  
//      (StartBlock AddKey*)* Finish  
class FilterBlockBuilder {  
 public:  
  explicit FilterBlockBuilder(const FilterPolicy*);  
  
  void StartBlock(uint64_t block_offset);  
  void AddKey(const Slice&amp;amp;amp; key);  
  Slice Finish();  
  
 private:  
  void GenerateFilter();  
  
  const FilterPolicy* policy_;  

  std::string keys_;             // Flattened key contents  
  std::vector&amp;amp;lt;size_t&amp;amp;gt; start_;    // Starting index in keys_ of each key  

  std::string result_;           // Filter data computed so far  
  std::vector&amp;amp;lt;Slice&amp;amp;gt; tmp_keys_;  // policy_-&amp;amp;gt;CreateFilter() argument  
  std::vector&amp;amp;lt;uint32_t&amp;amp;gt; filter_offsets_;  
};

void FilterBlockBuilder::StartBlock(uint64_t block_offset) {  
  uint64_t filter_index = (block_offset / kFilterBase);  
  assert(filter_index &amp;amp;gt;= filter_offsets_.size());  
  while (filter_index &amp;amp;gt; filter_offsets_.size()) {  
    GenerateFilter();  
  }  
}

void FilterBlockBuilder::AddKey(const Slice&amp;amp;amp; key) {  
  Slice k = key;  
  start_.push_back(keys_.size());  
  keys_.append(k.data(), k.size());  
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç›®å‰çš„å®ç°ï¼Œå¦‚æœ leveldb æ–‡ä»¶ä¸­å­˜åœ¨â€œmeta å—â€ï¼Œåº”è¯¥ä¹Ÿåªä¼šæœ‰ä¸€ä¸ªï¼Œå³&lt;strong&gt;è¿‡æ»¤æ•°æ®å—&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœ leveldb æ•°æ®åº“å¼€å¯äº†æ£€ç´¢æ—¶è¿‡æ»¤ç­–ç•¥ï¼ˆFilterPolicyï¼‰ï¼Œåˆ™å¯¹äºå†™å…¥â€œdata å—â€çš„æ¯ä¸ª keyï¼Œéƒ½ä¼šè¢«è®°å½•åˆ° filter å†…å­˜ç¼“å†²åŒºï¼ˆ&lt;code&gt;FilterBlockBuilder&lt;/code&gt;ï¼‰ä¸­ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å½“ä¸€ä¸ªâ€œdata å—â€åˆ·åˆ°æ–‡ä»¶åï¼Œå°±å¯¹ FilterBlockBuilder ä¸­å­˜å…¥çš„ key åºåˆ—ç®—ä¸€ä¸‹â€œè¿‡æ»¤æ•°æ®â€ï¼Œæ‹¼æ¥åˆ° &lt;code&gt;result_&lt;/code&gt; åé¢ï¼Œä»¥åŠå°†æœ€æ–°è®¡ç®—çš„â€œè¿‡æ»¤æ•°æ®â€åœ¨ &lt;code&gt;result_&lt;/code&gt; ä¸­çš„åç§»ä½ç½®å­˜åˆ° &lt;code&gt;filter_offets_&lt;/code&gt; å‘é‡ä¸­ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;å‡†å¤‡å¤„ç†ç¬¬ä¸€ä¸ªâ€œdata å—â€æ—¶ï¼Œ
- FilterBlockBuilder çš„ filter_offsets_ ä¸ºç©ºæ•°ç»„ []ï¼Œ result_ ä¸ºç©ºå­—ç¬¦ä¸² &amp;amp;quot;&amp;amp;quot;
- å½“ç¬¬ä¸€ä¸ªâ€œdata å—â€åˆ·åˆ°æ•°æ®æ–‡ä»¶åï¼Œå‡†å¤‡å¤„ç†ç¬¬äºŒä¸ªâ€œdata å—â€ï¼Œå› &amp;amp;lt;u&amp;amp;gt;é€»è¾‘ä¸Š&amp;amp;lt;/u&amp;amp;gt;çº¦æŸæ¯ 2KB æ•°æ®ç®—ä¸€æ¬¡è¿‡æ»¤æ•°æ®
	- case-1ï¼šå¦‚æœç¬¬ä¸€ä¸ªâ€œdata å—â€å¤§å° &amp;amp;lt; 4KBï¼ˆå¤§æ¦‚ç‡æ˜¯è¿™æ ·ï¼‰ï¼Œé‚£ä¹ˆ filter_index = 1ï¼Œå¯¹è¿™ä¸ªâ€œdata å—â€çš„æ‰€æœ‰ key ç®—ä¸€æ¬¡è¿‡æ»¤æ•°æ®ï¼Œresult_ é•¿åº¦ä¸º aï¼Œ filter_offset_ å°†å˜æˆ [0],
	- case-2ï¼šå¦‚æœç¬¬ä¸€ä¸ªâ€œdata å—â€å¤§å° &amp;amp;gt;ï¼ˆ=ï¼‰4KBä¸”&amp;amp;lt; 8KBï¼Œé‚£ä¹ˆ filter_index = 2ï¼Œå¯¹è¿™ä¸ªâ€œdata å—â€çš„æ‰€æœ‰ key ç®—ä¸€æ¬¡è¿‡æ»¤æ•°æ®ï¼Œresult_ é•¿åº¦ä¸º a&amp;amp;apos;ï¼Œfilter_offset_ å°†å˜æˆ [0, a&amp;amp;apos;]
	- case-3ï¼šå¦‚æœç¬¬ä¸€ä¸ªâ€œdata å—â€å¤§å° &amp;amp;gt;ï¼ˆ=ï¼‰8KBä¸”&amp;amp;lt; 16KBï¼Œé‚£ä¹ˆ filter_index = 3ï¼Œå¯¹è¿™ä¸ªâ€œdata å—â€çš„æ‰€æœ‰ key ç®—ä¸€æ¬¡è¿‡æ»¤æ•°æ®ï¼Œresult_ é•¿åº¦ä¸º a&amp;amp;apos;&amp;amp;apos;ï¼Œfilter_offset_ å°†å˜æˆ [0, a&amp;amp;apos;&amp;amp;apos;, a&amp;amp;apos;&amp;amp;apos;]
- å¦‚æœç¬¬äºŒä¸ªâ€œdata å—â€ä¸º&amp;amp;lt;u&amp;amp;gt;æœ€åä¸€ä¸ª&amp;amp;lt;/u&amp;amp;gt;ï¼Œä¸ç®¡å¤§å°å¤šå°‘ï¼Œåˆ·åˆ°æ•°æ®æ–‡ä»¶åï¼Œå¯¹ç¬¬äºŒä¸ªâ€œdata å—â€çš„æ‰€æœ‰ key ç®—ä¸€æ¬¡è¿‡æ»¤æ•°æ®ï¼Œresult_ é•¿åº¦ä¸º b
	- å¯¹äº case-1ï¼Œfilter_offset_ å…ˆå¡«å……ä¸º [0, a]ï¼Œæœ€åä¼šå¡«å……ä¸º [0, a, b]
	- å¯¹äº case-2ï¼Œfilter_offset_ å…ˆå¡«å……ä¸º [0, a&amp;amp;apos;, a&amp;amp;apos;]ï¼Œæœ€åä¼šå¡«å……ä¸º [0, a&amp;amp;apos;, a&amp;amp;apos;, b]
	- å¯¹äº case-3ï¼Œfilter_offset_ å…ˆå¡«å……ä¸º [0, a&amp;amp;apos;&amp;amp;apos;, a&amp;amp;apos;&amp;amp;apos;, a&amp;amp;apos;&amp;amp;apos;]ï¼Œæœ€åä¼šå¡«å……ä¸º [0, a&amp;amp;apos;&amp;amp;apos;, a&amp;amp;apos;&amp;amp;apos;, a&amp;amp;apos;&amp;amp;apos;, b]
- é‚£ä¹ˆåœ¨è¿‡æ»¤åŒ¹é…æ—¶ï¼Œ
	- å¯¹äºç¬¬ä¸€ä¸ªâ€œdata å—â€ï¼Œå› å…¶ offset ä¸º 0ï¼Œæ‰€ä»¥ filter_offset_ çš„ 0 &amp;amp;amp; 1 ä½ç½®çš„å€¼ä¸ºåŒºé—´ä» result_ ä¸­å»å¯¹åº”çš„è¿‡æ»¤æ•°æ®
	- å¯¹äºç¬¬äºŒä¸ªâ€œdata å—â€ï¼Œ
		- case-1 æ—¶ï¼Œå…¶ offset &amp;amp;lt; 4KBï¼Œä»¥ filter_offset_ çš„ 1 &amp;amp;amp; 2 ä½ç½®çš„å€¼ä¸ºåŒºé—´ä» result_ ä¸­å»å¯¹åº”çš„è¿‡æ»¤æ•°æ®
		- case-2 æ—¶ï¼Œå…¶ offset åœ¨ [4KB, 8KB) åŒºé—´ï¼Œä»¥ filter_offset_ çš„ 2 &amp;amp;amp; 3 ä½ç½®çš„å€¼ä¸ºåŒºé—´ä» result_ ä¸­å»å¯¹åº”çš„è¿‡æ»¤æ•°æ®
		- case-3 æ—¶ï¼Œå…¶ offset åœ¨ [8KB, 16KB) åŒºé—´ï¼Œä»¥ filter_offset_ çš„ 3 &amp;amp;amp; 4 ä½ç½®çš„å€¼ä¸ºåŒºé—´ä» result_ ä¸­å»å¯¹åº”çš„è¿‡æ»¤æ•°æ®
- æ‰€ä»¥ FilterBlockBuilder çš„å¤„ç†é€»è¾‘ä¼šå¯¹ filter_offset_ åšä¸€äº›é¢å¤–çš„å¡«å……ï¼Œç¡®ä¿æ ¹æ®â€œdata å—â€åœ¨æ–‡ä»¶ä¸­çš„åç§»ä½ç½® offsetï¼Œèƒ½å¤Ÿæ­£ç¡®åœ°æ‰¾åˆ°å¯¹åº”çš„ è¿‡æ»¤æ•°æ®å—ã€‚&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å½“ leveldb æ–‡ä»¶çš„æ‰€æœ‰â€œdata å—â€éƒ½å†™å…¥æ–‡ä»¶åï¼Œ&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1ã€å°† &lt;code&gt;filter_offets_&lt;/code&gt; ä¸­çš„åç§»ä½ç½®æ•°æ®é€ä¸ªä»¥ 32 æ¯”ç‰¹å®šé•¿ç¼–ç åæ‹¼æ¥åˆ° &lt;code&gt;result_&lt;/code&gt; åé¢ï¼Œ&lt;/li&gt;
&lt;li&gt;2ã€æ¥ç€å°†â€œè¿˜æœªæ‹¼æ¥åç§»ä½ç½®æ•°æ®æ—¶çš„ &lt;code&gt;result_&lt;/code&gt; é•¿åº¦â€ä»¥ 32 æ¯”ç‰¹å®šé•¿ç¼–ç åæ‹¼æ¥åˆ° &lt;code&gt;result_&lt;/code&gt; åé¢ï¼Œ&lt;/li&gt;
&lt;li&gt;3ã€ç„¶åå°† kFilterBaseLgï¼ˆ=11ï¼‰å‚æ•°æ‹¼æ¥åˆ°åé¢ï¼ˆå ç”¨1ä¸ªå­—èŠ‚ï¼‰ï¼Œ&lt;/li&gt;
&lt;li&gt;4ã€æœ€åå°† &lt;code&gt;result_&lt;/code&gt; ä½œä¸ºâ€œmeta å—â€çš„åŸå§‹æ•°æ®&lt;strong&gt;ä¸ç»å‹ç¼©åœ°&lt;/strong&gt;å†™å…¥æ–‡ä»¶ä¸­ã€‚ï¼ˆ&lt;u&gt;è¿™é‡Œæœ‰ç‚¹ç‰¹æ®Šï¼Œå’Œå…¶ä»–å—ä¸å¤ªä¸€æ ·ï¼Œå…¶ä»–å—éƒ½æ˜¯é”®å€¼å¯¹ç¼–ç å†™å…¥çš„&lt;/u&gt;ï¼‰&lt;/li&gt;&lt;/ul&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/MvG4UNntp7ibmPF.png&apos; title=&apos;ldb-filter-block&apos; alt=&apos;ldb-filter-block&apos; width=&apos;800&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¹¶å°† è¿‡æ»¤ç­–ç•¥ åç§°æ‹¼æ¥ä¸Šå‰ç¼€&lt;code&gt;filter.&lt;/code&gt; ä½œä¸º é”®ï¼Œå°†meta å—ï¼ˆâ€œè¿‡æ»¤æ•°æ®å—â€ï¼‰åœ¨æ–‡ä»¶ä¸­çš„åç§»ä½ç½® offset å’Œå—å¤§å° size ç¼–ç åä½œä¸ºå€¼ï¼Œå†™å…¥ metaindex å—ä¸­ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ‰“å¼€æ•°æ®åº“æ—¶ï¼Œ&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1ã€å…ˆä» â€œFooterâ€ éƒ¨åˆ†è¯»å–â€œmetaindex å—â€çš„åç§»ä½ç½® offset å’Œ å—å¤§å° size&lt;/li&gt;
&lt;li&gt;2ã€ä»â€œmetaindex å—â€ä¸­è§£æå‡ºä½¿ç”¨çš„â€œè¿‡æ»¤ç­–ç•¥â€åç§°ï¼Œä»¥åŠè¿‡æ»¤æ•°æ®ï¼Œåˆå§‹åŒ–è¿‡æ»¤ç­–ç•¥&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Get key æ£€ç´¢æ—¶ï¼Œå¯¹ ldb æ–‡ä»¶çš„â€œdata å—â€è¿›è¡Œæ£€ç´¢æ—¶ï¼Œéƒ½å…ˆæ ¹æ®è¿‡æ»¤ç­–ç•¥åšä¸€ä¸‹è¿‡æ»¤ï¼Œä»è€Œå‡å°‘æ–‡ä»¶çš„ç£ç›˜è¯»å–æ¬¡æ•°ã€‚&lt;/p&gt;</description>
            <pubDate>2024-11-13</pubDate>
            <link>https://blog.xiayf.cn/posts/leveldb-note-2.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/leveldb-note-2.html</guid>
        </item>
        
        <item>
            <title>è¯»ç ï¼šLevelDB - æ¥å£å®šä¹‰ä¸æ•°æ®å†™å…¥</title>
            <description>&lt;h2&gt;0ã€è®¾è®¡æ¦‚è¦&amp;æ¥å£å®šä¹‰&lt;/h2&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/9Gh1agVoq2x6pBU.png&apos; title=&apos;lsm&apos; alt=&apos;lsm&apos; width=&apos;800&apos;/&gt;
&lt;img src=&apos;../plantuml-images/13236969468958455395.svg&apos; title=&apos;13236969468958455395&apos; alt=&apos;13236969468958455395&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åŸºäº DB ç±»çš„é™æ€æ–¹æ³• Open æ¥æ‰“å¼€/åˆå§‹åŒ–ä¸€ä¸ªæ•°æ®åº“ï¼ŒOpen ä¼šå®ä¾‹åŒ–ä¸€ä¸ª DBImpl å¯¹è±¡ï¼Œè°ƒç”¨å…¶ç§æœ‰æ–¹æ³• Recover æ¥æ¢å¤/åˆå§‹åŒ–çŠ¶æ€ï¼Œå¹¶å°† DBImpl å¯¹è±¡æŒ‡é’ˆèµ‹å€¼ç»™ dbptr è¿”å›ç»™è°ƒç”¨æ–¹ï¼Œè°ƒç”¨æ–¹é€šè¿‡ dbptr è°ƒç”¨ Put/Write/Delete/Get/NewIterator è¿›è¡Œè¯»å†™æ“ä½œã€‚&lt;/p&gt;
&lt;h2&gt;1ã€WriteBatch&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Put å’Œ Delete æ˜¯é’ˆå¯¹å•ä¸ª key è¿›è¡Œæ“ä½œï¼Œåœ¨åº•å±‚ä¼šå°†é”®å€¼æ“ä½œåŒ…è£…æˆ WriteBatch å¯¹è±¡ï¼Œç„¶åè°ƒç”¨ Write æ¥å£æ‰§è¡Œå®é™…çš„æ“ä½œæµç¨‹ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¹Ÿå¯ä»¥åœ¨è°ƒç”¨ä¾§å®ä¾‹åŒ– WriteBatch å¯¹è±¡ï¼Œå°†ä¸€æ‰¹å¢åˆ æ“ä½œéƒ½å…ˆå¡«å……åˆ° WriteBatch å¯¹è±¡ï¼Œç„¶åç›´æ¥è°ƒç”¨ Write æ¥å£æ‰§è¡Œä¸€æ‰¹æ“ä½œï¼Œè¿™æ ·å†™åååº”è¯¥ä¼šæ›´é«˜ä¸€ç‚¹ã€‚è¿™æ‰¹æ“ä½œæ˜¯&lt;u&gt;åŸå­çš„&lt;/u&gt;ï¼ˆä¸€èµ·å†™æˆåŠŸæˆ–è€…å¤±è´¥ï¼‰ã€‚&lt;/p&gt;
&lt;img src=&apos;../plantuml-images/4605494190679769299.svg&apos; title=&apos;4605494190679769299&apos; alt=&apos;4605494190679769299&apos;/&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;//
typedef uint64_t SequenceNumber; // è™½ç„¶åºåˆ—å·ä½¿ç”¨äº†çš„ uint64_t ç±»å‹ï¼Œä½†æ˜¯å®é™…åªä¼šä½¿ç”¨ 56 æ¯”ç‰¹ï¼Œå³æœ€å¤§å€¼ä¸º ((0x1ull &amp;amp;lt;&amp;amp;lt; 56) - 1)
// We leave eight bits empty at the bottom so a type and sequence#  
// can be packed together into 64-bits.  
static const SequenceNumber kMaxSequenceNumber = ((0x1ull &amp;amp;lt;&amp;amp;lt; 56) - 1);
//
typedef SkipList&amp;amp;lt;const char*, KeyComparator&amp;amp;gt; Table;&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;rep_ å­˜å‚¨ç»“æ„&lt;/strong&gt;&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;// WriteBatch::rep_ :=  
//    sequence: fixed64  
//    count: fixed32  
//    data: record[count]  
// record :=  
//    kTypeValue varstring varstring         |  
//    kTypeDeletion varstring  
// varstring :=  
//    len: varint32  
//    data: uint8[len]&lt;/code&gt;&lt;/pre&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/nACmfLPxBvcRpyM.png&apos; title=&apos;write-batch&apos; alt=&apos;write-batch&apos; width=&apos;800&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;$SequenceNum$ æ˜¯å½“å‰ WriteBatch æ‰€æœ‰æ“ä½œçš„åŸºå‡†åºåˆ—å·ï¼Œå³ WriteBatch ä¸­ç¬¬ä¸€ä¸ªæ“ä½œçš„åºåˆ—å·ä¸º $SequenceNum + 0$ ï¼Œç¬¬äºŒä¸ªæ“ä½œçš„åºåˆ—å·ä¸º $SequenceNum + 1$ï¼Œä¾æ¬¡ç±»æ¨ã€‚ä¸ºæ¯æ¬¡æ“ä½œåˆ†é…ä¸€ä¸ªå”¯ä¸€çš„åºåˆ—å·ï¼Œæ˜¯ä¸ºäº†æ–¹ä¾¿å®ç°å¿«ç…§èƒ½åŠ›ã€‚åé¢å†è§£é‡Šã€‚&lt;/p&gt;
&lt;h2&gt;2ã€å†™å…¥ç¼“å†²ä¸æ”’æ‰¹&lt;/h2&gt;
&lt;img src=&apos;../plantuml-images/6834044343684626864.svg&apos; title=&apos;6834044343684626864&apos; alt=&apos;6834044343684626864&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;leveldb çš„ write å†™å…¥è¿‡ç¨‹åŸºäº Writer ï¼ˆåŒç«¯ï¼‰é˜Ÿåˆ—å®ç°ç¼“å†²å’Œå¯èƒ½çš„æ”’æ‰¹ï¼ˆåˆå¹¶å¤šä¸ª WriteBatchï¼‰ï¼Œæå‡å†™å…¥çš„ååæ€§èƒ½ã€‚æ”’æ‰¹çš„æ€§èƒ½ç©ºé—´æ¥è‡ª - å¦‚æœå†™å…¥æ—¶å‘ç° level0 æ–‡ä»¶è¿‡å¤šï¼ˆcompaction æœªå®Œæˆï¼Œå½±å“è¯»/æ£€ç´¢æ€§èƒ½ï¼‰ï¼Œåˆ™è®¤ä¸ºéœ€è¦å¯¹å†™å…¥è¿›è¡Œé™é€Ÿï¼Œå°†å†™å…¥å…ˆåœ¨ Write é˜Ÿåˆ—ä¸­ç¼“å†²ï¼Œæ”’ 1ms å·¦å³ï¼Œåˆå¹¶æˆä¸€ä¸ªå¤§çš„ WriteBatch ç„¶åå†™å…¥ memtableã€‚&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/vfKFoAlU7b6hjna.png&apos; title=&apos;write-deque&apos; alt=&apos;write-deque&apos; width=&apos;450&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœæœ¬æ¬¡å†™å…¥çš„ Writer ä¸ºé˜Ÿåˆ—å¤´éƒ¨ï¼Œåˆ™è¯´æ˜å½“å‰å†™å…¥å‹åŠ›åº”è¯¥ä¸å¤§ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œå†™å…¥æ“ä½œ -&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1ã€å…ˆç¡®è®¤å†™å…¥æ¡ä»¶æ˜¯å¦æ»¡è¶³ï¼š
&lt;ul&gt;&lt;li&gt;(1) level0 æ–‡ä»¶æ•°æ˜¯å¦è¶…è¿‡é˜ˆå€¼ï¼ˆ8ï¼‰ï¼Œå¦‚æœè¶…è¿‡ï¼Œè¯´æ˜å†™å…¥å‹åŠ›æœ‰ç‚¹å¤§ï¼ˆéƒ½æ¥ä¸åŠ minor compaction å•¦ï¼‰ï¼Œåˆ™é‡Šæ”¾äº’æ–¥é”ï¼Œå½“å‰çº¿ç¨‹ä¼‘çœ  1msï¼ˆæ”’æ‰¹çš„æ€§èƒ½ç©ºé—´åœ¨è¿™ï¼ï¼‰&lt;/li&gt;
&lt;li&gt;ï¼ˆ2ï¼‰ å¦‚æœå½“å‰ memtable ç©ºé—´å·²æ»¡ï¼ˆé»˜è®¤å¤§å° 4MBï¼Œå¯é…ç½®ï¼‰ï¼Œå¹¶ä¸”å‰ä¸€ä¸ª memtableï¼ˆå½“å‰å·²ä¸å¯å˜ï¼‰è¿˜æ²¡æœ‰è¢« compaction è½ç›˜æˆ–è€… level0 æ–‡ä»¶æ•°æ“ä½œæ›´å¤§çš„ä¸€ä¸ªé˜ˆå€¼ï¼ˆ12ï¼‰ï¼Œåˆ™ç­‰å¾…åå° compaction å®Œæˆ&lt;/li&gt;
&lt;li&gt;ï¼ˆ3ï¼‰ å¦‚æœå½“å‰ memtable ç©ºé—´å·²æ»¡ï¼Œä½†æ˜¯å‰ä¸€ä¸ª memtable å·²è¢« compaction ä¸” level0 æ–‡ä»¶æ•°ä¹Ÿä¸å¤šï¼Œåˆ™å°†å½“å‰ memtable åˆ‡æ¢ä¸ºä¸å¯å˜ memtableï¼Œå¹¶ç”³è¯·ä¸€ä¸ªæ–°çš„ memtableï¼ŒåŒæ—¶æ¸…ç†æ‰å½“å‰çš„ WAL log æ–‡ä»¶ï¼Œå‡†å¤‡ä¸ªæ–°çš„ WAL log æ–‡ä»¶ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;2ã€éå† Writer é˜Ÿåˆ—ï¼Œç›´åˆ°é˜Ÿå°¾æˆ–è€…é‡åˆ°ä¸€ä¸ªéå¼‚æ­¥å†™å…¥æ“ä½œæˆ–è€…è¾¾åˆ°æ”’æ‰¹å¤§å°é˜ˆå€¼ï¼Œå°†éå†åˆ°çš„ Writer ä¸­çš„ WriteBatch åˆå¹¶æˆä¸€ä¸ª WriteBatch&lt;/li&gt;
&lt;li&gt;3ã€å°†åˆå¹¶åçš„ WriteBatch çš„ &lt;code&gt;rep_&lt;/code&gt; å…ˆå†™å…¥ WAL log æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;4ã€ç„¶åå°† WriteBatch ä¸­çš„æ“ä½œæŒ‰åºè§£æå‡ºæ¥ï¼Œå†™å…¥ memtable (Put æˆ– Delete)ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœæœ¬æ¬¡å†™å…¥çš„ Writer éé˜Ÿåˆ—çš„å¤´éƒ¨ï¼Œç­‰å¾…ä¹‹å‰å†™å…¥é˜Ÿåˆ—çš„çº¿ç¨‹æ”’æ‰¹å¤„ç†ï¼Œä»¥åŠæœ€åè¢«å”¤é†’ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœä¸è€ƒè™‘ç­‰å¾… compactionï¼Œæ•´ä¸ªå†™å…¥è¿‡ç¨‹æœ€æ…¢çš„æ­¥éª¤æ˜¯å†™ WAL æ—¥å¿—ï¼Œæ‰€ä»¥ WriteBatch è®¾è®¡æ˜¯ä¸º WAL æ—¥å¿—å†™å…¥ä¼˜åŒ–çš„ï¼Œå¯¹äº memtable å†™å…¥åè€Œå¤šäº†ä¸€ç‚¹è§£æçš„æ€§èƒ½å¼€é”€ã€‚&lt;/p&gt;
&lt;h2&gt;3ã€WAL log æ–‡ä»¶&lt;/h2&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;static const int kBlockSize = 32768;

// Header is checksum (4 bytes), length (2 bytes), type (1 byte).  
static const int kHeaderSize = 4 + 2 + 1;&lt;/code&gt;&lt;/pre&gt;
&lt;img src=&apos;https://s2.loli.net/2025/06/05/dsKGPjVclyAHYOW.png&apos; title=&apos;wal-log-format&apos; alt=&apos;wal-log-format&apos; width=&apos;800&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;leveldb ä¼šå°† WriteBatch çš„ &lt;code&gt;rep_&lt;/code&gt; å½“ä½œå­—èŠ‚åºåˆ—å†™å…¥ log æ–‡ä»¶ä¸­ã€‚ä¸è¿‡ log æ–‡ä»¶å­˜å‚¨çš„å•å…ƒç»“æ„ä¸ºå—ï¼ˆblockï¼‰ï¼Œå—å¤§å°ä¸º 32768 å­—èŠ‚ã€‚ä¸€ä¸ª WriteBatch çš„ &lt;code&gt;rep_&lt;/code&gt; çš„å¤§å°å¯èƒ½å¤§äº/ç­‰äº/å°äºä¸€ä¸ªå—å¤§å°ï¼Œä¹Ÿå°±æ˜¯å†™å…¥ä¸€ä¸ª &lt;code&gt;rep_&lt;/code&gt; å¯èƒ½å¡«ä¸æ»¡ä¸€ä¸ªå—æˆ–è€…æ­£å¥½å¡«æ»¡ä¸€ä¸ªå—æˆ–è€…è·¨å¤šä¸ªå—ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœä¸€æ¬¡å†™å…¥åï¼Œå½“å‰ block å‰©ä½™çš„ç©ºé—´ä¸è¶³ä»¥å¡«å……ä¸‹ä¸€æ¬¡å†™å…¥çš„å¤´éƒ¨ï¼Œåˆ™ç›´æ¥å°†å‰©ä½™ç©ºé—´ä»¥ &lt;code&gt;\x00&lt;/code&gt; å¡«æ»¡ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™æ ·ç¼–ç çš„å¥½å¤„ï¼Ÿ- è¯»å–è§£ææ—¶ï¼ŒæŒ‰å—å¤§å°è¿›è¡Œè¯»å–ï¼Œé€Ÿåº¦æ›´å¿«ï¼Œé¡ºåºè§£æä¹Ÿæ–¹ä¾¿ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;â€œWAL logâ€ çš„æ ¸å¿ƒä½œç”¨ï¼šå†™å…¥ memtable çš„é”®å€¼å¯¹æ•°æ®ï¼Œå¹¶æ²¡æœ‰è½ç›˜åˆ° ldb æ•°æ®åº“æ–‡ä»¶ä¸­ï¼Œå¦‚æœåœ¨ minor compaction æˆ $level_0$ æ–‡ä»¶ä¹‹å‰ï¼Œæœºå™¨èŠ‚ç‚¹æ•…éšœï¼Œå¯¼è‡´ memtable ä»¥åŠä¸å¯å˜ memtable ä¸­çš„æ•°æ®ä¸¢å¤±ï¼Œè¿˜å¯ä»¥é€šè¿‡â€œWAL logâ€ æ–‡ä»¶å†…å®¹æ¥æ¢å¤ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é‚£ä¹Ÿæ„å‘³ç€ï¼Œå¦‚æœä¸€æ—¦ä¸å¯å˜ memtable æ•°æ® compaction åˆ° $level_0$ æ–‡ä»¶åï¼Œè¿™äº›æ•°æ®çŠ¶æ€å¯¹åº”çš„â€œWAL logâ€ å†…å®¹å°±æ²¡æ²¡æœ‰å®é™…ç”¨å¤„äº†ï¼Œå¯ä»¥åŠæ—¶æ¸…ç†æ‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;leveldb å†™å…¥æ•°æ®æ—¶ï¼Œå¦‚æœå‘ç° memtable å ç”¨å†…å­˜å·²è¾¾åˆ°é˜ˆå€¼ï¼Œå¹¶ä¸”ä¸å¯å˜ memtable æ•°æ®å·²è¢« minor compaction æˆ $level_0$ æ–‡ä»¶ï¼Œåˆ™ä¼šå°† memtable åˆ‡æ¢æˆä¸å¯å˜ memtableï¼ŒåŒæ—¶åˆ›å»ºä¸€ä¸ªæ–°çš„â€œWAL logâ€ï¼Œå¹¶ç”³è¯·ä¸€ä¸ªæ–°çš„ memtableã€‚ä¸è¿‡æ­¤æ—¶æ–°çš„ä¸å¯å˜ memtable è¿˜æ²¡è¢« minor compaction æˆ $level_0$ æ–‡ä»¶ï¼Œæ‰€ä»¥å‰ä¸€ä¸ªâ€œWAL logâ€æ–‡ä»¶ä¹Ÿè¿˜è¦ä¿ç•™ï¼Œä¸èƒ½åˆ é™¤ã€‚&lt;/p&gt;
&lt;h2&gt;4ã€MemTable&lt;/h2&gt;
&lt;img src=&apos;../plantuml-images/4348912710508773988.svg&apos; title=&apos;4348912710508773988&apos; alt=&apos;4348912710508773988&apos;/&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;typedef SkipList&amp;amp;lt;const char*, KeyComparator&amp;amp;gt; Table;&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;MemTable æ˜¯å¯¹åº”ä¸€ä¸ªâ€œWAL logâ€ æ–‡ä»¶çš„å†…å­˜å­˜å‚¨ç»“æ„ã€‚&lt;u&gt;å•ä¸ª MemTable å†…å­˜å ç”¨é˜ˆå€¼ä¸º 4MB(&lt;code&gt;write_buffer_size&lt;/code&gt;)&lt;/u&gt;ï¼Œå½“å¯å˜ MemTable çš„å†…å­˜å ç”¨è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±å°è¯•åˆ‡æ¢æˆä¸å¯å˜ MemTableï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„ WAL log æ–‡ä»¶ä»¥åŠå¯¹åº”çš„å¯å˜ MemTable æ¥æ‰¿æ¥å†™å…¥ï¼Œè€Œä¸å¯å˜ MemTable çš„å†…å®¹ç­‰å¾…è¢« minor compaction åˆ·æˆä¸€ä¸ª $level_0$ ldb æ•°æ®æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;// Amount of data to build up in memory (backed by an unsorted log  
// on disk) before converting to a sorted on-disk file.  
//  
// Larger values increase performance, especially during bulk loads.  
// Up to two write buffers may be held in memory at the same time,  
// so you may wish to adjust this parameter to control memory usage.  
// Also, a larger write buffer will result in a longer recovery time  
// the next time the database is opened.  
size_t write_buffer_size = 4 * 1024 * 1024;&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;4.1 Arena&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Arena çš„ç‰¹ç‚¹æ˜¯æ•´å—å†…å­˜ç”³è¯·ï¼Œæ•´å—å†…å­˜ä¸€æ¬¡æ€§é‡Šæ”¾ï¼Œä»è€Œä¼˜åŒ–å†…å­˜çš„ç”³è¯·é‡Šæ”¾å¼€é”€ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;leveldb é‡Œ Arena çš„ç”Ÿå‘½å‘¨æœŸä¸ MemTable å¯¹è±¡ä¿æŒä¸€è‡´ï¼ŒMemTable å¯¹è±¡çš„æ‰€æœ‰ Add æ“ä½œæ¶‰åŠçš„å†…å­˜åˆ†é…éƒ½åœ¨åŒä¸€ Arena å¯¹è±¡ä¸Šè¿›è¡Œï¼Œ MemTable å¯¹è±¡åˆ‡æ¢æˆä¸å¯å˜çŠ¶æ€å¹¶å­˜å‚¨ä¸º level0 ldb æ–‡ä»¶åï¼ŒArena å¯¹è±¡çš„æ‰€æœ‰å†…å­˜å—éšç€ MemTable å¯¹è±¡ææ„è€Œä¸€æ¬¡æ€§é‡Šæ”¾ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;static const int kBlockSize = 4096;&lt;/code&gt;&lt;/pre&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/yZ8lKoRXL3V4cm7.png&apos; title=&apos;memtable-arena&apos; alt=&apos;memtable-arena&apos; width=&apos;800&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä» Arena ç”³è¯·å†…å­˜ç©ºé—´æ—¶ï¼Œå¦‚æœæœ€æ–°ä¸€ä¸ªå¯ç”¨å—çš„å‰©ä½™å†…å­˜å¤§å°ï¼ˆ&lt;code&gt;alloc_bytes_remaining_&lt;/code&gt;ï¼‰å°äºå½“å‰ç”³è¯·çš„å†…å­˜å¤§å° bytesï¼Œåˆ™å…ˆç”³è¯·ä¸€ä¸ªæ–°çš„å†…å­˜å—ï¼Œç„¶åä»æ–°å†…å­˜å—ä¸Šåˆ†é…å†…å­˜ç©ºé—´ - å¦‚æœå½“å‰ç”³è¯·çš„å†…å­˜å¤§å°å¤§äºæ•´å—å¤§å°çš„ 1/4ï¼Œåˆ™å•ç‹¬å ç”¨ä¸€ä¸ªå†…å­˜å—ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ‰€ä»¥ Arena å†…å­˜å—å¤§å°å¿…é¡»å¤§äºå®é™…ä¸€æ¬¡ç”³è¯·çš„æœ€å¤§å†…å­˜ï¼Œå¹¶ä¸”ä¸ºå‡å°‘å†…å­˜ç¢ç‰‡ï¼Œåº”è¯¥è¦æ ¹æ®ä»£ç ä¸­å®é™…çš„å†…å­˜åˆ†é…æƒ…å†µæ¥ç¡®å®š Arena å†…å­˜å—å¤§å°ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;MemTable çš„ Arena å†…å­˜å—å¤§å°åªæœ‰ä¸€ç§ã€‚æœ‰äº›é¡¹ç›®ä¸­å†…å­˜åˆ†é…æƒ…å†µæ¯”è¾ƒå¤æ‚çš„è¯ï¼Œå…¶ Arena è®¾è®¡é€šå¸¸ä¼šä½¿ç”¨å¤šç§å†…å­˜å—å¤§å° ï¼Œä»¥æ­¤æé«˜çµæ´»æ€§ï¼Œå‡å°‘å†…å­˜ç¢ç‰‡æµªè´¹ã€‚&lt;/p&gt;
&lt;h3&gt;4.2 Table - è·³è¡¨&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è·³è¡¨å¯ä»¥å…¼é¡¾æœ‰åºé“¾è¡¨çš„å¿«é€ŸæŸ¥æ‰¾ã€å¿«é€Ÿæ’å…¥/åˆ é™¤ã€éå†ï¼Œç®—æ³•å¤æ‚åº¦ $O(logN)$ï¼Œå®ç°ç®€å•ã€‚&lt;/p&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;&lt;a href=&apos;https://opendatastructures.org/newhtml/ods/latex-saved-html/skiplists.html&apos;&gt;Open Data Structures - Skiplists&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;æŸ¥æ‰¾è¿‡ç¨‹ç¤ºæ„å›¾&lt;/strong&gt;&lt;/p&gt;
&lt;img src=&apos;../assets/leveldb/skiplist-searchpath.svg&apos; title=&apos;skiplist-search-path&apos; alt=&apos;skiplist-search-path&apos; width=&apos;800&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;æ’å…¥è¿‡ç¨‹ç¤ºæ„å›¾&lt;/strong&gt;&lt;/p&gt;
&lt;img src=&apos;../assets/leveldb/skiplist-add.svg&apos; title=&apos;skiplist-add&apos; alt=&apos;skiplist-add&apos; width=&apos;800&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;è·³è¡¨å®šä¹‰&lt;/strong&gt;&lt;/p&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;template &amp;amp;lt;typename Key, class Comparator&amp;amp;gt;  
class SkipList {
public:
  explicit SkipList(Comparator cmp, Arena* arena);
  void Insert(const Key&amp;amp;amp; key);
  bool Contains(const Key&amp;amp;amp; key) const;
private:
  Comparator const compare_;  
  Arena* const arena_;  // Arena used for allocations of nodes  
  Node* const head_;
  // Modified only by Insert().  Read racily by readers, but stale  
  // values are ok.  
  std::atomic&amp;amp;lt;int&amp;amp;gt; max_height_;  // Height of the entire list  
  // Read/written only by Insert().  
  Random rnd_;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;è·³è¡¨èŠ‚ç‚¹å®šä¹‰&lt;/strong&gt;&lt;/p&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;template &amp;amp;lt;typename Key, class Comparator&amp;amp;gt;  
struct SkipList&amp;amp;lt;Key, Comparator&amp;amp;gt;::Node {
  explicit Node(const Key&amp;amp;amp; k) : key(k) {}
  Key const key;

private:
  // Array of length equal to the node height.  next_[0] is lowest level link.
  std::atomic&amp;amp;lt;Node*&amp;amp;gt; next_[1];
}&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;&lt;li&gt;&lt;code&gt;key&lt;/code&gt; å­˜å‚¨èŠ‚ç‚¹å®é™…çš„å€¼&lt;/li&gt;
&lt;li&gt;&lt;code&gt;next_&lt;/code&gt; æ•°ç»„ä¸­æ¯ä¸ªæŒ‡é’ˆæŒ‡å‘æ¨ªå‘çš„é‚»å±…èŠ‚ç‚¹&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;memtable å¯¹è·³è¡¨æ¨¡æ¿å®é™…ä½¿ç”¨çš„å®é™…ç±»å‹ä¸ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;typedef SkipList&amp;amp;lt;const char*, KeyComparator&amp;amp;gt; Table;&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹ Key - &lt;code&gt;char*&lt;/code&gt; çš„å®é™…ç¼–ç æ–¹å¼ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;class MemTableInserter : public WriteBatch::Handler {  
 public:  
  SequenceNumber sequence_;  
  MemTable* mem_;  
  
  void Put(const Slice&amp;amp;amp; key, const Slice&amp;amp;amp; value) override {  
    mem_-&amp;amp;gt;Add(sequence_, kTypeValue, key, value);  // æ’å…¥
    sequence_++;  
  }  
  void Delete(const Slice&amp;amp;amp; key) override {  
    mem_-&amp;amp;gt;Add(sequence_, kTypeDeletion, key, Slice());  // åˆ é™¤
    sequence_++;  
  }  
};

void MemTable::Add(SequenceNumber s, ValueType type, const Slice&amp;amp;amp; key,  
                   const Slice&amp;amp;amp; value) {  
  // Format of an entry is concatenation of:  
  //  key_size     : varint32 of internal_key.size()
  //  key bytes    : char[internal_key.size()]
  //  tag          : uint64((sequence &amp;amp;lt;&amp;amp;lt; 8) | type)
  //  value_size   : varint32 of value.size()
  //  value bytes  : char[value.size()]
  size_t key_size = key.size();  
  size_t val_size = value.size();  
  size_t internal_key_size = key_size + 8;  // å¦å¤–8å­—èŠ‚å­˜å‚¨ Tag
  const size_t encoded_len = VarintLength(internal_key_size) +  
                             internal_key_size + VarintLength(val_size) +  
                             val_size;  
  char* buf = arena_.Allocate(encoded_len);  
  char* p = EncodeVarint32(buf, internal_key_size);  
  std::memcpy(p, key.data(), key_size);  
  p += key_size;  
  EncodeFixed64(p, (s &amp;amp;lt;&amp;amp;lt; 8) | type);  
  p += 8;  
  p = EncodeVarint32(p, val_size);  
  std::memcpy(p, value.data(), val_size);  
  assert(p + val_size == buf + encoded_len);  
  table_.Insert(buf);  
}&lt;/code&gt;&lt;/pre&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/HMisDYbkf6eUdCV.png&apos; title=&apos;skiplist-node-key&apos; alt=&apos;skiplist-node-key&apos; width=&apos;800&apos;/&gt;
&lt;ul&gt;&lt;li&gt;æ•´æ•°å˜é•¿ç¼–ç ï¼šâ€œkey é•¿åº¦â€ å’Œ â€œvalue é•¿åº¦â€æ­£å¸¸æ˜¯32bitï¼ˆ4å­—èŠ‚ï¼‰æ•´æ•°ï¼Œä½† key å’Œ value å®é™…å¯èƒ½æ˜¯æ¯”è¾ƒçŸ­çš„å­—èŠ‚åºåˆ—ï¼ˆæ¯”å¦‚ï¼šé•¿åº¦å°äº128æ—¶ï¼Œåªè¦1ä¸ªå­—èŠ‚å°±èƒ½å­˜å‚¨é•¿åº¦ï¼Œè€Œä¸æ˜¯4å­—èŠ‚ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;åºåˆ—å·ä»…ä½¿ç”¨å°¾éƒ¨7ä¸ªå­—èŠ‚ï¼šåºåˆ—å·å¤§å°ä¸ä¼šè¶…è¿‡7ä¸ªå­—èŠ‚ï¼Ÿç¡®è®¤ä¸€ä¸‹å“ªé‡Œæœ‰çº¦æŸ&lt;/li&gt;
&lt;li&gt;æ“ä½œ/å€¼ç±»å‹ï¼š
&lt;ul&gt;&lt;li&gt;&lt;code&gt;kTypeValue = 0x1&lt;/code&gt; è¡¨ç¤ºå½“å‰æ“ä½œä¸º æ’å…¥ï¼Œæœ‰å¯¹åº”çš„å€¼&lt;/li&gt;
&lt;li&gt;&lt;code&gt;kTypeDeletion = 0x0&lt;/code&gt; è¡¨ç¤ºå½“å‰æ“ä½œä¸º åˆ é™¤ï¼Œæ— å¯¹åº”çš„å€¼ï¼ˆæˆ–è€…è¯´å€¼ä¸ºç©ºï¼‰ã€‚&lt;u&gt;æ­£å¸¸æ¥è¯´ï¼Œåé¢æ— éœ€å†ç¼–ç â€œvalue é•¿åº¦â€ å’Œ â€œvalue å€¼â€ï¼Œä¸è¿‡ä»£ç å®ç°ä¸­ä¼¼ä¹è¿˜æ˜¯å ç”¨äº†1ä¸ªå­—èŠ‚æ¥å­˜å‚¨â€œvalue é•¿åº¦â€ 0ï¼Œå¯ä»¥ä¼˜åŒ–ï¼Ÿ&lt;/u&gt;ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;KeyComparator&lt;/code&gt; çš„å®šä¹‰ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;struct KeyComparator {  
  const InternalKeyComparator comparator;  
  explicit KeyComparator(const InternalKeyComparator&amp;amp;amp; c) : comparator(c) {}  
  int operator()(const char* a, const char* b) const;  //
};

int MemTable::KeyComparator::operator()(const char* aptr,  
                                        const char* bptr) const {  
  // Internal keys are encoded as length-prefixed strings.  
  Slice a = GetLengthPrefixedSlice(aptr);  // å–å‡º internal keyï¼ˆåŒ…å« tagï¼‰
  Slice b = GetLengthPrefixedSlice(bptr);  
  return comparator.Compare(a, b);  
}

class InternalKeyComparator : public Comparator {  
 private:  
  const Comparator* user_comparator_; // ç”¨æˆ·å¯é…ç½®è‡ªå®šä¹‰çš„ key æ¯”è¾ƒå™¨ï¼Œé»˜è®¤ä¸º BytewiseComparator - é€ä¸ªå­—èŠ‚æ¯”è¾ƒ
  
 public:  
  explicit InternalKeyComparator(const Comparator* c) : user_comparator_(c) {}  
  const char* Name() const override;  
  int Compare(const Slice&amp;amp;amp; a, const Slice&amp;amp;amp; b) const override;  
  void FindShortestSeparator(std::string* start,  
                             const Slice&amp;amp;amp; limit) const override;  
  void FindShortSuccessor(std::string* key) const override;  
  
  const Comparator* user_comparator() const { return user_comparator_; }  
  
  int Compare(const InternalKey&amp;amp;amp; a, const InternalKey&amp;amp;amp; b) const;  
};

int InternalKeyComparator::Compare(const Slice&amp;amp;amp; akey, const Slice&amp;amp;amp; bkey) const {  
  // Order by:  
  //    increasing user key (according to user-supplied comparator)
  //    decreasing sequence number
  //    decreasing type (though sequence# should be enough to disambiguate)
  int r = user_comparator_-&amp;amp;gt;Compare(ExtractUserKey(akey), ExtractUserKey(bkey));  // ExtractUserKey ä¼šå¿½ç•¥ Tagï¼Œæ¯”è¾ƒåŸå§‹ key
  if (r == 0) {  
    const uint64_t anum = DecodeFixed64(akey.data() + akey.size() - 8);  // å–å‡º Tag
    const uint64_t bnum = DecodeFixed64(bkey.data() + bkey.size() - 8);  // å–å‡º Tag
    if (anum &amp;amp;gt; bnum) {  // æ¯”è¾ƒ Tagï¼ˆåºåˆ—å· + æ“ä½œç±»å‹ï¼‰
      r = -1;  
    } else if (anum &amp;amp;lt; bnum) {  
      r = +1;  
    }  
  }  
  return r;  
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å®é™…çš„æ¯”è¾ƒé€»è¾‘ä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1ã€å…ˆæ¯”è¾ƒåŸå§‹çš„ keyï¼Œå°çš„æ’åœ¨å‰é¢&lt;/li&gt;
&lt;li&gt;2ã€å¦‚æœåŸå§‹ key ç›¸ç­‰ï¼Œåˆ™æ¯”è¾ƒåºåˆ—å·ï¼Œ&lt;u&gt;åºåˆ—å·å¤§çš„æ’åœ¨å‰é¢ï¼ˆ&lt;strong&gt;æœ‰ç‚¹å¥‡æ€ªï¼Ÿè¿™ä¸ªé€»è¾‘å¾ˆå…³é”®ï¼ç‚¹æŸ¥/æœ‰åºéå†/compaction åŒ key è®°å½•å»é‡ç­‰ä¾èµ–è¿™ä¸ªé€»è¾‘&lt;/strong&gt;ï¼‰&lt;/u&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;4.3 å¼•ç”¨è®¡æ•°&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;MemTable ä½¿ç”¨çš„ å¼•ç”¨è®¡æ•° å˜é‡ &lt;code&gt;int refs_&lt;/code&gt;ï¼Œä¸æ˜¯åŸå­å˜é‡ï¼Œæ‰€ä»¥è®¡æ•°å¢å‡éƒ½éœ€è¦åŠ äº’æ–¥é”ã€‚å¹¶ä¸”å› ä¸ºè®¡æ•°å‡åˆ°å°äºç­‰äº0æ—¶ï¼Œ memtable è¿˜éœ€è¦ææ„è‡ªå·±ï¼Œæ‰€ä»¥å¿…é¡»åŠ é”ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code&gt;// Drop reference count.  Delete if no more references exist.  
void Unref() {  
  --refs_;  
  assert(refs_ &amp;amp;gt;= 0);  
  if (refs_ &amp;amp;lt;= 0) {  
    delete this;  
  }  
}&lt;/code&gt;&lt;/pre&gt;</description>
            <pubDate>2024-11-10</pubDate>
            <link>https://blog.xiayf.cn/posts/leveldb-note-1.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/leveldb-note-1.html</guid>
        </item>
        
        <item>
            <title>å›¢é˜Ÿå¼€å‘æµç¨‹è§„èŒƒ</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;&lt;em&gt;æœ¬æ–‡åŸæ˜¯é’ˆå¯¹å®é™…å·¥ä½œä¸­å›¢é˜Ÿçš„æƒ…å†µç¼–å†™çš„ä¸€ä»½æµç¨‹è§„èŒƒè¯´æ˜ï¼Œéšå»æ•æ„Ÿä¿¡æ¯ä¹‹åå­˜æ”¾äºæ­¤ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2023/04/05/wQ9bOaXyNiCjh5H.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;100%&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¼€å‘æµç¨‹è§„èŒƒ æ˜¯ä¸€ç§å›¢é˜Ÿæ–‡åŒ–ï¼Œä¹Ÿæ˜¯æœåŠ¡å’Œä¸šåŠ¡ç¨³å®šæ€§çš„åŸºæœ¬ä¿éšœçº¿ã€‚&lt;/p&gt;
&lt;h2&gt;ä¸€ã€æ–‡æ¡£&lt;/h2&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;å…±è¯†ï¼šâ€œè°‹å®šè€ŒååŠ¨â€&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å›¢é˜Ÿçš„å¼€å‘å·¥ä½œä¸»è¦æ¥è‡ª3ä¸ªæ–¹é¢ï¼šå·¥ç¨‹ä¼˜åŒ–ï¼ˆå¹³å“ä¼˜åŒ–ã€æ€§èƒ½ä¼˜åŒ–ã€ç¨³å®šæ€§/å¯ç”¨æ€§ä¼˜åŒ–ç­‰ï¼‰ã€ç®—æ³•ä¸šåŠ¡éœ€æ±‚ã€äº§å“ä¸šåŠ¡éœ€æ±‚ã€‚&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰æ¯ä¸€é¡¹å¼€å‘å·¥ä½œå®é™…ç¼–ç ä¹‹å‰ï¼Œéƒ½éœ€è¦æ¢³ç†ä¸€ä»½æ–‡æ¡£ï¼Œæ”¾åœ¨ å¼€å‘æ–‡æ¡£ ç›®å½•ä¸‹&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰æ–‡æ¡£å‘½åè§„åˆ™å¦‚ç¤ºä¾‹ â€œw1-20220721-xxxéœ€æ±‚â€ã€â€œw1-20220721-xxxä¼˜åŒ–â€ï¼Œâ€œw1â€ æ˜¯æ–‡æ¡£çš„æŒ‰åºç¼–å·ã€‚&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰æ¯ä¸€é¡¹å·¥ä½œï¼Œä¸Šçº¿/æ¨å…¨åï¼Œéƒ¨ç½²ç›¸å…³ä¿¡æ¯ã€å·¥ç¨‹æŒ‡æ ‡å˜åŒ–ã€ä¸šåŠ¡æŒ‡æ ‡å˜åŒ–ã€èµ„æºæˆæœ¬å˜åŒ–ã€é—ç•™å¾…ä¼˜åŒ–çš„éå…³é”®é—®é¢˜ç­‰ç›¸å…³ä¿¡æ¯ä¹Ÿåº”è¡¥å……åˆ°æ–‡æ¡£ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰å¦‚æœèµ°å®éªŒæµç¨‹ï¼Œä¹Ÿåœ¨åœ¨æ–‡æ¡£ä¸­åŠ ä¸Šâ€œå®éªŒæ¨è¿›æ¿å—â€ï¼Œè®°å½•å®éªŒæ¨è¿›æƒ…å†µï¼Œé‡åˆ°çš„é—®é¢˜ç­‰ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå¤šåœºæ™¯å®éªŒæ¨è¿›çš„æƒ…å†µã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;1.1 å·¥ç¨‹ä¼˜åŒ– æ–‡æ¡£&lt;/h3&gt;
&lt;ul&gt;&lt;li&gt;èƒŒæ™¯/ç°çŠ¶æè¿°/é—®é¢˜åˆ†æ&lt;/li&gt;
&lt;li&gt;ä¼˜åŒ–æ–¹æ¡ˆ/è®¾è®¡æ–¹æ¡ˆ&lt;/li&gt;
&lt;li&gt;é¢„æœŸæ”¶ç›Š&lt;/li&gt;
&lt;li&gt;åˆ†å·¥æ’æœŸ&lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;1.2 ç®—æ³•ä¸šåŠ¡éœ€æ±‚æ–‡æ¡£&lt;/h3&gt;
&lt;ul&gt;&lt;li&gt;æ˜ç¡®ç®—æ³•è´Ÿè´£äººï¼Œé“¾æ¥ä¸Šç®—æ³•ä¾§ç›¸å…³æ–‡æ¡£ï¼ˆè¦æ±‚ç®—æ³•åŒå­¦æä¾›ï¼‰ - æ–‡æ¡£ä¸­åŒ…å« èƒŒæ™¯ã€é¢„æœŸæ”¶ç›Šã€ç®—æ³•é€»è¾‘/æ¨¡å‹ç­‰è¦ç‚¹ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;æ˜ç¡®å·¥ç¨‹æ–¹æ¡ˆï¼Œå¯¹äºå¤æ‚çš„ç®—æ³•ä¸šåŠ¡éœ€æ±‚ï¼Œåº”è¯¥ç»™å‡ºè®¾è®¡æ¦‚è¦&lt;/li&gt;
&lt;li&gt;é¢„ä¼°èµ„æºæˆæœ¬&lt;/li&gt;
&lt;li&gt;æ˜ç¡®é¡¹ç›®ä¼˜å…ˆçº§ å’Œ æ’æœŸ / Deadline&lt;/li&gt;
&lt;li&gt;å¯¹äºé«˜ä¼˜ç´§æ€¥éœ€æ±‚ï¼Œå°½å¯èƒ½é¢„å…ˆæ˜ç¡®è¿›åº¦é£é™©ç‚¹&lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;1.3 äº§å“ä¸šåŠ¡éœ€æ±‚æ–‡æ¡£&lt;/h3&gt;
&lt;ul&gt;&lt;li&gt;æ˜ç¡®äº§å“è´Ÿè´£äººï¼Œé“¾æ¥ä¸Šäº§å“ä¾§ç›¸å…³æ–‡æ¡£ï¼ˆè¦æ±‚äº§å“åŒå­¦æä¾›ï¼‰ - æ–‡æ¡£ä¸­åŒ…å« èƒŒæ™¯ã€é¢„æœŸæ”¶ç›Šã€äº§å“è§„åˆ™ç­‰è¦ç‚¹ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;æ˜ç¡®å·¥ç¨‹æ–¹æ¡ˆï¼Œå¯¹äºå¤æ‚çš„äº§å“ä¸šåŠ¡éœ€æ±‚ï¼Œåº”è¯¥ç»™å‡ºè®¾è®¡æ¦‚è¦&lt;/li&gt;
&lt;li&gt;é¢„ä¼°èµ„æºæˆæœ¬&lt;/li&gt;
&lt;li&gt;æ˜ç¡®é¡¹ç›®ä¼˜å…ˆçº§ å’Œ æ’æœŸ / Deadline&lt;/li&gt;
&lt;li&gt;å¯¹äºé«˜ä¼˜ç´§æ€¥éœ€æ±‚ï¼Œå°½å¯èƒ½é¢„å…ˆæ˜ç¡®è¿›åº¦é£é™©ç‚¹&lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;1.4 æ‰€æœ‰æ–‡æ¡£&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ï¼ˆå¼ºåˆ¶ï¼‰å¿…é¡»åŒ…å«ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;æµ‹è¯•ç”¨ä¾‹è®¾è®¡å’Œå…¨é¢å®Œæ•´çš„æµ‹è¯•æŠ¥å‘Š/diff æŠ¥å‘Š&lt;/li&gt;
&lt;li&gt;åŒ…å«å¯¹åº”å„ä¸ªä»£ç åº“å˜æ›´çš„ MR é“¾æ¥ã€å‘å¸ƒç‰ˆæœ¬çš„ tag é“¾æ¥&lt;/li&gt;&lt;/ul&gt;
&lt;h2&gt;äºŒã€ç¼–ç &lt;/h2&gt;
&lt;h3&gt;2.1 ç»Ÿä¸€ä»£ç è§„èŒƒ&lt;/h3&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;å…±è¯†ï¼šæ–°ä»£ç ç»Ÿä¸€æ–°é£æ ¼ï¼Œè€ä»£ç é£æ ¼ç»´æŒä¸å˜ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;h4&gt;2.1.1 C++&lt;/h4&gt;
&lt;ul&gt;&lt;li&gt;&lt;a href=&apos;https://google.github.io/styleguide/cppguide.html&apos;&gt;Google C++ Style Guide&lt;/a&gt;ã€&lt;a href=&apos;https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/contents/&apos;&gt;Google C++ é£æ ¼æŒ‡å—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä»£ç è§„èŒƒ/é£æ ¼æ£€æŸ¥å·¥å…·ï¼š&lt;a href=&apos;https://github.com/cpplint/cpplint&apos;&gt;cpplint&lt;/a&gt;
&lt;ul&gt;&lt;li&gt;Google å®˜æ–¹æä¾›çš„å·¥å…·ï¼Œç”¨äºæ£€æµ‹ C++ ä»£ç æ˜¯å¦ç¬¦åˆ Google C++ Style Guide&lt;/li&gt;
&lt;li&gt;VS Code æ’ä»¶ï¼š&lt;a href=&apos;https://marketplace.visualstudio.com/items?itemName=mine.cpplint&apos;&gt;cpplint - Visual Studio Marketplace&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Vim æ’ä»¶ï¼š&lt;a href=&apos;https://github.com/vim-syntastic/syntastic&apos;&gt;vim-syntastic/syntastic: Syntax checking hacks for vim (github.com)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Clion æ’ä»¶ï¼š&lt;a href=&apos;https://plugins.jetbrains.com/plugin/7871-clion-cpplint&apos;&gt;CLion-cpplint - CLion Plugin | Marketplace (jetbrains.com)&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;ä»£ç æ ¼å¼åŒ–å·¥å…·ï¼š&lt;a href=&apos;https://clang.llvm.org/docs/ClangFormat.html&apos;&gt;clang-format&lt;/a&gt;
&lt;ul&gt;&lt;li&gt;é¡¹ç›®æ ¹ç›®å½•ä¸‹æ”¾ç½® .clang-format æ–‡ä»¶ï¼Œç¼–è¾‘å™¨/IDE é…ç½®æˆç¼–ç æ—¶è‡ªåŠ¨æ ¼å¼åŒ–æˆ–è€…ä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ–ï¼š&lt;/li&gt;
&lt;li&gt;VS Code æ’ä»¶ï¼š&lt;a href=&apos;https://marketplace.visualstudio.com/items?itemName=xaver.clang-format&apos;&gt;Clang-Format - Visual Studio Marketplace&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Vim é›†æˆï¼š&lt;a href=&apos;https://clang.llvm.org/docs/ClangFormat.html#vim-integration&apos;&gt;https://clang.llvm.org/docs/ClangFormat.html#vim-integration&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Clion é›†æˆï¼š&lt;a href=&apos;https://clang.llvm.org/docs/ClangFormat.html#clion-integration&apos;&gt;https://clang.llvm.org/docs/ClangFormat.html#clion-integration &lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;---
BasedOnStyle: Google
---
Language: Cpp
IndentWidth: 4
ColumnLimit: 120
DerivePointerAlignment: false
PointerAlignment: Left
SortIncludes: CaseSensitive
Standard: Auto
AccessModifierOffset: -4
SpacesBeforeTrailingComments: 2
AllowShortBlocksOnASingleLine: Never
AllowShortIfStatementsOnASingleLine: Never
AllowShortLoopsOnASingleLine: false
AllowShortFunctionsOnASingleLine: Empty
AlignTrailingComments: true
BinPackParameters: false
AllowAllParametersOfDeclarationOnNextLine: false&lt;/code&gt;&lt;/pre&gt;
&lt;h4&gt;2.1.2 Java&lt;/h4&gt;
&lt;ul&gt;&lt;li&gt;&lt;a href=&apos;https://google.github.io/styleguide/javaguide.html&apos;&gt;Google Java Style Guide&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&apos;https://www.jetbrains.com/idea/&apos;&gt;IDE - Jetbrains IDEA&lt;/a&gt;
&lt;ul&gt;&lt;li&gt;ä¸‹è½½ä»£ç é£æ ¼å®šä¹‰æ–‡ä»¶ï¼š&lt;a href=&apos;https://raw.githubusercontent.com/google/styleguide/gh-pages/intellij-java-google-style.xml&apos;&gt;intellij-java-google-style.xml&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å¯¼å…¥ IDEA&lt;/li&gt;
&lt;li&gt;å®‰è£… Save Actions æ’ä»¶&lt;/li&gt;
&lt;li&gt;é…ç½® Save Actions æ’ä»¶&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;h4&gt;2.1.3 Python&lt;/h4&gt;
&lt;ul&gt;&lt;li&gt;Python 3 + &lt;a href=&apos;https://docs.python.org/3/library/venv.html&apos;&gt;venv è™šæ‹Ÿç¯å¢ƒ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&apos;https://google.github.io/styleguide/pyguide.html&apos;&gt;Google Python Style Guide&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä»£ç è§„èŒƒ/é£æ ¼æ£€æŸ¥å·¥å…·ï¼š&lt;a href=&apos;https://pylint.pycqa.org/en/latest/&apos;&gt;pylint&lt;/a&gt;ã€&lt;a href=&apos;https://google.github.io/styleguide/pyguide.html#21-lint&apos;&gt;https://google.github.io/styleguide/pyguide.html#21-lint&lt;/a&gt;
&lt;ul&gt;&lt;li&gt;Vim é›†æˆï¼š&lt;a href=&apos;https://github.com/vim-syntastic/syntastic&apos;&gt;vim-syntastic/syntastic: Syntax checking hacks for vim (github.com)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;VS Code é›†æˆï¼š&lt;a href=&apos;https://code.visualstudio.com/docs/python/linting#_pylint&apos;&gt;Linting Python in Visual Studio Code&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;PyCharm æ’ä»¶ï¼š&lt;a href=&apos;https://plugins.jetbrains.com/plugin/11084-pylint&apos;&gt;Pylint - IntelliJ IDEA &amp; PyCharm Plugin | Marketplace (jetbrains.com)&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;ä»£ç æ ¼å¼åŒ–å·¥å…·ï¼š&lt;a href=&apos;https://github.com/google/yapf/&apos;&gt;yapf&lt;/a&gt;
&lt;ul&gt;&lt;li&gt;Vim é›†æˆï¼š&lt;a href=&apos;https://github.com/google/yapf/tree/main/plugins#vim&apos;&gt;https://github.com/google/yapf/tree/main/plugins#vim&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;VS Code é›†æˆï¼š&lt;a href=&apos;https://code.visualstudio.com/docs/python/editing#_formatting&apos;&gt;Editing Python Code in Visual Studio Code&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;PyCharm é›†æˆï¼š&lt;a href=&apos;https://github.com/google/yapf/issues/631&apos;&gt;How do I install yapf in pycharm Â· Issue #631 Â· google/yapf (github.com)&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;2.2 ä»£ç åˆ†æ”¯ç®¡ç†&lt;/h3&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;å…±è¯†ï¼šä¸€ä¸ªä»£ç åº“ä¸€ä¸ªä¸»åˆ†æ”¯ï¼›æ‰€æœ‰å¼€å‘åˆ†æ”¯åœ¨æµ‹è¯•/å®éªŒéªŒè¯ä¹‹åéƒ½éœ€è¦åˆå…¥ä¸»åˆ†æ”¯&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ï¼ˆå¼ºåˆ¶ï¼‰åŸºæœ¬çš„ git å·¥ä½œæµï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;æ¯é¡¹å¼€å‘å·¥ä½œï¼Œéƒ½ä»ä¸»åˆ†æ”¯ç­¾å‡ºä¸€ä¸ªï¼ˆå…¬å…±ï¼‰å¼€å‘åˆ†æ”¯&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯å¤šäººåä½œçš„å¼€å‘å·¥ä½œï¼Œåˆ™åŸºäºæ–°ç­¾å‡ºçš„å…¬å…±å¼€å‘åˆ†æ”¯ï¼Œæ¯ä¸ªäººå„è‡ªç­¾å‡ºä¸ªäººçš„å¼€å‘åˆ†æ”¯ï¼Œè¿›è¡Œç‹¬ç«‹å¼€å‘&lt;/li&gt;
&lt;li&gt;ä¸ªäººå¼€å‘è‡ªæµ‹å®Œæˆåï¼Œåˆå…¥å…¬å…±å¼€å‘åˆ†æ”¯ï¼Œè¿›è¡Œé›†æˆæµ‹è¯•è”è°ƒ&lt;/li&gt;
&lt;li&gt;å¦‚æœèµ°å®éªŒæµç¨‹ï¼Œåˆ™ä½¿ç”¨ï¼ˆå…¬å…±ï¼‰å¼€å‘åˆ†æ”¯çš„ sandbox é•œåƒéƒ¨ç½²å®éªŒé›†ç¾¤&lt;/li&gt;
&lt;li&gt;å®éªŒæ¨å…¨åè½¬ä¸‹çº¿åï¼Œï¼ˆå…¬å…±ï¼‰å¼€å‘åˆ†æ”¯åˆå…¥ä¸»åˆ†æ”¯ï¼Œå¹¶åŸºäºä¸»åˆ†æ”¯ä¸Šçš„æ­£å¼ tag é•œåƒå‘å¸ƒåŸºå‡†é›†ç¾¤&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ï¼ˆå»ºè®®ï¼‰åˆ†æ”¯å‘½åè§„èŒƒï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ï¼ˆå…¬å…±ï¼‰å¼€å‘åˆ†æ”¯ï¼š
&lt;ul&gt;&lt;li&gt;å¸¸è§„éœ€æ±‚å¼€å‘åˆ†æ”¯ï¼šfeature/[ç›®æ ‡æœåŠ¡å]-[æ–‡æ¡£ ID]&lt;/li&gt;
&lt;li&gt;ç´§æ€¥éœ€æ±‚å¼€å‘åˆ†æ”¯ï¼šurgent/[ç›®æ ‡æœåŠ¡å]-[æ–‡æ¡£ ID]&lt;/li&gt;
&lt;li&gt;ç´§æ€¥ä¿®å¤å¼€å‘åˆ†æ”¯ï¼šhotfix/[ç›®æ ‡æœåŠ¡å]-[æ–‡æ¡£ ID]&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;ä¸ªäººå¼€å‘åˆ†æ”¯ï¼šåœ¨ï¼ˆå…¬å…±ï¼‰å¼€å‘åˆ†æ”¯åå¸¦ä¸Šä¸ªäºº IDï¼Œç¤ºä¾‹ï¼šfeature/[ç›®æ ‡æœåŠ¡å]-[æ–‡æ¡£ ID]-[ä¸ªäºº ID]&lt;/li&gt;
&lt;li&gt;å¯¹ç´§æ€¥éœ€æ±‚å’Œç´§æ€¥ä¿®å¤å¼€å‘åˆ†æ”¯ï¼Œå¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ªæ–‡æ¡£ï¼Œæ‹¿åˆ°æ–‡æ¡£ IDï¼Œå†…å®¹å¯èƒ½æ¥ä¸åŠå†™å¾—éå¸¸å®Œå–„ï¼Œä½†ä¹‹ååº”è¯¥è¿›è¡Œè¡¥å……å®Œå–„&lt;/li&gt;
&lt;li&gt;ä¸ç¬¦åˆè§„èŒƒçš„å¼€å‘åˆ†æ”¯ï¼Œä¸èƒ½æ¨é€åˆ°è¿œç¨‹ä»£ç åº“ï¼ˆä¸èƒ½å¯¹å›¢é˜Ÿå…¶ä»–äººå¯è§ï¼‰ï¼Œé€šè¿‡ git hook æ¥å¼ºè¡Œé™åˆ¶&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ï¼ˆå»ºè®®ï¼‰æ‰€æœ‰ï¼ˆå…¬å…±ï¼‰å¼€å‘åˆ†æ”¯ã€ï¼ˆéœ€è¦ä»£ç è¯„å®¡çš„ï¼‰ä¸ªäººå¼€å‘åˆ†æ”¯ï¼Œéƒ½åº”è¯¥åˆ›å»ºå¯¹åº”çš„ MRï¼Œé‚€è¯·å…¶ä»–äººè¿›è¡Œä»£ç è¯„å®¡æ—¶ï¼Œæä¾›å¯¹åº”çš„ MR&lt;/p&gt;
&lt;h3&gt;2.3 Commit è§„èŒƒ&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;a href=&apos;https://www.conventionalcommits.org/zh-hans/v1.0.0/&apos;&gt;çº¦å®šå¼æäº¤ (conventionalcommits.org)&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ï¼ˆå»ºè®®ï¼‰å‚è€ƒ Apache é¡¶çº§é¡¹ç›®çš„å®è·µï¼ˆå¦‚ apache/arrowï¼‰ï¼Œcommit log çš„â€œæè¿°â€éƒ¨åˆ†å…ˆå¸¦ä¸Šæ–‡æ¡£é“¾æ¥ã€‚&lt;/p&gt;
&lt;h3&gt;2.4 MR ä¸ä»£ç è¯„å®¡&lt;/h3&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;å…±è¯†ï¼šè´¨é‡æŠŠå…³ã€ç»éªŒä¼ æ‰¿&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä»å›¢é˜Ÿå’Œé•¿è¿œæ¥çœ‹ï¼ŒCode Review çš„é‡è¦æ€§å†æ€ä¹ˆå¼ºè°ƒéƒ½ä¸ä¸ºè¿‡ã€‚&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰æ¯ä¸ªå¼€å‘åˆ†æ”¯çš„å·¥ä½œåœ¨å¼€å®éªŒæˆ–è€…åˆå…¥ä¸»åˆ†æ”¯ä¹‹å‰ï¼Œéƒ½éœ€è¦é‚€è¯·è‡³å°‘ 3 åèµ„æ·±åŒå­¦è¿›è¡Œ Code Review&lt;/li&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰è¯„å®¡å‘˜åœ¨ç¡®è®¤æ²¡æœ‰æ„è§æˆ–è€…æ‰€æœ‰ä¼˜åŒ–æ„è§éƒ½å·²å¾—åˆ°åˆç†è§£å†³åå¯¹ MR è¿›è¡Œç‚¹èµ ğŸ‘&lt;/li&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰å¼€å‘åˆ†æ”¯/MR éœ€è¦æ”’ 3 ä¸ªä»¥ä¸Šçš„ç‚¹èµæ‰èƒ½å¼€å®éªŒæµé‡æˆ–è€…åˆå…¥ä¸»åˆ†æ”¯&lt;/li&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰å¯¹äºåŸºäºåˆ†æ”¯å¼€å®éªŒæµé‡çš„åˆ†æ”¯ä»£ç ï¼Œä¹Ÿå¿…é¡»ç» code review åï¼ŒåŸºäºåˆ†æ”¯è¿›è¡Œæ‰“å®éªŒ tagï¼Œå¹¶åŸºäºå®éªŒ tag è¿›è¡Œçº¿ä¸Šå‘å¸ƒã€‚&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰é€‚å½“çº¦æŸåˆ†æ”¯åˆå…¥æƒé™ï¼Œä»…èµ„æ·±åŒå­¦ï¼ˆå…·ä½“åå•ï¼Ÿï¼‰æ‰èƒ½å°†å¼€å‘åˆ†æ”¯/MR åˆå…¥ä¸»åˆ†æ”¯&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-markdown&quot;&gt;&lt;code&gt;å˜æ›´åº”è¯¥ç»„ç»‡æˆ1ä¸ªæˆ–å¤šä¸ªè¡¥ä¸/MRï¼Œè§†å˜æ›´å¤§å°è€Œå®šï¼Œç»„ç»‡æ–¹å¼éµå¾ªä»¥ä¸‹è§„èŒƒæŒ‡å—ï¼š
- MR åº”è¯¥å°ä¸€ç‚¹
- MR åº”è¯¥éƒ½å¯ä»¥ç‹¬ç«‹ç¼–è¯‘å¹¶ä¸”æ˜¯æ­£ç¡®çš„ï¼ˆæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹éƒ½é€šè¿‡ï¼‰ã€‚ä¸éœ€è¦ä½ éªŒè¯è¿™ä¸€ç‚¹ï¼Œä½†æ˜¯éœ€è¦åœ¨ä»£ç ä¸­æ”¾å…¥ä¸€ç§æ ‡è®°æ¥åæ˜  MR æ˜¯å¦è¿åäº†è¿™æ¡è§„åˆ™ã€‚ä¾‹å¦‚ï¼šåœ¨ fix ä¸€ä¸ªé—®é¢˜ä¹‹å‰ï¼Œå…ˆå¼•å…¥ä¸€ä¸ªå›å½’æµ‹è¯•ç”¨ä¾‹ç”¨ä¾‹ã€‚
- MR åº”è¯¥è‡ªåŒ…å«ï¼ˆé«˜å†…èšï¼‰ï¼Œå¹¶ä¸”åªåšä¸€ä»¶äº‹æƒ…ã€‚
- æ¯ä¸ª MR éƒ½åº”è¯¥åŒ…å«ä¸€ä»½æè¿°æ€§çš„æäº¤æ—¥å¿—ï¼ˆcommit logï¼‰ã€‚
- MR çš„æè¿°ä¿¡æ¯ä¸åº”è¯¥å‡è®¾ä»£ç è¯„å®¡äººæ˜¯ä¸€ä¸ªä¸“å®¶ã€‚å®ƒåº”è¯¥åŒ…å«è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œç¡®ä¿å³ä½¿ä¸€ä¸ªæ™®é€šçš„å°ç™½ä¹Ÿèƒ½ç†è§£ã€‚
- MR çš„æè¿°ä¿¡æ¯åº”è¯¥è‡ªåŒ…å«ï¼Œä¹Ÿä¸è¦å¼•ç”¨æ— æ³•ä¿æŒå…³è”çš„è®¨è®ºä¿¡æ¯ï¼ˆâ€œå¦‚æ¯æ—¥æ²Ÿé€šè¾¾æˆçš„ä¸€è‡´ç»“è®ºâ€ï¼‰ã€‚
- MR åº”è¯¥åŒ…å«å˜æ›´çš„åŠ¨æœºï¼ˆèƒŒæ™¯ï¼‰ã€‚ä¸èƒ½ç®€å•åœ°è¯´ä¸€å¥â€œè®© X å®Œæˆ Yâ€ï¼Œè€Œåº”è¯¥ä»”ç»†è§£é‡Šä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšã€‚ &lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦é™„ï¼š&lt;a href=&apos;https://google.github.io/eng-practices/&apos;&gt;Google Engineering Practices Documentation&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;2.5 CI çº¦æŸ&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å› å½“å‰ä¸€ä¸ªä»£ç åº“æ”¯æŒäº§å‡ºä¸åŒæœåŠ¡çš„äºŒè¿›åˆ¶ç¨‹åºå’Œ Docker é•œåƒï¼Œä¸ºåŠ é€Ÿ CIï¼Œä½¿ç”¨äº†æ¡ä»¶ç¼–è¯‘ï¼Œæ ¹æ®ä¸åŒæ¡ä»¶è§¦å‘ä¸åŒ CI æµæ°´çº¿ã€‚&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;æ ¹æ®åˆ†æ”¯åçš„ç›®æ ‡æœåŠ¡åå¯¹åº”è§¦å‘ä¸åŒ CI æµæ°´çº¿ï¼ˆall åˆ™è§¦å‘æ‰€æœ‰çš„ CI æµæ°´çº¿ï¼‰&lt;/li&gt;
&lt;li&gt;MR åˆå…¥ master åˆ†æ”¯æ—¶ï¼Œå¿…é¡»è§¦å‘æ‰€æœ‰ CI æµæ°´çº¿ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;åŸºäº .gitlab-ci.yml é…ç½®å¼ºè¡Œçº¦æŸã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h3&gt;2.6 ç‰ˆæœ¬ Tag è§„èŒƒ&lt;/h3&gt;
&lt;ul&gt;&lt;li&gt;æ­£å¼tag
&lt;ul&gt;&lt;li&gt;åªèƒ½åœ¨ master åˆ†æ”¯ä¸Šæ‰“ tagï¼Œtag å‘½åè§„èŒƒä¸º vä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·ï¼ŒåŸºäº è¯­ä¹‰åŒ–ç‰ˆæœ¬&lt;/li&gt;
&lt;li&gt;tag å†…å®¹å¿…é¡»åŒ…å«å¿…è¦çš„æè¿°æ€§ä¿¡æ¯ï¼Œå£°æ˜æ­¤æ¬¡å˜æ›´çš„å†…å®¹ï¼ŒåŒ…å«ç›¸å…³çš„ MRã€æ–‡æ¡£é“¾æ¥&lt;/li&gt;
&lt;li&gt;hotfix ç‰ˆæœ¬ tagï¼Œåº”è¯¥ä»¥ fix ä¹‹å‰çš„ tag ä¸ºå‰ç¼€ï¼ŒåŠ ä¸Šâ€œ-hotfixâ€ åç¼€ï¼Œç¤ºä¾‹ï¼šv10.0.1-hotfixï¼›å¦‚æœå¯¹åŒä¸€ä¸ª tag çš„ä»£ç å‘ç”Ÿäº†ä¸åªä¸€æ¬¡ hotfixï¼Œåˆ™ç»§ç»­è¡¥å……ä¸Šç§’çº§çš„æ—¶é—´æˆ³ä½œä¸ºåç¼€&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;å®éªŒtag
&lt;ul&gt;&lt;li&gt;åœ¨åˆ†æ”¯ä¸Šæ‰“tagè¿›è¡Œçº¿ä¸Šå®éªŒå¼€é‡ï¼Œtagå‘½åè§„èŒƒï¼šexp.æ–‡æ¡£ç¼–å·.è¿­ä»£ç‰ˆæœ¬å·ï¼Œç¤ºä¾‹ï¼šexp.w88.0&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;2.7 ç›‘æ§æ‰“ç‚¹å’Œæ—¥å¿—&lt;/h3&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;å…±è¯†ï¼šä»¥å°½å¯èƒ½å°çš„æ€§èƒ½å¼€é”€æœ€å¤§åŒ–ç³»ç»Ÿçš„å¯è§‚æµ‹æ€§&lt;/p&gt;&lt;/blockquote&gt;
&lt;ul&gt;&lt;li&gt;ï¼ˆå»ºè®®ï¼‰å¤šä½¿ç”¨ ROC æ‰“ç‚¹ï¼Œå€ŸåŠ©å¤šç»´æ•°æ®åˆ†æï¼Œæ–¹ä¾¿é—®é¢˜å®šä½åˆ†æ&lt;/li&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰æ³¨æ„æ—¥å¿—çº§åˆ«ï¼ˆDEBUGã€INFOã€ERRORã€FATALï¼‰çš„è¯­ä¹‰
&lt;ul&gt;&lt;li&gt;ä¸è¦ä½¿ç”¨é DEBUG çº§åˆ«æ¥è¾“å‡º DEBUG æ—¥å¿—&lt;/li&gt;
&lt;li&gt;æ³¨æ„ FATAL çš„å®é™…å½±å“&lt;/li&gt;
&lt;li&gt;ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„æ—¥å¿—çº§åˆ«ï¼Œç”Ÿäº§ç¯å¢ƒä¸è¦è¾“å‡º DEBUG æ—¥å¿—ï¼Œhttps://github.com/google/glog#setting-flags&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰ä½¿ç”¨ glog vlog æ¥è¿›ä¸€æ­¥æ§åˆ¶ä¸åŒç¯å¢ƒ/åœºæ™¯ä¸‹çš„æ—¥å¿—é‡ï¼Œhttps://github.com/google/glog#verbose-logging&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰ä¸è¦é»˜é»˜åœ°å¤±è´¥
&lt;ul&gt;&lt;li&gt;ERROR/WARNING æ—¥å¿—&lt;/li&gt;
&lt;li&gt;Event æ‰“ç‚¹&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰ä½¿ç”¨ Event æ‰“ç‚¹å……åˆ†è¡¨ç°è¾“å…¥é‡ã€è¾“å…¥ç±»å‹ã€è¾“å‡ºé‡ã€å˜åŒ–è¶‹åŠ¿
&lt;ul&gt;&lt;li&gt;è¯·æ±‚ QPSã€å¢é‡æ¶ˆæ¯ TPSã€ä¸åŒç±»å‹å¢é‡æ¶ˆæ¯çš„ TPSã€ã€‚ã€‚ã€‚&lt;/li&gt;
&lt;li&gt;åŸºå‡†æ•°æ®çš„ç»Ÿè®¡è®¡æ•°&lt;/li&gt;
&lt;li&gt;è¯·æ±‚æ¥æºï¼šå®¢æˆ·ç«¯ç±»å‹ç²’åº¦ã€å®¢æˆ·ç«¯ ip ç²’åº¦ã€åœºæ™¯ç»´åº¦ã€åª’ä½“ç»´åº¦ã€ã€‚ã€‚ã€‚&lt;/li&gt;
&lt;li&gt;trigger æ•°ã€å„ç±»è¿‡æ»¤å™¨æ•°ç›®ç»Ÿè®¡&lt;/li&gt;
&lt;li&gt;æ£€ç´¢ç»“æœæ•°é‡ã€æˆªæ–­å/å®é™…è¿”å›ç»™å®¢æˆ·ç«¯çš„ç»“æœæ•°é‡&lt;/li&gt;
&lt;li&gt;å„ç±»è¿‡æ»¤å™¨çš„è¿‡æ»¤é‡&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰ä½¿ç”¨ Transaction è¡¨ç°è€—æ—¶åˆ†å¸ƒ - æ•´ä½“è€—æ—¶å¤šå°‘ã€æ—¶é—´éƒ½èŠ±åœ¨å“ªäº›ç¯èŠ‚ï¼ˆåŒ…æ‹¬ RPC æ¡†æ¶å†…çš„ç­‰å¾…æ—¶å»¶ï¼‰ï¼šTt = T1 + T2 + ...&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰ä½¿ç”¨ Metric è¡¨ç°è·¨èŠ‚ç‚¹/é›†ç¾¤/åœºæ™¯çš„ä¸šåŠ¡æŒ‡æ ‡å˜åŒ–è¶‹åŠ¿&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰æ€§èƒ½è€ƒè™‘ï¼Œæ‰“ç‚¹æ¥å£è°ƒç”¨æ¬¡æ•°åº”å°äºç­‰äºè¯·æ±‚ QPSã€æ¶ˆæ¯ TPS&lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;2.8 æœ€ä½³å®è·µ&lt;/h3&gt;
&lt;ul&gt;&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰å°½æ—©ä¸¥æ ¼æ£€æµ‹è¯·æ±‚ã€æ•°æ®ã€é…ç½®ç­‰è¾“å…¥çš„åˆæ³•æ€§&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰å°½é‡ä¸ä½¿ç”¨é…ç½®ä¸­å¿ƒçš„é…ç½®ç›‘å¬&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰å¤šäº†è§£ä½¿ç”¨åŸºç¡€åº“ - boostã€abseil-cpp ç­‰&lt;/li&gt;&lt;/ul&gt;
&lt;h2&gt;ä¸‰ã€æµ‹è¯•&lt;/h2&gt;
&lt;h3&gt;3.1 å•å…ƒæµ‹è¯•&lt;/h3&gt;
&lt;ul&gt;&lt;li&gt;æ˜ç¡®å•å…ƒæµ‹è¯•ä¸é›†æˆæµ‹è¯•çš„åŒºåˆ«ï¼Œ&lt;a href=&apos;https://zh.wikipedia.org/wiki/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95&apos;&gt;wikipedia - å•å…ƒæµ‹è¯•&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å•å…ƒæµ‹è¯•çš„ä½œç”¨ï¼š
&lt;ul&gt;&lt;li&gt;éªŒè¯æŸä¸ªé€»è¾‘çš„å½“å‰å®éªŒæ˜¯å¦ç¬¦åˆé¢„æœŸ&lt;/li&gt;
&lt;li&gt;æ›´é‡è¦çš„æ˜¯å¯¹ä»¥åçš„ä»£ç å˜æ›´å¯èƒ½é€ æˆçš„éé¢„æœŸå½±å“/ç ´åè¿›è¡Œä¸€å®šçš„é˜²å¾¡&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;GoogleTestï¼Œç”¨å¥½ Mocking&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ï¼ˆå¼ºåˆ¶ï¼‰CI å¼ºåˆ¶è¦æ±‚æ–°å¢/å˜æ›´ä»£ç çš„æµ‹è¯•è¦†ç›–ç‡ã€‚ï¼ˆåŸºäº .gitlab-ci.yml é…ç½®å¼ºè¡Œçº¦æŸï¼Ÿï¼‰&lt;/p&gt;
&lt;h3&gt;3.2 é›†æˆæµ‹è¯•&lt;/h3&gt;
&lt;ul&gt;&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰ä»»ä½•ä»£ç å˜æ›´ï¼Œéƒ½å¿…é¡»ç»è¿‡è‡ªæµ‹/é›†æˆæµ‹è¯•
&lt;ul&gt;&lt;li&gt;ä»»åŠ¡å¯ä»¥æ­£å¸¸è·‘èµ·æ¥ï¼Œå˜æ›´çš„é€»è¾‘å·²ç”Ÿæ•ˆï¼Œäº§å‡ºçš„ç»“æœç¡®è®¤ç¬¦åˆé¢„æœŸ&lt;/li&gt;
&lt;li&gt;æœåŠ¡å¯ä»¥æ­£å¸¸è¿è¡Œèµ·æ¥ï¼Œå˜æ›´çš„é€»è¾‘å·²ç”Ÿæ•ˆï¼Œå¯ä»¥æ­£å¸¸åŠ è½½æ•°æ®/ç´¢å¼•ï¼Œè¯·æ±‚å“åº”çš„ç»“æœç¡®è®¤ç¬¦åˆé¢„æœŸ&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰æµ‹è¯•ç¯å¢ƒ/å·¥å…·
&lt;ul&gt;&lt;li&gt;ç‹¬ç«‹çš„æµ‹è¯•éªŒè¯é›†ç¾¤&lt;/li&gt;
&lt;li&gt;å¼€å‘æœºç¯å¢ƒä¸‹çš„ Docker ç¯å¢ƒ + ä»£ç åº“ä¸­çš„ Dockerfile
&lt;ul&gt;&lt;li&gt;docker build -t image-name .&lt;/li&gt;
&lt;li&gt;docker run -dp 8003:8003 image-name&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;æ˜“ç”¨çš„è„šæœ¬ - ä¸€é”®å¯åŠ¨+ç´¢å¼•æ•°æ®åŠ è½½ã€æ˜“ç”¨çš„å®¢æˆ·ç«¯å·¥å…·ã€æ˜“ç”¨çš„æ•°æ®æ ¡éªŒå·¥å…·&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;3.3 æ‰¹é‡ Diff æµ‹è¯•&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ï¼ˆå¼ºåˆ¶ï¼‰å¦‚æœä»£ç å˜æ›´å½±å“äº†ç´¢å¼•æˆ–è€…æ£€ç´¢é€»è¾‘ï¼Œåˆ™åº”è¯¥è¿›è¡Œå……åˆ†çš„ diffï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å¦‚æœèµ°å®éªŒï¼Œåˆ™éƒ¨ç½²æ–°å®éªŒé›†ç¾¤åå¼€å®éªŒä¹‹å‰ï¼Œè¿›è¡Œ åŸºå‡†é›†ç¾¤ VS. å®éªŒé›†ç¾¤ çš„è¯·æ±‚ç»“æœ diff&lt;/li&gt;
&lt;li&gt;å¦‚æœä¸èµ°å®éªŒï¼Œåˆ™åŸºäºç‹¬ç«‹çš„æµ‹è¯•éªŒè¯é›†ç¾¤ï¼Œè¿›è¡Œ ç”Ÿäº§é›†ç¾¤ VS. æµ‹è¯•é›†ç¾¤ çš„è¯·æ±‚ç»“æœ diff
&lt;ul&gt;&lt;li&gt;diff å®Œæˆåï¼Œå³åˆ»é‡Šæ”¾æµ‹è¯•é›†ç¾¤èµ„æº&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;å¯¹äº diff ç»“æœï¼Œä¸ç®¡æœ€åçš„ diff ç‡æœ‰å¤šå°ï¼Œåªè¦æœ‰ diffï¼Œå°±éœ€è¦ç¡®è®¤ diff æ¥æº/åŸå› æ˜¯å¦ç¬¦åˆé¢„æœŸ&lt;/li&gt;
&lt;li&gt;diff çš„ä¸åŒè¯·æ±‚æ•°é‡å¿…é¡»è¾¾åˆ° 1000 ä»¥ä¸Š&lt;/li&gt;
&lt;li&gt;ç»Ÿä¸€ä½¿ç”¨æ˜“ç”¨ä¸”åŠŸèƒ½å®Œå–„çš„ diff å·¥å…·&lt;/li&gt;
&lt;li&gt;ç”Ÿäº§é›†ç¾¤å‘ç‰ˆæˆ–è€…å®éªŒé›†ç¾¤å¼€æµé‡ä¹‹å‰ï¼Œåœ¨å‘¨çŸ¥ç›¸å…³äººå‘˜æ—¶ï¼Œå¿…é¡»ä¸€å¹¶æä¾› diff ç»“æœä»¥åŠå·²ç¡®è®¤ diff æ¥æºç¬¦åˆé¢„æœŸ&lt;/li&gt;&lt;/ul&gt;
&lt;h2&gt;å››ã€å‘å¸ƒ&lt;/h2&gt;
&lt;ul&gt;&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰æµé‡é«˜å³°æœŸä¸å‘ç‰ˆ&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰å‘¨äº”æ™šä¸ŠåŠå‘¨æœ«ä¸å‘ç‰ˆ&lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;4.1 å‘å¸ƒä¹‹å‰&lt;/h3&gt;
&lt;ul&gt;&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰è¯„ä¼°ç¡®è®¤å¥½æœ¬æ¬¡å‘å¸ƒå‰åæœåŠ¡é›†ç¾¤è´Ÿè½½æ˜¯å¦ä¼šæœ‰å˜åŒ–ï¼Œå¦‚æœå˜æ›´ä¼šå½±å“é›†ç¾¤è´Ÿè½½ä¸Šæ¶¨ï¼Œåˆ™åº”æå‰æ‰©å®¹&lt;/li&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰åœ¨ç›¸å…³å¤§ç¾¤å†…è¿›è¡Œé€šå‘Šï¼Œé€šå‘Šæ¨¡æ¿å¦‚ä¸‹ï¼š&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;å˜æ›´é€šçŸ¥ï¼š
- å˜æ›´å†…å®¹ï¼šxxxx
- æ¶‰åŠé›†ç¾¤å’Œåœºæ™¯ï¼šxxx
- æ“ä½œäººï¼šxxx
- ç›¸å…³æ–‡æ¡£ï¼ˆå«éœ€æ±‚èƒŒæ™¯ã€å·¥ç¨‹æ–¹æ¡ˆã€ä»£ç  MRã€diff / æµ‹è¯•æŠ¥å‘Šç­‰ä¿¡æ¯ï¼‰ æˆ– å®éªŒé“¾æ¥ï¼šxxx&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;4.2 å‘å¸ƒæœŸé—´&lt;/h3&gt;
&lt;ul&gt;&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰å…ˆç°åº¦å‘å¸ƒä¸€è¡Œæˆ–è€…å°‘é‡è¡Œï¼Œç¡®è®¤å„é¡¹å·¥ç¨‹æŒ‡æ ‡+ä¸šåŠ¡æŒ‡æ ‡æ— å¼‚å¸¸åï¼Œå†å…¨é‡å‘å¸ƒ&lt;/li&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰å‘å¸ƒæœŸé—´éœ€è¦ä¿æŒå…³æ³¨å‘Šè­¦ä»¥åŠå…³é”®å·¥ç¨‹æŒ‡æ ‡å’Œä¸šåŠ¡æŒ‡æ ‡&lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;4.3 å‘å¸ƒä¹‹å&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ï¼ˆå¼ºåˆ¶ï¼‰å‘ç‰ˆå®Œæˆåï¼Œç¡®è®¤å„é¡¹å·¥ç¨‹æŒ‡æ ‡/ä¸šåŠ¡æŒ‡æ ‡æ­£å¸¸åï¼Œåœ¨ç›¸å…³å¤§ç¾¤å†…å‘¨çŸ¥å‘ç‰ˆå®Œæˆï¼Œç¡®è®¤å„é¡¹æŒ‡æ ‡å¹³ç¨³/ç¬¦åˆé¢„æœŸ&lt;/p&gt;
&lt;h2&gt;äº”ã€å®éªŒ&lt;/h2&gt;
&lt;h3&gt;5.1 å®éªŒå¼€é‡ä¹‹å‰&lt;/h3&gt;
&lt;ul&gt;&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰äººå·¥åˆ· demoï¼Œå…¨é“¾è·¯éªŒè¯&lt;/li&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰å®éªŒé›†ç¾¤èµ„æºé¢„ä¼°å‡†å¤‡ï¼ŒåŒ…æ‹¬è¯„ä¼°é“¾è·¯ä¸­é—´ç¯èŠ‚èµ„æºè´Ÿè½½å˜åŒ–&lt;/li&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰åœ¨ç›¸å…³å¤§ç¾¤å†…é€šå‘Šï¼Œé€šå‘Šä¿¡æ¯ï¼šå®éªŒåã€å®éªŒé“¾æ¥&lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;5.2 å®éªŒæœŸé—´&lt;/h3&gt;
&lt;ul&gt;&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰å®éªŒåˆšå¼€é‡æ—¶ï¼Œå…³æ³¨å®æ—¶æŠ¥è¡¨ 10~30 åˆ†é’Ÿå˜åŒ–è¶‹åŠ¿ï¼š&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰æ¯å¤©åŠæ—¶æŸ¥çœ‹å®éªŒå¹³å°ä¸Šå½“å‰å®éªŒçš„å¤©çº§å®éªŒæŠ¥è¡¨ï¼Œå¦‚æœæœ‰è¾ƒæ˜æ˜¾çš„è´Ÿå‘æŒ‡æ ‡ï¼Œåˆ™åº”åŠæ—¶é€šå‘Šå‡ºæ¥ï¼Œä¸ç›¸å…³åŒå­¦ä¸€èµ·åˆ†æå¯èƒ½çš„åŸå› &lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;5.3 å®éªŒæ‰©é‡æˆ–æ¨å…¨ä¹‹å‰&lt;/h3&gt;
&lt;ul&gt;&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰å®éªŒé›†ç¾¤èµ„æºé¢„ä¼°å‡†å¤‡ï¼ŒåŒ…æ‹¬è¯„ä¼°é“¾è·¯ä¸­é—´ç¯èŠ‚èµ„æºè´Ÿè½½å˜åŒ–&lt;/li&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰ä¸ç›¸å…³ç®—æ³•åŒå­¦ç¡®è®¤å¥½å®éªŒæ—¶é•¿ä¸å®éªŒæ•ˆæœæ˜¯å¦è¾¾åˆ°æ‰©é‡è¦æ±‚&lt;/li&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰åœ¨ç›¸å…³å¤§ç¾¤å†…é€šå‘Šï¼Œé€šå‘Šä¿¡æ¯ï¼šå®éªŒåã€å®éªŒé“¾æ¥ã€æµé‡ä»å¤šå°‘å˜åŒ–åˆ°å¤šå°‘&lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;5.4 å®éªŒæ‰©é‡æˆ–æ¨å…¨æ“ä½œæœŸé—´&lt;/h3&gt;
&lt;ul&gt;&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰å¯¹å®éªŒé›†ç¾¤è´Ÿè½½æƒ…å†µä¿æŒå…³æ³¨&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰å¯¹äºæ¨å…¨æ“ä½œï¼Œå°½å¯èƒ½ç°åº¦æ¨å…¨ï¼Œä¸­é—´æ­¥éª¤ç•™ä¸€å®šæ—¶é—´ç¡®è®¤é›†ç¾¤è´Ÿè½½å’Œæµé‡å˜åŒ–æ˜¯å¦ç¬¦åˆé¢„æœŸ&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰å…ˆå¼€åè½¬ï¼Œå†è¿›è¡Œæ¨å…¨ï¼Œé¿å…ä¸å¿…è¦çš„èµ„æºè…¾æŒªæ‰©ç¼©ï¼Œä¹Ÿèƒ½ä¸€å®šç¨‹åº¦ä¸Šæ§åˆ¶é£é™©&lt;/li&gt;&lt;/ul&gt;
&lt;h2&gt;å…­ã€è§„èŒƒè½åœ°&lt;/h2&gt;
&lt;ul&gt;&lt;li&gt;ï¼ˆå»ºè®®ï¼‰è§„èŒƒæµç¨‹æ”¯æŒå·¥å…·å’Œå¹³å°ä¸æ–­ä¼˜åŒ–ï¼Œå°½å¯èƒ½å‡å°‘è§„èŒƒæµç¨‹é€ æˆçš„äººåŠ›è´Ÿæ‹…&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰ä¸æ–­æ›´æ–°å®Œå–„è§„èŒƒ&lt;/li&gt;&lt;/ul&gt;</description>
            <pubDate>2023-04-05</pubDate>
            <link>https://blog.xiayf.cn/posts/team-dev-process-std.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/team-dev-process-std.html</guid>
        </item>
        
        <item>
            <title>ä¸ä¸€ä¸ªå‰ leader çš„äº¤æµç¬”è®°</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚ä¸‹è¿™ä»½ç¬”è®°ï¼Œæ˜¯ 19 å¹´å’Œä¸€ä¸ªå‰ leader äº¤æµåè®°å½•ä¸‹æ¥çš„ã€‚è¯´æ˜¯äº¤æµï¼Œå…¶å®æ˜¯é’ˆå¯¹æˆ‘å½“æ—¶å·¥ä½œä¸­å­˜åœ¨çš„é—®é¢˜ï¼Œä»–ç»™æˆ‘æå‡ºçš„ä¸€äº›æ”¹è¿›å»ºè®®ã€‚å¦‚ä»Šå†çœ‹çœ‹ï¼Œä»ç„¶èƒ½å¼•èµ·è‡ªå·±çš„æ€è€ƒã€‚&lt;/p&gt;
&lt;h2&gt;2019-10-27&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;å¦‚ä½•è®¨è®ºéœ€æ±‚/æŠ€æœ¯æ–¹æ¡ˆ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ç³»ç»Ÿæ€§ç†è§£éœ€æ±‚
&lt;ul&gt;&lt;li&gt;å…¨é¢æ¢³ç†æŠ€æœ¯æ–¹æ¡ˆï¼Œè®ºè¯æ–¹æ¡ˆçš„ä¸åˆç†ä¹‹å¤„&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;ul&gt;&lt;li&gt;å¦‚ä½•è¯æ˜æ–¹æ¡ˆä¸åˆç†ï¼Ÿ
&lt;ul&gt;&lt;li&gt;èµ„æºæˆæœ¬ï¼ˆæœºå™¨ã€äººåŠ›ï¼‰ï¼Œé‡å¤å·¥ä½œä¹Ÿæ˜¯å¯¹èµ„æºçš„ä¸€ç§æµªè´¹&lt;/li&gt;
&lt;li&gt;å¯¹æ•ˆæœï¼ˆæ”¶å…¥ç­‰ï¼‰çš„å½±å“&lt;/li&gt;
&lt;li&gt;è¦ç«™åœ¨â€œå…¬æ­£â€çš„è§’åº¦æ¥è®ºè¯ï¼Œä»å¤§å®¶å…±æœ‰çš„è®¤çŸ¥(æœºå™¨ã€å¸¦å®½ã€å†…å­˜)å‡ºå‘&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ€åæ‰æ˜¯ä»€ä¹ˆç³»ç»Ÿå¤æ‚åº¦ï¼ˆè¯´åˆ°è¿™ä¸ªç‚¹ï¼Œå¾ˆå®¹æ˜“æ‰¯æ·¡ï¼Œè°éƒ½ä¼šè¯´è‡ªå·±å¤æ‚ï¼‰&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è®¨è®ºé—®é¢˜çš„æ—¶å€™ï¼Œè‡ªå·±ä¸åšï¼Œä½†ä¸è¦ä»â€œç¡¬æ¨ç»™åˆ«äººçš„è§’åº¦â€å»è®¨è®ºï¼Œè€Œæ˜¯è¦ä»â€œä¸ºå•¥è‡ªå·±ä¸åº”è¯¥åšâ€çš„è§’åº¦å‡ºå‘ã€‚æ¯”å¦‚åšäº†ï¼Œå¯¼è‡´ç³»ç»Ÿè€¦åˆï¼Œå¤æ‚ï¼Œåšäº†å¯¼è‡´å¤šä½™çš„è°ƒç”¨é‡æ›´å¤šç­‰ ã€‚&lt;/p&gt;
&lt;h2&gt;2019-12-17&lt;/h2&gt;
&lt;ol&gt;&lt;li&gt;è·¨å›¢é˜Ÿå·¥ä½œè®¨è®ºæ—¶ï¼Œå›´ç»•åº”è¯¥æ€ä¹ˆåšï¼ˆæ€ä¹ˆåšæœ€åˆç†ï¼‰æ¥è®¨è®ºï¼Œè€Œä¸æ˜¯å›´ç»•å¦‚æœè‡ªå·±æ¥åšä¼šæœ‰ä»€ä¹ˆå›°éš¾æ¥è®¨è®º&lt;/li&gt;
&lt;li&gt;é¡¹ç›®/ç³»ç»Ÿè¦æœ‰ ç›®æ ‡/é•¿è¿œæ¶æ„å›¾ï¼ˆæœ€ç»ˆåšæˆä»€ä¹ˆæ ·å­ï¼Œæ ¸å¿ƒ KPIï¼‰&lt;/li&gt;
&lt;li&gt;åšå¥½å‘ä¸Šæ±‡æŠ¥&lt;/li&gt;
&lt;li&gt;ä¸è¦æ‹¿â€œåšçš„è¿‡ç¨‹ä¸­çš„å›°éš¾â€æ¥æªå¡ä¸åšï¼Œè€Œæ˜¯è¦ä»å®¢è§‚äº‹å®çš„è§’åº¦æ¥é—®åº”ä¸åº”è¯¥åš&lt;/li&gt;
&lt;li&gt;ä¸è¦èšç„¦äºè§£å†³ç°å®ä¸–ç•Œçš„ä¸€ä¸ªä¸ªé—®é¢˜ï¼Œè€Œæ˜¯è¦é å…·ä½“çš„ä¸€ä¸ªä¸ªé—®é¢˜ï¼ŒæŠ½è±¡å‡ºä¸€å¼ å¤§å›¾&lt;/li&gt;
&lt;li&gt;æŠŠè‡ªå·±çš„ç³»ç»Ÿåšæˆé“¾è·¯ä¸Šæœ€æè‡´çš„é‚£ä¸ªï¼Œè€Œä¸æ˜¯ç­‰åˆ«äººåšå¥½åæ¥åæ¨è‡ªå·±å˜é©&lt;/li&gt;
&lt;li&gt;è¦åŒºåˆ†é‡è¦å’Œä¸é‡è¦çš„äº‹æƒ…ï¼Œæ ¸å¿ƒçš„äº‹æƒ…è¦ä»”ç»†æ£æ‘©ï¼Œæ²¡æœ‰äººæ˜¯å‚»å­ï¼Œé‚£äº›èµ„æ·±çš„äººè¯´å‡ºçš„è¯æ›´è¦æ£æ‘©ï¼Œç†è§£&lt;/li&gt;
&lt;li&gt;è¦æœ‰è§„åˆ’å’Œæ„¿æ™¯ï¼Œleader æ²¡æœ‰è¿™äº›ï¼Œå›¢é˜Ÿèµ°ä¸è¿œ&lt;/li&gt;&lt;/ol&gt;</description>
            <pubDate>2022-11-16</pubDate>
            <link>https://blog.xiayf.cn/posts/talk-about-how-to-do.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/talk-about-how-to-do.html</guid>
        </item>
        
        <item>
            <title>è¯»æ–‡ï¼šå…³äº MMAP ä¸ SSD</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;è®¾è®¡ä¸€ç§å­˜å‚¨ï¼Œç¬¬ä¸€è¦æ˜ç¡®åº”ç”¨åœºæ™¯å’Œå­˜å‚¨ç³»ç»Ÿçš„å·¥ä½œè´Ÿè½½ï¼Œç¬¬äºŒè¦äº†è§£åº•å±‚ç¡¬ä»¶çš„ç‰¹ç‚¹ã€‚&lt;/p&gt;
&lt;h2&gt;1ã€&lt;a href=&apos;https://db.cs.cmu.edu/mmap-cidr2022/&apos;&gt;Are You Sure You Want to Use MMAP in Your Database Management System? &lt;/a&gt;&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;MMAPï¼ˆMemory-mapped file I/Oï¼‰æ˜¯æ“ä½œç³»ç»Ÿæä¾›çš„ä¸€ç§åŠŸèƒ½ç‰¹æ€§ - å°†äºŒçº§å­˜å‚¨ï¼ˆç£ç›˜ã€SSDï¼‰ä¸Šä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹æ˜ å°„åˆ°ç¨‹åº/è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œç„¶åç¨‹åºå°±å¯ä»¥ä»¥æŒ‡é’ˆè®¿é—®å†…å­˜é¡µçš„æ–¹å¼æ¥è®¿é—®æ–‡ä»¶å†…å®¹ã€‚å½“ç¨‹åºè®¿é—®åˆ°æŸä¸ªå†…å­˜é¡µæ—¶ï¼Œæ“ä½œç³»ç»Ÿå°±ä¼šè‡ªåŠ¨å°†å¯¹åº”æ–‡ä»¶å†…å®¹åŠ è½½åˆ°è¯¥å†…å­˜é¡µä¸­ï¼Œå½“å†…å­˜ç”¨æ»¡äº†ï¼Œä¹Ÿä¼šè‡ªåŠ¨å‰”é™¤æŸäº›å†…å­˜é¡µã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;MMAP å…¶å®å°±ä¸€ä¸ªç°æˆçš„ç¼“å†²æ± ï¼ˆbuffer poolï¼‰ï¼Œæ ¸å¿ƒç‰¹ç‚¹å°±æ˜¯ç®€å•æ˜“ç”¨ï¼Œä¸éœ€è¦é‡å¤å¼€å‘ï¼Œç¼ºç‚¹æ˜¯åœ¨éœ€è¦æ—¶æ— æ³•ç²¾ç¡®æ§åˆ¶å…¶è¡Œä¸ºã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½¿ç”¨ MMAP çš„ä¼˜åŠ¿æ˜¯ç”±æ“ä½œç³»ç»Ÿå°è£…äº†å¦‚ä¸‹åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ä»ç£ç›˜è¯»æ•°æ®&lt;/li&gt;
&lt;li&gt;ä¸åŒçº¿ç¨‹è¯»ç›¸åŒæ•°æ®çš„å¹¶å‘å¤„ç†&lt;/li&gt;
&lt;li&gt;ç¼“å­˜å’Œç¼“å†²ç®¡ç†ï¼ˆCaching and buffer managementï¼‰&lt;/li&gt;
&lt;li&gt;ä»å†…å­˜ä¸­å‰”é™¤/é©±é€å†…å­˜é¡µ&lt;/li&gt;
&lt;li&gt;åŒä¸€ä¸ªæœºå™¨ä¸Šä¸åŒè¿›ç¨‹ä¹‹é—´å¯ä»¥å‹å¥½äº¤äº’ ğŸ¤”&lt;/li&gt;
&lt;li&gt;è·Ÿè¸ªè„é¡µä»¥åŠå°†è„é¡µå†™å…¥ç£ç›˜ ğŸ¤”&lt;/li&gt;
&lt;li&gt;ç›¸æ¯” read/write ç³»ç»Ÿè°ƒç”¨ï¼Œmmap ä¸éœ€è¦å°†å†…å­˜é¡µä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼Œè€Œæ˜¯ç›´æ¥ä»æ“ä½œç³»ç»Ÿçš„å†…å­˜é¡µç¼“å­˜ä¸­ç›´æ¥è®¿é—®å†…å­˜é¡µï¼Œæœ‰ä¸€å®šçš„æ€§èƒ½ä¼˜åŠ¿&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;MMAP ç›¸å…³ POSIX APIï¼šmmapã€madviseã€mlockã€msyncã€‚&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2022/11/16/U7xMgzj36dZDGaO.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;100%&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;â‘  A program calls mmap and receives a pointer to the memory-mapped file contents.&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;â‘¡ The OS reserves part of the programâ€™s virtual address space but does not load any part of the file.&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;â‘¢ The program accesses the fileâ€™s contents using the pointer.&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;â‘£ The OS attempts to retrieve the page.&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;â‘¤ Since no valid mapping exists for the specified virtual address, the OS triggers a page fault to load the referenced part of the file from secondary storage into a physical memory page.&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;â‘¥ The OS adds an entry to the page table that maps the virtual address to the new physical address.&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;â‘¦ The initiating CPU core also caches this entry in its local translation lookaside buffer (TLB) to accelerate future accesses.&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸è¿‡è®ºæ–‡ä½œè€…è®¤ä¸º mmap å­˜åœ¨ä¸€äº›æ•°æ®å®‰å…¨æ€§å’Œç³»ç»Ÿæ€§æ€§èƒ½é—®é¢˜ï¼Œä¸ºè§£å†³è¿™äº›é—®é¢˜è€Œå¼•å…¥çš„å·¥ç¨‹æˆæœ¬ä¼šæŠµæ¶ˆæ‰ç®€å•æ€§ï¼š&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;1ã€äº‹åŠ¡å®‰å…¨æ€§ï¼ˆTransactional Safetyï¼‰&lt;/strong&gt;ï¼šç”±äºé€æ˜çš„é¡µå¼è°ƒåº¦æœºåˆ¶ï¼Œæ“ä½œç³»ç»Ÿå¯èƒ½ä¼šä»»æ„æ—¶åˆ»å°†ä¸€ä¸ªè„é¡µåˆ·åˆ°äºŒçº§å­˜å‚¨ä¸­ï¼Œä¸ç®¡å†™äº‹åŠ¡æ˜¯å¦å·²æäº¤ã€‚DBMS æ— æ³•ç»„ç»‡è¿™ç§å†…å­˜æ•°æ®åˆ·å‡ºï¼Œå¹¶ä¸”å‘ç”Ÿæ—¶ä¹Ÿä¸ä¼šæ¥æ”¶åˆ°ä»»ä½•ä¿¡å·ã€‚æ‰€ä»¥åŸºäº mmap çš„æ•°æ®åº“ç³»ç»Ÿåªèƒ½é‡‡ç”¨å¤æ‚çš„åè®®æ¥ç¡®ä¿ï¼ˆå†™/æ›´æ–°ï¼‰äº‹åŠ¡å®‰å…¨ï¼Œæ‰‹æ®µä¸Šå¤§æ¦‚åˆ†3ç§ï¼šæ“ä½œç³»ç»Ÿå†™æ—¶å¤åˆ¶ã€ç”¨æˆ·ç©ºé—´å†™æ—¶å¤åˆ¶ã€å½±å­é¡µç®¡ç†ï¼ˆshadow pagingï¼‰&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;2ã€I/O åœé¡¿ï¼ˆI/O Stallsï¼‰&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;mmap ä¸æ”¯æŒå¼‚æ­¥è¯»ï¼›è‡ªå·±æç¼“å†²æ± çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨å¼‚æ­¥ I/Oï¼ˆæ¯”å¦‚ libaioã€io_uringï¼‰æ¥é¿å…æŸ¥è¯¢æ—¶é˜»å¡çº¿ç¨‹&lt;/li&gt;
&lt;li&gt;å¯¹äº mmapï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨/é€æ˜åœ°å‰”é™¤ä¸€äº›å†…å­˜é¡µï¼Œè¿™æ ·å¯èƒ½å¯¼è‡´ - å¦‚æœæŸäº›åªè¯»æŸ¥è¯¢å‘½ä¸­äº†å·²è¢«å‰”é™¤çš„å†…å­˜é¡µï¼Œå°±ä¼šæ— æ³•é¢„çŸ¥åœ°è§¦å‘é˜»å¡æ€§çš„é¡µé”™è¯¯/ç¼ºé¡µå¤„ç†&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è§£å†³æ–¹æ¡ˆï¼š1ã€ä½¿ç”¨ mlockï¼Œä¸è¿‡æ“ä½œç³»ç»Ÿå¯¹ä¸€ä¸ªè¿›ç¨‹èƒ½é”ä½çš„å†…å­˜é¡µæ•°é‡æœ‰é™åˆ¶ï¼›2ã€ä½¿ç”¨ madvise çš„ MADV_SEQUENTIAL æ ‡è®°ï¼Œä»…èƒ½é—®é¢˜çš„ä¸€éƒ¨åˆ†ï¼›3ã€ä½¿ç”¨é¢å¤–çš„çº¿ç¨‹æ¥è¿›è¡Œå†…å­˜é¡µé¢„å–ï¼Œé¿å…ä¸»çº¿ç¨‹è¢«é˜»å¡ï¼Œä¸è¿‡ä¼šå¼•å…¥è¾ƒå¤§çš„å¤æ‚æ€§&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;3ã€é”™è¯¯å¤„ç†&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;DBMS çš„æ ¸å¿ƒèŒè´£ä¹‹ä¸€æ˜¯ç¡®ä¿æ•°æ®å®Œæ•´æ€§ - æ¯”å¦‚ï¼šæ ¡éªŒç£ç›˜æ•°æ®æ˜¯å¦æœ‰æŸå&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ä½¿ç”¨ mmapï¼ŒDBMS éœ€è¦åœ¨æ¯æ¬¡å†…å­˜é¡µè®¿é—®æ—¶æ£€æŸ¥æ ¡éªŒå’Œï¼ˆchecksumï¼‰ï¼Œå› ä¸ºå†…å­˜é¡µä¸€æ¬¡è®¿é—®ä¹‹åæ“ä½œç³»ç»Ÿå¯èƒ½ä¼šå°†è¯¥é¡µé©±é€åˆ°ç£ç›˜&lt;/li&gt;
&lt;li&gt;å¦‚æœ DBMS æ˜¯ä½¿ç”¨éå†…å­˜å®‰å…¨çš„ç¼–ç¨‹è¯­è¨€ç¼–å†™çš„ï¼Œå°±æœ‰å¯èƒ½åœ¨æŒ‡é’ˆæ“ä½œæ—¶æŸåå†…å­˜é¡µå†…å®¹ï¼Œæ‰€ä»¥éœ€è¦åœ¨å†…å­˜é¡µåˆ·åˆ°äºŒçº§å­˜å‚¨ä¹‹å‰è¿›è¡Œé”™è¯¯æ£€æµ‹ï¼Œmmap ä¼šé»˜é»˜åœ°å°†æŸåçš„å†…å­˜é¡µæŒä¹…åŒ–åˆ°äºŒçº§å­˜å‚¨&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ mmap ä¹Ÿæ›´éš¾ä¼˜é›…åœ°è¿›è¡Œ I/O é”™è¯¯å¤„ç†ï¼Œå’Œ mmap å†…å­˜äº¤äº’çš„ä»»ä½•ä»£ç éƒ½å¯èƒ½æŠ›å‡º SIGBUS ä¿¡å·ï¼ŒDBMS å¿…é¡»ä½¿ç”¨ä¿¡å·å¤„ç†å™¨ï¼ˆsignal handlersï¼‰æ¥å¤„ç† â“&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;4ã€æ€§èƒ½é—®é¢˜ï¼ˆæœ€é‡å¤§ï¼‰&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å¤§å®¶æ™®éè®¤ä¸º mmap æ€§èƒ½ä¼˜äºä¼ ç»Ÿæ–‡ä»¶ I/Oï¼ˆread/writeï¼‰ï¼Œå› ä¸ºå®ƒé¿å…ä¸¤ä¸ªå¼€é”€ï¼š(1) æ˜¾å¼è°ƒç”¨ read/write ç³»ç»Ÿè°ƒç”¨çš„å¼€é”€ (2) mmap ä¼šè¿”å›æŒ‡å‘æ“ä½œç³»ç»Ÿé¡µç¼“å­˜çš„é¡µæŒ‡é’ˆï¼Œå› æ­¤é¿å…äº†åˆ°ç”¨æˆ·å†…å­˜ç©ºé—´çš„ä¸€æ¬¡å†…å­˜æ‹·è´ï¼Œä¹Ÿå› æ­¤é™ä½äº†å†…å­˜å ç”¨ï¼›ç”±æ­¤ï¼Œå¤§å®¶ä¹Ÿè®¤ä¸ºåœ¨ SSD ä¸Š mmap çš„æ€§èƒ½ä¼˜åŠ¿ä¼šè¿›ä¸€æ­¥æ‰©å¤§ã€‚&lt;/li&gt;
&lt;li&gt;ä¸è¿‡å®éªŒæµ‹è¯•å‘ç°ï¼šå¯¹äºé«˜å¸¦å®½çš„äºŒçº§å­˜å‚¨è®¾å¤‡ï¼ˆæ¯”å¦‚ SSDï¼‰ï¼ŒDBMS ç®¡ç†çš„æ•°æ®é‡å¤§äºå†…å­˜ç©ºé—´æ—¶ï¼Œæ“ä½œç³»ç»Ÿçš„é¡µé©±é€æœºåˆ¶ï¼ˆpage eviction mechanismsï¼‰å¤šçº¿ç¨‹æ‰©å±•æ€§æ¯”è¾ƒå·®ï¼ˆå¤‡æ³¨ï¼šå› ä¸º SSD I/O å¸¦å®½å¤§ã€è®¿é—®é€Ÿåº¦å¿«ï¼Œé¡µé©±é€æœºåˆ¶å°±å¯èƒ½æˆäº†ç“¶é¢ˆï¼‰ï¼ˆwe have found that the OSâ€™s page eviction mechanisms cannot scale beyond a few threads for larger-thanmemory DBMS workloads on high-bandwidth secondary storage devices. We believe that one of the main reasons these performance issues have gone largely unnoticed is due to historically limited file I/O bandwidthï¼‰ã€‚ç“¶é¢ˆæºäº3ä¸ªå› ç´ ï¼š
&lt;ul&gt;&lt;li&gt;é¡µè¡¨äº‰ç”¨ï¼ˆpage table contentionï¼‰/ é”ï¼ˆå¤‡æ³¨ï¼šå½“å‰ linux å†…æ ¸å®ç°ä¼˜åŒ–äº†è¿™ä¸ªé—®é¢˜ï¼Œ&lt;a href=&apos;https://github.com/torvalds/linux/blob/master/Documentation/mm/split_page_table_lock.rst&apos;&gt;linux/split_page_table_lock.rst at master Â· torvalds/linux (github.com)&lt;/a&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;å•çº¿ç¨‹é¡µé©±é€ï¼ˆsingle-threaded page evictionï¼‰ï¼Œ&lt;a href=&apos;https://biriukov.dev/docs/page-cache/4-page-cache-eviction-and-page-reclaim/&apos;&gt;Page Cache eviction and page reclaim | Viacheslav Biriukov&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æ—è·¯è½¬æ¢ç¼“å†²å‡»è½ï¼ˆTLB shootdownsï¼‰ï¼šTLB shootdowns occur during page eviction when a core needs to invalidate mappings in a remote TLB. Whereas flushing the local TLB is inexpensive, issuing interprocessor interrupts to synchronize remote TLBs can take thousands of cycles
&lt;ul&gt;&lt;li&gt;&lt;a href=&apos;https://juejin.cn/post/6844904084957315086&apos;&gt;æ·±å…¥ç†è§£ Linux å†…æ ¸--jemalloc å¼•èµ·çš„ TLB shootdown åŠä¼˜åŒ– - æ˜é‡‘ (juejin.cn)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&apos;https://www.kernel.org/doc/html/v4.18/core-api/cachetlb.html&apos;&gt;Cache and TLB Flushing Under Linux â€” The Linux Kernel documentation&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å®éªŒåˆ†æï¼š&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;As a baseline, we used the fio storage benchmarking tool (v3.25) with direct I/O (O_DIRECT) to bypass the OS page cache. Our analysis focused exclusively on read-only workloads, which represent the best-case scenario for mmap-based DBMSs.&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2022/11/16/FlAJqH8E4K1UWvp.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;100%&apos;/&gt;
&lt;img src=&apos;https://s2.loli.net/2022/11/16/qhz3OQHlgaZ2YMn.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;600&apos;/&gt;
&lt;img src=&apos;https://s2.loli.net/2022/11/16/oczkfgLw9EMR1ue.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;600&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é‚£ä¹ˆï¼Œåˆ°åº•è¦ä¸è¦ä½¿ç”¨ mmap å‘¢ï¼Ÿç›´æ¥ä½¿ç”¨ ssdï¼Ÿè¿˜æ˜¯è‡ªå·±æä¸€ä¸ª buffer poolï¼Ÿ&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è®ºæ–‡ä½œè€…ç»™å‡ºè¿™æ ·çš„ç»“è®ºï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ä»¥ä¸‹æƒ…å†µä¸è¦ä½¿ç”¨ mmapï¼š
&lt;ul&gt;&lt;li&gt;éœ€è¦ä»¥äº‹åŠ¡å®‰å…¨çš„æ–¹å¼è¿›è¡Œæ›´æ–°æ“ä½œ&lt;/li&gt;
&lt;li&gt;å¸Œæœ›å¤„ç†ç¼ºé¡µé”™è¯¯æ—¶ä¸ä¼šé˜»å¡åœ¨æ…¢ I/O ä¸Šï¼Œæˆ–è€…å¸Œæœ›æ˜ç¡®æ§åˆ¶å“ªäº›æ•°æ®åº”è¯¥åœ¨å†…å­˜ä¸­&lt;/li&gt;
&lt;li&gt;å…³å¿ƒé”™è¯¯å¤„ç†ï¼Œä¹Ÿå¸Œæœ›å§‹ç»ˆè¿”å›æ­£ç¡®çš„æ•°æ®ç»“æœ&lt;/li&gt;
&lt;li&gt;è¦æ±‚åœ¨å¿«é€ŸæŒä¹…åŒ–å­˜å‚¨è®¾å¤‡ï¼ˆæ¯”å¦‚ SSDï¼‰ä¸Šè·å¾—é«˜åå&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;ä»¥ä¸‹æƒ…å†µå¯èƒ½åº”è¯¥ä½¿ç”¨ mmapï¼š
&lt;ul&gt;&lt;li&gt;å†…å­˜å¯ä»¥å®¹çº³æ•´ä¸ªæ•°æ®å·¥ä½œé›†ï¼ˆæˆ–è€…è¯´æ•´ä¸ªæ•°æ®åº“ï¼‰ï¼Œå¹¶ä¸”æ˜¯åªè¯»çš„å·¥ä½œè´Ÿè½½&lt;/li&gt;
&lt;li&gt;å¸Œæœ›å°†ä¸€ä¸ªäº§å“å¿«é€Ÿæ¨å‘å¸‚åœºï¼Œä¹Ÿä¸å…³æ³¨æ•°æ®ä¸€è‡´æ€§æˆ–è€…é•¿æœŸçš„å·¥ç¨‹æŠ€æœ¯å€º&lt;/li&gt;
&lt;li&gt;Otherwise, never ğŸ¤£ğŸ™ƒ&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å½©è›‹ï¼šè®ºæ–‡çš„å¥‡æ•°é¡µé¡µçœ‰  ğŸ˜‚&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2022/11/16/AIqHKTC213FYaxX.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;100&apos;/&gt;
&lt;h2&gt;2ã€&lt;a href=&apos;https://ayende.com/blog/196161-C/re-are-you-sure-you-want-to-use-mmap-in-your-database-management-system&apos;&gt;re: Are You Sure You Want to Use MMAP in Your Database Management System? &lt;/a&gt;&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ¬æ–‡ä½œè€…è®¤ä¸ºè‡ªå·±å®ç°ä¸€ä¸ªå†…å­˜åˆ†é¡µç®¡ç†å™¨/ç¼“å†²æ± æ¯”è¾ƒå¤æ‚ï¼Œä½¿ç”¨ mmap æ¥å®ç°å­˜å‚¨ç³»ç»Ÿä¼šå¾ˆå¿«ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸è¿‡åæ§½äº†åŸè®ºæ–‡æ²¡æœ‰ç»™å‡ºå¯ä¾›é€‰æ‹©çš„æ›¿ä»£æ–¹æ¡ˆï¼ŒåŸºå‡†æµ‹è¯•å’Œç»“è®ºä¹‹é—´ä¹Ÿæ²¡å¤ªå¤šç›¸å…³æ€§ï¼ˆcompares apples to camelsï¼‰ï¼Œä¹Ÿä½ä¼°äº†è‡ªå·±å®ç°ä¸€ä¸ªæ›¿ä»£ mmap çš„ç¼“å†²æ± çš„å¤æ‚æ€§ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸ç”¨ mmap çš„è¯ï¼Œè®ºæ–‡æåŠçš„é‚£äº›é—®é¢˜ï¼Œä¹Ÿæ˜¯è¦è§£å†³çš„ï¼ˆIf you arenâ€™t using mmap, on the other hand, you still need to handle all those issues. That is a key point that I believe isnâ€™t addressed in the paper. Solving those issues properly (and efficiently) is a seriously challenging task. Given that you are building a specialized solution, you can probably do better than the generic mmap, but it will absolutely have a cost. That cost is both in terms of runtime overhead as well as increased development time.ï¼‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åŸè®ºæ–‡çš„å®éªŒè¯´æ˜äº† mmap çš„æ€§èƒ½é—®é¢˜ï¼Œä½†æ˜¯æ¢ä¸ª buffer pool çš„å®ç°èƒ½ä¸èƒ½è·å¾—æ›´å¥½çš„æ€§èƒ½å‘¢ï¼Ÿè¯¥æ–‡ä½œè€…æŒæ‚²è§‚æ€åº¦ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å­˜å‚¨ç³»ç»Ÿå®é™…é¢å¯¹çš„å·¥ä½œè´Ÿè½½ä¸ä¼šæ˜¯å®Œå…¨çš„éšæœºè¯»ï¼ˆå†™ï¼‰æˆ–é¡ºåºæ‰«æï¼Œé€šå¸¸éƒ½å…·æœ‰ä¸€å®šçš„çƒ­ç‚¹æ•°æ®ï¼Œè¿™æ—¶ buffer pool çš„ä¼˜åŠ¿å°±ä¼šä½“ç°å‡ºæ¥ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å…³äºâ€œé—®é¢˜ 1 - äº‹åŠ¡å®‰å…¨æ€§â€ - ä¸ç”¨ mmapï¼Œè§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ¡ˆæ²¡ä»€ä¹ˆä¸åŒï¼ˆI donâ€™t actually care if the data is written to memory behind my back. What I care about is MVCC (a totally separate concern than buffer management). The fact that Iâ€™m copying the modified data to the side means that I Can support concurrent transactions with far greater ease.ï¼‰&lt;/li&gt;
&lt;li&gt;å…³äºâ€œé—®é¢˜ 2 - I/O åœé¡¿â€ - è¯¥æ–‡ä½œè€…è®¤ä¸ºç¡®å®ä¸ªé—®é¢˜ï¼ˆnot having control over the I/O means that you may incur a page fault at any timeï¼‰ï¼Œå¹¶ä¸”æ˜¯åŸºäº mmap çš„ç³»ç»Ÿè¦é¢å¯¹çš„æœ€å¤§é—®é¢˜ã€‚ä¸è¿‡å®é™…æƒ…å†µæ˜¯ linux ç³»ç»Ÿä¸­ io_uring ä¹‹å¤–çš„å¼‚æ­¥ I/O æ–¹æ¡ˆåœ¨æŸäº›æ—¶å€™å¼‚æ­¥æ“ä½œä¹Ÿä¼šæ˜¯é˜»å¡çš„ã€‚æ˜¯å¦ä½¿ç”¨ mmapï¼Œè¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆä¹Ÿæ²¡æœ‰æœ¬è´¨åŒºåˆ«ã€‚&lt;/li&gt;
&lt;li&gt;å…³äºâ€œé—®é¢˜ 3 - é”™è¯¯å¤„ç†â€ - è¯¥æ–‡ä½œè€…ä»¥è‡ªå·±å¼€å‘çš„ Voron ä¸ºä¾‹è¯´æ˜å³ä½¿ä½¿ç”¨ mmapï¼Œä¹Ÿå¯ä»¥è¾ƒå¥½åœ°å®ç°æ ¡éªŒå’Œæ£€æŸ¥ï¼ˆä½¿ç”¨ä¸€ä¸ª bitmap æ¥è®°å½•å“ªäº›å†…å­˜é¡µè¢«è®¿é—®è¿‡ï¼Œåœ¨ç¬¬ä¸€æ¬¡è®¿é—®æŸä¸ªå†…å­˜é¡µçš„æ—¶å€™æ£€æŸ¥æ ¡éªŒå’Œï¼‰ï¼Œå¹¶è®¤ä¸ºç¨‹åºä¸€æ¬¡è¿è¡Œè¿‡ç¨‹ä¸­å¯¹äºæŒ‡å®šçš„ä¸€ä¸ªå†…å­˜é¡µæ£€æŸ¥ä¸€æ¬¡å°±å¯ä»¥ï¼Œå…¶ä»–æƒ…å†µä¸‹çš„æ£€æŸ¥éƒ½æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚When you use read() to get data from the disk, you have no guarantees that the data wasnâ€™t fetched from a cache along the way. So you may validate the data you read is â€œcorrectâ€, while the on disk representation is broken. For that reason, we only do the check once, instead of each time. ğŸ¤” å¥½åƒä¸æ˜¯è¿™ä¸ªç†ï¼Ÿ
&lt;ul&gt;&lt;li&gt;è‡³äºå‘ç° I/O é”™è¯¯ï¼Œå¦‚ä½•å¤„ç†ï¼Ÿè¯¥æ–‡ä½œè€…è®¤ä¸ºç­”æ¡ˆåªæœ‰ä¸€ä¸ª - è®©å®ƒå´©æºƒç„¶åé‡æ–°æ¢å¤å¹¶è¿è¡Œï¼ˆCrash and then run recovery from scratchï¼‰ï¼Œå› ä¸ºå¦‚æœ I/O ç³»ç»Ÿè¿”å›äº†ä¸€ä¸ªé”™è¯¯ï¼Œåº”ç”¨é€»è¾‘ä¹Ÿä¸ä¼šæœ‰ä»»ä½•æ–¹å¼çŸ¥é“ I/O ç³»ç»Ÿçš„å½“å‰çŠ¶æ€æ˜¯ä»€ä¹ˆï¼Œåº”è¯¥æ€ä¹ˆè§£å†³ï¼Œå”¯ä¸€çš„æ–¹å¼å°±æ˜¯åœä¸‹æ¥ï¼Œé‡æ–°åŠ è½½ä¸€åˆ‡ï¼ˆåº”ç”¨ WAL è¿›è¡Œæ¢å¤ï¼‰ï¼Œå›åˆ°ä¸€ä¸ªç¨³å®šçŠ¶æ€ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;å…³äºâ€œé—®é¢˜ 4 - æ€§èƒ½é—®é¢˜â€ -
&lt;ul&gt;&lt;li&gt;é¡µè¡¨äº‰ç”¨ï¼ˆpage table contentionï¼‰ï¼šlinux å†…æ ¸å·²ä¼˜åŒ–è§£å†³&lt;/li&gt;
&lt;li&gt;å•çº¿ç¨‹é¡µé©±é€ï¼ˆsingle-threaded page evictionï¼‰ï¼šå¦‚æœå†™/æ›´æ–°é¢‘ç‡ä¸é«˜ï¼Œè„é¡µä¸å¤šçš„è¯ï¼Œä¹Ÿä¸ä¼šæˆä¸ºæ€§èƒ½ç“¶é¢ˆ&lt;/li&gt;
&lt;li&gt;&lt;a href=&apos;https://stackoverflow.com/questions/3748384/what-is-tlb-shootdown&apos;&gt;æ—è·¯è½¬æ¢ç¼“å†²å‡»è½ï¼ˆTLB shootdownsï¼‰&lt;/a&gt;ï¼šåœ¨ä¸€å®šæ¡ä»¶ä¸‹æ‰ä¼šæˆä¸ºæ€§èƒ½ç“¶é¢ˆï¼Œå½“ä½ çœŸçš„é‡åˆ°æ—¶åº”è¯¥ä¹Ÿä¼šå¤šèŠ±é’±ä¹°å†…å­˜æ¥è§£å†³ ğŸ¤£ğŸ™ƒï¼ˆIn order to actually observe the cost of TLS Shootdown in a significant manner, you need to have: (1) really fast I/O (2)working set that significantly exceeds memory (3) no other work that needs to be done for processing a request; In practice, if you have really fast I/O, you spent money on that, youâ€™ll more likely get more RAM as well. And you typically need to do something with the data you read, which means that you wonâ€™t notice the TLB shootdown as muchï¼‰&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;h2&gt;3ã€&lt;a href=&apos;https://www.usenix.org/system/files/conference/fast16/fast16-papers-lu.pdf&apos;&gt;WiscKey: Separating Keys from Values in SSD-Conscious Storage&lt;/a&gt; /   &lt;a href=&apos;https://dgraph.io/blog/post/badger/&apos;&gt;Introducing Badger: A fast key-value store written purely in Go&lt;/a&gt;&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;WiscKey æ˜¯ä¸€ä¸ªåŸºäº LSM (Log Structured Merge)æ ‘çš„ KV å­˜å‚¨å¼•æ“ï¼Œé’ˆå¯¹ SSD çš„éšæœºè¯»å’Œé¡ºåºè¯»æ€§èƒ½ç‰¹ç‚¹ï¼Œå°† Key å’Œ Value åˆ†å¼€å­˜å‚¨ï¼Œä»¥å°½å¯èƒ½ç¼©å° I/O æ”¾å¤§é—®é¢˜ï¼Œæå‡æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Value å­˜æ”¾åœ¨ Log æ–‡ä»¶ä¸­ï¼ŒLSM æ ‘ä»…å­˜å‚¨ Key å’Œ Value åœ¨ Log æ–‡ä»¶çš„ä½ç½®ä»¥åŠé•¿åº¦/å¤§å°ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äº Value æ¯”è¾ƒå¤§çš„åº”ç”¨åœºæ™¯ï¼Œæ€§èƒ½ä¼˜åŠ¿æ˜æ˜¾ã€‚&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2022/11/16/y84VKqJZWMSjBu7.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;500&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å› ä¸º LSM æ ‘ä¸å­˜å‚¨ Value æœ¬èº«ï¼Œé€šå¸¸æ¯”è¾ƒå°ï¼Œå¯ä»¥å…¨éƒ¨æ”¾åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥ä¸è€ƒè™‘è·å– Value çš„å€¼ï¼Œç‚¹æŸ¥å’ŒèŒƒå›´æŸ¥æ‰¾é€Ÿåº¦éå¸¸å¿«ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;LSM æ ‘æ¯”è¾ƒå°ï¼Œæ‰€ä»¥ Compaction æ¬¡æ•°å°‘ï¼Œé€Ÿåº¦å¿«ï¼ˆç‰¹åˆ«æ˜¯å¦‚æœæ•´ä¸ª LSM éƒ½æ”¾åœ¨å†…å­˜ä¸­çš„è¯ï¼‰ã€‚Compaction è¿‡ç¨‹ä¸­ä¸éœ€è¦è¯»å†™ Value çš„å€¼ï¼Œæ‰€ä»¥ I/O æ”¾å¤§å€æ•°è¦å°å¾ˆå¤šã€‚&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2022/11/16/2tvp5LROXG4UYrw.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;500&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç‚¹æŸ¥è¿‡ç¨‹ï¼Œä» LSM æ ‘ä¸­è·å– Value çš„ä½ç½®å’Œå¤§å°åï¼Œéœ€è¦ä» Value Log ä¸­è·å– Value å€¼ã€‚å› ä¸º LSM æ ‘å°ï¼Œæ‰€ä»¥è¯»æ”¾å¤§å€æ•°å°ï¼Œç»¼åˆèµ·æ¥çœ‹ï¼ŒWiscKey ç‚¹æŸ¥çš„æ€§èƒ½ä¼˜åŠ¿ä¾æ—§æ˜æ˜¾ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;èŒƒå›´æŸ¥æ‰¾/éå†è¿‡ç¨‹ï¼Œå…ˆä» LSM æ ‘ä¸­è·å¾—ç›®æ ‡èŒƒå›´å†…çš„æ‰€æœ‰ Value çš„ä½ç½®å’Œå¤§å°ï¼Œæ”¾å…¥é˜Ÿåˆ—ï¼Œä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œå¹¶å‘é¢„å–ï¼Œåˆ©ç”¨ SSD éšæœºè¯»çš„ååèƒ½åŠ›éšå¹¶å‘æ ‘è¿‘çº¿æ€§å¢é•¿çš„ç‰¹ç‚¹ã€‚&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2022/11/16/APbQlhq3nWsf47j.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;500&apos;/&gt;
&lt;img src=&apos;https://s2.loli.net/2022/11/16/j357k6XMfYO2udm.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;400&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Value Log ä¹Ÿéœ€è¦ GCï¼Œæ¸…ç†æ‰æ— ç”¨çš„ Value å€¼ã€‚LSM æ ‘çš„ Compaction ä¸»è¦æ˜¯ä¸ºäº†æå‡æŸ¥æ‰¾/æ£€ç´¢çš„æ€§èƒ½/æ•ˆç‡ï¼Œæ§åˆ¶è¯»æ”¾å¤§ï¼Œå‡å°‘å†…å­˜/ç£ç›˜ç©ºé—´å ç”¨æ˜¯æ¬¡è¦çš„ã€‚Value Log çš„ GC åˆ™ä¸»è¦æ˜¯ä¸ºäº†å‡å°‘å†…å­˜/ç£ç›˜ç©ºé—´å ç”¨ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸ºäº†å®ç°åœ¨çº¿çš„è½»é‡çº§ GCï¼ŒValue Log ä¸­ä¹Ÿå­˜å‚¨äº† Keyï¼Œ&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2022/11/16/JMKxWiaCovyhgr8.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;500&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;tail æŒ‡å‘ Value Log æœ‰æ•ˆå€¼èŒƒå›´å†…æ—¶åºä¸Šæœ€å…ˆå†™å…¥çš„é‚£ä¸ª value çš„ä½ç½®ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;head æŒ‡å‘ Value Log ä¸­ä¸‹ä¸€ä¸ªæ–° value å†™å…¥çš„ä½ç½®ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;tail å’Œ head åŠå…¶å¯¹åº”çš„ä½ç½®ä¿¡æ¯å‡ä½œä¸º kv å­˜å…¥ LSM æ ‘ä¸­ï¼ˆhead çš„æŒ‡å‘ä»€ä¹ˆæ—¶å€™ä¼šæ›´æ–°ï¼Ÿï¼šæ¯æ¬¡æœ‰æ–°å€¼å†™å…¥çš„æ—¶å€™éƒ½æ›´æ–°ï¼Ÿè¿˜æ˜¯åœ¨ GC çš„è¿‡ç¨‹ä¸­æ‰ä¼šæ›´æ–°ï¼Ÿï¼‰&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;GC çš„æµç¨‹ä¸ºï¼š&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;â‘  ä» tail æŒ‡å‘çš„ä½ç½®å¼€å§‹é¡ºåºæ‰«æä¸€å—æ•°æ®ï¼Œæ ¹æ®å…¶ä¸­çš„ key æ£€ç´¢ LSM æ ‘ï¼Œç¡®è®¤å½“å‰ value æ˜¯å¦æœ‰æ•ˆï¼ˆæ²¡æœ‰è¢«åˆ é™¤ä¹Ÿæ²¡æœ‰è¢«è¦†ç›–ï¼‰&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;â‘¡ å¦‚æœæœ‰æ•ˆåˆ™æ’å…¥åˆ° head æŒ‡å‘çš„ä½ç½®ï¼Œhead æŒ‡å‘ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªä½ç½®ï¼›å¦‚æœæ— æ•ˆï¼Œåˆ™ç›´æ¥ä¸¢å¼ƒ&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;â‘¢ ä¸€å—æ•°æ®å¤„ç†å®Œæˆåï¼Œç§»åŠ¨ tail æŒ‡å‘åˆ°ä¸‹ä¸€ä¸ªä½ç½®ï¼Œé‡Šæ”¾/å›æ”¶åŸæ¥æ•°æ®å—çš„å­˜å‚¨ç©ºé—´ï¼›ç„¶åç»§ç»­å¾ªç¯å¤„ç†&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;ç–‘é—®&lt;/strong&gt;ï¼š1. GC è¿‡ç¨‹ä¸­æ¯æ¬¡å‘ head æ’å…¥æœ‰æ•ˆå€¼æ—¶ï¼Œæ˜¯å¦å…ˆè¦ä» LSM æ ‘ä¸­æŸ¥è¯¢æœ€æ–°æŒ‡å‘çš„ä½ç½®ï¼Ÿ2. åœ¨æ ¹æ® key ä» LSM æ ‘æŸ¥è¯¢åå°†æœ‰æ•ˆå€¼å†™å…¥ head ä½ç½®å‰ï¼Œæœ‰æ–°æ•°æ®å†™å…¥çš„è¯ï¼Œæ€ä¹ˆå¤„ç†ï¼ŸGC æœŸé—´æ˜¯å¦è¦åœæ­¢æ­£å¸¸çš„å†™æ“ä½œï¼Ÿè¿˜æ˜¯è¯´å¯¹æŸä¸ªä¸´ç•ŒåŒºåŠ é”ï¼Ÿ&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;LSM æ ‘åŸç†ï¼š&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2022/11/16/k6cHFOUluo1Ibfp.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;500&apos;/&gt;
&lt;img src=&apos;https://s2.loli.net/2022/11/16/17WubUhqSpCjMr5.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;500&apos;/&gt;
&lt;img src=&apos;https://s2.loli.net/2022/11/16/Tomk3VOEs7jduQl.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;500&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;a href=&apos;https://zhuanlan.zhihu.com/p/181498475&apos;&gt;LSMæ ‘è¯¦è§£ - çŸ¥ä¹ (zhihu.com)&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;4ã€&lt;a href=&apos;http://www.vldb.org/pvldb/vol14/p364-didona.pdf&apos;&gt;Toward a Better Understanding and Evaluation of Tree Structures on Flash SSDsï¼ˆVLDBï¼‰&lt;/a&gt;&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;PTS - Persistent tree data structure&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½¿ç”¨ LSM æ ‘ï¼ˆRocksDBï¼‰å’Œ B+ æ ‘ï¼ˆWiredTigerï¼‰æ¥åˆ†æ SSD åŸºå‡†æµ‹è¯•ï¼ˆBenchmarkingï¼‰ä¸­å¯èƒ½è¸©åˆ°çš„ 7 ä¸ªå‘ï¼ˆpitfallï¼‰ï¼š&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;ï¼ˆ1ï¼‰Running short tests / æµ‹è¯•è¿‡äºçŸ­å¹³å¿«&lt;/strong&gt; âš¡ï¸&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;éšç€ä½¿ç”¨æ—¶é—´çš„å¢åŠ ï¼ŒSSD çš„æ€§èƒ½ä¼šä¸€å®šçš„åŠ¨æ€å˜åŒ–ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Because both the PTS and SSD performance vary over time, short-lived tests are unable to capture how the systems will behave under a continuousï¼ˆnon-burstyï¼‰workload.&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2022/11/16/HSuzIeC8itjndGw.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;500&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;WA-Aï¼ˆåº”ç”¨/å­˜å‚¨ç³»ç»Ÿçš„å†™æ”¾å¤§ï¼‰ increases over time while the levels of the LSM-Tree fills up, and its curve flattens once the layout of the LSM tree has stabilized.&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;WA-Dï¼ˆSSD è®¾å¤‡çš„å†™æ”¾å¤§ï¼‰ increases over time because of the effect of garbage collection.&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;ï¼ˆ2ï¼‰Ignoring the device write amplification (WA-D) / å¿½è§†äº† SSD è®¾å¤‡æœ¬èº«çš„å†™æ”¾å¤§&lt;/strong&gt; âš¡ï¸&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;WA-D directly affects the throughput of the device, which strongly correlates with the application-level throughput.&lt;/li&gt;
&lt;li&gt;WA-D is an essential measure of the I/O efficiency of a PTS. ç«¯åˆ°ç«¯çš„å†™æ”¾å¤§å€æ•°åº”è¯¥æ˜¯ WA-A ä¹˜ä»¥ WA-D&lt;/li&gt;
&lt;li&gt;WA-D measures the flash-friendliness of a PTS.
&lt;ul&gt;&lt;li&gt;A low WA-D indicates that a PTS generates a write access that does not incur much garbage collection overhead in the SSD.&lt;/li&gt;
&lt;li&gt;ä»¥å‰å¤§å®¶å¯èƒ½è®¤ä¸º LSM æ ‘ï¼ˆé¡ºåºå†™ï¼‰ç›¸æ¯” B+ æ ‘ï¼ˆéšæœºå†™ï¼‰å¯¹ SSD æ›´å‹å¥½ï¼Œä½†å®æµ‹ WA-D é¢ è¦†äº†è¿™ä¸ªè®¤çŸ¥&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;ï¼ˆ3ï¼‰Ignoring the internal state of the SSD / å¿½è§†äº† SSD çš„åˆå§‹å†…éƒ¨çŠ¶æ€&lt;/strong&gt; âš¡ï¸&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2022/11/16/pFyqSCVZnrHB1g9.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;100%&apos;/&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;Trim(Discard)çš„å‡ºç°ä¸»è¦æ˜¯ä¸ºäº†æé«˜GCçš„æ•ˆç‡ä»¥åŠå‡å°‘å†™å…¥æ”¾å¤§çš„å‘ç”Ÿï¼Œæœ€å¤§ä½œç”¨æ˜¯æ¸…ç©ºå¾…åˆ é™¤çš„æ— æ•ˆæ•°æ®&lt;/strong&gt;ã€‚åœ¨SSDæ‰§è¡Œè¯»ã€æ“¦ã€å†™æ­¥éª¤çš„æ—¶å€™ï¼Œé¢„å…ˆæŠŠæ“¦é™¤çš„æ­¥éª¤å…ˆåšäº†ï¼Œè¿™æ ·æ‰èƒ½å‘æŒ¥å‡ºSSDçš„æ€§èƒ½ï¼Œé€šå¸¸SSDæ‰é€Ÿå¾ˆå¤§ä¸€éƒ¨åˆ†åŸå› å°±æ˜¯å¾…åˆ é™¤çš„æ— æ•ˆæ•°æ®å¤ªå¤šï¼Œæ¯æ¬¡å†™å…¥çš„æ—¶å€™ä¸»æ§éƒ½è¦å…ˆåšæ¸…ç©ºå¤„ç†ï¼Œæ‰€ä»¥æ€§èƒ½å—åˆ°äº†é™åˆ¶ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;The steady-state performance of a PTS can greatly differ depending on the initial state of the drive, this is surprising.&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;This phenomenon is caused by how the LBA (logic block address)  access patterns of RocksDB and WiredTiger intertwine with the SSD garbage collection mechanism as a function of the initial state the drive.&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;WiredTiger only writes to a limited portion of the logical block address space.&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;ï¼ˆ4ï¼‰Ignore the dataset size / å¿½è§†äº†æ•°æ®é›†å¤§å°&lt;/strong&gt;&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2022/11/16/SlVWJfP5rO7xpNQ.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;100%&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;The amount of data stored by the SSD changes its behavior and affects overall performance.&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;The performance degradation brought by the larger dataset is primarily due to the idiosyncrasiesï¼ˆç‰¹è´¨/ç‰¹ç‚¹ï¼‰ of the SSD: larger datasets lead to more valid pages in each flash block, which increases the amount of data being relocated upon performing garbage collection, i.e., the WA-D&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;ï¼ˆ5ï¼‰Ignoring the extra storage capacity a PTS needs to manage data and store additional meta-data / æœªè€ƒè™‘ç©ºé—´æ”¾å¤§ï¼ˆSpace amplificationï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ¶‰åŠå­˜å‚¨æˆæœ¬&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;ï¼ˆ6ï¼‰Ignoring SSD over-provisioning&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆæœ¬ä¸æ€§èƒ½ä¹‹é—´çš„æƒè¡¡æŠ˜ä¸­ - å¯ä»¥é¢„ç•™ä¸€éƒ¨åˆ† SSD ç©ºé—´ç»™ SSD åš GC ä½¿ç”¨ï¼Œè¿™éƒ¨åˆ†ç©ºé—´å¯¹æ–‡ä»¶ç³»ç»Ÿä¸å¯è§ã€‚&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2022/11/16/YEFp5g69mnqBe3w.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;100%&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;ï¼ˆ7ï¼‰Ignoring the effect of the underlying storage technology on performance&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;5ã€SSD åŸç†ç›¸å…³èµ„æ–™&lt;/h2&gt;
&lt;ul&gt;&lt;li&gt;&lt;a href=&apos;https://zhuanlan.zhihu.com/p/102089411&apos;&gt;æµ…è°ˆåˆ†å¸ƒå¼å­˜å‚¨ä¹‹SSDåŸºæœ¬åŸç† - çŸ¥ä¹ (zhihu.com)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&apos;https://mp.weixin.qq.com/s/_uiCsFXWjepeHSdgiUABhg&apos;&gt;èŠèŠ SSD çš„åŸºæœ¬åŸç† (qq.com)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&apos;http://xiongduo.cn/posts/coding-for-ssds-part-1-introduction-and-table-of-contents.html&apos;&gt;ä¸ºSSDç¼–ç¨‹ï¼ˆ1ï¼‰ï¼šç®€ä»‹å’Œç›®å½• (xiongduo.cn)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&apos;http://www.ssdfans.com/?p=8077&apos;&gt;SSDèƒŒåçš„ç§˜å¯†ï¼šSSDåŸºæœ¬å·¥ä½œåŸç† (ssdfans.com)&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;</description>
            <pubDate>2022-09-14</pubDate>
            <link>https://blog.xiayf.cn/posts/reading-about-mmap-ssd.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/reading-about-mmap-ssd.html</guid>
        </item>
        
        <item>
            <title>Disruptor ç­‰å¾…ç­–ç•¥å¼•å‘çš„ CPU è´Ÿè½½å¼‚å¸¸é—®é¢˜</title>
            <description>&lt;h2&gt;èƒŒæ™¯&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å·¥ä½œä¸­ï¼Œæˆ‘è´Ÿè´£çš„ç³»ç»Ÿæ˜¯ä¸€ä¸ªæ•°æ®æµå¤„ç†æœåŠ¡ - ä»¥æµæ°´çº¿ï¼ˆpipelineï¼‰çš„å½¢å¼åˆ†å¤šçº§å¼‚æ­¥å¤„ç†ï¼š&lt;/p&gt;
&lt;img src=&apos;https://i.loli.net/2020/07/14/ONwUsrlhLmIq8BW.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;100%&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å…¶ä¸­çš„ é˜Ÿåˆ— å®é™…ä½¿ç”¨çš„æ˜¯ &lt;a href=&apos;https://github.com/LMAX-Exchange/disruptor&apos;&gt;Disruptor&lt;/a&gt;ï¼Œå¤šç”Ÿäº§è€…å•æ¶ˆè´¹è€…æ¨¡å¼ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;ThreadFactory factory = new ThreadFactoryBuilder().setNameFormat(name).setDaemon(true).build();
Disruptor&amp;amp;lt;Event&amp;amp;lt;T&amp;amp;gt;&amp;amp;gt;  disruptor = new Disruptor&amp;amp;lt;&amp;amp;gt;(Event&amp;amp;lt;T&amp;amp;gt;::new, bufferSize, factory, ProducerType.MULTI, new SleepingWaitStrategy());
disruptor.handleEventsWith((Event&amp;amp;lt;T&amp;amp;gt; event, long sequence, boolean endOfBatch) -&amp;amp;gt; {
    consumer.accept(event.value, endOfBatch);
    event.value = null;
});&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœåŠ¡è¿è¡Œåœ¨ k8s é›†ç¾¤ä¸Šï¼Œæ¯ä¸ªå®¹å™¨èŠ‚ç‚¹ä¸Šå¯èƒ½ä¼šè¿è¡Œå¤šä¸ª pipelineï¼Œä¹Ÿå³æ„å‘³ç€å•ä¸ªèŠ‚ç‚¹ä¸Šä¼šå­˜åœ¨å¤šä¸ª disruptor å®ä¾‹ã€‚&lt;/p&gt;
&lt;h2&gt;ç°è±¡&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿‘æœŸçªç„¶æ”¶åˆ°æµ‹è¯•ç¯å¢ƒå¾ˆå¤šèŠ‚ç‚¹ï¼ˆç”Ÿäº§ç¯å¢ƒä¹Ÿæœ‰å°‘é‡èŠ‚ç‚¹ï¼‰çš„ CPU ä½¿ç”¨ç‡å‘Šè­¦ - CPU ä½¿ç”¨ç‡æŒç»­ 5 åˆ†é’Ÿä»¥ä¸Šè¶…è¿‡ 90%ï¼Œå¦‚ä¸‹å…¶ä¸­ä¸€ä¸ªä»»åŠ¡èŠ‚ç‚¹çš„ CPU ä½¿ç”¨ç‡ç›‘æ§å›¾ï¼š&lt;/p&gt;
&lt;img src=&apos;https://i.loli.net/2020/07/14/XJVsiMI3b9m5dlB.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;100%&apos;/&gt;
&lt;img src=&apos;https://i.loli.net/2020/07/14/2YwPQAqaICr879x.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;100%&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;cpu.busy = cpu.system + cpu.user + è½¯/ç¡¬ä¸­æ–­&lt;/code&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ³¨æ„å…¶ä¸­ &lt;code&gt;cpu.system&lt;/code&gt; æ¯” &lt;code&gt;cpu.user&lt;/code&gt; é«˜ä¸å°‘ï¼Œ&lt;code&gt;cpu.busy&lt;/code&gt; åˆæ¯” &lt;code&gt;cpu.system&lt;/code&gt; é«˜ä¸å°‘ã€‚ä¹Ÿå³ CPU æ—¶é—´ç‰‡èµ„æºä¸»è¦æ¶ˆè€—åœ¨ å†…æ ¸æ€ å’Œä¸­æ–­é€»è¾‘ä¸Šï¼ˆå¯¹äºè¿™äº›ä»»åŠ¡è€Œè¨€ &lt;code&gt;cpu.user&lt;/code&gt; æŒ‡æ ‡ä¹Ÿæ˜¯å¼‚å¸¸çš„ï¼‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™äº›èŠ‚ç‚¹è¿è¡Œçš„ä»»åŠ¡ï¼Œå‡ ä¹æ²¡æœ‰æ•°æ®éœ€è¦å¤„ç†ï¼Œä¹Ÿå°±æ˜¯è¯´å‡ ä¹æ˜¯ç©ºè·‘çš„ã€‚ä»çº¿ç¨‹æ•°é‡ç›‘æ§ä»¥åŠ jstack è¾“å‡ºçš„å †æ ˆè·Ÿè¸ªä¿¡æ¯ï¼Œä¹Ÿæœªå‘ç°æ˜æ˜¾å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;h2&gt;åŸå› æ’æŸ¥&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å°†æµ‹è¯•ç¯å¢ƒçš„ä»»åŠ¡åœ¨æœ¬åœ°ç¯å¢ƒè¿è¡Œèµ·æ¥ï¼Œå¹¶åŸºäº &lt;a href=&apos;https://www.lightbend.com/blog/profiling-jvm-applications&apos;&gt;How to profile JVM applications&lt;/a&gt; ä¸€æ–‡ä¸­æåˆ°çš„ç«ç„°å›¾å·¥å…·ï¼Œäº§å‡ºå¯¹åº” JVM åº”ç”¨çš„ç«ç„°å›¾ï¼š&lt;/p&gt;
&lt;img src=&apos;https://i.loli.net/2020/07/14/zQMWsBeKbuZLamN.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;100%&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä»å›¾ä¸­å¯ä»¥å¤§è‡´çœ‹å‡ºå…¶ä¸­ &lt;code&gt;com/lmax/disruptor/SleepingWaitStrategy:::waitFor&lt;/code&gt; / &lt;code&gt;jdk/internal/misc/Unsafe:::park&lt;/code&gt; æ¯”è¾ƒå¯ç–‘ï¼Œåœ¨è°ƒç”¨æ ˆä¸­è€—æ—¶æœ€é•¿ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä»é¡¹ç›®æºç å’Œ jstack è¾“å‡ºçš„å †æ ˆè·Ÿè¸ªä¿¡æ¯å¯ä»¥çœ‹åˆ°ï¼Œæµ‹è¯•ä»»åŠ¡ä¸­å¤§è‡´æ¶‰åŠ 18ä¸ª disruptor å®ä¾‹ï¼Œå‡ä½¿ç”¨ &lt;code&gt;SleepingWaitStrategy&lt;/code&gt; ç­‰å¾…ç­–ç•¥ï¼Œè¯¥ç­–ç•¥çš„ &lt;a href=&apos;https://github.com/LMAX-Exchange/disruptor/blob/master/src/main/java/com/lmax/disruptor/SleepingWaitStrategy.java#L56&apos;&gt;waitFor&lt;/a&gt; æ–¹æ³•å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;public long waitFor(final long sequence, Sequence cursor, final Sequence dependentSequence, final SequenceBarrier barrier) throws AlertException {
    long availableSequence;
    // é»˜è®¤ 200
    int counter = retries;

    while ((availableSequence = dependentSequence.get()) &amp;amp;lt; sequence) {
      counter = applyWaitMethod(barrier, counter);
    }

    return availableSequence;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;waitFor æ–¹æ³•ä¸­æ ¸å¿ƒè°ƒç”¨äº† &lt;a href=&apos;https://github.com/LMAX-Exchange/disruptor/blob/master/src/main/java/com/lmax/disruptor/SleepingWaitStrategy.java#L76&apos;&gt;applyWaitMethod&lt;/a&gt; ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;private int applyWaitMethod(final SequenceBarrier barrier, int counter) throws AlertException {
    barrier.checkAlert();

    if (counter &amp;amp;gt; 100)
    {
        --counter;
    }
    else if (counter &amp;amp;gt; 0)
    {
        --counter;
        Thread.yield();
    }
    else
    {
        // sleepTimeNs é»˜è®¤ 100
        // é—´æ¥è°ƒç”¨  jdk/internal/misc/Unsafe:::park æ–¹æ³•
        LockSupport.parkNanos(sleepTimeNs);
    }

    return counter;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;a href=&apos;https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/LockSupport.html#parkNanos-long-&apos;&gt;LockSupport.parkNanos&lt;/a&gt; æ–¹æ³•çš„ä½œç”¨ç®€å•è€Œè¨€å³è®©å½“å‰çº¿ç¨‹ç¡çœ  sleepTimeNs çº³ç§’ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Disruptor ä½œä¸ºä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œè‡ªå¸¦ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± çš„çº¿ç¨‹å·¥å‚å³æ„é€ æ–¹æ³•ä¼ å…¥çš„ factoryï¼Œçº¿ç¨‹æ•°é‡ç­‰äº &lt;a href=&apos;https://github.com/LMAX-Exchange/disruptor/blob/master/src/main/java/com/lmax/disruptor/dsl/Disruptor.java#L165&apos;&gt;disruptor.handleEventsWith&lt;/a&gt; è°ƒç”¨æ—¶ä¼ å…¥çš„å›è°ƒæ–¹æ³•æ•°é‡ï¼ŒhandleEventsWith çš„å‚æ•°æ•°é‡ä¸å®š:&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;public final EventHandlerGroup&amp;amp;lt;T&amp;amp;gt; handleEventsWith(final EventHandler&amp;amp;lt;? super T&amp;amp;gt;... handlers)&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;18ä¸ª Disruptor å®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹ä¸æ–­æ£€æŸ¥é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰æ–°çš„ &lt;code&gt;Event&amp;lt;T&amp;gt;&lt;/code&gt; ä»»åŠ¡éœ€è¦å¤„ç†ï¼Œå¦‚æœæœ‰ï¼Œåˆ™è°ƒç”¨ EventHandler å›è°ƒæ–¹æ³•è¿›è¡Œå¤„ç†ï¼Œå¦åˆ™ç¡çœ  sleepTimeNs çº³ç§’ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åˆ°æ­¤ï¼Œç»“åˆç›‘æ§æŒ‡æ ‡ï¼Œå¯ä»¥å¤§è‡´çŒœæµ‹ï¼šç”±äº sleepTimeNs è¾ƒå°ï¼Œå¯¼è‡´å¤šä¸ªçº¿ç¨‹çš„çŠ¶æ€ä¸æ–­åœ¨ &lt;code&gt;è¿è¡Œ&lt;/code&gt;ã€&lt;code&gt;ç¡çœ &lt;/code&gt;ã€&lt;code&gt;ç­‰å¾…è°ƒåº¦&lt;/code&gt; ä¹‹é—´åˆ‡æ¢ï¼Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢éå¸¸é¢‘ç¹ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å›´ç»• LockSupport.parkNanos ç¼–å†™ä¸€ä¸ªæµ‹è¯•ç¨‹åºï¼Œæ¥å¤ç°è¿™ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;import java.util.concurrent.CountDownLatch;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.concurrent.locks.LockSupport;

public class Test {

  public static void main(String[] args) throws InterruptedException {
    ExecutorService tp = Executors.newFixedThreadPool(18);
    for (int idx = 0; idx &amp;amp;lt; 18; idx++) {
      tp.submit(() -&amp;amp;gt; {
        while (true) {
          LockSupport.parkNanos(100);
        }
      });
    }
    CountDownLatch wg = new CountDownLatch(1);
    wg.await();
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨ 3.2 GHz 6-Core Intel Core i7 é…ç½® macOS ç³»ç»Ÿä¸­ï¼Œè¿™ä¸ªæµ‹è¯•ç¨‹åºå¯ä»¥ç¨³å®šåœ°å°† CPU ä½¿ç”¨ç‡æ§åˆ¶åœ¨ 700%+ï¼Œå¦‚ä¸‹ &lt;code&gt;top -pid [æµ‹è¯•ç¨‹åºçš„è¿›ç¨‹ id]&lt;/code&gt; å‘½ä»¤çš„è¾“å‡ºï¼š&lt;/p&gt;
&lt;img src=&apos;https://i.loli.net/2020/07/14/Z6jixvuWY1yTnL4.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;100%&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å…¶ä¸­ CSW ä¸ºçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¬¡æ•°ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ—¢ç„¶é—®é¢˜åŸå› åœ¨äºå¤šä¸ªçº¿ç¨‹é¢‘ç¹ç¡çœ å¯¼è‡´ï¼Œé‚£ä¹ˆè§£å†³æ–¹æ¡ˆä¹Ÿæ¯”è¾ƒç®€å•ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;ä½¿ç”¨æ›´å¤§çš„å€¼æ¥æ›¿æ¢ sleepTimeNs é»˜è®¤å€¼ï¼š&lt;code&gt;new Disruptor&amp;lt;&amp;gt;(Event&amp;lt;T&amp;gt;::new, bufferSize, factory, ProducerType.MULTI, new SleepingWaitStrategy(200, 1000 * 1000 / 10)); // 0.1 ms&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å…¶ä»–ç­‰å¾…ç­–ç•¥ï¼ˆWaitStrategyï¼‰ï¼Œæ¯”å¦‚ï¼š&lt;code&gt;com.lmax.disruptor.BlockingWaitStrategy&lt;/code&gt;&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸è¿‡è§£å†³æ–¹æ¡ˆä¹Ÿæœ‰å¾®å°çš„è´Ÿä½œç”¨ - éƒ¨åˆ†æ–°ä»»åŠ¡/&lt;code&gt;Event&amp;lt;T&amp;gt;&lt;/code&gt;å®ä¾‹çš„å¤„ç†æ—¶å»¶ä¼šå¢å¤§ï¼Œä½†åœ¨æˆ‘ä»¬çš„æ•°æ®æµå¤„ç†åœºæ™¯ä¸‹ï¼Œè¿™ç‚¹æ—¶å»¶å¢å¤§å¯¹ä¸šåŠ¡å®Œå…¨æ²¡æœ‰å½±å“ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸è¿‡ï¼Œè¿™ä¸ªé—®é¢˜åº”è¯¥æ˜¯ä¸€ç›´å­˜åœ¨ï¼Œä¸ºä»€ä¹ˆè¿‘æœŸæ‰æ”¶åˆ°å‘Šè­¦ï¼Œä¸ºä»€ä¹ˆä»¥å‰ä»ç›‘æ§ä¸Šæœªå‘ç°ï¼Ÿ&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;ä¸ºä»€ä¹ˆè¿‘æœŸæ‰æ”¶åˆ°å‘Šè­¦ï¼Ÿå› ä¸ºè¿™ä¸ªç›‘æ§å‘Šè­¦æ˜¯è¿‘æœŸå…¬å¸ç›‘æ§å¹³å°æ‰ç»Ÿä¸€é…ç½®çš„&lt;/li&gt;
&lt;li&gt;ä¸ºä»€ä¹ˆä»¥å‰ä»ç›‘æ§ä¸Šæœªå‘ç°ï¼Ÿå› ä¸ºå…¬å¸åˆ‡æ¢äº†æ–°çš„ç›‘æ§å¹³å°ï¼Œè€çš„ç›‘æ§å¹³å°æ²¡æœ‰ cpu.busy è¿™ä¸ªæŒ‡æ ‡ï¼Œè€Œè¿™äº›æ²¡ä»€ä¹ˆæ•°æ®è¦å¤„ç†çš„ä»»åŠ¡é•¿æ—¶é—´ä¸éœ€è¦å¼€å‘ç»´æŠ¤ï¼Œä¹Ÿå°±æœªå¾—åˆ°åŠæ—¶å…³æ³¨ã€‚&lt;/li&gt;&lt;/ol&gt;
&lt;h2&gt;æ‰©å±•èµ„æ–™&lt;/h2&gt;
&lt;ol&gt;&lt;li&gt;ä¸Šä¸‹æ–‡åˆ‡æ¢è€—æ—¶å¤šå°‘ï¼Ÿ&lt;a href=&apos;https://blog.tsunanet.net/2010/11/how-long-does-it-take-to-make-context.html&apos;&gt;How long does it take to make a context switch?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;LockSupport.parkNanos(100)&lt;/code&gt; çœŸçš„å°±æ˜¯ç¡çœ  100 çº³ç§’å—ï¼Ÿ&lt;a href=&apos;https://hazelcast.com/blog/locksupport-parknanos-under-the-hood-and-the-curious-case-of-parking/&apos;&gt;LockSupport.parkNanos() Under the Hood and the Curious Case of Parking&lt;/a&gt;&lt;/li&gt;&lt;/ol&gt;</description>
            <pubDate>2020-07-14</pubDate>
            <link>https://blog.xiayf.cn/posts/disruptor-wait-strategy-cpu-busy.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/disruptor-wait-strategy-cpu-busy.html</guid>
        </item>
        
        <item>
            <title>å¦‚ä½•å‰–æ JVM åº”ç”¨ï¼ˆè¯‘ï¼‰</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;åŸæ–‡ï¼š&lt;a href=&apos;https://www.lightbend.com/blog/profiling-jvm-applications&apos;&gt;How to profile JVM applications&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Hi å¤§å®¶å¥½ã€‚å·¥å…·å›¢é˜Ÿï¼ˆtooling teamï¼‰è¿‘æœŸçš„ä¸€ä¸ªå…³æ³¨ç‚¹æ˜¯æ”¹è¿› sbt è´¡çŒ®æµç¨‹ï¼ˆ improvement of the contribution process to sbtï¼‰ã€‚æˆ‘ä»¬ä¸€ç›´åœ¨æ€è€ƒçš„å¦ä¸€ä¸ªäº‹æƒ…æ˜¯ sbt çš„æ€§èƒ½ã€‚ä¸ºä¸€ä¸¾è§£å†³è¿™ä¸¤ä»¶äº‹æƒ…ï¼Œæˆ‘è°ƒç ”äº† Jason Zauggã€Johannes Rudolph è¿™äº›äººå¦‚ä½•å‰–æ JVM åº”ç”¨ï¼Œè¿™ç¯‡æ–‡ç« å³æ˜¯è°ƒç ”ç»“æœã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™é‡Œè®ºè¿°çš„æŠ€æœ¯åº”è¯¥å¯ä»¥åº”ç”¨äºJava å’Œ Scalaï¼Œä¹ŸåŸºæœ¬ä¸ä½ ä½¿ç”¨çš„å·¥å…·æ— å…³ã€‚&lt;/p&gt;
&lt;h2&gt;ç«ç„°å›¾ï¼ˆä½¿ç”¨ async-profiler ç”Ÿæˆï¼‰&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å‰–æ JVM åº”ç”¨çš„æ–¹å¼æœ‰å¤šç§ï¼Œä½†æ–°æ™‹çƒ­é—¨æ˜¯Netflix é«˜çº§æ€§èƒ½æ¶æ„å¸ˆï¼ˆSenior Performance Architectï¼‰Brendan Gregg å‘æ˜çš„&lt;strong&gt;ç«ç„°å›¾&lt;/strong&gt;ã€‚å¼€å‘è€…å…ˆæ”¶é›†å †æ ˆè¸ªè¿¹æŠ½æ ·æ•°æ®ï¼ˆstack trace samplesï¼‰ï¼Œç„¶åå°†å…¶å¤„ç†æˆä¸€å¼ äº¤äº’å¼çš„ svg å›¾ã€‚è‹¥è¦å¿«é€Ÿäº†è§£ç«ç„°å›¾ï¼Œå¯é˜…è¯»å¦‚ä¸‹é“¾æ¥èµ„æ–™ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;a href=&apos;https://www.youtube.com/watch?v=ugRrFdda_JQ&apos;&gt;Using FlameGraphs To Illuminate The JVM by Nitsan Wakart&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&apos;https://www.youtube.com/watch?v=D53T1Ejig1Q&apos;&gt;USENIX ATC â€™17: Visualizing Performance with Flame Graphs&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘æ¨èçš„ç¬¬ä¸€ä¸ªç«ç„°å›¾å·¥å…·æ˜¯  Andrei Pangin å‘èµ·çš„ async-profilerï¼Œåœ¨ macOS å’Œ Linux æ“ä½œç³»ç»Ÿç¯å¢ƒä¸‹å‡å¯ä½¿ç”¨ï¼Œä¸Šæ‰‹ä½¿ç”¨ä¹Ÿæ›´ç®€å•ã€‚&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;ä¸‹è½½å®‰è£…å™¨ &lt;a href=&apos;https://github.com/jvm-profiling-tools/async-profiler/releases/tag/v1.2&apos;&gt;async-profiler 1.2&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å‡è®¾ä½ çš„ç³»ç»Ÿä¸­å­˜åœ¨ä¸€ä¸ªå‘½ä»¤æŸ¥æ‰¾è·¯å¾„ &lt;code&gt;$HOME/bin&lt;/code&gt;ï¼Œåœ¨ &lt;code&gt;$HOME/bin&lt;/code&gt; ç›®å½•ä¸‹åˆ›å»ºç¬¦å·é“¾æ¥æŒ‡å‘ &lt;code&gt;build/&lt;/code&gt; å’Œ &lt;code&gt;profiler.sh&lt;/code&gt;&lt;/li&gt;&lt;/ol&gt;
&lt;pre class=&quot;language-bash&quot;&gt;&lt;code&gt;ln -s ~/App/async-profiler/profiler.sh $HOME/bin/profiler.sh
ln -s ~/App/async-profiler/build $HOME/bin/build&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ¥ä¸‹æ¥ï¼Œå…³é—­æ‰€æœ‰ Java åº”ç”¨ï¼Œä»¥åŠä»»ä½•å¯èƒ½å½±å“å‰–æè¿‡ç¨‹çš„ä¸œè¥¿ï¼Œæ¯”å¦‚ Slackï¼Œç„¶ååœ¨ç»ˆç«¯ç¨‹åºï¼ˆterminalï¼‰ä¸­è¿è¡Œä½ çš„åº”ç”¨ã€‚å¯¹äºæˆ‘è€Œè¨€ï¼Œåˆ™æ˜¯å°è¯•å‰–æ &lt;code&gt;sbt&lt;/code&gt; çš„åˆå§‹åŒ–åŠ è½½è¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ sbt exit&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­ï¼Œè¿è¡Œï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ jps
92746 sbt-launch.jar
92780 Jps&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç”±æ­¤æˆ‘ä»¬çŸ¥é“åº”ç”¨çš„è¿›ç¨‹ IDã€‚å¯¹äºæˆ‘è€Œè¨€ï¼Œç›®æ ‡è¿›ç¨‹ ID æ˜¯ &lt;code&gt;92746&lt;/code&gt;ã€‚åœ¨åº”ç”¨è¿è¡Œçš„åŒæ—¶ï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ profiler.sh -d 60 &amp;amp;lt;process id&amp;amp;gt;
Started [cpu] profiling
--- Execution profile ---
Total samples:         31602
Non-Java:              3239 (10.25%)
GC active:             46 (0.15%)
Unknown (native):      14667 (46.41%)
Not walkable (native): 3 (0.01%)
Unknown (Java):        433 (1.37%)
Not walkable (Java):   8 (0.03%)
Thread exit:           1 (0.00%)
Deopt:                 9 (0.03%)

Frame buffer usage:    55.658%

Total: 1932000000 (6.11%)  samples: 1932
  [ 0] java.lang.ClassLoader$NativeLibrary.load
  [ 1] java.lang.ClassLoader.loadLibrary0
  [ 2] java.lang.ClassLoader.loadLibrary
  [ 3] java.lang.Runtime.loadLibrary0
  [ 4] java.lang.System.loadLibrary
....&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å‘½ä»¤ä¼šè¾“å‡ºä¸€å¤§å †æœ‰ç”¨çš„å †æ ˆè·Ÿè¸ªä¿¡æ¯ï¼ˆstacktracesï¼‰ï¼Œä¸ºå°†è¿™äº›ä¿¡æ¯å¯è§†åŒ–ä¸ºä¸€å¼ ç«ç„°å›¾ï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;profiler.sh -d 60 -f /tmp/flamegraph.svg &amp;amp;lt;process id&amp;amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å‘½ä»¤æœ€ååº”è¯¥ä¼šäº§å‡ºæ–‡ä»¶ &lt;code&gt;/tmp/flamegraph.svg&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;img src=&apos;https://i.loli.net/2020/07/13/dZVkB9xq2Gy6NfA.png&apos; title=&apos;flamegraph&apos; alt=&apos;flamegraph&apos; width=&apos;100%&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½ è‡ªå·±æ¥ä½“éªŒä¸€ä¸‹ &lt;a href=&apos;https://downloads.lightbend.com/website/blog/2019/flamegraph.svg?_ga=2.187105832.1642569835.1594378538-197429397.1594378538&apos;&gt;flamegraph.svg&lt;/a&gt; è¾“å‡ºçš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h2&gt;ç«ç„°å›¾ï¼ˆä½¿ç”¨ perf-map-agent ç”Ÿæˆï¼‰&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è™½ç„¶ async-profiler ä¸Šæ‰‹ä½¿ç”¨å¾ˆç®€å•ï¼Œä½†ç«ç„°å›¾çœŸæ­£æœ‰è¶£ä¹‹å¤„åœ¨äºå¯ä»¥æ··åˆå±•ç° JVM å †æ ˆè¿½è¸ªå’ŒåŸç”Ÿä»£ç ï¼ˆnative codeï¼‰å †æ ˆè·Ÿè¸ªä¿¡æ¯ï¼Œè®©å¼€å‘è€…å¯ä»¥çœ‹åˆ° CPU å®é™…æ¶ˆè€—åœ¨ç¨‹åºçš„ä½•å¤„ã€‚Lightbend å…¬å¸çš„ Johannes Rudolph ä¸ºæ­¤å†™äº†ä¸€ä¸ªå·¥å…· - &lt;a href=&apos;https://github.com/jvm-profiling-tools/perf-map-agent&apos;&gt;perf-map-agent&lt;/a&gt;ã€‚è¯¥å·¥å…·åœ¨ macOS ç¯å¢ƒä¸‹ä¼šä½¿ç”¨ &lt;code&gt;dtrace&lt;/code&gt;ï¼Œåœ¨ Linux ç¯å¢ƒä¸‹ä¼šä½¿ç”¨ &lt;code&gt;perf&lt;/code&gt;ã€‚å¦‚æœä½ æƒ³ç¡®è®¤ç“¶é¢ˆæ˜¯å¦å‡ºç°åœ¨åŸç”Ÿä»£ç ä¸­ï¼Œè¿™ä¸ªå·¥å…·ä¼šç‰¹åˆ«æœ‰ç”¨ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘ä»¬å…ˆè¦ç¼–è¯‘ &lt;a href=&apos;https://github.com/jvm-profiling-tools/perf-map-agent&apos;&gt;perf-map-agent&lt;/a&gt;ã€‚å¯¹äº macOS ç¯å¢ƒï¼Œåœ¨è¿è¡Œ &lt;code&gt;cmake .&lt;/code&gt; ä¹‹å‰éœ€è¦å…ˆè®¾ç½® &lt;code&gt;JAVA_HOME&lt;/code&gt; ç¯å¢ƒå˜é‡ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ cd work
$ git clone https://github.com/brendangregg/FlameGraph.git

$ git clone https://github.com/jvm-profiling-tools/perf-map-agent.git
$ cd perf-map-agent
$ export JAVA_HOME=$(/usr/libexec/java_home)
$ cmake .
-- The C compiler identification is AppleClang 9.0.0.9000039
-- The CXX compiler identification is AppleClang 9.0.0.9000039
...
$ make&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨ä¸€ä¸ªæ–°çš„ç»ˆç«¯ä¸­ï¼Œå¸¦ &lt;code&gt;-XX:+PreserveFramePointer&lt;/code&gt; æ ‡è®°å‚æ•°è¿è¡Œ sbtï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ sbt -J-Dsbt.launcher.standby=20s -J-XX:+PreserveFramePointer exit&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­è¿è¡Œï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ cd quicktest/
$ export JAVA_HOME=$(/usr/libexec/java_home)
$ export FLAMEGRAPH_DIR=$HOME/work/FlameGraph
$ jps
94592 Jps
94549 sbt-launch.jar
$ $HOME/work/perf-map-agent/bin/dtrace-java-flames 94549
dtrace: system integrity protection is on, some features will not be available

dtrace: description &amp;amp;apos;profile-99 &amp;amp;apos; matched 2 probes
Flame graph SVG written to DTRACE_FLAME_OUTPUT=&amp;amp;apos;/Users/xxx/work/quicktest/flamegraph-94549.svg&amp;amp;apos;.&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç†è®ºä¸Šè¿™æ ·ä¼šäº§å‡ºæ›´å…¨é¢çš„ç«ç„°å›¾ï¼Œä¸è¿‡å¯¹äº &lt;code&gt;sbt exit&lt;/code&gt;ï¼Œäº§å‡ºçš„ç«ç„°å›¾çœ‹èµ·æ¥å¯èƒ½æœ‰ç‚¹å‡Œä¹±ã€‚&lt;/p&gt;
&lt;img src=&apos;https://i.loli.net/2020/07/13/s9BbWAnluTPwE3J.png&apos; title=&apos;flamegraph-2&apos; alt=&apos;flamegraph-2&apos; width=&apos;100%&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœ sbt æ“ä½œå·²ç»ç»è¿‡å³æ—¶ç¼–è¯‘å™¨ä¼˜åŒ–ï¼ˆthe operations are already JITedï¼‰ï¼Œæˆ–è€…æ“ä½œæ¯”è¾ƒç‰¹æ®Šï¼ˆthe operation is more specificï¼‰ï¼Œé‚£ä¹ˆç«ç„°å›¾çš„æ•ˆæœä¼šæ›´å¥½ã€‚ä¸ºäº†å¾—åˆ°æ•ˆæœæ›´å¥½çš„ç«ç„°å›¾ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç›¸åŒçš„æ“ä½œå¤šé‡å¤å‡ æ¬¡ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ sbt -J-Dsbt.launcher.standby=20s -J-XX:+PreserveFramePointer reload reload reload reload exit&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™æ ·å°±å¯ä»¥äº§å‡ºç¨‹åºçš„ç¨³å®šæ€ç«ç„°å›¾ï¼Œé€æ­¥æ”¾å¤§ç«ç„°å›¾ï¼Œå°±å¯ä»¥æ‰¾åˆ°æ‰§è¡Œçš„çƒ­ç‚¹è·¯å¾„ã€‚&lt;/p&gt;
&lt;img src=&apos;https://i.loli.net/2020/07/13/93YyjxR5ATS1Dnq.png&apos; title=&apos;flamegraph-3&apos; alt=&apos;flamegraph-3&apos; width=&apos;100%&apos;/&gt;
&lt;h2&gt;Flamescope&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Netflix å…¬å¸è¿‘æœŸå‘å¸ƒäº†ä¸€ä¸ªæ–°çš„ç«ç„°å›¾å¯è§†åŒ–å·¥å…· - &lt;a href=&apos;https://medium.com/netflix-techblog/netflix-flamescope-a57ca19d47bb&apos;&gt;Flamescope&lt;/a&gt;ï¼Œå¯ä»¥å°†ç«ç„°å›¾è¿‡æ»¤é™åˆ¶åœ¨ä¸€ä¸ªç‰¹å®šçš„æ—¶é—´èŒƒå›´å†…ã€‚&lt;/p&gt;
&lt;img src=&apos;https://i.loli.net/2020/07/13/djm2hkvC98irQu7.png&apos; title=&apos;FlameScope&apos; alt=&apos;FlameScope&apos; width=&apos;200&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Martin Spier å’Œ Brendan Gregg ä¸ºç ”ç©¶æ‰°åŠ¨ä»¥åŠå…¶ä»–æ—¶é—´ç›¸å…³çš„é—®é¢˜ï¼ˆperturbations and other time-based issuesï¼‰è€Œå¼€å‘äº†è¿™ä¸ªå·¥å…·ã€‚å¸¸è§„çš„ç«ç„°å›¾æ˜¯èšåˆäº†æ‰€æœ‰å †æ ˆè¿½è¸ªæŠ½æ ·æ•°æ®ï¼Œå¦‚æœç³»ç»Ÿä¸­å‘ç”Ÿäº†ä¸€ä¸ªçŸ­æ—¶å°æ•…éšœï¼Œå°±ä¼šè¢«æ·±åŸ‹äºå…¶ä»–è¿½è¸ªä¿¡æ¯ä¸­ï¼Œè¿™ä¸ªå·¥å…·å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;h2&gt;JMH (sbt-jmh)&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å› ä¸º JIT å­˜åœ¨é¢„çƒ­ç­‰ç‰¹ç‚¹ï¼Œå¢å¤§äº†åŸºå‡†æµ‹è¯•çš„å›°éš¾ã€‚JMH ä¼šå°†ç›¸åŒçš„æµ‹è¯•è¿è¡Œå¤šæ¬¡ï¼Œæ¶ˆé™¤ JIT é¢„çƒ­ç­‰ç‰¹ç‚¹é€ æˆçš„å½±å“ï¼Œä»è€Œæ›´å‡†ç¡®åœ°æµ‹é‡ä»£ç çš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äº sbt ç”¨æˆ·è€Œè¨€ï¼ŒLightbend å…¬å¸ Konrad Malawski ç¼–å†™çš„ &lt;a href=&apos;https://github.com/ktoso/sbt-jmh&apos;&gt;sbt-jmh&lt;/a&gt; è¿›ä¸€æ­¥ç®€åŒ–äº† JMH æµ‹è¯•ã€‚å¹¶ä¸”å®ƒä¹Ÿé›†æˆäº† async-profilerã€‚&lt;/p&gt;
&lt;h2&gt;VisualVM&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘ä¹Ÿæƒ³æä¸€ä¸‹ä¼ ç»Ÿçš„ JVM å‰–æå·¥å…·ã€‚å› ä¸º &lt;a href=&apos;https://visualvm.github.io/&apos;&gt;VisualVM&lt;/a&gt; å¼€æºäº†ï¼Œæ‰€ä»¥å°±æ¥è¯´è¯´å®ƒã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;1ã€å…ˆæ‰“å¼€ VisualVM&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;2ã€åœ¨ä¸€ä¸ªç»ˆç«¯ä¸­å¯åŠ¨ sbt&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;3ã€ä» VisualVM ç•Œé¢çš„ Local åº”ç”¨ç›®å½•ä¸‹åº”è¯¥å¯ä»¥çœ‹åˆ° &lt;code&gt;xsbt.boot.Boot&lt;/code&gt;&lt;/p&gt;
&lt;img src=&apos;https://i.loli.net/2020/07/13/EB7vsuo1HjaTtQw.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;100%&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;4ã€æ‰“å¼€å®ƒï¼Œé€‰æ‹© æŠ½æ ·åŠŸèƒ½ï¼ˆsamplerï¼‰ æˆ– å‰–æåŠŸèƒ½ï¼ˆprofilerï¼‰ï¼Œåœ¨ä½ æƒ³è¦å¼€å§‹çš„æ—¶é—´ç‚¹ç‚¹å‡» CPU æŒ‰é’®&lt;/p&gt;
&lt;img src=&apos;https://i.loli.net/2020/07/13/aoiIDfMKw9pjY4Z.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;100%&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœä½ å¯¹ &lt;a href=&apos;https://www.yourkit.com/&apos;&gt;YourKit&lt;/a&gt; æ¯”è¾ƒç†Ÿæ‚‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒï¼Œç”¨æ³•æ¯”è¾ƒç›¸ä¼¼ã€‚&lt;/p&gt;
&lt;h2&gt;æ€»ç»“&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç«ç„°å›¾å¯¹å †æ ˆè·Ÿè¸ªæŠ½æ ·æ•°æ®è¿›è¡Œå¯è§†åŒ–ï¼Œæ–¹ä¾¿è¯†åˆ«åº”ç”¨ä»£ç ä¸­çš„çƒ­ç‚¹è·¯å¾„ã€‚ä¹Ÿæœ‰åŠ©äºç¡®è®¤ä»£ç å˜æ›´æ˜¯å¦å®é™…å½±å“äº†åº”ç”¨æ€§èƒ½ã€‚&lt;/p&gt;</description>
            <pubDate>2020-07-13</pubDate>
            <link>https://blog.xiayf.cn/posts/how-to-profile-jvm-applications.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/how-to-profile-jvm-applications.html</guid>
        </item>
        
        <item>
            <title>è¯»æ–‡ï¼šKafka å®˜æ–¹è®¾è®¡æ–‡æ¡£</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;åŸæ–‡ï¼š&lt;a href=&apos;http://kafka.apache.org/documentation/#design&apos;&gt;http://kafka.apache.org/documentation/#design&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;æ•°æ®æŒä¹…åŒ–&lt;/h2&gt;
&lt;h4&gt;ä¸ç”¨æƒ§æ€•æ–‡ä»¶ç³»ç»Ÿ&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç£ç›˜çš„è¯»å†™é€Ÿåº¦ï¼Œå–å†³äºå¦‚ä½•è¯»å†™ã€‚å¯¹äºçº¿æ€§è¯»å†™æ–¹å¼ï¼Œæ“ä½œç³»ç»Ÿåšäº†å……åˆ†çš„ä¼˜åŒ–ï¼šæå‰è¯» - é¢„å–è‹¥å¹²æ•°æ®å—ï¼Œæ»åå†™ - å°†å°çš„é€»è¾‘å†™æ“ä½œåˆå¹¶æˆä¸€ä¸ªå¤§çš„ç‰©ç†å†™æ“ä½œã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;a href=&apos;http://queue.acm.org/detail.cfm?id=1563874&apos;&gt;ç ”ç©¶&lt;/a&gt;è¡¨æ˜ï¼š&lt;a href=&apos;http://deliveryimages.acm.org/10.1145/1570000/1563874/jacobs3.jpg&apos;&gt;é¡ºåºè¯»å†™ç£ç›˜ï¼ˆsequential disk accessï¼‰çš„é€Ÿåº¦æœ‰äº›æ—¶å€™æ¯”éšæœºè®¿é—®å†…å­˜è¿˜è¦å¿«&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç°ä»£æ“ä½œç³»ç»Ÿæ¿€è¿›åœ°å°½å¯èƒ½å°†ç©ºé—²å†…å­˜ç”¨ä½œç£ç›˜ç¼“å­˜ã€‚æ‰€æœ‰ç£ç›˜è¯»å†™éƒ½ç»è¿‡æ“ä½œç³»ç»Ÿæä¾›çš„ç»Ÿä¸€ç¼“å­˜ã€‚è¿™ä¸ªç‰¹æ€§æ²¡æ³•è½»æ˜“å…³é—­ï¼Œé™¤éç›´æ¥ I/O ï¼ˆdirect I/Oï¼‰ï¼Œå› æ­¤ï¼Œå¦‚æœç¨‹åºåœ¨ç”¨æˆ·è¿›ç¨‹ä¸­è¿›è¡Œæ•°æ®ç¼“å­˜ï¼Œç¼“å­˜çš„æ•°æ®é€šå¸¸ä¹Ÿæ˜¯å’Œæ“ä½œç³»ç»Ÿé¡µç¼“å­˜é‡å¤çš„ï¼Œç¼“å­˜ä¸¤éï¼Œæ²¡å•¥æ„ä¹‰ï¼Œä¹Ÿæµªè´¹å†…å­˜ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è€Œä¸”ï¼ŒKafka æ˜¯æ„å»ºåœ¨ JVM ä¹‹ä¸Šçš„ï¼Œäº†è§£ Java å†…å­˜ä½¿ç”¨æ–¹å¼çš„äººåº”è¯¥éƒ½çŸ¥é“ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;å¯¹è±¡çš„å†…å­˜å¼€é”€éå¸¸é«˜ï¼Œé€šå¸¸æ˜¯å®é™…æ•°æ®å¤§å°çš„2å€ï¼ˆç”šè‡³æ›´å¤šï¼‰&lt;/li&gt;
&lt;li&gt;éšç€å †ä¸Šæ•°æ®é‡å¢å¤§ï¼ŒJava çš„ GC è¡¨ç°ä¹Ÿä¼šæ›´ç³Ÿç³•&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å› æ­¤ï¼Œä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿå¹¶ä¾èµ–äºæ“ä½œç³»ç»Ÿå†…å­˜é¡µç¼“å­˜ï¼Œä¼˜äºåœ¨ç¨‹åºä¸­ç»´æŠ¤ä¸€å—å†…å­˜ç¼“å­˜æˆ–å…¶å®ƒç»“æ„ã€‚è‡³å°‘æ“ä½œç³»ç»Ÿå†…å­˜é¡µç¼“å­˜çš„å¯ç”¨å†…å­˜ç¿»å€äº†ã€‚å¦å¤–ï¼Œå¦‚æœä½¿ç”¨ç´§å‡‘çš„å­—èŠ‚ç»“æ„æ¥ç¼“å­˜æ•°æ®ï¼Œç›¸æ¯”ä½¿ç”¨å¯¹è±¡ï¼Œå¯ç”¨å†…å­˜å¯èƒ½è¿˜ä¼šç¿»å€ã€‚åœ¨ 32GB å†…å­˜çš„æœºå™¨ä¸Šè¿™ä¹ˆæï¼Œç¼“å­˜å¯ç”¨åˆ° 20-30GBï¼Œè¿˜ä¸ä¼šå¯¹ GC é€ æˆäº†ä»€ä¹ˆåå½±å“ã€‚å¹¶ä¸”ï¼Œå³ä½¿æœåŠ¡é‡å¯ï¼Œè¿™å—ç¼“å­˜ç©ºé—´ä¹Ÿæ˜¯çƒ­çš„ï¼ˆé™¤éæœºå™¨é‡å¯ï¼‰ï¼Œç”¨æˆ·è¿›ç¨‹å†…çš„å†…å­˜ç¼“å­˜åœ¨æœåŠ¡é‡å¯åå¾—é‡å»ºï¼ˆ10GBçš„æ•°æ®ç¼“å­˜å¯èƒ½éœ€è¦10åˆ†é’Ÿå·¦å³ï¼‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™æ ·ä¹Ÿå¯ä»¥ç®€åŒ–ä»£ç é€»è¾‘ï¼Œå› ä¸ºç¼“å­˜å’Œæ–‡ä»¶ç³»ç»Ÿä¹‹é—´çš„ä¸€è‡´æ€§ç”±æ“ä½œç³»ç»Ÿæ¥ä¿è¯äº†ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™æ ·ä¸€åˆ†æï¼Œè®¾è®¡å°±ç®€å•äº†ï¼šæˆ‘ä»¬åå…¶é“è€Œè¡Œä¹‹ï¼Œæ‰€æœ‰æ•°æ®éƒ½ç›´æ¥å†™åˆ°æ–‡ä»¶ç³»ç»Ÿä¸ŠæŒä¹…åŒ–æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œä¸éœ€è¦åœ¨ç¨‹åºä¸­ä½¿ç”¨å†…å­˜ç¼“å­˜ï¼Œä¹Ÿä¸å¿…ç¡®ä¿å°†æ•°æ®åˆ·åˆ°ç£ç›˜ã€‚è¿™å®é™…æ„å‘³ç€æ•°æ®è½¬ç§»åˆ°äº†å†…æ ¸çš„å†…å­˜é¡µç¼“å­˜ã€‚&lt;/p&gt;
&lt;h4&gt;å¸¸é‡æ—¶é—´å°±èƒ½æå®š&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;B æ ‘çš„ O(log N) æ—¶é—´å¤æ‚åº¦ï¼Œå¯¹äºç£ç›˜æ“ä½œæ¥è¯´ï¼Œå¹¶ä¸èƒ½ç­‰åŒäºå¸¸é‡æ—¶é—´å¤æ‚åº¦ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Kafka é‡‡ç”¨æ—¥å¿—æ–‡ä»¶æ–¹å¼ï¼Œç¡®ä¿è¯»å†™æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Kafka ä¸ä¼šåœ¨æ¶ˆæ¯ä¸€è¢«æ¶ˆè´¹å°±ç«‹å³åˆ é™¤ï¼Œè€Œæ˜¯ä¿ç•™ä¸€æ®µæ—¶é—´ï¼Œè¿™æ ·å¯¹äºæ¶ˆè´¹è€…æ¥è¯´ä¹Ÿæ›´çµæ´»ä¸€äº›ã€‚&lt;/p&gt;
&lt;h2&gt;æ•ˆç‡&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äº Kafka è¿™ç±»ç³»ç»Ÿè€Œè¨€ï¼Œå³ä½¿åƒå‰è¿°é‚£æ ·æ¶ˆé™¤äº†ç³Ÿç³•çš„ç£ç›˜è®¿é—®æ¨¡å¼ï¼Œä¹Ÿä¼šé‡åˆ°ä¸¤ä¸ªå¯¼è‡´æ•°æ®æ•ˆç‡ä½çš„é—®é¢˜ï¼š&lt;strong&gt;è¿‡å¤šçš„å° I/O æ“ä½œ&lt;/strong&gt;ï¼Œä»¥åŠ&lt;strong&gt;è¿‡å¤šçš„å­—èŠ‚æ‹·è´&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å° I/O é—®é¢˜åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´ï¼Œä»¥åŠæœåŠ¡ç«¯å†…éƒ¨çš„æ•°æ®æŒä¹…åŒ–æ“ä½œä¸­éƒ½ä¼šå‘ç”Ÿã€‚å¯¹æ­¤ï¼ŒKafka åè®®å»ºç«‹åœ¨ â€œæ¶ˆæ¯é›†â€ ï¼ˆå³ä¸€æ‰¹æ¶ˆæ¯ï¼‰çš„æŠ½è±¡ä¹‹ä¸Šï¼Œè¿™æ ·ç½‘ç»œè¯·æ±‚è¯»å†™çš„æ˜¯ä¸€æ‰¹ä¸€æ‰¹çš„æ¶ˆæ¯ï¼Œå‡å°‘äº†ç½‘ç»œå¾€è¿”çš„æ—¶é—´å¼€é”€ï¼ˆæ³¨ï¼šæ¶ˆæ¯å¤„ç†çš„å®æ—¶æ€§ä¼šç›¸å¯¹å·®ä¸€ç‚¹ï¼‰ã€‚æœåŠ¡ç«¯ä¹Ÿæ˜¯ä¸€æ¬¡å°†ä¸€æ‰¹æ¶ˆæ¯å†™åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œæ¶ˆè´¹è€…ä¹ŸæŒ‰åºä¸€æ¬¡è·å–ä¸€æ‰¹æ¶ˆæ¯ã€‚è¿™ä¸€ç®€å•çš„ä¼˜åŒ–å¯ä»¥å°†ååèƒ½åŠ›æå‡å‡ ä¸ªæ•°é‡çº§ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äºè¿‡å¤šçš„å­—èŠ‚æ‹·è´é—®é¢˜ï¼Œåœ¨æ¶ˆæ¯é‡å¤§çš„æ—¶å€™ï¼Œå½±å“æ¯”è¾ƒæ˜æ˜¾ã€‚Kafka é‡‡ç”¨äº†ä¸€ç§æ ‡å‡†åŒ–çš„äºŒè¿›åˆ¶æ¶ˆæ¯æ ¼å¼ï¼Œproducerã€brokerã€consumer éƒ½ä½¿ç”¨è¿™ç§æ ¼å¼ï¼Œè¿™æ ·æ•°æ®å—åœ¨ä¼ è¾“æœŸé—´ä¸éœ€è¦å˜åŠ¨ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;broker ç»´æŠ¤çš„æ¶ˆæ¯æ—¥å¿—åªæ˜¯ä¸€ä¸ªç›®å½•ä¸‹çš„ä¸€å †æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹æ˜¯æŒ‰åºå†™å…¥çš„æ¶ˆæ¯é›†ï¼Œæ¶ˆæ¯é›†çš„æ•°æ®æ ¼å¼åŒäº producerã€consumer ä½¿ç”¨çš„ã€‚å…±ç”¨ä¸€ç§æ•°æ®æ ¼å¼æ–¹ä¾¿äº†ä¸€ä¸ªé‡è¦çš„æ“ä½œä¼˜åŒ–ï¼šæŒä¹…åŒ–æ—¥å¿—å—çš„ç½‘ç»œä¼ è¾“ã€‚å¯¹äºä»å†…å­˜é¡µç¼“å­˜ï¼ˆpagecacheï¼‰åˆ°ç½‘ç»œå¥—æ¥å­—ï¼ˆsocketï¼‰çš„æ•°æ®ä¼ è¾“æ“ä½œï¼Œç°ä»£ UNIX æ“ä½œç³»ç»Ÿæä¾›äº†ä¸€ç§é«˜åº¦ä¼˜åŒ–çš„ä»£ç æ‰§è¡Œè·¯å¾„ã€‚Linux ä¸­ä½¿ç”¨ &lt;a href=&apos;http://man7.org/linux/man-pages/man2/sendfile.2.html&apos;&gt;sendfile ç³»ç»Ÿè°ƒç”¨&lt;/a&gt; å¯ä»¥åˆ©ç”¨è¿™ä¸ªä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¦ç†è§£ sendfile çš„æ”¶ç›Šï¼Œéœ€è¦å…ˆç†è§£ä»æ–‡ä»¶åˆ°å¥—æ¥å­—ä¼ è¾“æ•°æ®çš„å¸¸è§„ä»£ç æ‰§è¡Œè·¯å¾„ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;æ“ä½œç³»ç»Ÿä»ç£ç›˜å°†æ•°æ®è¯»åˆ°å†…æ ¸ç©ºé—´çš„å†…å­˜é¡µç¼“å­˜ï¼ˆpagecacheï¼‰&lt;/li&gt;
&lt;li&gt;åº”ç”¨ç¨‹åºä»å†…æ ¸ç©ºé—´å‡æ•°æ®è¯»åˆ°ç”¨æˆ·ç©ºé—´ç¼“å†²åŒº&lt;/li&gt;
&lt;li&gt;åº”ç”¨ç¨‹åºå°†æ•°æ®ä»ç”¨æˆ·ç©ºé—´ç¼“å†²åŒºè¯»åˆ°å†…æ ¸ç©ºé—´çš„å¥—æ¥å­—ç¼“å†²åŒº&lt;/li&gt;
&lt;li&gt;æ“ä½œç³»ç»Ÿå°†æ•°æ®ä»å¥—æ¥å­—ç¼“å†²åŒºè¯»åˆ° NIC ç¼“å†²åŒºï¼Œç½‘å¡ä» NIC ç¼“å†²åŒºè¯»å–æ•°æ®é€šè¿‡ç½‘ç»œå‘å‡ºå»&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸€ä»£ç æ‰§è¡Œè·¯å¾„ï¼Œæ¶‰åŠ 4 æ¬¡æ•°æ®æ‹·è´å’Œ 2 æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼Œå¾ˆæ˜¾ç„¶æ˜¯ä½æ•ˆçš„ã€‚ä½¿ç”¨ sendfileï¼Œå¯ä»¥é¿å…å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´ä¹‹é—´ä¸€äº›ä¸å¿…è¦çš„æ•°æ®æ‹·è´ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥ç›´æ¥å°†æ•°æ®ä»å†…å­˜é¡µç¼“å­˜å‘é€åˆ°ç½‘ç»œã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿›ä¸€æ­¥äº†è§£ sendfile ä»¥åŠ Java å¹³å°å¦‚ä½•æ”¯æŒé›¶æ‹·è´ï¼Œå¯ä»¥é˜…è¯»&lt;a href=&apos;https://developer.ibm.com/articles/j-zerocopy/&apos;&gt;è¿™ç¯‡æ–‡ç« &lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2&gt;ç”Ÿäº§è€…ï¼ˆThe Producerï¼‰&lt;/h2&gt;
&lt;h4&gt;è´Ÿè½½å‡è¡¡&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ¶ˆæ¯åº”è¯¥å‘åˆ°å“ªä¸ªåˆ†åŒºï¼ˆpartitionï¼‰ç”±å®¢æˆ·ç«¯æ ¹æ®å“ˆå¸Œç®—æ³•ï¼ˆæˆ–è€…éšæœºï¼‰å†³å®šï¼Œå¹¶ä¸”æ¶ˆæ¯æ˜¯ç›´æ¥ç”± producer å‘åˆ°ç›®æ ‡åˆ†åŒºçš„ leader brokerï¼Œæ²¡æœ‰ä»»ä½•ä¸­é—´è·¯ç”±å±‚ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ‰€æœ‰ Kafka èŠ‚ç‚¹éƒ½å¯ä»¥å“åº”å…ƒæ•°æ®è¯·æ±‚ - å‘ŠçŸ¥å®¢æˆ·ç«¯ï¼ˆproducer æˆ– consumerï¼‰å“ªäº›æœåŠ¡èŠ‚ç‚¹è¿˜å­˜æ´»ä»¥åŠæŸä¸ª topic çš„å„ä¸ªåˆ†åŒº leader åˆ†åˆ«æ˜¯å“ªä¸ªèŠ‚ç‚¹ï¼ˆç–‘æƒ‘ï¼šå¦‚æœæŸä¸ªåˆ†åŒº leader èŠ‚ç‚¹æŒ‚æ‰ä¹‹åï¼Œå®¢æˆ·ç«¯å¦‚ä½•è·çŸ¥ï¼Ÿä½•æ—¶å¯ä»¥è·çŸ¥ï¼Ÿï¼‰&lt;/p&gt;
&lt;h2&gt;æ¶ˆæ¯äº¤ä»˜è¯­ä¹‰&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;producer å’Œ consumer ä¹‹é—´çš„æ¶ˆæ¯äº¤ä»˜è¯­ä¹‰ï¼Œåˆ† 3 ç§ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;æœ€å¤šæ¶ˆè´¹ä¸€æ¬¡ - æ¶ˆæ¯å¯èƒ½ä¼šä¸¢å¤±ï¼Œä½†ä¸ä¼šè¢«é‡å¤æ¶ˆè´¹&lt;/li&gt;
&lt;li&gt;æœ€å°‘æ¶ˆè´¹ä¸€æ¬¡ - æ¶ˆæ¯ä¸ä¼šä¸¢ï¼Œä½†å¯èƒ½è¢«é‡å¤æ¶ˆè´¹&lt;/li&gt;
&lt;li&gt;ä»…æ¶ˆè´¹ä¸€æ¬¡ - æ¯ä¸ªæ¶ˆæ¯éƒ½ä¼šè¢«æ¶ˆè´¹ä¸”ä»…æ¶ˆè´¹ä¸€æ¬¡&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸ªé—®é¢˜å¯ä»¥åˆ†æˆä¸¤ä¸ªé˜¶æ®µçš„é—®é¢˜ï¼š&lt;strong&gt;producer å‘ broker å‘å¸ƒä¸€ä¸ªæ¶ˆæ¯æ—¶çš„æŒä¹…æ€§ä¿è¯&lt;/strong&gt; ä»¥åŠ &lt;strong&gt;consumer æ¶ˆè´¹ä¸€ä¸ªæ¶ˆæ¯æ—¶çš„è¯­ä¹‰ä¿è¯&lt;/strong&gt; ï¼ˆthe durability guarantees for publishing a message and the guarantees when consuming a messageï¼‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;producer å‘ Kafka é›†ç¾¤å‘æ¶ˆæ¯æ—¶ï¼Œä¼šæä¾›ä¸€ä¸ªè¯·æ±‚å‚æ•° &lt;code&gt;acks&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;acks=0ï¼šè¡¨ç¤º producer ä¸éœ€è¦ç­‰åˆ†åŒº leader broker è¿”å›ä»»ä½•å“åº”ï¼Œå°†æ¶ˆæ¯å­˜å…¥å¥—æ¥å­—ç¼“å†²åŒºï¼ˆsocket bufferï¼‰å°±å½“åšæ¶ˆæ¯å·²ç»å‘é€æˆåŠŸã€‚æ‰€ä»¥å¯é æ€§æ˜¯æ²¡æœ‰ä¿è¯çš„ã€‚&lt;/li&gt;
&lt;li&gt;acks=1ï¼šè¡¨ç¤º åˆ†åŒº leader broker å°†æ¶ˆæ¯å†™å…¥è‡ªå·±çš„æœ¬åœ°æ—¥å¿—æ–‡ä»¶ï¼Œå°±å‘ producer å“åº”æˆåŠŸï¼Œä¸å¿…ç­‰å¾…åˆ†åŒºå‰¯æœ¬ broker åŒæ­¥å¥½æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;li&gt;acks=-1 æˆ– acks=allï¼šè¡¨ç¤º åˆ†åŒº leader broker éœ€è¦ç­‰å¾…æ‰€æœ‰åŒæ­¥å‰¯æœ¬ broker åŒæ­¥å¥½æ¶ˆæ¯å¹¶å“åº”æˆåŠŸï¼Œæ‰å‘ producer å“åº”æˆåŠŸ&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç¬¬ 2 ç§æƒ…å†µï¼Œå¦‚æœåˆ†åŒº leader broker æŒ‚æ‰/ä¸å­˜æ´»ï¼Œåˆ™å‰¯æœ¬æœªæ¥å¾—åŠåŒæ­¥çš„æ¶ˆæ¯ä¼šä¸¢å¤±ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç¬¬ 3 ç§æƒ…å†µï¼Œåªè¦æœ‰åŒæ­¥å‰¯æœ¬æ­£å¸¸åŒæ­¥æ¶ˆæ¯ï¼Œé‚£ä¹ˆå³ä½¿ leader æŒ‚äº†ä¹Ÿä¸ä¼šä¸¢æ•°æ®ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœ leader è¢«ç³»ç»Ÿåˆ¤å®šä¸ºä¸å­˜æ´»ï¼Œåˆ™ä¼šä»ï¼ˆåŒæ­¥ï¼‰å‰¯æœ¬ä¸­é€‰ä¸¾ä¸€ä¸ªæ–°çš„ leaderï¼Œé‚£ä¹ˆ Kafka å¦‚ä½•åˆ¤å®šä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦å­˜æ´»ï¼Ÿå­˜æ´»åˆ¤å®šä¾èµ– 2 ä¸ªæ¡ä»¶ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;èŠ‚ç‚¹å¿…é¡»ç»´æŒä¸ Zookeeper çš„ session è¿æ¥ï¼ˆé€šè¿‡ Zookeeper çš„å¿ƒè·³æœºåˆ¶ï¼‰&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯ä¸€ä¸ªä»èŠ‚ç‚¹ï¼ˆfollowerï¼‰ï¼Œåˆ™å¿…é¡»ä¸æ–­ä» leader èŠ‚ç‚¹åŒæ­¥æ¶ˆæ¯æ•°æ®ï¼Œä¸”åŒæ­¥è¿›åº¦æ²¡æœ‰è½åå¤ªå¤š&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœ producer åœ¨å‘é€æ¶ˆæ¯çš„è¿‡ç¨‹ä¸­å‘ç”Ÿç½‘ç»œé—®é¢˜ï¼Œå®ƒæ²¡æ³•åˆ¤å®šåˆ†åŒº leader æ˜¯å¦æ”¶åˆ°æ¶ˆæ¯ã€‚0.11.0.0 ç‰ˆæœ¬ä¹‹å‰ï¼Œproducer åªèƒ½é‡å‘æ¶ˆæ¯ï¼Œåˆ«æ— ä»–æ³•ï¼Œå› æ­¤åªèƒ½æä¾›â€œæœ€å°‘æ¶ˆè´¹ä¸€æ¬¡çš„â€äº¤ä»˜è¯­ä¹‰ã€‚0.11.0.0 ç‰ˆæœ¬ä¹‹åï¼ŒKafka producer æ”¯æŒä¸€ä¸ªå¹‚ç­‰äº¤ä»˜åŠŸèƒ½é€‰é¡¹ï¼Œå¯ä»¥ç¡®ä¿æ¶ˆæ¯é‡å‘ä¸ä¼šå¯¼è‡´ Kafka çš„æ¶ˆæ¯æ—¥å¿—ä¸­å‡ºç°é‡å¤çš„æ¡ç›®ï¼šbroker ä¸ºæ¯ä¸ª producer åˆ†é…ä¸€ä¸ª IDï¼Œç„¶ååŸºäºæ¶ˆæ¯åºå·æ¥å»é‡ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¹Ÿæ˜¯ä» 0.11.0.0 ç‰ˆæœ¬å¼€å§‹ï¼ŒProducer æ”¯æŒä»¥ç±»äº‹åŠ¡çš„è¯­ä¹‰å‘å¤šä¸ª topic åˆ†åŒºå‘é€æ¶ˆæ¯ï¼šè¦ä¹ˆæ‰€æœ‰æ¶ˆæ¯éƒ½å‘é€æˆåŠŸï¼Œè¦ä¹ˆéƒ½ä¸æˆåŠŸã€‚è¿™ä¸ªèƒ½åŠ›ä¸»è¦ç”¨äºå®ç° Kafka topic ä¹‹é—´çš„ä»…å¤„ç†ä¸€æ¬¡è¯­ä¹‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä» consumer è§’åº¦æ¥çœ‹ï¼ŒåŒä¸€ä¸ªåˆ†åŒºçš„æ‰€æœ‰å‰¯æœ¬ï¼Œæ—¥å¿—æ•°æ®ç›¸åŒï¼Œæ¶ˆè´¹è¿›åº¦ä¹Ÿä¸€æ ·ã€‚consumer å¯ä»¥æ§åˆ¶è‡ªå·±å¯¹åˆ†åŒºæ—¥å¿—æ•°æ®çš„æ¶ˆè´¹ä½ç½®ã€‚&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;å¦‚æœ consumer è¯»å–æ¶ˆæ¯åï¼Œå…ˆå‘ kafka æäº¤æ¶ˆè´¹ä½ç½®ï¼Œå†å¤„ç†æ¶ˆæ¯ï¼›å¦‚æœè¯¥ consumer æŒ‚æ‰æˆ–é‡å¯ï¼Œä¼šå¯èƒ½å¯¼è‡´ä¸¢æ¶ˆæ¯ï¼Œä»è€Œåªèƒ½æ»¡è¶³â€œæœ€å¤šå¤„ç†ä¸€æ¬¡â€äº¤ä»˜è¯­ä¹‰ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœ consumer è¯»å–æ¶ˆæ¯åï¼Œæ˜¯å…ˆå¤„ç†ï¼Œå†æäº¤æ¶ˆè´¹ä½ç½®ï¼›å¦‚æœè¯¥ consumer æŒ‚æ‰æˆ–é‡å¯ï¼Œåˆ™å¯èƒ½å¯¼è‡´é‡å¤æ¶ˆè´¹æ¶ˆæ¯ï¼Œä»è€Œåªèƒ½æ»¡è¶³â€œæœ€å°‘å¤„ç†ä¸€æ¬¡â€äº¤ä»˜è¯­ä¹‰ã€‚&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚ä½•å®ç°â€œä»…å¤„ç†ä¸€æ¬¡â€è¯­ä¹‰ï¼Ÿå€ŸåŠ© Producer çš„äº‹åŠ¡èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;h2&gt;å¤åˆ¶&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¤åˆ¶çš„ç²’åº¦/å•å…ƒæ˜¯ topic åˆ†åŒºã€‚Kafka é›†ç¾¤ä¸­ï¼Œæ¯ä¸ªåˆ†åŒºéƒ½æœ‰ä¸€ä¸ª leader broker èŠ‚ç‚¹ï¼Œ0ä¸ªæˆ–å¤šä¸ªä»èŠ‚ç‚¹ï¼ˆfollowerï¼‰ã€‚åˆ†åŒºè¯»å†™éƒ½æ˜¯ç”± leader broker å¤„ç†ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚åŒä¸€ä¸ªæ™®é€šçš„ consumerï¼Œä»èŠ‚ç‚¹ä» leader broker æ‹‰å–ï¼ˆpullï¼‰æ¶ˆæ¯ï¼Œç„¶åå†™åˆ°è‡ªå·±çš„æ¶ˆæ¯æ—¥å¿—æ–‡ä»¶ä¸­ã€‚è®©ä»èŠ‚ç‚¹ä»¥ pull çš„æ–¹å¼è·å– leader çš„æ¶ˆæ¯æ•°æ®ï¼Œå¥½å¤„åœ¨äºæ‰¹é‡è¯»å†™ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äº follower èŠ‚ç‚¹è€Œè¨€ï¼Œâ€œæ˜¯å¦å­˜æ´»â€çš„å®é™…å«ä¹‰æ˜¯â€œæ˜¯å¦é¡ºåˆ©åœ°ä» leader åŒæ­¥æ¶ˆæ¯â€ï¼Œleader èŠ‚ç‚¹ä¼šè¿½è¸ªâ€œåŒæ­¥ä¸­â€èŠ‚ç‚¹é›†ï¼ˆISRsï¼‰ã€‚å¦‚æœä¸€ä¸ª follower æŒ‚æ‰äº†/å¡ä½äº†/åŒæ­¥è½åå¤ªå¤šäº†ï¼Œåˆ™å°†å…¶ä»è¿™ä¸ª ISRs ä¸­ç§»é™¤ã€‚follow æ˜¯å¦å¡ä½æˆ–è€…åŒæ­¥è½åå¤ªå¤šï¼Œä¾æ® &lt;code&gt;replica.lag.time.max.ms&lt;/code&gt; é…ç½®å‚æ•°åˆ¤å®šã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å°†æŸæ¶ˆæ¯å†™åˆ°æŸä¸ªåˆ†åŒºï¼Œå¦‚æœè¯¥åˆ†åŒºæ‰€æœ‰åŒæ­¥ä¸­å‰¯æœ¬éƒ½å·²ç»å°†è¯¥æ¶ˆæ¯å†™åˆ°è‡ªå·±çš„æ¶ˆæ¯æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œåˆ™å¯ä»¥è®¤ä¸ºè¯¥æ¶ˆæ¯çš„å†™æ“ä½œå·²æäº¤ï¼ˆcommittedï¼‰ï¼Œä¹Ÿå°±æ˜¯çœŸæ­£çš„å†™æˆåŠŸã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åªæœ‰å†™æäº¤çš„æ¶ˆæ¯æ‰ä¼šåˆ†å‘ç»™ consumerã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;producer å¯ä»¥é€‰æ‹©æ˜¯å¦ç­‰å¾…æ¶ˆæ¯å†™æ“ä½œæäº¤ï¼Œåœ¨å»¶è¿Ÿï¼ˆlatencyï¼‰å’ŒæŒä¹…æ€§ï¼ˆdurabilityï¼‰ä¹‹é—´æƒè¡¡ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Kafka é›†ç¾¤åœ¨æŸåˆ†åŒºçš„ leader èŠ‚ç‚¹æŒ‚æ‰ä¹‹åï¼Œä¼šå¿«é€Ÿè¿›è¡Œå¤±è´¥è½¬ç§»ï¼ˆa short fail-over periodï¼‰ï¼Œé€‰ä¸¾å‡ºæ–°çš„åˆ†åŒº leader èŠ‚ç‚¹ï¼Œå¯ç”¨æ€§ä¸ä¼šå—åˆ°å½±å“ã€‚ä½†å¦‚æœå‘ç”Ÿç½‘ç»œåˆ†åŒºï¼ˆnetwork partitionsï¼‰é—®é¢˜ï¼Œåˆ™æ— æ³•ä¿è¯å¯ç”¨æ€§ã€‚CAP - Cï¼ˆConsistencyï¼‰ï¼šä¸€è‡´æ€§ï¼ŒAï¼ˆAvailabilityï¼‰ï¼šå¯ç”¨æ€§ï¼ŒPï¼ˆPartition Toleranceï¼‰ï¼šåˆ†åŒºå®¹é”™æ€§ - æ”¾å¼ƒäº† åˆ†åŒºå®¹é”™æ€§ã€‚&lt;/p&gt;
&lt;h4&gt;æ—¥å¿—æ•°æ®å¤åˆ¶ï¼šä»²è£æˆå‘˜é›†ï¼ˆQuorumsï¼‰ã€åŒæ­¥ä¸­å‰¯æœ¬é›†ï¼ˆISRsï¼‰å’ŒçŠ¶æ€æœº&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ï¼ˆå¤‡æ³¨ï¼šè¿™ä¸€èŠ‚æˆ‘ç†è§£å¾—è¿˜ä¸å¤ªé€å½»ã€‚ï¼‰&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸€ç±»å¸¸è§çš„åˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯ä¸»ä»æ¨¡å¼çš„ï¼Œç”±ä¸»èŠ‚ç‚¹å†³å®šçŠ¶æ€å˜åŒ–çš„é¡ºåºï¼ˆthe order of a series of valuesï¼‰ã€‚ä»èŠ‚ç‚¹é€šè¿‡æ—¥å¿—å¤åˆ¶ï¼ˆreplicated logï¼‰æ–¹å¼åŒæ­¥çŠ¶æ€æ•°æ®ã€‚å¯¹äºæäº¤å†³ç­–ï¼ˆcommit decisionï¼‰å’Œé€‰ä¸»ï¼ˆleader electionï¼‰ï¼Œé€šå¸¸æ˜¯åŸºäºå¤šæ•°äººæŠ•ç¥¨çš„æœºåˆ¶ã€‚å‡è®¾å‰¯æœ¬ä¸ªæ•°ï¼ˆæ³¨ï¼šä¸ªäººç†è§£åŒ…å«ä¸»èŠ‚ç‚¹ï¼‰ä¸º 2f+1ï¼Œé‚£ä¹ˆåªæœ‰å½“ f+1 ä¸ªå‰¯æœ¬å†™å…¥æˆåŠŸï¼Œä¸»èŠ‚ç‚¹æ‰ä¼šå°†è¿™ä¸ªå†™æ“ä½œæ ‡è®°ä¸ºå·²æäº¤ï¼ˆcommittedï¼‰ã€‚å½“ä¸»èŠ‚ç‚¹æŒ‚æ‰ä¹‹åï¼ŒåŸºäº f ä¸ªçŠ¶æ€æœ€æ–°çš„å‰¯æœ¬èŠ‚ç‚¹ï¼Œå¯ä»¥é€‰ä¸¾å‡ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œä¸”çŠ¶æ€ä¸ä¼šæœ‰ä»»ä½•ä¸¢å¤±ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¤šæ•°äººæŠ•ç¥¨æ–¹å¼ï¼Œæœ‰ä¸€ä¸ªä¼˜ç‚¹ï¼šå»¶è¿Ÿå–å†³äºé€Ÿåº¦å¿«çš„èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯æ…¢çš„ã€‚ç¼ºç‚¹æ˜¯ï¼šå¯¹äºå®é™…çš„ç”Ÿäº§ç³»ç»Ÿï¼ŒæŠ—é£é™©èƒ½åŠ›è¿˜ä¸å¤Ÿï¼Œè€Œä¸”ä¸å¤Ÿçµæ´»ï¼Œä¸èƒ½è®©ä½¿ç”¨è€…åšæƒè¡¡ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Kafka é€‰æ‹©ä»²è£æˆå‘˜é›†ï¼ˆquorum setï¼‰çš„æ–¹å¼ä¸æ­¤ä¸åŒï¼Œè€Œä¸æ˜¯åŸºäºå¤šæ•°äººæŠ•ç¥¨ï¼Œè€Œæ˜¯åŠ¨æ€ç»´æŠ¤ä¸€ç»„åŒæ­¥ä¸­å‰¯æœ¬ï¼ˆISRï¼‰ï¼Œè¿™äº›å‰¯æœ¬ä¸ä¸»èŠ‚ç‚¹ä¿æŒåŒæ­¥ã€‚åªæœ‰è¿™ç»„å‰¯æœ¬ä¸­çš„æˆå‘˜æ‰æœ‰èµ„æ ¼å½“é€‰ä¸ºä¸»èŠ‚ç‚¹ã€‚ISR é›†å‘ç”Ÿå˜åŒ–æ—¶ä¼šæŒä¹…åŒ–åˆ° Zookeeper ä¸Šã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åŸºäº ISR æ¨¡å‹ï¼Œå¦‚æœ topic åˆ†åŒºæœ‰ f+1 ä¸ªå‰¯æœ¬ï¼Œåˆ™å¯ä»¥å®¹å¿ f ä¸ªèŠ‚ç‚¹æŒ‚æ‰ï¼Œä¹Ÿä¸ä¼šä¸¢å¤±ä»»ä½•å·²æäº¤çš„æ¶ˆæ¯ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸ Kafka ISR æ¨¡å‹å®é™…å®ç°æœ€ç›¸è¿‘çš„å­¦æœ¯è®ºæ–‡æ˜¯å¾®è½¯çš„ &lt;a href=&apos;http://research.microsoft.com/apps/pubs/default.aspx?id=66814&apos;&gt;PacificA&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h4&gt;å¯ç”¨æ€§å’ŒæŒä¹…æ€§ä¿è¯&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ³¨æ„ï¼šproducer å‘é€æ¶ˆæ¯æ—¶è®¾å®š &lt;code&gt;acks=all&lt;/code&gt; å¹¶ä¸æ˜¯è¦æ±‚æ‰€æœ‰çš„å‰¯æœ¬éƒ½ç¡®è®¤å†™å…¥æˆåŠŸï¼Œè€Œæ˜¯åœ¨å½“å‰åŒæ­¥ä¸­å‰¯æœ¬ï¼ˆISRï¼‰éƒ½ç¡®è®¤å†™å…¥æˆåŠŸæ—¶ï¼Œåˆ†åŒº leader å°±å‘ producer å“åº”æˆåŠŸã€‚ä¾‹å¦‚ï¼šæŸä¸ª topic è¢«è®¾ç½®ä¸º 2 ä¸ªå‰¯æœ¬ï¼Œç„¶åå…¶ä¸­ä¸€ä¸ªå‰¯æœ¬èŠ‚ç‚¹æŒ‚æ‰ï¼Œæ­¤æ—¶è¦æ±‚ &lt;code&gt;acks=all&lt;/code&gt; çš„å†™æ“ä½œä¹Ÿä¼šæˆåŠŸã€‚å¦‚æœå‰©ä¸‹çš„å‰¯æœ¬èŠ‚ç‚¹ä¹ŸæŒ‚äº†ï¼Œé‚£ä¹ˆå°±ä¼šä¸¢æ¶ˆæ¯å•¦ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·åœ¨ å¯ç”¨æ€§ å’Œ æŒä¹…æ€§ ä¹‹é—´æƒè¡¡ï¼ŒKafka æä¾›ä¸¤ä¸ª topic çº§åˆ«çš„é…ç½®ï¼Œç”¨äº æŒä¹…æ€§ æ¯” å¯ç”¨æ€§ é‡è¦çš„æƒ…å†µï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;&lt;a href=&apos;http://kafka.apache.org/documentation/#design_uncleanleader&apos;&gt;ç¦ç”¨è„ leader é€‰ä¸¾&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æŒ‡å®šä¸€ä¸ªæœ€å° ISR é›†å¤§å°ï¼ˆ&lt;code&gt;min.insync.replicas&lt;/code&gt; å‚æ•°è®¾ç½®ï¼‰ï¼šåªæœ‰å½“ ISR é›†å¤§å°å¤§äºè®¾å®šçš„æœ€å°å€¼ï¼Œåˆ†åŒº [leader] æ‰ä¼šæ¥å—æ¶ˆæ¯å†™å…¥ã€‚è¿™ä¸ªè®¾ç½®åªæœ‰å½“ producer ä½¿ç”¨ &lt;code&gt;acks=all&lt;/code&gt; æ—¶æ‰ä¼šç”Ÿæ•ˆã€‚ï¼ˆæ³¨ï¼šåœ¨æˆ‘ä»¬ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œåˆ†åŒºå‰¯æœ¬æ•°é€šå¸¸ç”³è¯·ä¸º 3ï¼ˆåŒ…å« leaderï¼‰ï¼Œé‚£ä¹ˆ &lt;code&gt;min.insync.replicas&lt;/code&gt; åº”è¯¥è®¾å®šä¸º 2ï¼Œä½†é»˜è®¤æ˜¯ 1ã€‚ä½¿ç”¨ 1ï¼Œé‚£ä¹ˆå½“åˆ†åŒºåªæœ‰ä¸€ä¸ªå‰¯æœ¬ï¼ˆå³ leaderï¼‰ï¼Œproducer ä¹Ÿèƒ½å†™å…¥æˆåŠŸï¼Œä½†å¦‚æœè¿™ä¸ªå‰¯æœ¬åˆæŒ‚äº†ï¼Œå°±ä¼šä¸¢æ•°æ®ã€‚ï¼‰&lt;/li&gt;&lt;/ol&gt;
&lt;h4&gt;å‰¯æœ¬ç®¡ç†&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸€ä¸ª Kafka é›†ç¾¤ä¸Šä¸€èˆ¬ä¼šæœ‰å¤šä¸ª topicï¼Œæ¯ä¸ª topic åˆæœ‰å¤šä¸ª partitionï¼Œä¸ºäº†èŠ‚ç‚¹ä¹‹é—´è´Ÿè½½å‡è¡¡ï¼Œé€šå¸¸ä»¥&lt;strong&gt;å¾ªç¯ï¼ˆround-robinï¼‰æ–¹å¼&lt;/strong&gt;åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šåˆ†å¸ƒ partition å’Œ åˆ†åŒº leader è§’è‰²ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦å¤–ï¼Œåœ¨åˆ†åŒº leader èŠ‚ç‚¹ä¹‹åé‡æ–°é€‰å‡º leader ä¹‹å‰ï¼Œå­˜åœ¨ä¸€æ®µä¸å¯ç”¨çš„æ—¶é—´çª—å£ï¼Œä¸ºäº†ç¼©çŸ­è¿™ä¸ªæ—¶é—´çª—å£ï¼ŒKafka ä¼šä»æ‰€æœ‰ broker ä¸­é€‰æ‹©ä¸€ä¸ªä½œä¸ºâ€œæ§åˆ¶å™¨ï¼ˆcontrollerï¼‰â€ï¼Œè¿™ä¸ªæ§åˆ¶å™¨ä¼šæ£€æµ‹ broker çº§åˆ«çš„é—®é¢˜ï¼ˆfailuresï¼‰ï¼Œåœ¨å‘ç°æŸä¸ª broker æŒ‚æ‰ä¹‹åï¼Œè´Ÿè´£ä¸ºå—å½±å“çš„åˆ†åŒºæŒ‡å®šæ–°çš„ leaderï¼Œè€Œä¸æ˜¯æ¯ä¸ªåˆ†åŒºè‡ªå·±è´Ÿè´£é‡æ–°é€‰ä¸»ï¼Œè¿™æ ·çš„é€‰ä¸»è¿‡ç¨‹æ›´è½»é‡æ›´å¿«ã€‚å¦‚æœæ§åˆ¶å™¨èŠ‚ç‚¹æŒ‚äº†ï¼Œè¿˜å­˜æ´»çš„ broker ä¸­çš„ä¸€ä¸ªä¼šæˆä¸ºæ–°çš„æ§åˆ¶å™¨ã€‚&lt;/p&gt;
&lt;h2&gt;æ¶ˆè´¹è€…æ¶ˆè´¹è¿›åº¦è·Ÿè¸ª&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Kafka ä¸ºæ¯ä¸ªæ¶ˆè´¹ç»„ï¼ˆconsumer groupï¼‰æŒ‡å®šä¸€ä¸ª broker æ¥å­˜å‚¨ç›®æ ‡ topic å„ä¸ªåˆ†åŒºçš„æ¶ˆè´¹è¿›åº¦ï¼ˆoffsetsï¼‰ï¼Œè¿™ä¸ª broker ç§°ä¸º &lt;strong&gt;ç»„åè°ƒå™¨ï¼ˆgroup coordinatorï¼‰&lt;/strong&gt;ã€‚è¿™ä¸ªæ¶ˆè´¹ç»„ä¸­çš„ä»»ä¸€æ¶ˆè´¹è€…å®ä¾‹éƒ½åº”è¯¥å°†æ¶ˆè´¹è¿›åº¦æäº¤åˆ°è¿™ä¸ªç»„åè°ƒå™¨ï¼Œæˆ–è€…ä»è¿™ä¸ªç»„åè°ƒå™¨è·å–å¯åŠ¨ä¹‹å‰ä¸Šæ¬¡çš„æ¶ˆè´¹è¿›åº¦ã€‚Kafka åŸºäºæ¶ˆè´¹ç»„çš„åç§°ä¸ºæ¶ˆè´¹ç»„åˆ†é…åè°ƒå™¨ã€‚æ¶ˆè´¹è€…å¯ä»¥å‘ä»»ä¸€ broker å‘é€ FindCoordinatorRequest è¯·æ±‚æ¥æŸ¥æ‰¾è‡ªå·±çš„åè°ƒå™¨ï¼Œå¹¶ä» FindCoordinatorResponse å“åº”ä¸­è·å–åè°ƒå™¨çš„è¯¦ç»†ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨ç»„åè°ƒå™¨æ¥æ”¶åˆ°ä¸€ä¸ª OffsetCommitRequest è¯·æ±‚åï¼Œä¼šå°†è¯·æ±‚æ•°æ®å†™åˆ°ä¸€ä¸ªç‰¹æ®Šçš„&lt;a href=&apos;http://kafka.apache.org/documentation/#compaction&apos;&gt;ç»å‹å®çš„ï¼ˆcompactedï¼‰&lt;/a&gt; Kafka topic - &lt;em&gt;__consumer_offsets&lt;/em&gt;ã€‚åœ¨ç›®æ ‡åˆ†åŒºçš„æ‰€æœ‰å‰¯æœ¬éƒ½ç¡®è®¤æ”¶åˆ°äº†ï¼Œåè°ƒå™¨æ‰ä¼šå‘æ¶ˆè´¹è€…å‘é€è¿›åº¦æäº¤æˆåŠŸçš„å“åº”ã€‚è¿™ä¸ª topic çš„æ¶ˆæ¯æ—¥å¿—æ•°æ®ä¼šå®šæœŸè¿›è¡Œå‹å®ï¼ˆcompactï¼‰ï¼Œå› ä¸ºåªéœ€è¦ä¸ºæ¯ä¸ªåˆ†åŒºç»´æŠ¤æœ€æ–°çš„æ¶ˆè´¹è¿›åº¦ã€‚åè°ƒå™¨ä¹Ÿä¼šåœ¨å†…å­˜ä¸­ç¼“å­˜æ¶ˆè´¹è¿›åº¦ï¼Œæ–¹ä¾¿å¿«é€Ÿå“åº”æ¶ˆè´¹è¿›åº¦æŸ¥è¯¢è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ³¨ï¼šå¦‚æœæ¶ˆè´¹è€…/æ¶ˆè´¹ç»„ç‰¹åˆ«å¤šï¼ˆä¾‹å¦‚ï¼šæˆ‘ä»¬å¹¿å‘Šå¼•æ“æœåŠ¡ï¼Œè¯»å–æ­£æ’æ¶ˆæ¯ topicï¼Œä¸€ä¸ªæœºå™¨å®ä¾‹å°±æ˜¯ä¸€ä¸ª consumer groupï¼Œæ•°é‡åœ¨å‡ ç™¾åˆ°å‡ åƒä¸ç­‰ï¼‰ï¼Œé‚£ä¹ˆç»„åè°ƒå™¨çš„å‹åŠ›ä¼šæ¯”è¾ƒå¤§ï¼Œé‚£ä¹ˆç¡®ä¿ç»„åè°ƒå™¨çš„è§’è‰²å‡åŒ€åˆ†é…åˆ°é›†ç¾¤çš„æ‰€æœ‰ brokerï¼Œæ¯”è¾ƒå…³é”®ã€‚å¦å¤–ï¼Œ&lt;em&gt;__consumer_offsets&lt;/em&gt; è¿™ä¸ª topic çš„åˆ†åŒºæ•°é‡ä¸èƒ½å¤ªå°‘ï¼Œæœ€å¥½å’Œ broker æ•°é‡ç›¸åŒæˆ–è€…æ•´æ•°å€æ•°é‡ã€‚&lt;/p&gt;</description>
            <pubDate>2019-10-13</pubDate>
            <link>https://blog.xiayf.cn/posts/reading-kafka-design.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/reading-kafka-design.html</guid>
        </item>
        
        <item>
            <title>è¯»æ–‡ï¼šæ—¥å¿— - æ¯ä¸ªè½¯ä»¶å·¥ç¨‹å¸ˆéƒ½åº”è¯¥äº†è§£çš„å®æ—¶æ•°æ®ç»Ÿä¸€æŠ½è±¡</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;åŸæ–‡ï¼š&lt;a href=&apos;https://engineering.linkedin.com/distributed-systems/log-what-every-software-engineer-should-know-about-real-time-datas-unifying&apos;&gt;The Log: What every software engineer should know about real-time data&apos;s unifying abstraction&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸€å¥è¯æ¦‚æ‹¬ï¼Œè¿™ç¯‡æ–‡ç« ç»†è¯´äº† Kafka çš„æœ¬è´¨åŸç†ã€è§£å†³çš„é—®é¢˜ã€é€‚ç”¨æ€§ç­‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Kafka æœ¬è´¨ä¸Šæ˜¯æä¾›æ—¥å¿—æ•°æ®æµã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ—¥å¿—æ˜¯å®¢è§‚ä¸–ç•Œçš„äº‹ä»¶è®°å½•ã€‚&lt;/p&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;A log is perhaps the simplest possible storage abstraction. It is an append-only, totally-ordered sequence of records ordered by time.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ—¥å¿—æ•°æ®çš„ç‰¹ç‚¹æ˜¯ï¼šåªå¢ä¸æ”¹ï¼Œè‡ªå¸¦æ—¶é—´æˆ³ï¼Œæ•°æ®å­˜å‚¨çš„å…ˆåé¡ºåºå³ï¼ˆå¤§è‡´ï¼‰æ˜¯å®é™…å‘ç”Ÿçš„æ—¶é—´å…ˆåé¡ºåºã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ•°æ®åº“å¯ä»¥åŸºäºæ—¥å¿—æ¥è¿˜åŸå†å²æ“ä½œè¡Œä¸ºï¼Œå¹¶æœ€ç»ˆç”Ÿæˆæœ€æ–°çŠ¶æ€ï¼Œä¸»ä»åŒæ­¥å°±æ˜¯è¿™ä¹ˆå¹²çš„ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿè€Œè¨€ï¼Œæ—¥å¿—å¯ä»¥è§£å†³ 2 ä¸ªé—®é¢˜ï¼šæŒ‰åºæ”¹å˜çŠ¶æ€å’Œåˆ†å‘æ•°æ®ï¼ˆordering changes and distributing dataï¼‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;çŠ¶æ€æœºå¤åˆ¶åŸåˆ™ï¼š&lt;/p&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;If two identical, deterministic processes begin in the same state and get the same inputs in the same order, they will produce the same output and end in the same state.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å„ä¸ªèŠ‚ç‚¹å¯ä»¥ä¾æ®æ—¥å¿—æ¥åŒæ­¥çŠ¶æ€ï¼Œè¾¾åˆ°ï¼ˆæœ€ç»ˆï¼‰ä¸€è‡´æ€§ã€‚å¹¶ä¸”ï¼Œå¯ä»¥ä¾æ®èŠ‚ç‚¹å¤„ç†åˆ°å“ªè¡Œæ—¥å¿—å³å¯ç¡®å®š/è¡¨è¾¾è¯¥èŠ‚ç‚¹çš„çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ï¼ˆæ—¥å¿—ï¼‰äº‹ä»¶æµï¼ˆeventsï¼‰å’Œæ•°æ®è¡¨ï¼ˆtablesï¼‰æ˜¯ä¸€ä½“ä¸¤é¢ï¼ˆa facinating dualityï¼‰ï¼šæ•°æ®è¡¨çš„å˜æ›´æ“ä½œå³æ˜¯ä¸€ä¸ªæ—¥å¿—äº‹ä»¶æµï¼ŒåŸºäºæ—¥å¿—äº‹ä»¶æµå¯ä»¥ç”Ÿæˆæ•°æ®è¡¨ï¼Œå¹¶å°†å…¶çŠ¶æ€ä¸æ–­æ›´æ–°åˆ°æœ€æ–°ï¼Œæ•°æ®è¡¨çš„çŠ¶æ€æ˜¯æ—¥å¿—äº‹ä»¶æµçš„åœ¨æŸä¸ªæ—¶é—´ç‚¹çš„åˆ‡é¢ã€‚&lt;/p&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;events -&gt; table -&gt; events = events &lt;-&gt; table&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;The magic of the log is that if it is a complete log of changes, it holds not only the contents of the final version of the table, but also allows recreating all other versions that might have existed. It is, effectively, a sort of backup of every previous state of the table.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æºç ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆæ¯”å¦‚ gitï¼‰ä¹Ÿæ˜¯åŸºäºæ—¥å¿—å®ç°çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œä¸€æ¬¡ commit ç›¸å½“äºä¸€æ¬¡æ—¥å¿—è®°å½•ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äºäº’è”ç½‘/é‡‘èç­‰è¡Œä¸šçš„å…¬å¸æ¥è¯´ï¼Œæ•°æ®æ˜¯é‡è¦èµ„äº§ï¼Œå¦‚ä½•å°½å¯èƒ½å‘æŒ¥æ•°æ®çš„æ½œåœ¨ä»·å€¼ä¸ºå…¬å¸å¢æ”¶ï¼Œè‡³å…³é‡è¦ã€‚å› ä¸ºç®¡ç†ã€æŠ€æœ¯ä¸Šçš„åŸå› ï¼Œå…¬å¸é€šå¸¸åˆ†å¤šä¸ªä¸šåŠ¡éƒ¨é—¨ï¼Œå„ä¸šåŠ¡éƒ¨é—¨æä¾›è‹¥å¹²æœåŠ¡ï¼Œå„ä¸ªæœåŠ¡éƒ½ä¼šäº§å‡ºæ•°æ®ï¼Œè¿™äº›æ•°æ®å¾ˆå¯èƒ½éœ€è¦è·¨éƒ¨é—¨è·¨æœåŠ¡æµé€šï¼Œæµé€šçš„é€Ÿåº¦è¶Šå¿«ï¼Œå‘¨æœŸè¶ŠçŸ­ï¼Œæ”¶ç›Šè¶Šå¤§ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä»¥å‰ï¼Œæ•°æ®çš„å¤„ç†æ–¹å¼ä¸»è¦æ˜¯æ‰¹å¤„ç†ï¼Œå¹¶ä¸æ˜¯å› ä¸ºæ²¡æœ‰æµå¤„ç†çš„æŠ€æœ¯ï¼Œè€Œæ˜¯æ•°æ®æµé€šçš„åŸºç¡€è®¾æ–½è·Ÿä¸ä¸Šï¼Œæ²¡åšåˆ°æŒç»­çš„æ•°æ®æµã€‚&lt;strong&gt;ï¼ˆæ³¨ï¼šè¿™ä¸ªè¯´æ³•ï¼Œæˆ‘ä¸ªäººåªéƒ¨åˆ†è®¤åŒï¼Œå¾ˆå¤šæ—¶å€™ï¼Œæ‰¹å¤„ç†çš„æ—¶å»¶å’Œæ”¶ç›Šå¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†éœ€æ±‚ï¼Œå®æ—¶æµå¤„ç†çš„è¾¹é™…æ•ˆç›Šå¯èƒ½å¹¶ä¸æ˜æ˜¾ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æµå¼å¤„ç†æ˜¯æ‰¹å¤„ç†çš„æ³›åŒ–å½¢å¼ï¼ˆstream processing is a generalization of batch processing, and, given the prevalence of real-time data, a very important generalizationï¼‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸ºäº†é¿å…å› æ•°æ®æµé€šå¯¼è‡´å„ä¸ªæœåŠ¡ä¹‹é—´çš„ç›´æ¥è€¦åˆï¼Œæ–°å¢ä¸€ä¸ªç»Ÿä¸€çš„æ•°æ®é€šé“ä¸­é—´æœåŠ¡ï¼Œå„ä¸ªæœåŠ¡åªç®¡å¯¹æ•°æ®é€šé“è¿›è¡Œå†™å…¥æˆ–è¯»å‡ºï¼Œä¸ç”¨å…³å¿ƒæ•°æ®æ˜¯å“ªä¸ªæœåŠ¡å†™å…¥çš„ï¼Œæˆ–è€…å“ªäº›æœåŠ¡åœ¨æ¶ˆè´¹/ä½¿ç”¨è‡ªå·±äº§å‡ºçš„æ•°æ®ã€‚&lt;strong&gt;ï¼ˆè§£è€¦ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦å¤–ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ®çš„é€Ÿç‡å¯èƒ½ä¸ä¸€æ ·ï¼Œä¹Ÿå¯èƒ½ä¼šç»å†å¼‚å¸¸é‡å¯ç­‰æƒ…å†µï¼Œè®©æ¶ˆè´¹è€…æ¥æ§åˆ¶é€Ÿç‡ï¼Œå¹¶ä¸”å¤šä¸ªæ¶ˆè´¹è€…ä¹‹é—´ä¸ä¼šç›¸äº’å¹²æ‰°ï¼Œä¼šæ›´å¥½ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åŸºäºæ•°æ®æµé€šçš„éœ€æ±‚å’Œæ—¥å¿—çš„ç†å¿µï¼ŒLinkedin è®¾è®¡å¼€å‘äº† Kafkaã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å› ä¸ºæ—¥å¿—æ•°æ®é‡å¯èƒ½ä¼šå¾ˆå¤§ï¼Œæ—¥å¿—æ•°æ®æœ¬è´¨ä¸Šæ˜¯æœ‰åºä¸²è¡Œçš„ï¼Œå¦‚æœæ”¯æŒæ•°æ®åˆ†ç‰‡ï¼Œåˆ†ç‰‡ä¹‹é—´å¹¶è¡Œæ¶ˆè´¹ï¼Œåˆ†ç‰‡å†…æ—¥å¿—æ•°æ®å…¨å±€æœ‰åºï¼Œæ•°æ®æµé€šçš„ååèƒ½åŠ›å°±å¯ä»¥æ— é™æ‰©å±•ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åŸºäº Kafka è¿™ç±»æ•°æ®ç®¡é“ï¼ŒæœåŠ¡ä¹‹é—´å¯ä»¥å®ç°å¤šçº§ä¸²è”ã€‚ï¼ˆæ³¨ï¼šæˆ‘ä»¬ç°åœ¨åšçš„æœåŠ¡å°±æ˜¯è¿™ä¹ˆå¹²ï¼‰&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ç§åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„ä¸­ï¼Œè‡³å°‘æ¶‰åŠ producerï¼ˆç”Ÿäº§è€…ï¼‰ã€brokerï¼ˆä¸­é—´äººï¼‰ã€consumerï¼ˆæ¶ˆè´¹è€…ï¼‰ä¸‰ä¸ªè§’è‰²ï¼Œè§’è‰²ä¹‹é—´åœ¨æŸäº›å·¥ä½œä¸Šå¦‚ä½•åˆ†å·¥ä¹Ÿæ˜¯å€¼å¾—æ€è€ƒçš„ï¼š&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç”Ÿäº§è€…äº§ç”Ÿçš„æ•°æ®åº”è¯¥æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ - ç»Ÿä¸€æ ¼å¼/ç¼–ç ã€æ–¹ä¾¿è§£æ&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸­é—´äººï¼ˆkafkaï¼‰éœ€è¦è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ- å¯¹äºå•ä¸ªç”Ÿäº§è€…å†™å…¥çš„æ•°æ®ï¼Œä¿è¯æŒ‰å†™å…¥é¡ºåºæœ‰åºåœ°åˆ†å‘ç»™æ¶ˆè´¹è€…ï¼›è§£å†³æ•°æ®é«˜å¯ç”¨ï¼Œé«˜ååèƒ½åŠ›ï¼›æ”¯æŒå›æº¯/é‡å¤æ¶ˆè´¹ï¼ˆå› æ­¤æ•°æ®éœ€è¦ä¿ç•™æŒ‡å®šæ—¶é—´é•¿åº¦ï¼‰ï¼Œä»è€Œæ¶ˆè´¹è€…å‡ºé—®é¢˜åå¯ä»¥ä»å¤´æ¶ˆè´¹æ•°æ®æ¢å¤çŠ¶æ€ã€‚å› ä¸ºæ”¯æŒå¾ˆå¤šæ¶ˆè´¹è€…æ¶ˆè´¹åŒä¸€ä¸ªæ•°æ®æµï¼Œæ‰€ä»¥å¹³å‡ä¸‹æ¥ï¼ŒKafka æœåŠ¡çš„æˆæœ¬ä¼šæ¯”è¾ƒä½ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ¶ˆè´¹è€…æŒ‰å„è‡ªçš„éœ€æ±‚è¿›è¡Œæ•°æ®è½¬æ¢å­˜å‚¨ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äºå®ç°é«˜ååèƒ½åŠ›ï¼Œé™¤äº†åˆ†ç‰‡ï¼ŒKakfa è¿˜å……åˆ†åˆ©ç”¨äº†æ”’æ‰¹å¤„ç†ï¼šç”Ÿäº§è€…å¯ä»¥æ‰¹é‡å‘é€ï¼Œä¸­é—´äººå°†æ•°æ®æ”’æ‰¹å†™å…¥ç£ç›˜æ—¥å¿—æ–‡ä»¶ ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ­¤å¤–ï¼Œç”±äºæ¶‰åŠå¤§é‡çš„ç£ç›˜æ–‡ä»¶å’Œç½‘ç»œä¹‹é—´æ•°æ®è¯»å†™ï¼ŒKafka è¿˜å……åˆ†åˆ©ç”¨æ“ä½œç³»ç»Ÿå†…æ ¸çš„é›¶æ‹·è´ä¼ è¾“èƒ½åŠ›ã€‚&lt;/p&gt;</description>
            <pubDate>2019-10-10</pubDate>
            <link>https://blog.xiayf.cn/posts/reading-the-log-article.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/reading-the-log-article.html</guid>
        </item>
        
        <item>
            <title>è¯»æ–‡ï¼šPhoton - Fault-tolerant and Scalable Joining of Continuous Data Streams</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;åŸæ–‡ï¼š&lt;a href=&apos;https://static.googleusercontent.com/media/research.google.com/zh-CN//pubs/archive/41318.pdf&apos;&gt;Photon: Fault-tolerant and Scalable Joining of Continuous Data Streams&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Photon æ˜¯è°·æ­Œå¹¿å‘Šç³»ç»Ÿä¸­ç”¨äº join å¹¿å‘Šæ›å…‰æ—¥å¿—æµå’Œç‚¹å‡»æ—¥å¿—æµçš„ä¸€å¥—ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ•°æ®æµ join ä¸ºä»€ä¹ˆæ²¡ç”¨ flink è¿™ç±»é€šç”¨çš„æµå¼å¤„ç†æ¡†æ¶ï¼Ÿ&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ•°æ®æµ joinï¼Œç‰¹åˆ«æ˜¯å¹¿å‘Šæ•°æ®æµ joinï¼ŒæŠ€æœ¯ä¸Šéš¾åœ¨å“ªé‡Œï¼Ÿ&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä»»ä¸€æ¡æµéƒ½å¯èƒ½ä¹±åºæˆ–å»¶è¿Ÿï¼Œå¹¿å‘Šç‚¹å‡»æ¶‰åŠè®¡è´¹çš„é—®é¢˜ï¼Œè®¡è´¹ä¸èƒ½å¤šç®—å¹¿å‘Šä¸»çš„é’±ï¼Œä¹Ÿè¦å°½å¯èƒ½é¿å…æ¼è®¡è´¹ï¼Œé™ä½å¹¿å‘Šæ”¶å…¥æŸå¤±ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¯¥ç³»ç»Ÿåœ¨è°·æ­Œç”Ÿäº§ç¯å¢ƒä¸­æ¯åˆ†é’Ÿå¤„ç†ç™¾ä¸‡çº§çš„äº‹ä»¶ï¼Œç«¯åˆ°ç«¯å»¶è¿Ÿå°äº 10 ç§’ï¼ˆæ³¨ï¼šå¯¹äºå¹¿å‘Šå®æ—¶ç«ä»·çš„å¹¿å‘Šä¸»è€Œè¨€ï¼Œè¿™ä¸ªå»¶è¿Ÿçš„é•¿çŸ­å¾ˆé‡è¦ï¼‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¹¿å‘Šæ›å…‰ã€ç‚¹å‡»æ•´ä½“æµç¨‹ä¸ºï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;ç”¨æˆ·æœç´¢æŸä¸ªå…³é”®è¯æ—¶ï¼Œè°·æ­Œçš„æœåŠ¡å™¨ä¼šè¿”å›å¹¿å‘Šå’Œæœç´¢ç»“æœã€‚å¹¿å‘ŠæœåŠ¡å™¨ä¼šå°†å¹¿å‘Š query å’Œç»“æœæ•°æ®ä½œä¸ºæ—¥å¿—å‘é€åˆ°å¤šä¸ªæ—¥å¿—æ•°æ®ä¸­å¿ƒï¼ˆmultiple logs-datacentersï¼‰ï¼Œæœ€ç»ˆæŒä¹…åŒ–å­˜å‚¨åœ¨ GFS ä¸Šã€‚æ¯æ¬¡ query éƒ½ä¼šè¢«èµ‹äºˆä¸€ä¸ªå”¯ä¸€æ€§ ID &lt;em&gt;query_id&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;å¯¹äºæœç´¢ç»“æœä¸­çš„å¹¿å‘Šï¼Œç”¨æˆ·å¯èƒ½ä¼šç‚¹å‡»ã€‚å¹¿å‘Šç‚¹å‡»ä¼šè§¦å‘ä¸€æ¬¡è¯·æ±‚ï¼Œè°·æ­Œçš„åç«¯æœåŠ¡å™¨å°†è¯·æ±‚é‡å®šå‘åˆ°å¹¿å‘Šä¸»çš„ç½‘ç«™ã€‚åœ¨é‡å®šå‘ä¹‹å‰ï¼Œè°·æ­ŒæœåŠ¡å™¨ä¼šå°†ç‚¹å‡»äº‹ä»¶è®°å½•åˆ°æ—¥å¿—ä¸­ï¼Œå‘é€åˆ°å¤šä¸ªæ—¥å¿—æ•°æ®ä¸­å¿ƒã€‚ç‚¹å‡»äº‹ä»¶æ—¥å¿—ä¸­åŒ…å«å¹¿å‘Šæ›å…‰çš„ query_idï¼Œç‚¹å‡»äº‹ä»¶ä¹Ÿä¼šè¢«èµ‹äºˆä¸€ä¸ªå”¯ä¸€æ€§ ID &lt;em&gt;click_id&lt;/em&gt;&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è®¡è´¹æ˜¯åœ¨ç‚¹å‡»ä¹‹åï¼Œä½†è®¡è´¹æ‰€éœ€è¦çš„å¹¿å‘Šå‡ºä»·ç­‰ä¿¡æ¯æ˜¯åœ¨æ›å…‰è¯·æ±‚ä¸­è®°å½•çš„ï¼Œå‡ºäºæ•°æ®æ•æ„Ÿæ€§ã€å¸¦å®½ã€è¯·æ±‚å¤„ç†å»¶è¿Ÿç­‰å¤šæ–¹é¢çš„è€ƒé‡ï¼Œè®¡è´¹ç›¸å…³çš„ä¿¡æ¯å¹¶ä¸ä¼šè¿”å›åˆ°ç”¨æˆ·å®¢æˆ·ç«¯ï¼Œä¹Ÿå°±æ˜¯è¯´ç‚¹å‡»è¯·æ±‚ä¸­ä¸ä¼šåŒ…å«è®¡è´¹ç›´æ¥ç›¸å…³çš„ä¿¡æ¯ï¼Œéœ€è¦å°† ç‚¹å‡»æ—¥å¿— å’Œ æ›å…‰æ—¥å¿— åšä¸€æ¬¡ joinï¼Œå¾—åˆ°ä¸€æ¡å®Œæ•´çš„ä¸Šä¸‹æ–‡æ—¥å¿—ï¼Œæ‰æ–¹ä¾¿åšåç»­è®¡è´¹ç­‰å¤„ç†ã€‚&lt;/p&gt;
&lt;img src=&apos;https://i.loli.net/2020/06/14/EDOy6VKxeJUcgAW.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;500&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è®ºæ–‡ä¸­æäº†åˆ°è¯¥ç³»ç»Ÿè§£å†³äº†å‡ ä¸ªæŠ€æœ¯æŒ‘æˆ˜ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;ä»…å¤„ç†ä¸€æ¬¡è¯­ä¹‰ï¼ˆexactly-once semanticsï¼‰ï¼šå®é™…ä¸Šè¾¾åˆ°çš„æ˜¯ æœ€å¤šå¤„ç†ä¸€æ¬¡è¯­ä¹‰ ï¼ˆAt most onceï¼‰ï¼Œä¹Ÿå°±æ˜¯ç»å¯¹ä¸èƒ½å¤šç®—é’±ï¼Œç„¶åå°½å¯èƒ½é¿å…å°‘ç®—é’±&lt;/li&gt;
&lt;li&gt;è‡ªåŠ¨åŒ–çš„è·¨æ•°æ®ä¸­å¿ƒå®¹é”™ï¼šä¹Ÿå°±æ˜¯å¤šæ•°æ®ä¸­å¿ƒéƒ¨ç½²ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ•°æ®ä¸­å¿ƒä¸å¯ç”¨ï¼ˆæ¯”å¦‚ ç½‘ç»œé—®é¢˜ï¼‰ï¼Œä¹Ÿä¸ä¼šå½±å“ç³»ç»Ÿæ­£å¸¸å¤„ç†æ•°æ®&lt;/li&gt;
&lt;li&gt;æ¨ªå‘æ‰©å±•æ€§é«˜ï¼šä¹Ÿå°±æ˜¯åŠ æœºå™¨å°±èƒ½åº”å¯¹æ¶ˆæ¯é‡å¢é•¿&lt;/li&gt;
&lt;li&gt;ä½æ—¶å»¶&lt;/li&gt;
&lt;li&gt;æµä¹±åº&lt;/li&gt;
&lt;li&gt;ä¸»æµå»¶è¿Ÿï¼ˆdelayed primary streamï¼‰ï¼šè¿™é‡Œè¯´çš„â€ä¸»æµâ€œæ˜¯æ›å…‰æ—¥å¿—æµ&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨æˆ‘çœ‹æ¥ï¼Œè¯¥ç³»ç»Ÿçš„äº®ç‚¹ä¸»è¦åœ¨å‰ 3 ç‚¹ï¼Œåè¾¹ç»†è¯´ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸ºè§£å†³ 1ã€2 æŒ‘æˆ˜ç‚¹ï¼Œç³»ç»Ÿå¼•å…¥ä¸€ä¸ªæœåŠ¡æ¨¡å—ï¼šIdRegistryï¼Œè¿™ä¸ªæœåŠ¡çš„åŠŸèƒ½ï¼šæä¾›ç‚¹å‡»äº‹ä»¶ idï¼ˆ&lt;em&gt;click_id&lt;/em&gt;ï¼‰ çš„å­˜å‚¨å’ŒæŸ¥è¯¢ï¼Œå¦‚æœæŸä¸ª click_id å¯ä»¥ä» IdRegistry ä¸­æŸ¥åˆ°ï¼Œåˆ™è¡¨ç¤ºè¯¥ç‚¹å‡»äº‹ä»¶å·²ç»å¤„ç†è¿‡äº†ï¼Œä¸è¦å†æ¬¡å¤„ç†ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¹¶ä¸”ï¼Œå¤šæ•°æ®ä¸­å¿ƒéƒ½éƒ¨ç½²ä¸€å¥— Photonï¼Œä½† IdRegistry å…±äº«ä¸€ä¸ªï¼Œå¤šå¥— Photon ç³»ç»Ÿçš„è¾“å…¥ç›¸åŒï¼Œé‚£ä¹ˆ IdRegistry é™¤äº†æä¾›å»é‡çš„åŠŸèƒ½ï¼Œè¿˜æä¾›äº†è´Ÿè½½å‡è¡¡çš„åŠŸèƒ½ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œå‡è®¾ N ä¸ªæ•°æ®ä¸­å¿ƒï¼Œæ¯ä¸ªæ•°æ®ä¸­å¿ƒ Photon join äº§å‡ºçš„æ—¥å¿—æ•°æ®é‡ä¸ºæ€»é‡çš„ 1/Nã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å½“æŸä¸ªæ•°æ®ä¸­å¿ƒçš„ Photon ä¸å¯ç”¨æ—¶ï¼Œç›¸å½“äºå…¶è´Ÿè½½åŠ¨æ€åœ°é‡æ–°åˆ†é…åˆ°å…¶å®ƒæ•°æ®ä¸­å¿ƒï¼Œè™½ç„¶æ€»ä½“èƒ½åŠ›ä¸Šé™ä½äº†ï¼Œä½†åªè¦å¤„ç†èƒ½åŠ›æœ‰å†—ä½™ï¼Œå°±ä¸ä¼šå½±å“æ­£å¸¸å¤„ç†ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é‚£ä¹ˆå¾ˆæ˜æ˜¾ï¼ŒIdRegistry å¾ˆå¯èƒ½æˆä¸ºç³»ç»Ÿçš„çŸ­æ¿ï¼›å¦å¤–ï¼Œæ›å…‰/ç‚¹å‡»çš„å”¯ä¸€æ€§ ID å¦‚ä½•ç”Ÿæˆï¼Ÿå¦‚æœç”±ä¸€ä¸ªä¸­å¿ƒæœåŠ¡æ¥æä¾›å”¯ä¸€æ€§ ID çš„ç”Ÿæˆï¼Œé‚£ä¹ˆè¿™ä¸ªæœåŠ¡ä¹Ÿä¼šæˆä¸ºç³»ç»Ÿçš„çŸ­æ¿ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ‰€ä»¥ï¼Œç³»ç»Ÿæ²¡æœ‰é€‰æ‹©ä¸€ä¸ªä¸­å¿ƒæœåŠ¡æ¥ç”Ÿæˆå”¯ä¸€æ€§ idï¼Œè€Œæ˜¯å°† id è®¾è®¡ä¸ºåŒ…å«3ä¸ªéƒ¨åˆ†ï¼š&lt;em&gt;ServerIP&lt;/em&gt;ã€&lt;em&gt;ProcessID&lt;/em&gt;ã€&lt;em&gt;Timestamp&lt;/em&gt;ã€‚ç”±äºæ—¥å¿—æ–‡ä»¶ä¸­è¡Œä¹‹é—´å¤§è‡´æ˜¯æŒ‰ç…§æ—¶é—´æˆ³æœ‰åºçš„ï¼Œæ‰€ä»¥ id ä¸­åŒ…å«æ—¶é—´æˆ³çš„ä¸€ä¸ªé¢å¤–å¥½å¤„æ˜¯ï¼šæ ¹æ® id å³å¯å¤§è‡´å®šä½æ—¥å¿—å†…å®¹ã€‚å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå’Œæ¨ªå‘æ‰©å±•æ€§ç›¸å…³çš„å¥½å¤„ï¼Œåè¾¹ç»†è¯´ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;IdRegistry çš„è§’è‰²è‡³å…³é‡è¦ï¼Œæ‰€ä»¥å°†å…¶å®ç°ä¸ºä¸€ä¸ªåŸºäº Paxos åè®®çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œæ ¹æ® CAP åŸåˆ™ï¼Œå¯ç”¨æ€§ï¼ˆæ­¤å¤„æ˜¯æŒ‡&lt;strong&gt;ååèƒ½åŠ›&lt;/strong&gt;ï¼‰å—é™ã€‚è§£å†³æ–¹æ¡ˆæ˜¯ï¼š&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;1ã€æé«˜å•æœºå¤„ç†èƒ½åŠ›ï¼šæœåŠ¡ç«¯æ”’æ‰¹å¤„ç†ï¼Œå°½å¯èƒ½å‡å°‘ç½‘ç»œå¾€è¿”æ¬¡æ•°å¯¼è‡´çš„ç­‰å¾…ï¼ˆç‰¹åˆ«æ˜¯ï¼šç”±äº IdRegistry æ˜¯è·¨åœ°åŸŸåˆ†å¸ƒå¼ï¼Œéƒ¨ç½²ä¸ŠèŠ‚ç‚¹ä¹‹é—´æœ€å¤§å»¶è¿Ÿæ˜¯ 100ms å·¦å³ï¼‰&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;2ã€åˆ†ç‰‡ï¼ˆShardingï¼‰ï¼šæ ¹æ® click_id è¿›è¡Œåˆ†ç‰‡ï¼Œä½†å¦‚æœæ˜¯å›ºå®šåˆ†ç‰‡ï¼Œé‚£ä¹ˆéšç€ä»¥åä¸šåŠ¡é‡å¢å¤§ï¼Œä¸å¥½æ‰©å±•ã€‚Photon ä½¿ç”¨äº†ä¸€ç§åŸºäºæ—¶é—´æ®µåŠ¨æ€åˆ†ç‰‡æ–¹æ¡ˆï¼Œè¿™ä¸ªæ–¹æ¡ˆåŸºäº click_id è‡ªå¸¦æ—¶é—´æˆ³ã€‚å¤§è‡´é€»è¾‘æ˜¯ï¼šä½¿ç”¨ä¸€ä¸ªé…ç½®ï¼Œå†…å®¹å¤§è‡´å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;img src=&apos;https://i.loli.net/2020/06/14/VRlgr2CoD8zw7Mm.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;500&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äºæ¯ä¸ª click æ—¥å¿—ï¼Œå…ˆæ ¹æ® click_id ä¸­çš„æ—¶é—´æˆ³ï¼Œåˆ¤æ–­åˆ†ç‰‡æ•°ï¼Œå¹¶è®¡ç®—å¯¹åº”çš„åˆ†ç‰‡ idã€‚&lt;/p&gt;
&lt;img src=&apos;https://i.loli.net/2020/06/14/JMWyQvrDZCaAEdH.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;500&apos;/&gt;
&lt;hr&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç³»ç»Ÿçš„æ¨¡å—å…³ç³»å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;img src=&apos;https://i.loli.net/2020/06/14/zghk6oVaqZ5uEs3.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;500&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Photon çš„ Dispatcher æ¨¡å—å¹¶æ²¡æœ‰ä»¥ Kafka è¿™ç§æ¶ˆæ¯é˜Ÿåˆ—ä½œä¸ºè¾“å…¥ï¼Œè€Œæ˜¯ç›´æ¥ç›‘å¬æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ—¥å¿—æ–‡ä»¶å˜æ›´ï¼Œè¿™ä¸€ç‚¹æœ‰ç‚¹å¥‡æ€ªï¼Œä¸æ˜¯ç‰¹åˆ«ç†è§£ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Joiner è´Ÿè´£å®é™…çš„ join å·¥ä½œï¼Œç”±äº 3ã€4 éƒ½æ¯”è¾ƒè€—æ—¶ï¼Œæ‰€ä»¥ä¸ºäº†å°½å¯èƒ½å‡å°‘ Joiner çš„å·¥ä½œé‡ï¼ŒDispatcher å°†ç‚¹å‡»äº‹ä»¶æ—¥å¿—å‘é€ç»™ Joinerï¼Œä¼šå…ˆåˆ° IdRegistry ä¸­æŸ¥ä¸€ä¸‹è¯¥äº‹ä»¶æ˜¯å¦å·²è¢«å¤„ç†è¿‡ï¼Œä»è€Œèµ·åˆ°è¿‡æ»¤ä½œç”¨ã€‚å› å¤šæ•°æ®ä¸­å¿ƒéƒ¨ç½²ï¼Œå®é™…è¿‡æ»¤æ¯”ä¸ºï¼š$ \frac{N-1}{N} $ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸ºäº†ç¡®ä¿ Joiner é«˜å¯ç”¨ï¼ŒJoiner æ˜¯æ— çŠ¶æ€çš„ï¼Œå‘ Dispatcher æä¾› RPC æ¥å£ï¼ŒJoiner å†…éƒ¨æœ‰é™æµï¼Œä»¥ä¿è¯ä¸ä¼šå› ä¸ºå•ä¸ª Joiner è´Ÿè½½è¿‡å¤§ï¼Œå¯¼è‡´å¤„ç†æ—¶å»¶å¢å¤§ã€‚Dispatcher è°ƒç”¨ Joiner å¤±è´¥åä¼šé‡è¯•ï¼Œé‡è¯•ä½¿ç”¨çš„æ˜¯æŒ‡æ•°é€€é¿ç®—æ³•ã€‚ä½†å¤„ç†å¤±è´¥çš„ç‚¹å‡»äº‹ä»¶ï¼Œæ˜¯å¦å¤–å­˜å‚¨åœ¨ GFS ä¸Šï¼Œåº”è¯¥æ˜¯ç”±å¦å¤–çš„çº¿ç¨‹æ¥è´Ÿè´£é‡è¯•ï¼Œä¸ä¼šå½±å“æ­£å¸¸çš„äº‹ä»¶å¤„ç†ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å½“ Joiner æ”¶åˆ°ä¸€ä¸ªç‚¹å‡»äº‹ä»¶çš„å¤„ç†è¯·æ±‚æ—¶ï¼Œä¼šæ ¹æ®ç‚¹å‡»æ—¥å¿—æ•°æ®ä¸­çš„ &lt;em&gt;query_id&lt;/em&gt; ä» EventStore æŸ¥è¯¢æ›å…‰æ—¥å¿—è¯¦æƒ…ï¼Œä½†å› ä¸ºæ›å…‰æ—¥å¿—æ•°æ®æµå¯èƒ½ä¼šæœ‰å»¶è¿Ÿï¼Œæ‰€ä»¥å¯èƒ½ä¼šæŸ¥ä¸åˆ°ï¼ŒæŸ¥ä¸åˆ°ä¸”å‘ç° click_id ä¸­çš„æ—¶é—´æˆ³æ—©äºæŸä¸ªé˜ˆå€¼ï¼ˆæ¯”å¦‚æ˜¯ Nå¤©å‰çš„ä¸€ä¸ªäº‹ä»¶ï¼‰ï¼ŒJoiner ä¼šå°†è¯¥ click_id æ ‡è®°ä¸ºä¸å¯ joinï¼Œç„¶åå‘ Dispatcher è¿”å›æˆåŠŸï¼›å¦‚æœ click_id ä¸­çš„æ—¶é—´æˆ³ä¸æ—©äºé˜ˆå€¼ï¼Œåˆ™å‘ Dispatcher è¿”å›å¤±è´¥ï¼Œç”± Dispatcher æ¥é‡è¯•ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸ºäº†ç¡®ä¿ä¸ä¼šå¤šè®¡è´¹ï¼ŒJoiner åœ¨å°† join ç»“æœå†™å…¥ Joined Click Logs ä¹‹å‰ï¼Œä¼šå‘ IdRegistry æ³¨å†Œ click_idã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å‡è®¾æ³¨å†Œå®é™…ä¸Šå·²æˆåŠŸï¼Œä½†å› ç½‘ç»œåŸå› æˆ– RPC è°ƒç”¨è¶…æ—¶ Joiner æœªæ”¶åˆ°æˆåŠŸå“åº”ï¼Œæ­¤æ—¶æ€ä¹ˆåŠï¼ŸJoiner å‘ IdRegistry æ³¨å†Œ click_id æ—¶ï¼Œä¼šé™„å¸¦ä¸€ä¸ªé¢å¤–çš„ å”¯ä¸€æ€§ tokenï¼Œä¹ŸåŒ…å«3ä¸ªéƒ¨åˆ†ï¼šJoiner æœåŠ¡å™¨åœ°å€ã€è¿›ç¨‹ IDã€æ—¶é—´æˆ³ï¼ŒIdRegistry ä¼šæŠŠè¿™ä¸ªå”¯ä¸€æ€§ token ä½œä¸ºå€¼å­˜å‚¨ä¸‹æ¥ï¼Œæ‰€ä»¥å¯¹äºè¿™ç§æƒ…å†µï¼ŒJoiner å¯ä»¥é‡å¤å‘æ³¨å†Œè¯·æ±‚ï¼Œå¦‚æœ IdRegistry æ ¹æ® token å‘ç°å·²æ³¨å†ŒæˆåŠŸçš„ click_id å’Œå½“å‰æ”¶åˆ°çš„ click_id æ¥è‡ªåŒä¸€ä¸ª Joinerï¼Œåˆ™ä¹Ÿä¼šè¿”å›æ³¨å†ŒæˆåŠŸã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å‡è®¾æ³¨å†ŒæˆåŠŸï¼Œåˆå¹¶ç»“æœå†™å…¥å¼‚å¸¸ï¼Œå¼‚å¸¸åˆ†ä¸º 2 ç§ï¼Œéœ€è¦è§£å†³ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;å†™å…¥ä¹‹å‰ï¼ŒJoiner èŠ‚ç‚¹å®•æœºæˆ–é‡å¯&lt;/li&gt;
&lt;li&gt;åˆå¹¶ç»“æœå®é™…å†™å…¥æˆåŠŸï¼Œä½†å› ä¸ºç½‘ç»œåŸå› ï¼ŒJoiner æœªæ”¶åˆ°å“åº”&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸ºå°½å¯èƒ½å‡å°‘å› æŸä¸ª Joiner èŠ‚ç‚¹ç¡¬ä»¶å¼‚å¸¸å¯¼è‡´çš„ join ç»“æœä¸¢å¤±ï¼ŒIdRegistry å¯¹äºå•ä¸ª Joiner çš„è¯·æ±‚æœ‰é™æµï¼Œè¿™ä¸ªé™æµä¼šé—´æ¥å¯¼è‡´ Joiner å¯¹ Dispatcher é™æµã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸ºäº†è¿›ä¸€æ­¥å‡å°‘å› ä¸ºä¸Šé¢2ç§å¼‚å¸¸æƒ…å†µä»¥åŠå…¶å®ƒå¼‚å¸¸å¯¼è‡´çš„ Join ç»“æœä¸¢å¤±ï¼ŒPhoton è¿˜æä¾›ä¸€ä¸ªæ ¡éªŒç³»ç»Ÿï¼šè·å–åŸå§‹ç‚¹å‡»äº‹ä»¶æ—¥å¿—ï¼Œå¦‚æœè¯¥æ—¥å¿— click_id åœ¨ IdRegistry ä¸­å­˜åœ¨ï¼Œä½†åˆå¹¶ç»“æœä¸­ä¸å­˜åœ¨ï¼Œåˆ™æ ¹æ® IdRegistry å­˜å‚¨çš„å¯¹åº” click_id çš„ tokenï¼Œåˆ¤æ–­å¯¹åº”çš„ Joiner æ˜¯å¦å­˜æ´»ï¼Œå¦‚æœå­˜æ´»ï¼Œåˆ™äº¤äºè¯¥ Joiner é‡æ–°å¤„ç†ï¼Œå¦‚æœå¯¹åº”çš„ Joiner å·²ä¸å­˜åœ¨ï¼Œåˆ™ä» IdRegistry ä¸­åˆ é™¤è¯¥ click_id è®°å½•ï¼Œç„¶åäº¤äºä»»ä¸€ Joiner æ¥å¤„ç†ï¼Œéƒ½ä¸€æ ·ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;EventStore è·å–åŸå§‹çš„æ›å…‰æ—¥å¿—ï¼Œå‘ Joiner æä¾›æŸ¥è¯¢æ¥å£ï¼Œè¿”å›åŸå§‹çš„æ›å…‰æ—¥å¿—å†…å®¹ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åŸºäºæ—¶é—´å±€éƒ¨æ€§ï¼ŒEventStore å†…éƒ¨åˆ† 2 å±‚ï¼Œç¬¬ä¸€å±‚ä¸º CacheEventStore - ä¸€ä¸ªç±»ä¼¼ Memcached çš„ KV å†…å­˜æ˜ å°„ï¼ŒK æ˜¯ query_idï¼ŒV æ˜¯æ›å…‰æ—¥å¿—å†…å®¹ï¼ŒåŸºäºä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æ ¹æ® query_id è¿›è¡Œåˆ†ç‰‡ï¼Œç¼“å­˜å‡ åˆ†é’Ÿæœ€æ–°çš„æ›å…‰æ—¥å¿—æ•°æ®ï¼Œå¯ä»¥å‘½ä¸­ 90% å·¦å³çš„æŸ¥è¯¢è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœ CacheEventStore æŸ¥è¯¢ missï¼Œåˆ™äº¤äºç¬¬äºŒå±‚ LogsEventStore æ¥å¤„ç†ã€‚LogsEventStore å¯¹ query_id å’Œ æ›å…‰æ—¥å¿—æ‰€åœ¨çš„æ—¥å¿—æ–‡ä»¶åŠç›®æ ‡èµ·å§‹è¡Œï¼ˆå› ä¸ºæ—¥å¿—æ–‡ä»¶æ•°æ®å¤§è‡´æŒ‰æ—¶é—´æˆ³æœ‰åºï¼Œæ ¹æ® query_id ä¸­çš„æ—¶é—´æˆ³å¤§è‡´å¯ä»¥çŸ¥é“æŸ¥è¯¢çš„èµ·å§‹è¡Œï¼‰å»ºç«‹ç´¢å¼•ï¼ˆå®é™…å­˜å‚¨åœ¨ BigTable ä¸­ï¼‰ï¼ŒæŸ¥è¯¢æ—¶ï¼Œå…ˆæ ¹æ® query_idï¼ŒæŸ¥åˆ°ç›®æ ‡æ—¥å¿—æ–‡ä»¶å’Œèµ·å§‹è¡Œï¼Œç„¶åä»æ—¥å¿—æ–‡ä»¶ä¸­è¯»å–åŸå§‹æ›å…‰æ—¥å¿—å†…å®¹ã€‚&lt;/p&gt;</description>
            <pubDate>2019-10-10</pubDate>
            <link>https://blog.xiayf.cn/posts/reading-photon-paper.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/reading-photon-paper.html</guid>
        </item>
        
        <item>
            <title>Lucene æŸ¥è¯¢è§£æå™¨è¯­æ³•ï¼ˆè¯‘ï¼‰</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;åŸæ–‡ï¼š&lt;a href=&apos;http://lucene.apache.org/core/8_2_0/queryparser/org/apache/lucene/queryparser/classic/package-summary.html#package.description&apos;&gt;Query Parser Syntax&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;æ¦‚è§ˆ&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Lucene é™¤äº†æä¾› API æ–¹ä¾¿å¼€å‘è€…åˆ›å»ºæŸ¥è¯¢è¯·æ±‚ï¼Œè¿˜é€šè¿‡ä¸€ä¸ªæŸ¥è¯¢è§£æå™¨ï¼ˆä¸€ä¸ªè¯æ³•åˆ†æå™¨ï¼Œä½¿ç”¨ JavaCC å°†ä¸€ä¸ªå­—ç¬¦ä¸²ç¿»è¯‘æˆä¸€ä¸ª Lucene æŸ¥è¯¢ï¼‰æä¾›ä¸€ç§åŠŸèƒ½ä¸°å¯Œçš„æŸ¥è¯¢è¯­è¨€ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸€èˆ¬æ¥è¯´ï¼ŒæŸ¥è¯¢è§£æå™¨æ”¯æŒçš„è¯­æ³•åœ¨ä¸åŒå‘å¸ƒç‰ˆæœ¬ä¹‹é—´å¯èƒ½ä¼šæœ‰å˜åŒ–ã€‚å½“å‰è¿™ä¸ªæ–‡æ¡£é¡µé¢æè¿°çš„æ˜¯å½“å‰è¿™ä¸ªå‘å¸ƒç‰ˆæœ¬çš„è¯­æ³•ã€‚å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ä¸€ä¸ªä¸åŒç‰ˆæœ¬çš„ Luceneï¼Œè¯·å‚è€ƒè¯¥ç‰ˆæœ¬è‡ªå¸¦çš„ docs/queryparsersyntax.html æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨é€‰æ‹©ä½¿ç”¨è¿™ä¸ªæŸ¥è¯¢è§£æå™¨ä¹‹å‰ï¼Œè¯·è€ƒè™‘ä»¥ä¸‹ 3 ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;å¦‚æœä½ å‡†å¤‡ä»¥ç¼–ç¨‹çš„æ–¹å¼ç”Ÿæˆä¸€ä¸ªæŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œç„¶åä½¿ç”¨æŸ¥è¯¢è§£æå™¨æ¥è§£æå®ƒã€‚é‚£ä¹ˆï¼Œä½ åº”è¯¥è®¤çœŸè€ƒè™‘ä¸€ä¸‹æ˜¯å¦åº”è¯¥ç›´æ¥ä½¿ç”¨æŸ¥è¯¢ API æ¥æ„å»ºæŸ¥è¯¢ã€‚æ¢å¥è¯è¯´ï¼ŒæŸ¥è¯¢è§£æå™¨ä¸“é—¨ç”¨äºäººç±»è¾“å…¥çš„æ–‡æœ¬ï¼Œè€Œä¸æ˜¯ç¨‹åºç”Ÿæˆçš„æ–‡æœ¬ã€‚&lt;/li&gt;
&lt;li&gt;ä¸å¯åˆ†è¯ï¼ˆuntokenizedï¼‰çš„åŸŸï¼ˆè¯‘è€…æ³¨ï¼šæŠ±æ­‰ï¼Œæ­¤å¤„æ²¡å¤ªç†è§£ï¼‰æœ€å¥½ç›´æ¥æ·»åŠ åˆ°æŸ¥è¯¢ä¸­ï¼Œè€Œä¸æ˜¯é€šè¿‡æŸ¥è¯¢è§£æå™¨æ¥è§£æã€‚å¦‚æœä¸€ä¸ªåŸŸçš„å€¼æ˜¯é€šè¿‡åº”ç”¨è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œé‚£ä¹ˆåº”è¯¥ä¸ºè¿™ä¸ªåŸŸè‡ªåŠ¨ç”ŸæˆæŸ¥è¯¢å­å¥ã€‚åˆ†æå™¨ï¼ˆæŸ¥è¯¢è§£æå™¨æ‰€ä½¿ç”¨çš„ï¼‰æ˜¯ä¸“é—¨ç”¨äºå°†äººç±»è¾“å…¥çš„æ–‡æœ¬è½¬æ¢æˆä¸€äº›è¯ï¼ˆtermsï¼‰ï¼Œé‚£ä¹ˆç¨‹åºè‡ªåŠ¨ç”Ÿæˆçš„å€¼ï¼Œä¹Ÿåº”è¯¥ç”±ç¨‹åºè‡ªåŠ¨æ·»åŠ åˆ°æŸ¥è¯¢ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;ä»æŸ¥è¯¢å½¢å¼æ¥çœ‹ï¼Œå¦‚æœåŸŸçš„å€¼æ˜¯æ™®é€šæ–‡æœ¬ï¼Œåˆ™åº”è¯¥ä½¿ç”¨æŸ¥è¯¢è§£æå™¨ã€‚æ‰€æœ‰å…¶å®ƒå€¼ç±»å‹ï¼Œæ¯”å¦‚ï¼šæ—¥æœŸèŒƒå›´ã€å…³é”®è¯ç­‰ç­‰ï¼Œæœ€å¥½é€šè¿‡æŸ¥è¯¢ API ç›´æ¥æ·»åŠ ã€‚å¦‚æœä¸€ä¸ªåŸŸçš„å€¼ä»…é™äºä¸€ä¸ªæœ‰é™çš„é›†åˆï¼ˆå¯ä»¥é€šè¿‡ä¸€ä¸ªä¸‹æ‹‰èœå•æŒ‡å®šï¼‰ï¼Œåˆ™ä¸åº”è¯¥æ·»åŠ åˆ°æŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆåç»­ä¼šè¢«è§£æï¼‰ä¸­ï¼Œè€Œæ˜¯åº”è¯¥ä½œä¸ºä¸€ä¸ª TermQuery å­å¥æ·»åŠ åˆ°æŸ¥è¯¢ä¸­ã€‚&lt;/li&gt;&lt;/ol&gt;
&lt;h2&gt;è¯ï¼ˆTermsï¼‰&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸€ä¸ªæŸ¥è¯¢è¯­å¥å¯ä»¥æ‹†è§£æˆ è¯ï¼ˆtermsï¼‰ å’Œ æ“ä½œç¬¦ï¼ˆoperatorsï¼‰ã€‚è¯åˆåˆ†ä¸ºä¸¤ç§ï¼šå•ä¸ªè¯ï¼ˆsingle Termsï¼‰å’ŒçŸ­è¯­ï¼ˆPhrasesï¼‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å•ä¸ªè¯æ˜¯æŒ‡ â€testâ€œ æˆ– â€Helloâ€œ è¿™ç±»å•è¯ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;çŸ­è¯­æ˜¯æŒ‡ä»¥åŒå¼•å·åŒ…å›´èµ·æ¥çš„ä¸€ç»„å•è¯ï¼Œæ¯”å¦‚ï¼šâ€hello dollyâ€œã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¤šä¸ªè¯ï¼ˆMultiple termsï¼‰å¯ä»¥ä½¿ç”¨å¸ƒå°”æ“ä½œç¬¦ç»„åˆåœ¨ä¸€èµ·ï¼Œå®ç°ä¸€ä¸ªæ›´åŠ å¤æ‚çš„æŸ¥è¯¢ï¼ˆå¦‚ä¸‹æ–‡æ‰€ç¤ºï¼‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¤‡æ³¨ï¼šç”¨äºåˆ›å»ºç´¢å¼•çš„è§£æå™¨ä¹Ÿä¼šç”¨äºè§£ææŸ¥è¯¢å­—ç¬¦ä¸²ä¸­çš„è¯å’ŒçŸ­è¯­ã€‚å› æ­¤ï¼Œé€‰æ‹©åˆé€‚çš„è§£æå™¨å¾ˆé‡è¦ï¼Œå¦åˆ™è§£æå™¨å¯èƒ½ä¼šè¢«æŸ¥è¯¢å­—ç¬¦ä¸²ä¸­çš„è¯å¹²æ‰°ï¼ˆè¯‘è€…æ³¨ï¼šè¿™å¥åº”è¯¥æ˜¯æŒ‡è‹±æ–‡è§£æå™¨å¯èƒ½æ— æ³•å¯¹ä¸­æ–‡è¿›è¡Œæ­£ç¡®åˆ†è¯çš„é—®é¢˜ï¼‰ã€‚&lt;/p&gt;
&lt;h2&gt;åŸŸï¼ˆFieldsï¼‰&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Lucene æ”¯æŒåˆ†å¤šä¸ªå­—æ®µ/åŸŸçš„æ•°æ®ã€‚æœç´¢æ—¶ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªåŸŸï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é»˜è®¤åŸŸã€‚åŸŸçš„åç§°ä»¥åŠé»˜è®¤åŸŸä¸å…·ä½“å®ç°ç›¸å…³ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¾“å…¥åŸŸçš„åç§°ï¼Œåè·Ÿä¸€ä¸ªå†’å·ï¼ˆ:ï¼‰ï¼Œä»¥åŠç›®æ ‡æœç´¢è¯ï¼Œå³å¯å¯¹ä»»æ„ä¸€ä¸ªåŸŸè¿›è¡Œæœç´¢ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸¾ä¾‹æ¥è¯´ï¼Œå‡è®¾ä¸€ä¸ª Lucene ç´¢å¼•åŒ…å« 2 ä¸ªåŸŸï¼štitle å’Œ textï¼Œtext æ˜¯é»˜è®¤åŸŸã€‚è‹¥æƒ³æŸ¥æ‰¾æ ‡é¢˜ä¸º â€The Right Wayâ€œ ä¸”æ–‡æœ¬å†…å®¹åŒ…å« â€don&apos;t go this wayâ€œ çš„æ–‡æ¡£ï¼Œå¯ä»¥è¾“å…¥ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;title:&amp;amp;quot;The Right Way&amp;amp;quot; AND text:go&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ–è€…ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;title:&amp;amp;quot;The Right Way&amp;amp;quot; AND go&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å› ä¸º text æ˜¯é»˜è®¤åŸŸï¼Œæ‰€ä»¥åŸŸçš„æ ‡å¿—å¯ä»¥çœç•¥ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ³¨æ„ï¼šæŒ‡å®šçš„åŸŸä»…å¯¹ç´§è·Ÿå…¶åçš„è¯ç”Ÿæ•ˆï¼Œå› æ­¤ï¼Œå¦‚ä¸‹æŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;title:The Right Way&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å°†å¯¹ title åŸŸä»…æŸ¥æ‰¾ â€Theâ€œï¼Œå¹¶å¯¹é»˜è®¤åŸŸï¼ˆå½“å‰è¿™ä¸ªä¾‹å­ä¸­æ˜¯æŒ‡ text åŸŸï¼‰æŸ¥æ‰¾ â€Rightâ€œ å’Œ â€Wayâ€œã€‚&lt;/p&gt;
&lt;h2&gt;è¯ä¿®é¥°è¯­ï¼ˆTerm Modifiersï¼‰&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Lucene æ”¯æŒä¿®é¥°æŸ¥è¯¢è¯ï¼ˆmodifying query termsï¼‰æ¥æä¾›å¤šç§æœç´¢æ–¹å¼ã€‚&lt;/p&gt;
&lt;h3&gt;é€šé…ç¬¦æœç´¢&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Lucene æ”¯æŒå¯¹å•ä¸ªè¯(single terms)ï¼ˆä¸æ˜¯çŸ­è¯­æŸ¥è¯¢ phrase queriesï¼‰è¿›è¡Œå•ä¸ªå­—ç¬¦å’Œå¤šä¸ªå­—ç¬¦çš„é€šé…æœç´¢ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½¿ç”¨ &lt;code&gt;?&lt;/code&gt; ç¬¦å·è¿›è¡Œå•ä¸ªå­—ç¬¦çš„é€šé…æœç´¢ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½¿ç”¨ &lt;code&gt;*&lt;/code&gt; ç¬¦å·è¿›è¡Œå¤šä¸ªå­—ç¬¦çš„é€šé…æœç´¢ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å•å­—ç¬¦é€šé…æœç´¢ç”¨äºæŸ¥æ‰¾æ›¿æ¢å•ä¸ªå­—ç¬¦å³å¯åŒ¹é…çš„è¯ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œè‹¥è¦æœç´¢ â€textâ€œ æˆ– â€testâ€œï¼Œå¯ä»¥å¦‚ä¸‹æŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;te?t&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¤šå­—ç¬¦é€šé…æœç´¢ç”¨äºæŸ¥æ‰¾æ›¿æ¢0ä¸ªæˆ–å¤šä¸ªå­—ç¬¦å³å¯åŒ¹é…çš„è¯ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œè‹¥è¦æœç´¢ â€testâ€œã€â€testsâ€œ æˆ– â€testerâ€œï¼Œå¯ä»¥å¦‚ä¸‹æŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;test*&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¹Ÿå¯ä»¥å¯¹è¯çš„ä¸­é—´éƒ¨åˆ†è¿›è¡Œé€šé…æœç´¢ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;te*t&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¤‡æ³¨ï¼šä¸å¯ä»¥å°† &lt;code&gt;*&lt;/code&gt; æˆ– &lt;code&gt;?&lt;/code&gt; ç¬¦å·ç”¨ä½œä¸€æ¬¡æœç´¢çš„é¦–ä¸ªå­—ç¬¦ã€‚&lt;/p&gt;
&lt;h3&gt;æ­£åˆ™è¡¨è¾¾å¼æœç´¢&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Lucene æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼æœç´¢ï¼ŒåŒ¹é…æ–œæ ï¼ˆ&lt;code&gt;/&lt;/code&gt;ï¼‰ ä¹‹é—´çš„æ¨¡å¼ã€‚æ­£åˆ™è¡¨è¾¾å¼çš„è¯­æ³•åœ¨ä¸åŒçš„å‘å¸ƒç‰ˆæœ¬ä¹‹é—´å¯èƒ½ä¼šæœ‰å·®å¼‚ï¼Œç›®å‰æ”¯æŒçš„è¯­æ³•åœ¨ &lt;a href=&apos;http://lucene.apache.org/core/8_2_0/core/org/apache/lucene/util/automaton/RegExp.html?is-external=true&apos;&gt;RegExp&lt;/a&gt; ç±»æ–‡æ¡£ä¸­æœ‰è¯´æ˜ã€‚ä¸¾ä¾‹æ¥è¯´ï¼ŒæŸ¥æ‰¾åŒ…å« â€moatâ€œ æˆ– â€boatâ€œ çš„æ–‡æ¡£ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;/[mb]oat/&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;æ¨¡ç³Šæœç´¢&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Lucene æ”¯æŒåŸºäº Damerau-Levenshtein ç¼–è¾‘è·ç¦»çš„æ¨¡ç³Šæœç´¢ã€‚åœ¨å•ä¸ªè¯çš„æœ€åæ·»åŠ æ³¢æµªç¬¦ï¼ˆ~ï¼‰å³å¯è¿›è¡Œæ¨¡ç³Šæœç´¢ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œä½¿ç”¨æ¨¡ç³Šæœç´¢æŸ¥æ‰¾æ‹¼å†™ä¸Šè¿‘ä¼¼ â€roamâ€œ çš„è¯ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;roam~&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸ªæŸ¥è¯¢è¯­å¥ä¼šæ‰¾åˆ° foam å’Œ roams è¿™ç±»è¯ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ¨¡ç³Šæœç´¢å¯ä»¥é€šè¿‡ä¸€ä¸ªé¢å¤–ï¼ˆå¯é€‰ï¼‰çš„å‚æ•°æ¥æŒ‡å®šå…è®¸çš„æœ€å¤§ç¼–è¾‘æ¬¡æ•°ã€‚è¿™ä¸ªå‚æ•°å€¼ç•Œäº 0 å’Œ 2 ä¹‹é—´ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;roam~1&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœæœªæŒ‡å®šè¯¥å‚æ•°ï¼Œåˆ™é»˜è®¤ä½¿ç”¨ 2 ä¸ªç¼–è¾‘è·ç¦»ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä»¥å‰ï¼Œè¿™é‡Œè¿˜å…è®¸ä½¿ç”¨æµ®ç‚¹æ•°ã€‚ç°åœ¨è¿™ä¸ªè¯­æ³•å·²è¢«è€ƒè™‘å¼ƒç”¨ï¼Œå°†äº Lucene 5.0 ä¸­ç§»é™¤ã€‚&lt;/p&gt;
&lt;h3&gt;é‚»è¿‘æœç´¢&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Lucene æ”¯æŒæŸ¥æ‰¾æŒ‡å®šè·ç¦»çš„é‚»è¿‘è¯ã€‚åœ¨çŸ­è¯­çš„æœ€åæ·»åŠ æ‹¨æµªç¬¦ï¼ˆ~ï¼‰å³å¯è¿›è¡Œé‚»è¿‘æœç´¢ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œåœ¨æ–‡æ¡£ä¸­æœç´¢ â€apacheâ€œ å’Œ â€jakartaâ€œ ç›¸è· 10 ä¸ªè¯çš„æ¨¡å¼ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;&amp;amp;quot;jakarta apache&amp;amp;quot;~10&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;èŒƒå›´æœç´¢&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;èŒƒå›´æŸ¥è¯¢å¯ä»¥è¦æ±‚åŸŸçš„å€¼åœ¨èŒƒå›´æŸ¥è¯¢è¯­å¥æŒ‡å®šçš„ä¸Šä¸‹ç•Œä¹‹é—´ã€‚èŒƒå›´æŸ¥è¯¢å¯¹äºä¸Šä¸‹ç•Œå¯ä»¥åŒ…å«ä¹Ÿå¯ä»¥ä¸åŒ…å«ã€‚æ’åºæŒ‰ç…§å­—å…¸åºè¿›è¡Œã€‚&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;mod_date:[20020101 TO 20030101]&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸ªæŸ¥è¯¢è¯­å¥ä¼šæŸ¥æ‰¾ mod_date åŸŸçš„å€¼åœ¨ 20020101 å’Œ 20030101 ï¼ˆåŒ…å«ä¸Šä¸‹ç•Œï¼‰ ä¹‹é—´çš„æ–‡æ¡£ã€‚æ³¨æ„ï¼šèŒƒå›´æŸ¥è¯¢å¹¶ä¸æ˜¯ä»…é€‚ç”¨äºæ—¥æœŸåŸŸï¼Œä¹Ÿå¯ä»¥å¯¹éæ—¥æœŸçš„åŸŸè¿›è¡ŒèŒƒå›´æŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;title:{Aida TO Carmen}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸ªæŸ¥è¯¢è¯­å¥ä¼šæŸ¥æ‰¾åˆ° title åŸŸçš„å€¼åœ¨ Aida å’Œ Carmen ï¼ˆä¸åŒ…å«ä¸Šä¸‹ç•Œï¼‰ä¹‹é—´çš„æ‰€æœ‰æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åŒ…å«ä¸Šä¸‹ç•Œçš„èŒƒå›´æŸ¥è¯¢ä½¿ç”¨æ–¹æ‹¬å·æ¥è¡¨ç¤ºã€‚ä¸åŒ…å«ä¸Šä¸‹ç•Œçš„èŒƒå›´æŸ¥è¯¢ä½¿ç”¨å¤§æ‹¬å·æ¥è¡¨ç¤ºã€‚&lt;/p&gt;
&lt;h3&gt;è¯åŠ æƒï¼ˆBoosting a termï¼‰&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Lucene ä¼šåŸºäºæ–‡æ¡£ä¸­æ‰¾åˆ°çš„è¯å¯¹åŒ¹é…åˆ°çš„æ–‡æ¡£æä¾›ç›¸å…³æ€§çº§åˆ«ï¼ˆè¯‘è€…ç–‘é—®ï¼šåŸºäºå‘é‡ä½™å¼¦æ¥è®¡ç®—ç›¸å…³æ€§ï¼Ÿï¼‰ã€‚å¯ä»¥åœ¨ç›®æ ‡æœç´¢è¯ä¹‹åç´§æ¥ä¸€ä¸ªè„±å­—ç¬¦ â€œ^â€ï¼Œåè·Ÿä¸€ä¸ªåŠ æƒç³»æ•°ï¼ˆä¸€ä¸ªæ•°å­—ï¼‰æ¥æå‡è¯¥æœç´¢è¯çš„ç›¸å…³æ€§æƒé‡ã€‚åŠ æƒç³»ç»Ÿè¶Šé«˜ï¼ŒæŸ¥è¯¢å‘½ä¸­çš„æ–‡æ¡£ä¸è¯¥è¯çš„ç›¸å…³æ€§è¶Šå¼ºã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åŠ æƒæ“ä½œå…è®¸å¯¹è¯è¿›è¡ŒåŠ æƒæ§åˆ¶æ–‡æ¡£çš„ç›¸å…³æ€§ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ æ­£åœ¨æœç´¢ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;jakarta apache&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç„¶åå¸Œæœ›æœç´¢ç»“æœå’Œè¯ â€jakartaâ€œ æ›´ç›¸å…³ä¸€äº›ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ â€^â€œ ç¬¦å·åè·Ÿä¸€ä¸ªåŠ æƒç³»æ•°å¯¹è¿™ä¸ªè¯è¿›è¡ŒåŠ æƒï¼Œå³å¦‚ä¸‹è¿™æ ·æŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;jakarta^4 apache&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¼šä½¿å¾—æŸ¥æ‰¾åˆ°çš„æ–‡æ¡£å’Œè¯ â€jakartaâ€œ çœ‹èµ·æ¥æ›´ç›¸å…³ä¸€äº›ã€‚ä¹Ÿå¯ä»¥å¯¹çŸ­è¯­è¿›è¡ŒåŠ æƒï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;&amp;amp;quot;jakarta apache&amp;amp;quot;^4 &amp;amp;quot;Apache Lucene&amp;amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é»˜è®¤ï¼ŒåŠ æƒç³»æ•°æ˜¯ 1ã€‚åŠ æƒç³»ç»Ÿå¯ä»¥å°äº 1ï¼ˆæ¯”å¦‚ï¼š0.2ï¼‰ï¼Œä½†å¿…é¡»å¤§äº 0ã€‚&lt;/p&gt;
&lt;h2&gt;å¸ƒå°”æ“ä½œç¬¦&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¸ƒå°”æ“ä½œç¬¦å…è®¸ä½¿ç”¨é€»è¾‘æ“ä½œç¬¦ç»„åˆå¤šä¸ªè¯ã€‚Lucene æ”¯æŒçš„å¸ƒå°”æ“ä½œç¬¦åŒ…å« &lt;code&gt;AND&lt;/code&gt;ã€&lt;code&gt;+&lt;/code&gt;ã€&lt;code&gt;OR&lt;/code&gt;ã€&lt;code&gt;NOT&lt;/code&gt; åŠ &lt;code&gt;-&lt;/code&gt;ï¼ˆå¤‡æ³¨ï¼šå¸ƒå°”æ“ä½œç¬¦å¿…é¡»å…¨éƒ¨æ˜¯å¤§å†™å­—æ¯ï¼‰ã€‚&lt;/p&gt;
&lt;h3&gt;OR&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;â€œORâ€ æ“ä½œç¬¦æ˜¯é»˜è®¤çš„è¿æ¥æ“ä½œç¬¦ã€‚è¿™æ„å‘³ç€å¦‚æœä¸¤ä¸ªè¯ä¹‹é—´æ²¡æœ‰å¸ƒå°”æ“ä½œç¬¦ï¼Œåˆ™ä½¿ç”¨ â€œORâ€ æ“ä½œç¬¦ã€‚OR æ“ä½œç¬¦é“¾æ¥ä¸¤ä¸ªè¯ï¼Œå¹¶åŒ¹é…åŒ…å«å…¶ä¸­ä»»æ„ä¸€ä¸ªè¯çš„æ–‡æ¡£ã€‚è¿™ç›¸å½“äºé›†åˆçš„å¹¶é›†æ“ä½œã€‚â€œ||â€ ç¬¦åˆå¯ç”¨äºæ›¿ä»£å•è¯ â€œORâ€ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ¯”å¦‚ï¼Œä½¿ç”¨å¦‚ä¸‹æŸ¥è¯¢è¯­å¥æ¥æœç´¢åŒ…å« â€œjakarta apacheâ€ æˆ–ä»…æ˜¯ â€œjakartaâ€ çš„æ–‡æ¡£ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;&amp;amp;quot;jakarta apache&amp;amp;quot; jakarta&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ–ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;&amp;amp;quot;jakarta apache&amp;amp;quot; OR jakarta&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;AND&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&quot;AND&quot; æ“ä½œç¬¦ä¼šåŒ¹é…æ–‡æœ¬å†…å®¹ä¸­åŒæ—¶å­˜åœ¨ä¸¤ä¸ªè¯ï¼ˆå› ä¸º AND æ˜¯äºŒå…ƒæ“ä½œç¬¦ï¼‰çš„æ–‡æ¡£ã€‚è¿™ç›¸å½“äºé›†åˆçš„äº¤é›†æ“ä½œã€‚â€œ&amp;&amp;â€ ç¬¦å·å¯ç”¨äºæ›¿ä»£å•è¯ â€œANDâ€ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ¯”å¦‚ï¼Œä½¿ç”¨å¦‚ä¸‹æŸ¥è¯¢è¯­å¥æ¥æœç´¢åŒ…å« â€œjakarta apacheâ€ å’Œ â€œApache Luceneâ€ çš„æ–‡æ¡£ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;&amp;amp;quot;jakarta apache&amp;amp;quot; AND â€œApache Luceneâ€&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;+&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;â€œ+â€ï¼ˆå¿…éœ€ï¼‰æ“ä½œç¬¦è¦æ±‚æ–‡æ¡£çš„æŸä¸ªåŸŸä¸­åŒ…å« â€œ+â€ ç¬¦å·ä¹‹åçš„è¯ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ¯”å¦‚ï¼Œä½¿ç”¨å¦‚ä¸‹æŸ¥è¯¢è¯­å¥æ¥æœç´¢ï¼ˆå¿…é¡»ï¼‰åŒ…å« â€œjakartaâ€ ä»¥åŠå¯èƒ½åŒ…å« â€œluceneâ€ï¼ˆåŒ…ä¸åŒ…å«éƒ½å¯ä»¥ï¼‰çš„æ–‡æ¡£ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;+jakarta lucene&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;NOT&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è‹¥æ–‡æ¡£åŒ…å«â€œNOTâ€ä¹‹åçš„è¯ï¼Œâ€œNOTâ€ æ“ä½œä¼šæ’æŸ¥è¯¥æ–‡æ¡£ã€‚è¿™ç›¸å½“äºé›†åˆçš„å·®é›†æ“ä½œã€‚â€œ!â€ ç¬¦å·å¯ç”¨äºæ›¿ä»£å•è¯ â€œNOTâ€ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ¯”å¦‚ï¼Œä½¿ç”¨å¦‚ä¸‹æŸ¥è¯¢è¯­å¥æœç´¢åŒ…å« â€jakarta apacheâ€œ ä½†ä¸åŒ…å« â€Apache Luceneâ€œ çš„æ–‡æ¡£â€ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;&amp;amp;quot;jakarta apache&amp;amp;quot; NOT &amp;amp;quot;Apache Lucene&amp;amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¤‡æ³¨ï¼šâ€œNOTâ€ æ“ä½œç¬¦ä¸å¯ä»¥ç”¨äºå•ä¸ªè¯ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹æœç´¢ä¸ä¼šè¿”å›ä»»ä½•ç»“æœï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;NOT &amp;amp;quot;jakarta apache&amp;amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;-&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœæ–‡æ¡£åŒ…å«â€-â€œç¬¦å·ä¹‹åçš„è¯ï¼Œé‚£ä¹ˆâ€-â€œï¼ˆç¦æ­¢ï¼‰æ“ä½œç¬¦ä¼šæ’é™¤è¿™äº›æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ¯”å¦‚ï¼Œä½¿ç”¨å¦‚ä¸‹æŸ¥è¯¢è¯­å¥æ¥æŸ¥è¯¢åŒ…å« â€jakarta apacheâ€œ ä½†ä¸åŒ…å« â€Apache Luceneâ€œ çš„æ–‡æ¡£ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;&amp;amp;quot;jakarta apache&amp;amp;quot; -&amp;amp;quot;Apache Lucene&amp;amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;åˆ†ç»„&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Lucene æ”¯æŒä½¿ç”¨åœ†æ‹¬å·å¯¹å­å¥è¿›è¡Œåˆ†ç»„ï¼Œæ„æˆå­æŸ¥è¯¢ã€‚å¦‚æœä½ æƒ³æ§åˆ¶ä¸€ä¸ªæŸ¥è¯¢è¯­å¥çš„å¸ƒå°”é€»è¾‘ï¼Œè¿™å¯¹éå¸¸æœ‰ç”¨ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ¯”å¦‚ï¼Œä½¿ç”¨å¦‚ä¸‹æŸ¥è¯¢è¯­å¥æ¥æœç´¢åŒ…å« â€œjakartaâ€ æˆ– â€œapacheâ€ï¼Œä»¥åŠ â€œwebsiteâ€ çš„æ–‡æ¡£ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;(jakarta OR apache) AND website&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æ­¤å°±æ¶ˆé™¤äº†ä»»ä½•å›°æƒ‘ï¼Œç¡®ä¿ä½ æƒ³è¡¨è¾¾æ˜¯ï¼šå¿…é¡»å­˜åœ¨ â€œwebsiteâ€ï¼Œä»¥åŠå¯èƒ½å­˜åœ¨è¯ â€œjakartaâ€ æˆ– â€œapacheâ€ã€‚&lt;/p&gt;
&lt;h2&gt;åŸŸåˆ†ç»„&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Lucene æ”¯æŒä½¿ç”¨åœ†æ‹¬å·å¯¹å•ä¸ªåŸŸçš„å¤šä¸ªå­å¥è¿›è¡Œåˆ†ç»„ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¾‹å¦‚ï¼Œè‹¥æƒ³æœç´¢ä¸€ä¸ª title ä¸­æ—¢åŒ…å«å•è¯â€œreturnâ€ä¸”åŒ…å«çŸ­è¯­â€œpink pantherâ€ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;title:(+return +&amp;amp;quot;pink panther&amp;amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Lucene æ”¯æŒå¯¹æŸ¥è¯¢è¯­æ³•ä½¿ç”¨çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ç§»ã€‚ç›®å‰è¿™äº›ç‰¹æ®Šå­—ç¬¦å¦‚ä¸‹åˆ—è¡¨æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;+ - &amp;amp;amp;&amp;amp;amp; || ! ( ) { } [ ] ^ &amp;amp;quot; ~ * ? : \ /&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨ç‰¹æ®Šå­—ç¬¦ä¹‹å‰åŠ  &lt;code&gt;\&lt;/code&gt; æ¥è½¬ä¹‰ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨å¦‚ä¸‹æŸ¥è¯¢è¯­å¥æ¥æœç´¢ &lt;code&gt;(1+1):2&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;\(1\+1\)\:2&lt;/code&gt;&lt;/pre&gt;</description>
            <pubDate>2019-09-04</pubDate>
            <link>https://blog.xiayf.cn/posts/lucene-query-parser-syntax.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/lucene-query-parser-syntax.html</guid>
        </item>
        
        <item>
            <title>ä¸€ä¸ª Python å°é¡¹ç›®çš„å°ç»“</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;å‰æ®µæ—¶é—´ä¸´æ—¶æ¥æ‰‹ä¸€ä¸ª Python å°é¡¹ç›®ï¼Œè¿™ä¸ªé¡¹ç›®å®ç°çš„ç±»ä¼¼ä¸€ä¸ªç®¡æ§å¹³å°ï¼Œå…¶ä¸­æ ¸å¿ƒåŠŸèƒ½æ˜¯ä¸ºç®—æ³•åŒå­¦æä¾›æœºå™¨å­¦ä¹ æ¨¡å‹è®­ç»ƒä»»åŠ¡çš„å…¨æµç¨‹ç®¡ç†ï¼Œå¹³å°åç«¯åŸºäº Flask æ¡†æ¶å®ç°ï¼Œå‰ç«¯åŸºäº Ant Design Pro å®ç°ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä»£ç ç¨å¾®æœ‰äº›ä¹±ï¼Œæ‰€ä»¥åšäº†éƒ¨åˆ†ä»£ç çš„é‡æ„ï¼Œåœ¨æ­¤åšç‚¹ç»éªŒå°ç»“ã€‚&lt;/p&gt;
&lt;h3&gt;1ã€å¹¶è¡ŒåŒ–æˆ–å¼‚æ­¥åŒ–&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;éƒ¨åˆ†è¯·æ±‚å¤„ç†é€»è¾‘ï¼Œç”±äºæ¯”è¾ƒè€—æ—¶ï¼Œæ•…ä½¿ç”¨çº¿ç¨‹æ± æ¥åŠ é€Ÿï¼Œæˆ–è€…ä½¿ç”¨ç‹¬ç«‹çº¿ç¨‹å¼‚æ­¥å¤„ç†ï¼Œæˆ–è€…å…ˆå­˜å‚¨ä¸€ä¸ªä¸­é—´çŠ¶æ€ï¼Œç”±åå°å®šæ—¶ä»»åŠ¡æ¥å®Œæˆå®é™…çš„å¤„ç†å·¥ä½œã€‚å¯¹äºå¼‚æ­¥å¤„ç†ç»“æœï¼Œå‰ç«¯é€šè¿‡è½®è¯¢æ¥è·å–ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;çº¿ç¨‹æ± çš„ä½¿ç”¨ï¼Œä¸»è¦ä½¿ç”¨ map æ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;from multiprocessing.dummy import Pool

input_list = [...]
pool: Pool = Pool(len(input_list))
pool.map(func, input_list)
pool.close()
pool.join()&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç‹¬ç«‹çº¿ç¨‹å¼‚æ­¥å¤„ç†ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;import multiprocessing

p = multiprocessing.Process(target=func, args=(...))
p.start()&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å®šæ—¶ä»»åŠ¡ï¼ŒåŸºäº apscheduler åº“å®ç°ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;from apscheduler.schedulers.background
import BackgroundScheduler

scheduler = BackgroundScheduler()
scheduler.add_join(func, &amp;amp;apos;interval&amp;amp;apos;, seconds=1)
scheduler.start()&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å› ä¸ºå¯¹äº Python åº”ç”¨ï¼Œé€šå¸¸ä¼šä½¿ç”¨ gunicorn è¿™ç§ WSGI HTTP æœåŠ¡å™¨ä»¥å¤šè¿›ç¨‹å¯åŠ¨å¤šä¸ªåº”ç”¨å®ä¾‹ï¼Œæå‡è¯·æ±‚ååèƒ½åŠ›ã€‚ä½†æ˜¯å¯¹äºå®šæ—¶ä»»åŠ¡æˆ‘ä»¬å¸Œæœ›åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¯¹æ­¤ï¼Œå¦‚æœä½¿ç”¨ gunicornï¼Œå¯ä»¥åŸºäºå®ƒçš„ preload æœºåˆ¶æ¥å®ç°ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;# wsgi.py
import app

if __name__ == &amp;amp;quot;__main__&amp;amp;quot;:
    app.run()&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;# æ³¨æ„å…¶ä¸­çš„ --preload å‚æ•°
gunicorn --workers=4 --preload --log-level=info --access-logfile=access.log -b 0.0.0.0:8080 wsgi:app&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;preload æœºåˆ¶ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ import app ç±»æ‰€åœ¨çš„æ¨¡å—åŠå…¶ä¾èµ–çš„å„ä¸ªæ¨¡å—ï¼ˆimport è¿‡ç¨‹ä¸­ä¼šæ‰§è¡Œå…¶ä¸­çš„è¯­å¥ï¼‰ï¼Œç„¶å fork å‡ºå¤šä¸ªè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æ‰§è¡Œ app.run()ã€‚&lt;/p&gt;
&lt;h4&gt;2ã€å®ç°ä¸€äº›é€šç”¨æ–¹æ¡ˆå¯¹å¼‚å¸¸è¿›è¡Œæ•è·æˆ–é‡è¯•&lt;/h4&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;def exception_try(times: int = 3, sleep_then_try_seconds=None):
    def decorator(f):
        def wrapper(*args, **kwargs):
            count = 0
            exception = None
            while count &amp;amp;lt; times:
                try:
                    return f(*args, **kwargs)
                except Exception as e:
                    exception = e
                    count += 1
                    logging.exception(&amp;amp;quot;Try {} times&amp;amp;quot;.format(count))
                    if (sleep_then_try_seconds is not None) and count &amp;amp;lt; times:
                        time.sleep(sleep_then_try_seconds)
            raise exception
        return wrapper
    return decorator&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;@exception_try(times=3, sleep_then_try_seconds=0.5)
def connect(self):
    return pymysql.connect(host=self.host, user=self.user, password=self.password, db=self.db, charset=self.charset)&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸ªè£…é¥°å™¨æ–¹æ³•ç”¨äºå®ç°å¼‚å¸¸é‡è¯•ï¼Œå¹¶ä¸”å¯ä»¥æŒ‡å®šé‡è¯•çš„æ—¶é—´é—´éš”ï¼Œå®é™…ä½¿ç”¨ä¸‹æ¥æ•ˆæœè¾ƒå¥½ã€‚è€Œä¸”ä¹Ÿä¸ä¼šå› ä¸º &lt;code&gt;try...except&lt;/code&gt; å¯¼è‡´å¤§å—ä»£ç ç¼©è¿›ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;ç¡®ä¿æ•°æ®åº“è¿æ¥å…³é—­ï¼ˆå…¶å®ƒç±»ä¼¼èµ„æºä¹Ÿå¯ä»¥è¿™æ ·å®ç°ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;def with_db(db: Connection, exception_callback=None):
    def decorator(f):
        def db_context(*a, **kw):
            try:
                return f(db, *a, **kw)
            except Exception as e:
                logging.exception(str(e))
                if exception_callback is not None:
                    exception_callback(e)
            finally:
                try:
                    db.close()
                except:
                    pass
        return db_context

    return decorator&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;# å°† conf.db.connect() å¯¹è±¡ä½œä¸º delete_task_from_job_queue çš„ç¬¬ä¸€ä¸ªå‚æ•°æ³¨å…¥ï¼Œtask_id è¿™ä¸ªå‚æ•°ä»¥ä¸å®šå‚æ•°çš„æ–¹å¼ä¼ å…¥ delete_task_from_job_queue
with_db(conf.db.connect())(delete_task_from_job_queue)(task_id)&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸ªè£…é¥°å™¨æ–¹æ³•ç”¨äºç¡®ä¿æ•°æ®åº“è¿æ¥åœ¨å¼‚å¸¸å‘ç”Ÿä¹Ÿèƒ½æ­£å¸¸å…³é—­ï¼Œé˜²æ­¢èµ„æºæ³„éœ²ã€‚&lt;/p&gt;
&lt;h4&gt;3ã€å¾ªç¯ç­‰å¾…æˆ–è¶…æ—¶&lt;/h4&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;class TimeoutCondition(object):

    def __init__(self, condition_func, timeout_seconds):
        self.condition = condition_func
        self.timeout = timeout_seconds
        self.begin = None
        self.timeout_false = True
        self.cond_true = True

    def __bool__(self):
        if self.begin is None:
            self.begin = timeit.default_timer()
        self.cond_true = self.condition()
        self.timeout_false = self.timeout &amp;amp;lt;= 0 or (timeit.default_timer() - self.begin) &amp;amp;lt; self.timeout
        return self.cond_true and self.timeout_false

    def is_timeout(self):
        return self.cond_true and not self.timeout_false&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;cond = TimeoutCondition(lambda : len(service_list) == 0, 5)
while cond:
    time.sleep(1)
    service_list = get_service_list()
if cond.is_timeout():
    return None, None&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;TimeoutCondition&lt;/code&gt; ç”¨äºå®ç°å¾ªç¯ç­‰å¾…æŸä¸ªæ¡ä»¶æ»¡è¶³ï¼Œä½†ä¸ºäº†é¿å…æ­»å¾ªç¯ï¼Œæ‰€ä»¥åŠ ä¸€ä¸ªè¶…æ—¶æ¡ä»¶åˆ¤æ–­ã€‚å®ä¾‹åŒ–å‚æ•°ç¬¬ä¸€ä¸ªæ˜¯åŸå§‹çš„æ¡ä»¶åˆ¤æ–­ lambda è¯­å¥ï¼Œç¬¬äºŒä¸ªæ˜¯ä¸€ä¸ªè¶…æ—¶è®¾ç½®ã€‚å¦å¤–ï¼Œå€ŸåŠ©é­”æœ¯æ–¹æ³• &lt;code&gt;__bool__&lt;/code&gt;ï¼Œè®© TimeoutCondtion çš„å®ä¾‹ç”¨èµ·æ¥åƒæ˜¯ä¸€ä¸ªå¸ƒå°”å˜é‡ï¼Œè°ƒç”¨ &lt;code&gt;is_timeout()&lt;/code&gt; æ–¹æ³•å¯ä»¥åŒºåˆ†å¾ªç¯ç­‰å¾…é€€å‡ºæ˜¯å› ä¸ºåŸå§‹æ¡ä»¶æ»¡è¶³ï¼Œè¿˜æ˜¯è¶…æ—¶é€€å‡ºçš„ã€‚&lt;/p&gt;
&lt;h4&gt;4ã€æŒ‰éƒ¨ç½²ç¯å¢ƒé…ç½®åº”ç”¨çš„è¡Œä¸º&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åº”ç”¨åœ¨ä¸åŒçš„ç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰ä¸­åº”è¯¥å…è®¸åŠ è½½ä¸åŒçš„é…ç½®ï¼Œé…ç½®ä¸åŒçš„è¡Œä¸ºã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å½“å‰åº”ç”¨å¤„äºä»€ä¹ˆç¯å¢ƒï¼Œå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡æ¥é…ç½®ï¼Œåº”ç”¨åˆå§‹åŒ–æ—¶æœ€å…ˆæ£€æµ‹å½“å‰å¤„äºä»€ä¹ˆç¯å¢ƒï¼Œä¹‹åçš„åˆå§‹åŒ–æµç¨‹å°±å¯ä»¥ä¾æ®ç¯å¢ƒé…ç½®æ¥åŠ è½½é…ç½®ï¼Œå®šåˆ¶åº”ç”¨è¡Œä¸ºã€‚&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;# conf/__init__.py
class AppConfig(object):
    app_env = os.getenv(&amp;amp;apos;APP_ENV&amp;amp;apos;, &amp;amp;apos;development&amp;amp;apos;)
    is_prod = app_env == &amp;amp;apos;production&amp;amp;apos;
    is_dev = app_env == &amp;amp;apos;development&amp;amp;apos;
    is_testing = app_env == &amp;amp;apos;testing&amp;amp;apos;
    
    # å…¶ä½™åº”ç”¨é…ç½®é¡¹
    ...

conf = AppConfig()


def _load_config_by_env(env: str):
    &amp;amp;apos;&amp;amp;apos;&amp;amp;apos;
    ä¸åŒç¯å¢ƒåŠ è½½ä¸åŒçš„é…ç½®æ–‡ä»¶
    é…ç½®ç›®å½•ç»“æ„ï¼š
    conf/
        __init__.py
        development.py
        production.py
        testing.py
    &amp;amp;apos;&amp;amp;apos;&amp;amp;apos;
    module = importlib.import_module(&amp;amp;apos;conf.{}&amp;amp;apos;.format(env))
    if not hasattr(module, &amp;amp;apos;Config&amp;amp;apos;):
        logging.warning(&amp;amp;apos;Not find {} config&amp;amp;apos;.format(env))
        return
    for name, value in getattr(module, &amp;amp;apos;Config&amp;amp;apos;).__dict__.items():
        if name.startswith(&amp;amp;apos;__&amp;amp;apos;):
            continue
        conf.__dict__[name] = value&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;# æ ¹æ®ç¯å¢ƒé…ç½®æ—¥å¿—çº§åˆ«
log_level = logging.INFO if conf.is_prod else logging.DEBUG
logging.basicConfig(format=consts.LOG_FORMAT, level=log_level)&lt;/code&gt;&lt;/pre&gt;
&lt;h4&gt;5ã€æ–¹ä¾¿æ’æŸ¥é—®é¢˜çš„æ—¥å¿—è¾“å‡º&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ—¥å¿—æ˜¯é—®é¢˜æ’æŸ¥çš„ä¸»è¦ä¿¡æ¯æ¥æºï¼Œæ‰€ä»¥æ—¥å¿—è®°å½•å¾—å¥½ä¸å¥½ï¼Œå¾ˆå…³é”®ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;# https://github.com/python/cpython/blob/3.7/Lib/logging/__init__.py#L457
# æ—¥å¿—æ—¶é—´ - æ—¥å¿—çº§åˆ« - ä»£ç æ–‡ä»¶è·¯å¾„ - è¡Œå· - è¿›ç¨‹ ID - çº¿ç¨‹åç§° - æ—¥å¿—å†…å®¹
LOG_FORMAT = &amp;amp;apos;%(asctime)-15s - %(levelname)s - %(pathname)s - %(lineno)d - %(process)d - %(threadName)s - %(message)s&amp;amp;apos;&lt;/code&gt;&lt;/pre&gt;
&lt;h4&gt;6ã€API è§„èŒƒä¸å¼‚å¸¸æç¤º&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸ºäº†ç»Ÿä¸€å‰ç«¯ API å“åº”å¤„ç†ï¼Œæœ‰å¿…è¦å¯¹ API å“åº”ä½“çš„ç»“æ„æŒ‡å®šæ ‡å‡†ã€‚ä»¥æˆ‘ä¸ªäººçš„ä¹ æƒ¯ï¼Œæ‰€æœ‰ä»åº”ç”¨ä»£ç ä¸­è¿”å›çš„å“åº”ï¼ŒHTTP çŠ¶æ€ç éƒ½åº”è¯¥æ˜¯ 200ï¼Œå…·ä½“å½“å‰ API è¯·æ±‚æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œå¦‚æœå¤±è´¥ï¼Œå¤±è´¥çš„åŸå› æ˜¯ä»€ä¹ˆéƒ½åº”è¯¥åŒ…å«åœ¨å“åº”ä½“ä¸­ï¼Œå“åº”ä½“å¤§è‡´çš„ç»“æ„ä¸ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-json&quot;&gt;&lt;code&gt;{
    &amp;amp;quot;code&amp;amp;quot;: ...,
    &amp;amp;quot;msg&amp;amp;quot;: &amp;amp;quot;...&amp;amp;quot;,
    &amp;amp;quot;data&amp;amp;quot;: ...
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;code è¡¨ç¤ºè¯·æ±‚å¤„ç†å¤±è´¥æ—¶ï¼Œdata å­—æ®µå¯é€‰ï¼Œcode è¡¨ç¤ºè¯·æ±‚å¤„ç†æˆåŠŸæ—¶ï¼Œmsg å­—æ®µå¯é€‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å‰ç«¯é…åˆå¯¹å“åº”ä½“è¿›è¡Œç»Ÿä¸€æ£€æµ‹å’Œæç¤ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code&gt;import { notification } from &amp;amp;apos;antd&amp;amp;apos;;

function defaultHTTPCodeHandler(response) {
  if (response.status &amp;amp;gt;= 400) {
    // æ³¨æ„ clone
    response.clone().text().then(respBody =&amp;amp;gt; {
      notification.error({message: &amp;amp;apos;API å¼‚å¸¸å“åº”&amp;amp;apos;, description: `${response.status}, ${respBody}`, duration: null});
      console.log(`${response.status}, ${respBody}`);
    });
  }
}

function defaultMsgCodeHandler(response) {
  if (response.status === 200) {
    // æ³¨æ„ clone
    response.clone().json().then(jsonBody =&amp;amp;gt; {
      // 0ã€200ã€10000 éƒ½å±äºæˆåŠŸå“åº”
      if (jsonBody !== undefined &amp;amp;amp;&amp;amp;amp; jsonBody.code !== undefined &amp;amp;amp;&amp;amp;amp; jsonBody.code !== 0 &amp;amp;amp;&amp;amp;amp; jsonBody.code !== 200 &amp;amp;amp;&amp;amp;amp; jsonBody.code != 10000) {
        notification.error({message: &amp;amp;apos;è¯·æ±‚å¤±è´¥&amp;amp;apos;, description: `${jsonBody.code}, ${jsonBody.msg}`, duration: null});
        console.log(`${jsonBody.code}, ${jsonBody.msg}`);
      }
    });
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¹¶ä¸”ç»Ÿä¸€å°è£…å‘èµ·è¯·æ±‚çš„é€»è¾‘ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code&gt;export function corsFetch(url, init, httpCodeCallback, msgCodeCallback) {
  const host = myHost();
  let urlPrefix = host;
  // è‡ªå¸¦ hostï¼Œåˆ™ä¸é¢å¤–è¡¥å…… host å‰ç¼€
  if (url.startsWith(&amp;amp;quot;http://&amp;amp;quot;) || url.startsWith(&amp;amp;quot;https://&amp;amp;quot;)) {
    urlPrefix = &amp;amp;apos;&amp;amp;apos;;
  }
  const httpCodeHandler = httpCodeCallback === undefined ? defaultHTTPCodeHandler : httpCodeCallback;
  const msgCodeHandler = msgCodeCallback === undefined ? defaultMsgCodeHandler : msgCodeCallback;
  // å¯¹äºçº¿ä¸Šç¯å¢ƒæˆ–è€…æµ‹è¯•ç¯å¢ƒï¼Œä¸è·¨åŸŸ
  if (host === PROD_ENV_HOST || host === TEST_ENV_HOST) {
    const promise = fetch(urlPrefix + url, init);
    promise.then((response) =&amp;amp;gt; httpCodeHandler(response));
    promise.then((response) =&amp;amp;gt; msgCodeHandler(response));
    return promise;
  }
  // å¯¹äºæœ¬åœ°æµ‹è¯•ç¯å¢ƒï¼Œè·¨åŸŸè®¿é—®é¢„å‘ç¯å¢ƒ API æ•°æ®ï¼Œæ–¹ä¾¿æµ‹è¯•
  let corsInit = {
    credentials: &amp;amp;apos;include&amp;amp;apos;,
    mode: &amp;amp;apos;cors&amp;amp;apos;,
    redirect: &amp;amp;apos;follow&amp;amp;apos;,
  };
  if (init !== undefined) {
    corsInit = { ...corsInit, ...init };
  }
  if (urlPrefix !== &amp;amp;apos;&amp;amp;apos;) {
    urlPrefix = TEST_ENV_HOST;
  }
  const promise = fetch(urlPrefix + url, corsInit);
  promise.then((response) =&amp;amp;gt; httpCodeHandler(response));
  promise.then((response) =&amp;amp;gt; msgCodeHandler(response));
  return promise;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å…¶ä¸­ä¸ºäº†æ–¹ä¾¿æœ¬åœ°å¼€å‘æµ‹è¯•ï¼Œå…è®¸æœ¬åœ°å¼€å‘ç¯å¢ƒè·¨åŸŸè®¿é—®æµ‹è¯•ç¯å¢ƒï¼ˆæœ€å¥½ä¸è¦ç›´æ¥è·¨è¶Šè®¿é—®ç”Ÿäº§ç¯å¢ƒï¼‰ï¼Œå¹¶ä¸”è‡ªåŠ¨åŒºåˆ†ï¼ŒcorsFetch è°ƒç”¨æ–¹æ— æ„ŸçŸ¥ã€‚&lt;/p&gt;</description>
            <pubDate>2019-08-14</pubDate>
            <link>https://blog.xiayf.cn/posts/a-python-project-summary.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/a-python-project-summary.html</guid>
        </item>
        
        <item>
            <title>Reactor å®˜æ–¹æ–‡æ¡£ï¼ˆç®€è¯‘ï¼‰</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;åŸæ–‡ï¼š&lt;a href=&apos;https://projectreactor.io/docs/core/release/reference/&apos;&gt;Reactor 3 Reference Guide&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;1. èµ·æ­¥&lt;/h2&gt;
&lt;h3&gt;1.1 Reactor ç®€ä»‹&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Reactor æ˜¯ä¸º JVM å‡†å¤‡çš„ä¸€ä¸ªå®Œå…¨éé˜»å¡çš„ååº”å¼ç¼–ç¨‹åŸºç¡€ç»„ä»¶ï¼Œæ”¯æŒé«˜æ•ˆçš„éœ€æ±‚ç®¡ç†ï¼ˆä»¥ç®¡ç†â€œåå‹â€çš„å½¢å¼ï¼‰ï¼Œç›´æ¥ä¸ Java 8 çš„å‡½æ•°å¼ API é›†æˆï¼Œå°¤å…¶æ˜¯ &lt;code&gt;CompletableFuture&lt;/code&gt;ã€&lt;code&gt;Stream&lt;/code&gt; ä»¥åŠ &lt;code&gt;Duration&lt;/code&gt;ï¼Œæä¾›å¯ç»„åˆçš„å¼‚æ­¥åºåˆ— API - &lt;code&gt;Flux&lt;/code&gt;ï¼ˆé€‚ç”¨äº N ä¸ªå…ƒç´ çš„åºåˆ—ï¼‰å’Œ &lt;code&gt;Mono&lt;/code&gt;ï¼ˆé€‚ç”¨äº 0 æˆ– 1ä¸ªå…ƒç´ çš„åºåˆ—ï¼‰--- å¹¶ä¸”å…¨é¢åœ°ï¼ˆextensivelyï¼‰å®ç°äº† &lt;a href=&apos;https://www.reactive-streams.org/&apos;&gt;ååº”å¼æµï¼ˆReative Streamsï¼‰&lt;/a&gt; è§„èŒƒã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å€ŸåŠ© &lt;code&gt;reactor-netty&lt;/code&gt; é¡¹ç›®ï¼ŒReactor ä¹Ÿæ”¯æŒè¿›ç¨‹é—´çš„éé˜»å¡é€šä¿¡ï¼Œé€‚ç”¨äºå¾®æœåŠ¡æ¶æ„ã€‚&lt;code&gt;reactor-netty&lt;/code&gt; ä¸º HTTPï¼ˆåŒ…æ‹¬ Websocketsï¼‰ã€TCP ä»¥åŠ UDP æä¾›æ”¯æŒåå‹çš„ç½‘ç»œå¼•æ“ï¼Œå®Œå…¨æ”¯æŒååº”å¼ç¼–ç è§£ç ã€‚&lt;/p&gt;
&lt;h3&gt;1.2 ç†è§£ BOM&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Reactor 3 å¼€å§‹é‡‡ç”¨ BOM ï¼ˆBill of Materialsï¼Œç‰©æ–™æ¸…å•ï¼‰å‘å¸ƒæ¨¡å‹ï¼ˆè‡ª &lt;code&gt;reactor-core 3.0.4&lt;/code&gt; å¼€å§‹ï¼Œä½¿ç”¨ &lt;code&gt;Aluminium&lt;/code&gt;ï¼ˆé“ï¼‰ç‰ˆæœ¬åºåˆ—ï¼‰ï¼Œä¸€ä¸ªç‰ˆæœ¬åŒ…å«ä¸€ç»„ç›¸å…³ç»„ä»¶çš„ç‰ˆæœ¬ï¼Œè¿™äº›ç‰ˆæœ¬ç»„ä»¶ä¹‹é—´å…¼å®¹æ€§éå¸¸å¥½ï¼Œå…è®¸è¿™äº›ç»„ä»¶é‡‡ç”¨ä¸åŒçš„ç‰ˆæœ¬å‘½åæ–¹å¼ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;BOM å‘å¸ƒæ¨¡å‹æœ¬èº«ä¹Ÿæ˜¯ç‰ˆæœ¬åŒ–çš„ï¼Œä»¥ä¸€ä¸ªä»£å·åæ¥ä¸€ä¸ªä¿®é¥°è¯æ¥å‘½åä¸€ä¸ªç‰ˆæœ¬åºåˆ—ã€‚å¦‚ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹åˆ—è¡¨ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;Aluminium-RELEASE
Californium-BUILD-SNAPSHOT
Aluminium-SR1
Bismuth-RELEASE
Californium-SR32&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä»£å·ç­‰ä»·äºå¸¸è§„çš„ &lt;code&gt;å¤§ç‰ˆæœ¬å·.å°ç‰ˆæœ¬å·&lt;/code&gt; å½¢å¼ï¼Œé€šå¸¸ä»¥å­—æ¯å‡åºæ–¹å¼å–è‡ª &lt;a href=&apos;https://en.wikipedia.org/wiki/Periodic_table#Overview&apos;&gt;å…ƒç´ å‘¨æœŸè¡¨&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æŒ‰ç…§æ—¶é—´é¡ºåºï¼Œä¿®é¥°è¯åˆ†åˆ«ä¸ºå¦‚ä¸‹å‡ ä¸ªï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;BUILD-SNAPSHOTï¼šä¸ºå¼€å‘æµ‹è¯•æ„å»ºçš„ç‰ˆæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;M1 .. Nï¼šé‡Œç¨‹ç¢‘ç‰ˆæœ¬æˆ–è€…å¼€å‘è€…é¢„è§ˆç‰ˆæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;RELEASEï¼šä¸€ä¸ªä»£å·ç³»åˆ—ä¸­çš„é¦–ä¸ª GAï¼ˆGeneral Availability é€šç”¨ï¼‰å‘è¡Œç‰ˆã€‚&lt;/li&gt;
&lt;li&gt;SR1 .. Nï¼šä¸€ä¸ªä»£å·ç³»åˆ—ä¸­çš„åç»­ GA å‘è¡Œç‰ˆ - ç›¸å½“äºä¸€ä¸ªè¡¥ä¸ç‰ˆæœ¬ã€‚ï¼ˆSR ä»£è¡¨ â€œService Releaseâ€ï¼ˆæœåŠ¡ç‰ˆæœ¬ï¼‰ï¼‰&lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;1.3 å¦‚ä½•è·å– Reactor&lt;/h3&gt;
&lt;h4&gt;1.3.1 ä»¥ Maven ç®¡ç†ä¾èµ–åŒ…&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Maven åŸç”Ÿæ”¯æŒ BOM æ¨¡å‹æ¦‚å¿µã€‚é¦–å…ˆï¼Œåœ¨ä½ çš„ &lt;code&gt;pom.xml&lt;/code&gt; æ–‡ä»¶æ·»åŠ å¦‚ä¸‹ä»£ç ç‰‡æ®µæ¥å¼•å…¥ BOMï¼š&lt;/p&gt;
&lt;pre class=&quot;language-xml&quot;&gt;&lt;code&gt;&amp;amp;lt;dependencyManagement&amp;amp;gt; 
    &amp;amp;lt;dependencies&amp;amp;gt;
        &amp;amp;lt;dependency&amp;amp;gt;
            &amp;amp;lt;groupId&amp;amp;gt;io.projectreactor&amp;amp;lt;/groupId&amp;amp;gt;
            &amp;amp;lt;artifactId&amp;amp;gt;reactor-bom&amp;amp;lt;/artifactId&amp;amp;gt;
            &amp;amp;lt;version&amp;amp;gt;Bismuth-RELEASE&amp;amp;lt;/version&amp;amp;gt;
            &amp;amp;lt;type&amp;amp;gt;pom&amp;amp;lt;/type&amp;amp;gt;
            &amp;amp;lt;scope&amp;amp;gt;import&amp;amp;lt;/scope&amp;amp;gt;
        &amp;amp;lt;/dependency&amp;amp;gt;
    &amp;amp;lt;/dependencies&amp;amp;gt;
&amp;amp;lt;/dependencyManagement&amp;amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœé¡¶éƒ¨æ ‡ç­¾ï¼ˆ&lt;code&gt;dependencyManagement&lt;/code&gt;ï¼‰å·²ç»å­˜åœ¨ï¼Œåˆ™åªæ·»åŠ ä¸Šé¢è¯¥æ ‡ç­¾çš„å†…éƒ¨å†…å®¹ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ¥ä¸‹æ¥ï¼Œå°†ä¾èµ–åŒ…æ·»åŠ åˆ°é¡¹ç›®ä¸­ï¼Œå’Œä¸€èˆ¬ä¾èµ–åŒ…ä¸€æ ·ï¼Œä¸è¿‡æ²¡æœ‰ &lt;code&gt;&amp;lt;version&amp;gt;&lt;/code&gt;ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-xml&quot;&gt;&lt;code&gt;&amp;amp;lt;dependencies&amp;amp;gt;
    &amp;amp;lt;dependency&amp;amp;gt;
        &amp;amp;lt;groupId&amp;amp;gt;io.projectreactor&amp;amp;lt;/groupId&amp;amp;gt;
        &amp;amp;lt;artifactId&amp;amp;gt;reactor-core&amp;amp;lt;/artifactId&amp;amp;gt; 
    &amp;amp;lt;/dependency&amp;amp;gt;
    &amp;amp;lt;dependency&amp;amp;gt;
        &amp;amp;lt;groupId&amp;amp;gt;io.projectreactor&amp;amp;lt;/groupId&amp;amp;gt;
        &amp;amp;lt;artifactId&amp;amp;gt;reactor-test&amp;amp;lt;/artifactId&amp;amp;gt; 
        &amp;amp;lt;scope&amp;amp;gt;test&amp;amp;lt;/scope&amp;amp;gt;
    &amp;amp;lt;/dependency&amp;amp;gt;
&amp;amp;lt;/dependencies&amp;amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h4&gt;1.3.2 ä»¥ Gradle ç®¡ç†ä¾èµ–åŒ…&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Gradle æ ¸å¿ƒå¹¶ä¸æ”¯æŒ Maven BOMï¼Œä¸è¿‡å¯ä»¥å€ŸåŠ© Spring çš„ &lt;a href=&apos;https://github.com/spring-gradle-plugins/dependency-management-plugin&apos;&gt;gradle-dependency-management&lt;/a&gt; æ’ä»¶ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é¦–å…ˆï¼Œåº”ç”¨æ’ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-gradle&quot;&gt;&lt;code&gt;plugins {
    id &amp;amp;quot;io.spring.dependency-management&amp;amp;quot; version &amp;amp;quot;1.0.6.RELEASE&amp;amp;quot;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç„¶åä½¿ç”¨å®ƒæ¥å¼•å…¥ BOMï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-gradle&quot;&gt;&lt;code&gt;dependencyManagement {
     imports {
          mavenBom &amp;amp;quot;io.projectreactor:reactor-bom:Bismuth-RELEASE&amp;amp;quot;
     }
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ€åå°†ä¾èµ–æ·»åŠ åˆ°é¡¹ç›®ä¸­ï¼Œæ— éœ€æŒ‡å®šç‰ˆæœ¬å·ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-gradle&quot;&gt;&lt;code&gt;dependencies {
     compile &amp;amp;apos;io.projectreactor:reactor-core&amp;amp;apos; 
}&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;2. ååº”å¼ç¼–ç¨‹ç®€ä»‹&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Reactor æ˜¯ååº”å¼ç¼–ç¨‹èŒƒå¼çš„ä¸€ä¸ªå®ç°ã€‚ååº”å¼ç¼–ç¨‹çš„å®šä¹‰å½’çº³èµ·æ¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;ååº”å¼ç¼–ç¨‹æ˜¯ä¸€ä¸ªå¼‚æ­¥ç¼–ç¨‹èŒƒå¼ï¼Œå…³æ³¨æ•°æ®æµå’Œå˜åŒ–çš„ä¼ æ’­ã€‚è¿™æ„å‘³ç€é€šè¿‡è¢«é‡‡ç”¨ç¼–ç¨‹è¯­è¨€å¯ä»¥è½»æ¾åœ°è¡¨è¾¾é™æ€ï¼ˆæ¯”å¦‚ æ•°ç»„ï¼‰æˆ–åŠ¨æ€ï¼ˆæ¯”å¦‚ äº‹ä»¶å‘å°„å™¨ï¼‰æ•°æ®æµã€‚ --- https://en.wikipedia.org/wiki/Reactive_programming&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ååº”å¼ç¼–ç¨‹æ–¹å‘çš„é¦–ä¸ªé‡è¦å·¥ä½œæ˜¯ï¼šå¾®è½¯åœ¨ .NET ç”Ÿæ€ä½“ç³»ä¸­åˆ›å»ºäº†ååº”å¼æ‰©å±•ï¼ˆRxï¼‰åº“ï¼Œç„¶å RxJava åœ¨ JVM ä¸Šå®ç°äº†ååº”å¼ç¼–ç¨‹ã€‚æ—¶å…‰é£é€ï¼Œç» Reative Streams çš„å¤§åŠ›æ¨è¿›ï¼ŒJava ç¤¾åŒºç»ˆäºå‡ºç°äº†ååº”å¼ç¼–ç¨‹æ ‡å‡†ï¼Œè¯¥è§„èŒƒå®šä¹‰äº†ä¸€ç»„æ¥å£ä»¥åŠ JVM ä¸Šååº”å¼ç¼–ç¨‹åº“ä¹‹é—´çš„äº¤äº’è§„åˆ™ã€‚Java 9 æ ‡å‡†åº“å·²å°†è¿™ç»„æ¥å£é›†æˆåˆ° &lt;code&gt;Flow&lt;/code&gt; ç±»ï¼ˆè¯‘æ³¨ï¼šè§&lt;a href=&apos;https://docs.oracle.com/javase/9/docs/api/java/util/concurrent/Flow.html&apos;&gt;https://docs.oracle.com/javase/9/docs/api/java/util/concurrent/Flow.html&lt;/a&gt;ï¼‰ä¸­ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ååº”å¼ç¼–ç¨‹èŒƒå¼åœ¨é¢å‘å¯¹è±¡è¯­è¨€ä¸­é€šå¸¸è¡¨ç°ä¸ºä¸€ä¸ªè§‚å¯Ÿè€…è®¾è®¡æ¨¡å¼çš„æ‰©å±•ã€‚ä½ ä¹Ÿå¯ä»¥å°†ä¸»æµçš„ååº”å¼æµæ¨¡å¼ï¼ˆreactive streams patternï¼‰å’Œå¤§å®¶ç†ŸçŸ¥çš„è¿­ä»£å™¨è®¾è®¡æ¨¡å¼åšå¯¹æ¯”ï¼Œæ‰€æœ‰è¿™äº›åº“ä¸­éƒ½å­˜åœ¨å¯¹æ ‡äº &lt;code&gt;Iterable&lt;/code&gt; - &lt;code&gt;Iterator&lt;/code&gt; çš„æ¦‚å¿µï¼ˆè¯‘æ³¨ï¼šæ¯”å¦‚ å‘å¸ƒè€…-æ¶ˆè´¹è€…ï¼‰ã€‚ä¸»è¦å·®åˆ«åœ¨äºï¼šè¿­ä»£å™¨æ˜¯åŸºäº pull æ–¹å¼ï¼Œååº”å¼æµåˆ™åŸºäº push æ–¹å¼ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½¿ç”¨è¿­ä»£å™¨æ˜¯ä¸€ä¸ªå‘½ä»¤å¼ç¼–ç¨‹çš„æ¨¡å¼ï¼Œå³ä½¿å¦‚ä½•è®¿é—®æ•°æ®ï¼ˆaccessing valuesï¼‰å®Œå…¨æ˜¯ &lt;code&gt;Iterable&lt;/code&gt; çš„èŒè´£ï¼Œä½†å®é™…ä¸Šï¼Œä½•æ—¶è®¿é—®åºåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªï¼ˆ&lt;code&gt;next()&lt;/code&gt;ï¼‰å€¼å–å†³äºå¼€å‘è€…çš„é€‰æ‹©ã€‚åœ¨ååº”å¼æµä¸­ï¼Œä¸Šè¿° &lt;code&gt;Iterable&lt;/code&gt; - &lt;code&gt;Iterator&lt;/code&gt; å¯¹çš„ç­‰ä»·ç‰©ä¸º &lt;code&gt;Publisher&lt;/code&gt; - &lt;code&gt;Subscriber&lt;/code&gt;ã€‚ä¸è¿‡ï¼Œåœ¨å‡ºç°æ–°çš„æ•°æ®/äº‹ä»¶æ—¶ï¼Œç”± &lt;code&gt;Publisher&lt;/code&gt; é€šçŸ¥ &lt;code&gt;Subscriber&lt;/code&gt;ï¼Œè¿™ä¸ªâ€œæ¨â€ç‰¹æ€§ä¹Ÿæ˜¯å®ç°ååº”å¼çš„å…³é”®ä¹‹å¤„ã€‚å¹¶ä¸”ï¼Œåœ¨è¢«æ¨é€çš„å€¼ä¸Šåº”ç”¨å“ªäº›æ“ä½œæ˜¯å£°æ˜å¼è¡¨è¾¾è€Œä¸æ˜¯å‘½ä»¤å¼è¡¨è¾¾çš„ï¼šç¨‹åºå‘˜è¡¨è¾¾çš„æ˜¯è®¡ç®—é€»è¾‘è€Œä¸æ˜¯æè¿°ç²¾ç¡®çš„æ§åˆ¶æµã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é™¤äº†â€œæ¨â€çš„ç‰¹æ€§ï¼Œååº”å¼æµä¹Ÿè‰¯å¥½åœ°å®šä¹‰äº†å¦‚ä½•å¤„ç†é”™è¯¯å’Œç»“æŸæµã€‚ä¸€ä¸ª &lt;code&gt;Publisher&lt;/code&gt; å¯ä»¥å‘å®ƒçš„ &lt;code&gt;Subscriber&lt;/code&gt; æ¨é€æ–°çš„å€¼ï¼ˆé€šè¿‡è°ƒç”¨è®¢é˜…è€…çš„ &lt;code&gt;onNext&lt;/code&gt; æ–¹æ³•ï¼‰ï¼Œä¹Ÿå¯ä»¥æ¨é€é”™è¯¯ï¼ˆè°ƒç”¨ &lt;code&gt;onError&lt;/code&gt; æ–¹æ³•ï¼‰æˆ–ç»“æŸï¼ˆè°ƒç”¨ &lt;code&gt;onComplete&lt;/code&gt;æ–¹æ³•ï¼‰ä¿¡å·ã€‚é”™è¯¯å’Œç»“æŸä¿¡å·éƒ½å¯ä»¥ç»ˆç»“äº‹ä»¶åºåˆ—ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;onNext x 0..N [onError | onComplete]&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸ªæ–¹å¼éå¸¸çµæ´»ã€‚è¿™ä¸ªæ¨¡å¼æ”¯æŒâ€œæ²¡æœ‰å€¼â€ã€â€œä¸€ä¸ªå€¼â€æˆ–â€œnä¸ªå€¼â€ï¼ˆåŒ…æ‹¬å€¼æ— é™çš„åºåˆ—ï¼Œæ¯”å¦‚æ—¶é’Ÿçš„æŒç»­æ»´ç­”äº‹ä»¶ï¼‰çš„å„ç§ä½¿ç”¨åœºæ™¯ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½†æ˜¯ï¼Œèµ·åˆï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·ä¸€ä¸ªå¼‚æ­¥çš„ååº”å¼çš„ç¼–ç¨‹åº“ï¼Ÿ&lt;/p&gt;
&lt;h3&gt;2.1 é˜»å¡å³æ˜¯èµ„æºæµªè´¹&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç°ä»£çš„è½¯ä»¶åº”ç”¨ï¼Œå¹¶å‘ç”¨æˆ·é‡éå¸¸å·¨å¤§ï¼Œå³ä½¿ç°ä»£ç¡¬ä»¶çš„å¤„ç†èƒ½åŠ›ä¸€ç›´åœ¨æå‡ï¼Œè½¯ä»¶çš„æ€§èƒ½ä»æ—§æ˜¯ä¸€ä¸ªå…³é”®é—®é¢˜ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å®½æ³›æ¥è®²ï¼Œæå‡ä¸€ä¸ªç¨‹åºçš„æ€§èƒ½ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;å¹¶è¡ŒåŒ–&lt;/strong&gt; ä½¿ç”¨æ›´å¤šçš„çº¿ç¨‹å’Œæ›´å¤šçš„ç¡¬ä»¶èµ„æºã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºå½“å‰çš„ç¡¬ä»¶èµ„æºï¼Œ&lt;strong&gt;å¯»æ±‚æ›´é«˜æ•ˆçš„ä½¿ç”¨æ–¹å¼&lt;/strong&gt;ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é€šå¸¸ï¼ŒJava å¼€å‘è€…ä¼šä½¿ç”¨é˜»å¡æ€§çš„ä»£ç ç¼–å†™ç¨‹åºï¼Œè¿™ç§ä»£ç ç¼–å†™æ–¹å¼å®¹æ˜“è§¦åŠæ€§èƒ½ç“¶é¢ˆï¼Œç„¶åå¼•å…¥æ›´å¤šçš„çº¿ç¨‹æ¥è¿è¡Œç›¸ä¼¼çš„é˜»å¡æ€§ä»£ç ã€‚ä½†æ˜¯ï¼Œè¿™ç§èµ„æºåˆ©ç”¨çš„æ‰©å±•æ–¹å¼å¾ˆå¿«å°±ä¼šå¼•å‘ç«æ€ï¼ˆcontentionï¼‰å’Œå¹¶å‘çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ›´ç³Ÿç³•çš„æ˜¯ï¼Œé˜»å¡å°±æ„å‘³ç€æµªè´¹èµ„æºã€‚å¦‚æœä½ ç¨åŠ åˆ†æï¼Œå°±ä¼šå‘ç°ä¸€æ—¦ç¨‹åºç‰µæ¶‰ä¸€äº›ç­‰å¾…å»¶è¿Ÿï¼ˆå°¤å…¶æ˜¯ I/0 æ“ä½œï¼Œæ¯”å¦‚ç­‰å¾…ä¸€ä¸ªæ•°æ®åº“è¯·æ±‚æˆ–è€…ä¸€ä¸ªç½‘ç»œè°ƒç”¨ï¼‰ï¼Œèµ„æºå°±ä¼šè¢«æµªè´¹ï¼Œå› ä¸ºæ­¤æ—¶çº¿ç¨‹ï¼ˆå¯èƒ½æ˜¯å¤§é‡çº¿ç¨‹ï¼‰æ˜¯ç©ºé—²çš„ï¼Œç­‰å¾…ç€æ•°æ®ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å› æ­¤ï¼Œå¹¶è¡ŒåŒ–æ–¹å¼å¹¶éé“¶å¼¹ã€‚ä¸ºäº†å‹æ¦¨å‡ºç¡¬ä»¶çš„å…¨éƒ¨èƒ½åŠ›ï¼Œå¹¶è¡ŒåŒ–æ˜¯å¿…è¦çš„ï¼Œä½†å¹¶è¡ŒåŒ–çš„ä»£ç ç†è§£ï¼ˆreason aboutï¼‰èµ·æ¥ä¹Ÿéå¸¸å¤æ‚ï¼Œå®é™…å¨åŠ›ä¹Ÿä¼šå› ä¸ºèµ„æºæµªè´¹è€Œå¤§æ‰“æŠ˜æ‰£ã€‚&lt;/p&gt;
&lt;h3&gt;2.2 å¼‚æ­¥å¯ä»¥è§£å†³é—®é¢˜å—ï¼Ÿ&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å‰é¢æåˆ°çš„ç¬¬äºŒç§æ–¹å¼ - å¯»æ±‚æ›´é«˜æ•ˆçš„ä½¿ç”¨æ–¹å¼ - æ˜¯èµ„æºæµªè´¹é—®é¢˜çš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚é€šè¿‡ç¼–å†™å¼‚æ­¥éé˜»å¡çš„ä»£ç ï¼Œåœ¨å‘ç”Ÿé˜»å¡ç­‰å¾…æ—¶ï¼Œåˆ‡æ¢æ‰§è¡Œå¦ä¸€ä¸ªæ´»è·ƒä»»åŠ¡ï¼Œæ´»è·ƒä»»åŠ¡ä½¿ç”¨çš„æ˜¯ç›¸åŒçš„åº•å±‚èµ„æºï¼Œç„¶ååœ¨å¼‚æ­¥å¤„ç†è¿‡ç¨‹ç»“æŸåå†åˆ‡å›åˆ°å½“å‰è¿›ç¨‹æ¥æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½†æ˜¯æˆ‘ä»¬å¦‚ä½•ç¼–å†™åœ¨ JVM ä¸Šå¼‚æ­¥æ‰§è¡Œçš„ä»£ç ï¼Ÿ Java æä¾›äº†ä¸¤ç§å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;å›è°ƒ&lt;/strong&gt;ï¼šå¼‚æ­¥æ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼Œä½†æ¥å—ä¸€ä¸ªé¢å¤–çš„ &lt;code&gt;callbackï¼ˆå›è°ƒï¼‰&lt;/code&gt;å‚æ•°ï¼ˆä¸€ä¸ª lambda è¡¨è¾¾å¼æˆ–åŒ¿åç±»ï¼‰ï¼Œåœ¨å¾—åˆ°å¼‚æ­¥å¤„ç†ç»“æœæ—¶ä¼šè°ƒç”¨è¿™ä¸ªå›è°ƒã€‚ä¸€ä¸ªä¼—æ‰€å‘¨çŸ¥çš„ä¾‹å­æ˜¯ Swing çš„ &lt;code&gt;EventListener&lt;/code&gt; æ´¾ç”Ÿç±»ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Future&lt;/strong&gt;ï¼šè¿™ç§å¼‚æ­¥æ–¹æ³•åœ¨è°ƒç”¨æ—¶ä¼š&lt;em&gt;å³åˆ»&lt;/em&gt;è¿”å›ä¸€ä¸ª &lt;code&gt;Future&amp;lt;T&amp;gt;&lt;/code&gt;ã€‚è¿™ä¸ªå¼‚æ­¥è¿‡ç¨‹ä¼šè®¡ç®—å‡ºä¸€ä¸ª &lt;code&gt;T&lt;/code&gt; ç±»å‹çš„å€¼ï¼Œä¸è¿‡éœ€è¦é€šè¿‡ &lt;code&gt;Future&lt;/code&gt; å¯¹è±¡æ¥è®¿é—®ã€‚è®¡ç®—å‡ºæ¥çš„å€¼ä¸èƒ½ç«‹å³å¯ç”¨ï¼Œå¯ä»¥å¯¹ &lt;code&gt;Future&lt;/code&gt; å¯¹è±¡è¿›è¡Œæ¢è¯¢ç›´åˆ°å€¼è®¡ç®—å‡ºæ¥ã€‚ä¾‹å¦‚ï¼š&lt;code&gt;ExecutorService&lt;/code&gt; è¿è¡Œ &lt;code&gt;Callable&amp;lt;T&amp;gt;&lt;/code&gt; ä»»åŠ¡å°±æ˜¯æä¾› &lt;code&gt;Future&lt;/code&gt; å¯¹è±¡æ¥è·å–å¼‚æ­¥ç»“æœã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é‚£ä¹ˆè¿™ä¸¤ç§æŠ€æœ¯æ–¹æ¡ˆå°±è¶³å¤Ÿå¥½äº†å—ï¼Ÿåœ¨å¾ˆå¤šä½¿ç”¨åœºæ™¯ä¸‹å¹¶ä¸ç†æƒ³ï¼Œè¿™ä¸¤ç§æ–¹å¼éƒ½æœ‰å±€é™ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¤šä¸ªå›è°ƒéš¾ä»¥ç»„åˆä½¿ç”¨ï¼Œå®¹æ˜“å¯¼è‡´ä»£ç éš¾ä»¥é˜…è¯»å’Œç»´æŠ¤ï¼ˆå°±æ˜¯æ‰€è°“çš„â€œå›è°ƒåœ°ç‹±â€ï¼‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼šåœ¨ç•Œé¢ä¸Šä¸ºç”¨æˆ·æ˜¾ç¤ºä»–æœ€å–œçˆ±çš„5ä¸ªç‰©ä»¶ï¼Œå¦‚æœç”¨æˆ·è¿˜æ²¡æœ‰ä»»ä½•å–œæ¬¢çš„ç‰©ä»¶ï¼Œåˆ™ç»™å‡ºå»ºè®®ç‰©ä»¶ã€‚è¿™ä¸ªé€»è¾‘æ¶‰åŠ3ä¸ªæœåŠ¡ï¼ˆç¬¬ä¸€ä¸ªæœåŠ¡æä¾›ç‰©ä»¶ IDï¼Œç¬¬äºŒä¸ªæœåŠ¡è·å–ç‰©ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œç¬¬ä¸‰ä¸ªæœåŠ¡æä¾›å»ºè®®ç‰©ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;em&gt;å›è°ƒåœ°åŸŸçš„ç¤ºä¾‹&lt;/em&gt;&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;userService.getFavorites(userId, new Callback&amp;amp;lt;List&amp;amp;lt;String&amp;amp;gt;&amp;amp;gt;() { // 1
    public void onSuccess(List&amp;amp;lt;String&amp;amp;gt; list) { // 2
        if (list.isEmpty()) { // 3
            suggestionService.getSuggestions(new Callback&amp;amp;lt;List&amp;amp;lt;Favorite&amp;amp;gt;&amp;amp;gt;() {
                public void onSuccess(List&amp;amp;lt;Favorite&amp;amp;gt; list) { // 4
                    UiUtils.submitOnUiThread(() -&amp;amp;gt; { // 5
                        list.stream()
                            .limit(5)
                            .forEach(uiList::show); // 6
                    })
                }
                
                public void onError(Throwable error) { // 7
                    UiUtils.errorPopup(error);
                }
            });
        } else {
            list.stream() // 8
                .limit(5)
                .forEach(favId -&amp;amp;gt; favoriteService.getDetails(favId, // 9
                    new Callback&amp;amp;lt;Favorite&amp;amp;gt;() {
                        public void onSuccess(Favorite details) {
                            UiUtils.submitOnUiThread(() -&amp;amp;gt; uiList.show(details));
                        }

                        public void onError(Throwable error) {
                            UiUtils.errorPopup(error);
                        }
                    }
                ));
        }
    }
    
    public void onError(Throwable error) {
        UiUtils.errorPopup(error);
    }
})&lt;/code&gt;&lt;/pre&gt;
&lt;ol&gt;&lt;li&gt;åŸºäºå›è°ƒçš„æœåŠ¡ï¼š&lt;code&gt;Callback&lt;/code&gt; æ¥å£å®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œå¼‚æ­¥å¤„ç†æˆåŠŸæ—¶è°ƒç”¨å…¶ä¸­çš„ &lt;code&gt;onSuccess&lt;/code&gt;ï¼Œå¼‚æ­¥å¤„ç†å‘ç”Ÿé”™è¯¯æ—¶è°ƒç”¨ &lt;code&gt;onError&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸€ä¸ªæœåŠ¡ä»¥å…¶ç»“æœ - å–œçˆ±ç‰©ä»¶çš„ ID åˆ—è¡¨ - è°ƒç”¨å›è°ƒæ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœåˆ—è¡¨ä¸ºç©ºï¼Œåˆ™å¿…é¡»è½¬åˆ° &lt;code&gt;suggestionService&lt;/code&gt; æ¥å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;suggestionService&lt;/code&gt; å‘ç¬¬äºŒä¸ªå›è°ƒä¼ é€’ä¸€ä¸ª &lt;code&gt;List&amp;lt;Favorite&amp;gt;&lt;/code&gt; åˆ—è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äº UI æ¸²æŸ“ï¼Œå¿…é¡»è®©æ¶ˆè´¹æ•°æ®çš„ä»£ç è¿è¡Œåœ¨ UI çš„çº¿ç¨‹ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† Java 8 çš„ &lt;code&gt;Stream&lt;/code&gt; å°†å»ºè®®ç‰©ä»¶çš„æ•°é‡é™åˆ¶ä¸º5ä¸ªï¼Œç„¶ååœ¨ UI ä¸­æ¸²æŸ“æˆä¸€ä¸ªå›¾å½¢åŒ–åˆ—è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨æ¯ä¸ªå›è°ƒå±‚çº§ï¼Œæˆ‘ä»¬éƒ½ä»¥ç›¸åŒçš„æ–¹å¼å¤„ç†é”™è¯¯ï¼šåœ¨å¼¹å‡ºæ¡†ä¸­æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;å›åˆ° å–œçˆ±ç‰©ä»¶ ID åˆ—è¡¨çš„å±‚çº§ã€‚å¦‚æœ &lt;code&gt;userService&lt;/code&gt; æœåŠ¡è¿”å›ä¸€ä¸ªä¸ä¸ºç©ºçš„ ID åˆ—è¡¨ï¼Œåˆ™è½¬åˆ° &lt;code&gt;favoriteService&lt;/code&gt; å»è·å–å¸¦è¯¦ç»†ä¿¡æ¯çš„ &lt;code&gt;Favorite&lt;/code&gt; å¯¹è±¡ã€‚å› ä¸ºåªéœ€è¦5ä¸ªå–œçˆ±ç‰©ä»¶ï¼Œæ‰€ä»¥å…ˆä½¿ç”¨æµå¼å¤„ç†å°† ID æ•°é‡é™åˆ¶ä¸º 5 ä¸ªã€‚&lt;/li&gt;
&lt;li&gt;å†ä¸€æ¬¡ï¼Œä½¿ç”¨ä¸€ä¸ªå›è°ƒã€‚è¿™ä¸€æ¬¡æˆ‘ä»¬è·å–åˆ°å®Œæ•´çš„ &lt;code&gt;Favorite&lt;/code&gt; å¯¹è±¡ï¼Œå¹¶åœ¨ UI çº¿ç¨‹ä¸­å°†å…¶åœ¨ UI ä¸Šæ¸²æŸ“å‡ºæ¥ã€‚&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;çœ‹çœ‹æœ‰å¤šå°‘ä»£ç ï¼Œç†è§£èµ·æ¥ä¹Ÿæœ‰ç‚¹å›°éš¾ï¼Œå…¶ä¸­ä¹Ÿæœ‰ä¸€äº›é‡å¤çš„ä»£ç ç‰‡æ®µã€‚å†æ¥çœ‹çœ‹ä½¿ç”¨ Reactor å¦‚ä½•æ¥å®ç°è¿™æ®µé€»è¾‘ï¼š&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;em&gt;å’Œå›è°ƒå®ç°æ–¹å¼ç­‰ä»·çš„ Reactor å®ç°&lt;/em&gt;&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;userService.getFavorite(userId) // 1
            .flatMap(favoriteService::getDetails) // 2
            .switchIfEmpty(suggestionService.getSuggestions()) // 3
            .take(5) // 4
            .publishOn(UiUtils.uiThreadScheduler()) // 5
            .subscribe(uiList::show, UiUtils::errorPopup); // 6&lt;/code&gt;&lt;/pre&gt;
&lt;ol&gt;&lt;li&gt;å¼€å¯ä¸€ä¸ªå–œçˆ±ç‰©ä»¶ ID çš„æµã€‚&lt;/li&gt;
&lt;li&gt;&lt;em&gt;å¼‚æ­¥åœ°&lt;/em&gt;å°† ID è½¬æ¢æˆå¸¦è¯¦ç»†ä¿¡æ¯çš„ &lt;code&gt;Favorite&lt;/code&gt; å¯¹è±¡ï¼ˆ&lt;code&gt;flatMap&lt;/code&gt;ï¼‰ã€‚è‡³æ­¤æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ª &lt;code&gt;Favorite&lt;/code&gt; å¯¹è±¡æµã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœ &lt;code&gt;Favorite&lt;/code&gt; æµä¸ºç©ºï¼Œåˆ™åˆ‡æ¢åˆ°å¤‡é€‰å¤„ç†æ–¹å¼ &lt;code&gt;suggestionService&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æˆ‘ä»¬åªå…³æ³¨äº§å‡ºæµä¸­çš„å‰ï¼ˆæœ€å¤šï¼‰5ä¸ªå…ƒç´ ã€‚&lt;/li&gt;
&lt;li&gt;æœ€åï¼Œåœ¨ UI çº¿ç¨‹ä¸­å¤„ç†æ¯ä»½æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;çœŸæ­£è§¦å‘æµçš„å¤„ç†ï¼šæè¿°äº†å¦‚ä½•å¤„ç†æœ€ç»ˆçš„æ•°æ®ï¼ˆæ˜¾ç¤ºä¸ºä¸€ä¸ª UI åˆ—è¡¨ï¼‰ï¼Œä»¥åŠåœ¨å‘ç”Ÿé”™è¯¯æ—¶å¦‚ä½•å¤„ç†ï¼ˆæ˜¾ç¤ºä¸€ä¸ªå¼¹å‡ºæ¡†ï¼‰ã€‚&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœå¸Œæœ›ç¡®ä¿åœ¨ 800ms ä»¥å†…è·å–åˆ°å–œçˆ±ç‰©ä»¶ ID åˆ—è¡¨ï¼Œå¦‚æœè¶…æ—¶ï¼Œåˆ™ä»ç¼“å­˜ä¸­è·å–æ•°æ®ï¼Œå¦‚ä½•å®ç°ï¼ŸåŸºäºå›è°ƒçš„ä»£ç å®ç°ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„ä»»åŠ¡ã€‚ä½¿ç”¨ Reactorï¼Œåªéœ€åœ¨æ“ä½œé“¾ä¸­æ·»åŠ ä¸€ä¸ª &lt;code&gt;timeout&lt;/code&gt; ç®—å­å°±èƒ½è½»æ¾æå®šï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;em&gt;è¶…æ—¶å›é€€å¤„ç†çš„ Reactor ä»£ç ç¤ºä¾‹&lt;/em&gt;&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;userService.getFavorites(userId)
            .timeout(Duration.ofMillis(800)) // 1
            .onErrorResume(cacheService.cachedFavoritesFor(userId)) // 2
            .flatMap(favoriteService::getDetails)
            .switchIfEmpty(suggestionService.getSuggestions())
            .take(5)
            .publishOn(UiUtils.uiThreadScheduler())
            .subscribe(uiList::show, UiUtils::errorPopup);&lt;/code&gt;&lt;/pre&gt;
&lt;ol&gt;&lt;li&gt;å¦‚æœå‰ç½®å¤„ç†è¶…è¿‡ 800ms è¿˜æ²¡è¾“å‡ºä»»ä½•äº‹ä»¶ï¼Œåˆ™ä¸‹å‘ä¸€ä¸ªé”™è¯¯ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨æ”¶åˆ°é”™è¯¯äº‹ä»¶æ—¶ï¼Œå›é€€åˆ°è°ƒç”¨ &lt;code&gt;cacheService&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ“ä½œé“¾çš„ä½™ä¸‹éƒ¨åˆ†å’Œå‰ä¸€ä¸ªä¾‹å­ç±»ä¼¼ã€‚&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½¿ç”¨ &lt;code&gt;Future&lt;/code&gt; å¯¹è±¡ç›¸æ¯”å›è°ƒæ›´å¥½ä¸€ç‚¹ï¼Œä¸è¿‡ç»„åˆä½¿ç”¨èµ·æ¥ä¹Ÿä¸å¤ªæ–¹ä¾¿ï¼Œå°½ç®¡ Java 8 å¼•å…¥ &lt;code&gt;CompletableFuture&lt;/code&gt; æ”¹å–„äº†è¿™ä¸€é—®é¢˜ã€‚å°†å¤šä¸ª &lt;code&gt;Future&lt;/code&gt; å¯¹è±¡ç»„ç»‡åœ¨ä¸€èµ·ï¼Œå¯è¡Œä½†å¹¶ä¸å®¹æ˜“ã€‚å¦å¤–ï¼Œ&lt;code&gt;Future&lt;/code&gt; è¿˜æœ‰å…¶å®ƒé—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å®¹æ˜“ç¢°åˆ°å¦ä¸€ä¸ªé˜»å¡çš„æƒ…å†µï¼šè°ƒç”¨ &lt;code&gt;Future&lt;/code&gt; å¯¹è±¡çš„ &lt;code&gt;get()&lt;/code&gt; æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;ä¸æ”¯æŒæƒ°æ€§è®¡ç®—ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹å¤šä¸ªå€¼çš„å¤„ç†å’Œé«˜çº§é”™è¯¯å¤„ç†ç¼ºä¹æ”¯æŒã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ¥çœ‹çœ‹å¦ä¸€ä¸ªä¾‹å­ï¼šå…ˆè·å–ä¸€ä¸ª ID åˆ—è¡¨ï¼Œç„¶åæ ¹æ® ID è·å–ä¸€ä¸ªåå­—ä»¥åŠè·å–ä¸€ä¸ªç»Ÿè®¡æ•°å€¼ï¼Œå†å°†åå­—å’Œç»Ÿè®¡æ•°å€¼ç»„åˆèµ·æ¥ä½¿ç”¨ï¼Œè¿™å‡ ä¸ªæ­¥éª¤éƒ½å¿…é¡»æ˜¯å¼‚æ­¥çš„ã€‚å¦‚ä¸‹ç¤ºä¾‹ä»¥ä¸€ç»„ &lt;code&gt;CompletableFuture&lt;/code&gt; æ¥å®ç°è¿™ä¸ªé€»è¾‘ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;CompletableFuture&amp;amp;lt;List&amp;amp;lt;String&amp;amp;gt;&amp;amp;gt; ids = ifhIds(); // 1

CompletableFuture&amp;amp;lt;List&amp;amp;lt;String&amp;amp;gt;&amp;amp;gt; results = ids.thenComposeAsync(l -&amp;amp;gt; { // 2
    Stream&amp;amp;lt;CompletableFuture&amp;amp;lt;String&amp;amp;gt;&amp;amp;gt; zip = 
            l.stream().map(i -&amp;amp;gt; { // 3
                CompletableFuture&amp;amp;lt;String&amp;amp;gt; nameTask = ifhName(i); // 4
                CompletableFuture&amp;amp;lt;Integer&amp;amp;gt; statTask = ifhStat(i); // 5
                return nameTask.thenCombineAsync(statTask, (name, stat) -&amp;amp;gt; &amp;amp;quot;Name &amp;amp;quot; + name + &amp;amp;quot; has stats &amp;amp;quot; + stat); // 6
            });
    List&amp;amp;lt;CompletableFuture&amp;amp;lt;String&amp;amp;gt;&amp;amp;gt; combinationList = zip.collect(Collectors.toList()); // 7
    CompletableFuture&amp;amp;lt;String&amp;amp;gt;[] combinationArray = combinationList.toArray(new CompletableFuture[combinationList.size()]);
    
    CompletableFuture&amp;amp;lt;Void&amp;amp;gt; allDone = CompletableFuture.allOf(combinationArray); // 8
    return allDone.thenApply(v -&amp;amp;gt; combinationList.stream()
                    .map(CompletableFuture::join) // 9
                    .collect(Collectors.toList()));
});

List&amp;amp;lt;String&amp;amp;gt; results = result.join(); // 10
assertThat(results).contains(
		&amp;amp;quot;Name NameJoe has stats 103&amp;amp;quot;,
		&amp;amp;quot;Name NameBart has stats 104&amp;amp;quot;,
		&amp;amp;quot;Name NameHenry has stats 105&amp;amp;quot;,
		&amp;amp;quot;Name NameNicole has stats 106&amp;amp;quot;,
		&amp;amp;quot;Name NameABSLAJNFOAJNFOANFANSF has stats 121&amp;amp;quot;);&lt;/code&gt;&lt;/pre&gt;
&lt;ol&gt;&lt;li&gt;ä¸€å¼€å§‹è·å¾—ä¸€ä¸ª &lt;code&gt;Future&lt;/code&gt; ç»“æœ - ä¸ºåç»­å¤„ç†æä¾›ä¸€ä¸ª &lt;code&gt;id&lt;/code&gt; åˆ—è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;ä¸€æ—¦è·å¾— &lt;code&gt;id&lt;/code&gt; åˆ—è¡¨å°±å¯ä»¥å¼€å§‹è¿›ä¸€æ­¥çš„å¼‚æ­¥å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;é€ä¸ªå¤„ç†åˆ—è¡¨ä¸­çš„å…ƒç´ ã€‚&lt;/li&gt;
&lt;li&gt;å¼‚æ­¥è·å–å…³è”çš„åå­—ã€‚&lt;/li&gt;
&lt;li&gt;å¼‚æ­¥è·å–å…³è”çš„ç»Ÿè®¡æ•°å€¼ã€‚&lt;/li&gt;
&lt;li&gt;ç»„åˆä¸¤ä¸ªå¼‚æ­¥ç»“æœã€‚&lt;/li&gt;
&lt;li&gt;è‡³æ­¤æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ª &lt;code&gt;Future&lt;/code&gt; å¯¹è±¡åˆ—è¡¨ï¼Œè¡¨ç¤ºæ‰€æœ‰çš„ç»„åˆä»»åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;å°† &lt;code&gt;Future&lt;/code&gt; å¯¹è±¡æ•°ç»„ä¼ ç»™ &lt;code&gt;CompletableFuture.allOf&lt;/code&gt; æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¾“å‡ºä¸€ä¸ª &lt;code&gt;Future&lt;/code&gt; å¯¹è±¡ï¼Œå½“ &lt;code&gt;Future&lt;/code&gt; å¯¹è±¡æ•°ç»„ä»£è¡¨çš„å¼‚æ­¥ä»»åŠ¡éƒ½å®Œæˆæ—¶ï¼Œè¿™ä¸ª &lt;code&gt;Future&lt;/code&gt; å¯¹è±¡ä»£è¡¨çš„å¼‚æ­¥ä»»åŠ¡ä¹Ÿå°±å®Œæˆäº†ã€‚&lt;/li&gt;
&lt;li&gt;æ­¤å¤„çš„ç‰¹æ®Šä¹‹å¤„åœ¨äºï¼šåœ¨ï¼ˆ&lt;code&gt;allOf&lt;/code&gt; è¿”å›çš„ï¼‰&lt;code&gt;CompletableFuture&amp;lt;Void&amp;gt;&lt;/code&gt; å¯¹è±¡è¡¨ç¤ºçš„å¼‚æ­¥ä»»åŠ¡ç»“æŸæ—¶ï¼Œéå† &lt;code&gt;Future&lt;/code&gt; å¯¹è±¡åˆ—è¡¨ï¼ˆcombinationListï¼‰ï¼Œä½¿ç”¨ &lt;code&gt;join()&lt;/code&gt; æ–¹æ³•ï¼ˆæ­¤æ¬¡ä¸ä¼šé˜»å¡ï¼Œå› ä¸º &lt;code&gt;allOf&lt;/code&gt; ä¼šç¡®ä¿æ‰€æœ‰å¼‚æ­¥ä»»åŠ¡éƒ½å·²å®Œæˆï¼‰è·å–æ”¶é›†å¼‚æ­¥ä»»åŠ¡ç»“æœã€‚&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;10. è§¦å‘æ‰§è¡Œæ•´ä¸ªå¼‚æ­¥å¤„ç†æµæ°´çº¿ï¼ˆè°ƒç”¨ &lt;code&gt;join()&lt;/code&gt; æ–¹æ³•ï¼‰ï¼Œç„¶è€Œç­‰ç€å¼‚æ­¥å¤„ç†å®Œæˆå¹¶è¿”å›ä¸€ä¸ªç»“æœåˆ—è¡¨ï¼Œå°±å¯ä»¥è¿›è¡Œæ–­è¨€åˆ¤æ–­äº†ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Reactor è‡ªå¸¦äº†å¾ˆå¤šç»„åˆç®—å­ï¼Œå¯ä»¥ç®€åŒ–è¿™ä¸ªå¤„ç†è¿‡ç¨‹çš„å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;Flux&amp;amp;lt;String&amp;amp;gt; ids = ifhrIds(); // 1

Flux&amp;amp;lt;String&amp;amp;gt; combinations = 
        ids.flatMap(id -&amp;amp;gt; { // 2
            Mono&amp;amp;lt;String&amp;amp;gt; nameTask = ifhrName(id); // 3
            Mono&amp;amp;lt;Integer&amp;amp;gt; statTask = ifhrStat(id); // 4
            
            return nameTask.zipWith(statTask, // 5
                    (name, stat) -&amp;amp;gt; &amp;amp;quot;Name &amp;amp;quot; + name + &amp;amp;quot; has stats &amp;amp;quot; + stat);
        });
        
Mono&amp;amp;lt;List&amp;amp;lt;String&amp;amp;gt;&amp;amp;gt; result = combinations.collectList(); // 6

List&amp;amp;lt;String&amp;amp;gt; results = result.block(); // 7
assertThat(results).containsExactly( // 8
    &amp;amp;quot;Name NameJoe has stats 103&amp;amp;quot;,
    &amp;amp;quot;Name NameBart has stats 104&amp;amp;quot;,
    &amp;amp;quot;Name NameHenry has stats 105&amp;amp;quot;,
    &amp;amp;quot;Name NameNicole has stats 106&amp;amp;quot;,
    &amp;amp;quot;Name NameABSLAJNFOAJNFOANFANSF has stats 121&amp;amp;quot;
);&lt;/code&gt;&lt;/pre&gt;
&lt;ol&gt;&lt;li&gt;è¿™æ¬¡ï¼Œä¸€å¼€å§‹æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªå¼‚æ­¥æä¾›çš„å­—ç¬¦ä¸²åºåˆ—ï¼ˆ&lt;code&gt;ids&lt;/code&gt;ï¼‰ï¼ˆä¸€ä¸ª &lt;code&gt;Flux&amp;lt;String&amp;gt;&lt;/code&gt; å¯¹è±¡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºåºåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå¼‚æ­¥å¤„ç†ä¸¤æ¬¡ï¼ˆåœ¨ &lt;code&gt;flatMap&lt;/code&gt; çš„ lambda å‚æ•°å€¼ä¸­ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;è·å–å…³è”çš„åå­—ã€‚&lt;/li&gt;
&lt;li&gt;è·å–å…³è”çš„ç»Ÿè®¡å€¼ã€‚&lt;/li&gt;
&lt;li&gt;å¼‚æ­¥ç»„åˆä¸¤ä¸ªå€¼&lt;/li&gt;
&lt;li&gt;åœ¨å¼‚æ­¥å¤„ç†çš„ç»“æœå¯ç”¨æ—¶ï¼Œå°†å®ƒä»¬èšåˆåˆ°ä¸€ä¸ª &lt;code&gt;List&lt;/code&gt; å¯¹è±¡ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šç»§ç»­å¼‚æ­¥å¤„ç† &lt;code&gt;Flux&lt;/code&gt;ï¼Œæ¯”å¦‚ï¼šå¼‚æ­¥ç»„åˆä½¿ç”¨å®ƒæˆ–è€…ç›´æ¥è®¢é˜…å®ƒã€‚æœ€å¯èƒ½çš„æ˜¯ï¼Œè¿”å›è¿™ä¸ª &lt;code&gt;Mono&lt;/code&gt; ç±»å‹çš„ &lt;code&gt;result&lt;/code&gt;ã€‚å› ä¸ºè¿™é‡Œåªæ˜¯ä¸ªæµ‹è¯•ï¼Œæ‰€ä»¥ä½¿ç”¨äº† blockï¼Œç­‰å¾…å¤„ç†ç»“æŸï¼Œç›´æ¥è¿”å›å€¼çš„èšåˆåˆ—è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹ç»“æœè¿›è¡Œæ–­è¨€åˆ¤æ–­ã€‚&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½¿ç”¨å›è°ƒå’Œ &lt;code&gt;Future&lt;/code&gt; å¯¹è±¡çš„é—®é¢˜æ˜¯ç±»ä¼¼çš„ï¼Œååº”å¼ç¼–ç¨‹ä»¥ &lt;code&gt;å‘å¸ƒè€…ï¼ˆPublisherï¼‰- è®¢é˜…è€…ï¼ˆSubscriberï¼‰&lt;/code&gt; è§£å†³äº†è¿™äº›é—®é¢˜ã€‚&lt;/p&gt;
&lt;h3&gt;2.3 ä»å‘½ä»¤å¼åˆ°ååº”å¼ç¼–ç¨‹&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ååº”å¼ç¼–ç¨‹åº“ï¼Œæ¯”å¦‚ Reactorï¼Œç›®æ ‡æ˜¯è§£å†³ JVM ä¸Šâ€œç»å…¸â€å¼‚æ­¥å¤„ç†æ–¹å¼çš„å¼Šç«¯ï¼ŒåŒæ—¶ä¹Ÿä¸“æ³¨äºæä¾›ä»¥ä¸‹å‡ ä¸ªæ–¹é¢çš„ç‰¹æ€§ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;å¯ç»„åˆæ€§&lt;/strong&gt; å’Œ &lt;strong&gt;ä»£ç å¯è¯»æ€§&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;å°†æ•°æ®è§†ä½œä¸€ä¸ª&lt;strong&gt;æµ&lt;/strong&gt;ï¼Œå¹¶æä¾›ä¸°å¯Œçš„&lt;strong&gt;ç®—å­&lt;/strong&gt;æ¥æ“ä½œæµ&lt;/li&gt;
&lt;li&gt;åœ¨&lt;strong&gt;è®¢é˜…ï¼ˆsubscriberï¼‰&lt;/strong&gt;ä¹‹å‰ä¸ä¼šå®é™…åšä»»ä½•äº‹æƒ…&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åå‹&lt;/strong&gt; æˆ–è€…è¯´ æ¶ˆè´¹è€…é€šçŸ¥ç”Ÿäº§è€…æµé€Ÿè¿‡é«˜çš„èƒ½åŠ›&lt;/li&gt;
&lt;li&gt;ä¸å¹¶å‘æ— å…³ï¼ˆconcurrency-agnosticï¼‰çš„&lt;strong&gt;é«˜é˜¶ï¼ˆhigh levelï¼‰&lt;/strong&gt;æŠ½è±¡ï¼Œ&lt;strong&gt;é€‚ç”¨æ€§å¼ºï¼ˆhigh valueï¼‰&lt;/strong&gt;ï¼ˆè¯‘æ³¨ï¼šå¹¶å‘æ— å…³æ˜¯æŒ‡è¿™ç§æŠ½è±¡å¯¹äºå¹¶å‘éå¹¶å‘çš„åœºæ™¯éƒ½é€‚ç”¨ï¼‰&lt;/li&gt;&lt;/ul&gt;
&lt;h2&gt;3. Reactor æ ¸å¿ƒç‰¹æ€§&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Reactor é¡¹ç›®çš„ä¸»è¦æˆæœæ˜¯ &lt;code&gt;reactor-core&lt;/code&gt; - ä¸€ä¸ªéµå¾ª&lt;a href=&apos;https://www.reactive-streams.org/&apos;&gt;ååº”å¼æµ&lt;/a&gt;è§„èŒƒå¹¶æ”¯æŒ Java 8 çš„ååº”å¼ç¼–ç¨‹åº“ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Reactor å¼•å…¥ 2 ä¸ªå¯ç»„åˆçš„ååº”å¼ç±»å‹ï¼ˆå®ç°äº† &lt;code&gt;Publisher&lt;/code&gt; æ¥å£å¹¶ä¸”æä¾›ä¸°å¯Œçš„ç®—å­ï¼‰ï¼š &lt;code&gt;Flux&lt;/code&gt; å’Œ &lt;code&gt;Mono&lt;/code&gt;ã€‚ä¸€ä¸ª &lt;code&gt;Flux&lt;/code&gt; å¯¹è±¡ä»£è¡¨åŒ…å« 0 åˆ° N ä¸ªå…ƒç´ çš„ååº”å¼åºåˆ—ï¼Œ&lt;code&gt;Mono&lt;/code&gt; å¯¹è±¡ä»£è¡¨å•å€¼æˆ–ç©ºï¼ˆ0æˆ–1ä¸ªå…ƒç´ ï¼‰çš„ç»“æœã€‚&lt;/p&gt;
&lt;h3&gt;3.1 Flux - 0-N ä¸ªå€¼çš„å¼‚æ­¥åºåˆ—&lt;/h3&gt;
&lt;img src=&apos;https://i.loli.net/2020/06/14/oKMX4rTvUViZRHj.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;100%&apos;/&gt;
&lt;h3&gt;3.2 Mono - åŒ…å« 0 æˆ– 1 ä¸ªå€¼çš„å¼‚æ­¥ç»“æœ&lt;/h3&gt;
&lt;img src=&apos;https://i.loli.net/2020/06/14/8WxGgH9UkcQwuX4.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;100%&apos;/&gt;
&lt;h3&gt;3.3 åˆ›å»ºä¸€ä¸ª Flux æˆ– Mono å¹¶è¿›è¡Œè®¢é˜…çš„ä¸€äº›ç®€å•æ–¹æ³•&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;Flux&lt;/code&gt; å’Œ &lt;code&gt;Mono&lt;/code&gt; çš„ç±»ä¸­åŒ…å«å¤§é‡çš„å·¥å‚æ–¹æ³•ï¼Œä¸Šæ‰‹ä½¿ç”¨ Reactor æœ€ç®€å•çš„æ–¹å¼æ˜¯ä»ä¸­é€‰æ‹©ä¸€ä¸ªç”¨èµ·æ¥ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ª &lt;code&gt;String&lt;/code&gt; åºåˆ—ï¼Œå¯ä»¥é€ä¸ªåˆ—ä¸¾å‡ºè¿™äº›å­—ç¬¦ä¸²ï¼Œæˆ–è€…å°†è¿™äº›å­—ç¬¦ä¸²æ”¾åˆ°ä¸€ä¸ªé›†åˆä¸­ï¼Œç„¶ååŸºäºè¿™ä¸ªé›†åˆåˆ›å»ºä¸€ä¸ª Fluxï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;Flux&amp;amp;lt;String&amp;amp;gt; seq1 = Flux.just(&amp;amp;quot;foo&amp;amp;quot;, &amp;amp;quot;bar&amp;amp;quot;, &amp;amp;quot;foobar&amp;amp;quot;);

List&amp;amp;lt;String&amp;amp;gt; iterable = Arrays.asList(&amp;amp;quot;foo&amp;amp;quot;, &amp;amp;quot;bar&amp;amp;quot;, &amp;amp;quot;foobar&amp;amp;quot;);
Flux&amp;amp;lt;String&amp;amp;gt; seq2 = Flux.fromIterable(iterable);&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å…¶å®ƒä¸€äº›å·¥å‚æ–¹æ³•çš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;Mono&amp;amp;lt;String&amp;amp;gt; noData = Mono.empty();
Mono&amp;amp;lt;String&amp;amp;gt; data = Mono.just(&amp;amp;quot;foo&amp;amp;quot;);
Flux&amp;amp;lt;Integer&amp;amp;gt; numbersFromFiveToSeven = Flux.range(5, 3);&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äºè®¢é˜…æ“ä½œï¼Œ&lt;code&gt;Flux&lt;/code&gt; å’Œ &lt;code&gt;Mono&lt;/code&gt; å€ŸåŠ©äº† Java 8 çš„ lambda è¡¨è¾¾å¼ã€‚æœ‰å¤§é‡ &lt;code&gt;.subscribe()&lt;/code&gt; çš„é‡è½½æ–¹æ³•/å˜ç§æ–¹æ³•ï¼ˆvariantsï¼‰å¯é€‰é€‰æ‹©ä½¿ç”¨ï¼Œä½¿ç”¨ lambda è¡¨è¾¾å¼æ¥å®ç°å›è°ƒçš„ä¸åŒç»„åˆï¼Œå¦‚ä¸‹æ‰€ç¤ºæ˜¯è¿™äº›æ–¹æ³•çš„ç­¾åï¼š&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;em&gt;Flux ä¸­åŸºäº lambda è¡¨è¾¾å¼çš„è®¢é˜…æ–¹æ³•å˜ç§&lt;/em&gt;&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;subscribe();

subscribe(Consumer&amp;amp;lt;? super T&amp;amp;gt; consumer);

subscribe(Consumer&amp;amp;lt;? super T&amp;amp;gt; consumer,
          Consumer&amp;amp;lt;? super Throwable&amp;amp;gt; errorConsumer);

subscribe(Consumer&amp;amp;lt;? super T&amp;amp;gt; consumer,
          Consumer&amp;amp;lt;? super Throwable&amp;amp;gt; errorConsumer,
          Runnable completeConsumer);

subscribe(Consumer&amp;amp;lt;? super T&amp;amp;gt; consumer,
          Consumer&amp;amp;lt;? super Throwable&amp;amp;gt; errorConsumer,
          Runnable completeConsumer,
          Consumer&amp;amp;lt;? super Subscription&amp;amp;gt; subscriptionConsumer);&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;è¿™äº›è®¢é˜…æ–¹æ³•éƒ½ä¼šè¿”å›ä¸€ä¸ªè®¢é˜…æ“ä½œçš„å¼•ç”¨ï¼Œå½“ä¸å†éœ€è¦æ›´å¤šçš„æ•°æ®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå¼•ç”¨æ¥å–æ¶ˆè®¢é˜…ã€‚ä¸€æ—¦å–æ¶ˆï¼Œæ•°æ®æºå°±åº”è¯¥åœæ­¢äº§å‡ºæ•°æ®ï¼Œå¹¶æ¸…ç†ä½¿ç”¨çš„æ‰€æœ‰èµ„æºã€‚è¿™ä¸€ â€œå–æ¶ˆå¹¶æ¸…ç†â€ è¡Œä¸ºåœ¨ Reactor ä¸­ä»¥é€šç”¨çš„ &lt;code&gt;Disposable&lt;/code&gt; æ¥å£æ¥è¡¨ç°ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;h4&gt;3.3.1 lambda è¡¨è¾¾å¼çš„æ›¿ä»£æ–¹æ¡ˆï¼šBaseSubscriber&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;Flux&lt;/code&gt; å’Œ &lt;code&gt;Mono&lt;/code&gt; æä¾›äº†ä¸€ä¸ªç›¸æ¯”ä¸Šé¢é‚£ä¹ˆè®¢é˜…æ–¹æ³•æ›´é€šç”¨çš„ &lt;code&gt;subscribe&lt;/code&gt; æ–¹æ³•ï¼Œå…¶å‚æ•°æ˜¯ä¸€ä¸ªå®Œæ•´çš„ &lt;code&gt;Subscriber&lt;/code&gt; å®ä¾‹ï¼Œè€Œä¸æ˜¯æ ¹æ®å‡ ä¸ª lambda è¡¨è¾¾å¼ç»„åˆå‡ºä¸€ä¸ª &lt;code&gt;Subscriber&lt;/code&gt; å®ä¾‹ã€‚ä¸ºäº†æ–¹ä¾¿å®ç°è¿™æ ·çš„ä¸€ä¸ª &lt;code&gt;Subscriber&lt;/code&gt;ï¼ŒReactor æä¾›äº†ä¸€ä¸ªåä¸º &lt;code&gt;BaseSubscriber&lt;/code&gt; çš„å¯æ‰©å±•çš„æŠ½è±¡ç±»ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸‹é¢æ¥å®ç°ä¸€ä¸ªï¼Œæˆ‘ä»¬å°†å…¶å‘½åä¸º &lt;code&gt;SampleSubscriber&lt;/code&gt;ã€‚å¦‚ä¸‹ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•å°†å…¶åº”ç”¨åˆ°ä¸€ä¸ª &lt;code&gt;Flux&lt;/code&gt; åºåˆ—ä¸Šï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;SampleSubscriber&amp;amp;lt;Integer&amp;amp;gt; ss = new SampleSubscriber&amp;amp;lt;Integer&amp;amp;gt;();
Flux&amp;amp;lt;Integer&amp;amp;gt; ints = Flux.range(1, 4);
//
ints.subscribe(i -&amp;amp;gt; System.out.println(i),
    error -&amp;amp;gt; System.err.println(&amp;amp;quot;Error &amp;amp;quot; + error),
    () -&amp;amp;gt; {System.out.println(&amp;amp;quot;Done&amp;amp;quot;);},
    s -&amp;amp;gt; s.request(10));
//
ints.subscribe(ss);&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚ä¸‹ç¤ºä¾‹æ¼”ç¤ºäº† &lt;code&gt;SampleSubscriber&lt;/code&gt; ç»§æ‰¿è‡ª &lt;code&gt;BaseSubscriber&lt;/code&gt; çš„ä¸€ä¸ªæœ€ç®€åŒ–å®ç°ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;package io.projectreactor.samples;

import org.reactivestreams.Subscription;
import reactor.core.publisher.BaseSubscriber;

public class SampleSubscriber&amp;amp;lt;T&amp;amp;gt; extends BaseSubscriber&amp;amp;lt;T&amp;amp;gt; {

	public void hookOnSubscribe(Subscription subscription) {
		System.out.println(&amp;amp;quot;Subscribed&amp;amp;quot;);
		request(1);
	}

	public void hookOnNext(T value) {
		System.out.println(value);
		request(1);
	}
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;BaseSubscriber&lt;/code&gt; è¿˜æä¾›äº†ä¸€ä¸ª &lt;code&gt;requestUnbounded()&lt;/code&gt; æ–¹æ³•æ¥åˆ‡æ¢åˆ°æ— é™æ¶ˆè´¹æ¨¡å¼ï¼ˆç›¸å½“äº &lt;code&gt;request(Long.MAX_VALUES)&lt;/code&gt;ï¼‰ï¼Œå¦å¤–ä¹Ÿæä¾›äº†ä¸€ä¸ª &lt;code&gt;cancel()&lt;/code&gt; æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é™¤äº† &lt;code&gt;hookOnSubscribe&lt;/code&gt; å’Œ &lt;code&gt;hookOnNext&lt;/code&gt;ï¼Œ&lt;code&gt;BaseSubscriber&lt;/code&gt; è¿˜æä¾›äº†å…¶ä»–é’©å­æ–¹æ³•ï¼ˆæ–¹æ³•ä½“ä¸ºç©ºï¼Œæä¾›ç»§æ‰¿é‡å†™ï¼‰ï¼š&lt;code&gt;hookOnComplete&lt;/code&gt;ã€&lt;code&gt;hookOnError&lt;/code&gt;ã€&lt;code&gt;hookOnCancel&lt;/code&gt; ä»¥åŠ &lt;code&gt;hookFinally&lt;/code&gt;ï¼ˆå½“äº‹ä»¶/æ¶ˆæ¯åºåˆ—ï¼ˆæµï¼‰ç»ˆæ­¢æ—¶ï¼Œä¸€å®šä¼šè°ƒç”¨è¯¥æ–¹æ³•ï¼Œè°ƒç”¨æ—¶ä¼šä¼ å…¥ä¸€ä¸ª &lt;code&gt;SignalType&lt;/code&gt; ç±»å‹å‚æ•°è¡¨ç¤ºç»ˆæ­¢çš„ç±»å‹ï¼‰ã€‚&lt;/p&gt;
&lt;h4&gt;3.3.2 å…³äºåå‹å’Œè°ƒæ•´è¯·æ±‚é‡çš„æ–¹å¼&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨ Reactor ä¸­å®ç°åå‹ï¼Œæ˜¯é€šè¿‡å‘ä¸Šæ¸¸ç®—å­å‘é€ä¸€ä¸ª &lt;code&gt;è¯·æ±‚ï¼ˆrequestï¼‰&lt;/code&gt;æ¥é€çº§ä¼ æ’­æ¶ˆè´¹è€…çš„å‹åŠ›ï¼Œç›´åˆ°æ•°æ®æºã€‚å½“å‰è¯·æ±‚çš„æ€»é‡æœ‰æ—¶åˆç§°ä¸ºå½“å‰çš„â€œéœ€æ±‚é‡â€ æˆ–è€… â€œå¾…æ»¡è¶³ï¼ˆpendingï¼‰çš„è¯·æ±‚é‡â€ã€‚éœ€æ±‚é‡çš„ä¸Šé™æ˜¯ &lt;code&gt;Long.MAX_VALUE&lt;/code&gt;ï¼Œè¡¨ç¤ºä¸€ä¸ªæ— é™é‡çš„è¯·æ±‚ï¼ˆæ„æ€æ˜¯â€œå°½å¿«äº§å‡ºæ•°æ®â€œ - åå‹ä¹Ÿå°±å¤±æ•ˆäº†ï¼‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ€ç»ˆçš„è®¢é˜…è€…åœ¨è®¢é˜…ä¹‹å‰ä¼šå‘å‡ºé¦–ä¸ªè¯·æ±‚ï¼Œè®¢é˜…æ‰€æœ‰æ¶ˆæ¯/æ•°æ®æœ€ç›´æ¥çš„æ–¹å¼æ˜¯å³åˆ»è§¦å‘ä¸€ä¸ªæ— é™é‡ï¼ˆLong.MAX_VALUEï¼‰çš„è¯·æ±‚ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;code&gt;subscribe()&lt;/code&gt; ä»¥åŠå¤§éƒ¨åˆ†åŸºäº lambda è¡¨è¾¾å¼çš„å˜ç§æ–¹æ³•ï¼ˆé™¤äº†é‚£ä¸ªæ¥å— &lt;code&gt;Consumer&amp;lt;Subscription&amp;gt;&lt;/code&gt; ç±»å‹å‚æ•°çš„æ–¹æ³•ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;block()&lt;/code&gt;ã€&lt;code&gt;blockFirst()&lt;/code&gt; å’Œ &lt;code&gt;blockLast()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;è°ƒç”¨ &lt;code&gt;toIterable()&lt;/code&gt; æˆ– &lt;code&gt;toStream()&lt;/code&gt; è¿›è¡Œéå†&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹é¦–ä¸ªè¯·æ±‚è¿›è¡Œå®šåˆ¶çš„æœ€ç®€å•æ–¹å¼æ˜¯ä»¥ä¸€ä¸ª &lt;code&gt;BaseSubscriber&lt;/code&gt; æ´¾ç”Ÿç±»å®ä¾‹æ¥ &lt;code&gt;subscribe&lt;/code&gt;ï¼Œæ´¾ç”Ÿç±»é‡å†™ &lt;code&gt;BaseSubscriber&lt;/code&gt; çš„ &lt;code&gt;hookOnSubscribe&lt;/code&gt; æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;Flux.range(1, 10)
    .doOnRequest(r -&amp;amp;gt; System.out.println(&amp;amp;quot;request of &amp;amp;quot; + r))
    .subscribe(new BaseSubscriber&amp;amp;lt;Integer&amp;amp;gt;() {

      @Override
      public void hookOnSubscribe(Subscription subscription) {
        request(1);
      }

      @Override
      public void hookOnNext(Integer integer) {
        System.out.println(&amp;amp;quot;Cancelling after having received &amp;amp;quot; + integer);
        cancel();
      }
    });&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸Šé¢è¿™ä¸ªä»£ç ç‰‡æ®µè¾“å‡ºå¦‚ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;request of 1
Cancelling after having received 1&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;æ”¹å˜ä¸‹æ¸¸éœ€æ±‚é‡çš„ç®—å­&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è°¨è®°ï¼šè®¢é˜…æ—¶æŒ‡å®šçš„éœ€æ±‚é‡ï¼Œä¸Šæ¸¸æ“ä½œé“¾ä¸­çš„æ¯ä¸ªç®—å­éƒ½å¯ä»¥å¯¹å…¶ä½œå‡ºè°ƒæ•´ã€‚ä¸€ä¸ªå…¸å‹æ¡ˆä¾‹æ˜¯ &lt;code&gt;buffer(N)&lt;/code&gt; ç®—å­ï¼šå¦‚æœå®ƒæ”¶åˆ°ä¸€ä¸ª &lt;code&gt;request(2)&lt;/code&gt; è¯·æ±‚ï¼Œå®ƒä¼šç†è§£ä¸º2ä¸ªç¼“å†²åŒºçš„è¯·æ±‚é‡ã€‚å› ä¸ºç¼“å†²åŒºéœ€è¦ N ä¸ªå…ƒç´ æ‰è®¤ä¸ºæ˜¯æ»¡çš„ï¼Œæ‰€ä»¥ &lt;code&gt;buffer&lt;/code&gt; ç®—å­å°†è¯·æ±‚é‡è°ƒæ•´æˆäº† &lt;code&gt;2 x N&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½ ä¹Ÿè®¸ä¹Ÿæ³¨æ„åˆ°æŸäº›ç®—å­å­˜åœ¨è¿™æ ·çš„å˜ç§ - æ¥å—ä¸€ä¸ªåä¸º &lt;code&gt;prefetch&lt;/code&gt; çš„ &lt;code&gt;int&lt;/code&gt; ç±»å‹å‚æ•°ã€‚è¿™æ˜¯å¦å¤–ä¸€ç±»ä¿®æ”¹ä¸‹æ¸¸è¯·æ±‚é‡çš„ç®—å­ã€‚è¿™ç±»ç®—å­ï¼ˆæ¯”å¦‚ &lt;code&gt;flatMap&lt;/code&gt;ï¼‰é€šå¸¸æ˜¯å¤„ç†å†…éƒ¨åºåˆ—ï¼ˆinner sequencesï¼‰ï¼Œä»æ¯ä¸ªè¿›å…¥çš„å…ƒç´ æ´¾ç”Ÿå‡ºä¸€ä¸ª &lt;code&gt;Publisher&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;é¢„å–ï¼ˆprefetchï¼‰&lt;/code&gt;æ˜¯è°ƒæ•´å†…éƒ¨åºåˆ—è¯·æ±‚é‡çš„ä¸€ä¸ªæ–¹å¼ã€‚å¦‚æœæœªæŒ‡å®šï¼Œå¤šæ•°è¿™ç±»ç®—å­ä¼šä»¥ 32 ä¸ºåˆå§‹éœ€æ±‚é‡ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ç±»ç®—å­é€šå¸¸ä¹Ÿä¼šå®ç°ä¸€ä¸ª&lt;strong&gt;å¡«è¡¥ä¼˜åŒ–æ–¹æ¡ˆ&lt;/strong&gt;ï¼šç®—å­ä¸€æ—¦çœ‹åˆ° 25% çš„é¢„å–è¯·æ±‚é‡å·²å®Œæˆï¼Œå°±ä¼šå‘ä¸Šæ¸¸å†å‘èµ· 25% çš„è¯·æ±‚é‡ã€‚è¿™æ˜¯ä¸€ä¸ªå¯å‘å¼ä¼˜åŒ–ï¼Œå¦‚æ­¤è¿™ç±»ç®—å­å°±å¯ä»¥ä¸»åŠ¨åœ°ä¸ºå³å°†åˆ°æ¥çš„è¯·æ±‚é‡åšå¥½å‡†å¤‡ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ€åï¼Œå†ä»‹ç»ä¸€å¯¹ç›´æ¥ç”¨äºè°ƒæ•´è¯·æ±‚é‡çš„ç®—å­ï¼š&lt;code&gt;limitRate&lt;/code&gt; å’Œ &lt;code&gt;limitRequest&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;limitRate(N)&lt;/code&gt; æŠŠä¸‹æ¸¸çš„è¯·æ±‚é‡æ‹†åˆ†æˆå¤šä¸ªæ›´å°é‡çš„è¯·æ±‚å‘ä¸Šæ¸¸ä¼ æ’­ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª &lt;code&gt;100&lt;/code&gt; çš„è¯·æ±‚ä¼ åˆ°ç®—å­ &lt;code&gt;limitRate(10)&lt;/code&gt;ï¼Œåˆ™ä¼šå˜æˆ 10 æ¬¡è¯·æ±‚ï¼Œä¸€æ¬¡è¯·æ±‚ 10ï¼Œä¼ æ’­åˆ°ä¸Šæ¸¸ã€‚æ³¨æ„ï¼š&lt;code&gt;limitRate&lt;/code&gt; å®é™…ä¸Šä»¥è¿™ç§å½¢å¼å®ç°äº†å‰é¢æåˆ°çš„å¡«è¡¥ä¼˜åŒ–æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸ªç®—å­æœ‰ä¸€ä¸ªå˜ç§ï¼Œå…è®¸å¼€å‘è€…è°ƒæ•´é¢„å–å¡«è¡¥é‡ï¼ˆå³ç®—å­å˜ç§çš„ &lt;code&gt;lowTide&lt;/code&gt; å‚æ•°ï¼‰ï¼š&lt;code&gt;limitRate(highTide, lowTide)&lt;/code&gt;ã€‚&lt;code&gt;lowTide&lt;/code&gt; å‚æ•°è®¾å®šä¸º &lt;code&gt;0&lt;/code&gt; æ—¶ï¼Œä¼šå¯¼è‡´ä¸¥æ ¼é™åˆ¶ä¸€æ¬¡è¯·æ±‚ &lt;code&gt;highTide&lt;/code&gt; ä¸ªï¼Œè€Œä¸æ˜¯ç»å¡«è¡¥ç­–ç•¥è¿›ä¸€æ­¥è°ƒæ•´è¿‡çš„ä¸€æ¬¡è¯·æ±‚é‡ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ­¤å¤–ï¼Œ&lt;code&gt;limitRequest(N)&lt;/code&gt; åˆ™æ˜¯é™åˆ¶äº†ä¸‹æ¸¸æœ€å¤§çš„éœ€æ±‚æ€»é‡ã€‚å®ƒä¼šç´¯åŠ è¯·æ±‚é‡ç›´åˆ° &lt;code&gt;N&lt;/code&gt;ã€‚å¦‚æœä¸€æ¬¡è¯·æ±‚æ²¡æœ‰è®©éœ€æ±‚æ€»é‡è¶…è¿‡ &lt;code&gt;N&lt;/code&gt;ï¼Œåˆ™è¿™æ¬¡è¯·æ±‚ä¼šå®Œæ•´åœ°ä¼ æ’­åˆ°ä¸Šæ¸¸ï¼ˆè¯‘æ³¨ï¼šæ„æ€æ˜¯å¦‚æœä¸€æ¬¡è¯·æ±‚è®©éœ€æ±‚æ€»é‡è¶…è¿‡äº† &lt;code&gt;N&lt;/code&gt;ï¼Œè¿™æ¬¡è¯·æ±‚çš„è¯·æ±‚é‡ä¼šè¢«è£å‰ªï¼‰ã€‚å¦‚æœæ•°æ®æºå‘å‡ºçš„æ•°æ®æ€»é‡è¾¾åˆ°äº†é™åˆ¶çš„æ€»é‡ï¼Œ&lt;code&gt;limitRequest&lt;/code&gt; åˆ™è®¤ä¸ºè¿™ä¸ªåºåˆ—å¯ä»¥ç»“æŸäº†ï¼Œå‘ä¸‹æ¸¸å‘é€ä¸€ä¸ª &lt;code&gt;onComplete&lt;/code&gt; ä¿¡å·ï¼Œå¹¶å–æ¶ˆæ•°æ®æºã€‚&lt;/p&gt;
&lt;h3&gt;3.4 åŠ¨æ€åœ°ï¼ˆprogrammaticallyï¼‰åˆ›å»ºä¸€ä¸ªåºåˆ—&lt;/h3&gt;
&lt;h4&gt;3.4.1 åŒæ­¥çš„ generate&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åŠ¨æ€åˆ›å»ºä¸€ä¸ª &lt;code&gt;Flux&lt;/code&gt; æœ€ç®€å•çš„æ–¹å¼æ˜¯å€ŸåŠ© &lt;code&gt;generate&lt;/code&gt; æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸€æ–¹å¼å¯ä»¥å®ç°&lt;strong&gt;åŒæ­¥çš„&lt;/strong&gt;ä¸”&lt;strong&gt;ä¸€ä¸ªæ¥ä¸€ä¸ª&lt;/strong&gt;åœ°ä¸‹å‘æ•°æ®ï¼Œè¿™æ„å‘³ç€æ¥æ”¶æ–¹ï¼ˆsinkï¼‰æ˜¯ä¸€ä¸ª &lt;code&gt;SynchronousSink&lt;/code&gt;ï¼Œå…¶ &lt;code&gt;next()&lt;/code&gt; æ–¹æ³•åœ¨ä¸€æ¬¡å›è°ƒæ–¹æ³•è°ƒç”¨ä¸­æœ€å¤šåªèƒ½è°ƒç”¨ä¸€æ¬¡ã€‚å¯ä»¥åœ¨å…¶åå†è°ƒç”¨ &lt;code&gt;error(Throwable)&lt;/code&gt; æˆ– &lt;code&gt;complete()&lt;/code&gt;ï¼Œè§†ä½ çš„éœ€æ±‚è€Œå®šã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;generate&lt;/code&gt; æ–¹æ³•å˜ç§çš„è¿™ä¸ªåº”è¯¥æ˜¯æœ€æœ‰ç”¨çš„ï¼šå…è®¸ä¿æŒä¸€ä¸ªçŠ¶æ€ï¼Œåœ¨è°ƒç”¨æ¥æ”¶æ–¹çš„ &lt;code&gt;next&lt;/code&gt; æ–¹æ³•æ—¶å¯ä»¥åŸºäºè¿™ä¸ªçŠ¶æ€æ¥å†³å®šä¸‹å‘ä»€ä¹ˆæ•°æ®ã€‚é‚£ä¹ˆè¿™ä¸ªç”Ÿæˆå™¨å‡½æ•°å°±æˆäº†ä¸€ä¸ª &lt;code&gt;BiFunction&amp;lt;S, SynchronousSink&amp;lt;T&amp;gt;, S&amp;gt;&lt;/code&gt; å®ä¾‹ï¼Œå…¶ä¸­ &lt;code&gt;&amp;lt;S&amp;gt;&lt;/code&gt; å³æ˜¯çŠ¶æ€å¯¹è±¡çš„ç±»å‹ã€‚å¯¹äºåˆå§‹çŠ¶æ€ï¼Œå¯ä»¥æä¾›ä¸€ä¸ª &lt;code&gt;Supplier&amp;lt;S&amp;gt;&lt;/code&gt; æ¥è·å–ï¼Œè¿™æ ·ç”Ÿæˆå™¨å‡½æ•°æ¯è½®è°ƒç”¨éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ª &lt;code&gt;int&lt;/code&gt; å®ä¾‹ä½œä¸ºçŠ¶æ€ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;// åŸºäºçŠ¶æ€çš„ generate æ–¹æ³•ä½¿ç”¨ç¤ºä¾‹
Flux&amp;amp;lt;String&amp;amp;gt; flux = Flux.generate(
    () -&amp;amp;gt; 0, // 1
    (state, sink) -&amp;amp;gt; {
        sink.next(&amp;amp;quot;3 x &amp;amp;quot; + state + &amp;amp;quot; = &amp;amp;quot; + 3*state); // 2
        if (state == 10) sink.complete(); // 3
        return state + 1; // 4
    });&lt;/code&gt;&lt;/pre&gt;
&lt;ol&gt;&lt;li&gt;ä»¥ 0 ä½œä¸ºåˆå§‹çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;åŸºäºçŠ¶æ€ï¼ˆstateï¼‰å†³å®šä¸‹å‘ä»€ä¹ˆæ¶ˆæ¯/æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;åŸºäºçŠ¶æ€å†³å®šä½•æ—¶å¯ä»¥åœæ­¢æµ/åºåˆ—ã€‚&lt;/li&gt;
&lt;li&gt;è¿”å›ä¸€ä¸ªæ–°çŠ¶æ€ï¼Œä¸‹æ¬¡è°ƒç”¨æ—¶å¯ä»¥ä½¿ç”¨ï¼ˆé™¤éåœ¨è¿™æ¬¡è°ƒç”¨æ—¶å·²ç»ç»ˆæ­¢åºåˆ—ï¼‰ã€‚&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ª &lt;code&gt;&amp;lt;S&amp;gt;&lt;/code&gt; ç±»å‹çš„å¯å˜å¯¹è±¡ã€‚æ¯”å¦‚ï¼Œä¸Šé¢çš„ç¤ºä¾‹å¯ä»¥ä½¿ç”¨ä¸€ä¸ª &lt;code&gt;AtomicLong&lt;/code&gt; å®ä¾‹ä½œä¸ºçŠ¶æ€æ¥é‡å†™ï¼Œæ¯è½®è°ƒç”¨éƒ½ä¼šæ”¹å˜å®ƒçš„å€¼ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;Flux&amp;amp;lt;String&amp;amp;gt; flux = Flux.generate(
    AtomicLong::new,
    (state, sink) -&amp;amp;gt; {
        long i = state.getAndIncrement();
        sink.next(&amp;amp;quot;3 x &amp;amp;quot; + i + &amp;amp;quot; = &amp;amp;quot; + 3*i);
        if (i == 10) sink.complete();
        return state;
    });&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœçŠ¶æ€å¯¹è±¡åœ¨åºåˆ—ç»ˆæ­¢æ—¶éœ€è¦æ¸…ç†ä¸€äº›èµ„æºï¼Œåˆ™åº”è¯¥ä½¿ç”¨ &lt;code&gt;generate(Supplier&amp;lt;S&amp;gt;, BiFunction, Consumer&amp;lt;S&amp;gt;)&lt;/code&gt; å˜ç§æ–¹æ³•æ¥æ¸…ç†æœ€åçš„çŠ¶æ€å®ä¾‹ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚ä¸‹ç¤ºä¾‹ä½¿ç”¨çš„ &lt;code&gt;generate&lt;/code&gt; æ–¹æ³•æ¥å—ä¸€ä¸ª &lt;code&gt;Consumer&lt;/code&gt; ç±»å‹å‚æ•°ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;Flux&amp;amp;lt;String&amp;amp;gt; flux = Flux.generate(
    AtomicLong::new,
    (state, sink) -&amp;amp;gt; {
        long i = state.getAndIncrement();
        sink.next(&amp;amp;quot;3 x &amp;amp;quot; + i + &amp;amp;quot; = &amp;amp;quot; + 3*i);
        if (i == 10) sink.complete();
        return state;
    }, (state) -&amp;amp;gt; System.out.println(&amp;amp;quot;state: &amp;amp;quot; + state));&lt;/code&gt;&lt;/pre&gt;
&lt;h4&gt;3.4.2 å¼‚æ­¥å¤šçº¿ç¨‹çš„ create&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;create&lt;/code&gt; æ˜¯åŠ¨æ€åˆ›å»ºä¸€ä¸ª &lt;code&gt;Flux&lt;/code&gt; çš„æ›´é«˜çº§çš„æ–¹å¼ï¼Œé€‚ç”¨äºæ¯è½®ä¸‹å‘å¤šä¸ªæ•°æ®ï¼Œç”šè‡³æ˜¯ä»å¤šä¸ªçº¿ç¨‹ä¸­ä¸‹å‘æ•°æ®ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸ªæ–¹æ³•ä¼šå‘å›è°ƒæ–¹æ³•ä¼ å…¥ä¸€ä¸ª &lt;code&gt;FluxSink&lt;/code&gt; å®ä¾‹å‚æ•°ï¼Œåœ¨å›è°ƒæ–¹æ³•ä½“ä¸­å¯ä»¥è°ƒç”¨è¿™ä¸ªå‚æ•°çš„ &lt;code&gt;next&lt;/code&gt;ã€&lt;code&gt;error&lt;/code&gt; å’Œ &lt;code&gt;complete&lt;/code&gt; æ–¹æ³•ã€‚ä¸ &lt;code&gt;generate&lt;/code&gt; ä¸åŒï¼Œå®ƒæ²¡æœ‰åŸºäºçŠ¶æ€çš„å˜ç§æ–¹æ³•ã€‚å¦å¤–ï¼Œå›è°ƒæ–¹æ³•ä¸­ï¼Œå¯ä»¥å¤šçº¿ç¨‹åœ°è§¦å‘äº‹ä»¶ï¼ˆtrigger multi-threaded eventsï¼‰ã€‚&lt;/p&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;create&lt;/code&gt; éå¸¸é€‚ç”¨äºå°†ä¸€ä¸ªå·²æœ‰çš„ API ï¼ˆæ¯”å¦‚ï¼šä¸€ä¸ªåŸºäºç›‘å¬å™¨çš„å¼‚æ­¥ APIï¼‰æ¡¥æ¥åˆ°ååº”å¼ä¸Šä¸‹æ–‡ä¸­ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;create&lt;/code&gt; å¹¶ä¸ä¼šè‡ªåŠ¨å¹¶è¡ŒåŒ–æ‰§è¡Œä½ çš„ä»£ç ï¼Œä¹Ÿä¸ä¼šè®©å¤„ç†è¿‡ç¨‹è‡ªåŠ¨å˜æˆå¼‚æ­¥çš„ï¼Œå³ä½¿å®ƒå¯ä»¥é…åˆå¼‚æ­¥ API ä½¿ç”¨ã€‚å¦‚æœåœ¨ &lt;code&gt;create&lt;/code&gt; çš„ lambda è¡¨è¾¾å¼ä¸­å‘ç”Ÿé˜»å¡ï¼Œå°±ä¼šå­˜åœ¨æ­»é”æˆ–è€…å…¶å®ƒå‰¯ä½œç”¨çš„é£é™©ã€‚å³ä½¿å€ŸåŠ© &lt;code&gt;subscribeOn&lt;/code&gt;ï¼Œä¹Ÿè¦å½“å¿ƒ &lt;code&gt;create&lt;/code&gt; lambda è¡¨è¾¾å¼ä¸­é•¿æ—¶é—´çš„é˜»å¡ï¼ˆæ¯”å¦‚æ— é™å¾ªç¯è°ƒç”¨ &lt;code&gt;sink.next(t)&lt;/code&gt;ï¼‰é”ä½æµæ°´çº¿å¤„ç†ï¼š ï¼ˆè¯‘æ³¨ï¼šå¼‚æ­¥çš„ï¼‰æ•°æ®è¯·æ±‚å¯èƒ½æ ¹æœ¬å¾—ä¸åˆ°æ‰§è¡Œï¼Œå› ä¸ºï¼ˆè¯‘æ³¨ï¼šçº¿ç¨‹æ± åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼‰åŒä¸€ä¸ªçº¿ç¨‹ä¸€ç›´è¢«æ— é™å¾ªç¯å ç”¨ç€ã€‚ä½¿ç”¨ &lt;code&gt;subscribeOn(Scheduler, false)&lt;/code&gt; å˜ç§æ–¹æ³•ï¼š&lt;code&gt;requestOnSeparateThread = false&lt;/code&gt; å°†ä½¿ç”¨ &lt;code&gt;Scheduler&lt;/code&gt; çš„çº¿ç¨‹æ¥æ‰§è¡Œ &lt;code&gt;create&lt;/code&gt; æ–¹æ³•çš„å›è°ƒï¼Œåœ¨åŸå§‹çš„çº¿ç¨‹ä¸­æ‰§è¡Œ &lt;code&gt;request&lt;/code&gt;ï¼Œä»è€Œè®©æ•°æ®ä»ç„¶å¯ä»¥æµåŠ¨èµ·æ¥ã€‚ï¼ˆè¯‘æ³¨ï¼šæ­¤å¤„é€»è¾‘æœ‰ç‚¹ç»•ï¼Œä¹Ÿå¯èƒ½æ˜¯å› ä¸º subscribeOn æ–¹æ³•æœ¬èº«è¯­ä¹‰å°±ä¸å¤ªç›´è§‚ï¼‰ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å‡è®¾æˆ‘ä»¬è¦ä½¿ç”¨ä¸€ä¸ªåŸºäºç›‘å¬å™¨çš„ APIï¼Œå®ƒæŒ‰å—å¤„ç†æ•°æ®ï¼Œæä¾›ä¸¤ç±»äº‹ä»¶ï¼šï¼ˆ1ï¼‰æ¥äº†ä¸€å—æ•°æ®ï¼Œï¼ˆ2ï¼‰å¤„ç†å¯ä»¥ç»“æŸäº†ï¼ˆç»ˆæ­¢äº‹ä»¶ï¼‰ï¼Œå¦‚ä¸‹ &lt;code&gt;MyEventListener&lt;/code&gt; æ¥å£å®šä¹‰æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;interface MyEventListener&amp;amp;lt;T&amp;amp;gt; {
    void onDataChunk(List&amp;amp;lt;T&amp;amp;gt; chunk);
    void processComplete();
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘ä»¬ä½¿ç”¨ &lt;code&gt;create&lt;/code&gt; å°†è¿™ä¸ª API æ¡¥æ¥åˆ°ä¸€ä¸ª &lt;code&gt;Flux&amp;lt;T&amp;gt;&lt;/code&gt; å®ä¾‹ä¸Šï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;Flux&amp;amp;lt;String&amp;amp;gt; bridge = Flux.create(sink -&amp;amp;gt; {
    myEventProcessor.register(  // 4
        new MyEventListener&amp;amp;lt;String&amp;amp;gt;() { // 1
            public void onDataChunk(List&amp;amp;lt;String&amp;amp;gt; chunk) {
                for(String s : chunk) {
                    sink.next(s); // 2
                }
            }
            
            public void processComplete() {
                sink.complete(); // 3
            }
        }
    );
});&lt;/code&gt;&lt;/pre&gt;
&lt;ol&gt;&lt;li&gt;æ¡¥æ¥åˆ° &lt;code&gt;MyEventListener&lt;/code&gt; API&lt;/li&gt;
&lt;li&gt;æ•°æ®å—ä¸­æ¯ä¸ªå…ƒç´ éƒ½æˆäº† &lt;code&gt;Flux&lt;/code&gt; ä¸­çš„å…ƒç´ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;processComplete&lt;/code&gt; äº‹ä»¶è½¬æ¢æˆäº† &lt;code&gt;onComplete&lt;/code&gt; äº‹ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰è¿™äº›é€»è¾‘éƒ½æ˜¯åœ¨ &lt;code&gt;myEventProcessor&lt;/code&gt; æ‰§è¡Œæ—¶å¼‚æ­¥å®Œæˆçš„ã€‚&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ­¤å¤–ï¼Œå› ä¸º &lt;code&gt;create&lt;/code&gt; å¯ä»¥æ¡¥æ¥å¼‚æ­¥ APIï¼Œå¹¶ç®¡ç†åå‹ï¼Œé€šè¿‡æŒ‡å®šä¸€ä¸ª &lt;code&gt;OverflowStrategy&lt;/code&gt; ç­–ç•¥ï¼Œå¯ä»¥è°ƒæ•´å¦‚ä½•æ™ºèƒ½åœ°å¤„ç†åå‹ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;code&gt;IGNORE&lt;/code&gt; å®Œå…¨å¿½ç•¥ä¸‹æ¸¸çš„åå‹è¯·æ±‚ã€‚è¿™ä¸€ç­–ç•¥åœ¨ä¸‹æ¸¸çš„é˜Ÿåˆ—æ»¡æ—¶ï¼ˆwhen queues get full downstreamï¼‰ä¼šå¯¼è‡´ &lt;code&gt;IllegalStateException&lt;/code&gt; å¼‚å¸¸æŠ›å‡ºã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ERROR&lt;/code&gt; åœ¨ä¸‹æ¸¸å¤„ç†ä¸è¿‡æ¥æ—¶ä¼šä¸‹å‘ï¼ˆonErrorï¼‰ä¸€ä¸ª &lt;code&gt;IllegalStateException&lt;/code&gt; å¼‚å¸¸æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;DROP&lt;/code&gt; å¦‚æœä¸‹æ¸¸è¿˜æ²¡å‡†å¤‡å¥½æ¥æ”¶å½“å‰äº‹ä»¶ï¼Œåˆ™ç›´æ¥ä¸¢å¼ƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;BUFFER&lt;/code&gt; ï¼ˆé»˜è®¤ç­–ç•¥ï¼‰å¦‚æœä¸‹æ¸¸å¤„ç†ä¸è¿‡æ¥ï¼Œåˆ™å°†æ‰€æœ‰äº‹ä»¶æ”¾å…¥ç¼“å†²åŒºã€‚ï¼ˆç¼“å†²åŒºå¤§å°æ— é™åˆ¶ï¼Œæ‰€ä»¥å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æº¢å‡º&lt;code&gt;OutOfMemoryError&lt;/code&gt;ï¼‰&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;Mono&lt;/code&gt; ä¹Ÿæœ‰ä¸€ä¸ª &lt;code&gt;create&lt;/code&gt; ç”Ÿæˆå™¨æ–¹æ³•ã€‚Mono çš„ create æ–¹æ³•ä¼ å…¥å›è°ƒçš„ &lt;code&gt;MonoSink&lt;/code&gt; å‚æ•°ä¸å…è®¸ä¸‹å‘å¤šä¸ªæ¶ˆæ¯ï¼Œåœ¨ç¬¬ä¸€ä¸ªæ¶ˆæ¯ä¹‹åå®ƒä¼šä¸¢å¼ƒæ‰€æœ‰çš„æ¶ˆæ¯ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;h4&gt;3.4.3 å¼‚æ­¥å•çº¿ç¨‹çš„ push&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;push&lt;/code&gt; çš„åŠŸèƒ½ä»‹äº &lt;code&gt;generate&lt;/code&gt; å’Œ &lt;code&gt;create&lt;/code&gt; ä¹‹é—´ï¼Œé€‚ç”¨äºå¤„ç†æ¥è‡ªå•ä¸ªç”Ÿäº§è€…çš„äº‹ä»¶ã€‚&lt;code&gt;push&lt;/code&gt; ä¹Ÿå¯ä»¥æ˜¯å¼‚æ­¥çš„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;code&gt;create&lt;/code&gt; æ”¯æŒçš„è¶…é™ç­–ç•¥æ¥ç®¡ç†åå‹ï¼Œç„¶è€Œï¼ŒåŒæ—¶ï¼ˆat a timeï¼‰åªèƒ½æœ‰ä¸€ä¸ªç”Ÿäº§çº¿ç¨‹è°ƒç”¨ &lt;code&gt;next&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;Flux&amp;amp;lt;String&amp;amp;gt; bridge = Flux.push(sink -&amp;amp;gt; {
    myEventProcessor.register(
        new SingleThreadEventListener&amp;amp;lt;String&amp;amp;gt;() { // 1
            
            public void onDataChunk(List&amp;amp;lt;String&amp;amp;gt; chunk) {
                for (String s: chunk) {
                    sink.next(s); // 2
                }
            }
            
            public void processComplete() {
                sink.complete(); // 3
            }
            
            public void processError(Throwable e) {
                sink.error(e); // 4
            }
        }
    );
});&lt;/code&gt;&lt;/pre&gt;
&lt;ol&gt;&lt;li&gt;æ¡¥æ¥åˆ° &lt;code&gt;SingleThreadEventListener&lt;/code&gt; çš„ APIã€‚&lt;/li&gt;
&lt;li&gt;åœ¨å•ä¸ªç›‘å¬å™¨çº¿ç¨‹ä¸­ä½¿ç”¨ &lt;code&gt;next&lt;/code&gt; å‘ä¸‹æ¸¸ï¼ˆsink - æ¥æ”¶æ–¹ï¼‰æ¨é€äº‹ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;complete&lt;/code&gt; äº‹ä»¶ä¹Ÿæ˜¯ç”±åŒä¸€ä¸ªç›‘å¬å™¨çº¿ç¨‹å‘å‡ºçš„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;error&lt;/code&gt; äº‹ä»¶ä¹Ÿæ˜¯ç”±åŒä¸€ä¸ªç›‘å¬å™¨çº¿ç¨‹å‘å‡ºçš„ã€‚&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;æ¨/æ‹‰ æ··åˆæ¨¡å‹&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¤šæ•° Reactor ç®—å­ï¼Œæ¯”å¦‚ &lt;code&gt;create&lt;/code&gt;ï¼Œéƒ½éµä» &lt;strong&gt;æ¨/æ‹‰ï¼ˆpush/pullï¼‰&lt;/strong&gt; æ··åˆæ¨¡å‹ã€‚è¿™æ„å‘³ç€å°½ç®¡å¤§éƒ¨åˆ†çš„å¤„ç†è¿‡ç¨‹éƒ½æ˜¯å¼‚æ­¥çš„ï¼ˆæš—æŒ‡â€œæ¨â€çš„æ–¹å¼ï¼‰ï¼Œä¹Ÿå­˜åœ¨å°éƒ¨åˆ†é€»è¾‘æ˜¯ &lt;em&gt;æ‹‰ï¼ˆpullï¼‰&lt;/em&gt;æ–¹å¼ï¼šæ•°æ®è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ¶ˆè´¹è€…ä»æ•°æ®æº&lt;em&gt;æ‹‰å–&lt;/em&gt;æ•°æ®ï¼Œæ„æŒ‡ï¼šæ•°æ®æºåœ¨æ¶ˆè´¹è€…é¦–æ¬¡è¯·æ±‚åæ‰ä¼šå‘å‡ºæ•°æ®ï¼Œç„¶ååªæœ‰è¦æ•°æ®å°±ä¼šæ¨é€ç»™æ¶ˆè´¹è€…ï¼Œä¸è¿‡æ•°æ®é‡ä¸ä¼šè¶…è¿‡æ¶ˆè´¹è€…è¯·æ±‚çš„é‡ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;push()&lt;/code&gt; å’Œ &lt;code&gt;create()&lt;/code&gt; éƒ½å¯ä»¥é…ç½®ï¼ˆset upï¼‰ä¸€ä¸ª &lt;code&gt;onRequest&lt;/code&gt; äº‹ä»¶æ¶ˆè´¹è€…æ¥ç®¡ç†è¯·æ±‚é‡ï¼Œå¹¶ä¸”ç¡®ä¿ä»…å½“å­˜åœ¨å·²å‘èµ·çš„è¯·æ±‚ï¼Œæ•°æ®æ‰ä¼šæ¨é€ç»™ä¸‹æ¸¸ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;Flux&amp;amp;lt;String&amp;amp;gt; bridge = Flux.create(sink -&amp;amp;gt; {
    myMessageProcessor.register(
        new MyMessageListener&amp;amp;lt;String&amp;amp;gt;() {
            
            public void onMessage(List&amp;amp;lt;String&amp;amp;gt; messages) {
                for (String s: messages) {
                    sink.next(s); // 3
                }
            }
        }
    );
    sink.onRequest(n -&amp;amp;gt; {
        List&amp;amp;lt;String&amp;amp;gt; messages = myMessageProcessor.getHistory(n); // 1
        for (String s: messages) {
            sink.next(s); // 2
        }
    });    
});&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;em&gt;è¯‘è€…æ³¨ï¼šä¸Šé¢è¿™ä¸ªç¤ºä¾‹æœ‰ç‚¹é—®é¢˜ï¼Œå®é™…å¹¶ä¸å­˜åœ¨è¿™æ ·ä¸€ä¸ª create æ–¹æ³•ï¼Œå¹¶ä¸” sink.onRequest å®é™…ä»£è¡¨ä¸€ä¸ªæ— é™é‡ï¼ˆn = Long.MAX_VALUEï¼‰çš„è¯·æ±‚ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;åœ¨è¯·æ±‚å‘èµ·åï¼Œæ‹‰å–æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœå³åˆ»æœ‰æ¶ˆæ¯äº†ï¼Œåˆ™æ¨é€ç»™ä¸‹æ¸¸ã€‚&lt;/li&gt;
&lt;li&gt;åç»­å¼‚æ­¥åˆ°è¾¾çš„æ¶ˆæ¯ä¹Ÿä¼šæ¨é€ç»™ä¸‹æ¸¸ã€‚&lt;/li&gt;&lt;/ol&gt;
&lt;h3&gt;3.5 å¤šçº¿ç¨‹ å’Œ è°ƒåº¦å™¨ ï¼ˆThreading and Schedulersï¼‰&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Reactorï¼Œä¸ RxJava ç±»ä¼¼ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯&lt;strong&gt;å¹¶å‘æ— å…³çš„&lt;/strong&gt;ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒReactor å¹¶ä¸å¼ºåˆ¶ä½¿ç”¨å¹¶å‘ï¼ˆa concurrency&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;modelï¼‰ï¼Œè€Œæ˜¯ï¼Œè®©å¼€å‘è€…æŒ‰éœ€å†³å®šæ˜¯å¦ä½¿ç”¨å¹¶å‘ã€‚ç„¶è€Œï¼ŒReactor ä¹Ÿæä¾›ä¸€äº›åŠŸèƒ½æ–¹ä¾¿å¼€å¯å¹¶å‘ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è·å–åˆ°ä¸€ä¸ª &lt;code&gt;Flux&lt;/code&gt; æˆ– &lt;code&gt;Mono&lt;/code&gt; å¤„ç†æµï¼Œå¹¶ä¸æ„å‘³ç€å®ƒåœ¨ä¸€ä¸ªä¸“ç”¨ï¼ˆdedicatedï¼‰çš„çº¿ç¨‹ï¼ˆ&lt;code&gt;Thread&lt;/code&gt;ï¼‰ ä¸­è¿è¡Œã€‚ç›¸åï¼Œå¤šæ•°ç®—å­ä¹Ÿæ˜¯è¿è¡Œåœ¨å‰ä¸€ä¸ªç®—å­è¿è¡Œçš„çº¿ç¨‹ä¸­ã€‚é™¤éç‰¹æ„æŒ‡å®šï¼Œé¦–ä¸ªï¼ˆtopmostï¼‰ç®—å­ï¼ˆæ•°æ®æºï¼‰å°±è¿è¡Œåœ¨æ‰§è¡Œ &lt;code&gt;subscribe()&lt;/code&gt; æ–¹æ³•è°ƒç”¨çš„çº¿ç¨‹ä¸­ã€‚å¦‚ä¸‹ç¤ºä¾‹åœ¨ä¸€ä¸ªæ–°å»ºçº¿ç¨‹ä¸­è¿è¡Œä¸€ä¸ª &lt;code&gt;Mono&lt;/code&gt; å¤„ç†æµã€‚&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;public static void main(String[] args) {
    final Mono&amp;amp;lt;String&amp;amp;gt; mono = Mono.just(&amp;amp;quot;Hello &amp;amp;quot;); // 1
    
    new Thread(() -&amp;amp;gt; mono
        .map(msg -&amp;amp;gt; msg + &amp;amp;quot;thread &amp;amp;quot;)
        .subscribe(v -&amp;amp;gt; // 2 
            System.out.println(v + Thread.currentThread().getName()) // 3
        )
    ).join();
}&lt;/code&gt;&lt;/pre&gt;
&lt;ol&gt;&lt;li&gt;&lt;code&gt;Mono&amp;lt;String&amp;gt;&lt;/code&gt; æ˜¯åœ¨ä¸»ï¼ˆ&lt;code&gt;main&lt;/code&gt;ï¼‰çº¿ç¨‹ä¸­è£…é…çš„ï¼ˆassembledï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶è€Œï¼Œ è®¢é˜…æ“ä½œå‘ç”Ÿåœ¨ &lt;code&gt;Thread-0&lt;/code&gt; çº¿ç¨‹ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;å› è€Œï¼Œ&lt;code&gt;map&lt;/code&gt; å’Œ &lt;code&gt;onNext&lt;/code&gt; çš„å›è°ƒï¼ˆè¯‘æ³¨ï¼š&lt;code&gt;onNext&lt;/code&gt; çš„å›è°ƒå³ subscribe æ–¹æ³•ä¼ å…¥çš„ lambda è¡¨è¾¾å¼ï¼‰å®é™…ä¸Šä¹Ÿæ˜¯åœ¨ &lt;code&gt;Thread-0&lt;/code&gt; ä¸Šæ‰§è¡Œã€‚&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸Šè¿°çš„ä»£ç ä¼šè¾“å‡ºå¦‚ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;hello thread Thread-0&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Reactor ä¸­ï¼Œè¿è¡Œæ¨¡å‹ä»¥åŠå®é™…çš„è¿è¡Œè¿‡ç¨‹å‘ç”Ÿåœ¨ä»€ä¹ˆåœ°æ–¹ç”±ä½¿ç”¨ä»€ä¹ˆ &lt;code&gt;Scheduler&lt;/code&gt; å†³å®šã€‚&lt;a href=&apos;https://projectreactor.io/docs/core/release/api/reactor/core/scheduler/Scheduler.html&apos;&gt;Scheduler&lt;/a&gt; ç±»ä¼¼äº &lt;code&gt;ExecutorService&lt;/code&gt;ï¼Œè´Ÿæœ‰è°ƒåº¦èŒè´£ï¼Œä½†å…·å¤‡ä¸€ä¸ªä¸“ç”¨çš„æŠ½è±¡ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ï¼Œå……å½“ä¸€ä¸ªæ—¶é’Ÿçš„è§’è‰²ï¼Œå¯ç”¨çš„å®ç°æ›´å¤šã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;a href=&apos;https://projectreactor.io/docs/core/release/api/reactor/core/scheduler/Schedulers.html&apos;&gt;Schedulers&lt;/a&gt; ç±»æä¾›äº†ä¸€äº›é™æ€æ–¹æ³•æ¥è®¿é—®è¿™äº›è¿è¡Œä¸Šä¸‹æ–‡ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å½“å‰çº¿ç¨‹ï¼ˆ&lt;code&gt;Schedulers.immediate()&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å•ä¸ªå¯å¤ç”¨çš„çº¿ç¨‹ï¼ˆ&lt;code&gt;Schedulers.single()&lt;/code&gt;ï¼‰ã€‚æ³¨æ„ï¼šè¿™ä¸ªæ–¹æ³•ä¼šä¸ºæ‰€æœ‰è°ƒç”¨æ–¹ï¼ˆè¯‘æ³¨ï¼šè°ƒç”¨ Schedulers.single()ï¼‰å¤ç”¨åŒä¸€ä¸ªçº¿ç¨‹ï¼ŒæŒ‡å¯¼ &lt;code&gt;Scheduler&lt;/code&gt; é”€æ¯ï¼ˆdisposedï¼‰ã€‚å¦‚æœæœŸæœ›æ¯æ¬¡è°ƒç”¨è¿”å›ä¸€ä¸ªä¸“ç”¨çº¿ç¨‹ï¼Œåˆ™åº”è¯¥ä½¿ç”¨ &lt;code&gt;Schedulers.newSingle()&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªå¼¹æ€§çš„çº¿ç¨‹æ± ï¼ˆ&lt;code&gt;Schedulers.elastic()&lt;/code&gt;ï¼‰ã€‚è¿™ä¸ª Scheduler ä¼šæŒ‰éœ€åˆ›å»ºæ–°çš„å·¥ä½œè€…çº¿ç¨‹æ± ï¼ˆworker poolï¼‰ï¼Œå¹¶å¤ç”¨ç©ºé—²çš„å·¥ä½œè€…çº¿ç¨‹æ± ã€‚å¦‚æœå·¥ä½œè€…çº¿ç¨‹æ± ç©ºé—²æ—¶é—´å¤ªé•¿ï¼ˆé»˜è®¤ 60sï¼‰åˆ™ä¼šè¢«é”€æ¯ã€‚å¯¹äº I/O é˜»å¡å·¥ä½œè€Œè¨€è¿™æ˜¯ä¸€ä¸ªå¥½é€‰æ‹©ã€‚&lt;code&gt;Schedulers.elastic()&lt;/code&gt; å¯ä»¥ç®€ä¾¿åœ°ä¸ºé˜»å¡å¤„ç†è¿‡ç¨‹æä¾›ç‹¬ç«‹çš„çº¿ç¨‹ï¼ˆits own threadï¼‰ï¼Œè¿™æ ·é˜»å¡æ“ä½œå°±ä¸ä¼šå ç”¨ï¼ˆtie upï¼‰å…¶ä»–èµ„æºã€‚è¯¦æƒ…è¯·å‚è€ƒ &lt;a href=&apos;https://projectreactor.io/docs/core/release/reference/#faq.wrap-blocking&apos;&gt;å¦‚ä½•åŒ…è£…ä¸€ä¸ªåŒæ­¥é˜»å¡çš„è°ƒç”¨ï¼Ÿ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å›ºå®šæ•°é‡å·¥ä½œè€…çš„ï¼ˆè¯‘æ³¨ï¼šæˆ‘æš‚æ—¶çš„ç†è§£ - å·¥ä½œè€…ï¼ˆworkerï¼‰ä¹Ÿæ˜¯ä¸€ä¸ªçº¿ç¨‹æ± ï¼‰ä¸€ä¸ªæ± ï¼Œä¸“é—¨ä¸ºå¹¶è¡Œå¤„ç†å·¥ä½œåšè¿‡è°ƒä¼˜ï¼ˆSchedulers.parallel()ï¼‰ã€‚å®ƒä¼šåˆ›å»ºå’Œ CPU æ ¸å¿ƒæ•°é‡ç›¸åŒçš„å·¥ä½œè€…ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;code&gt;Schedulers.fromExecutorService(ExecutorService)&lt;/code&gt; åŸºäºå·²æœ‰çš„ ExecutorService åˆ›å»ºä¸€ä¸ª Schedulerã€‚ï¼ˆä¹Ÿå¯ä»¥åŸºäºä¸€ä¸ª Executor æ¥åˆ›å»ºï¼Œä½†ä¸å»ºè®®è¿™ä¹ˆå¹²ï¼ˆè¯‘æ³¨ï¼šå› ä¸º Executor ä¸èƒ½é”€æ¯é‡Šæ”¾ï¼‰ï¼‰&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;strong&gt;newXXX&lt;/strong&gt; è¿™ç±»æ–¹æ³•åˆ›å»ºå„ç§è°ƒåº¦å™¨ï¼ˆschedulerï¼‰ç±»å‹çš„å…¨æ–°å®ä¾‹ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ &lt;code&gt;Schedulers.newElastic(yourScheduleName)&lt;/code&gt; åˆ›å»ºä¸€ä¸ªåä¸º &lt;code&gt;yourScheduleName&lt;/code&gt; çš„å…¨æ–°çš„å¼¹æ€§è°ƒåº¦å™¨ï¼ˆelastic schedulerï¼‰ã€‚&lt;/p&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;elastic&lt;/code&gt; è°ƒåº¦å™¨ç”¨äºå…¼å®¹å¤„ç†ä¸å¯é¿å…çš„å†å²é—ç•™çš„é˜»å¡æ€§ä»£ç ï¼Œä½† &lt;code&gt;single&lt;/code&gt; å’Œ &lt;code&gt;parallel&lt;/code&gt; è°ƒåº¦å™¨ä¸è¡Œï¼Œå› è€Œï¼Œå¦‚æœåœ¨ &lt;code&gt;single&lt;/code&gt; æˆ– &lt;code&gt;parallel&lt;/code&gt; è°ƒåº¦å™¨ä¸Šä½¿ç”¨ Reactor çš„é˜»å¡æ€§ APIï¼ˆ&lt;code&gt;block()&lt;/code&gt;ã€&lt;code&gt;blockFirst()&lt;/code&gt;ã€&lt;code&gt;blockLast()&lt;/code&gt;ï¼Œæˆ–è€…è¿›è¡Œ &lt;code&gt;toIterable()&lt;/code&gt; æˆ– &lt;code&gt;toStream()&lt;/code&gt; è¿­ä»£ï¼‰ï¼Œä¼šå¯¼è‡´æŠ›å‡º &lt;code&gt;IllegalStateException&lt;/code&gt; å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœè‡ªå®šä¹‰è°ƒåº¦å™¨æ‰€åˆ›å»ºçš„çº¿ç¨‹å®ä¾‹å®ç°äº† &lt;code&gt;NonBlocking&lt;/code&gt; æ ‡è®°æ€§æ¥å£ï¼ˆmarker interfaceï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªè°ƒåº¦å™¨ä¹Ÿå¯ä»¥è¢«æ ‡è®°ä¸ºâ€ä»…é€‚ç”¨äºéé˜»å¡æ€§ä½¿ç”¨ï¼ˆnon blocking onlyï¼‰â€œã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æŸäº›ç®—å­é»˜è®¤ä¼šä» &lt;code&gt;Schedulers&lt;/code&gt; é€‰æ‹©ä¸€ä¸ªç‰¹å®šçš„è°ƒåº¦å™¨æ¥ä½¿ç”¨ï¼ˆé€šå¸¸ä¹Ÿæ”¯æŒé€‰æ‹©å…¶ä»–çš„ï¼‰ã€‚ä¾‹å¦‚ï¼Œè°ƒç”¨å·¥å‚æ–¹æ³• &lt;code&gt;Flux.interval(Duration.ofMills(300))&lt;/code&gt; ä¼šç”Ÿæˆä¸€ä¸ª &lt;code&gt;Flux&amp;lt;Long&amp;gt;&lt;/code&gt; å®ä¾‹ - æ¯ 300 ms è¾“å‡ºä¸€ä¸ªæ»´ç­”äº‹ä»¶ã€‚è¿™ä¸ªæ–¹æ³•åº•å±‚å®ç°é»˜è®¤ä½¿ç”¨ &lt;code&gt;Schedulers.parallel()&lt;/code&gt;ã€‚å¦‚ä¸‹ä»£ç è¡Œæ¼”ç¤ºäº†å¦‚ä½•å°†è°ƒåº¦å™¨ä¿®æ”¹æˆç±»ä¼¼äº &lt;code&gt;Schedulers.single()&lt;/code&gt; çš„è°ƒåº¦å™¨æ–°å®ä¾‹ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;Flux.interval(Duration.ofMillis(300), Schedulers.newSingle(&amp;amp;quot;test&amp;amp;quot;));&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Reactor æä¾›äº†ä¸¤ç§æ–¹å¼æ¥åˆ‡æ¢ååº”å¼é“¾ä¸­çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆæˆ–è€…è¯´ &lt;code&gt;è°ƒåº¦å™¨&lt;/code&gt;ï¼‰ï¼š&lt;code&gt;publishOn&lt;/code&gt; å’Œ &lt;code&gt;subscribeOn&lt;/code&gt;ã€‚ä¸¤è€…éƒ½æ˜¯æ¥å—ä¸€ä¸ª &lt;code&gt;Scheduler&lt;/code&gt; ç±»å‹å‚æ•°å¹¶å°†æ‰§è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢åˆ°è¿™ä¸ªè°ƒåº¦å™¨ã€‚ä¸è¿‡ï¼Œé“¾ä¸­ &lt;code&gt;publishOn&lt;/code&gt; æ‰€å¤„çš„ä½ç½®å¾ˆå…³é”®ï¼Œè€Œ &lt;code&gt;subscribeOn&lt;/code&gt; å¤„äºå“ªä¸ªä½ç½®éƒ½æ— æ‰€è°“ã€‚è¦ç†è§£è¿™ä¸ªå·®åˆ«çš„åŸå› ï¼Œå¾—å…ˆç†è§£ &lt;a href=&apos;https://projectreactor.io/docs/core/release/reference/#reactive.subscribe&apos;&gt;è®¢é˜…ä¹‹å‰å®é™…ä»€ä¹ˆéƒ½æ²¡æœ‰å‘ç”Ÿ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Reactorï¼Œä¸²æ¥ç®—å­ï¼Œå°±æ˜¯å°†å¾ˆå¤š &lt;code&gt;Flux&lt;/code&gt; å’Œ &lt;code&gt;Mono&lt;/code&gt; çš„å®ç°ä¸€ä¸ªå¥—ä¸€ä¸ªï¼Œé€å±‚å°è£…ã€‚ä¸€æ—¦è®¢é˜…ï¼Œå°±åˆ›å»ºäº†ä¸€ä¸ª &lt;code&gt;Subscriber&lt;/code&gt; å¯¹è±¡é“¾ï¼Œæ²¿é“¾å›æº¯å³å¯æ‰¾åˆ°ç¬¬ä¸€ä¸ªå‘å¸ƒè€…ã€‚è¿™äº›å®ç°ç»†èŠ‚æ˜¯éšè—åœ¨æ¥å£èƒŒåï¼Œå¼€å‘è€…å¯è§çš„æ˜¯æœ€å¤–å±‚çš„é‚£ä¸ª &lt;code&gt;Flux&lt;/code&gt;ï¼ˆæˆ– &lt;code&gt;Mono&lt;/code&gt;ï¼‰ä»¥åŠ &lt;code&gt;Subscription&lt;/code&gt;ï¼ˆè¯‘æ³¨ï¼šReactor ä¸­ Subscription æ˜¯ä¸€ä¸ªæ¥å£ç±»å‹ï¼Œæ˜¯ &lt;code&gt;Subscriber&lt;/code&gt; æ¥å£ä¸­ &lt;code&gt;onSubscribe&lt;/code&gt; æ–¹æ³•å‚æ•°çš„ç±»å‹ - &lt;code&gt;public void onSubscribe(Subscription s)&lt;/code&gt;ï¼Œç”¨äºå‘ç”Ÿäº§è€…è¯·æ±‚æ•°æ® æˆ–è€… å–æ¶ˆè®¢é˜…ï¼‰ï¼Œä½†è¿™äº›ç®—å­ç‰¹å®šçš„é“¾ä¸­æ¶ˆè´¹è€…æ˜¯å¹•ååŠŸè‡£ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ‰äº†ä¸Šé¢è¿™äº›è®¤çŸ¥ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥äº†è§£ &lt;code&gt;publishOn&lt;/code&gt; å’Œ &lt;code&gt;subscribeOn&lt;/code&gt; è¿™ä¸¤ä¸ªç®—å­ï¼š&lt;/p&gt;
&lt;h4&gt;3.5.1 publishOn æ–¹æ³•&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;publishOn&lt;/code&gt; å’Œå…¶ä»–ç®—å­çš„ç”¨æ³•ä¸€æ ·ï¼Œç”¨åœ¨è®¢é˜…é“¾çš„ä¸­é—´ç¯èŠ‚ï¼Œæ¥æ”¶æ¥è‡ªä¸Šæ¸¸çš„ä¿¡å·ï¼Œç„¶åå‘ä¸‹æ¸¸é‡æ”¾è¿™äº›ä¿¡å·ï¼Œä¸è¿‡ä¸‹å‘äº‹ä»¶å›è°ƒï¼ˆ&lt;code&gt;onEvent&lt;/code&gt;ã€&lt;code&gt;onError&lt;/code&gt;ã€&lt;code&gt;onComplete&lt;/code&gt;ï¼‰æ˜¯åœ¨å…³è” &lt;code&gt;Scheduler&lt;/code&gt; çš„ä¸€ä¸ªå·¥ä½œè€…ä¸Šæ‰§è¡Œçš„ã€‚å› æ­¤ï¼Œè¿™ä¸ªç®—å­ä¼šå½±å“åç»­ç®—å­åœ¨å“ªæ‰§è¡Œï¼ˆç›´åˆ°è®¢é˜…é“¾ä¸Šåˆä¸²æ¥äº†å¦ä¸€ä¸ª &lt;code&gt;publishOn&lt;/code&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å°†æ‰§è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢åˆ° &lt;code&gt;Scheduler&lt;/code&gt; é€‰æ‹©çš„ä¸€ä¸ªçº¿ç¨‹ä¸Š&lt;/li&gt;
&lt;li&gt;æ ¹æ®è§„èŒƒï¼ˆas per the specificationï¼‰ï¼Œ&lt;code&gt;onNext&lt;/code&gt; æ˜¯æŒ‰æ—¶åºä¾æ¬¡è°ƒç”¨ä¸‹å‘äº‹ä»¶çš„ï¼Œæ‰€ä»¥æ˜¯å ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼ˆè¯‘æ³¨ï¼šè¿™å¥ä¸å¤ªç†è§£ï¼ŒonNext happen in sequence, so this uses up a single threadï¼‰&lt;/li&gt;
&lt;li&gt;é™¤éç®—å­å·¥ä½œåœ¨ä¸€ä¸ªç‰¹å®šçš„ &lt;code&gt;Scheduler&lt;/code&gt; ä¸Šï¼ˆè¯‘æ³¨ï¼šæŸäº›ç®—å­çš„å†…éƒ¨å®ç°å†³å®šäº†è¿™ä¸€ç‚¹ï¼‰ï¼Œ&lt;code&gt;publishOn&lt;/code&gt; ä¹‹åçš„ç®—å­éƒ½æ˜¯åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸Šæ‰§è¡Œ&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;Scheduler s = Schedulers.newParallel(&amp;amp;quot;parallel-scheduler&amp;amp;quot;, 4); // 1

final Flux&amp;amp;lt;String&amp;amp;gt; flux = Flux
    .range(1, 2)
    .map(i -&amp;amp;gt; 10 + i) // 2
    .publishOn(s) // 3
    .map(i -&amp;amp;gt; &amp;amp;quot;value &amp;amp;quot; + i); // 4

new Thread(() -&amp;amp;gt; flux.subscribe(System.out::println));&lt;/code&gt;&lt;/pre&gt;
&lt;ol&gt;&lt;li&gt;åˆ›å»ºä¸€ä¸ªæ–°çš„ &lt;code&gt;Scheduler&lt;/code&gt;ï¼Œå†…å« 4 ä¸ªçº¿ç¨‹&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸€ä¸ª &lt;code&gt;map&lt;/code&gt; è¿è¡Œåœ¨ &lt;ç¬¬5æ­¥&gt; çš„åŒ¿åçº¿ç¨‹ä¸Š&lt;/li&gt;
&lt;li&gt;&lt;code&gt;publishOn&lt;/code&gt; å°†æ•´ä¸ªåºåˆ—çš„åç»­å¤„ç†åˆ‡æ¢åˆ°ä» &lt;ç¬¬1æ­¥&gt; é€‰å‡ºçš„çº¿ç¨‹ä¸Š&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒä¸ª &lt;code&gt;map&lt;/code&gt; è¿è¡Œåœ¨ä¸Šé¢è¯´çš„ä» &lt;ç¬¬1æ­¥&gt; é€‰å‡ºçš„çº¿ç¨‹ä¸Š&lt;/li&gt;
&lt;li&gt;è¿™ä¸ªåŒ¿åçº¿ç¨‹æ˜¯ &lt;em&gt;è®¢é˜…&lt;/em&gt; æ“ä½œå‘ç”Ÿçš„åœ°æ–¹ã€‚æ‰“å°è¯­å¥å‘ç”Ÿåœ¨ &lt;code&gt;publishOn&lt;/code&gt; åˆ‡æ¢çš„æœ€æ–°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸Š&lt;/li&gt;&lt;/ol&gt;
&lt;h4&gt;3.5.2 subscribeOn æ–¹æ³•&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;subscribeOn&lt;/code&gt; åœ¨æ„é€ åå‘é“¾æ—¶åº”ç”¨äºè®¢é˜…å¤„ç†è¿‡ç¨‹ï¼ˆè¯‘æ³¨ï¼šæ‰€è°“æ„é€ åå‘é“¾æ—¶ï¼Œæ˜¯æŒ‡è°ƒç”¨ subscribe æ–¹æ³•æ—¶ï¼‰ã€‚å› æ­¤ï¼Œæ— è®ºä½ å°† &lt;code&gt;subscribeOn&lt;/code&gt; æ”¾åœ¨ç®—å­é“¾çš„ä½•å¤„ï¼Œ&lt;strong&gt;å®ƒå§‹ç»ˆä¼šå½±å“æºå¤´ä¸‹å‘æ•°æ®çš„æ‰§è¡Œä¸Šä¸‹æ–‡&lt;/strong&gt;ã€‚ç„¶è€Œï¼Œè¿™å¹¶ä¸ä¼šå½±å“ &lt;code&gt;publishOn&lt;/code&gt; ä¹‹åç®—å­è°ƒç”¨çš„è¡Œä¸ºï¼Œå®ƒä»¬ä»ç„¶ä¼šåˆ‡æ¢åˆ° &lt;code&gt;publishOn&lt;/code&gt; æŒ‡å®šçš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ä»è®¢é˜…æ“ä½œå‘ç”Ÿæ—¶æ•´ä¸ªç®—å­é“¾æ‰€åœ¨çš„çº¿ç¨‹åˆ‡æ¢åˆ°æ–°çš„çº¿ç¨‹&lt;/li&gt;
&lt;li&gt;ä»æŒ‡å®š &lt;code&gt;Scheduler&lt;/code&gt; ä¸­é€‰æ‹©ä¸€ä¸ªçº¿ç¨‹&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;åªæœ‰é“¾ä¸­æœ€æ—©çš„ &lt;code&gt;subscribeOn&lt;/code&gt; è°ƒç”¨ä¼šå‘ç”Ÿå®é™…ä½œç”¨ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;Scheduler s = Schedulers.newParallel(&amp;amp;quot;parallel-scheduler&amp;amp;quot;, 4); // 1

final Flux&amp;amp;lt;String&amp;amp;gt; flux = Flux
    .range(1, 2)
    .map(i -&amp;amp;gt; 10 + i) // 2
    .subscribeOn(s) // 3
    .map(i -&amp;amp;gt; &amp;amp;quot;value &amp;amp;quot; + i); // 4

new Thread(() -&amp;amp;gt; flux.subscribe(System.out::println)); // 5 &lt;/code&gt;&lt;/pre&gt;
&lt;ol&gt;&lt;li&gt;åˆ›å»ºä¸€ä¸ªæ–°çš„ &lt;code&gt;Scheduler&lt;/code&gt;ï¼Œå†…å« 4 ä¸ªçº¿ç¨‹&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸€ä¸ª &lt;code&gt;map&lt;/code&gt; è¿è¡Œåœ¨è¿™ 4 ä¸ªçº¿ç¨‹ä¸­çš„æŸä¸ªçº¿ç¨‹ä¸Š&lt;/li&gt;
&lt;li&gt;...å› ä¸º &lt;code&gt;subscribeOn&lt;/code&gt; å°†æ•´ä¸ªåºåˆ—å¤„ç†é“¾ä»è®¢é˜…æ“ä½œå‘ç”Ÿæ—¶çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆç¬¬5æ­¥ï¼‰åˆ‡æ¢åˆ°äº†æ–°çš„ä¸Šä¸‹æ–‡&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒä¸ª &lt;code&gt;map&lt;/code&gt; å’Œç¬¬ä¸€ä¸ª &lt;code&gt;map&lt;/code&gt; è¿è¡Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸Š&lt;/li&gt;
&lt;li&gt;è¿™ä¸ªåŒ¿åçº¿ç¨‹æ˜¯ &lt;em&gt;è®¢é˜…æ“ä½œ&lt;/em&gt; ä¸€å¼€å§‹å‘ç”Ÿçš„åœ°æ–¹çš„ï¼Œä½†æ˜¯ &lt;code&gt;subscribeOn&lt;/code&gt; å³åˆ»å°†ä¸Šä¸‹æ–‡åˆ‡æ¢åˆ°è°ƒåº¦å™¨4ä¸ªçº¿ç¨‹ä¸­çš„ä¸€ä¸ªä¸Š&lt;/li&gt;&lt;/ol&gt;
&lt;h2&gt;4. é«˜çº§ç‰¹æ€§å’Œæ¦‚å¿µ&lt;/h2&gt;
&lt;h3&gt;4.1 ä½¿ç”¨ ConnectableFlux å°†æ¶ˆæ¯å¹¿æ’­åˆ°å¤šä¸ªè®¢é˜…è€…&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;em&gt;ä»¥åæœ‰ç©ºå†ç¿»è¯‘&lt;/em&gt;&lt;/p&gt;
&lt;h3&gt;4.2 3ç§åˆ†æ‰¹å¤„ç†æ–¹å¼&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;em&gt;ä»¥åæœ‰ç©ºå†ç¿»è¯‘&lt;/em&gt;&lt;/p&gt;
&lt;h3&gt;4.3 ä½¿ç”¨ ParallelFlux å¹¶è¡ŒåŒ–å¤„ç†&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚ä»Šå¤šæ ¸æ¶æ„å·²æ˜¯ä¸‹é‡Œå·´äººï¼Œç›¸åº”åœ°ï¼Œè½»æ¾å®ç°å¹¶è¡ŒåŒ–å·¥ä½œçš„å·¥å…·æ‰‹æ®µå¾ˆå…³é”®ã€‚Reactor æä¾›äº†ä¸€ä¸ªç‰¹æ®Šç±»å‹ - &lt;code&gt;ParallelFlux&lt;/code&gt; - å¸®åŠ©å®ç°å¹¶è¡ŒåŒ–å¤„ç†ã€‚&lt;code&gt;ParallelFlux&lt;/code&gt; æä¾›çš„ç®—å­æ˜¯ä¸ºå¹¶è¡ŒåŒ–å·¥ä½œä¼˜åŒ–è¿‡çš„ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹ä»»æ„ &lt;code&gt;Flux&lt;/code&gt; å®ä¾‹è°ƒç”¨ &lt;code&gt;parallel()&lt;/code&gt;ç®—å­å°±èƒ½å¾—åˆ°ä¸€ä¸ª &lt;code&gt;ParallelFlux&lt;/code&gt; å®ä¾‹ã€‚è¿™ä¸ªæ–¹æ³•æœ¬èº«å¹¶ä¸èƒ½å®ç°å¹¶è¡ŒåŒ–å·¥ä½œï¼Œè€Œæ˜¯å°†å·¥ä½œè´Ÿè½½æ‹†åˆ†åˆ°å¤šä¸ªâ€œè½¨é“â€ï¼ˆé»˜è®¤â€œè½¨é“â€æ•°é‡ç­‰äº CPU æ ¸æ•°ï¼‰&lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot; role=&quot;doc-noteref&quot;&gt;[1]&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸ºäº†å‘ŠçŸ¥äº§å‡ºçš„ ParallelFlux å®ä¾‹æ¯ä¸ªâ€œè½¨é“â€åœ¨å“ªæ‰§è¡Œï¼ˆä»¥åŠå¦‚ä½•å¹¶è¡Œæ‰§è¡Œâ€œè½¨é“â€ï¼‰ï¼Œåˆ™å¿…é¡»ä½¿ç”¨ &lt;code&gt;runOn(Scheduler)&lt;/code&gt;ã€‚æ³¨æ„ï¼šå¯¹äºå¹¶è¡Œå·¥ä½œï¼Œæ¨èä½¿ç”¨ä¸€ä¸ªä¸“ç”¨è°ƒåº¦å™¨ - &lt;code&gt;Schedulers.parallel()&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹æ¯”å¦‚ä¸‹ä¸¤ä¸ªç¤ºä¾‹ï¼Œç¬¬ä¸€ä¸ªç¤ºä¾‹çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;Flux.range(1, 10)
    .parallel(2) // 1
    .subscribe(i -&amp;amp;gt; System.out.println(Thread.currentThread().getName() + &amp;amp;quot; -&amp;amp;gt; &amp;amp;quot; + i));&lt;/code&gt;&lt;/pre&gt;
&lt;ol&gt;&lt;li&gt;è¿™é‡Œå¼ºåˆ¶æŒ‡å®šäº†â€œè½¨é“â€æ•°é‡ï¼Œè€Œä¸ä¾èµ–äº CPU æ ¸æ•°ã€‚&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç¬¬äºŒä¸ªç¤ºä¾‹çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;Flux.range(1, 10)
    .parallel(2)
    .runOn(Schedulers.parallel())
    .subscribe(i -&amp;amp;gt; System.out.println(Thread.currentThread().getName() + &amp;amp;quot; -&amp;amp;gt; &amp;amp;quot; + i));&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç¬¬ä¸€ä¸ªç¤ºä¾‹è¾“å‡ºå¦‚ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;main -&amp;amp;gt; 1
main -&amp;amp;gt; 2
main -&amp;amp;gt; 3
main -&amp;amp;gt; 4
main -&amp;amp;gt; 5
main -&amp;amp;gt; 6
main -&amp;amp;gt; 7
main -&amp;amp;gt; 8
main -&amp;amp;gt; 9
main -&amp;amp;gt; 10&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç¬¬äºŒä¸ªç¤ºä¾‹æ­£ç¡®åœ°åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¸Šå®ç°äº†å¹¶è¡ŒåŒ–ï¼Œè¾“å…¥å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;parallel-1 -&amp;amp;gt; 1
parallel-2 -&amp;amp;gt; 2
parallel-1 -&amp;amp;gt; 3
parallel-2 -&amp;amp;gt; 4
parallel-1 -&amp;amp;gt; 5
parallel-2 -&amp;amp;gt; 6
parallel-1 -&amp;amp;gt; 7
parallel-1 -&amp;amp;gt; 9
parallel-2 -&amp;amp;gt; 8
parallel-2 -&amp;amp;gt; 10&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœæ•°æ®åºåˆ—&lt;sup id=&quot;fnref:2&quot;&gt;&lt;a href=&quot;#fn:2&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot; role=&quot;doc-noteref&quot;&gt;[2]&lt;/a&gt;&lt;/sup&gt;å·²ç»åœ¨å¹¶è¡ŒåŒ–å¤„ç†ï¼Œè€Œä½ åˆæƒ³å°†å…¶è½¬å›ä¸€ä¸ª â€œå¸¸è§„çš„â€ &lt;code&gt;Flux&lt;/code&gt; å®ä¾‹ï¼Œç„¶åä¸²è¡Œæ‰§è¡Œç®—å­é“¾ä½™ä¸‹çš„éƒ¨åˆ†ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ &lt;code&gt;ParallelFlux&lt;/code&gt; çš„ &lt;code&gt;sequential()&lt;/code&gt; æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ³¨æ„ï¼šå¦‚æœç›´æ¥ä½¿ç”¨ä¸€ä¸ª &lt;code&gt;Subscriber&lt;/code&gt; ç±»å‹å‚æ•°è€Œä¸æ˜¯ lambda è¡¨è¾¾å¼æ¥è°ƒç”¨ &lt;code&gt;subscribe&lt;/code&gt; æ–¹æ³•ï¼Œé‚£ä¹ˆå†…éƒ¨å®ç°ä¼šéšå¼åœ°è°ƒç”¨ &lt;code&gt;sequential()&lt;/code&gt; æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç”±æ­¤ä¹Ÿè¦æ³¨æ„ï¼š&lt;code&gt;subscribe(Subscriber&amp;lt;T&amp;gt;)&lt;/code&gt; ä¼šåˆå¹¶æ‰€æœ‰æ•°æ®â€œè½¨é“â€ï¼Œè€Œ &lt;code&gt;subscribe(Consumer&amp;lt;T&amp;gt;)&lt;/code&gt; æ˜¯è¿è¡Œæ‰€æœ‰çš„æ•°æ®â€œè½¨é“â€ã€‚å¦‚æœä»¥ lambda è¡¨è¾¾å¼è°ƒç”¨ &lt;code&gt;subscribe&lt;/code&gt; æ–¹æ³•ï¼Œé‚£ä¹ˆæ¯ä¸ª lambda è¡¨è¾¾å¼éƒ½ä¼šè¢«å¤åˆ¶æˆå¤šä¸ªå®ä¾‹ï¼ˆæ•°é‡ç­‰äºâ€œè½¨é“â€æ•°é‡ï¼‰å»æ‰§è¡Œ&lt;sup id=&quot;fnref:3&quot;&gt;&lt;a href=&quot;#fn:3&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot; role=&quot;doc-noteref&quot;&gt;[3]&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;&lt;ol&gt;&lt;li id=&quot;fn:1&quot;&gt;&lt;p&gt;è¯‘æ³¨ï¼šè¿™é‡Œçš„â€œè½¨é“â€å…¶å®ä¸å¤ªç›´ç™½ã€‚åœ¨å®ç°ä¸Šï¼Œ&lt;code&gt;ParallelFlux&lt;/code&gt; ä¼šå°†æœ€å &lt;code&gt;subscribe&lt;/code&gt; çš„ onNext å›è°ƒæŒ‰å¹¶è¡Œåº¦ï¼ˆé»˜è®¤ç­‰äº CPU æ ¸æ•° Nï¼‰å¤åˆ¶æˆ N ä¸ªï¼Œé‚£ä¹ˆæœ€ç»ˆè°ƒç”¨ ParallelFlux çš„ N ä¸ª Subscriberï¼Œä» ParallelFlux å®ä¾‹åˆ°ä¸€ä¸ª Subscriber çš„æ•°æ®æµè·¯å¾„å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªâ€œè½¨é“â€ï¼ŒParallelFlux åœ¨æ¥æ”¶åˆ°ä¸Šæ¸¸æ¶ˆæ¯åæŒ‰ç…§ round-robin æ–¹å¼é€‰æ‹©ä¸€ä¸ª Subscriber è°ƒç”¨å…¶ &lt;code&gt;onNext&lt;/code&gt; ä¸‹å‘æ¶ˆæ¯ï¼Œä½† &lt;code&gt;onNext&lt;/code&gt; æ˜¯è¿è¡Œåœ¨ä»€ä¹ˆçº¿ç¨‹ä¸Šï¼Œæ˜¯ç”± runOn ç®—å­å†³å®šçš„ï¼Œå¦‚æœä¸ä½¿ç”¨ runOn ç®—å­ï¼Œé‚£ä¹ˆæ‰€æœ‰ Subscriber çš„ &lt;code&gt;onNext&lt;/code&gt; æ–¹æ³•è°ƒç”¨éƒ½æ˜¯åŒæ­¥è¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸Šçš„ã€‚&lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;â†©&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn:2&quot;&gt;&lt;p&gt;è¯‘æ³¨ï¼šåŸæ–‡ä¸­ç”¨äº†å¤šä¸ªè¯æ¥è¡¨è¾¾ç›¸è¿‘çš„æ„æ€ï¼šsequenceï¼ˆåºåˆ—ï¼‰ã€streamï¼ˆæµï¼‰ã€flowï¼ˆæµï¼‰ï¼Œé˜…è¯»æ—¶å¯ä»¥ç›¸äº’æ›¿ä»£ç†è§£ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ eventï¼ˆäº‹ä»¶ï¼‰ã€dataï¼ˆæ•°æ®ï¼‰ã€messageï¼ˆæ¶ˆæ¯ï¼‰ï¼Œåœ¨å½“å‰ä¸Šä¸‹æ–‡ä¸­ï¼Œå¯ä»¥çœ‹æˆæ˜¯ç­‰ä»·çš„ã€‚&lt;a href=&quot;#fnref:2&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;â†©&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn:3&quot;&gt;&lt;p&gt;è¯‘æ³¨ï¼šè¿™è¯å†™å¾—çœŸè ¢ã€‚è¯¦ç»†è§£é‡Šè§è„šæ³¨ 1ã€‚&lt;a href=&quot;#fnref:3&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;â†©&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/div&gt;</description>
            <pubDate>2019-06-26</pubDate>
            <link>https://blog.xiayf.cn/posts/simplified-reactor-doc-zh.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/simplified-reactor-doc-zh.html</guid>
        </item>
        
        <item>
            <title>Java å•æµ‹ä¼´ä¾£ - mockito</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;å…¶å®å·¥ä½œä»¥æ¥ï¼Œæˆ‘å¾ˆå°‘å†™æµ‹è¯•/å•æµ‹ä»£ç ï¼Œä¸€æ–¹é¢æ˜¯å¤§éƒ¨åˆ†äº’è”ç½‘å…¬å¸å›¢é˜Ÿå¯¹æµ‹è¯•çš„è¦æ±‚ä¸é«˜ï¼Œå¦ä¸€æ–¹é¢æ˜¯æƒ³å†™å¥½æµ‹è¯•ä»£ç è¿˜æŒºéš¾çš„ï¼ŒæŒºèŠ±æ—¶é—´ï¼Œå…¶ä¸­æœ€éº»çƒ¦çš„æ˜¯å¾…æµ‹ä»£ç å¯èƒ½ä¼šè®¿é—®å¤–éƒ¨èµ„æºï¼ˆæ¯”å¦‚æ•°æ®åº“ã€HTTP APIï¼‰ï¼Œå¦‚æœä¸èƒ½æ–¹ä¾¿åœ°è¿›æ¨¡æ‹Ÿè®¿é—®è¿™äº›å¤–éƒ¨èµ„æºï¼Œé‚£ä¹ˆæµ‹è¯•èµ·æ¥ä¼šéå¸¸éº»çƒ¦ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½†ï¼Œå¯¹äºå¤æ‚é€»è¾‘ï¼Œå¦‚æœä¸ç»è¿‡ä¸¥æ ¼æµ‹è¯•ï¼Œå‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒï¼Œåˆæœ‰äº›ä¸æ”¾å¿ƒï¼Œæ²¡åº•æ°”ï¼Œæˆ–è€…åœ¨ä»£ç é‡æ„æ—¶ï¼Œå¦‚æœæ²¡æœ‰è¦†ç›–å…¨é¢çš„æµ‹è¯•ï¼Œå¾ˆéš¾è¯„ä¼°ä»£ç å˜åŠ¨å¸¦æ¥çš„å½±å“ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç›´åˆ°é‡åˆ° &lt;a href=&apos;https://site.mockito.org/&apos;&gt;mockito&lt;/a&gt;ï¼Œæˆ‘æ‰è§‰å¾—æ˜¯æ—¶å€™è®¤çœŸå†™å†™æµ‹è¯•ä»£ç äº†ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;a href=&apos;https://site.mockito.org/&apos;&gt;mockito&lt;/a&gt; æä¾›ä¸¤ç§å¯¹è±¡æ¨¡æ‹Ÿæ–¹å¼ï¼š&lt;strong&gt;mock&lt;/strong&gt; å’Œ &lt;strong&gt;spy&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç®€å•æ¥è¯´ï¼Œmock æ¨¡æ‹Ÿçš„å¯¹è±¡æ˜¯ä¸€ä¸ªå®Œå…¨å‡çš„å¯¹è±¡ï¼Œåªæ˜¯å…·å¤‡æŒ‡å®šç±»å‹çš„æ¥å£ï¼Œä»¥ &lt;code&gt;java.util.List&lt;/code&gt; ä¸ºä¾‹ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;import static org.mockito.Mockito.mock;

List mockedList = mock(List.class);&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è™½ç„¶ List æ˜¯ä¸€ä¸ª interfaceï¼Œä¹Ÿå¯ä»¥æ¨¡æ‹Ÿå‡ºä¸€ä¸ªå¯¹è±¡å®ä¾‹ï¼Œè¿™ä¸ª mockedList å¯¹è±¡å…·å¤‡ List æ¥å£å®šä¹‰çš„æ‰€æœ‰æ–¹æ³•ï¼Œä½†æ‰€æœ‰æ–¹æ³•éƒ½ä¸å…·å¤‡å®é™…çš„è¡Œä¸ºæ“ä½œï¼Œå¯¹äºæœ‰è¿”å›å€¼çš„æ–¹æ³•ï¼Œåˆ™é»˜è®¤è¿”å›æ–¹æ³•è¿”å›ç±»å‹çš„é»˜è®¤å€¼ï¼Œæ²¡æœ‰è¿”å›å€¼çš„æ–¹æ³•ï¼Œåˆ™çº¯ç²¹æ˜¯ä¸€ä¸ªç©ºæ–¹æ³•ã€‚æ¯”å¦‚ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;// mockedList å¹¶ä¸ä¼šçœŸçš„æŠŠ 1 å­˜ä¸‹æ¥
mockedList.add(1);
// æ‰€ä»¥ï¼Œsize() è¿”å›é»˜è®¤å€¼ï¼Œè¾“å‡º 0
System.out.println(mockedList.size());
// è¾“å‡º null
System.out.println(mockedList.get(0));
// è¾“å‡º null
System.out.println(mockedList.get(1));&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äºæ¨¡æ‹Ÿå‡ºæ¥çš„å¯¹è±¡ï¼Œå¯ä»¥ä»»æ„æŒ‡å®šå…¶æ–¹æ³•çš„è¿”å›å€¼ï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;import static org.mockito.Mockito.when;

// è°ƒç”¨ size() æ–¹æ³•æ—¶ï¼Œè¿”å› 10
when(mockedList.size()).willReturn(10);
when(mockedList.get(0)).willReturn(&amp;amp;quot;Hello World!&amp;amp;quot;);
when(mockedList.get(1)).thenReturn(&amp;amp;quot;æ‚¨å¥½ï¼&amp;amp;quot;);

// è¾“å‡º 10
System.out.println(mockedList.size());
// è¾“å‡º Hello World!
System.out.println(mockedList.get(0));
// è¾“å‡º æ‚¨å¥½ï¼
System.out.println(mockedList.get(1));&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å½“ç„¶æˆ‘ä»¬å†™æµ‹è¯•ä»£ç æ—¶ï¼Œå¹¶ä¸ä¼šä½¿ç”¨ System.out.printlnï¼Œç„¶åçœ‹è¾“å‡ºï¼Œè€Œæ˜¯ä½¿ç”¨&lt;strong&gt;æ–­è¨€&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;import static org.junit.Assert.assertEquals;

assertEquals(10, mockedList.size());
assertEquals(&amp;amp;quot;Hello World!&amp;amp;quot;, mockedList.get(0));
assertEquals(&amp;amp;quot;æ‚¨å¥½ï¼&amp;amp;quot;, mockedList.get(1));&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ–­è¨€æ–¹æ³•éå¸¸å¤šï¼Œä¸ä»…ä»…åªæ˜¯ assertEqualsã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äºåŒä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥æ¨¡æ‹Ÿå¤šæ¬¡è°ƒç”¨è¿”å›ä¸åŒçš„å€¼ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;// ä¼šè¦†ç›–ä¹‹å‰ mock çš„è¡Œä¸ºï¼šwhen(mockedList.size()).willReturn(10);
// æˆ–è€…è¿™ä¹ˆå†™ï¼šwhen(mockedList.size()).willReturn(0, -1, 10);
when(mockedList.size()).thenReturn(0).thenReturn(-1).thenReturn(10);
assertEquals(0, mockedList.size());
assertEquals(-1, mockedList.size());
assertEquals(10, mockedList.size());
// ç¬¬ 3 æ¬¡ä¹‹åçš„ mockedList.size() è°ƒç”¨éƒ½è¿”å› 10
assertEquals(10, mockedList.size());

Iterator iterator = mock(Iterator.class);
// æˆ–è€…è¿™ä¹ˆå†™ï¼šwhen(iterator.next()).thenReturn(0, 1, 10, 1000);
when(iterator.next()).thenReturn(0).thenReturn(1).thenReturn(10).thenReturn(1000);
assertEquals(0, iterator.next());
assertEquals(1, iterator.next());
assertEquals(10, iterator.next());
assertEquals(1000, iterator.next());
// ç¬¬ 4 æ¬¡ä¹‹åçš„ iterator.next() è°ƒç”¨éƒ½è¿”å› 1000
assertEquals(1000, iterator.next());&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿˜å¯ä»¥æ¨¡æ‹Ÿå¼‚å¸¸æŠ›å‡ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;List mockedList = mock(List.class);

when(mockedList.get(-1000)).thenThrow(new RuntimeException(&amp;amp;quot;å‚æ•°å¼‚å¸¸ï¼&amp;amp;quot;));
try {
    mockedList.get(-1000);
} catch (Exception e) {
    assertTrue(e instanceof RuntimeException);
    assertEquals(&amp;amp;quot;å‚æ•°å¼‚å¸¸ï¼&amp;amp;quot;, e.getMessage());
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¹Ÿå¯ä»¥åŸºäºå¤æ‚çš„é€»è¾‘æ¥æ„é€ è¿”å›å€¼ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;import org.mockito.invocation.InvocationOnMock;
import org.mockito.stubbing.Answer;

List&amp;amp;lt;Integer&amp;amp;gt; mockedList = mock(List.class);
when(mockedList.get(anyInt())).thenAnswer(new EchoAnswer());

assertTrue(1 == mockedList.get(1));
assertTrue(10 == mockedList.get(10));

public class EchoAnswer implements Answer&amp;amp;lt;Integer&amp;amp;gt; {

    public Integer answer(InvocationOnMock var) {
        return var.getArgument(0);
    }
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é™¤äº† &lt;code&gt;when(...).thenReturn(...)&lt;/code&gt; é£æ ¼çš„æµ‹è¯•æ¨¡æ‹Ÿæ–¹å¼ï¼Œè¿˜æœ‰ BDDï¼ˆBehavior Driven Development è¡Œä¸ºé©±åŠ¨å¼€å‘ï¼‰é£æ ¼çš„ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;import static org.mockito.BDDMockito.given;

// given
given(mockedList.get(0)).willReturn(100);
// when
int v = (int) mockedList.get(0);
// then
assertEquals(100, v);&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœæ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼Œæˆ–è€…å…¶å®ƒå¥‡è‘©çš„éœ€æ±‚ï¼Œåˆ™æ²¡æ³•ä½¿ç”¨ when.thenReturn / willReturn è¿™æ ·çš„æ¨¡æ‹Ÿæ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code&gt;doReturn(...).when(...)...&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;import static org.mockito.Mockito.doThrow;
import static org.mockito.Mockito.doReturn;

ArrayList mockedList = mock(ArrayList.class);
// clear æ–¹æ³•æ— è¿”å›å€¼
doThrow(new RuntimeException(&amp;amp;quot;æ¸…é™¤å¤±è´¥&amp;amp;quot;)).when(mockedList).clear();

try {
    mockedList.clear();
} catch (Exception e) {
    assertTrue(e instanceof RuntimeException);
    assertEquals(&amp;amp;quot;æ¸…é™¤å¤±è´¥&amp;amp;quot;, e.getMessage());
}

// æ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºæ²¡æ³•ä½¿ç”¨ æ–­è¨€ æ¥éªŒè¯ï¼Œå®é™…è¿è¡Œæ—¶ä¼šæŠ›å¼‚å¸¸
doReturn(10).when(mockedList).clear();&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä»ç¤ºä¾‹ä»£ç å¯ä»¥çœ‹å‡ºï¼Œ&lt;code&gt;doReturn(...).when(...)....&lt;/code&gt; ä¸ä¼šåšç±»å‹æ ¡éªŒï¼ŒmockedList.clear() è¿”å›å€¼ç±»å‹ä¸º voidï¼Œä½†æˆ‘ä»¬æ¨¡æ‹Ÿè®©å…¶è¿”å› 10ï¼›æ‰€ä»¥ï¼Œæ­£å¸¸æƒ…å†µåº”è¯¥å°½å¯èƒ½ä½¿ç”¨ &lt;code&gt;when(...).thenReturn(...)&lt;/code&gt; æˆ– &lt;code&gt;given(...).willReturn(...)&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å‰è¿°ä»£ç ç¤ºä¾‹ä¸­ï¼Œæ¨¡æ‹Ÿæ–¹æ³•çš„å‚æ•°éƒ½åšäº†ç¡¬ç¼–ç ï¼Œå®é™…æƒ…å†µé€šå¸¸éƒ½ä¸æ˜¯è¿™ä¹ˆæµ‹è¯•ï¼Œè€Œæ˜¯æ¨¡æ‹Ÿæ–¹æ³•çš„å‚æ•°ç¬¦åˆä¸€å®šçš„è¦æ±‚å³å¯ï¼Œæ¯”å¦‚ï¼šåœ¨æŸä¸ªèŒƒå›´ä¹‹å†…ã€ç¬¦åˆç±»å‹çš„ä»»ä½•å€¼ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;import static org.mockito.Mockito.anyInt;

/*
ä»¥ä»»ä½• int ç±»å‹çš„å‚æ•°è°ƒç”¨ mockedList.get æ–¹æ³•ï¼Œéƒ½è¿”å› 100

å¦‚æœå†™æˆ when(mockedList.get(0)).thenReturn(100)ï¼Œåˆ™åªæœ‰ä»¥ 0 ä¸ºå‚æ•°è°ƒç”¨ mockedList.get æ–¹æ³•ï¼Œæ‰ä¼šè¿”å›100ï¼Œå…¶ä»–å‚æ•°å€¼ï¼Œè¿”å›çš„éƒ½æ˜¯é»˜è®¤å€¼ 0
*/
when(mockedList.get(anyInt())).thenReturn(100);

assertEquals(100, mockedList.get(0));
assertEquals(100, mockedList.get(1000));&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯ç”¨çš„å‚æ•°åŒ¹é…å™¨ï¼Œè§ org.mockito.ArgumentMatchers ç±»çš„é™æ€æ–¹æ³•åˆ—è¡¨ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å®ç° ArgumentMatcher æ¥å£ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;package org.mockito;

public interface ArgumentMatcher&amp;amp;lt;T&amp;amp;gt; {
    boolean matches(T var1);
}&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;import org.mockito.ArgumentMatcher;
import static org.mockito.Mockito.intThat;

when(mockedList.get(intThat(new LimitedInt()))).thenReturn(10);

assertEquals(null, mockedList.get(-1));
assertEquals(10, mockedList.get(1));
assertEquals(10, mockedList.get(99));
assertEquals(null, mockedList.get(100));

public class LimitedInt implements ArgumentMatcher&amp;amp;lt;Integer&amp;amp;gt; {

    public boolean matches(Integer var) {
        return var &amp;amp;gt; 0 &amp;amp;amp;&amp;amp;amp; var &amp;amp;lt; 100;
    }
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœè¢«æ¨¡æ‹Ÿçš„æ–¹æ³•åŒ…å«å¤šä¸ªå‚æ•°ï¼Œé‚£ä¹ˆè¿™äº›å‚æ•°è¦ä¹ˆå…¨éƒ¨ä½¿ç”¨åŒ¹é…å™¨ï¼Œè¦ä¹ˆå…¨éƒ¨ä¸ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ¨¡æ‹ŸæŸäº›ç±»ï¼ˆAï¼‰çš„æ–¹æ³•ï¼Œé€šå¸¸ä¼šå°† mock å‡ºæ¥çš„å¯¹è±¡æ³¨å…¥åˆ°ä¾èµ–è¯¥ç±»å®ä¾‹çš„å…¶ä»–ç±»ï¼ˆBï¼‰ä¸­ï¼Œæ¥æ›¿ä»£çœŸå®çš„ä¾èµ–ï¼Œè¿™ç§æ–¹å¼çš„ç›®çš„æ˜¯ä¸ºäº†æµ‹è¯•ç±» B çš„è¡Œä¸ºæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦ä¸€ä¸ªæµ‹è¯•éœ€æ±‚æ˜¯ï¼Œæµ‹è¯•æŸä¸ªç±» A&apos; åœ¨æŸä¸ªä¸Šä¸‹æ–‡ç¯å¢ƒä¸­çš„è¡Œä¸ºæ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œæ¯”å¦‚ï¼š A&apos; çš„æŸä¸ªæ–¹æ³•æ˜¯å¦è¢«è°ƒç”¨è¿‡ã€è°ƒç”¨è¿‡å‡ æ¬¡ã€è°ƒç”¨å‚æ•°æ˜¯å¦ç¬¦åˆé¢„æœŸã€å‡ ä¸ªæ–¹æ³•ä¹‹é—´çš„è°ƒç”¨æ¬¡åºæ˜¯å¦ç¬¦åˆé¢„æœŸã€æ–¹æ³•è°ƒç”¨è€—æ—¶æ˜¯å¦ç¬¦åˆé¢„æœŸç­‰ç­‰ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;import static org.mockito.Mockito.verify;
import static org.mockito.Mockito.times;
import static org.mockito.Mockito.never;
import static org.mockito.Mockito.verifyZeroInteractions;

List mocked = mock(List.class);

Caller caller = new Caller();
caller.setList(mocked);

// è°ƒç”¨ 0 æ¬¡
caller.run(0);
// éªŒè¯æ˜¯å¦ä»æ¥æ²¡è°ƒç”¨è¿‡ mocked.size()
verify(mocked, never()).size();
// éªŒè¯ æ²¡æœ‰å’Œ mocked äº§ç”Ÿè¿‡ä»»ä½•äº¤äº’
// å› ä¸º Caller.run ä¸­è°ƒç”¨äº† list.isEmpty()ï¼Œå®é™…äº§ç”Ÿäº†äº¤äº’ï¼Œæ‰€ä»¥è¿™è¡Œæµ‹è¯•ä¼šå¤±è´¥
verifyZeroInteractions(mocked);

// è°ƒç”¨ 10 æ¬¡
caller.run(10);
// éªŒè¯æ˜¯å¦è°ƒç”¨ mocked.size() 10 æ¬¡
verify(mocked, times(10)).size();

// å†è°ƒç”¨ä¸€æ¬¡
caller.run(1);
// æ‰€ä»¥æ˜¯ 11 æ¬¡äº†
verify(mocked, times(11)).size();

@Data
public class Caller {
    List list;

    public void run(int count) {
        for (int idx=0; idx &amp;amp;lt; count; idx++) {
            list.size();
        }
        //
        list.isEmpty();
    }
}&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;List mocked = mock(List.class);

mocked.add(1);
mocked.add(2);

verify(mocked).add(1);

// æ˜¯å¦æœ‰å…¶ä»–äº¤äº’æ²¡æœ‰éªŒè¯è¿‡ï¼Ÿå› ä¸º mocked è¿˜è°ƒç”¨è¿‡ mocked.add(2)ï¼Œæ‰€ä»¥è¿™å¥æµ‹è¯•ä¼šå¤±è´¥
verifyNoMoreInteractions(mocked);&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;import org.mockito.InOrder;

// ä¹Ÿå¯ä»¥éªŒè¯è°ƒç”¨æ¬¡åº
List mocked1 = mock(List.class);
List mocked2 = mock(List.class);

mocked1.size();
mocked1.isEmpty();
mocked2.isEmpty();

// ä¼šè®°å½• mocked1ã€mocked2 ä¸­æ–¹æ³•çš„è°ƒç”¨/äº¤äº’æ¬¡åºï¼Œè¦æ±‚ï¼šä¸ mocked1 çš„äº¤äº’å…ˆäº mocked2
InOrder inOrder = inOrder(mocked1, mocked2);
// mocked1ã€mocked2 çš„äº¤äº’é¡ºåºå¿…é¡»å’Œ inOrder.verify ä¹‹é—´çš„é¡ºåºä¸€è‡´
inOrder.verify(mocked1).size();
inOrder.verify(mocked1).isEmpty();
inOrder.verify(mocked2).isEmpty();&lt;/code&gt;&lt;/pre&gt;
&lt;hr&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¹Ÿå¯ä»¥éªŒè¯æŸä¸ªæ–¹æ³•è¢«è°ƒç”¨æ—¶æ‰€ä½¿ç”¨çš„å‚æ•°æ˜¯å¦ç¬¦åˆé¢„æœŸï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;import org.mockito.ArgumentCaptor;

List mockedlist = mock(List.class);

Caller caller = new Caller();
caller.setList(mockedlist);
caller.run();

// æ•è· mockedList.add çš„è°ƒç”¨å‚æ•°
ArgumentCaptor&amp;amp;lt;Integer&amp;amp;gt; argumentCaptor = ArgumentCaptor.forClass(Integer.class);
verify(mockedlist).add(argumentCaptor.capture());
assertTrue(100 == argumentCaptor.getValue());

@Data
public class Caller {
    List list;

    public void run() {
        list.add(100);
    }
}&lt;/code&gt;&lt;/pre&gt;
&lt;hr&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å‰é¢çš„å†…å®¹éƒ½æ˜¯ä»¥ mock ä¸ºä¾‹ï¼Œæˆ‘ä»¬å†æ¥è¯´è¯´ spyï¼Œä¸ mock çš„åŒºåˆ«ï¼š&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;mock å‡ºæ¥çš„å¯¹è±¡æ˜¯ä¸€ä¸ªå®Œå…¨å‡çš„å¯¹è±¡ï¼Œä½† spy é€šå¸¸æ˜¯åŸºäºä¸€ä¸ªå…·ä½“çš„ç±»æˆ–ç±»å®ä¾‹ï¼Œå¯¹å…¶ç¯¡æ”¹æŸäº›æ–¹æ³•ï¼Œå¯¹äºè¢«ç¯¡æ”¹æ–¹æ³•ä¹‹å¤–çš„æ–¹æ³•ï¼Œå…¶è¡Œä¸ºéƒ½å’Œè°ƒç”¨çœŸå®å¯¹è±¡çš„æ–¹æ³•ä¸€æ ·ï¼Œä¸è¿‡å¹¶æ²¡æœ‰è°ƒç”¨çœŸå®å¯¹è±¡çš„æ–¹æ³•ï¼Œä¹Ÿä¸ä¼šå¯¹çœŸå®å¯¹è±¡äº§ç”Ÿå½±å“ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;// åŸºäºä¸€ä¸ªå®é™…çš„ç±»å®ä¾‹
List&amp;amp;lt;Integer&amp;amp;gt; realList = new ArrayList&amp;amp;lt;&amp;amp;gt;(10);
List&amp;amp;lt;Integer&amp;amp;gt; spy = spy(realList);
        
spy.add(1);

// è¢«çªƒå¬çš„å¯¹è±¡å¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–
assertEquals(0, realList.size());
// é—´è°å¯¹è±¡ç¡®å®å°† 1 å­˜äº†ä¸‹æ¥
assertEquals(1, spy.size());
// è¿™å¥ä¼šæŠ›å‡º java.lang.IndexOutOfBoundsExceptionï¼Œå› ä¸º realList è¿˜æ˜¯ä¸ºç©º
assertTrue(1 == realList.get(0));
assertTrue(1 == spy.get(0));&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¹Ÿå¯ä»¥åŸºäºä¸€ä¸ªå…·ä½“çš„ç±»æ¥æ„é€  spyï¼Œä½†è¿™æ ·æ— æ³•ä½¿ç”¨å¸¦å‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œä¹Ÿæ— æ³•æŒ‡å®šç±»å‹å‚æ•°ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;List&amp;amp;lt;Integer&amp;amp;gt; = spy(ArrayList.class);
assertEquals(0, spy.size());
spy.add(100);
assertEquals(1, spy.size());
assertTrue(100 == spy.get(0));

// ç¯¡æ”¹æ–¹æ³•
when(spy.size()).thenReturn(-1);
assertEquals(-1, spy.size());&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å®é™…ä¸Šï¼Œmock ä¹Ÿå¯ä»¥åŸºäºå…·ä½“çš„ç±»æ¥æ„é€ ï¼Œè¿™æ—¶å¯ä»¥æŒ‡å®šæŸäº›æ–¹æ³•å®é™…è°ƒç”¨å…·ä½“ç±»çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é™¤äº†ä½¿ç”¨ mockã€spy æ–¹æ³•æ¥æ„é€ æ¨¡æ‹Ÿå¯¹è±¡ï¼Œè¿˜å¯ä»¥é€šè¿‡æ³¨è§£æ¥æ„é€ ï¼Œä½†è¿™æ ·çš„è¯å¾—æŒ‡å®š JUnit çš„ Runner ä¸º &lt;code&gt;org.mockito.junit.MockitoJUnitRunner&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;import org.junit.Test;
import org.junit.runner.RunWith;
import org.mockito.Mock;
import org.mockito.Spy;
import org.mockito.junit.MockitoJUnitRunner;

import java.util.ArrayList;
import java.util.List;

import static org.mockito.Mockito.when;
import static org.junit.Assert.assertTrue;

@RunWith(MockitoJUnitRunner.class)
public class testTester {

    @Mock
    private List&amp;amp;lt;Integer&amp;amp;gt; mocked;

    @Spy
    private ArrayList&amp;amp;lt;Integer&amp;amp;gt; spyed;

    @Test
    public void test() {
        when(mocked.isEmpty()).thenReturn(false);
        when(spyed.isEmpty()).thenReturn(false);

        assertTrue(!mocked.isEmpty());
        assertTrue(!spyed.isEmpty());

        mocked.add(0);
        spyed.add(0);

        assertTrue(0 == mocked.size());
        assertTrue(1 == spyed.size());
    }
}&lt;/code&gt;&lt;/pre&gt;</description>
            <pubDate>2019-06-17</pubDate>
            <link>https://blog.xiayf.cn/posts/mockito.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/mockito.html</guid>
        </item>
        
        <item>
            <title>ã€ŠPython ç¼–ç¨‹ä¹‹ç¾ã€‹è¯‘è€…åº</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;ä»æ¯•ä¸šè‡³ä»Šï¼Œåœ¨äº’è”ç½‘è¡Œä¸šä»äº‹è½¯ä»¶ç ”å‘å·¥ä½œï¼Œå°†è¿‘äº”å¹´ã€‚è¿™äº”å¹´é—´ï¼Œåšè¿‡åç«¯å¼€å‘ã€å‰ç«¯å¼€å‘ã€å¤§æ•°æ®å¤„ç†ç­‰ï¼Œä½¿ç”¨è¿‡çš„ç¼–ç¨‹è¯­è¨€åŒ…æ‹¬ï¼šPythonã€PHPã€Goã€Javaã€JavaScript ç­‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è™½è¯´ç¼–ç¨‹è¯­è¨€å„å¼‚ï¼Œä½†æˆ‘ä½¿ç”¨å®ƒä»¬æ¥å†™å„ç§é¡¹ç›®çš„ä»£ç å´ä¸€ç›´åšæŒä¸¤ç‚¹ï¼šä»£ç å¯è¯»æ€§å’Œè‡ªè§£é‡Šæ€§/è‡ªæ–‡æ¡£æ€§ï¼ˆself-documentationï¼‰ã€‚è¿™å¾ˆå¤§ç¨‹åº¦ä¸Šåº”è¯¥æ˜¯å—åˆ° Python è¯­è¨€è®¾è®¡å“²å­¦çš„å½±å“ - è¿½æ±‚ç®€å•æ˜“è¯»æ˜“æ‡‚çš„ä»£ç ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¾ˆå¤šäººå¯èƒ½ä¼šè®¤ä¸ºè¿™ä¸¤ç‚¹å…¶å®æ˜¯ä¸€ç‚¹ - ä»£ç å¯è¯»æ€§ï¼Œä½†æˆ‘æƒ³åšç‚¹åŒºåˆ†ï¼šä»£ç å¯è¯»æ€§çªå‡ºå¯¹ä»£ç é˜…è¯»è€…è§†è§‰ä¸Šçš„å½±å“ï¼Œæ˜¯å¦å­˜åœ¨ä¸å¿…è¦çš„ç†è§£å¹²æ‰°ï¼Œæ¯”å¦‚ï¼šå¿…è¦çš„ç©ºè¡Œã€å˜é‡å®šä¹‰ä¸ä½¿ç”¨ä¹‹é—´çš„è·ç¦»ã€å‡½æ•°ä½“/é€»è¾‘åˆ†æ”¯æ˜¯å¦è¿‡é•¿ã€é€»è¾‘è¡¨è¾¾æ˜¯å¦ç›´è§‚ç­‰ç­‰ã€‚å¯è¯»æ€§é«˜çš„ä»£ç é€šå¸¸éƒ½éå¸¸æ¼‚äº®ã€èµå¿ƒæ‚¦ç›®ã€‚è‡ªè§£é‡Šæ€§ä»£ç åˆ™æ›´çªå‡ºè¯­ä¹‰å±‚é¢ï¼Œæ¯”å¦‚ï¼šå˜é‡åç§°/å‡½æ•°åç§°/ç±»åæ˜¯å¦æ°å½“ã€å‡½æ•°/æ–¹æ³•/API æ˜¯å¦å•ä¸€èŒè´£ã€å·¥ç¨‹ç›®å½•ç»“æ„/åŒ…/æ¨¡å—æ‹†åˆ†æ˜¯å¦ç¬¦åˆâ€œé«˜å†…èšä½è€¦åˆâ€åŸåˆ™ç­‰ç­‰ã€‚é•¿æœŸè¿½æ±‚è¿™ä¸¤ç‚¹ï¼Œå¯ä»¥æå¤§åœ°æå‡ä¸ªäººï¼Œç‰¹åˆ«æ˜¯å›¢é˜Ÿçš„å·¥ä½œæ•ˆç‡å’Œå·¥ä½œè´¨é‡ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ¬ä¹¦ä½œè€… Kenneth Reitz äº 2011 å¹´å‘å¸ƒ Requests è¿™ä¸ª HTTP è¯·æ±‚å·¥å…·åº“ï¼Œæå‡ºâ€œfor humansâ€çš„ç†å¿µï¼Œå¼ºè°ƒè½¯ä»¶/å·¥å…·åº“åº”è¯¥å¯¹äººç±»å‹å¥½æ˜“ç”¨ï¼Œè¿™ä¸€ç†å¿µæœ¬è´¨ä¸Šæ˜¯å¯¹ Python å“²å­¦ï¼ˆç‰¹åˆ«æ˜¯ä¸Šè¿°ä¸¤ç‚¹ï¼‰çš„ä¸€ç§å¼•ç”³å’Œå‘æ‰¬ã€‚ä¹‹å Reitz åœ¨ä¸€äº› Pythonå¤§ä¼šä¸ŠåšæŠ€æœ¯åˆ†äº«ï¼Œå®£æ‰¬â€œfor humansâ€ç†å¿µï¼Œå¯¹ Python ç¤¾åŒºäº§ç”Ÿå·¨å¤§å½±å“ã€‚æˆ‘åœ¨ç¬¬ä¸€æ¬¡ç”¨è¿‡ Requests åº“ä¹‹åï¼Œä¾¿å¾ˆå°‘ä½¿ç”¨ Python æ ‡å‡†åº“ä¸­çš„ urllib å’Œ urllib2ï¼Œç°åœ¨æ ‡å‡†åº“æ–‡æ¡£ä¸­ä¹Ÿç‰¹åˆ«å»ºè®®å¼€å‘è€…ä½¿ç”¨ Requestsã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å› ä¸ºå¯¹â€œfor humansâ€ç†å¿µçš„è®¤åŒï¼Œä¹Ÿå› ä¸ºç»å¸¸ä½¿ç”¨ Requestsï¼Œæ‰€ä»¥å½“ Reitz åœ¨ Github ä¸Šé‚€è¯·æˆ‘ç¿»è¯‘ Requests æ–‡æ¡£ä¸­æ–‡ç‰ˆæ—¶ï¼Œæˆ‘æ¬£ç„¶æ¥å—ï¼Œå’Œå¦ä¸€ä¸ª Python å¼€å‘è€…å…±åŒç¿»è¯‘äº† Requests æ–‡æ¡£çš„é¦–ä¸ªå®˜æ–¹ä¸­æ–‡ç¿»è¯‘ç‰ˆã€‚è¿™â€œå¦ä¸€ä¸ª Python å¼€å‘è€…â€ä¹Ÿå°±æ˜¯æœ¬ä¹¦çš„å¦ä¸€ä¸ªè¯‘è€…ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨ Reitz å‘èµ· â€œThe Hitchhiker&apos;s Guide to Python!â€ é¡¹ç›®ï¼ˆä¹Ÿå°±æ˜¯æœ¬ä¹¦çš„ç¤¾åŒºå¼€æºç‰ˆï¼‰åï¼Œæˆ‘ä¸€ç›´æŒç»­è·Ÿè¿›é˜…è¯»ï¼Œæ”¶è·å·¨å¤§ã€‚åæ¥å¾—çŸ¥è¿™æœ¬å¼€æºä¹¦ç±æ­£å¼å‡ºç‰ˆï¼Œæ¬£å–œè‹¥ç‹‚ï¼Œè¾—è½¬å’¨è¯¢å¤šäººï¼Œè”ç³»åˆ°åˆ˜çšè€å¸ˆ ï¼Œç”³è¯·äº†æœ¬ä¹¦çš„ç¿»è¯‘å·¥ä½œã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½†æ˜¯ï¼Œåæ¥å‘ç°ç¿»è¯‘çš„å·¥ä½œé‡è¿œè¿œè¶…å‡ºé¢„ä¼°ï¼Œé™¤äº†ä¸ªäººçš„ä¸€äº›ä¸»è§‚åŸå› ï¼Œä¸»è¦å› ä¸ºæœ¬ä¹¦å†…å®¹çš„å¹¿åº¦å’Œæ·±åº¦ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å¹¿åº¦ï¼šæœ¬ä¹¦ç”± Python ç¤¾åŒºæ•°ç™¾äººå…±åŒåˆ›ä½œè€Œæˆï¼Œå¯ä»¥è§†ä½œ Python å°ç™¾ç§‘å…¨ä¹¦ã€‚1-3ç« æŒ‡å¯¼è¯»è€…æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚é€‰æ‹©å®‰è£…é…ç½® Python ç‰ˆæœ¬/å‘è¡Œç‰ˆã€å¼€å‘ç¯å¢ƒç­‰ã€‚7-11ç« åˆ™é’ˆå¯¹ä¸åŒçš„åº”ç”¨åœºæ™¯ï¼Œä»å¤šä¸ªç»´åº¦ç”„é€‰å¯¹æ¯”äº†å¤§é‡çš„ Python åº“ï¼Œè¯»è€…å¯ä»¥â€œæŒ‰å›¾ç´¢éª¥â€åœ°åšå‡ºè‡ªå·±çš„é€‰æ‹©ï¼Œä»è€ŒèŠ‚çº¦å¤§é‡çš„æ—¶é—´ç²¾åŠ›ã€‚å› ä¸ºè¯‘è€…çš„ Python å¼€å‘ç»éªŒä¸»è¦é›†ä¸­åœ¨ Web å¼€å‘å’Œæ•°æ®å¤„ç†ï¼Œå¯¹äºå¾ˆå¤šåº”ç”¨åœºæ™¯ä¸‹çš„ Python åº“ä¸å¤ªç†Ÿæ‚‰ï¼Œæ‰€ä»¥ç¿»è¯‘ä¹‹å‰èŠ±è´¹äº†å¤§é‡æ—¶é—´æ¥å­¦ä¹ ç†è§£ã€‚&lt;/li&gt;
&lt;li&gt;æ·±åº¦ï¼šé’ˆå¯¹ Python ä¸­æ‰‹çš„æ ¸å¿ƒéœ€æ±‚ï¼Œæœ¬ä¹¦æ¢è®¨äº†å¤§é‡çš„æœ€ä½³å®è·µã€‚å…¶ä¸­4-5ç« é€šè¿‡å¤§é‡ç¤ºä¾‹å…·ä½“åœ°é˜é‡Šäº†â€œPython ä¹‹ç¦…â€çš„å¥å¥ç®´è¨€ï¼Œå¦‚ä½•ç¼–å†™é«˜è´¨é‡çš„ Python ä»£ç ï¼Œå¹¶ç²¾é€‰è‹¥å¹²é«˜è´¨é‡çš„çŸ¥å Python å¼€æºé¡¹ç›®ï¼Œè¯¦ç»†ä»‹ç»å¦‚ä½•é€šè¿‡é˜…è¯»æºç æ¥æå‡ç¼–ç¨‹æŠ€æœ¯æ°´å¹³ã€‚è™½è¯´ Python ç¤¾åŒºå‡ ä¹äººäººçš†çŸ¥â€œPython ä¹‹ç¦…â€ï¼Œä½†å¦‚ä½•è½åœ°åˆ°å¼€å‘å®è·µä¼°è®¡æå°‘æœ‰äººè¯´å¾—æ¸…æ¥šã€‚å¯¹ç…§ä¹¦ä¸­çš„å®ä¾‹é˜é‡Šï¼Œè¯‘è€…å‡ ç»è°ƒæ•´æ¨æ•²â€œPython ä¹‹ç¦…â€çš„è¯‘æ–‡ï¼Œæœ€ç»ˆæ•²å®šçš„è¯‘æ–‡ä¹Ÿä¸æ˜¯ç‰¹åˆ«ä»¤è‡ªå·±æ»¡æ„ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç›¸æ¯”åŸè®¡åˆ’ï¼Œæœ¬ä¹¦æœ€ç»ˆå»¶æœŸè¿‘ä¸€å¹´æ‰å¾—ä»¥ç¿»è¯‘å®Œæˆã€‚é™¤äº†æ­‰æ„ï¼Œæˆ‘å†…å¿ƒæ»¡æ˜¯æ„Ÿè°¢ï¼šæ„Ÿè°¢é‚¦æ°ä¸­é€”å‹æƒ…åŠ å…¥ï¼Œå¸®å¿™ç¿»è¯‘äº†4-6ç« åˆç¨¿ï¼Œè¿™ä¸‰ç« çš„éš¾åº¦å’Œé•¿åº¦éƒ½éå¸¸å¤§ï¼›æ„Ÿè°¢ç¼–è¾‘è€å¸ˆåˆ˜çšå¯¹æˆ‘æ‹–ç¨¿çš„æ¬¡æ¬¡å®¹å¿å’Œè€å¿ƒç­‰å¾…ï¼›æ„Ÿè°¢å¦»å„¿çš„ç†è§£ï¼Œæˆ‘å¯¹ä½ ä»¬ç¼ºå°‘äº†å¤ªå¤šçš„é™ªä¼´ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è™½è¯´æˆ‘å·²å°½è‡ªå·±æ‰€èƒ½åœ°ä¿è¯è¯‘æ–‡è´¨é‡ï¼Œä½†é”™è¯¯ç‘•ç–µéš¾å…ï¼Œåœ¨æ­¤ä¹Ÿè¯·è¯»è€…åŸè°…ã€‚å¸Œæœ›ä½ ä»¬é˜…è¯»æ„‰å¿«ï¼&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è‡³æ­¤ï¼Œæˆ‘å¦‚é‡Šé‡è´Ÿã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-right&quot;&gt;&lt;em&gt;å¤æ°¸é”‹&lt;/em&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-right&quot;&gt;&lt;em&gt;å†™äºä¸Šæµ·&lt;/em&gt;&lt;/p&gt;</description>
            <pubDate>2018-04-01</pubDate>
            <link>https://blog.xiayf.cn/posts/the-python-guide.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/the-python-guide.html</guid>
        </item>
        
        <item>
            <title>ã€Šç²¾é€šPythonè®¾è®¡æ¨¡å¼ã€‹è¯‘è€…åº</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨æˆ‘è¯»å¤§å­¦é‚£å‡ å¹´ï¼Œè®¾è®¡æ¨¡å¼å¯è°“ç«æä¸€æ—¶ï¼Œå„å¤§å…¬å¸æ ¡æ‹›é¢è¯•ä¹Ÿå‡ ä¹éƒ½ä¼šè€ƒè®¾è®¡æ¨¡å¼ï¼Œåè§‚ç°åœ¨ï¼Œåˆ™ä¼¼ä¹å¾ˆå°‘æœ‰äººèŠè®¾è®¡æ¨¡å¼çš„è¯é¢˜ã€‚æ˜¯å› ä¸ºè®¾è®¡æ¨¡å¼è¿‡æ—¶äº†å—ï¼Ÿè¿˜æ˜¯åªæ˜¯ä¸€ä¸ªé”™è¯¯çš„æ¦‚å¿µï¼Ÿä»ä¸ªäººè¿™å‡ å¹´çš„å¼€å‘ç»éªŒæ¥çœ‹ï¼Œç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œè®¾è®¡æ¨¡å¼å¹¶æœªè¿‡æ—¶ï¼Œæ›´ä¸æ˜¯ä¸€ä¸ªé”™è¯¯çš„æ¦‚å¿µã€‚ä»æ›¾ç»çš„â€œçº¢æä¸€æ—¶â€åˆ°å¦‚ä»Šçš„â€œé—¨å¯ç½—é›€â€ï¼Œåªæ˜¯è¯´æ˜è½¯ä»¶å¼€å‘è¡Œä¸šä»¥æ›´åŠ å®¢è§‚ç†æ€§çš„æ€åº¦æ¥çœ‹å¾…è®¾è®¡æ¨¡å¼ã€‚è½¯ä»¶å¼€å‘é¢†åŸŸçš„æŠ€æœ¯æ¦‚å¿µä¹Ÿä¼¼ä¹æ€»æ˜¯éµå¾ªè¿™æ ·çš„æµè¡Œåº¦å˜è¿ï¼Œæœ€ç»ˆä¸€æ¬¡åˆä¸€æ¬¡åœ°è¯æ˜ä¸å­˜åœ¨â€œé“¶å¼¹â€ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ­£ç¡®çœ‹å¾…è®¾è®¡æ¨¡å¼çš„å‰ææ˜¯æ˜ç™½ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ã€‚æ­£å¦‚æœ¬ä¹¦ä¸€å¼€å§‹å°±å¼ºè°ƒçš„ï¼šâ€œè®¾è®¡æ¨¡å¼çš„æœ¬è´¨æ˜¯åœ¨å·²æœ‰çš„æ–¹æ¡ˆä¹‹ä¸Šå‘ç°æ›´å¥½çš„æ–¹æ¡ˆï¼ˆè€Œä¸æ˜¯å…¨æ–°å‘æ˜ï¼‰â€ï¼Œè¿™æ˜¯ä¸€ç§åŠ¡å®çš„æ€åº¦ï¼Œè®¾è®¡æ¨¡å¼å¹¶éæ˜¯ä¸€ç§é«˜å¤§ä¸Šæˆ–è€…ç¥ç§˜çš„ä¸œè¥¿ï¼Œè€Œæ˜¯ä¸€äº›å¸¸è§çš„è½¯ä»¶å·¥ç¨‹è®¾è®¡é—®é¢˜çš„æœ€ä½³å®è·µæ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é‚£ä¹ˆåº”è¯¥å¦‚ä½•å­¦ä¹ è®¾è®¡æ¨¡å¼ï¼Ÿä¸ªäººè®¤ä¸ºè½¯ä»¶å¼€å‘æŠ€æœ¯çš„å­¦ä¹ éƒ½åº”è¯¥ä»¥å®è·µä¸ºå‰æï¼Œåªæœ‰ç†è§£å®è·µè¿‡ç¨‹ä¸­é‡åˆ°çš„ç§ç§é—®é¢˜ï¼Œæ‰èƒ½æ˜ç™½é‚£äº›æŠ€æœ¯çš„æœ¬è´¨å’Œç›®çš„æ˜¯ä»€ä¹ˆï¼Œæ¯ç§æ–°æŠ€æœ¯éƒ½æ˜¯å› æŸä¸ª/æŸäº›é—®é¢˜è€Œå‡ºç°çš„ï¼Œè½¯ä»¶å¼€å‘é«˜æ‰‹ä¸€èˆ¬éƒ½åå¯¹æ–°æ‰‹ä¸€å¼€å§‹å°±ä¸€è‚¡è„‘åœ°å­¦ä¹ è®¾è®¡æ¨¡å¼ã€‚æœ‰äº›æ–°æ‰‹å­¦äº†ç‚¹è®¾è®¡æ¨¡å¼çš„ç†è®ºåï¼Œç”šè‡³åœ¨è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­ç”Ÿæ¬ç¡¬å¥—ï¼Œç»“æœæ˜¯é€‚å¾—å…¶åã€‚å› æ­¤ï¼Œè½¯ä»¶å¼€å‘äººå‘˜åº”è¯¥åœ¨ç§¯ç´¯äº†ä¸€å®šçš„å¼€å‘ç»éªŒï¼Œå†ç³»ç»Ÿåœ°å­¦ä¹ è®¾è®¡æ¨¡å¼ï¼Œæ•ˆæœå¾€å¾€ä¹Ÿèƒ½äº‹åŠåŠŸå€ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç°åœ¨æœ‰äº›ç§¯ç´¯ä¸€å®šå¼€å‘ç»éªŒçš„è½¯ä»¶å¼€å‘äººå‘˜ï¼Œåœ¨è°ˆèµ·è®¾è®¡æ¨¡å¼æ—¶ï¼Œä¸€è„¸é„™å¤·ã€‚æˆ‘æƒ³è¿™ä¹Ÿä¸æ˜¯ä¸€ç§å®¢è§‚åŠ¡å®çš„æ€åº¦ã€‚è½¯ä»¶å¼€å‘ä¸æ˜¯ç®€å•çš„ç´¯ç§¯ä»£ç ï¼Œåœ¨å®ç°ä¸šåŠ¡åŠŸèƒ½çš„åŒæ—¶åº”è¯¥ä»”ç»†è€ƒè™‘å¦‚ä½•æ§åˆ¶è½¯ä»¶çš„å¤æ‚åº¦ã€‚è½¯ä»¶çš„å¤æ‚åº¦åˆ†ä¸ºä¸¤ä¸ªå±‚é¢ï¼šä¸šåŠ¡é€»è¾‘å¤æ‚åº¦å’Œä»£ç å®ç°å¤æ‚åº¦ã€‚å¯¹åŒä¸€ä¸ªä¸šåŠ¡ç³»ç»Ÿï¼Œä¸åŒçš„è½¯ä»¶å¼€å‘äººå‘˜ä¼šæœ‰ä¸åŒçš„å®ç°ï¼Œå¤æ‚åº¦ä¹Ÿä¸åŒï¼Œç›¸åº”åœ°å®ç°çš„æ˜“ç†è§£æ€§ã€å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§ä¹Ÿä¸åŒã€‚è½¯ä»¶å¼€å‘äººå‘˜åº”è¯¥ä¸æ–­å­¦ä¹ å¦‚ä½•æ§åˆ¶è½¯ä»¶çš„å¤æ‚åº¦ï¼Œå­¦ä¹ å¹¶æ°å½“åœ°ä½¿ç”¨è®¾è®¡æ¨¡å¼æ˜¯åº”å¯¹è½¯ä»¶å¤æ‚åº¦çš„æœ‰æ•ˆæ–¹æ³•ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç„¶è€Œï¼Œè®¾è®¡æ¨¡å¼å¹¶éæ˜¯å›ºå®šä¸å˜çš„ï¼ˆå¦‚ï¼Œã€Šè®¾è®¡æ¨¡å¼-å¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹ä¸€ä¹¦æ€»ç»“çš„23ç§æ¨¡å¼ï¼‰ï¼Œä½¿ç”¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€æ¥ç¼–å†™ä»£ç ï¼Œéœ€è¦å­¦ä¹ çš„è®¾è®¡æ¨¡å¼ä¹Ÿä¸ä¸€æ ·ã€‚ä¸€æ–¹é¢å› ä¸ºè½¯ä»¶å¼€å‘é¢†åŸŸè¿…çŒ›å‘å±•ï¼Œä¸€äº›æ–°çš„è½¯ä»¶å·¥ç¨‹é—®é¢˜ä¹Ÿéšä¹‹å‡ºç°ï¼Œå¦ä¸€æ–¹é¢åˆ™æ˜¯æ–°çš„è¯­è¨€æ–°çš„å¹³å°ä¼šæŠŠä¸€äº›å¸¸è§è®¾è®¡æ¨¡å¼å¸æ”¶ä¸ºå†…ç½®ç‰¹æ€§ã€‚æ‰€ä»¥ï¼Œè½¯ä»¶å¼€å‘äººå‘˜å› ä»¥å®é™…é—®é¢˜ä¸ºé©±åŠ¨ï¼Œä¸æ–­æ›´æ–°è®¾è®¡æ¨¡å¼æ–¹é¢çš„çŸ¥è¯†ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ¬ä¹¦ä»¥Pythonç¼–ç¨‹è¯­è¨€ä¸ºä¾‹ï¼Œé’ˆå¯¹ç›®å‰çš„è½¯ä»¶å¼€å‘é¢†åŸŸï¼Œåˆ†ä¸‰å¤§ç±»è®²è§£äº†16ç§å¸¸ç”¨è®¾è®¡æ¨¡å¼ã€‚ä½¿ç”¨Pythonè¯­è¨€ç¼–å†™ç¤ºä¾‹ä»£ç ï¼Œæˆ‘è®¤ä¸ºä½œè€…ä¸»è¦æ˜¯è€ƒè™‘åˆ°Pythonçš„æŠ½è±¡å±‚æ¬¡é«˜ã€åº”ç”¨èŒƒå›´å¹¿ï¼Œè¯»è€…ä¸ä¼šè¢«ä¸€äº›å®ç°ç»†èŠ‚çš„å¹²æ‰°ï¼Œä»è€Œèƒ½å¿«é€Ÿç›´æ¥åœ°æŒæ¡æ¨¡å¼çš„è¦é¢†ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å…¨ä¹¦å§‹ç»ˆä¿æŒåŠ¡å®çš„æ€åº¦ï¼Œåˆ—ä¸¾äº†å¤§é‡ç°å®ç”Ÿæ´»çš„ä¾‹å­å’Œè½¯ä»¶å¼€å‘çš„ä¾‹å­ï¼Œå¹¶ä¸ºæ¯ä¸ªæ¨¡å¼æä¾›å®Œæ•´å¯è¿è¡Œçš„ç¤ºä¾‹ä»£ç ã€‚è™½ç„¶çœ‹èµ·æ¥åœ¨ä¹¦ä¸­å®Œæ•´åœ°ç»™å‡ºæ‰€æœ‰ç¤ºä¾‹ä»£ç ï¼Œä¼¼ä¹æ²¡ä»€ä¹ˆå¿…è¦ï¼Œä½†ä¸ªäººè®¤ä¸ºä½œè€…çš„ç”¨æ„æ˜¯å¸Œæœ›è¯»è€…èƒ½åŠ¨æ‰‹ç…§ç¤ºä¾‹ä»£ç å†™ä¸€éå¹¶è¿è¡Œèµ·æ¥çœ‹ç»“æœï¼Œå®è·µä¸ºç‹ï¼ŒåŠ å¼ºå­¦ä¹ çš„æ•ˆæœã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è™½ç„¶æ˜¯ç¤ºä¾‹ï¼Œä½œè€…è¿˜æ˜¯åšæŒä»¥åœ°é“çš„Pythoné£æ ¼ç¼–å†™ä»£ç ï¼Œä»¥æ­¤è¯´æ˜ä¸åŒè¯­è¨€ä¸åŒå¹³å°è¦æ±‚è½¯ä»¶å¼€å‘äººå‘˜å­¦ä¹ çš„è®¾è®¡æ¨¡å¼ä¹Ÿæœ‰æ‰€ä¸åŒã€‚å¦å¤–ï¼Œå¼€å‘äººå‘˜ä¹Ÿèƒ½ä»ç¤ºä¾‹ä»£ç ä¸­å­¦ä¹ åˆ°ä¸€äº›Pythonè¯­è¨€çš„é«˜çº§ç‰¹æ€§ï¼Œæ‰€ä»¥æŠŠæœ¬ä¹¦å½“åšPythonå¼€å‘è¿›é˜¶ä¹¦ç±ä¹Ÿæ— ä¸å¯ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ¬ä¹¦æ˜¯ä¸ªäººæ­£å¼ç¿»è¯‘çš„ç¬¬ä¸€æœ¬ä¹¦ã€‚è™½ç„¶ä»¥å‰ç¿»è¯‘è¿‡å¾ˆå¤šæ–‡ç« ï¼Œæœ‰äº›è¯‘æ–‡è¿˜æœ‰ç‚¹å½±å“ï¼Œä½†æ¯•ç«Ÿä¸æ­£å¼å‡ºç‰ˆçš„æœ‰äº›ä¸åŒï¼Œæ‰€ä»¥æ¥æ‰‹æœ¬ä¹¦çš„ç¿»è¯‘å·¥ä½œï¼Œæˆ‘å†…å¿ƒæ˜¯æœ‰äº›å¿å¿‘çš„ã€‚æˆ‘æŠŠç¿»è¯‘è¿‡ç¨‹åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªé˜¶æ®µè¿›è¡Œï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;å¤§è‡´åœ°é¢„è¯»ä¸€éå…¨ä¹¦ï¼Œæ•´ä½“ä¸ŠæŠŠæ¡åŸä¹¦å†…å®¹&lt;/li&gt;
&lt;li&gt;å°†åŸä¹¦ç¿»è¯‘æˆåˆç¨¿ï¼Œæ­¤é˜¶æ®µåŸºæœ¬ä¿è¯è¯‘æ–‡çš„æ­£ç¡®æ€§&lt;/li&gt;
&lt;li&gt;é€šè¯»å®¡æ ¡åˆç¨¿ï¼Œæ­¤é˜¶æ®µç¡®ä¿è¯‘æ–‡çš„æµç•…æ€§ï¼Œä»¥åŠç”¨è¯å’Œé€»è¾‘çš„ä¸€è‡´æ€§&lt;/li&gt;
&lt;li&gt;å¯¹ç€è¯‘ç¨¿ï¼Œç¿»è¯‘ç›¸å…³å›¾è¡¨ä¸­çš„å•è¯ï¼›æ•´ç†ç¤ºä¾‹ä»£ç ï¼Œå¹¶ç¡®ä¿è¿è¡Œæ— è¯¯&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¸Œæœ›é€šè¿‡è¿™ç§æ–¹å¼åŸºæœ¬ä¿è¯è¯‘ç¨¿çš„è´¨é‡ã€‚ä½†å› ä¸ºä¸ªäººç²¾åŠ›æœ‰é™èƒ½åŠ›ä¸è¶³ï¼Œè¯‘ç¨¿ä¸­å¯èƒ½è¿˜æ˜¯æœ‰äº›ç–æ¼ç”šè‡³é”™è¯¯ä¹‹å¤„ï¼Œæ•¬è¯·åŸè°…ï¼Œä¹Ÿè¯·å°†é—®é¢˜åé¦ˆç»™å‡ºç‰ˆç¤¾ï¼Œä»¥ä¾¿åœ¨ä¸‹ä¸€ç‰ˆæœ¬ä¸­æ›´æ­£ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦å¤–ï¼Œæœ¬ä¹¦çš„ç¤ºä¾‹ä»£ç å·²ç»å­˜åˆ°Githubçš„ä¸€ä¸ªä»£ç åº“ï¼ˆè§&lt;a href=&apos;https://github.com/youngsterxyf/mpdp-code&apos;&gt;https://github.com/youngsterxyf/mpdp-code&lt;/a&gt;ï¼‰ä¸­ï¼Œå¦‚æœ‰éœ€è¦ï¼Œå¯ä¸‹è½½ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å› ä¸ªäººç§äº‹ï¼Œæœ¬ä¹¦æ¨å»¶äº†ä¸€æ®µæ—¶é—´æ‰å¾—ä»¥ç¿»è¯‘å®Œæˆï¼Œæ„Ÿè°¢å›¾çµæœ±å·è€å¸ˆçš„ä½“è°…ã€‚è¯‘ä¹¦æ˜¯ä»¶è´¹æ—¶è´¹åŠ›çš„äº‹æƒ…ï¼Œæ„Ÿè°¢å¦»å­éƒ‘è£çš„ä½“è°…å’Œæ”¯æŒï¼Œä¹Ÿæ„Ÿè°¢å…¬å¸é¢†å¯¼è´¾ç£Šå’ŒåŒäº‹çš„æ”¯æŒï¼Œè°¢è°¢ï¼&lt;/p&gt;
&lt;p class=&quot;text-align-right&quot;&gt;&lt;em&gt;å¤æ°¸é”‹&lt;/em&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-right&quot;&gt;&lt;em&gt;äºä¸Šæµ·ç™¾åº¦ç ”å‘ä¸­å¿ƒ&lt;/em&gt;&lt;/p&gt;</description>
            <pubDate>2016-07-01</pubDate>
            <link>https://blog.xiayf.cn/posts/mpdp.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/mpdp.html</guid>
        </item>
        
        <item>
            <title>Base64ç¼–ç åŸç†ä¸åº”ç”¨</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;2015å¹´ï¼Œæˆ‘ä»¬åœ¨é’äº‘å¹³å°ä¸Šå®ç°äº†â€œç™¾åº¦äº‘è§‚æµ‹â€åº”ç”¨ã€‚é’äº‘åº”ç”¨æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªiframeï¼Œåœ¨å‘iframeæœåŠ¡æ–¹å‘é€çš„è¯·æ±‚ä¸­ä¼šæºå¸¦ä¸€äº›æ•°æ®ï¼Œé’äº‘å¹³å°ä¼šä½¿ç”¨&lt;code&gt;Base64 URL&lt;/code&gt;å¯¹è¿™äº›æ•°æ®è¿›è¡Œç¼–ç ï¼Œå…¶æä¾›çš„ç¼–ç è§£ç ç®—æ³•ç¤ºä¾‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-php&quot;&gt;&lt;code&gt;// phpç‰ˆæœ¬
function base64_URL_encode($data) {
  return rtrim(strtr(base64_encode($data), &amp;amp;apos;+/&amp;amp;apos;, &amp;amp;apos;-_&amp;amp;apos;), &amp;amp;apos;=&amp;amp;apos;);
}
function base64_URL_decode($data) {
  return base64_decode(str_pad(strtr($data, &amp;amp;apos;-_&amp;amp;apos;, &amp;amp;apos;+/&amp;amp;apos;), 
                            strlen($data) % 4, &amp;amp;apos;=&amp;amp;apos;, STR_PAD_RIGHT));
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯ä»¥çœ‹å‡ºï¼Œ&lt;code&gt;Base64 URL&lt;/code&gt; æ˜¯æ ‡å‡†Base64ç¼–ç çš„ä¸€ä¸ªå˜ç§ï¼Œåˆ†åˆ«ç”¨ &lt;code&gt;-&lt;/code&gt;ã€&lt;code&gt;_&lt;/code&gt; æ›¿æ¢æ ‡å‡†Base64ç¼–ç ç»“æœä¸­çš„ &lt;code&gt;+&lt;/code&gt; ã€ &lt;code&gt;/&lt;/code&gt; ï¼Œå¹¶åˆ é™¤ç»“æœæœ€åçš„ &lt;code&gt;=&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨å®ç° â€œç™¾åº¦äº‘è§‚æµ‹â€ é’äº‘åº”ç”¨æ—¶ï¼Œæˆ‘åœ¨æƒ³ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ä¸ºä»€ä¹ˆè¦ä½¿ç”¨Base64ç¼–ç ï¼Ÿ&lt;/li&gt;
&lt;li&gt;Base64ç¼–ç ç®—æ³•æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ¬æ–‡æ˜¯å›´ç»•è¿™ä¸¤ä¸ªé—®é¢˜æ€è€ƒå’Œå®è·µçš„ç»“æœã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘è®¤ä¸ºï¼Œç†è§£Base64æˆ–å…¶ä»–ç±»ä¼¼ç¼–ç çš„å…³é”®æœ‰ä¸¤ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;è®¡ç®—æœºæœ€ç»ˆå­˜å‚¨å’Œæ‰§è¡Œçš„æ˜¯01äºŒè¿›åˆ¶åºåˆ—ï¼Œè¿™ä¸ªäºŒè¿›åˆ¶åºåˆ—çš„å«ä¹‰åˆ™ç”±è§£ç ç¨‹åº/è§£é‡Šç¨‹åºå†³å®š&lt;/li&gt;
&lt;li&gt;å¾ˆå¤šåœºæ™¯ä¸‹çš„æ•°æ®ä¼ è¾“è¦æ±‚æ•°æ®åªèƒ½ç”±ç®€å•é€šç”¨çš„å­—ç¬¦ç»„æˆï¼Œæ¯”å¦‚HTTPåè®®è¦æ±‚è¯·æ±‚çš„é¦–è¡Œå’Œè¯·æ±‚å¤´éƒ½å¿…é¡»æ˜¯ASCIIç¼–ç &lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä»¥é’äº‘åº”ç”¨ä¸ºä¾‹ï¼Œç®€å•è§£é‡Šè¿™ä¸¤ç‚¹ã€‚é’äº‘å¹³å°é€šè¿‡POSTä¸€ä¸ªè¡¨å•æ¥è·å–iframeï¼Œè¡¨å•æœ‰ &lt;code&gt;payload&lt;/code&gt; å’Œ &lt;code&gt;signature&lt;/code&gt; ä¸¤é¡¹ï¼Œ &lt;code&gt;payload&lt;/code&gt; åŸæœ¬æ˜¯ä¸€ä¸ªJSONå¯¹è±¡ï¼Œå…¶ä¸­çš„é”®å€¼å¯èƒ½åŒ…å«ä¸€äº›ç‰¹æ®Šå­—ç¬¦ï¼Œæ¯”å¦‚ &lt;code&gt;&amp;amp;&lt;/code&gt;ã€&lt;code&gt;/&lt;/code&gt; ç­‰ï¼Œç”±äºé’äº‘è®¾è®¡çš„ä¸€ç§é€šç”¨çš„è¯·æ±‚äº¤äº’æ–¹æ¡ˆï¼Œéœ€è¦è€ƒè™‘iframeæœåŠ¡æ–¹æœåŠ¡å™¨ç«¯çš„å„ç§å¯èƒ½å®ç°ï¼Œæœ‰äº›æœåŠ¡å™¨ç«¯å®ç°æ²¡æœ‰è€ƒè™‘è¡¨å•å€¼æœ‰è¿™äº›ç‰¹æ®Šå­—ç¬¦ï¼Œæˆ–è€…POSTè¯·æ±‚è¢«ä¸­é—´æœåŠ¡å™¨è½¬æ¢æˆGETè¯·æ±‚å†æ¬¡å‘å‡ºï¼Œå¯¹äºURLæ¥è¯´ï¼Œ&lt;code&gt;&amp;amp;&lt;/code&gt;ã€&lt;code&gt;/&lt;/code&gt;éƒ½æ˜¯å…·æœ‰ç‰¹æ®Šå«ä¹‰çš„å­—ç¬¦ï¼Œæ‰€ä»¥éœ€è¦å¯¹è¯·æ±‚æ•°æ®è¿›è¡Œç‰¹æ®Šç¼–ç é¿å…è¿™äº›å­—ç¬¦å‡ºç° - æ•°æ®å‘é€æ–¹å¯¹æ•°æ®æŒ‰è§„åˆ™è¿›è¡Œç¼–ç ï¼Œæ¥æ”¶æ–¹å¯¹åº”åœ°æŒ‰è§„åˆ™è§£ç æ•°æ®ã€‚&lt;/p&gt;
&lt;h2&gt;Base64ç¼–ç åŸç†&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Base64ç¼–ç ä¹‹æ‰€ä»¥ç§°ä¸ºBase64ï¼Œæ˜¯å› ä¸ºå…¶ä½¿ç”¨64ä¸ªå­—ç¬¦æ¥å¯¹ä»»æ„æ•°æ®è¿›è¡Œç¼–ç ï¼ŒåŒç†æœ‰Base32ã€Base16ç¼–ç ã€‚æ ‡å‡†Base64ç¼–ç ä½¿ç”¨çš„64ä¸ªå­—ç¬¦ä¸ºï¼š&lt;/p&gt;
&lt;img src=&apos;https://i.loli.net/2020/06/14/XHFMRvxfez4OVtr.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;500&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™64ä¸ªå­—ç¬¦æ˜¯å„ç§å­—ç¬¦ç¼–ç ï¼ˆæ¯”å¦‚ASCIIç¼–ç ï¼‰æ‰€ä½¿ç”¨å­—ç¬¦çš„å­é›†ï¼ŒåŸºæœ¬ï¼Œå¹¶ä¸”å¯æ‰“å°ã€‚å”¯ä¸€æœ‰ç‚¹ç‰¹æ®Šçš„æ˜¯æœ€åä¸¤ä¸ªå­—ç¬¦ï¼Œå› å¯¹æœ€åä¸¤ä¸ªå­—ç¬¦çš„é€‰æ‹©ä¸åŒï¼ŒBase64ç¼–ç åˆæœ‰å¾ˆå¤šå˜ç§ï¼Œæ¯”å¦‚Base64 URLç¼–ç ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Base64ç¼–ç æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å°†äºŒè¿›åˆ¶æ•°æ®è½¬æˆæ–‡æœ¬æ•°æ®çš„æ–¹æ¡ˆã€‚å¯¹äºéäºŒè¿›åˆ¶æ•°æ®ï¼Œæ˜¯å…ˆå°†å…¶è½¬æ¢æˆäºŒè¿›åˆ¶å½¢å¼ï¼Œç„¶åæ¯è¿ç»­6æ¯”ç‰¹ï¼ˆ2çš„6æ¬¡æ–¹=64ï¼‰è®¡ç®—å…¶åè¿›åˆ¶å€¼ï¼Œæ ¹æ®è¯¥å€¼åœ¨ä¸Šé¢çš„ç´¢å¼•è¡¨ä¸­æ‰¾åˆ°å¯¹åº”çš„å­—ç¬¦ï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ªæ–‡æœ¬å­—ç¬¦ä¸²ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å‡è®¾æˆ‘ä»¬è¦å¯¹ &lt;code&gt;Hello!&lt;/code&gt; è¿›è¡ŒBase64ç¼–ç ï¼ŒæŒ‰ç…§ASCIIè¡¨ï¼Œå…¶è½¬æ¢è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;img src=&apos;https://i.loli.net/2020/06/14/tJnClQsjc4WMGhB.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;100%&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯çŸ¥ &lt;code&gt;Hello!&lt;/code&gt; çš„Base64ç¼–ç ç»“æœä¸º &lt;code&gt;SGVsbG8h&lt;/code&gt; ï¼ŒåŸå§‹å­—ç¬¦ä¸²é•¿åº¦ä¸º6ä¸ªå­—ç¬¦ï¼Œç¼–ç åé•¿åº¦ä¸º8ä¸ªå­—ç¬¦ï¼Œæ¯3ä¸ªåŸå§‹å­—ç¬¦ç»Base64ç¼–ç æˆ4ä¸ªå­—ç¬¦ï¼Œç¼–ç å‰åé•¿åº¦æ¯”4/3ï¼Œè¿™ä¸ªé•¿åº¦æ¯”å¾ˆé‡è¦ - æ¯”åŸå§‹å­—ç¬¦ä¸²é•¿åº¦çŸ­ï¼Œåˆ™éœ€è¦ä½¿ç”¨æ›´å¤§çš„ç¼–ç å­—ç¬¦é›†ï¼Œè¿™å¹¶ä¸æˆ‘ä»¬æƒ³è¦çš„ï¼›é•¿åº¦æ¯”è¶Šå¤§ï¼Œåˆ™éœ€è¦ä¼ è¾“è¶Šå¤šçš„å­—ç¬¦ï¼Œä¼ è¾“æ—¶é—´è¶Šé•¿ã€‚Base64åº”ç”¨å¹¿æ³›çš„åŸå› æ˜¯åœ¨å­—ç¬¦é›†å¤§å°ä¸é•¿åº¦æ¯”ä¹‹é—´å–å¾—ä¸€ä¸ªè¾ƒå¥½çš„å¹³è¡¡ï¼Œé€‚ç”¨äºå„ç§åœºæ™¯ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ˜¯ä¸æ˜¯è§‰å¾—Base64ç¼–ç åŸç†å¾ˆç®€å•ï¼Ÿ&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½†è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸ªç‚¹ï¼šBase64ç¼–ç æ˜¯æ¯3ä¸ªåŸå§‹å­—ç¬¦ç¼–ç æˆ4ä¸ªå­—ç¬¦ï¼Œå¦‚æœåŸå§‹å­—ç¬¦ä¸²é•¿åº¦ä¸èƒ½è¢«3æ•´é™¤ï¼Œé‚£æ€ä¹ˆåŠï¼Ÿä½¿ç”¨0å€¼æ¥è¡¥å……åŸå§‹å­—ç¬¦ä¸²ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä»¥ &lt;code&gt;Hello!!&lt;/code&gt; ä¸ºä¾‹ï¼Œå…¶è½¬æ¢è¿‡ç¨‹ä¸ºï¼š&lt;/p&gt;
&lt;img src=&apos;https://i.loli.net/2020/06/14/5URB8nVis9ljwYe.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;100%&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;em&gt;æ³¨ï¼šå›¾è¡¨ä¸­è“è‰²èƒŒæ™¯çš„äºŒè¿›åˆ¶0å€¼æ˜¯é¢å¤–è¡¥å……çš„ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;Hello!!&lt;/code&gt; Base64ç¼–ç çš„ç»“æœä¸º &lt;code&gt;SGVsbG8hIQAA&lt;/code&gt; ã€‚æœ€å2ä¸ªé›¶å€¼åªæ˜¯ä¸ºäº†Base64ç¼–ç è€Œè¡¥å……çš„ï¼Œåœ¨åŸå§‹å­—ç¬¦ä¸­å¹¶æ²¡æœ‰å¯¹åº”çš„å­—ç¬¦ï¼Œé‚£ä¹ˆBase64ç¼–ç ç»“æœä¸­çš„æœ€åä¸¤ä¸ªå­—ç¬¦ &lt;code&gt;AA&lt;/code&gt; å®é™…ä¸å¸¦æœ‰æ•ˆä¿¡æ¯ï¼Œæ‰€ä»¥éœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œä»¥å…è§£ç é”™è¯¯ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ ‡å‡†Base64ç¼–ç é€šå¸¸ç”¨ &lt;code&gt;=&lt;/code&gt; å­—ç¬¦æ¥æ›¿æ¢æœ€åçš„ &lt;code&gt;A&lt;/code&gt;ï¼Œå³ç¼–ç ç»“æœä¸º &lt;code&gt;SGVsbG8hIQ==&lt;/code&gt;ã€‚å› ä¸º &lt;code&gt;=&lt;/code&gt; å­—ç¬¦å¹¶ä¸åœ¨Base64ç¼–ç ç´¢å¼•è¡¨ä¸­ï¼Œå…¶æ„ä¹‰åœ¨äºç»“æŸç¬¦å·ï¼Œåœ¨Base64è§£ç æ—¶é‡åˆ° &lt;code&gt;=&lt;/code&gt; æ—¶å³å¯çŸ¥é“ä¸€ä¸ªBase64ç¼–ç å­—ç¬¦ä¸²ç»“æŸã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœBase64ç¼–ç å­—ç¬¦ä¸²ä¸ä¼šç›¸äº’æ‹¼æ¥å†ä¼ è¾“ï¼Œé‚£ä¹ˆæœ€åçš„ &lt;code&gt;=&lt;/code&gt; ä¹Ÿå¯ä»¥çœç•¥ï¼Œè§£ç æ—¶å¦‚æœå‘ç°Base64ç¼–ç å­—ç¬¦ä¸²é•¿åº¦ä¸èƒ½è¢«4æ•´é™¤ï¼Œåˆ™å…ˆè¡¥å…… &lt;code&gt;=&lt;/code&gt; å­—ç¬¦ï¼Œå†è§£ç å³å¯ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸ºäº†ç†è§£Base64ç¼–ç è§£ç è¿‡ç¨‹ï¼Œä¸ªäººå®ç°äº†ä¸€ä¸ªéå¸¸ç®€é™‹çš„Base64ç¼–ç è§£ç ç¨‹åºï¼Œè§ï¼š&lt;a href=&apos;https://github.com/youngsterxyf/xiaBase64&apos;&gt;youngsterxyf/xiaBase64&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç”±äºBase64åº”ç”¨å¹¿æ³›ï¼Œæ‰€ä»¥å¾ˆå¤šç¼–ç¨‹è¯­è¨€çš„æ ‡å‡†åº“éƒ½å†…ç½®Base64ç¼–ç è§£ç åŒ…ï¼Œå¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;PHPï¼š&lt;a href=&apos;http://php.net/manual/en/function.base64-encode.php&apos;&gt;base64_encode&lt;/a&gt;ã€&lt;a href=&apos;http://php.net/manual/en/function.base64-decode.php&apos;&gt;base64_decode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Pythonï¼š&lt;a href=&apos;https://docs.python.org/2/library/base64.html&apos;&gt;base64åŒ…&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Goï¼š&lt;a href=&apos;https://golang.org/pkg/encoding/base64/&apos;&gt;encoding/base64&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;...&lt;/li&gt;&lt;/ul&gt;
&lt;h2&gt;Base64ç¼–ç åº”ç”¨&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ¬æ–‡å¼€å§‹æåˆ°çš„é’äº‘åº”ç”¨ä¾‹å­åªæ˜¯Base64ç¼–ç çš„åº”ç”¨åœºæ™¯ä¹‹ä¸€ã€‚ç”±äºBase64ç¼–ç åœ¨å­—ç¬¦é›†å¤§å°ä¸ç¼–ç åæ•°æ®é•¿åº¦ä¹‹é—´åšäº†è¾ƒå¥½çš„å¹³è¡¡ï¼Œä»¥åŠBase64ç¼–ç å˜ç§å½¢å¼çš„å¤šæ ·ï¼Œä½¿å¾—Base64ç¼–ç çš„åº”ç”¨åœºæ™¯éå¸¸å¹¿æ³›ã€‚ä¸‹é¢ä¸¾2ä¸ªå¸¸ç”¨å¸¸è§çš„ä¾‹å­ã€‚&lt;/p&gt;
&lt;h3&gt;HTMLå†…åµŒBase64ç¼–ç å›¾ç‰‡&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å‰ç«¯åœ¨å®ç°é¡µé¢æ—¶ï¼Œå¯¹äºä¸€äº›ç®€å•å›¾ç‰‡ï¼Œé€šå¸¸ä¼šé€‰æ‹©å°†å›¾ç‰‡å†…å®¹ç›´æ¥å†…åµŒåœ¨é¡µé¢ä¸­ï¼Œé¿å…ä¸å¿…è¦çš„å¤–éƒ¨èµ„æºåŠ è½½ï¼Œå¢å¤§é¡µé¢åŠ è½½æ—¶é—´ï¼Œä½†æ˜¯å›¾ç‰‡æ•°æ®æ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œè¯¥æ€ä¹ˆåµŒå…¥å‘¢ï¼Ÿ&lt;a href=&apos;http://caniuse.com/#search=Data%20URI&apos;&gt;ç»å¤§å¤šæ•°ç°ä»£æµè§ˆå™¨&lt;/a&gt;éƒ½æ”¯æŒä¸€ç§åä¸º &lt;code&gt;Data URLs&lt;/code&gt; çš„ç‰¹æ€§ï¼Œå…è®¸ä½¿ç”¨Base64å¯¹å›¾ç‰‡æˆ–å…¶ä»–æ–‡ä»¶çš„äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œç¼–ç ï¼Œå°†å…¶ä½œä¸ºæ–‡æœ¬å­—ç¬¦ä¸²åµŒå…¥ç½‘é¡µä¸­ã€‚ä»¥ç™¾åº¦æœç´¢é¦–é¡µä¸ºä¾‹ï¼Œå…¶ä¸­è¯­éŸ³æœç´¢çš„å›¾æ ‡æ˜¯ä¸ªèƒŒæ™¯å›¾ç‰‡ï¼Œå…¶å†…å®¹ä»¥ &lt;code&gt;Data URLs&lt;/code&gt; å½¢å¼ç›´æ¥å†™åœ¨cssä¸­ï¼Œè¿™ä¸ªcsså†…å®¹åˆç›´æ¥åµŒåœ¨HTMLé¡µé¢ä¸­ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;img src=&apos;https://i.loli.net/2020/06/14/oa6rsPSwgMzv87l.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;100%&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;Data URLs&lt;/code&gt; æ ¼å¼ä¸ºï¼š&lt;code&gt;url(data:æ–‡ä»¶ç±»å‹;ç¼–ç æ–¹å¼,ç¼–ç åçš„æ–‡ä»¶å†…å®¹)&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åŸºäºimageæ ‡ç­¾åµŒå…¥å›¾ç‰‡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-html&quot;&gt;&lt;code&gt;&amp;amp;lt;img alt=&amp;amp;quot;Embedded Image&amp;amp;quot; src=&amp;amp;quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIA...&amp;amp;quot; /&amp;amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½†è¯·æ³¨æ„ï¼šå¦‚æœå›¾ç‰‡è¾ƒå¤§ï¼Œå›¾ç‰‡çš„è‰²å½©å±‚æ¬¡æ¯”è¾ƒä¸°å¯Œï¼Œåˆ™ä¸é€‚åˆä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œå› ä¸ºå…¶Base64ç¼–ç åçš„å­—ç¬¦ä¸²éå¸¸å¤§ï¼Œä¼šæ˜æ˜¾å¢å¤§HTMLé¡µé¢ï¼Œå½±å“åŠ è½½é€Ÿåº¦ã€‚&lt;/p&gt;
&lt;h3&gt;MIMEï¼ˆå¤šç”¨é€”äº’è”ç½‘é‚®ä»¶æ‰©å±•ï¼‰&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘ä»¬çš„ç”µå­é‚®ä»¶ç³»ç»Ÿï¼Œä¸€èˆ¬æ˜¯ä½¿ç”¨SMTPï¼ˆç®€å•é‚®ä»¶ä¼ è¾“åè®®ï¼‰å°†é‚®ä»¶ä»å®¢æˆ·ç«¯å‘å¾€æœåŠ¡å™¨ç«¯ï¼Œé‚®ä»¶å®¢æˆ·ç«¯ä½¿ç”¨POP3ï¼ˆé‚®å±€åè®®ï¼Œç¬¬3ç‰ˆæœ¬ï¼‰æˆ–IMAPï¼ˆäº¤äº’é‚®ä»¶è®¿é—®åè®®ï¼‰ä»æœåŠ¡å™¨ç«¯è·å–é‚®ä»¶ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;SMTPåè®®ä¸€å¼€å§‹æ˜¯åŸºäºçº¯ASCIIæ–‡æœ¬çš„ï¼Œå¯¹äºäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæ¯”å¦‚é‚®ä»¶é™„ä»¶ä¸­çš„å›¾åƒã€å£°éŸ³ç­‰ï¼‰çš„å¤„ç†å¹¶ä¸å¥½ï¼Œæ‰€ä»¥åæ¥æ–°å¢MIMEæ ‡å‡†æ¥ç¼–ç äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½¿å…¶èƒ½å¤Ÿé€šè¿‡SMTPåè®®ä¼ è¾“ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘ç»™è‡ªå·±å‘å°é‚®ä»¶ï¼Œæ­£æ–‡ä¸ºç©ºï¼Œå¸¦ä¸€ä¸ªåä¸ºhello.txtçš„é™„ä»¶ï¼Œå†…å®¹ä¸º &lt;code&gt;æ‚¨å¥½ï¼ä¸–ç•Œï¼&lt;/code&gt;ã€‚å¯¼å‡ºé‚®ä»¶æºç ï¼Œå…¶å…³é”®éƒ¨åˆ†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;img src=&apos;https://i.loli.net/2020/06/14/c8wIeoij9HWt4Ph.jpg&apos; title=&apos;&apos; alt=&apos;&apos; width=&apos;600&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;MIME-Version: 1.0&lt;/code&gt;ï¼šè¡¨ç¤ºå½“å‰ä½¿ç”¨MIMEæ ‡å‡†1.0ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;Content-Type: text/plain; name=&amp;quot;hello.txt&amp;quot;&lt;/code&gt;ï¼šè¡¨ç¤ºé™„ä»¶æ–‡ä»¶åä¸º &lt;code&gt;hello.txt&lt;/code&gt; ï¼Œæ ¼å¼ä¸ºçº¯æ–‡æœ¬ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;Content-Transfer-Encoding: base64&lt;/code&gt;ï¼šè¡¨ç¤ºé™„ä»¶æ–‡ä»¶å†…å®¹ä½¿ç”¨base64ç¼–ç åä¼ è¾“ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;5oKo5aW977yM5LiW55WM77yB&lt;/code&gt;ï¼šåˆ™æ˜¯æ–‡ä»¶å†…å®¹ &lt;code&gt;æ‚¨å¥½ï¼Œä¸–ç•Œï¼&lt;/code&gt; Base64ç¼–ç åçš„ç»“æœã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸è¿‡ï¼ŒMIMEä½¿ç”¨çš„ä¸æ˜¯æ ‡å‡†Base64ç¼–ç ã€‚&lt;/p&gt;
&lt;h2&gt;åˆ‡å¿Œè¯¯ç”¨&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯èƒ½ä¼šæœ‰äººåœ¨ä¸ç†è§£Base64ç¼–ç çš„æƒ…å†µä¸‹ï¼Œå°†å…¶è¯¯ç”¨äºæ•°æ®åŠ å¯†æˆ–æ•°æ®æ ¡éªŒã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Base64æ˜¯ä¸€ç§æ•°æ®ç¼–ç æ–¹å¼ï¼Œç›®çš„æ˜¯è®©æ•°æ®ç¬¦åˆä¼ è¾“åè®®çš„è¦æ±‚ã€‚æ ‡å‡†Base64ç¼–ç è§£ç æ— éœ€é¢å¤–ä¿¡æ¯å³å®Œå…¨å¯é€†ï¼Œå³ä½¿ä½ è‡ªå·±è‡ªå®šä¹‰å­—ç¬¦é›†è®¾è®¡ä¸€ç§ç±»Base64çš„ç¼–ç æ–¹å¼ç”¨äºæ•°æ®åŠ å¯†ï¼Œåœ¨å¤šæ•°åœºæ™¯ä¸‹ä¹Ÿè¾ƒå®¹æ˜“ç ´è§£ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äºæ•°æ®åŠ å¯†åº”è¯¥ä½¿ç”¨ä¸“é—¨çš„&lt;strong&gt;ç›®å‰è¿˜æ²¡æœ‰æœ‰æ•ˆæ–¹å¼å¿«é€Ÿç ´è§£çš„&lt;/strong&gt;åŠ å¯†ç®—æ³•ã€‚æ¯”å¦‚ï¼šå¯¹ç§°åŠ å¯†ç®—æ³•&lt;code&gt;AES-128-CBC&lt;/code&gt;ï¼Œå¯¹ç§°åŠ å¯†éœ€è¦å¯†é’¥ï¼Œåªè¦å¯†é’¥æ²¡æœ‰æ³„éœ²ï¼Œé€šå¸¸éš¾ä»¥ç ´è§£ï¼›ä¹Ÿå¯ä»¥ä½¿ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå¦‚ &lt;code&gt;RSA&lt;/code&gt;ï¼Œåˆ©ç”¨æå¤§æ•´æ•°å› æ•°åˆ†è§£çš„è®¡ç®—é‡æå¤§è¿™ä¸€ç‰¹ç‚¹ï¼Œä½¿å¾—ä½¿ç”¨å…¬é’¥åŠ å¯†çš„æ•°æ®ï¼Œåªæœ‰ä½¿ç”¨ç§é’¥æ‰èƒ½å¿«é€Ÿè§£å¯†ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äºæ•°æ®æ ¡éªŒï¼Œä¹Ÿåº”è¯¥ä½¿ç”¨ä¸“é—¨çš„æ¶ˆæ¯è®¤è¯ç ç”Ÿæˆç®—æ³•ï¼Œå¦‚ &lt;code&gt;HMAC&lt;/code&gt; - ä¸€ç§ä½¿ç”¨å•å‘æ•£åˆ—å‡½æ•°æ„é€ æ¶ˆæ¯è®¤è¯ç çš„æ–¹æ³•ï¼Œå…¶è¿‡ç¨‹æ˜¯ä¸å¯é€†çš„ã€å”¯ä¸€ç¡®å®šçš„ï¼Œå¹¶ä¸”ä½¿ç”¨å¯†é’¥æ¥ç”Ÿæˆè®¤è¯ç ï¼Œå…¶ç›®çš„æ˜¯é˜²æ­¢æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¢«ç¯¡æ”¹æˆ–ä¼ªé€ ã€‚å°†åŸå§‹æ•°æ®ä¸è®¤è¯ç ä¸€èµ·ä¼ è¾“ï¼Œæ•°æ®æ¥æ”¶ç«¯å°†åŸå§‹æ•°æ®ä½¿ç”¨ç›¸åŒå¯†é’¥å’Œç›¸åŒç®—æ³•å†æ¬¡ç”Ÿæˆè®¤è¯ç ï¼Œä¸åŸæœ‰è®¤è¯ç è¿›è¡Œæ¯”å¯¹ï¼Œæ ¡éªŒæ•°æ®çš„åˆæ³•æ€§ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é‚£ä¹ˆé’ˆå¯¹å„å¤§ç½‘ç«™è¢«è„±åº“çš„é—®é¢˜ï¼Œè¯·é—®åº”è¯¥æ€ä¹ˆå­˜å‚¨ç”¨æˆ·çš„ç™»å½•å¯†ç ï¼Ÿ&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç­”æ¡ˆæ˜¯ï¼šåœ¨æ³¨å†Œæ—¶ï¼Œæ ¹æ®ç”¨æˆ·è®¾ç½®çš„ç™»å½•å¯†ç ï¼Œç”Ÿæˆå…¶æ¶ˆæ¯è®¤è¯ç ï¼Œç„¶åå­˜å‚¨ç”¨æˆ·åå’Œæ¶ˆæ¯è®¤è¯ç ï¼Œä¸å­˜å‚¨åŸå§‹å¯†ç ã€‚æ¯æ¬¡ç”¨æˆ·ç™»å½•æ—¶ï¼Œæ ¹æ®ç™»å½•å¯†ç ï¼Œç”Ÿæˆæ¶ˆæ¯è®¤è¯ç ï¼Œä¸æ•°æ®åº“ä¸­å­˜å‚¨çš„æ¶ˆæ¯è®¤è¯ç è¿›è¡Œæ¯”å¯¹ï¼Œä»¥ç¡®è®¤æ˜¯å¦ä¸ºæœ‰æ•ˆç”¨æˆ·ï¼Œè¿™æ ·å³ä½¿ç½‘ç«™è¢«è„±åº“ï¼Œç”¨æˆ·çš„åŸå§‹å¯†ç ä¹Ÿä¸ä¼šæ³„éœ²ï¼Œä¸ä¼šä¸ºç”¨æˆ·ä½¿ç”¨çš„å…¶ä»–ç½‘ç«™å¸¦æ¥è´¦å·é£é™©ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å½“ç„¶ï¼Œä½¿ç”¨çš„æ¶ˆæ¯è®¤è¯ç ç®—æ³•å…¶å“ˆå¸Œç¢°æ’çš„æ¦‚ç‡åº”è¯¥æä½æ‰è¡Œï¼Œç›®å‰ä¸€èˆ¬åœ¨HMACç®—æ³•ä¸­ä½¿ç”¨SHA256ã€‚å¯¹äºè¿™ç§æ–¹å¼éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼šé˜²æ­¢ç”¨æˆ·ä½¿ç”¨å¼±å¯†ç ï¼Œå¦åˆ™ä¹Ÿå¯èƒ½ä¼šè¢«æš´åŠ›ç ´è§£ã€‚ç°åœ¨çš„ç½‘ç«™ä¸€èˆ¬è¦æ±‚ç”¨æˆ·å¯†ç 6ä¸ªå­—ç¬¦ä»¥ä¸Šï¼Œå¹¶ä¸”åŒæ—¶æœ‰æ•°å­—å’Œå¤§å°å†™å­—æ¯ï¼Œç”šè‡³è¦æ±‚æœ‰ç‰¹æ®Šå­—ç¬¦ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åŠ å…¥éšæœºsaltçš„å“ˆå¸Œç®—æ³•æ¥å­˜å‚¨æ ¡éªŒç”¨æˆ·å¯†ç ã€‚è¿™é‡Œæš‚ä¸ç»†è¿°ã€‚&lt;/p&gt;
&lt;h2&gt;æ€»ç»“&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Base64å…¼é¡¾å­—ç¬¦é›†å¤§å°å’Œç¼–ç åæ•°æ®é•¿åº¦ï¼Œå¹¶ä¸”å¯ä»¥çµæ´»æ›¿æ¢å­—ç¬¦é›†çš„æœ€åä¸¤ä¸ªå­—ç¬¦ï¼Œä»¥åº”å¯¹å¤šæ ·çš„éœ€æ±‚ï¼Œä½¿å…¶é€‚ç”¨åœºæ™¯éå¸¸å¹¿æ³›ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å½“ç„¶ï¼Œå¾ˆå¤šåœºæ™¯ä¸‹æœ‰å¤šç§ç¼–ç æ–¹å¼å¯é€‰æ‹©ï¼Œå¹¶éBase64ç¼–ç ä¸å¯ï¼Œè§†éœ€æ±‚ï¼Œæƒè¡¡åˆ©å¼Šè€Œå®šã€‚&lt;/p&gt;</description>
            <pubDate>2016-01-24</pubDate>
            <link>https://blog.xiayf.cn/posts/base64-encoding.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/base64-encoding.html</guid>
        </item>
        
        <item>
            <title>åŸºäº Github çš„ pull request æµç¨‹åšå¼€æºè´¡çŒ®</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;æœ€è¿‘ç»™ &lt;a href=&apos;https://github.com/astaxie/beego&apos;&gt;beego&lt;/a&gt; æäº†å‡ ä¸ª pull request ï¼ˆç®€ç§°PRï¼‰ï¼Œéƒ½å·²è¢«æ¥å—ã€‚åœ¨ä½¿ç”¨pull requestçš„è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°äº†ä¸€ç‚¹å°é—®é¢˜ï¼Œæ‰çŸ¥ä»¥å‰å¹¶éçœŸçš„ç†è§£è¿™ä¸ªæµç¨‹ï¼Œæ•…åœ¨æ­¤åšç‚¹è®°å½•æ•´ç†ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘ä»¥ &lt;a href=&apos;https://github.com/astaxie/beego&apos;&gt;beego&lt;/a&gt; ä¸ºä¾‹ï¼Œå°†pull requestçš„æ•´ä½“ä½¿ç”¨æµç¨‹ç»˜å›¾å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;img src=&apos;https://i.loli.net/2020/06/14/yFkLXVAHKxmwjq9.jpg&apos; title=&apos;fork-pull-request&apos; alt=&apos;fork-pull-request&apos; width=&apos;100%&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;beegoä»£ç åº“æœ‰ä¸¤ä¸ªé•¿æœŸåˆ†æ”¯ &lt;code&gt;master&lt;/code&gt; å’Œ &lt;code&gt;develop&lt;/code&gt;ï¼Œ&lt;code&gt;master&lt;/code&gt;ä¸ºç¨³å®šåˆ†æ”¯ï¼Œ&lt;code&gt;develop&lt;/code&gt;ä¸ºå¼€å‘åˆ†æ”¯ï¼Œæ‰€æœ‰PRéƒ½è¦æ±‚æäº¤åˆ° &lt;code&gt;develop&lt;/code&gt; åˆ†æ”¯ã€‚&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;å…ˆå°† &lt;a href=&apos;https://github.com/astaxie/beego&apos;&gt;astaxie/beego&lt;/a&gt; ä»£ç åº“ fork ä¸€ä»½åˆ°è‡ªå·±çš„åä¸‹ï¼ˆå¦‚æˆ‘çš„ &lt;a href=&apos;https://github.com/youngsterxyf/beego&apos;&gt;youngsterxyf/beego&lt;/a&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æŠŠ &lt;a href=&apos;https://github.com/youngsterxyf/beego&apos;&gt;youngsterxyf/beego&lt;/a&gt; clone åˆ°æœ¬åœ°æœºå™¨ä¸Šåšå¼€å‘ã€‚å› ä¸ºPRè¦æåˆ° &lt;a href=&apos;https://github.com/astaxie/beego&apos;&gt;astaxie/beego&lt;/a&gt; çš„ develop åˆ†æ”¯ï¼Œæ‰€ä»¥æœ€å¥½å¯¹åº”åœ°åœ¨ä½ forkçš„ä»£ç åº“çš„ develop åˆ†æ”¯åšå¼€å‘ã€‚åœ¨æœ¬åœ°å¼€å‘æµ‹è¯•å®Œæˆåï¼Œå°†commit pushåˆ° &lt;a href=&apos;https://github.com/youngsterxyf/beego&apos;&gt;youngsterxyf/beego&lt;/a&gt; ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ &lt;a href=&apos;https://github.com/youngsterxyf/beego&apos;&gt;youngsterxyf/beego&lt;/a&gt; é¡µé¢ç‚¹å‡» â€œNew pull requestâ€ï¼Œä¼šè·³è½¬åˆ° &lt;a href=&apos;https://github.com/astaxie/beego&apos;&gt;astaxie/beego&lt;/a&gt; åˆ›å»ºä¸€ä¸ªæ–°çš„PRï¼Œåœ¨é¡µé¢ä¸­éœ€è¦é€‰æ‹©&lt;code&gt;base fork&lt;/code&gt;çš„ç›®æ ‡åˆ†æ”¯ï¼ˆè¿™é‡Œä¸º &lt;a href=&apos;https://github.com/astaxie/beego&apos;&gt;astaxie/beego&lt;/a&gt; çš„ develop åˆ†æ”¯ï¼‰å’Œ&lt;code&gt;head fork&lt;/code&gt;çš„ç›®æ ‡åˆ†æ”¯ï¼ˆè¿™é‡Œä¸º &lt;a href=&apos;https://github.com/youngsterxyf/beego&apos;&gt;youngsterxyf/beego&lt;/a&gt; çš„ develop åˆ†æ”¯ï¼‰ã€‚PRæäº¤åï¼Œç­‰å¾… &lt;a href=&apos;https://github.com/astaxie/beego&apos;&gt;astaxie/beego&lt;/a&gt; ä»£ç åº“çš„åä½œè€…æ¥reviewæˆ‘çš„PRã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœå…¶ä»–äººä¹Ÿç»™ &lt;a href=&apos;https://github.com/astaxie/beego&apos;&gt;astaxie/beego&lt;/a&gt; æäº†PRï¼ˆæˆ–è€…ç›´æ¥åœ¨ develop ä¸Šåšäº†å˜æ›´ï¼‰ï¼Œæˆ‘ä¼šæŠŠ &lt;a href=&apos;https://github.com/youngsterxyf/beego&apos;&gt;youngsterxyf/beego&lt;/a&gt; çš„ develop åˆ†æ”¯åŒæ­¥åˆ°æœ€æ–°çŠ¶æ€ï¼Œä¾¿äºæˆ‘è¿›è¡Œæ–°çš„å¼€å‘ï¼ŒåŒæ­¥çš„æµç¨‹ä¸ºï¼š
&lt;ol&gt;&lt;li&gt;åœ¨æœ¬åœ°ä»£ç åº“æ·»åŠ ä¸€ä¸ªæ–°çš„remoteï¼Œåä¸º &lt;code&gt;beego&lt;/code&gt; ï¼š &lt;code&gt;git remote add beego https://github.com/astaxie/beego.git&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åœ¨ &lt;code&gt;develop&lt;/code&gt; åˆ†æ”¯ä¸Šæ‰§è¡Œ &lt;code&gt;git pull beego develop&lt;/code&gt;ï¼Œè¿™ä¼šè·å– &lt;a href=&apos;https://github.com/astaxie/beego&apos;&gt;astaxie/beego&lt;/a&gt; develop åˆ†æ”¯æœ€æ–°çš„çŠ¶æ€ï¼Œå¹¶ merge åˆ°æœ¬åœ°ä»£ç åº“çš„ develop åˆ†æ”¯&lt;/li&gt;
&lt;li&gt;å°†æœ¬åœ°ä»£ç åº“çš„ develop åˆ†æ”¯ push åˆ° &lt;a href=&apos;https://github.com/youngsterxyf/beego&apos;&gt;youngsterxyf/beego&lt;/a&gt; ï¼š&lt;code&gt;git push origin develop&lt;/code&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/li&gt;
&lt;li&gt;åœ¨å‘å¸ƒæ–°çš„ç‰ˆæœ¬æ—¶, &lt;a href=&apos;https://github.com/astaxie/beego&apos;&gt;astaxie/beego&lt;/a&gt; çš„ &lt;code&gt;develop&lt;/code&gt; åˆ†æ”¯ä¼šå…ˆ merge åˆ°å…¶ master åˆ†æ”¯ï¼Œç„¶åæ‰“ä¸Šæ–°çš„ tag ã€‚è¿™æ—¶æˆ‘ä¹Ÿä¼šæŠŠ &lt;a href=&apos;https://github.com/youngsterxyf/beego&apos;&gt;youngsterxyf/beego&lt;/a&gt; çš„ master åˆ†æ”¯åŒæ­¥åˆ°æœ€æ–°çŠ¶æ€ï¼Œæµç¨‹ä¸ develop åˆ†æ”¯ç›¸åŒã€‚&lt;/li&gt;&lt;/ol&gt;
&lt;hr&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨ç¬¬3æ­¥ä¸­ï¼Œå¦‚æœå‘ç°&lt;code&gt;base fork&lt;/code&gt;çš„ç›®æ ‡åˆ†æ”¯å’Œ&lt;code&gt;head fork&lt;/code&gt;çš„ç›®æ ‡åˆ†æ”¯ä¹‹é—´æœ‰ä»£ç å†²çªï¼Œåˆ™éœ€è¦å…ˆåœ¨æœ¬åœ°ä»£ç åº“å¯¹åº”çš„åˆ†æ”¯ä¸Šè§£å†³è¿™ä¸ªå†²çªï¼Œç„¶å push åˆ° &lt;a href=&apos;https://github.com/youngsterxyf/beego&apos;&gt;youngsterxyf/beego&lt;/a&gt; ï¼Œå†æPRã€‚&lt;/p&gt;</description>
            <pubDate>2016-01-18</pubDate>
            <link>https://blog.xiayf.cn/posts/github-fork-pull-request.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/github-fork-pull-request.html</guid>
        </item>
        
        <item>
            <title>åˆä¸€æ¬¡ç³»ç»Ÿæ•…éšœ</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;ä¸Šå‘¨äº”æ—©ä¸Š9ç‚¹å¤šï¼Œæˆ‘è¿˜åœ¨ä¸Šç­çš„è·¯ä¸Šï¼Œæ¥åˆ°æŠ€æœ¯ leader çš„ç”µè¯ï¼šçº¿ä¸Šçªç„¶å‡ºæ•…éšœäº†ï¼›æ¥ç€å‘æ¥ä¸€å¼ æ•…éšœä¿¡æ¯é¡µé¢æˆªå›¾ï¼š&lt;/p&gt;
&lt;img src=&apos;https://i.loli.net/2020/06/14/L4fVgPGAb3Whznr.png&apos; title=&apos;system-fault-err-page&apos; alt=&apos;system-fault-err-page&apos; width=&apos;600&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆªå›¾åŒ…å«çš„ä¿¡æ¯æ˜¯ï¼šæ•°æ®åº“ä¸­æ²¡æ‰¾åˆ°æ•°æ®è¡¨&lt;code&gt;Users&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½†åŒäº‹æ£€æŸ¥è¿‡æ•°æ®åº“ï¼ŒUsers æ•°æ®è¡¨æ˜¯å­˜åœ¨çš„ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘å¿«é€Ÿåœ°å›å¿†äº†ä¸€ä¸‹æœ€è¿‘çš„ä»£ç å‘å¸ƒå’Œç¯å¢ƒå˜æ›´ - å‰ä¸€å¤©æœ‰ä¸ªåŒäº‹å¯¹çº¿ä¸Šæœºå™¨åšäº†ç‚¹æ”¹åŠ¨ã€‚å› æ­¤ï¼Œè®©åŒäº‹èµ¶ç´§æ£€æŸ¥ä¸€ä¸‹ä¹‹å‰çš„æ”¹åŠ¨æ˜¯å¦æœ‰é—®é¢˜ï¼Œç»æ£€æŸ¥ç¡®è®¤æ”¹åŠ¨æ²¡æœ‰é—®é¢˜ï¼Œè€Œä¸”ç¨å¾®æ€è€ƒä¸€ä¸‹å°±åº”è¯¥æ˜ç™½ä¸æ˜¯é…ç½®çš„é—®é¢˜ï¼Œå¦‚æœæ˜¯é…ç½®çš„é—®é¢˜ï¼Œé‚£ä¹ˆé—®é¢˜åº”è¯¥æ—©å°±å‡ºç°äº†ï¼Œè€Œä¸æ˜¯åœ¨æ—©ä¸Š9ç‚¹å¤šæ—¶å€™æ‰å‘ç”Ÿã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘ç¿»äº†ç¿»æ‰‹æœºä¸­æœ€è¿‘æ”¶åˆ°çš„å‡ æ¡å‘Šè­¦çŸ­ä¿¡ï¼Œå»é™¤é‡å¤å‘Šè­¦çŸ­ä¿¡ï¼Œåªæœ‰ä¸¤æ¡å‘Šè­¦ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;æŸå°WebæœåŠ¡å™¨ä¸Šå‡ºç°å¤§é‡çš„500é”™è¯¯&lt;/li&gt;
&lt;li&gt;æŸå°æ•°æ®åº“æœåŠ¡å™¨çš„ç£ç›˜ä½¿ç”¨ç‡ä¸º98.99%&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç”±æ­¤å¯ä»¥æ¨æµ‹ä¸¤ä¸ªæ•…éšœåŸå› ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;é‚£å°WebæœåŠ¡å™¨ä¸Šåº”ç”¨çš„æ•°æ®åº“é…ç½®æœ‰é—®é¢˜ - ä½†æ£€æŸ¥ä¹‹åç¡®è®¤æ²¡æœ‰é—®é¢˜&lt;/li&gt;
&lt;li&gt;ç”±äºé‚£å°æ•°æ®åº“æœåŠ¡å™¨ç£ç›˜æ»¡å¯¼è‡´çš„é—®é¢˜ï¼Œè™½ç„¶ä¸€æ—¶è¿˜æƒ³ä¸åˆ°å…¶ä¸­çš„å…³è” - åŒäº‹åœ¨æ£€æŸ¥ä¹‹åï¼Œç¡®è®¤é‚£å°æœºå™¨çš„ç£ç›˜ç¡®å®å·²æ»¡ï¼Œä½†é€šè¿‡å†…ç½‘çš„æ•°æ®åº“ç®¡ç†åå°ï¼Œå¯ä»¥æ­£å¸¸è®¿é—®æ•°æ®åº“ï¼Œæ‰€ä»¥è®¤ä¸ºåº”è¯¥ä¸æ˜¯ç£ç›˜æ»¡å¯¼è‡´çš„é—®é¢˜&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æ­¤ï¼Œä¸€æ—¶æˆ‘ä¹Ÿæ²¡æƒ³æ˜ç™½æ•…éšœçš„åŸå› ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ¥ç€ï¼ŒåŒäº‹å‘æ¥æ¶ˆæ¯ï¼šåªæœ‰ç™»å½•ç”¨æˆ·æ‰ä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜ï¼&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™æ—¶ï¼ŒåŸºäºä¹‹å‰çš„çº¿ç´¢ï¼ŒåŸºæœ¬èƒ½æ–­å®šæ•…éšœåŸå› æ˜¯ - æ•°æ®åº“æœåŠ¡å™¨ç£ç›˜æ»¡ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;æ•°æ®åº“ç®¡ç†åå°é»˜è®¤æ˜¯&lt;strong&gt;åªè¯»&lt;/strong&gt;ï¼šè¯»æ•°æ®è¡¨åˆ—è¡¨ã€æ•°æ®è¡¨ç»“æ„ã€å•ä¸ªè¡¨çš„è‹¥å¹²æ¡æ•°æ®&lt;/li&gt;
&lt;li&gt;æˆ‘ä»¬åº”ç”¨åœ¨å®ç°ä¸Šæœ‰è¿™æ ·çš„é€»è¾‘ï¼šç™»å½•ç”¨æˆ·çš„æ¯æ¬¡è®¿é—®éœ€è¦ç™»å½•æƒé™çš„é¡µé¢éƒ½ä¼šè‡ªåŠ¨æ›´æ–°ç”¨æˆ·çš„æœ€æ–°çš„è®¿é—®æ—¶é—´ï¼Œå³Usersæ•°æ®è¡¨çš„updated_timeå­—æ®µï¼Œä¹Ÿå³ä¼šå†™Usersæ•°æ®è¡¨ã€‚&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç”±äºç£ç›˜å·²æ»¡ï¼Œæ‰€ä»¥å†™ä¼šå¤±è´¥ï¼Œæ•…éšœä¿¡æ¯æç¤ºâ€œæ•°æ®åº“ä¸­æ‰¾ä¸åˆ°Usersæ•°æ®è¡¨â€ï¼Œä¼°è®¡å’ŒMySQLçš„å†™å®ç°æœ‰å…³ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¹‹åæ¸…ç†äº†ç£ç›˜ï¼Œæ•…éšœç«‹å³æ¢å¤ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘ä¸€ç›´è®¤ä¸ºï¼šæ’é™¤æ•…éšœ/è§£å†³é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬å°±åƒä¾¦æ¢ä¸€æ · - æ”¶é›†ä¿¡æ¯ã€æ€è€ƒä¿¡æ¯ä¹‹é—´çš„å…³è”ã€é€è¿‡ç°è±¡çœ‹æœ¬è´¨ã€‚æ•…éšœç°è±¡å¾ˆå¤šæ—¶å€™ä¼šå¯¼è‡´è¿·æƒ‘ï¼Œå¦‚ä½•èƒ½ç ´é™¤è¿·æƒ‘ï¼Ÿ- å…¨é¢åœ°æŒæ¡ç³»ç»Ÿçš„ä¿¡æ¯å¹¶ä½œå‡ºæ€è€ƒã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½†æ˜¯ï¼Œæ•…éšœå‘ç”Ÿæ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆè¦è€ƒè™‘çš„æ˜¯æ¢å¤æ•…éšœï¼Œå°½å¯èƒ½å‡å°å¯¹SLAçš„å½±å“ã€‚å¤§å¤šæ•°æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½æš‚æ—¶æ— æ³•æ‰¾åˆ°æ•…éšœåŸå› ï¼Œè€Œä¸”â€œæ‰¾åˆ°æ•…éšœåŸå› â€å¹¶éæ˜¯â€œæ•…éšœæ¢å¤â€çš„å¿…è¦æ¡ä»¶ï¼Œæ‰€ä»¥æ•…éšœå‘ç”Ÿæ—¶ï¼Œä¸è¦åªé¡¾ç€æŸ¥æ‰¾åŸå› ï¼Œå…ˆçœ‹çœ‹å¦‚ä½•æ¢å¤æ•…éšœã€‚æ¯”å¦‚ï¼šæœ¬æ–‡æ‰€è¿°çš„è¿™ä¸ªæ•…éšœï¼Œå¦‚æœæ²¡æœ‰æƒ³æ˜ç™½åŸå› ï¼Œå¯ä»¥å…ˆæŠŠæ’æŸ¥è¿‡ç¨‹ä¸­å‘ç°çš„æ‰€æœ‰å¼‚å¸¸ - ç£ç›˜æ»¡ - éƒ½è§£å†³äº†ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å†æ¥è¯´è¯´è¿™ä¸ªæ•…éšœçš„åŸå›  - ç£ç›˜æ»¡ã€‚ä¸ªäººè®¤ä¸ºè¿™ä¸ªæ•…éšœåŸå› æ˜¯æ¯”è¾ƒä½çº§çš„ï¼Œå¯è§æˆ‘ä»¬ç›‘æ§è¿ç»´çš„ç¼ºå¤±ã€‚ä¸ºä»€ä¹ˆç£ç›˜ä½¿ç”¨ç‡åˆ°äº†98.88%æ‰å‘Šè­¦ï¼Ÿå¤§é‡å ç”¨ç£ç›˜çš„æ—¥å¿—æ–‡ä»¶æ˜¯å¦å¯ä»¥å®šæœŸè‡ªåŠ¨æ¸…ç†ï¼Ÿåæ¥ï¼Œæˆ‘ä»¬&lt;strong&gt;å°†ç£ç›˜å‘Šè­¦çš„é˜ˆå€¼ä¿®æ”¹ä¸º85%ï¼Œå¹¶ä¸”å®šæœŸåˆ é™¤ä¸€æ®µæ—¶é—´ä¹‹å‰çš„æ—¥å¿—æ–‡ä»¶&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ•…éšœè§£å†³ä¹‹åï¼Œæˆ‘äº†è§£åˆ°æ•°æ®åº“æœåŠ¡å™¨ä¸Šå ç”¨ç£ç›˜æœ€å¤šçš„ç«Ÿç„¶æ˜¯&lt;strong&gt;æ•°æ®åº“ä»£ç†æœåŠ¡çš„æ—¥å¿—&lt;/strong&gt;ã€‚æ•°æ®åº“ä»£ç†æœåŠ¡ä¼šå°†æ¯ä¸ªç½‘ç»œè¯·æ±‚çš„ä¿¡æ¯è®°å½•åœ¨æ—¥å¿—ä¸­ï¼Œåœ¨ç½‘ç»œè¯·æ±‚é‡å¤§æ—¶ï¼Œæ—¥å¿—ä¼šå¿«é€Ÿå¢é•¿ &lt;em&gt;ï¼ˆè¿™æ ·çš„æ—¥å¿—ä¿¡æ¯é™¤äº†åœ¨æ•…éšœå‘ç”Ÿæ—¶å¸®åŠ©æ’æŸ¥æ•…éšœï¼Œæ²¡æœ‰å…¶ä»–ç”¨å¤„ï¼Œå®Œå…¨å¯ä»¥å®šæœŸæ¸…é™¤ï¼‰&lt;/em&gt; ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é‚£ä¹ˆæ•°æ®åº“æœåŠ¡ã€æ•°æ®åº“ä»£ç†æœåŠ¡æ˜¯å¦‚ä½•éƒ¨ç½²çš„å‘¢ï¼Ÿå‰ä¸€ç¯‡æ–‡ç« ç»™å‡ºäº†ä¸€å¼ ç³»ç»Ÿæ¶æ„å›¾ï¼Œå…¶ä¸­æ•°æ®åº“ä»£ç†æœåŠ¡å’Œæ•°æ®åº“æœåŠ¡æˆ‘ä»¬è¿ç»´çš„åŒå­¦å®é™…ä¸Šæ˜¯è¿™æ ·éƒ¨ç½²çš„ï¼š&lt;/p&gt;
&lt;img src=&apos;https://i.loli.net/2020/06/14/H1MhZn6Nj52moiR.png&apos; title=&apos;db-proxy-deployment&apos; alt=&apos;db-proxy-deployment&apos; width=&apos;600&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™æ ·çš„éƒ¨ç½²å¾’å¢åˆ«äººçš„è¿·æƒ‘ï¼Œå¢å¤§æ•…éšœæ’é™¤çš„éš¾åº¦ï¼Œè€Œä¸”ä¸»MySQLä¸æ•°æ®åº“ä»£ç†æœåŠ¡ä¹‹é—´ä¼šå­˜åœ¨èµ„æºç«äº‰ï¼Œç‰¹åˆ«æ˜¯åœ¨æ•°æ®é‡è®¿é—®é‡å¤§çš„æ—¶å€™ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¼è‡´è¿™ç§ä½çº§æ•…éšœå’Œéƒ¨ç½²æ··ä¹±çš„åŸå› åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨æˆ‘ä»¬å›¢é˜Ÿä¸­ï¼Œè¿ç»´åŒäº‹æ˜¯ä¸å¦ä¸€ä¸ªä¸šåŠ¡éƒ¨é—¨å…±äº«çš„ï¼Œç”±äºå¦ä¸€ä¸ªä¸šåŠ¡éƒ¨é—¨åšçš„æ˜¯å…¬å¸çš„é‡ç‚¹ä¸šåŠ¡ï¼Œè¿ç»´åŒäº‹çš„KPIæ˜¯æ ¹æ®å®ƒä»¬ä¸šåŠ¡æ¥å®šï¼Œä¹Ÿå°±æ˜¯è¯´è¿ç»´åŒäº‹åœ¨æˆ‘ä»¬è¿™å®Œå…¨æ˜¯å‹æƒ…æ”¯æŒï¼Œåˆèƒ½èŠ±å¤šå°‘æ—¶é—´æ¥å¸®æˆ‘ä»¬åšè¿ç»´å‘¢ï¼Ÿ&lt;/p&gt;</description>
            <pubDate>2015-11-16</pubDate>
            <link>https://blog.xiayf.cn/posts/another-system-fault.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/another-system-fault.html</guid>
        </item>
        
        <item>
            <title>è®°ä¸€æ¬¡ç³»ç»Ÿæ•…éšœ</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;å‰æ®µæ—¶é—´ï¼Œå·¥ä½œä¸­é­é‡ä¸€æ¬¡æ•…éšœï¼Œè™½ç„¶ä¸ç®—ä»€ä¹ˆâ€œç–‘éš¾æ‚ç—‡â€ï¼Œå€’ä¹ŸèŠ±äº†ä¸å°‘æ—¶é—´æ‰çœŸæ­£æ‰¾åˆ°æ•…éšœçš„åŸå› ï¼Œæ•…ä¹Ÿå€¼å¾—è®°å½•ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸ºæ–¹ä¾¿è¯»è€…å¿«é€Ÿç†è§£æ•…éšœï¼Œå…ˆç»™å‡ºç³»ç»Ÿå¤§è‡´çš„æ¶æ„å›¾ï¼š&lt;/p&gt;
&lt;img src=&apos;https://i.loli.net/2020/06/14/2ZBQgfPqMUnhVzY.png&apos; title=&apos;gxt-tech-arch&apos; alt=&apos;gxt-tech-arch&apos; width=&apos;800&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å…¶ä¸­ï¼Œ&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;æ¯å°WebæœåŠ¡å™¨ä¸Šå¼€å¯12ä¸ªPHP-FPMå®ä¾‹ï¼Œå¹¶é…ç½®åˆ°Nginxçš„upstreamï¼Œæ¯ä¸ªå®ä¾‹æœ€å¤šå¯ä»¥å¼€å¯10ä¸ªå­è¿›ç¨‹&lt;/li&gt;
&lt;li&gt;â€œDatabase Proxyâ€çš„ä»£ç†è§„åˆ™ä¸ºï¼šå†™æ“ä½œåŠäº‹åŠ¡ä¸­çš„æ‰€æœ‰SQLæ“ä½œéƒ½äº¤ç»™ä¸»MySQLå¤„ç†ï¼Œå…¶ä½™çš„è¯»æ“ä½œéƒ½äº¤ç»™ä»»æ„ä¸€å°ä»MySQLå¤„ç†&lt;/li&gt;&lt;/ol&gt;
&lt;hr&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ•…éšœæ‰€è¡¨ç°çš„ç°è±¡åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;å¤§é‡è¯·æ±‚å“åº”ä¸º502ï¼Œä½†æ¯æ¬¡æ•…éšœå‘ç”Ÿæ—¶ï¼Œé”™è¯¯å“åº”ä¸€èˆ¬é›†ä¸­åœ¨ä¸€å°WebæœåŠ¡å™¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/li&gt;&lt;/ol&gt;
&lt;img src=&apos;https://i.loli.net/2020/06/14/cPmFMn8gKZdzVoB.png&apos; title=&apos;nginx-502-error&apos; alt=&apos;nginx-502-error&apos; width=&apos;400&apos;/&gt;
&lt;img src=&apos;https://i.loli.net/2020/06/14/CSRj4ILYVlU21Es.jpg&apos; title=&apos;nginx-server-502-count&apos; alt=&apos;nginx-server-502-count&apos; width=&apos;600&apos;/&gt;
&lt;ol&gt;&lt;li&gt;ï¼ˆä¸€å°æˆ–å¤šå°ï¼‰MySQLæ•°æ®åº“æœåŠ¡å™¨CPUä½¿ç”¨ç‡é£™å‡ï¼ˆä½†å¹¶éæ€»æ˜¯ä¸€èµ·è¡¨ç°æ•…éšœï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/li&gt;&lt;/ol&gt;
&lt;img src=&apos;https://i.loli.net/2020/06/14/H5gqL8BeQpKXOla.png&apos; title=&apos;mysql-slave-server-idle&apos; alt=&apos;mysql-slave-server-idle&apos; width=&apos;600&apos;/&gt;
&lt;hr&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ•…éšœåˆšå¼€å§‹å‡ºç°æ—¶ï¼Œé‡å¯/å…³é—­å‡ºç°æ•…éšœç°è±¡çš„MySQLæœåŠ¡ï¼Œæˆ–å°†å‡ºç°æ•…éšœçš„WebæœåŠ¡å™¨ä¸Šæ‰€æœ‰PHP-FPMé‡å¯ï¼Œä¹Ÿèƒ½è§£ä¸€æ—¶çš„é—®é¢˜ï¼Œä½†æ²»ä¸äº†æœ¬ï¼Œæ•…éšœè¿˜æ˜¯é¢‘ç¹å‡ºç°ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨æ•…éšœå‘ç”Ÿæ—¶ï¼Œä»ç›¸å…³æœåŠ¡å™¨ä¸Šæ”¶é›†åˆ°çš„ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;å‡ºç°æ•…éšœç°è±¡çš„WebæœåŠ¡å™¨ - CPUä½¿ç”¨ç‡ã€å†…å­˜ä½¿ç”¨ç‡ç­‰ç³»ç»ŸæŒ‡æ ‡å‡æ­£å¸¸ï¼Œä½†PHP-FPMå­è¿›ç¨‹æ•°è¾¾åˆ°ä¸Šé™ï¼ˆ12 x 10 = 120ï¼‰ï¼Œå¹¶ä¸”PHP-FPMè¿›ç¨‹ä¸æ•°æ®åº“ä»£ç†æœåŠ¡å™¨ä¹‹é—´çš„ç½‘ç»œè¿æ¥æ•°é‡è¾ƒå¤šï¼ˆä¸PHP-FPMå­è¿›ç¨‹æ•°å¤§è‡´ç›¸å½“ï¼‰&lt;/li&gt;&lt;/ol&gt;
&lt;ol&gt;&lt;li&gt;å‡ºç°æ•…éšœç°è±¡çš„MySQLæœåŠ¡å™¨ - CPUä½¿ç”¨ç‡é£™å‡ï¼Œä¸»è¦ä¸ºMySQLè¿›ç¨‹å ç”¨ï¼›MySQLè¿›ç¨‹ä¸æ•°æ®åº“ä»£ç†æœåŠ¡å™¨ä¹‹é—´çš„ç½‘ç»œè¿æ¥è¾ƒå¤š&lt;/li&gt;&lt;/ol&gt;
&lt;ol&gt;&lt;li&gt;ç»§è€Œï¼Œå¯¹å‡ºç°æ•…éšœç°è±¡çš„MySQLæœåŠ¡å™¨ä¸Šçš„æ•°æ®åº“æ‰§è¡Œå‘½ä»¤&lt;code&gt;SHOW PROCESSLIST&lt;/code&gt;ï¼ˆæŸ¥çœ‹å½“å‰MySQLå®ä¾‹è¿è¡Œç€å“ªäº›çº¿ç¨‹ï¼‰ï¼Œç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼ˆæˆªå›¾åªæ˜¯ä¸€éƒ¨åˆ†ç»“æœï¼‰ï¼š&lt;/li&gt;&lt;/ol&gt;
&lt;img src=&apos;https://i.loli.net/2020/06/14/jLbvVOZEKlCdkgI.png&apos; title=&apos;mysql-show-processlist&apos; alt=&apos;mysql-show-processlist&apos; width=&apos;800&apos;/&gt;
&lt;hr&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å…ˆæ¥åˆ†æä¸€ä¸‹&lt;code&gt;SHOW PROCESSLIST&lt;/code&gt;çš„æ‰§è¡Œç»“æœï¼š&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;Command&lt;/strong&gt;å­—æ®µï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ç±»å‹&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;db&lt;/strong&gt;å­—æ®µï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œä»»åŠ¡æ¶‰åŠçš„æ•°æ®åº“æ˜¯å“ªä¸ª&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;State&lt;/strong&gt;å­—æ®µï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹æ‰€å¤„çš„çŠ¶æ€&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;Time&lt;/strong&gt;å­—æ®µï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹å¤„äºStateå­—æ®µæŒç»­çš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;Info&lt;/strong&gt;å­—æ®µï¼Œè¡¨ç¤ºå¦‚æœå½“å‰çº¿ç¨‹æ˜¯åœ¨æ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼ˆQueryï¼‰ï¼Œé‚£ä¹ˆæŸ¥è¯¢çš„è¯­å¥æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œå¦‚éæŸ¥è¯¢æ“ä½œï¼Œåˆ™è¯¥å­—æ®µä¸ºNULL&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç»“æœä¸­ï¼Œæœ‰ä¸¤ç§ä»»åŠ¡çº¿ç¨‹ï¼šâ€œBinlog Dumpâ€å’Œâ€œQueryâ€ï¼Œå…¶ä¸­â€œQueryâ€æ•°é‡å ç»å¤§å¤šæ•°ï¼ˆå’ŒMySQLè¿›ç¨‹ä¸æ•°æ®åº“ä»£ç†æœåŠ¡å™¨ä¹‹é—´çš„ç½‘ç»œè¿æ¥æ•°å¤§è‡´ç›¸å½“ï¼‰ï¼š&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;1ã€Binlog Dumpï¼šè¯¥ä»»åŠ¡çº¿ç¨‹è¡¨æ˜å½“å‰MySQLå®ä¾‹ä¸ºä¸» MySQLï¼Œå¹¶ä¸”å…¶çŠ¶æ€è¡¨æ˜ä¸»ä»åŒæ­¥å·²é¡ºåˆ©å®Œæˆã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;2ã€Queryï¼šè¡¨æ˜å½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œä¸€æ¬¡ SQL æŸ¥è¯¢æ“ä½œã€‚è¯¥ SQL ä¸º:&lt;/p&gt;
&lt;pre class=&quot;language-sql&quot;&gt;&lt;code&gt;SELECT h.host, p.result, p.update_time FROM PIXIU p join Host h using(host_id) WHERE ...&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;çº¿ç¨‹æ‰€å¤„çŠ¶æ€ä¸ºâ€œSorting resultâ€ï¼ˆæ­£åœ¨åˆ›å»ºæ’åºç´¢å¼•ï¼‰ï¼ŒæŒç»­æ—¶é—´ä¸º86-99ç§’å·¦å³ã€‚å¾ˆæ˜æ˜¾ï¼Œè¿™å¥SQLè¯­å¥èŠ±è´¹çš„æ—¶é—´è¿‡é•¿ï¼Œå­˜åœ¨é—®é¢˜ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç»¼åˆä¸Šé¢æ‰€è¿°ï¼Œå¯ä»¥å¼•å‡ºä¸€ä¸ªçŒœæµ‹ï¼šç”±äºè¿™æ¡SQLæŸ¥è¯¢éœ€è€—è´¹è¾ƒé•¿æ—¶é—´ï¼Œå¹¶ä¸”è¢«é¢‘ç¹æ‰§è¡Œï¼Œæ¶‰åŠè¯¥SQLçš„è¯·æ±‚éœ€è¦è¾ƒé•¿æ—¶é—´å®Œæˆï¼Œå¤§é‡SQLçº¿ç¨‹æ’é˜Ÿæ— å“åº”ï¼Œé˜»å¡äº†å¤§é‡PHP-FPMè¿›ç¨‹ï¼Œåœ¨æŸäº›æ—¶å€™ä¼šè¾¾åˆ°PHP-FPMå¹¶å‘å­è¿›ç¨‹æ•°ä¸Šé™ï¼ˆæ›´ä½•å†µæŸä¸ªä¼šè¢«é¢‘ç¹è®¿é—®çš„é¡µé¢è¯·æ±‚æ¶‰åŠè¯¥SQLï¼Œå¯¼è‡´æƒ…å†µæ›´ç³Ÿï¼‰ï¼ŒPHP-FPMæ— æ³•å¤„ç†æ–°çš„è¯·æ±‚ï¼Œå¯¹äºå·²æœ‰çš„è¯·æ±‚ä¹Ÿä¼šå› ä¸ºè¶…æ—¶å¯¼è‡´Nginxå“åº”502ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é‚£ä¹ˆé’ˆå¯¹è¯¥çŒœæµ‹ï¼Œå¯ä»¥åšä¸¤ä¸ªä¼˜åŒ–æ¥è§£å†³æ•…éšœï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ä¼˜åŒ–è¿™æ¡ SQL&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ç¼“å­˜&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™æ¡SQLçš„å®Œæ•´è¯­å¥ä¸ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-sql&quot;&gt;&lt;code&gt;SELECT h.host,p.result,p.update_time FROM Pixiu p 
    JOIN Host h USING(host_id) 
    WHERE result!=&amp;amp;apos;[]&amp;amp;apos;
    ORDER BY update_time DESC&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;&lt;li&gt;å­—æ®µ p.result çš„ç±»å‹ä¸º &lt;code&gt;mediumtext NOT NULL&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å­—æ®µ p.update_time çš„ç±»å‹ä¸ºï¼š&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-sql&quot;&gt;&lt;code&gt;timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç”±äºä¸šåŠ¡é€»è¾‘å¹¶ä¸è¦æ±‚è¯¥SQLçš„ç»“æœæ˜¯æ’åºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†è¯¥SQLä¸­çš„æ’åºæ¡ä»¶&lt;code&gt;order by update_time desc&lt;/code&gt;åˆ é™¤ï¼Œç»æµ‹è¯•å‘ç°æŸ¥è¯¢æ—¶é—´å¤§å¹…åº¦é™ä½åˆ°9mså·¦å³ï¼ˆåŸæ¥çš„å¹³å‡æŸ¥è¯¢æ—¶é—´ä¸º600å¤š-700mså·¦å³ï¼‰ï¼Œå¦å¤–ï¼Œç”±äºä¸šåŠ¡é€»è¾‘å¯¹äºè¯¥æ¡SQLæ¶‰åŠçš„æ•°æ®çš„å®æ—¶æ€§è¦æ±‚ä¸é«˜ï¼Œæˆ‘ä»¬ä½¿ç”¨Memcachedç¼“å­˜äº†è¯¥SQLçš„æŸ¥è¯¢ç»“æœã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é‡æ–°éƒ¨ç½²ï¼Œå‹æµ‹ï¼Œå¹¶çº¿ä¸Šè¿è¡Œè§‚å¯Ÿï¼Œä¹‹åæ•…éšœå†æœªå‘ç”Ÿã€‚äº‹åå›æƒ³ï¼Œæ•…éšœä¹Ÿç¡®å®æ˜¯åœ¨æ¶‰åŠè¯¥SQLçš„åŠŸèƒ½æ¨¡å—ä¸Šçº¿ä¹‹åæ‰å‘ç”Ÿçš„ã€‚&lt;/p&gt;
&lt;h2&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;
&lt;ul&gt;&lt;li&gt;&lt;a href=&apos;http://dev.mysql.com/doc/refman/5.6/en/show-processlist.html&apos;&gt;MySQLå®˜æ–¹æ–‡æ¡£ - SHOW PROCESSLIST Syntax&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&apos;http://dev.mysql.com/doc/refman/5.6/en/thread-commands.html&apos;&gt;MySQLå®˜æ–¹æ–‡æ¡£ - Thread Command Values&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&apos;http://dev.mysql.com/doc/refman/5.6/en/master-thread-states.html&apos;&gt;MySQLå®˜æ–¹æ–‡æ¡£ - Replication Master Thread States&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&apos;http://dev.mysql.com/doc/refman/5.6/en/general-thread-states.html&apos;&gt;MySQLå®˜æ–¹æ–‡æ¡£ - General Thread States&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&apos;http://www.nginx.cn/102.html&apos;&gt;nginx+php-fpmå‡ºç°502 bad gatewayé”™è¯¯è§£å†³æ–¹æ³•&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;</description>
            <pubDate>2015-10-02</pubDate>
            <link>https://blog.xiayf.cn/posts/note-of-a-system-fault.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/note-of-a-system-fault.html</guid>
        </item>
        
        <item>
            <title>ä¸€è¡Œå¼å¹¶è¡Œæ–¹æ¡ˆï¼ˆè¯‘ï¼‰</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;åŸæ–‡ï¼š&lt;a href=&apos;http://chriskiehl.com/article/parallelism-in-one-line&apos;&gt;Parallelism in one line&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨å¹¶è¡Œå¤„ç†èƒ½åŠ›æ–¹é¢ï¼ŒPythonçš„å£°åå¹¶ä¸å¤ªå¥½ã€‚ä¸è€ƒè™‘å…³äºçº¿ç¨‹å’ŒGILï¼ˆå¤šæ•°æƒ…å†µä¸‹æ˜¯åˆç†çš„ï¼‰çš„æ ‡å‡†è®ºæ®ï¼Œæˆ‘è®¤ä¸ºPythonä¸­å…³äºå¹¶è¡Œçš„çœŸæ­£é—®é¢˜å¹¶ä¸æ˜¯ä¸€ä¸ªæŠ€æœ¯é—®é¢˜ï¼Œè€Œæ˜¯æ•™å­¦é—®é¢˜ã€‚å›´ç»•Pythonçº¿ç¨‹å’Œå¤šè¿›ç¨‹çš„å¸¸è§æ•™ç¨‹ï¼Œä¸€èˆ¬éƒ½å†™å¾—ä¸é”™ï¼Œä½†ä¹Ÿä»¤äººä¹å‘³ - æ¿€çƒˆéå‡¡ï¼Œå¯¹æ—¥å¸¸çœŸæ­£æœ‰ç”¨çš„ä¸œè¥¿å´å¾ˆå°‘æ¶‰åŠã€‚&lt;/p&gt;
&lt;h3&gt;æ²¿è¢­çš„ä¾‹å­&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨DuckDuckGoï¼ˆDDGï¼‰ä¸­æœç´¢â€œPythonå¤šçº¿ç¨‹æ•™ç¨‹â€ï¼Œç®€å•è°ƒæŸ¥ä¸€ä¸‹æ’åœ¨å‰é¢çš„ç»“æœï¼Œå°±ä¼šå‘ç°å®ƒä»¬ç»™å‡ºçš„éƒ½æ˜¯åŒæ ·åŸºäºClass + Queueçš„ç¤ºä¾‹ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;em&gt;ä»‹ç»threading/multiprocessingã€ç”Ÿäº§è€…/æ¶ˆè´¹è€…çš„çœŸå®ç¤ºä¾‹ä»£ç ï¼š&lt;/em&gt;&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;# coding: utf-8
# Example.py
&amp;amp;apos;&amp;amp;apos;&amp;amp;apos;
æ ‡å‡†çš„å¤šçº¿ç¨‹ç”Ÿäº§è€…/æ¶ˆè´¹è€…æ¨¡å¼
&amp;amp;apos;&amp;amp;apos;&amp;amp;apos;

import time 
import threading 
import Queue 

class Consumer(threading.Thread): 
  def __init__(self, queue): 
    threading.Thread.__init__(self)
    self._queue = queue 

  def run(self):
    while True: 
      # queue.get() ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°è·å–åˆ°ä¸€ä¸ªæ•°æ®é¡¹
      msg = self._queue.get() 
      # æ£€æŸ¥å½“å‰æ¶ˆæ¯æ˜¯å¦æ˜¯ä¸ªâ€œæ¯’è¯ä¸¸â€
      if isinstance(msg, str) and msg == &amp;amp;apos;quit&amp;amp;apos;:
        # å¦‚æœæ˜¯ï¼Œåˆ™é€€å‡ºå¾ªç¯
        break
      # â€œå¤„ç†â€ (è¿™é‡Œæ˜¯æ‰“å°)ä»é˜Ÿåˆ—ä¸­å–å‡ºçš„æ•°æ®é¡¹
      print &amp;amp;quot;I&amp;amp;apos;m a thread, and I received %s!!&amp;amp;quot; % msg
    # æˆ‘å§‹ç»ˆæ˜¯è¿™ä¹ˆçš„å‹å¥½
    print &amp;amp;apos;Bye byes!&amp;amp;apos;


def Producer():
  # Queueç”¨äºåœ¨çº¿ç¨‹ä¹‹é—´å…±äº«æ•°æ®é¡¹
  queue = Queue.Queue()

  # åˆ›å»ºä¸€ä¸ªå·¥ä½œå®ä¾‹
  worker = Consumer(queue)
  # startæ–¹æ³•ä¼šè°ƒç”¨å†…éƒ¨çš„run()æ–¹æ³•æ¥å¼€å¯çº¿ç¨‹
  worker.start() 

  # å˜é‡ï¼Œç”¨äºè¿½è¸ªå¼€å§‹çš„æ—¶é—´
  start_time = time.time() 
  # åœ¨5ç§’ä¹‹å†…
  while time.time() - start_time &amp;amp;lt; 5: 
    # â€œç”Ÿäº§â€ä¸€å—å·¥ä½œï¼Œæ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œç”±æ¶ˆè´¹è€…æ¥å¤„ç†
    queue.put(&amp;amp;apos;something at %s&amp;amp;apos; % time.time())
    # ç¡çœ ä¸€ä¼šå„¿ï¼Œä»¥é¿å…è¿‡å¤šçš„æ¶ˆæ¯
    time.sleep(1)

  # è¿™æ˜¯æ€æ­»çº¿ç¨‹çš„â€œæ¯’è¯ä¸¸â€æ–¹å¼
  queue.put(&amp;amp;apos;quit&amp;amp;apos;)
  # ç­‰å¾…çº¿ç¨‹å…³é—­
  worker.join()


if __name__ == &amp;amp;apos;__main__&amp;amp;apos;:
  Producer()&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å—¯...é—»é—»ï¼Œä»£ç ä¸­ä¸€è‚¡å­Javaçš„æ°”æ¯ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘ä¸æƒ³è®©å¤§å®¶è§‰å¾—å¥½åƒæˆ‘è®¤ä¸ºç”Ÿäº§è€…/æ¶ˆè´¹è€…æ˜¯å¤„ç†çº¿ç¨‹/å¤šè¿›ç¨‹çš„é”™è¯¯æ–¹å¼ - å› ä¸ºç¡®å®ä¸æ˜¯ã€‚å®é™…ä¸Šï¼Œå¯¹å¤šç§é—®é¢˜æ¥è¯´ï¼Œè¿™ç§æ–¹å¼éå¸¸é€‚åˆã€‚ç„¶è€Œï¼Œæˆ‘è®¤ä¸ºï¼šå¯¹äºæ—¥å¸¸çš„è„šæœ¬ç¨‹åºæ¥è¯´ï¼Œè¿™ç§æ–¹å¼å¹¶éæ˜¯æœ€æœ‰ç”¨çš„ã€‚&lt;/p&gt;
&lt;h3&gt;é—®é¢˜ï¼ˆæˆ‘è®¤ä¸ºçš„ï¼‰&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å…¶ä¸€ï¼Œä¸ºäº†åšç‚¹æœ‰ç”¨çš„äº‹æƒ…ï¼Œä½ å¾—æä¸€ä¸ªå…¬å¼åŒ–çš„ç±»ï¼›å…¶äºŒï¼Œä½ å¾—ç»´æŠ¤ä¸€ä¸ªé˜Ÿåˆ—ï¼ˆQueueï¼‰ï¼Œç”¨äºä¼ é€å¯¹è±¡ï¼›è¿™äº›é½å¤‡ä¹‹åï¼Œåœ¨é˜Ÿåˆ—ç®¡é“çš„ä¸¤ç«¯è¿˜å¾—å‡†å¤‡æ–¹æ³•æ¥åšçœŸæ­£çš„å·¥ä½œï¼ˆå¦‚æœå¸Œæœ›æœ‰ä¸¤ç§æ–¹å¼æ¥é€šä¿¡æˆ–è€…å‡†å¤‡å­˜å‚¨ç»“æœï¼Œå¯èƒ½è¿˜å¾—å¼•å…¥å¦ä¸€ä¸ªé˜Ÿåˆ—ï¼‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;æ›´å¤šçš„å·¥ä½œè€…ï¼Œæ›´å¤šçš„é—®é¢˜&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åŸºäºæ­¤ï¼Œä¸‹ä¸€ä»¶ä½ æƒ³è¦åšçš„äº‹æƒ…å°±æ˜¯æä¸€ä¸ªå·¥ä½œè€…ç±»çš„æ± ï¼Œæ¥åŠ é€Ÿä½ çš„Pythonç¨‹åºã€‚åœ¨å…³äºçº¿ç¨‹çš„IBMæ•™ç¨‹ä¸­ï¼Œç»™å‡ºäº†ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œä»¥ä¸‹æ˜¯å…¶å˜ç§ã€‚è¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„åº”ç”¨åœºæ™¯ - åœ¨å¤šä¸ªçº¿ç¨‹ä¸Šåˆ†é…è·å–ç½‘é¡µçš„ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;# coding: utf-8
# Example2.py
&amp;amp;apos;&amp;amp;apos;&amp;amp;apos;
ä¸€ä¸ªæ›´åŠ å®é™…çš„çº¿ç¨‹æ± ç¤ºä¾‹
&amp;amp;apos;&amp;amp;apos;&amp;amp;apos;

import time 
import threading 
import Queue 
import urllib2 

class Consumer(threading.Thread): 
  def __init__(self, queue): 
    threading.Thread.__init__(self)
    self._queue = queue 

  def run(self):
    while True: 
      content = self._queue.get() 
      if isinstance(content, str) and content == &amp;amp;apos;quit&amp;amp;apos;:
        break
      response = urllib2.urlopen(content)
    print &amp;amp;apos;Bye byes!&amp;amp;apos;


def Producer():
  urls = [
    &amp;amp;apos;http://www.python.org&amp;amp;apos;, &amp;amp;apos;http://www.yahoo.com&amp;amp;apos;
    &amp;amp;apos;http://www.scala.org&amp;amp;apos;, &amp;amp;apos;http://www.google.com&amp;amp;apos;
    # ç­‰ç­‰... 
  ]
  queue = Queue.Queue()
  worker_threads = build_worker_pool(queue, 4)
  start_time = time.time()

  # åŠ å…¥å¾…å¤„ç†çš„URL
  for url in urls: 
    queue.put(url)
  # åŠ å…¥æ¯’è¯ä¸¸
  for worker in worker_threads:
    queue.put(&amp;amp;apos;quit&amp;amp;apos;)
  for worker in worker_threads:
    worker.join()

  print &amp;amp;apos;Done! Time taken: {}&amp;amp;apos;.format(time.time() - start_time)

def build_worker_pool(queue, size):
  workers = []
  for _ in range(size):
    worker = Consumer(queue)
    worker.start() 
    workers.append(worker)
  return workers

if __name__ == &amp;amp;apos;__main__&amp;amp;apos;:
  Producer()&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¥æ•ˆäº†ï¼Œä½†æ˜¯ä½ çœ‹çœ‹è¿™äº›ä»£ç ï¼å‡†å¤‡ï¼ˆsetupï¼‰æ–¹æ³•ã€ä¸€ç»„è¦è¿½è¸ªçš„çº¿ç¨‹ï¼Œæœ€ç³Ÿç³•çš„æ˜¯ï¼Œè‹¥æœ‰ä»»ä½•åœ°æ–¹æ˜“å‘ç”Ÿæ­»é”ï¼Œå°±ä¼šäº§ç”Ÿä¸€å †çš„joinçŠ¶æ€è¯´æ˜ã€‚è‡ªæ­¤ï¼Œä¸€åˆ‡åªä¼šæ›´å¤æ‚ï¼&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå®Œæˆäº†äº›ä»€ä¹ˆï¼Ÿå•¥éƒ½æ²¡æœ‰ã€‚ä¸Šé¢çš„ä»£ç çº¯ç²¹åªæ˜¯æŠŠæ‰€æœ‰ä¸œè¥¿åƒç”¨çº¸ç³Šèµ·æ¥ä¸€æ ·ï¼ˆJust about everything in the above code is pure plumbingï¼Œå¦‚ä½•ç¿»è¯‘ï¼Ÿï¼‰ã€‚è¿™æ˜¯å¦ä¸€ç§å…¬å¼åŒ–çš„å†™æ³•ï¼Œä¹Ÿæ˜“å‘ç”Ÿé”™è¯¯ï¼ˆå˜¿ï¼Œåœ¨å†™è¿™ä¸ªä»£ç æ—¶ï¼Œæˆ‘ç”šè‡³å¿˜äº†åœ¨é˜Ÿåˆ—å¯¹è±¡ä¸Šè°ƒç”¨task_done()ï¼ˆæˆ‘æ‡’å¾—å»è§£å†³è¿™ä¸ªé—®é¢˜ç„¶åå†æä¸ªæˆªå›¾ï¼‰ï¼‰ï¼Œä»˜å‡ºå¾ˆå¤šï¼Œå¾—åˆ°çš„å´å¾ˆå°‘ã€‚å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬æœ‰æ›´å¥½çš„æ–¹å¼ã€‚&lt;/p&gt;
&lt;h2&gt;å¼•å…¥ï¼šMap&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Mapæ˜¯ä¸€ä¸ªé…·é…·çš„å°ä¸œè¥¿ï¼Œä¹Ÿæ˜¯åœ¨Pythonä»£ç è½»æ¾å¼•å…¥å¹¶è¡Œçš„å…³é”®ã€‚å¯¹æ­¤ä¸ç†Ÿæ‚‰çš„äººä¼šè®¤ä¸ºmapæ˜¯ä»å‡½æ•°å¼è¯­è¨€ï¼ˆå¦‚Lispï¼‰å€Ÿé‰´æ¥çš„ä¸œè¥¿ã€‚mapæ˜¯ä¸€ä¸ªå‡½æ•° - å°†å¦ä¸€ä¸ªå‡½æ•°æ˜ å°„åˆ°ä¸€ä¸ªåºåˆ—ä¸Šã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;urls = [&amp;amp;apos;http://www.yahoo.com&amp;amp;apos;, &amp;amp;apos;http://www.reddit.com&amp;amp;apos;]
results = map(urllib2.urlopen, urls)&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™æ®µä»£ç åœ¨ä¼ å…¥åºåˆ—çš„æ¯ä¸ªå…ƒç´ ä¸Šåº”ç”¨æ–¹æ³•&lt;em&gt;urlopen&lt;/em&gt;ï¼Œå¹¶å°†æ‰€æœ‰ç»“æœå­˜å…¥ä¸€ä¸ªåˆ—è¡¨ä¸­ã€‚å¤§è‡´ä¸ä¸‹é¢è¿™æ®µä»£ç çš„é€»è¾‘ç›¸å½“ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;results = []
for url in urls: 
    results.append(urllib2.urlopen(url))&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Mapä¼šä¸ºæˆ‘ä»¬å¤„ç†åœ¨åºåˆ—ä¸Šçš„è¿­ä»£ï¼Œåº”ç”¨å‡½æ•°ï¼Œæœ€åå°†ç»“æœå­˜å…¥ä¸€ä¸ªæ–¹ä¾¿ä½¿ç”¨çš„åˆ—è¡¨ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸ºä»€ä¹ˆé‡è¦å‘¢ï¼Ÿå› ä¸ºåˆ©ç”¨æ°å½“çš„åº“ï¼Œmapè®©å¹¶è¡Œå¤„ç†æˆä¸ºå°äº‹ä¸€æ¡©ï¼&lt;/p&gt;
&lt;img src=&apos;https://i.loli.net/2020/06/14/kqumnip3B7M2dcQ.png&apos; title=&apos;map-function&apos; alt=&apos;map-function&apos; width=&apos;600&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Pythonæ ‡å‡†åº“ä¸­&lt;em&gt;multiprocessing&lt;/em&gt;æ¨¡å—ï¼Œä»¥åŠæå°‘äººçŸ¥ä½†åŒæ ·å‡ºè‰²çš„å­æ¨¡å—&lt;em&gt;multiprocessing.dummy&lt;/em&gt;ï¼Œæä¾›äº†mapå‡½æ•°çš„å¹¶è¡Œç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é¢˜å¤–è¯ï¼šè¿™æ˜¯å•¥ï¼Ÿä½ ä»æœªå¬è¯´è¿‡è¿™åä¸ºdummyçš„mulprocessingæ¨¡å—çš„çº¿ç¨‹å…‹éš†ç‰ˆæœ¬ï¼Ÿæˆ‘ä¹Ÿæ˜¯æœ€è¿‘æ‰çŸ¥é“çš„ã€‚åœ¨multiprocessingæ–‡æ¡£é¡µä¸­ä»…æœ‰ä¸€å¥æåˆ°è¿™ä¸ªå­æ¨¡å—ï¼Œè€Œè¿™å¥è¯åŸºæœ¬å¯ä»¥å½’ç»“ä¸ºâ€œå“¦ï¼Œæ˜¯çš„ï¼Œå­˜åœ¨è¿™æ ·ä¸€ä¸ªä¸œè¥¿â€ã€‚å®Œå…¨ä½ä¼°äº†è¿™ä¸ªæ¨¡å—çš„ä»·å€¼ï¼&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Dummyæ˜¯multiprocessingæ¨¡å—çš„ç²¾ç¡®å…‹éš†ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼šmultiprocessingåŸºäºè¿›ç¨‹å·¥ä½œï¼Œè€Œdummyæ¨¡å—ä½¿ç”¨çº¿ç¨‹ï¼ˆä¹Ÿå°±å¸¦æ¥äº†å¸¸è§çš„Pythoné™åˆ¶ï¼‰ã€‚å› æ­¤ï¼Œä»»ä½•ä¸œè¥¿å¯å¥—ç”¨åˆ°ä¸€ä¸ªæ¨¡å—ï¼Œä¹Ÿå°±å¯ä»¥å¥—ç”¨åˆ°å¦ä¸€ä¸ªæ¨¡å—ã€‚åœ¨ä¸¤ä¸ªæ¨¡å—ä¹‹é—´æ¥å›åˆ‡æ¢ä¹Ÿå°±ç›¸å½“å®¹æ˜“ï¼Œå½“ä½ ä¸å¤ªç¡®å®šä¸€äº›æ¡†æ¶è°ƒç”¨æ˜¯IOå¯†é›†å‹è¿˜æ˜¯CPUå¯†é›†å‹æ—¶ï¼Œæƒ³åšæ¢ç´¢æ€§è´¨çš„ç¼–ç¨‹ï¼Œè¿™ä¸€ç‚¹ä¼šè®©ä½ è§‰å¾—éå¸¸èµï¼&lt;/p&gt;
&lt;h3&gt;å¼€å§‹&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸ºäº†è®¿é—®mapå‡½æ•°çš„å¹¶è¡Œç‰ˆæœ¬ï¼Œé¦–å…ˆéœ€è¦å¯¼å…¥åŒ…å«å®ƒçš„æ¨¡å—ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;# ä»¥ä¸‹ä¸¤è¡Œå¼•å…¥å…¶ä¸€å³å¯
from multiprocessing import Pool
from multiprocessing.dummy import Pool as ThreadPool&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¹¶å®ä¾‹åŒ–æ± å¯¹è±¡ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;# è¯‘æ³¨ï¼šè¿™é‡Œå…¶å®æ˜¯ä»¥dummyæ¨¡å—ä¸ºä¾‹
pool = ThreadPool()&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸€å¥ä»£ç å¤„ç†äº†example2.pyä¸­7è¡Œçš„&lt;em&gt;build_worker_pool&lt;/em&gt;å‡½æ•°å®Œæˆçš„æ‰€æœ‰äº‹æƒ…ã€‚å¦‚åæ‰€ç¤ºï¼Œè¿™å¥ä»£ç ä¼šåˆ›å»ºä¸€ç»„å¯ç”¨çš„å·¥ä½œè€…ï¼Œå¯åŠ¨å®ƒä»¬æ¥å‡†å¤‡å·¥ä½œï¼Œå¹¶å°†å®ƒä»¬å­˜å…¥å˜é‡ä¸­ï¼Œæ–¹ä¾¿è®¿é—®ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;poolå¯¹è±¡å¯ä»¥æœ‰è‹¥å¹²å‚æ•°ï¼Œä½†ç›®å‰ï¼Œåªéœ€å…³æ³¨ç¬¬ä¸€ä¸ªï¼šè¿›ç¨‹/çº¿ç¨‹æ•°é‡ã€‚è¿™ä¸ªå‚æ•°ç”¨äºè®¾ç½®æ± ä¸­çš„å·¥ä½œè€…æ•°ç›®ã€‚å¦‚æœç•™ç©ºï¼Œé»˜è®¤ä¸ºæœºå™¨çš„CPUæ ¸æ•°ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä¸ºCPUå¯†é›†å‹ä»»åŠ¡ä½¿ç”¨è¿›ç¨‹æ± ï¼ˆmultiprocessing poolï¼‰ï¼Œæ›´å¤šçš„æ ¸ç­‰äºæ›´å¿«çš„é€Ÿåº¦ï¼ˆä½†æœ‰ä¸€äº›æ³¨æ„äº‹é¡¹ï¼‰ã€‚ç„¶è€Œï¼Œå½“ä½¿ç”¨çº¿ç¨‹æ± ï¼ˆthreadingï¼‰å¤„ç†ç½‘ç»œå¯†é›†å‹ä»»åŠ¡æ—¶ï¼Œæƒ…å†µå°±å¾ˆä¸ä¸€æ ·äº†ï¼Œå› æ­¤æœ€å¥½è¯•éªŒä¸€ä¸‹æ± çš„æœ€ä½³å¤§å°ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;pool = ThreadPool(4) # å°†æ± çš„å¤§å°è®¾ç½®ä¸º4&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœè¿è¡Œäº†è¿‡å¤šçš„çº¿ç¨‹ï¼Œå°±ä¼šæµªè´¹æ—¶é—´åœ¨çº¿ç¨‹åˆ‡æ¢ä¸Šï¼Œè€Œä¸æ˜¯åšæœ‰ç”¨çš„äº‹æƒ…ï¼Œæ‰€ä»¥å¯ä»¥æŠŠç©æŠŠç©ç›´åˆ°æ‰¾åˆ°æœ€é€‚åˆä»»åŠ¡çš„çº¿ç¨‹æ•°é‡ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç°åœ¨æ± å¯¹è±¡åˆ›å»ºå¥½äº†ï¼Œç®€å•çš„å¹¶è¡Œä¹Ÿæ˜¯å¼¹æŒ‡ä¹‹é—´çš„äº‹æƒ…äº†ï¼Œé‚£æ¥é‡å†™example2.pyå§ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;import urllib2 
from multiprocessing.dummy import Pool as ThreadPool 

urls = [
  &amp;amp;apos;http://www.python.org&amp;amp;apos;, 
  &amp;amp;apos;http://www.python.org/about/&amp;amp;apos;,
  &amp;amp;apos;http://www.onlamp.com/pub/a/python/2003/04/17/metaclasses.html&amp;amp;apos;,
  &amp;amp;apos;http://www.python.org/doc/&amp;amp;apos;,
  &amp;amp;apos;http://www.python.org/download/&amp;amp;apos;,
  &amp;amp;apos;http://www.python.org/getit/&amp;amp;apos;,
  &amp;amp;apos;http://www.python.org/community/&amp;amp;apos;,
  &amp;amp;apos;https://wiki.python.org/moin/&amp;amp;apos;,
  &amp;amp;apos;http://planet.python.org/&amp;amp;apos;,
  &amp;amp;apos;https://wiki.python.org/moin/LocalUserGroups&amp;amp;apos;,
  &amp;amp;apos;http://www.python.org/psf/&amp;amp;apos;,
  &amp;amp;apos;http://docs.python.org/devguide/&amp;amp;apos;,
  &amp;amp;apos;http://www.python.org/community/awards/&amp;amp;apos;
  # ç­‰ç­‰...
  ]

# åˆ›å»ºä¸€ä¸ªå·¥ä½œè€…çº¿ç¨‹æ± 
pool = ThreadPool(4) 
# åœ¨å„ä¸ªçº¿ç¨‹ä¸­æ‰“å¼€urlï¼Œå¹¶è¿”å›ç»“æœ
results = pool.map(urllib2.urlopen, urls)
#close the pool and wait for the work to finish
# å…³é—­çº¿ç¨‹æ± ï¼Œç­‰å¾…å·¥ä½œç»“æŸ
pool.close() 
pool.join()&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;çœ‹çœ‹ï¼çœŸæ­£åšäº‹æƒ…çš„ä»£ç ä»…æœ‰4è¡Œï¼Œå…¶ä¸­3è¡Œåªæ˜¯ç®€å•çš„è¾…åŠ©åŠŸèƒ½ã€‚&lt;em&gt;map&lt;/em&gt;è°ƒç”¨è½»æ¾æå®šäº†ä¹‹å‰ç¤ºä¾‹40è¡Œä»£ç åšçš„äº‹æƒ…ï¼è§‰å¾—å¥½ç©ï¼Œæˆ‘å¯¹ä¸¤ç§æ–¹å¼è¿›è¡Œäº†æ—¶é—´æµ‹é‡ï¼Œå¹¶ä½¿ç”¨äº†ä¸åŒçš„æ± å¤§å°ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;# è¯‘æ³¨ï¼šæˆ‘è§‰å¾—ä¸ä¸²è¡Œå¤„ç†æ–¹å¼å¯¹æ¯”æ„ä¹‰ä¸å¤§ï¼Œåº”è¯¥å’Œé˜Ÿåˆ—çš„æ–¹å¼è¿›è¡Œæ€§èƒ½å¯¹æ¯”
results = [] 
for url in urls:
  result = urllib2.urlopen(url)
  results.append(result)

# # ------- å¯¹æ¯” ------- # 


# # ------- æ± çš„å¤§å°ä¸º4 ------- # 
pool = ThreadPool(4) 
results = pool.map(urllib2.urlopen, urls)

# # ------- æ± çš„å¤§å°ä¸º8 ------- # 

pool = ThreadPool(8) 
results = pool.map(urllib2.urlopen, urls)

# # ------- æ± çš„å¤§å°ä¸º13 ------- # 

pool = ThreadPool(13) 
results = pool.map(urllib2.urlopen, urls)&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç»“æœï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;å•çº¿ç¨‹: 14.4 ç§’
æ± å¤§å°ä¸º4æ—¶ï¼š3.1 ç§’
æ± å¤§å°ä¸º8æ—¶ï¼š1.4 ç§’
æ± å¤§å°ä¸º13æ—¶ï¼š1.3ç§’&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;çœŸæ˜¯å‘±å‘±å«å•Šï¼ä¹Ÿè¯´æ˜äº†è¯•éªŒä¸åŒçš„æ± å¤§å°æ˜¯æœ‰å¿…è¦çš„ã€‚åœ¨æˆ‘çš„æœºå™¨ä¸Šï¼Œæ± çš„å¤§å°å¤§äº9åä¼šå¯¼è‡´æ€§èƒ½é€€åŒ–ï¼ˆè¯‘æ³¨ï¼šå’¦ï¼Œç»“æœä¸æ˜¯æ˜¾ç¤º13æ¯”8çš„æ€§èƒ½è¦å¥½ä¹ˆï¼Ÿï¼‰ã€‚&lt;/p&gt;
&lt;h2&gt;ç°å®ä¸­çš„Example 2&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸ºåƒå¼ å›¾ç‰‡åˆ›å»ºç¼©ç•¥å›¾ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ¥åšç‚¹CPUå¯†é›†å‹çš„äº‹æƒ…ï¼å¯¹äºæˆ‘ï¼Œåœ¨å·¥ä½œä¸­å¸¸è§çš„ä»»åŠ¡æ˜¯æ“ä½œå¤§é‡çš„å›¾ç‰‡ç›®å½•ã€‚å…¶ä¸­ä¸€ç§å›¾ç‰‡è½¬æ¢æ˜¯åˆ›å»ºç¼©ç•¥å›¾ã€‚è¿™é¡¹å·¥ä½œé€‚äºå¹¶è¡Œå¤„ç†ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;åŸºæœ¬çš„å•è¿›ç¨‹è®¾ç½®&lt;/strong&gt;&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;from multiprocessing import Pool 
from PIL import Image

SIZE = (75,75)
SAVE_DIRECTORY = &amp;amp;apos;thumbs&amp;amp;apos;

def get_image_paths(folder):
  return (os.path.join(folder, f) 
      for f in os.listdir(folder) 
      if &amp;amp;apos;jpeg&amp;amp;apos; in f)

def create_thumbnail(filename): 
  im = Image.open(filename)
  im.thumbnail(SIZE, Image.ANTIALIAS)
  base, fname = os.path.split(filename) 
  save_path = os.path.join(base, SAVE_DIRECTORY, fname)
  im.save(save_path)

if __name__ == &amp;amp;apos;__main__&amp;amp;apos;:
  folder = os.path.abspath(
    &amp;amp;apos;11_18_2013_R000_IQM_Big_Sur_Mon__e10d1958e7b766c3e840&amp;amp;apos;)
  os.mkdir(os.path.join(folder, SAVE_DIRECTORY))

  images = get_image_paths(folder)

  for image in images: 
    create_thumbnail(image)&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç¤ºä¾‹ä»£ç ä¸­ç”¨äº†ä¸€äº›æŠ€å·§ï¼Œä½†å¤§ä½“ä¸Šæ˜¯ï¼šå‘ç¨‹åºä¼ å…¥ä¸€ä¸ªç›®å½•ï¼Œä»ç›®å½•ä¸­è·å–æ‰€æœ‰å›¾ç‰‡ï¼Œç„¶ååˆ›å»ºç¼©ç•¥å›¾ï¼Œå¹¶å°†ç¼©ç•¥å›¾å­˜æ”¾åˆ°å„è‡ªçš„ç›®å½•ä¸­ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨æˆ‘çš„æœºå™¨ä¸Šï¼Œè¿™ä¸ªç¨‹åºå¤„ç†å¤§çº¦6000å¼ å›¾ç‰‡ï¼ŒèŠ±è´¹27.9ç§’ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœä½¿ç”¨ä¸€ä¸ªå¹¶è¡Œçš„mapè°ƒç”¨æ¥æ›¿æ¢&lt;em&gt;for&lt;/em&gt;å¾ªç¯ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;from multiprocessing import Pool 
from PIL import Image

SIZE = (75,75)
SAVE_DIRECTORY = &amp;amp;apos;thumbs&amp;amp;apos;

def get_image_paths(folder):
  return (os.path.join(folder, f) 
      for f in os.listdir(folder) 
      if &amp;amp;apos;jpeg&amp;amp;apos; in f)

def create_thumbnail(filename): 
  im = Image.open(filename)
  im.thumbnail(SIZE, Image.ANTIALIAS)
  base, fname = os.path.split(filename) 
  save_path = os.path.join(base, SAVE_DIRECTORY, fname)
  im.save(save_path)

if __name__ == &amp;amp;apos;__main__&amp;amp;apos;:
  folder = os.path.abspath(
    &amp;amp;apos;11_18_2013_R000_IQM_Big_Sur_Mon__e10d1958e7b766c3e840&amp;amp;apos;)
  os.mkdir(os.path.join(folder, SAVE_DIRECTORY))

  images = get_image_paths(folder)

  pool = Pool()
  pool.map(create_thumbnail, images)
  pool.close() 
  pool.join()&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;5.6ç§’ï¼&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä»…ä¿®æ”¹å‡ è¡Œä»£ç å°±èƒ½å¾—åˆ°å·¨å¤§çš„é€Ÿåº¦æå‡ã€‚è¿™ä¸ªç¨‹åºçš„ç”Ÿäº§ç¯å¢ƒç‰ˆæœ¬é€šè¿‡åˆ‡åˆ†CPUå¯†é›†å‹å·¥ä½œå’ŒIOå¯†é›†å‹å·¥ä½œå¹¶åˆ†é…åˆ°å„è‡ªçš„è¿›ç¨‹å’Œçº¿ç¨‹ï¼ˆé€šå¸¸æ˜¯æ­»é”ä»£ç çš„ä¸€ä¸ªå› ç´ ï¼‰ï¼Œè·å¾—æ›´å¿«çš„é€Ÿåº¦ã€‚ç„¶è€Œï¼Œç”±äºmapæ€§è´¨æ¸…æ™°æ˜ç¡®ï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†çº¿ç¨‹ï¼Œä»¥å¹²å‡€ã€å¯é ã€æ˜“äºè°ƒè¯•çš„æ–¹å¼æ··åˆåŒ¹é…ä¸¤è€…ï¼ˆè¯‘æ³¨ï¼šè¿™é‡Œçš„â€œä¸¤è€…â€æ˜¯æŒ‡ä»€ä¹ˆï¼ŸCPUå¯†é›†å‹å·¥ä½œå’ŒIOå¯†é›†å‹å·¥ä½œï¼Ÿï¼‰ï¼Œä¹Ÿæ˜¯ç›¸å½“å®¹æ˜“çš„ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å°±æ˜¯è¿™æ ·äº†ã€‚ï¼ˆå‡ ä¹ï¼‰ä¸€è¡Œå¼å¹¶è¡Œè§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;</description>
            <pubDate>2015-09-11</pubDate>
            <link>https://blog.xiayf.cn/posts/parallelism-in-one-line.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/parallelism-in-one-line.html</guid>
        </item>
        
        <item>
            <title>ç¼–ç¨‹åè¨€é›†é”¦ï¼ˆè¯‘ï¼‰</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;åŸæ–‡ï¼š&lt;a href=&apos;http://quotes.cat-v.org/programming/&apos;&gt;Programming Quotes&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¯‘è€…ï¼š&lt;a href=&apos;https://github.com/youngsterxyf&apos;&gt;youngsterxyf&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;C.A.R. Hoare, The 1980 ACM Turing Award Lecture&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;There are two ways of constructing a software design: One way is to make it so simple that there are obviously no deficiencies and the other way is to make it so complicated that there are no obvious deficiencies.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ‰ä¸¤ç§è½¯ä»¶è®¾è®¡çš„æ–¹å¼ï¼šä¸€ç§æ˜¯ä½¿å®ƒè¶³å¤Ÿç®€å•ä»¥è‡´äºæ˜æ˜¾æ²¡æœ‰ç¼ºé™·ï¼Œå¦ä¸€ç§åˆ™æ˜¯ä½¿å®ƒè¶³å¤Ÿå¤æ‚ä»¥è‡´äºæ²¡æœ‰æ˜æ˜¾çš„ç¼ºé™·ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;E.W.Dijkstra&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;The computing scientist&apos;s main challenge is not to get confused by the complexities of his own making.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è®¡ç®—ç§‘å­¦å®¶çš„ä¸»è¦æŒ‘æˆ˜æ˜¯ä¸è¦è¢«ä»–è‡ªå·±é€ æˆçš„å¤æ‚æ€§æç³Šæ¶‚äº†ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;Gordon Bell&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;The cheapest, fastest, and most reliable components are those that aren&apos;t there.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ€å»‰ä»·ï¼Œæœ€å¿«é€Ÿï¼Œå¹¶ä¸”æœ€å¯é çš„éƒ¨ä»¶æ˜¯é‚£äº›è¿˜æ²¡è¢«ä½¿ç”¨çš„ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;&lt;li&gt;&lt;a href=&apos;http://genius.cat-v.org/ken-thompson/&apos;&gt;Ken Thompson&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;One of my most productive days was throwing away 1000 lines of code.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘æœ€å¤šäº§çš„ä¸€å¤©æŠ›å¼ƒäº†1000è¡Œä»£ç ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;&lt;li&gt;&lt;a href=&apos;http://genius.cat-v.org/ken-thompson/&apos;&gt;Ken Thompson&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;When in doubt, use brute force.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è‹¥æ— æŠŠæ¡ï¼Œæš´åŠ›ç ´è§£ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;Jeff Sickel&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;Deleted code is debugged code.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;éœ€è¦è°ƒè¯•çš„ä»£ç éƒ½åº”è¯¥åˆ é™¤ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;Brian W. Kernighan, P. J. Plauger&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;Debugging is twice as hard as writing the code in the first place. Therefore, if you write the code as cleverly as possible, you are, by definition, not smart enough to debug it.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è°ƒè¯•çš„éš¾åº¦ä¸¤å€äºä¸€å¼€å§‹çš„å†™ä»£ç ã€‚å› æ­¤ï¼Œå¦‚æœä½ å°½å¯èƒ½å·§å¦™åœ°ç¼–å†™ä»£ç ï¼Œæ ¹æ®å®šä¹‰ï¼Œè¯´æ˜ä½ è¿˜ä¸å…·å¤‡è¶³å¤Ÿçš„æ™ºå•†æ¥è°ƒè¯•å®ƒã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;Brian W. Kernighan&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;The most effective debugging tool is still careful thought, coupled with judiciously placed print statements.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ€æœ‰æ•ˆçš„è°ƒè¯•å·¥å…·æ˜¯é™ä¸‹å¿ƒæ¥ä»”ç»†æ€è€ƒï¼Œè¾…ä¹‹å®¡æ…åœ°æ”¾ç½®æ‰“å°è¯­å¥ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;Brian W. Kernighan&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;Controlling complexity is the essence of computer programming.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è®¡ç®—æœºç¼–ç¨‹çš„æœ¬è´¨æ˜¯æ§åˆ¶å¤æ‚åº¦ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;David Gelernter&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;Beauty is more important in computing than anywhere else in technology because software is so complicated. Beauty is the ultimate defence against complexity.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç›¸æ¯”å…¶ä»–æŠ€æœ¯é¢†åŸŸï¼Œç¾å¯¹äºè®¡ç®—æ¥è¯´æ›´ä¸ºé‡è¦ï¼Œå› ä¸ºè½¯ä»¶è¶…ä¹å¯»å¸¸çš„å¤æ‚ï¼Œè€Œç¾æ˜¯å¯¹å¤æ‚æ€§çš„ä¸€ç§ç»ˆæé˜²å¾¡ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;Doug Gwyn&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;UNIX was not designed to stop its users from doing stupid things, as that would also stop them from doing clever things.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;UNIXå¹¶ä¸ä¼šé˜»æ­¢ç”¨æˆ·å¹²è ¢äº‹ï¼Œå› ä¸ºé‚£æ ·ä¹Ÿä¼šé˜»ç¢ç”¨æˆ·åšäº›èªæ˜çš„äº‹æƒ…ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;John Carmack&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;If you&apos;re willing to restrict the flexibility of your approach, you can almost always do something better.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é™åˆ¶æ–¹æ³•çš„çµæ´»æ€§å‡ ä¹æ€»ä¼šè®©ä½ æŠŠäº‹æƒ…åšå¾—æ›´å¥½ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;John Osterhout&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;A program that produces incorrect result twice as fast is infinitely slower.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç»“æœä¸å¯¹ï¼Œç¨‹åºå†å¿«éƒ½é¡¶ä¸ªå±ç”¨ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;Geer et al.&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;The central enemy of reliability is complexity.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯é çš„æœ€å¤§æ•Œäººæ˜¯å¤æ‚ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;Edsger W. Dijkstra&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;Simplicity is prerequisite for reliability.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç®€å•æ˜¯å¯é çš„å…ˆå†³æ¡ä»¶ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;Peter Deutsch&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;The Eight Fallacies of Distributed Computing&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Essentially everyone, when they first build a distributed application, makes the following eight assumptions. All prove to be false in the long run and all cause big trouble and painful learning experiences.&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;1. The network is reliable&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;2. Latency is zero&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;3. Bandwidth is infinite&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;4. The network is secure&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;5. Topology doesn&apos;t change&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;6. There is one administrator&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;7. Transport cost is zero&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;8. The network is homogeneous&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åˆ†å¸ƒå¼è®¡ç®—çš„å…«å¤§è°¬è¯¯&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å®é™…ä¸Šï¼Œæ¯ä¸ªäººï¼Œå½“ä»–ç¬¬ä¸€æ¬¡æ„å»ºåˆ†å¸ƒå¼åº”ç”¨æ—¶ï¼Œéƒ½ä¼šä½œå‡ºå¦‚ä¸‹å…«ä¸ªå‡è®¾ã€‚é•¿è¿œæ¥çœ‹ï¼Œè¿™äº›å‡è®¾éƒ½è¢«è¯æ˜æ˜¯é”™è¯¯çš„ï¼Œå¹¶ä¸”éƒ½é€ æˆäº†å·¨å¤§çš„éº»çƒ¦å’Œæ²‰ç—›çš„ç»éªŒæ•™è®­ã€‚&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;ç½‘ç»œå¯é &lt;/li&gt;
&lt;li&gt;é›¶å»¶è¿Ÿ&lt;/li&gt;
&lt;li&gt;å¸¦å®½æ— é™&lt;/li&gt;
&lt;li&gt;å®‰å…¨ç½‘ç»œ&lt;/li&gt;
&lt;li&gt;æ‹“æ‰‘ä¸å˜&lt;/li&gt;
&lt;li&gt;æœ‰ä¸ªç®¡ç†è€…&lt;/li&gt;
&lt;li&gt;ä¼ è¾“ä»£ä»·ä¸ºé›¶&lt;/li&gt;
&lt;li&gt;ç½‘ç»œåŒæ„&lt;/li&gt;&lt;/ol&gt;
&lt;hr&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;Jon Bentley, Doug Mcllroy&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;The key to performance is elegance, not battalions of special cases.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ€§èƒ½çš„å…³é”®æ˜¯ä¼˜é›…ï¼Œè€Œä¸æ˜¯å¤§å †çš„ç‰¹æ®Šæƒ…å†µã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;Bill Gates&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;Measuring programming progress by lines of code is like measuring aircraft building progress by weight.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä»¥ä»£ç è¡Œæ•°æ¥è¡¡é‡ç¨‹åºè®¾è®¡çš„è¿›åº¦ï¼Œå°±å¥½æ¯”ä»¥é‡é‡æ¥è¡¡é‡é£æœºçš„åˆ¶é€ è¿›åº¦ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;John Johnson&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;First, solve the problem. Then, write the code.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é¦–å…ˆï¼Œè§£å†³é—®é¢˜ã€‚è€Œåï¼Œç¼–å†™ä»£ç ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;Ken Thompson&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;You can&apos;t trust code that you did not totally create yourself.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½ ä¸èƒ½ä¿¡ä»»éä½ å®Œå…¨è‡ªå·±å†™çš„ä»£ç ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;Sean Parent&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;Good code is short, simple, and symmetrical - the challenge is figuring out how to get there.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¥½çš„ä»£ç ï¼ŒçŸ­å°ã€ç®€æ´ï¼Œå¹¶ä¸”åŒ€ç§° - è€ŒçœŸæ­£çš„æŒ‘æˆ˜åœ¨äºå¼„æ¸…å¦‚ä½•è¾¾åˆ°è¿™äº›ç›®æ ‡ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;Voltaire&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;The best is the enemy of the good.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿½æ±‚å®Œç¾æ˜¯ä¼˜ç§€è½¯ä»¶çš„æ•Œäººã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;Dr. Pamela Zave&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;The purpose of software engineering is to control complexity, not to create it.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è½¯ä»¶å·¥ç¨‹çš„ç›®æ ‡æ˜¯æ§åˆ¶å¤æ‚åº¦ï¼Œè€Œä¸æ˜¯å¢åŠ å¤æ‚æ€§ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;Olin Shivers&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;I object to doing things that computers can do.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘åå¯¹å»åšé‚£äº›è®¡ç®—æœºå¯ä»¥åšçš„äº‹æƒ…ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;merb motto&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;No code is faster than no code.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ²¡æœ‰ä»€ä¹ˆä»£ç ä¼šæ¯”æ²¡æœ‰ä»£ç é€Ÿåº¦æ›´å¿«ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;Dave Parnas&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;As a rule, software systems do not work well until they have been used, and have failed repeatedly, in real applications.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸€èˆ¬è¯´æ¥ï¼Œè½¯ä»¶ç³»ç»Ÿåªæœ‰å¾—åˆ°å®é™…åº”ç”¨ï¼Œå¹¶ä¸”ç»å†å¤šæ¬¡å¤±è´¥ï¼Œæ‰èƒ½å·¥ä½œå¾—å¾ˆå¥½ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;RnRS&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;Programming languages should be designed not by piling feature on top of feature, but by removing the weaknesses and restrictions that make additional features appear necessary.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç¨‹åºè¯­è¨€çš„è®¾è®¡ä¸åº”è¯¥æ˜¯ç‰¹æ€§çš„å †å ï¼Œè€Œåº”è¯¥å»é™¤é‚£äº›ä½¿å¾—é¢å¤–çš„ç‰¹æ€§æ˜¾å¾—å¿…è¦çš„å¼±ç‚¹å’Œå±€é™ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;Ryan Singer&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;So much complexity in software comes from trying to make one thing do two things.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è½¯ä»¶ä¸­å¦‚æ­¤å¤šçš„å¤æ‚æ€§çš†æ¥è‡ªäºæƒ³åœ¨åšä¸€ä»¶äº‹çš„åŒæ—¶å¤šåšå‡ ä»¶äº‹ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;em&gt;æœªå®Œå¾…ç»­&lt;/em&gt;&lt;/p&gt;</description>
            <pubDate>2015-06-02</pubDate>
            <link>https://blog.xiayf.cn/posts/programming-quotes.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/programming-quotes.html</guid>
        </item>
        
        <item>
            <title>Goå¹¶å‘ç¼–ç¨‹åŸºç¡€ï¼ˆè¯‘ï¼‰</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;åŸæ–‡ï¼š&lt;a href=&apos;http://www.nada.kth.se/~snilsson/concurrency/&apos;&gt;Fundamentals of concurrent programming&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;è¯‘æ³¨ï¼šåŸæ–‡ç« é“¾æ¥å·²å¤±æ•ˆï¼Œä½œè€…é‡æ–°å†™äº†ä¸€ç¯‡å†…å®¹ç›¸è¿‘çš„æ–‡ç«  &lt;a href=&apos;https://yourbasic.org/golang/concurrent-programming/&apos;&gt;Concurrent programming&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ¬æ–‡æ˜¯ä¸€ç¯‡å¹¶å‘ç¼–ç¨‹æ–¹é¢çš„å…¥é—¨æ–‡ç« ï¼Œä»¥&lt;a href=&apos;http://golang.org/&apos;&gt;Goè¯­è¨€&lt;/a&gt;ç¼–å†™ç¤ºä¾‹ä»£ç ï¼Œå†…å®¹æ¶µç›–ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;è¿è¡ŒæœŸå¹¶å‘çº¿ç¨‹ï¼ˆgoroutinesï¼‰&lt;/li&gt;
&lt;li&gt;åŸºæœ¬çš„åŒæ­¥æŠ€æœ¯ï¼ˆç®¡é“å’Œé”ï¼‰&lt;/li&gt;
&lt;li&gt;Goè¯­è¨€ä¸­åŸºæœ¬çš„å¹¶å‘æ¨¡å¼&lt;/li&gt;
&lt;li&gt;æ­»é”å’Œæ•°æ®ç«äº‰&lt;/li&gt;
&lt;li&gt;å¹¶è¡Œè®¡ç®—&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨å¼€å§‹é˜…è¯»æœ¬æ–‡ä¹‹å‰ï¼Œä½ åº”è¯¥çŸ¥é“å¦‚ä½•ç¼–å†™ç®€å•çš„Goç¨‹åºã€‚å¦‚æœä½ ç†Ÿæ‚‰çš„æ˜¯C/C++ã€Javaæˆ–Pythonä¹‹ç±»çš„è¯­è¨€ï¼Œé‚£ä¹ˆ &lt;a href=&apos;http://tour.golang.org/welcome/1&apos;&gt;Goè¯­è¨€ä¹‹æ—…&lt;/a&gt; èƒ½æä¾›æ‰€æœ‰å¿…è¦çš„èƒŒæ™¯çŸ¥è¯†ã€‚ä¹Ÿè®¸ä½ è¿˜æœ‰å…´è¶£è¯»ä¸€è¯» &lt;a href=&apos;http://code.google.com/p/go-wiki/wiki/GoForCPPProgrammers&apos;&gt;ä¸ºC++ç¨‹åºå‘˜å‡†å¤‡çš„Goè¯­è¨€æ•™ç¨‹&lt;/a&gt; æˆ– &lt;a href=&apos;http://www.nada.kth.se/~snilsson/go_for_java_programmers/&apos;&gt;ä¸ºJavaç¨‹åºå‘˜å‡†å¤‡çš„Goè¯­è¨€æ•™ç¨‹&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3&gt;1. è¿è¡ŒæœŸçº¿ç¨‹&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Goå…è®¸ä½¿ç”¨&lt;code&gt;go&lt;/code&gt;è¯­å¥å¼€å¯ä¸€ä¸ªæ–°çš„è¿è¡ŒæœŸçº¿ç¨‹ï¼Œå³ &lt;a href=&apos;http://golang.org/ref/spec#Go_statements&apos;&gt;goroutine&lt;/a&gt;ï¼Œä»¥ä¸€ä¸ªä¸åŒçš„ã€æ–°åˆ›å»ºçš„goroutineæ¥æ‰§è¡Œä¸€ä¸ªå‡½æ•°ã€‚åŒä¸€ä¸ªç¨‹åºä¸­çš„æ‰€æœ‰goroutineå…±äº«åŒä¸€ä¸ªåœ°å€ç©ºé—´ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Goroutineéå¸¸è½»é‡ï¼Œé™¤äº†ä¸ºä¹‹åˆ†é…çš„æ ˆç©ºé—´ï¼Œå…¶æ‰€å ç”¨çš„å†…å­˜ç©ºé—´å¾®ä¹å…¶å¾®ã€‚å¹¶ä¸”å…¶æ ˆç©ºé—´åœ¨å¼€å§‹æ—¶éå¸¸å°ï¼Œä¹‹åéšç€å †å­˜å‚¨ç©ºé—´çš„æŒ‰éœ€åˆ†é…æˆ–é‡Šæ”¾è€Œå˜åŒ–ã€‚å†…éƒ¨å®ç°ä¸Šï¼Œgoroutineä¼šåœ¨å¤šä¸ªæ“ä½œç³»ç»Ÿçº¿ç¨‹ä¸Šå¤šè·¯å¤ç”¨ã€‚å¦‚æœä¸€ä¸ªgoroutineé˜»å¡äº†ä¸€ä¸ªæ“ä½œç³»ç»Ÿçº¿ç¨‹ï¼Œä¾‹å¦‚ï¼šç­‰å¾…è¾“å…¥ï¼Œè¿™ä¸ªçº¿ç¨‹ä¸Šçš„å…¶ä»–goroutineå°±ä¼šè¿ç§»åˆ°å…¶ä»–çº¿ç¨‹ï¼Œè¿™æ ·èƒ½ç»§ç»­è¿è¡Œã€‚å¼€å‘è€…å¹¶ä¸éœ€è¦å…³å¿ƒ/æ‹…å¿ƒè¿™äº›ç»†èŠ‚ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸‹é¢æ‰€ç¤ºç¨‹åºä¼šè¾“å‡ºâ€œHello from main goroutineâ€ã€‚ä¹Ÿå¯èƒ½ä¼šè¾“å‡ºâ€œHello from another goroutineâ€ï¼Œå…·ä½“ä¾èµ–äºä¸¤ä¸ªgoroutineå“ªä¸ªå…ˆç»“æŸã€‚&lt;/p&gt;
&lt;pre class=&quot;language-golang&quot;&gt;&lt;code&gt;func main() {
    go fmt.Println(&amp;amp;quot;Hello from another goroutine&amp;amp;quot;)
    fmt.Println(&amp;amp;quot;Hello from main goroutine&amp;amp;quot;)

    // è‡³æ­¤ï¼Œç¨‹åºè¿è¡Œç»“æŸï¼Œ
    // æ‰€æœ‰æ´»è·ƒçš„goroutineè¢«æ€æ­»
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ¥ä¸‹æ¥çš„è¿™ä¸ªç¨‹åºï¼Œå¤šæ•°æƒ…å†µä¸‹ï¼Œä¼šè¾“å‡ºâ€œHello from main goroutineâ€å’Œâ€œHello from another goroutineâ€ï¼Œè¾“å‡ºçš„é¡ºåºä¸ç¡®å®šã€‚ä½†è¿˜æœ‰å¦ä¸€ä¸ªå¯èƒ½æ€§æ˜¯ï¼šç¬¬äºŒä¸ªgoroutineè¿è¡Œå¾—æå…¶æ…¢ï¼Œåœ¨ç¨‹åºç»“æŸä¹‹å‰éƒ½æ²¡æ¥å¾—åŠè¾“å‡ºç›¸åº”çš„æ¶ˆæ¯ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-golang&quot;&gt;&lt;code&gt;func main() {
    go fmt.Println(&amp;amp;quot;Hello from another goroutine&amp;amp;quot;)
    fmt.Println(&amp;amp;quot;Hello from main goroutine&amp;amp;quot;)

    time.Sleep(time.Second)        // ç­‰å¾…1ç§’ï¼Œç­‰å¦ä¸€ä¸ªgoroutineç»“æŸ
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸‹é¢åˆ™æ˜¯ä¸€ä¸ªç›¸å¯¹æ›´åŠ å®é™…çš„ç¤ºä¾‹ï¼Œå…¶ä¸­å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°ä½¿ç”¨å¹¶å‘æ¥æ¨è¿Ÿè§¦å‘ä¸€ä¸ªäº‹ä»¶ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-golang&quot;&gt;&lt;code&gt;// å‡½æ•°Publishåœ¨ç»™å®šæ—¶é—´è¿‡æœŸåæ‰“å°textå­—ç¬¦ä¸²åˆ°æ ‡å‡†è¾“å‡º
// è¯¥å‡½æ•°å¹¶ä¸ä¼šé˜»å¡è€Œæ˜¯ç«‹å³è¿”å›
func Publish(text string, delay time.Duration) {
    go func() {
        time.Sleep(delay)
        fmt.Println(&amp;amp;quot;BREAKING NEWS:&amp;amp;quot;, text)
    }()    // æ³¨æ„è¿™é‡Œçš„æ‹¬å·ã€‚å¿…é¡»è°ƒç”¨åŒ¿åå‡½æ•°
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½ å¯èƒ½ä¼šè¿™æ ·ä½¿ç”¨&lt;code&gt;Publish&lt;/code&gt;å‡½æ•°ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-golang&quot;&gt;&lt;code&gt;func main() {
    Publish(&amp;amp;quot;A goroutine starts a new thread of execution.&amp;amp;quot;, 5*time.Second)
    fmt.Println(&amp;amp;quot;Letâ€™s hope the news will published before I leave.&amp;amp;quot;)

    // ç­‰å¾…å‘å¸ƒæ–°é—»
    time.Sleep(10 * time.Second)

    fmt.Println(&amp;amp;quot;Ten seconds later: Iâ€™m leaving now.&amp;amp;quot;)
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸ªç¨‹åºï¼Œç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¼šè¾“å‡ºä»¥ä¸‹ä¸‰è¡Œï¼Œé¡ºåºå›ºå®šï¼Œæ¯è¡Œè¾“å‡ºä¹‹é—´ç›¸éš”5ç§’ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ go run publish1.go
Letâ€™s hope the news will published before I leave.
BREAKING NEWS: A goroutine starts a new thread of execution.
Ten seconds later: Iâ€™m leaving now.&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸€èˆ¬æ¥è¯´ï¼Œé€šè¿‡ç¡çœ çš„æ–¹å¼æ¥ç¼–æ’çº¿ç¨‹ä¹‹é—´ç›¸äº’ç­‰å¾…æ˜¯ä¸å¤ªå¯èƒ½çš„ã€‚ä¸‹ä¸€ç« èŠ‚ä¼šä»‹ç»Goè¯­è¨€ä¸­çš„ä¸€ç§åŒæ­¥æœºåˆ¶ - ç®¡é“ï¼Œå¹¶æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ç®¡é“è®©ä¸€ä¸ªgoroutineç­‰å¾…å¦ä¸€ä¸ªgoroutineã€‚&lt;/p&gt;
&lt;h3&gt;2. ç®¡é“ï¼ˆchannelï¼‰&lt;/h3&gt;
&lt;img src=&apos;https://yourbasic.org/golang/sushi-conveyor-belt.jpg&apos; title=&apos;Sushi conveyor belt&apos; alt=&apos;Sushi conveyor belt&apos; width=&apos;100%&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;a href=&apos;http://golang.org/ref/spec#Channel_types&apos;&gt;ç®¡é“&lt;/a&gt;æ˜¯Goè¯­è¨€çš„ä¸€ä¸ªæ„ä»¶ï¼Œæä¾›ä¸€ç§æœºåˆ¶ç”¨äºä¸¤ä¸ªgoroutineä¹‹é—´é€šè¿‡ä¼ é€’ä¸€ä¸ªæŒ‡å®šç±»å‹çš„å€¼æ¥åŒæ­¥è¿è¡Œå’Œé€šè®¯ã€‚æ“ä½œç¬¦&lt;code&gt;&amp;lt;-&lt;/code&gt;ç”¨äºæŒ‡å®šç®¡é“çš„æ–¹å‘ï¼Œå‘é€æˆ–æ¥æ”¶ã€‚å¦‚æœæœªæŒ‡å®šæ–¹å‘ï¼Œåˆ™ä¸ºåŒå‘ç®¡é“ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-golang&quot;&gt;&lt;code&gt;chan Sushi        // å¯ç”¨æ¥å‘é€å’Œæ¥æ”¶Sushiç±»å‹çš„å€¼
chan&amp;amp;lt;- float64    // ä»…å¯ç”¨æ¥å‘é€float64ç±»å‹çš„å€¼
&amp;amp;lt;-chan int        // ä»…å¯ç”¨æ¥æ¥æ”¶intç±»å‹çš„å€¼&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç®¡é“æ˜¯å¼•ç”¨ç±»å‹ï¼ŒåŸºäºmakeå‡½æ•°æ¥åˆ†é…ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-golang&quot;&gt;&lt;code&gt;ic := make(chan int)    // ä¸å¸¦ç¼“å†²çš„intç±»å‹ç®¡é“
wc := make(chan *Work, 10)    // å¸¦ç¼“å†²çš„Workç±»å‹æŒ‡é’ˆç®¡é“&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœé€šè¿‡ç®¡é“å‘é€ä¸€ä¸ªå€¼ï¼Œåˆ™å°†&lt;code&gt;&amp;lt;-&lt;/code&gt;ä½œä¸ºäºŒå…ƒæ“ä½œç¬¦ä½¿ç”¨ã€‚é€šè¿‡ç®¡é“æ¥æ”¶ä¸€ä¸ªå€¼ï¼Œåˆ™å°†å…¶ä½œä¸ºä¸€å…ƒæ“ä½œç¬¦ä½¿ç”¨ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-golang&quot;&gt;&lt;code&gt;ic &amp;amp;lt;- 3        // å¾€ç®¡é“å‘é€3
work := &amp;amp;lt;-wc    // ä»ç®¡é“æ¥æ”¶ä¸€ä¸ªæŒ‡å‘Workç±»å‹å€¼çš„æŒ‡é’ˆ&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœç®¡é“ä¸å¸¦ç¼“å†²ï¼Œå‘é€æ–¹ä¼šé˜»å¡ç›´åˆ°æ¥æ”¶æ–¹ä»ç®¡é“ä¸­æ¥æ”¶äº†å€¼ã€‚å¦‚æœç®¡é“å¸¦ç¼“å†²ï¼Œå‘é€æ–¹åˆ™ä¼šé˜»å¡ç›´åˆ°å‘é€çš„å€¼è¢«æ‹·è´åˆ°ç¼“å†²åŒºå†…ï¼›å¦‚æœç¼“å†²åŒºå·²æ»¡ï¼Œåˆ™æ„å‘³ç€éœ€è¦ç­‰å¾…ç›´åˆ°æŸä¸ªæ¥æ”¶æ–¹è·å–åˆ°ä¸€ä¸ªå€¼ã€‚æ¥æ”¶æ–¹åœ¨æœ‰å€¼å¯ä»¥æ¥æ”¶ä¹‹å‰ä¼šä¸€ç›´é˜»å¡ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;å…³é—­ç®¡é“ï¼ˆCloseï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;a href=&apos;http://golang.org/ref/spec#Close&apos;&gt;close&lt;/a&gt; å‡½æ•°æ ‡å¿—ç€ä¸ä¼šå†å¾€æŸä¸ªç®¡é“å‘é€å€¼ã€‚åœ¨è°ƒç”¨&lt;code&gt;close&lt;/code&gt;ä¹‹åï¼Œå¹¶ä¸”åœ¨ä¹‹å‰å‘é€çš„å€¼éƒ½è¢«æ¥æ”¶åï¼Œæ¥æ”¶æ“ä½œä¼šè¿”å›ä¸€ä¸ªé›¶å€¼ï¼Œä¸ä¼šé˜»å¡ã€‚ä¸€ä¸ªå¤šè¿”å›å€¼çš„æ¥æ”¶æ“ä½œä¼šé¢å¤–è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ç”¨æ¥æŒ‡ç¤ºè¿”å›çš„å€¼æ˜¯å¦å‘é€æ“ä½œä¼ é€’çš„ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-golang&quot;&gt;&lt;code&gt;ch := make(chan string)
go func() {
    ch &amp;amp;lt;- &amp;amp;quot;Hello!&amp;amp;quot;
    close(ch)
}()
fmt.Println(&amp;amp;lt;-ch)    // è¾“å‡ºå­—ç¬¦ä¸²&amp;amp;quot;Hello!&amp;amp;quot;
fmt.Println(&amp;amp;lt;-ch)    // è¾“å‡ºé›¶å€¼ - ç©ºå­—ç¬¦ä¸²&amp;amp;quot;&amp;amp;quot;ï¼Œä¸ä¼šé˜»å¡
fmt.Println(&amp;amp;lt;-ch)    // å†æ¬¡æ‰“å°è¾“å‡ºç©ºå­—ç¬¦ä¸²&amp;amp;quot;&amp;amp;quot;
v, ok := &amp;amp;lt;-ch        // å˜é‡vçš„å€¼ä¸ºç©ºå­—ç¬¦ä¸²&amp;amp;quot;&amp;amp;quot;ï¼Œå˜é‡okçš„å€¼ä¸ºfalse&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸€ä¸ªå¸¦æœ‰&lt;code&gt;range&lt;/code&gt;å­å¥çš„&lt;code&gt;for&lt;/code&gt;è¯­å¥ä¼šä¾æ¬¡è¯»å–å‘å¾€ç®¡é“çš„å€¼ï¼Œç›´åˆ°è¯¥ç®¡é“å…³é—­ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-golang&quot;&gt;&lt;code&gt;func main() {
    // è¯‘æ³¨ï¼šè¦æƒ³è¿è¡Œè¯¥ç¤ºä¾‹ï¼Œéœ€è¦å…ˆå®šä¹‰ç±»å‹Sushiï¼Œå¦‚type Sushi string
    var ch &amp;amp;lt;-chan Sushi = Producer()
    for s := range ch {
        fmt.Println(&amp;amp;quot;Consumed&amp;amp;quot;, s)
    }
}

func Producer() &amp;amp;lt;-chan Sushi {
    ch := make(chan Sushi)
    go func(){
        ch &amp;amp;lt;- Sushi(&amp;amp;quot;æµ·è€æ¡ã‚Š&amp;amp;quot;)    // Ebi nigiri
        ch &amp;amp;lt;- Sushi(&amp;amp;quot;é®ªã¨ã‚æ¡ã‚Š&amp;amp;quot;) // Toro nigiri
        close(ch)
    }()
    return ch
}&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;3. åŒæ­¥&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸‹ä¸€ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬è®©&lt;code&gt;Publish&lt;/code&gt;å‡½æ•°è¿”å›ä¸€ä¸ªç®¡é“ - ç”¨äºåœ¨å‘å¸ƒtextå˜é‡å€¼æ—¶å¹¿æ’­ä¸€æ¡æ¶ˆæ¯ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-golang&quot;&gt;&lt;code&gt;// åœ¨ç»™å®šæ—¶é—´è¿‡æœŸæ—¶ï¼ŒPublishå‡½æ•°ä¼šæ‰“å°textå˜é‡å€¼åˆ°æ ‡å‡†è¾“å‡º
// åœ¨textå˜é‡å€¼å‘å¸ƒåï¼Œè¯¥å‡½æ•°ä¼šå…³é—­ç®¡é“wait
func Publish(text string, delay time.Duration) (wait &amp;amp;lt;-chan struct{}) {
    ch := make(chan struct{})
    go func() {
        time.Sleep(delay)
        fmt.Println(&amp;amp;quot;BREAKING NEWS:&amp;amp;quot;, text)
        close(ch)    // å¹¿æ’­ - ä¸€ä¸ªå…³é—­çš„ç®¡é“éƒ½ä¼šå‘é€ä¸€ä¸ªé›¶å€¼
    }()
    return ch
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ³¨æ„ï¼šæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªç©ºç»“æ„ä½“çš„ç®¡é“ï¼š&lt;code&gt;struct{}&lt;/code&gt;ã€‚è¿™æ˜ç¡®åœ°æŒ‡æ˜è¯¥ç®¡é“ä»…ç”¨äºå‘ä¿¡å·ï¼Œè€Œä¸æ˜¯ä¼ é€’æ•°æ®ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘ä»¬å¯èƒ½ä¼šè¿™æ ·ä½¿ç”¨è¿™ä¸ªå‡½æ•°ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-golang&quot;&gt;&lt;code&gt;func main() {
    wait := Publish(&amp;amp;quot;Channels let goroutines communicate.&amp;amp;quot;, 5*time.Second)
    fmt.Println(&amp;amp;quot;Waiting for the news...&amp;amp;quot;)
    &amp;amp;lt;-wait
    fmt.Println(&amp;amp;quot;The news is out, time to leave.&amp;amp;quot;)
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸ªç¨‹åºä¼šæŒ‰æŒ‡å®šçš„é¡ºåºè¾“å‡ºä»¥ä¸‹ä¸‰è¡Œå†…å®¹ã€‚æœ€åä¸€è¡Œåœ¨æ–°é—»ï¼ˆnewsï¼‰ä¸€å‡ºå°±ä¼šç«‹å³è¾“å‡ºã€‚&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ go run publish2.go
Waiting for the news...
BREAKING NEWS: Channels let goroutines communicate.
The news is out, time to leave.&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;4. æ­»é”&lt;/h3&gt;
&lt;img src=&apos;https://yourbasic.org/golang/traffic-jam.jpg&apos; title=&apos;traffic jam&apos; alt=&apos;traffic jam&apos; width=&apos;100%&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç°åœ¨æˆ‘ä»¬åœ¨&lt;code&gt;Publish&lt;/code&gt;å‡½æ•°ä¸­å¼•å…¥ä¸€ä¸ªbugï¼š&lt;/p&gt;
&lt;pre class=&quot;language-golang&quot;&gt;&lt;code&gt;func Publish(text string, delay time.Duration) (wait &amp;amp;lt;-chan struct{}) {
    ch := make(chan struct{})
    go func() {
        time.Sleep(delay)
        fmt.Println(&amp;amp;quot;BREAKING NEWS:&amp;amp;quot;, text)
        // è¯‘æ³¨ï¼šæ³¨æ„è¿™é‡Œå°†closeå‡½æ•°è°ƒç”¨æ³¨é‡Šæ‰äº†
        //close(ch)
    }()
    return ch
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸»ç¨‹åºè¿˜æ˜¯åƒä¹‹å‰ä¸€æ ·å¼€å§‹è¿è¡Œï¼šè¾“å‡ºç¬¬ä¸€è¡Œï¼Œç„¶åç­‰å¾…5ç§’ï¼Œè¿™æ—¶&lt;code&gt;Publish&lt;/code&gt;å‡½æ•°å¼€å¯çš„goroutineä¼šè¾“å‡ºçªå‘æ–°é—»ï¼ˆbreaking newsï¼‰ï¼Œç„¶åé€€å‡ºï¼Œç•™ä¸‹ä¸»goroutineç‹¬è‡ªç­‰å¾…ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-golang&quot;&gt;&lt;code&gt;func main() {
    wait := Publish(&amp;amp;quot;Channels let goroutines communicate.&amp;amp;quot;, 5*time.Second)
    fmt.Println(&amp;amp;quot;Waiting for the news...&amp;amp;quot;)
    // è¯‘æ³¨ï¼šæ³¨æ„ä¸‹é¢è¿™ä¸€å¥
    &amp;amp;lt;-wait
    fmt.Println(&amp;amp;quot;The news is out, time to leave.&amp;amp;quot;)
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ­¤åˆ»ä¹‹åï¼Œç¨‹åºæ— æ³•å†ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œè¿™ç§æƒ…å½¢å³ä¸ºæ­»é”ã€‚&lt;/p&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;æ­»é”æ˜¯çº¿ç¨‹ä¹‹é—´ç›¸äº’ç­‰å¾…ï¼Œå…¶ä¸­ä»»ä½•ä¸€ä¸ªéƒ½æ— æ³•å‘å‰è¿è¡Œçš„æƒ…å½¢ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Goè¯­è¨€å¯¹äºè¿è¡Œæ—¶çš„æ­»é”æ£€æµ‹å…·å¤‡è‰¯å¥½çš„æ”¯æŒã€‚å½“æ²¡æœ‰ä»»ä½•goroutineèƒ½å¤Ÿå¾€å‰æ‰§è¡Œçš„æƒ…å½¢å‘ç”Ÿæ—¶ï¼ŒGoç¨‹åºé€šå¸¸ä¼šæä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ã€‚ä»¥ä¸‹å°±æ˜¯æˆ‘ä»¬çš„é—®é¢˜ç¨‹åºçš„è¾“å‡ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;Waiting for the news...
BREAKING NEWS: Channels let goroutines communicate.
fatal error: all goroutines are asleep - deadlock!

goroutine 1 [chan receive]:
main.main()
    .../goroutineStop.go:11 +0xf6

goroutine 2 [syscall]:
created by runtime.main
    .../go/src/pkg/runtime/proc.c:225

goroutine 4 [timer goroutine (idle)]:
created by addtimer
    .../go/src/pkg/runtime/ztime_linux_amd64.c:73&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¤§å¤šæ•°æƒ…å†µä¸‹æ‰¾å‡ºGoç¨‹åºä¸­é€ æˆæ­»é”çš„åŸå› éƒ½æ¯”è¾ƒå®¹æ˜“ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„å°±æ˜¯å¦‚ä½•è§£å†³è¿™ä¸ªbugäº†ã€‚&lt;/p&gt;
&lt;h3&gt;5. æ•°æ®ç«äº‰ï¼ˆdata raceï¼‰&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ­»é”ä¹Ÿè®¸å¬èµ·æ¥ä»¤äººæŒºå¿§ä¼¤çš„ï¼Œä½†ä¼´éšå¹¶å‘ç¼–ç¨‹çœŸæ­£ç¾éš¾æ€§çš„é”™è¯¯å…¶å®æ˜¯æ•°æ®ç«äº‰ï¼Œç›¸å½“å¸¸è§ï¼Œä¹Ÿå¯èƒ½éå¸¸éš¾äºè°ƒè¯•ã€‚&lt;/p&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;å½“ä¸¤ä¸ªçº¿ç¨‹å¹¶å‘åœ°è®¿é—®åŒä¸€ä¸ªå˜é‡ï¼Œå¹¶ä¸”å…¶ä¸­è‡³å°‘ä¸€ä¸ªè®¿é—®æ˜¯å†™æ“ä½œæ—¶ï¼Œæ•°æ®ç«äº‰å°±å‘ç”Ÿäº†ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸‹é¢çš„è¿™ä¸ªå‡½æ•°å°±æœ‰æ•°æ®ç«äº‰é—®é¢˜ï¼Œå…¶è¡Œä¸ºæ˜¯æœªå®šä¹‰çš„ã€‚ä¾‹å¦‚ï¼Œå¯èƒ½è¾“å‡ºæ•°å€¼1ã€‚ä»£ç ä¹‹åæ˜¯ä¸€ä¸ªå¯èƒ½æ€§è§£é‡Šï¼Œè¯•å›¾ææ¸…æ¥šè¿™ä¸€åˆ‡æ˜¯å¦‚ä½•å‘ç”Ÿå¾—ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-golang&quot;&gt;&lt;code&gt;func race() {
    wait := make(chan struct{})
    n := 0
    go func() {
        // è¯‘æ³¨ï¼šæ³¨æ„ä¸‹é¢è¿™ä¸€è¡Œ
        n++ // ä¸€æ¬¡è®¿é—®: è¯», é€’å¢, å†™
        close(wait)
    }()
    // è¯‘æ³¨ï¼šæ³¨æ„ä¸‹é¢è¿™ä¸€è¡Œ
    n++ // å¦ä¸€æ¬¡å†²çªçš„è®¿é—®
    &amp;amp;lt;-wait
    fmt.Println(n) // è¾“å‡ºï¼šæœªæŒ‡å®š
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä»£ç ä¸­çš„ä¸¤ä¸ªgoroutineï¼ˆå‡è®¾å‘½åä¸º&lt;code&gt;g1&lt;/code&gt;å’Œ&lt;code&gt;g2&lt;/code&gt;ï¼‰å‚ä¸äº†ä¸€æ¬¡ç«äº‰ï¼Œæˆ‘ä»¬æ— æ³•è·çŸ¥æ“ä½œä¼šä»¥ä½•ç§é¡ºåºå‘ç”Ÿã€‚ä»¥ä¸‹æ˜¯è¯¸å¤šå¯èƒ½ä¸­çš„ä¸€ç§ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;code&gt;g1&lt;/code&gt; ä» &lt;code&gt;n&lt;/code&gt; ä¸­è·å–å€¼0&lt;/li&gt;
&lt;li&gt;&lt;code&gt;g2&lt;/code&gt; ä» &lt;code&gt;n&lt;/code&gt; ä¸­è·å–å€¼0&lt;/li&gt;
&lt;li&gt;&lt;code&gt;g1&lt;/code&gt; å°†å€¼ä»0å¢å¤§åˆ°1&lt;/li&gt;
&lt;li&gt;&lt;code&gt;g1&lt;/code&gt; å°†1å†™åˆ° &lt;code&gt;n&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;g2&lt;/code&gt; å°†å€¼ä»0å¢å¤§åˆ°1&lt;/li&gt;
&lt;li&gt;&lt;code&gt;g2&lt;/code&gt; å°†1å†™åˆ° &lt;code&gt;n&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ç¨‹åºè¾“å‡º n çš„å€¼ï¼Œå½“å‰ä¸º1&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;â€œæ•°æ®ç«äº‰ï¼ˆdata raceï¼‰â€è¿™åå­—æœ‰ç‚¹è¯¯å¯¼çš„å«Œç–‘ã€‚ä¸ä»…æ“ä½œçš„é¡ºåºæ˜¯æœªå®šä¹‰çš„ï¼Œå…¶å®æ ¹æœ¬æ²¡æœ‰ä»»ä½•ä¿è¯ï¼ˆno guarantees whatsoeverï¼‰ã€‚ç¼–è¯‘å™¨å’Œç¡¬ä»¶ä¸ºäº†å¾—åˆ°æ›´å¥½çš„æ€§èƒ½ï¼Œç»å¸¸éƒ½ä¼šå¯¹ä»£ç è¿›è¡Œä¸Šä¸‹å†…å¤–çš„é¡ºåºå˜æ¢ã€‚å¦‚æœä½ çœ‹åˆ°ä¸€ä¸ªçº¿ç¨‹å¤„äºä¸­é—´è¡Œä¸ºçŠ¶æ€æ—¶ï¼Œé‚£ä¹ˆå½“æ—¶çš„åœºæ™¯å¯èƒ½å°±åƒä¸‹å›¾æ‰€ç¤ºçš„ä¸€æ ·ï¼š&lt;/p&gt;
&lt;img src=&apos;https://yourbasic.org/golang/mid-action.jpg&apos; title=&apos;mid action&apos; alt=&apos;mid action&apos; width=&apos;100%&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é¿å…æ•°æ®ç«äº‰çš„å”¯ä¸€æ–¹å¼æ˜¯çº¿ç¨‹é—´åŒæ­¥è®¿é—®æ‰€æœ‰çš„å…±äº«å¯å˜æ•°æ®ã€‚æœ‰å‡ ç§æ–¹å¼èƒ½å¤Ÿå®ç°è¿™ä¸€ç›®æ ‡ã€‚Goè¯­è¨€ä¸­ï¼Œé€šå¸¸æ˜¯ä½¿ç”¨ç®¡é“æˆ–è€…é”ã€‚ï¼ˆ&lt;a href=&apos;http://golang.org/pkg/sync/&apos;&gt;sync&lt;/a&gt;å’Œ&lt;a href=&apos;http://golang.org/pkg/sync/atomic/&apos;&gt;sync/atomic&lt;/a&gt;åŒ…ä¸­è¿˜æœ‰æ›´ä½å±‚æ¬¡çš„æœºåˆ¶å¯ä¾›ä½¿ç”¨ï¼Œä½†æœ¬æ–‡ä¸­ä¸åšè®¨è®ºï¼‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Goè¯­è¨€ä¸­ï¼Œå¤„ç†å¹¶å‘æ•°æ®è®¿é—®çš„æ¨èæ–¹å¼æ˜¯ä½¿ç”¨ç®¡é“ä»ä¸€ä¸ªgoroutineä¸­å¾€ä¸‹ä¸€ä¸ªgoroutineä¼ é€’å®é™…çš„æ•°æ®ã€‚æœ‰æ ¼è¨€è¯´å¾—å¥½ï¼šâ€œä¸è¦é€šè¿‡å…±äº«å†…å­˜æ¥é€šè®¯ï¼Œè€Œæ˜¯é€šè¿‡é€šè®¯æ¥å…±äº«å†…å­˜â€ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-golang&quot;&gt;&lt;code&gt;func sharingIsCaring() {
    ch := make(chan int)
    go func() {
        n := 0 // ä»…ä¸ºä¸€ä¸ªgoroutineå¯è§çš„å±€éƒ¨å˜é‡.
        n++
        ch &amp;amp;lt;- n // æ•°æ®ä»ä¸€ä¸ªgoroutineç¦»å¼€...
    }()
    n := &amp;amp;lt;-ch   // ...ç„¶åå®‰å…¨åˆ°è¾¾å¦ä¸€ä¸ªgoroutine.
    n++
    fmt.Println(n) // è¾“å‡º: 2
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä»¥ä¸Šä»£ç ä¸­çš„ç®¡é“è‚©è´ŸåŒé‡è´£ä»» - ä»ä¸€ä¸ªgoroutineå°†æ•°æ®ä¼ é€’åˆ°å¦ä¸€ä¸ªgoroutineï¼Œå¹¶ä¸”èµ·åˆ°åŒæ­¥çš„ä½œç”¨ï¼šå‘é€æ–¹goroutineä¼šç­‰å¾…å¦ä¸€ä¸ªgoroutineæ¥æ”¶æ•°æ®ï¼Œæ¥æ”¶æ–¹goroutineä¹Ÿä¼šç­‰å¾…å¦ä¸€ä¸ªgoroutineå‘é€æ•°æ®ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;a href=&apos;http://golang.org/ref/mem&apos;&gt;Goè¯­è¨€å†…å­˜æ¨¡å‹&lt;/a&gt; - è¦ä¿è¯ä¸€ä¸ªgoroutineä¸­å¯¹ä¸€ä¸ªå˜é‡çš„è¯»æ“ä½œå¾—åˆ°çš„å€¼æ­£å¥½æ˜¯å¦ä¸€ä¸ªgoroutineä¸­å¯¹åŒä¸€ä¸ªå˜é‡å†™æ“ä½œäº§ç”Ÿçš„å€¼ï¼Œæ¡ä»¶ç›¸å½“å¤æ‚ï¼Œä½†goroutineä¹‹é—´åªè¦é€šè¿‡ç®¡é“æ¥å…±äº«æ‰€æœ‰å¯å˜æ•°æ®ï¼Œé‚£ä¹ˆå°±èƒ½è¿œç¦»æ•°æ®ç«äº‰äº†ã€‚&lt;/p&gt;
&lt;h3&gt;6. äº’æ–¥é”&lt;/h3&gt;
&lt;img src=&apos;https://yourbasic.org/golang/lock.jpg&apos; title=&apos;lock&apos; alt=&apos;lock&apos; width=&apos;100%&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ‰æ—¶ï¼Œé€šè¿‡æ˜¾å¼åŠ é”ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç®¡é“ï¼Œæ¥åŒæ­¥æ•°æ®è®¿é—®ï¼Œå¯èƒ½æ›´åŠ ä¾¿æ·ã€‚Goè¯­è¨€æ ‡å‡†åº“ä¸ºè¿™ä¸€ç›®çš„æä¾›äº†ä¸€ä¸ªäº’æ–¥é” - &lt;a href=&apos;http://golang.org/pkg/sync/#Mutex&apos;&gt;sync.Mutex&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¦æƒ³è¿™ç±»åŠ é”èµ·æ•ˆçš„è¯ï¼Œå…³é”®ä¹‹å¤„åœ¨äºï¼šæ‰€æœ‰å¯¹å…±äº«æ•°æ®çš„è®¿é—®ï¼Œä¸ç®¡è¯»å†™ï¼Œä»…å½“goroutineæŒæœ‰é”æ‰èƒ½æ“ä½œã€‚ä¸€ä¸ªgoroutineå‡ºé”™å°±è¶³ä»¥ç ´åæ‰ä¸€ä¸ªç¨‹åºï¼Œå¼•å…¥æ•°æ®ç«äº‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å› æ­¤ï¼Œåº”è¯¥è®¾è®¡ä¸€ä¸ªè‡ªå®šä¹‰æ•°æ®ç»“æ„ï¼Œå…·å¤‡æ˜ç¡®çš„APIï¼Œç¡®ä¿æ‰€æœ‰çš„åŒæ­¥éƒ½åœ¨æ•°æ®ç»“æ„å†…éƒ¨å®Œæˆã€‚ä¸‹ä¾‹ä¸­ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªå®‰å…¨ã€æ˜“äºä½¿ç”¨çš„å¹¶å‘æ•°æ®ç»“æ„ï¼Œ&lt;code&gt;AtomicInt&lt;/code&gt;ï¼Œç”¨äºå­˜å‚¨ä¸€ä¸ªæ•´å‹å€¼ã€‚ä»»æ„æ•°é‡çš„goroutineéƒ½èƒ½é€šè¿‡&lt;code&gt;Add&lt;/code&gt;å’Œ&lt;code&gt;Value&lt;/code&gt;æ–¹æ³•å®‰å…¨åœ°è®¿é—®è¿™ä¸ªæ•°å€¼ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-golang&quot;&gt;&lt;code&gt;// AtomicIntæ˜¯ä¸€ä¸ªå¹¶å‘æ•°æ®ç»“æ„ï¼ŒæŒæœ‰ä¸€ä¸ªæ•´æ•°å€¼
// è¯¥æ•°æ®ç»“æ„çš„é›¶å€¼ä¸º0
type AtomicInt struct {
    mu sync.Mutex // é”ï¼Œä¸€æ¬¡ä»…èƒ½è¢«ä¸€ä¸ªgoroutineæŒæœ‰ã€‚
    n  int
}

// Addæ–¹æ³•ä½œä¸ºä¸€ä¸ªåŸå­æ“ä½œå°†nåŠ åˆ°AtomicInt
func (a *AtomicInt) Add(n int) {
    a.mu.Lock() // ç­‰å¾…é”é‡Šæ”¾ï¼Œç„¶åæŒæœ‰å®ƒ
    a.n += n
    a.mu.Unlock() // é‡Šæ”¾é”
}

// Valueæ–¹æ³•è¿”å›açš„å€¼
func (a *AtomicInt) Value() int {
    a.mu.Lock()
    n := a.n
    a.mu.Unlock()
    return n
}

func lockItUp() {
    wait := make(chan struct{})
    var n AtomicInt
    go func() {
        n.Add(1) // ä¸€ä¸ªè®¿é—®
        close(wait)
    }()
    n.Add(1) // å¦ä¸€ä¸ªå¹¶å‘è®¿é—®
    &amp;amp;lt;-wait
    fmt.Println(n.Value()) // è¾“å‡º: 2
}&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;7. æ£€æµ‹æ•°æ®ç«äº‰&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç«äº‰æœ‰æ—¶éå¸¸éš¾äºæ£€æµ‹ã€‚ä¸‹ä¾‹ä¸­çš„è¿™ä¸ªå‡½æ•°æœ‰ä¸€ä¸ªæ•°æ®ç«äº‰é—®é¢˜ï¼Œæ‰§è¡Œè¿™ä¸ªç¨‹åºæ—¶ä¼šè¾“å‡º&lt;code&gt;55555&lt;/code&gt;ã€‚å°è¯•ä¸€ä¸‹ï¼Œä¹Ÿè®¸ä½ ä¼šå¾—åˆ°ä¸€ä¸ªä¸åŒçš„ç»“æœã€‚ï¼ˆ&lt;a href=&apos;http://golang.org/pkg/sync/#WaitGroup&apos;&gt;sync.WaitGroup&lt;/a&gt;æ˜¯Goè¯­è¨€æ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†ï¼›ç”¨äºç­‰å¾…ä¸€ç»„goroutineç»“æŸè¿è¡Œã€‚ï¼‰&lt;/p&gt;
&lt;pre class=&quot;language-golang&quot;&gt;&lt;code&gt;func race() {
    var wg sync.WaitGroup
    wg.Add(5)
    // è¯‘æ³¨ï¼šæ³¨æ„ä¸‹é¢è¿™è¡Œä»£ç ä¸­çš„i++
    for i := 0; i &amp;amp;lt; 5; i++ {
        go func() {
            // æ³¨æ„ä¸‹ä¸€è¡Œä»£ç ä¼šè¾“å‡ºä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ
            fmt.Print(i) // 6ä¸ªgoroutineå…±äº«å˜é‡i
            wg.Done()
        }()
    }
    wg.Wait() // ç­‰å¾…æ‰€æœ‰ï¼ˆ5ä¸ªï¼‰goroutineè¿è¡Œç»“æŸ
    fmt.Println()
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äºè¾“å‡º&lt;code&gt;55555&lt;/code&gt;ï¼Œä¸€ä¸ªè²Œä¼¼åˆç†çš„è§£é‡Šæ˜¯ï¼šæ‰§è¡Œ&lt;code&gt;i++&lt;/code&gt;çš„goroutineåœ¨å…¶ä»–goroutineæ‰§è¡Œæ‰“å°è¯­å¥ä¹‹å‰å°±å®Œæˆäº†5æ¬¡&lt;code&gt;i++&lt;/code&gt;æ“ä½œã€‚å®é™…ä¸Šå˜é‡&lt;code&gt;i&lt;/code&gt;æ›´æ–°åçš„å€¼ä¸ºå…¶ä»–goroutineæ‰€è§çº¯å±å·§åˆã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼šä½¿ç”¨ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œç„¶åå½“å¼€å¯æ–°çš„goroutineæ—¶ï¼Œå°†æ•°å€¼ä½œä¸ºå‚æ•°ä¼ é€’ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-golang&quot;&gt;&lt;code&gt;func correct() {
    var wg sync.WaitGroup
    wg.Add(5)
    for i := 0; i &amp;amp;lt; 5; i++ {
        go func(n int) { // ä½¿ç”¨å±€éƒ¨å˜é‡
            fmt.Print(n)
            wg.Done()
        }(i)
    }
    wg.Wait()
    fmt.Println()
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™æ¬¡ä»£ç å°±å¯¹äº†ï¼Œç¨‹åºä¼šè¾“å‡ºæœŸæœ›çš„ç»“æœï¼Œå¦‚ï¼š&lt;code&gt;24031&lt;/code&gt;ã€‚æ³¨æ„ï¼šgoroutineä¹‹é—´çš„è¿è¡Œé¡ºåºæ˜¯ä¸ç¡®å®šçš„ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä»æ—§ä½¿ç”¨é—­åŒ…ï¼Œä½†èƒ½å¤Ÿé¿å…æ•°æ®ç«äº‰ä¹Ÿæ˜¯å¯èƒ½çš„ï¼Œå¿…é¡»å°å¿ƒç¿¼ç¿¼åœ°è®©æ¯ä¸ªgoroutineä½¿ç”¨ä¸€ä¸ªç‹¬æœ‰çš„å˜é‡ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-golang&quot;&gt;&lt;code&gt;func alsoCorrect() {
    var wg sync.WaitGroup
    wg.Add(5)
    for i := 0; i &amp;amp;lt; 5; i++ {
        n := i // ä¸ºæ¯ä¸ªé—­åŒ…åˆ›å»ºä¸€ä¸ªç‹¬æœ‰çš„å˜é‡
        go func() {
            fmt.Print(n)
            wg.Done()
        }()
    }
    wg.Wait()
    fmt.Println()
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;æ•°æ®ç«äº‰è‡ªåŠ¨æ£€æµ‹&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸€èˆ¬æ¥è¯´ï¼Œä¸å¤ªå¯èƒ½èƒ½å¤Ÿè‡ªåŠ¨æ£€æµ‹å‘ç°æ‰€æœ‰å¯èƒ½çš„æ•°æ®ç«äº‰æƒ…å†µï¼Œä½†Goï¼ˆä»ç‰ˆæœ¬1.1å¼€å§‹ï¼‰æœ‰ä¸€ä¸ªå¼ºå¤§çš„&lt;a href=&apos;http://tip.golang.org/doc/articles/race_detector.html&apos;&gt;æ•°æ®ç«äº‰æ£€æµ‹å™¨&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸ªå·¥å…·ç”¨èµ·æ¥ä¹Ÿå¾ˆç®€å•ï¼šåªè¦åœ¨ä½¿ç”¨&lt;code&gt;go&lt;/code&gt;å‘½ä»¤æ—¶åŠ ä¸Š&lt;code&gt;-race&lt;/code&gt;æ ‡è®°å³å¯ã€‚å¼€å¯æ£€æµ‹å™¨è¿è¡Œä¸Šé¢çš„ç¨‹åºä¼šç»™å‡ºæ¸…æ™°ä¸”ä¿¡æ¯é‡å¤§çš„è¾“å‡ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ go run -race raceClosure.go
Race:
==================
WARNING: DATA RACE
Read by goroutine 2:
    main.funcÂ·001()
      ../raceClosure.go:22 +0x65

Previous write by goroutine 0:
    main.race()
        ../raceClosure.go:20 +0x19b
    main.main()
        ../raceClosure.go:10 +0x29
    runtime.main()
        ../go/src/pkg/runtime/proc.c:248 +0x91

Goroutine 2 (running) created at:
    main.race()
      ../raceClosure.go:24 +0x18b
    main.main()
      ../raceClosure.go:10 +0x29
     runtime.main()
      ../go/src/pkg/runtime/proc.c:248 +0x91

==================
55555
Correct:
01234
Also correct:
01324
Found 1 data race(s)
exit status 66&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¯¥å·¥å…·å‘ç°ä¸€å¤„æ•°æ®ç«äº‰ï¼ŒåŒ…å«ï¼šä¸€ä¸ªgoroutineåœ¨ç¬¬20è¡Œå¯¹ä¸€ä¸ªå˜é‡è¿›è¡Œå†™æ“ä½œï¼Œè·Ÿç€å¦ä¸€ä¸ªgoroutineåœ¨ç¬¬22è¡Œå¯¹åŒä¸€ä¸ªå˜é‡è¿›è¡Œäº†æœªåŒæ­¥çš„è¯»æ“ä½œã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ³¨æ„ï¼šç«äº‰æ£€æµ‹å™¨åªèƒ½å‘ç°åœ¨è¿è¡ŒæœŸç¡®å®å‘ç”Ÿçš„æ•°æ®ç«äº‰ï¼ˆè¯‘æ³¨ï¼šæˆ‘ä¹Ÿä¸å¤ªç†è§£è¿™è¯ï¼Œè¯·æŒ‡å¯¼ï¼‰&lt;/p&gt;
&lt;h3&gt;8. Selectè¯­å¥&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;a href=&apos;http://golang.org/ref/spec#Select_statements&apos;&gt;selectè¯­å¥&lt;/a&gt;æ˜¯Goè¯­è¨€å¹¶å‘å·¥å…·é›†ä¸­çš„ç»ˆæå·¥å…·ã€‚selectç”¨äºä»ä¸€ç»„å¯èƒ½çš„é€šè®¯ä¸­é€‰æ‹©ä¸€ä¸ªè¿›ä¸€æ­¥å¤„ç†ã€‚å¦‚æœä»»æ„ä¸€ä¸ªé€šè®¯éƒ½å¯ä»¥è¿›ä¸€æ­¥å¤„ç†ï¼Œåˆ™ä»ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªï¼Œæ‰§è¡Œå¯¹åº”çš„è¯­å¥ã€‚å¦åˆ™ï¼Œå¦‚æœåˆæ²¡æœ‰é»˜è®¤åˆ†æ”¯ï¼ˆdefault caseï¼‰ï¼Œselectè¯­å¥åˆ™ä¼šé˜»å¡ï¼Œç›´åˆ°å…¶ä¸­ä¸€ä¸ªé€šè®¯å®Œæˆã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä»¥ä¸‹æ˜¯ä¸€ä¸ªç©å…·ç¤ºä¾‹ï¼Œæ¼”ç¤º&lt;code&gt;select&lt;/code&gt;è¯­å¥å¦‚ä½•ç”¨äºå®ç°ä¸€ä¸ªéšæœºæ•°ç”Ÿæˆå™¨ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-golang&quot;&gt;&lt;code&gt;// RandomBitså‡½æ•° è¿”å›ä¸€ä¸ªç®¡é“ï¼Œç”¨äºäº§ç”Ÿä¸€ä¸ªæ¯”ç‰¹éšæœºåºåˆ—
func RandomBits() &amp;amp;lt;-chan int {
    ch := make(chan int)
    go func() {
        for {
            select {
            case ch &amp;amp;lt;- 0: // æ³¨æ„ï¼šåˆ†æ”¯æ²¡æœ‰å¯¹åº”çš„å¤„ç†è¯­å¥
            case ch &amp;amp;lt;- 1:
            }
        }
    }()
    return ch
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸‹é¢æ˜¯ç›¸å¯¹æ›´åŠ å®é™…ä¸€ç‚¹çš„ä¾‹å­ï¼šå¦‚ä½•ä½¿ç”¨selectè¯­å¥ä¸ºä¸€ä¸ªæ“ä½œè®¾ç½®ä¸€ä¸ªæ—¶é—´é™åˆ¶ã€‚ä»£ç ä¼šè¾“å‡ºå˜é‡newsçš„å€¼æˆ–è€…è¶…æ—¶æ¶ˆæ¯ï¼Œå…·ä½“ä¾èµ–äºä¸¤ä¸ªæ¥æ”¶è¯­å¥å“ªä¸ªå…ˆæ‰§è¡Œï¼š&lt;/p&gt;
&lt;pre class=&quot;language-golang&quot;&gt;&lt;code&gt;select {
case news := &amp;amp;lt;-NewsAgency:
    fmt.Println(news)
case &amp;amp;lt;-time.After(time.Minute):
    fmt.Println(&amp;amp;quot;Time out: no news in one minute.&amp;amp;quot;)
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å‡½æ•° &lt;a href=&apos;http://golang.org/pkg/time/#After&apos;&gt;time.After&lt;/a&gt; æ˜¯Goè¯­è¨€æ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†ï¼›å®ƒä¼šåœ¨ç­‰å¾…æŒ‡å®šæ—¶é—´åå°†å½“å‰çš„æ—¶é—´å‘é€åˆ°è¿”å›çš„ç®¡é“ä¸­ã€‚&lt;/p&gt;
&lt;h3&gt;9. ç»¼åˆæ‰€æœ‰ç¤ºä¾‹&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;èŠ±ç‚¹æ—¶é—´è®¤çœŸç ”ç©¶ä¸€ä¸‹è¿™ä¸ªç¤ºä¾‹ã€‚å¦‚æœä½ å®Œå…¨ç†è§£ï¼Œä¹Ÿå°±å¯¹Goè¯­è¨€ä¸­å¹¶å‘çš„åº”ç”¨æ–¹å¼æœ‰äº†å…¨é¢çš„æŒæ¡ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸ªç¨‹åºæ¼”ç¤ºäº†å¦‚ä½•å°†ç®¡é“ç”¨äºè¢«ä»»æ„æ•°é‡çš„goroutineå‘é€å’Œæ¥æ”¶æ•°æ®ï¼Œä¹Ÿæ¼”ç¤ºäº†å¦‚ä½•å°†selectè¯­å¥ç”¨äºä»å¤šä¸ªé€šè®¯ä¸­é€‰æ‹©ä¸€ä¸ªã€‚&lt;/p&gt;
&lt;pre class=&quot;language-golang&quot;&gt;&lt;code&gt;func main() {
    people := []string{&amp;amp;quot;Anna&amp;amp;quot;, &amp;amp;quot;Bob&amp;amp;quot;, &amp;amp;quot;Cody&amp;amp;quot;, &amp;amp;quot;Dave&amp;amp;quot;, &amp;amp;quot;Eva&amp;amp;quot;}
    match := make(chan string, 1) // ä¸ºä¸€ä¸ªæœªåŒ¹é…çš„å‘é€æ“ä½œæä¾›ç©ºé—´
    wg := new(sync.WaitGroup)
    wg.Add(len(people))
    for _, name := range people {
        go Seek(name, match, wg)
    }
    wg.Wait()
    select {
    case name := &amp;amp;lt;-match:
        fmt.Printf(&amp;amp;quot;No one received %sâ€™s message.\n&amp;amp;quot;, name)
    default:
        // æ²¡æœ‰å¾…å¤„ç†çš„å‘é€æ“ä½œ
    }
}

// å‡½æ•°Seek å‘é€ä¸€ä¸ªnameåˆ°matchç®¡é“æˆ–ä»matchç®¡é“æ¥æ”¶ä¸€ä¸ªpeerï¼Œç»“æŸæ—¶é€šçŸ¥wait group
func Seek(name string, match chan string, wg *sync.WaitGroup) {
    select {
    case peer := &amp;amp;lt;-match:
        fmt.Printf(&amp;amp;quot;%s sent a message to %s.\n&amp;amp;quot;, peer, name)
    case match &amp;amp;lt;- name:
        // ç­‰å¾…æŸä¸ªgoroutineæ¥æ”¶æˆ‘çš„æ¶ˆæ¯
    }
    wg.Done()
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç¤ºä¾‹è¾“å‡ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ go run matching.go
Cody sent a message to Bob.
Anna sent a message to Eva.
No one received Daveâ€™s message.&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;10. å¹¶è¡Œè®¡ç®—&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¹¶å‘çš„ä¸€ä¸ªåº”ç”¨æ˜¯å°†ä¸€ä¸ªå¤§çš„è®¡ç®—åˆ‡åˆ†æˆä¸€äº›å·¥ä½œå•å…ƒï¼Œè°ƒåº¦åˆ°ä¸åŒçš„CPUä¸ŠåŒæ—¶åœ°è®¡ç®—ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å°†è®¡ç®—åˆ†å¸ƒåˆ°å¤šä¸ªCPUä¸Šæ›´å¤šæ˜¯ä¸€é—¨è‰ºæœ¯ï¼Œè€Œä¸æ˜¯ä¸€é—¨ç§‘å­¦ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ç»éªŒæ³•åˆ™ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;æ¯ä¸ªå·¥ä½œå•å…ƒåº”è¯¥èŠ±è´¹å¤§çº¦100å¾®ç§’åˆ°1æ¯«ç§’çš„æ—¶é—´ç”¨äºè®¡ç®—ã€‚å¦‚æœå•å…ƒç²’åº¦å¤ªå°ï¼Œåˆ‡åˆ†é—®é¢˜ä»¥åŠè°ƒåº¦å­é—®é¢˜çš„ç®¡ç†å¼€é”€å¯èƒ½å°±ä¼šå¤ªå¤§ã€‚å¦‚æœå•å…ƒç²’åº¦å¤ªå¤§ï¼Œæ•´ä¸ªè®¡ç®—ä¹Ÿè®¸ä¸å¾—ä¸ç­‰å¾…ä¸€ä¸ªæ…¢çš„å·¥ä½œé¡¹ç»“æŸã€‚è¿™ç§ç¼“æ…¢å¯èƒ½å› ä¸ºå¤šç§åŸå› è€Œäº§ç”Ÿï¼Œæ¯”å¦‚ï¼šè°ƒåº¦ã€å…¶ä»–è¿›ç¨‹çš„ä¸­æ–­æˆ–è€…ç³Ÿç³•çš„å†…å­˜å¸ƒå±€ã€‚ï¼ˆæ³¨æ„ï¼šå·¥ä½œå•å…ƒçš„æ•°ç›®æ˜¯ä¸ä¾èµ–äºCPUçš„æ•°ç›®çš„ï¼‰&lt;/li&gt;
&lt;li&gt;å°½å¯èƒ½å‡å°å…±äº«çš„æ•°æ®é‡ã€‚å¹¶å‘å†™æ“ä½œçš„ä»£ä»·éå¸¸å¤§ï¼Œç‰¹åˆ«æ˜¯å¦‚æœgoroutineè¿è¡Œåœ¨ä¸åŒçš„CPUä¸Šã€‚è¯»æ“ä½œä¹‹é—´çš„æ•°æ®å…±äº«åˆ™é€šå¸¸ä¸ä¼šæ˜¯ä¸ªé—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;æ•°æ®è®¿é—®å°½é‡åˆ©ç”¨è‰¯å¥½çš„å±€éƒ¨æ€§ã€‚å¦‚æœæ•°æ®èƒ½ä¿æŒåœ¨ç¼“å­˜ä¸­ï¼Œæ•°æ®åŠ è½½å’Œå­˜å‚¨å°†ä¼šå¿«å¾—å¤šå¾—å¤šï¼Œè¿™å¯¹äºå†™æ“ä½œä¹Ÿæ ¼å¤–åœ°é‡è¦ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸‹é¢çš„è¿™ä¸ªç¤ºä¾‹å±•ç¤ºå¦‚ä½•åˆ‡åˆ†ä¸€ä¸ªå¼€é”€å¾ˆå¤§çš„è®¡ç®—å¹¶å°†å…¶åˆ†å¸ƒåœ¨æ‰€æœ‰å¯ç”¨çš„CPUä¸Šè¿›è¡Œè®¡ç®—ã€‚å…ˆçœ‹ä¸€ä¸‹æœ‰å¾…ä¼˜åŒ–çš„ä»£ç ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-golang&quot;&gt;&lt;code&gt;type Vector []float64

// å‡½æ•°Convolve è®¡ç®— w = u * vï¼Œå…¶ä¸­ w[k] = Î£ u[i]*v[j], i + j = k
// å…ˆå†³æ¡ä»¶ï¼šlen(u) &amp;amp;gt; 0, len(v) &amp;amp;gt; 0
func Convolve(u, v Vector) (w Vector) {
    n := len(u) + len(v) - 1
    w = make(Vector, n)

    for k := 0; k &amp;amp;lt; n; k++ {
        w[k] = mul(u, v, k)
    }
    return
}

// å‡½æ•°mul è¿”å› Î£ u[i]*v[j], i + j = k.
func mul(u, v Vector, k int) (res float64) {
    n := min(k+1, len(u))
    j := min(k, len(v)-1)
    for i := k - j; i &amp;amp;lt; n; i, j = i+1, j-1 {
        res += u[i] * v[j]
    }
    return
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ€è·¯å¾ˆç®€å•ï¼šç¡®å®šåˆé€‚å¤§å°çš„å·¥ä½œå•å…ƒï¼Œç„¶ååœ¨ä¸åŒçš„goroutineä¸­æ‰§è¡Œæ¯ä¸ªå·¥ä½œå•å…ƒã€‚ä»¥ä¸‹æ˜¯å¹¶å‘ç‰ˆæœ¬çš„ &lt;code&gt;Convolve&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-golang&quot;&gt;&lt;code&gt;func Convolve(u, v Vector) (w Vector) {
    n := len(u) + len(v) - 1
    w = make(Vector, n)

    // å°† w åˆ‡åˆ†æˆèŠ±è´¹ ~100Î¼s-1ms ç”¨äºè®¡ç®—çš„å·¥ä½œå•å…ƒ
    size := max(1, 1&amp;amp;lt;&amp;amp;lt;20/n)

    wg := new(sync.WaitGroup)
    wg.Add(1 + (n-1)/size)
    for i := 0; i &amp;amp;lt; n &amp;amp;amp;&amp;amp;amp; i &amp;amp;gt;= 0; i += size { // æ•´å‹æº¢å‡ºå i &amp;amp;lt; 0
        j := i + size
        if j &amp;amp;gt; n || j &amp;amp;lt; 0 { // æ•´å‹æº¢å‡ºå j &amp;amp;lt; 0
            j = n
        }

        // è¿™äº›goroutineå…±äº«å†…å­˜ï¼Œä½†æ˜¯åªè¯»
        go func(i, j int) {
            for k := i; k &amp;amp;lt; j; k++ {
                w[k] = mul(u, v, k)
            }
            wg.Done()
        }(i, j)
    }
    wg.Wait()
    return
}&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å·¥ä½œå•å…ƒå®šä¹‰ä¹‹åï¼Œé€šå¸¸æƒ…å†µä¸‹æœ€å¥½å°†è°ƒåº¦å·¥ä½œäº¤ç»™è¿è¡Œæ—¶å’Œæ“ä½œç³»ç»Ÿã€‚ç„¶è€Œï¼Œå¯¹äº &lt;code&gt;Go 1.*&lt;/code&gt; ä½ ä¹Ÿè®¸éœ€è¦å‘Šè¯‰è¿è¡Œæ—¶å¸Œæœ›å¤šå°‘ä¸ªgoroutineæ¥åŒæ—¶åœ°è¿è¡Œä»£ç ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-golang&quot;&gt;&lt;code&gt;func init() {
    numcpu := runtime.NumCPU()
    runtime.GOMAXPROCS(numcpu) // å°è¯•ä½¿ç”¨æ‰€æœ‰å¯ç”¨çš„CPU
}&lt;/code&gt;&lt;/pre&gt;</description>
            <pubDate>2015-05-20</pubDate>
            <link>https://blog.xiayf.cn/posts/fundamentals-of-concurrent-programming.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/fundamentals-of-concurrent-programming.html</guid>
        </item>
        
        <item>
            <title>åˆæ˜¯ä¸€å¹´</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;åˆæ˜¯ä¸€å¹´ï¼Œä¾ç…§æƒ¯ä¾‹ï¼Œå¾—å†™ä¸€ç¯‡æ€»ç»“å’Œè®¡åˆ’ã€‚å½“ç„¶è®¡åˆ’æ›´å¤šçš„åªæ˜¯ä¸€ç§è‡ªæˆ‘é¼“åŠ±ï¼Œç°å®æ€»æ˜¯ä¸€æ¬¡åˆä¸€æ¬¡åœ°è¯æ˜â€œè®¡åˆ’èµ¶ä¸ä¸Šå˜åŒ–â€ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘çš„2014ï¼Œå¯èƒ½ç”¨ä¸‰ä¸ªå…³é”®è¯å°±èƒ½æ¦‚æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ç»“å©š&lt;/li&gt;
&lt;li&gt;æ¢å·¥ä½œ&lt;/li&gt;
&lt;li&gt;ä¼—æˆæŠ€æœ¯èšä¹éƒ¨&lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;ç»“å©š&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç»§13å¹´é¢†è¯ï¼Œ14å¹´æŠŠå©šç¤¼ä¹ŸåŠäº†ã€‚ç”±äºä¸¤å®¶ç¦»å¾—è¿œï¼Œå©šç¤¼ä¹Ÿå°±åˆ†ä¸¤æ¬¡åŠã€‚ä¹‹é—´è¿˜è¡¥æ‹äº†å©šçº±ç…§ã€‚è™½ç„¶äºæˆ‘è¿™äº›æµç¨‹æ˜¾å¾—æœ‰ç‚¹æŠ˜è…¾ï¼Œä½†é‡è¦çš„æ˜¯å¤§å®¶éƒ½æ˜¯å¾ˆå¼€å¿ƒï¼Œä¹Ÿä¸å¸Œæœ›è€å©†ä»¥åä¼šæœ‰ä¸ç‚¹é—æ†¾ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¸Œæœ›ä»¥åçš„æ—¥å­æ€»èƒ½åŠªåŠ›è®©è€å©†å¼€å¿ƒå¹¸ç¦ã€‚&lt;/p&gt;
&lt;h3&gt;æ¢å·¥ä½œ&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å·¥ä½œçš„æ—¶é—´å¹¶ä¸é•¿ï¼Œæœ¬æ²¡æƒ³è¿™ä¹ˆå¿«æ¢å·¥ä½œï¼Œä½•å†µæˆ‘è¿˜æ˜¯ä¸€ä¸ªæŒºå¿µæ—§çš„äººã€‚ä½†è¿˜æ˜¯é‚£å¥è¯â€œè®¡åˆ’èµ¶ä¸ä¸Šå˜åŒ–â€ï¼Œä¸å¾—å·²ä¸»åŠ¨ç¦»èŒè·³æ§½ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äºç›®å‰çš„å·¥ä½œè¿˜æ¯”è¾ƒæ»¡æ„ï¼Œèƒ½åšäº›è‡ªå·±å–œæ¬¢åšçš„äº‹æƒ…ï¼Œå·¥ä½œæ°›å›´ä¹Ÿè¿˜ä¸é”™ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äºè‡ªå·±çš„è¦æ±‚å°±æ˜¯è¸è¸å®å®åšå·¥ä½œææŠ€æœ¯ï¼Œä¸æ€¥ä¸èºã€‚&lt;/p&gt;
&lt;h3&gt;&lt;a href=&apos;http://happytechgroup.github.io/&apos;&gt;ä¼—æˆæŠ€æœ¯èšä¹éƒ¨&lt;/a&gt;&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å‚åŠ è¿‡å„ç§å¤§å¤§å°å°çš„ä¼šè®®ï¼Œæ€»è§‰å¾—æ°´å¤ªå¤šï¼Œä½†å¦‚æœå§‹ç»ˆè‡ªå·±ä¸€ä¸ªäººè’™å¤´ç ”ç©¶æŠ€æœ¯ï¼Œä¹Ÿæœ‰å¯èƒ½è½å¾—ä¸ªâ€œé—­é—¨é€ è½¦â€ã€â€œç›®å…‰çŸ­æµ…â€çš„ä¸‹åœºï¼ŒæŠ€æœ¯çš„â€œç†â€ä¹Ÿæ˜¯è¶Šè¾©è¶Šæ˜ï¼Œæ‰€ä»¥æ‰¾äº†ä¸‰äº”åŒå­¦æœ‹å‹æèµ·è‡ªå·±çš„æŠ€æœ¯æ²™é¾™ï¼Œ&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åä¸ºâ€œä¼—æˆæŠ€æœ¯èšä¹éƒ¨â€ï¼Œä¹‹æ‰€ä»¥ä¸ºâ€œä¼—æˆâ€ï¼Œæ˜¯å¸Œæœ›&lt;strong&gt;ä¼—äººæˆå°±ä¼—äºº&lt;/strong&gt;ï¼Œå¤§å®¶ç›¸äº’æˆå°±ï¼Œä¹‹æ‰€ä»¥ä¸ºâ€œèšä¹éƒ¨â€è€Œä¸æ˜¯â€œä¿±ä¹éƒ¨â€ï¼Œæ˜¯è®¤ä¸ºå¤§å®¶ä¸€èµ·è®¨è®ºåˆ†äº«æŠ€æœ¯åº”è¯¥æ˜¯ä¸€ä»¶ä¹å‘µçš„äº‹æƒ…ï¼Œä¸è¦æå¾—é‚£ä¹ˆä¸¥è‚ƒè‹¦é€¼ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;èšä¹éƒ¨è‡³ä»Šå·²æäº†5æ¬¡èšä¼šï¼Œä¸€ä¸ªæœˆä¸€æ¬¡ï¼Œä»æˆ‘ä¸ªäººçš„è§’åº¦æ¥çœ‹ï¼Œæ•ˆæœä¸é”™ï¼Œè™½ç„¶å¾ˆå¤šåœ°æ–¹è¿˜æœ‰å¾…æ”¹è¿›ã€‚æ„Ÿè°¢æ‰€æœ‰æˆå‘˜çš„ä»˜å‡ºï¼&lt;/p&gt;
&lt;h3&gt;å…¶ä»–&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æŠ€æœ¯ä¸Šï¼Œç›¸æ¯”ä¸Šä¸€å¹´ï¼Œæœ‰äº†äº›è®¸è¿›æ­¥ - å€Ÿç€â€œä¼—æˆâ€çš„æŠ€æœ¯åˆ†äº«ï¼Œç®€å•é˜…è¯»äº†leveldbï¼ˆGoè¯­è¨€ç‰ˆï¼‰çš„æºç ã€Memcachedæºç ç­‰ï¼›ä¸ºäº†æŠŠå·¥ä½œåšå¾—æ›´å¥½ï¼Œåˆä»”ç»†åœ°é˜…è¯»äº†Yiiæ¡†æ¶æºç ï¼Œå¹¶å†™äº†&lt;a href=&apos;http://youngsterxyf.github.io/tag/yii.html&apos;&gt;ç³»åˆ—æ–‡ç« &lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨å†™åšå®¢ä¸€äº‹ä¸Šï¼Œ2014å¹´æˆ‘ä¹Ÿä¸ç®—å¤ªå·æ‡’ï¼Œå…±å†™äº†26ç¯‡ï¼Œè™½ç„¶æ–‡ç« è´¨é‡ä¸å’‹åœ°ï¼Œè¿œè¿œæœªè¾¾åˆ°è‡ªå·±çš„è¦æ±‚ï¼Œä½†ä¸€åˆ‡è´µåœ¨åšæŒï¼Œä¸æ˜¯ä¹ˆï¼Ÿ&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é˜…è¯»æ–¹é¢ï¼Œä¹¦ç›®å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;æ·˜å®æŠ€æœ¯è¿™åå¹´ ï¼ˆ3æ˜Ÿï¼Œæˆä¸ºå¤§ç‰›ä¹Ÿæ˜¯è¦çœ‹æœºé‡çš„ï¼‰&lt;/li&gt;
&lt;li&gt;Webå®¹é‡è§„åˆ’çš„è‰ºæœ¯ ï¼ˆ4æ˜Ÿï¼‰&lt;/li&gt;
&lt;li&gt;ä¸–ç•Œæ˜¯æ•°å­—çš„ ï¼ˆ5æ˜Ÿï¼Œè®¡ç®—æœºç§‘æ™®ï¼‰&lt;/li&gt;
&lt;li&gt;ä¸‰ä½“ï¼ˆä¸‰å†Œï¼‰ï¼ˆ1ã€2å†Œ5æ˜Ÿï¼Œç¬¬3å†Œ4æ˜Ÿï¼‰&lt;/li&gt;
&lt;li&gt;20ä¸ªæœˆèµš130äº¿ - YouTubeåˆ›å§‹äººé™ˆå£«éªè‡ªä¼  ï¼ˆ4æ˜Ÿï¼Œå¥½å§ï¼Œè¿™ç¿»è¯‘çš„ä¹¦åçœŸä¿—æ°”ï¼Œä½†å…¶å®æ˜¯æœ¬æŒºä¸é”™çš„ä¹¦ï¼‰&lt;/li&gt;
&lt;li&gt;PHPç²¾ç²¹-ç¼–å†™é«˜æ•ˆPHPä»£ç  ï¼ˆ3æ˜Ÿï¼Œä»”ç»†é˜…è¯»äº†å‰åŠéƒ¨åˆ†ï¼Œå¿«é€Ÿæµè§ˆäº†ååŠéƒ¨åˆ†ï¼‰&lt;/li&gt;
&lt;li&gt;MacTalk - äººç”Ÿå…ƒç¼–ç¨‹ (3æ˜Ÿï¼Œç”µå­ä¹¦ï¼Œå¤§è‡´è¿‡äº†ä¸€éï¼‰&lt;/li&gt;
&lt;li&gt;ç¼–å†™é«˜è´¨é‡ä»£ç ï¼šæ”¹è¿›Pythonç¨‹åºçš„91ä¸ªå»ºè®® ï¼ˆ4æ˜Ÿï¼Œéœ€å†è¯»ä¸€éï¼‰&lt;/li&gt;
&lt;li&gt;æ–‡æ˜ä¹‹å…‰ï¼ˆä¸¤å†Œï¼Œ5æ˜Ÿï¼Œæœ‰æ€åº¦çš„æµ“ç¼©çš„ä¸–ç•Œæ–‡æ˜å²ï¼‰&lt;/li&gt;
&lt;li&gt;äº†ä¸èµ·çš„Node.jsï¼ˆ2æ˜Ÿï¼Œæµè§ˆäº†ä¸€éï¼‰&lt;/li&gt;
&lt;li&gt;Pro Git ï¼ˆ4æ˜Ÿï¼ŒGitèµ„æ–™ä¸­çš„No.1ï¼‰&lt;/li&gt;
&lt;li&gt;æ¼”è®²ä¹‹ç¦…ï¼šä¸€ä½æŠ€æœ¯æ¼”è®²å®¶çš„è‡ªç™½ ï¼ˆ4æ˜Ÿï¼Œæ¯ä¸ªæŠ€æœ¯äººéƒ½åº”è¯¥å¤šæ¼”è®²ï¼Œæ‰€ä»¥æ¨èæ¯ä¸ªæŠ€æœ¯äººéƒ½è¯»ä¸€ä¸‹è¿™æœ¬ä¹¦ï¼‰&lt;/li&gt;
&lt;li&gt;é«˜æ€§èƒ½PHPåº”ç”¨å¼€å‘ ï¼ˆ3æ˜Ÿï¼‰&lt;/li&gt;
&lt;li&gt;ç¿»è¯‘æ¼«è°ˆï¼šæ€æ ·ç¿»è¯‘æ›´åœ°é“ ï¼ˆ4æ˜Ÿï¼Œæœªè¯»å®Œï¼‰&lt;/li&gt;
&lt;li&gt;æœ€ç’€ç’¨çš„é“¶æ²³ï¼šåˆ˜æ…ˆæ¬£ç»å…¸ä½œå“é›† ï¼ˆ4æ˜Ÿï¼Œè¯»å®Œä¸‰ä½“ï¼Œæ„çŠ¹æœªå°½ï¼Œæ•…æ‰¾æ¥å¤§åˆ˜çš„ä¸­çŸ­ç¯‡é›†è¯»è¯»ï¼‰&lt;/li&gt;
&lt;li&gt;æ•°æ®ä¹‹å·… ï¼ˆ5æ˜Ÿï¼Œæ•°æ®æ€ç»´ï¼Œæœ‰ç‚¹éœ‡æ’¼åˆ°æˆ‘ï¼Œæ¨èï¼Œéœ€å†è¯»ä¸€éï¼‰&lt;/li&gt;
&lt;li&gt;å¤§å‹ç½‘ç«™æŠ€æœ¯æ¶æ„:æ ¸å¿ƒåŸç†ä¸æ¡ˆä¾‹åˆ†æ (4æ˜Ÿï¼Œè™½ç„¶æ²¡ä»€ä¹ˆæ–°ä¸œè¥¿ï¼Œä½†ç³»ç»Ÿåœ°ç§‘æ™®äº†Webæ¶æ„æ–¹é¢çš„ä¸œè¥¿ï¼Œè¿˜æ˜¯å€¼å¾—ä¸€è¯»çš„)&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä»ä¹¦ç›®å¯ä»¥çœ‹å‡ºï¼ŒæŠ€æœ¯ç›¸å…³çš„è¿˜æ˜¯ç¼ºä¹æ·±åº¦å’Œä¸“æ³¨ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3&gt;2015 ...&lt;/h3&gt;
&lt;ul&gt;&lt;li&gt;åšå¥½å·¥ä½œï¼Œå¤šæ€è€ƒï¼Œå¤šåšå®åœ¨çš„äº‹æƒ…&lt;/li&gt;
&lt;li&gt;ç»§ç»­æå¥½ä¼—æˆæŠ€æœ¯èšä¹éƒ¨&lt;/li&gt;
&lt;li&gt;åšæŒå†™åšå®¢ï¼Œå‘æ·±åº¦å‘å±•&lt;/li&gt;
&lt;li&gt;é€‰æ‹©ä¸€ä¸¤ä¸ªä¼˜ç§€å¼€æºé¡¹ç›®ï¼Œè¯»æºç ã€å†™åšå®¢ã€åšåˆ†äº«ï¼Œæ—¨åœ¨æé«˜ç³»ç»Ÿè®¾è®¡èƒ½åŠ›å’Œç¼–ç èƒ½åŠ›&lt;/li&gt;
&lt;li&gt;è¯»æœ‰æƒ³æ³•ã€æœ‰æ·±åº¦çš„ä¹¦&lt;/li&gt;
&lt;li&gt;è€ƒé©¾ç…§ ï¼ˆåˆ«ç¬‘ï¼Œå“ˆå“ˆï¼‰&lt;/li&gt;
&lt;li&gt;ä»¥è®²å¸ˆçš„èº«ä»½å‚åŠ ä¸€æ¬¡æŠ€æœ¯ä¼šè®®&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;em&gt;ï¼ˆé¢ï¼Œâ€œè®¡åˆ’â€æœ¬ä¸è¯¥å¤šè¯´ï¼Œä½†è²Œä¼¼è¿˜æ˜¯è¯´å¤šäº†ç‚¹...ï¼‰&lt;/em&gt;&lt;/p&gt;</description>
            <pubDate>2015-01-03</pubDate>
            <link>https://blog.xiayf.cn/posts/the-2014-is-gone.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/the-2014-is-gone.html</guid>
        </item>
        
        <item>
            <title>é¢å‘åˆ†å¸ƒå¼ç³»ç»Ÿå·¥ç¨‹å¸ˆçš„åˆ†å¸ƒå¼ç³»ç»Ÿç†è®ºï¼ˆè¯‘ï¼‰</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;åŸæ–‡ï¼š&lt;a href=&apos;http://the-paper-trail.org/blog/distributed-systems-theory-for-the-distributed-systems-engineer/&apos;&gt;Distributed systems theory for the distributed systems engineer&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Gwen Shapiraï¼Œå¤§è…•çº§çš„è§£å†³æ–¹æ¡ˆæ¶æ„å¸ˆï¼ˆSAï¼‰ï¼Œå¦‚ä»Š Cloudera çš„å…¨èŒå·¥ç¨‹å¸ˆï¼Œåœ¨&lt;a href=&apos;https://twitter.com/gwenshap/status/497203248332165121&apos;&gt; Twitter ä¸Šæçš„ä¸€ä¸ªé—®é¢˜&lt;/a&gt;å¼•èµ·äº†æˆ‘çš„æ€è€ƒã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœæ˜¯ä»¥å‰ï¼Œæˆ‘å¯èƒ½ä¼šå›ç­”â€œå—¯ï¼Œè¿™é‡Œæœ‰ç¯‡ FLP è®ºæ–‡ï¼Œè¿™é‡Œæœ‰ç¯‡ Paxos è®ºæ–‡ï¼Œè¿™é‡Œè¿˜æœ‰ç¯‡æ‹œå åº­å°†å†›é—®é¢˜çš„è®ºæ–‡...â€ï¼Œæˆ‘ä¼šç½—åˆ—ä¸€ç®©ç­é‡è¦çš„ææ–™ï¼Œå¦‚æœä½ ä¸€å¤´æ‰è¿›å»ï¼Œè‡³å°‘èŠ±è´¹ 6 ä¸ªæœˆçš„æ—¶é—´æ‰èƒ½è¿‡ä¸€éè¿™äº›ææ–™ã€‚ç„¶è€Œæˆ‘å·²é€æ¸æ˜ç™½æ¨èå¤§é‡çš„ç†è®ºæ€§çš„è®ºæ–‡é€šå¸¸æ°æ°æ˜¯ç€æ‰‹å­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿç†è®ºçš„é”™è¯¯æ–¹å¼ï¼ˆé™¤éä½ åœ¨åšä¸€ä¸ª PhD é¡¹ç›®ï¼‰ã€‚è®ºæ–‡é€šå¸¸æ¯”è¾ƒæ·±å…¥éš¾æ‡‚ï¼Œéœ€è¦è®¤çœŸåœ°ç ”ä¹ ï¼Œé€šå¸¸è¿˜éœ€è¦&lt;em&gt;å¤§é‡çš„æ—¶é—´æŠ•å…¥ï¼ˆsignificant experienceï¼‰&lt;/em&gt;æ¥ç†æ¸…è¿™äº›è®ºæ–‡çš„é‡è¦è´¡çŒ®ï¼Œä»¥åŠåœ¨æ•´ä¸ªç†è®ºä½“ç³»ä¸­çš„ä½ç½®ã€‚è¦æ±‚å·¥ç¨‹å¸ˆå…·å¤‡è¿™æ ·çš„ä¸“ä¸šæ°´å¹³åˆæœ‰å¤šå¤§çš„æ„ä¹‰å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½†æ˜¯ï¼Œå¾ˆé—æ†¾ï¼Œå¯¹åˆ†å¸ƒå¼ç³»ç»Ÿç†è®ºæ–¹é¢çš„é‡å¤§ç ”ç©¶æˆæœå’Œæ€æƒ³è¿›è¡Œæ¦‚æ‹¬ã€å½’çº³ã€èƒŒæ™¯åˆ†æçš„â€˜å¯¼å¼•â€™æ€§è´¨çš„ä¼˜ç§€ææ–™éå¸¸ç¼ºä¹ï¼›ç‰¹åˆ«æ˜¯æ²¡æœ‰å±…é«˜ä¸´ä¸‹æ€åº¦çš„ææ–™ã€‚å¯¹è¿™å—ç©ºç™½åŒºåŸŸçš„æ€è€ƒè®©æˆ‘æƒ³åˆ°äº†å¦ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜ï¼š&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;em&gt;ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿå·¥ç¨‹å¸ˆåº”è¯¥çŸ¥é“äº›ä»€ä¹ˆåˆ†å¸ƒå¼ç³»ç»Ÿç†è®ºï¼Ÿ&lt;/em&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€çŸ¥åŠè§£ï¼ˆa little theoryï¼‰å¹¶ä¸ä¼šæ˜¯ä¸€ä»¶å¤šå±é™©çš„äº‹æƒ…ã€‚å› æ­¤æˆ‘å°è¯•æ•´ç†ä¸€ä¸ªåˆ—è¡¨ï¼Œç½—åˆ—å‡ºä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿå·¥ç¨‹å¸ˆçš„æˆ‘è®¤ä¸ºèƒ½å¤Ÿç›´æ¥åº”ç”¨äºæˆ‘æ—¥å¸¸å·¥ä½œçš„ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼›æˆ–è€…è®©åˆ†å¸ƒå¼ç³»ç»Ÿå·¥ç¨‹å¸ˆå®Œå…¨æœ‰èƒ½åŠ›è®¾è®¡ä¸€ä¸ªæ–°ç³»ç»Ÿçš„â€œç­¹ç â€ã€‚å¦‚æœä½ è®¤ä¸ºæˆ‘æ¼æ‰äº†ä¸€äº›ä¸œè¥¿ï¼Œè¯·è”ç³»æˆ‘ã€‚&lt;/p&gt;
&lt;h4&gt;å…¥é—¨ç¬¬ä¸€æ­¥&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä»¥ä¸‹ 4 ç¯‡ææ–™å‡ºè‰²åœ°è§£é‡Šäº†æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿä¼šé‡åˆ°çš„ä¸€äº›æŒ‘æˆ˜ï¼Œå…±åŒæ¦‚è¿°äº†ä¸€ç³»åˆ—åˆ†å¸ƒå¼ç³»ç»Ÿå·¥ç¨‹å¸ˆå¿…é¡»è¦è§£å†³çš„æŠ€æœ¯ä¸Šçš„éš¾é¢˜ï¼Œä¸ºä¹‹åç« èŠ‚ä¸­æ›´æ·±å…¥çš„ç ”ç©¶åšå¥½å‡†å¤‡ã€‚&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;a href=&apos;http://book.mixu.net/distsys/&apos;&gt;å¥½ç©åˆå®åœ¨çš„åˆ†å¸ƒå¼ç³»ç»Ÿç†è®º&lt;/a&gt;æ˜¯ä¸€æœ¬ç®€çŸ­çš„ä¹¦ç±ï¼Œå…¶å†…å®¹è¦†ç›–äº†åˆ†å¸ƒå¼ç³»ç»Ÿé¢†åŸŸçš„ä¸€äº›åŸºæœ¬è®®é¢˜ï¼ŒåŒ…æ‹¬æ—¶é—´çš„ä½œç”¨åŠä¸åŒçš„å¤åˆ¶ç­–ç•¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&apos;http://www.somethingsimilar.com/2013/01/14/notes-on-distributed-systems-for-young-bloods/&apos;&gt;ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿé¢†åŸŸæ–°äººæ•´ç†çš„ç¬”è®°&lt;/a&gt; - ä¸æ˜¯ç†è®ºå¯¹ç†è®ºåœ°è®²è¿°ï¼Œè€Œæ˜¯åšä¸€ä¸ªéå¸¸å¥½éå¸¸å®ç”¨çš„å¹³è¡¡ï¼Œè®©ä½ å¯¹å…¶ä½™ææ–™çš„é˜…è¯»èƒ½å¤Ÿè½åœ°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&apos;http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.41.7628&apos;&gt;åˆ†å¸ƒå¼ç³»ç»Ÿç ”ç©¶ç»¼è¿°æŠ¥å‘Š&lt;/a&gt; - ä¸€ç¯‡ç»å…¸çš„è®ºæ–‡ï¼Œè§£é‡Šäº†ä¸ºä»€ä¹ˆä¸èƒ½å°†æ‰€æœ‰è¿œç¨‹äº¤äº’éƒ½æ¨¡æ‹Ÿæˆå’Œæœ¬åœ°å¯¹è±¡ä¸€æ ·ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&apos;http://en.wikipedia.org/wiki/Fallacies_of_Distributed_Computing&apos;&gt;å…³äºåˆ†å¸ƒå¼è®¡ç®—çš„è‹¥å¹²è°¬è®º&lt;/a&gt; - åˆ†å¸ƒå¼è®¡ç®—æ–¹é¢çš„8ç‚¹è°¬è®ºï¼Œæé†’ç³»ç»Ÿè®¾è®¡è€…å¯èƒ½ä¼šå¿˜è®°çš„å‡ ç±»äº‹æƒ…ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;h4&gt;å¤±è´¥å’Œæ—¶é—´&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åˆ†å¸ƒå¼ç³»ç»Ÿå·¥ç¨‹å¸ˆéœ€è¦é¢å¯¹çš„è®¸å¤šå›°éš¾æœ€ç»ˆéƒ½å¯ä»¥å½’å’äºä¸¤ä¸ªæ½œåœ¨çš„åŸå› ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;è¿›ç¨‹å¯èƒ½ä¼šå¤±è´¥&lt;/li&gt;
&lt;li&gt;ä¸å­˜åœ¨ä¸€ç§å¥½çš„æ–¹å¼æ¥å‘¨çŸ¥ç›®å‰ä¸ºæ­¢è¿›ç¨‹å·²ç»åšäº†äº›ä»€ä¹ˆ&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿›ç¨‹ä¹‹é—´å¯¹äº&lt;em&gt;æ—¶é—´&lt;/em&gt;çš„è®¤çŸ¥èƒ½å…±äº«äº›ä»€ä¹ˆï¼Ÿå“ªäº›å¤±è´¥çš„åœºæ™¯æ˜¯èƒ½å¤Ÿæ£€æµ‹åˆ°ï¼Ÿä»€ä¹ˆç®—æ³•å’ŒåŸè¯­å¯èƒ½è¢«æ­£ç¡®åœ°å®ç°ï¼Ÿè¿™ä¸‰ä¸ªé—®é¢˜æœ‰ç€éå¸¸æ·±å±‚çš„è”ç³»ã€‚å¤šæ•°æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå‡è®¾ä¸¤ä¸ªä¸åŒèŠ‚ç‚¹ä¹‹é—´å¯¹äºæ—¶é—´æ¦‚å¿µæˆ–æ—¶é—´ä»¥ä»€ä¹ˆæ ·çš„é€Ÿåº¦é€å»æ²¡æœ‰ä»»ä½•å¯å…±äº«çš„è®¤çŸ¥ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½ åº”è¯¥çŸ¥é“ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å¤±è´¥æ¨¡å¼çš„ï¼ˆéƒ¨åˆ†ï¼‰åˆ†å±‚ï¼š&lt;a href=&apos;http://www.cse.psu.edu/~gcao/teach/513-00/c7.pdf&apos;&gt;å´©æºƒåœæ­¢-&gt;æ’é™¤ï¼ˆomissionï¼‰&lt;/a&gt;-&gt;&lt;a href=&apos;http://en.wikipedia.org/wiki/Byzantine_fault_tolerance&apos;&gt;æ‹œå åº­å®¹é”™&lt;/a&gt;ã€‚ä½ åº”è¯¥ç†è§£ï¼šåœ¨é«˜å±‚æ¬¡ä¸Šå¯èƒ½å‘ç”Ÿçš„é—®é¢˜åœ¨ä½å±‚æ¬¡ä¸Šè‚¯å®šå¯èƒ½å‘ç”Ÿï¼Œåœ¨ä½å±‚æ¬¡ä¸Šä¸å¯èƒ½å‘ç”Ÿçš„é—®é¢˜åœ¨é«˜å±‚æ¬¡ä¸Šä¹Ÿè‚¯å®šä¸å¯èƒ½å‘ç”Ÿã€‚&lt;/li&gt;
&lt;li&gt;åœ¨æ²¡æœ‰ä»»ä½•å…±äº«æ—¶é’Ÿçš„æƒ…å†µä¸‹å¦‚ä½•åˆ¤æ–­åœ¨å¦ä¸€ä¸ªäº‹ä»¶ä¹‹å‰æ˜¯å¦äº§ç”Ÿäº†æŸäº‹ä»¶ã€‚è¿™æ„å‘³ç€ä½ éœ€è¦ç†è§£ &lt;a href=&apos;http://web.stanford.edu/class/cs240/readings/lamport.pdf&apos;&gt;Lamport æ—¶é’Ÿ&lt;/a&gt;åŠå…¶ä¸€èˆ¬åŒ–çš„&lt;a href=&apos;http://en.wikipedia.org/wiki/Vector_clock&apos;&gt;å‘é‡æ—¶é’Ÿ&lt;/a&gt;ï¼Œä¹Ÿéœ€è¦é˜…è¯»ä¸€ä¸‹&lt;a href=&apos;http://www.allthingsdistributed.com/files/amazon-dynamo-sosp2007.pdf&apos;&gt;è¿™ç¯‡ Dynamo è®ºæ–‡&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å•ä¸ªå¤±è´¥å‘ç”Ÿçš„å¯èƒ½æ€§å¯¹äºæˆ‘ä»¬å®ç°æ­£ç¡®çš„åˆ†å¸ƒå¼ç³»ç»Ÿåˆ°åº•ä¼šæœ‰å¤šå¤§çš„å½±å“ï¼ˆè¯·é˜…è¯»ä¸‹é¢å…³äº FLP ç»“æœçš„ç¬”è®°ï¼‰ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ä¸åŒçš„æ—¶é—´æ¨¡å‹ï¼šåŒæ­¥ã€éƒ¨åˆ†åŒæ­¥å’Œå¼‚æ­¥ï¼ˆè‹¥æˆ‘æ‰¾åˆ°å¥½çš„å‚è€ƒæ–‡çŒ®ä¼šæ·»åŠ é“¾æ¥ï¼‰&lt;/li&gt;&lt;/ul&gt;
&lt;h4&gt;å®¹é”™çš„åŸºæœ¬çŸ›ç›¾&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸€ä¸ªç³»ç»Ÿï¼Œè‹¥è¦ä¸é™çº§è€Œå®¹å¿æŸäº›é”™è¯¯çš„å‘ç”Ÿï¼Œå°±å¿…é¡»èƒ½å¤Ÿå¥½åƒé‚£äº›é”™è¯¯æ²¡æœ‰å‘ç”Ÿä¸€æ ·åœ°è¿ä½œã€‚è¿™é€šå¸¸æ„å‘³ç€ç³»ç»Ÿçš„è¿™äº›éƒ¨åˆ†å¿…é¡»èƒ½å¤Ÿå†—ä½™åœ°å·¥ä½œï¼Œä½†æ˜¯éç»å¯¹å¿…è¦åœ°åšæ›´å¤šçš„å·¥ä½œé€šå¸¸ä¼šåœ¨æ€§èƒ½å’Œèµ„æºè€—ç”¨æ–¹é¢äº§ç”Ÿä¸€äº›æ¶ˆè€—ã€‚è¿™æ˜¯ä¸ºç³»ç»Ÿæ·»åŠ å®¹é”™å¸¦æ¥çš„åŸºæœ¬çŸ›ç›¾ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½ åº”è¯¥çŸ¥é“ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ç¡®ä¿å•æ‹·è´å¯ä¸²è¡ŒåŒ–ï¼ˆsingle-copy serialisabilityï¼‰çš„ä»²è£ï¼ˆquorumï¼‰æŠ€æœ¯ã€‚å¯é˜…è¯» &lt;a href=&apos;https://ecommons.library.cornell.edu/bitstream/1813/6323/1/82-483.pdf&apos;&gt;Skeen çš„åŸå§‹è®ºæ–‡&lt;/a&gt;ï¼Œä½†å¯èƒ½æ›´å»ºè®®é˜…è¯»&lt;a href=&apos;http://en.wikipedia.org/wiki/Quorum_(distributed_computing&apos;&gt;è¿™ä¸ª Wikipedia è¯æ¡&lt;/a&gt;)ã€‚&lt;/li&gt;
&lt;li&gt;å…³äº&lt;a href=&apos;http://the-paper-trail.org/blog/consensus-protocols-two-phase-commit/&apos;&gt;ä¸¤é˜¶æ®µæäº¤&lt;/a&gt;ã€&lt;a href=&apos;http://the-paper-trail.org/blog/consensus-protocols-three-phase-commit/&apos;&gt;ä¸‰é˜¶æ®µæäº¤&lt;/a&gt;å’Œ &lt;a href=&apos;http://the-paper-trail.org/blog/consensus-protocols-paxos/&apos;&gt;Paxos&lt;/a&gt; ç®—æ³•ï¼Œä»¥åŠä¸ºä»€ä¹ˆå®ƒä»¬æœ‰ä¸åŒçš„å®¹é”™æ€§è´¨ã€‚&lt;/li&gt;
&lt;li&gt;æœ€ç»ˆä¸€è‡´æ€§ï¼ŒåŠå…¶ä»–æŠ€æœ¯æ˜¯å¦‚ä½•ä»¥å¼±åŒ–å¯¹ç³»ç»Ÿè¡Œä¸ºçš„ä¿è¯ä¸ºä»£ä»·æ¥å°è¯•é¿å…è¿™ç§çŸ›ç›¾çš„ã€‚è¿™ç¯‡ &lt;a href=&apos;http://www.allthingsdistributed.com/files/amazon-dynamo-sosp2007.pdf&apos;&gt;Dynamo è®ºæ–‡&lt;/a&gt;æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„èµ·ç‚¹ï¼ŒåŒæ—¶ Pat Helland çš„ç»å…¸ä¹‹ä½œ &lt;a href=&apos;http://www.ics.uci.edu/~cs223/papers/cidr07p15.pdf&apos;&gt;Life Beyond Transactions&lt;/a&gt; ä¹Ÿæ˜¯å¿…è¯»çš„ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;h4&gt;åŸºæœ¬çš„åŸè¯­&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¾ˆå°‘æœ‰å¤§å®¶ä¸€è‡´è®¤åŒçš„åŸºæœ¬æ„å»ºå—ï¼Œä½†è¶Šæ¥è¶Šå¤šåœ°åœ¨å‡ºç°ã€‚ä½ åº”è¯¥ä»¥ä¸‹çš„é—®é¢˜æ˜¯ä»€ä¹ˆï¼Œä»¥åŠåœ¨å“ªå¯ä»¥æ‰¾åˆ°å®ƒä»¬çš„è§£å†³æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ç¾¤é¦–é€‰ä¸¾ï¼ˆleader electionï¼‰ï¼ˆä¾‹å¦‚ &lt;a href=&apos;http://en.wikipedia.org/wiki/Bully_algorithm&apos;&gt;Bully ç®—æ³•&lt;/a&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;ä¸€è‡´çš„å¿«ç…§ï¼ˆä¾‹å¦‚ Chandy å’Œ Lamport æ‰€å†™çš„&lt;a href=&apos;http://research.microsoft.com/en-us/um/people/lamport/pubs/chandy.pdf&apos;&gt;ç»å…¸è®ºæ–‡&lt;/a&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;å…±è¯†ï¼ˆé˜…è¯»ä¸Šæ–‡æåˆ°çš„å…³äº 2PC å’Œ Paxos çš„åšæ–‡ï¼‰&lt;/li&gt;
&lt;li&gt;åˆ†å¸ƒå¼çŠ¶æ€æœºå¤åˆ¶ï¼ˆçœ‹çœ‹ &lt;a href=&apos;http://en.wikipedia.org/wiki/State_machine_replication&apos;&gt;Wikipedia&lt;/a&gt; å°±å¯ä»¥ï¼Œä½† &lt;a href=&apos;http://research.microsoft.com/en-us/um/people/blampson/58-Consensus/Acrobat.pdf&apos;&gt;Lampson çš„è®ºæ–‡&lt;/a&gt;æ›´æƒå¨ï¼Œåªæ˜¯æ¯ç‡¥äº†ç‚¹ï¼‰ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;h4&gt;åŸºç¡€ç»“è®º&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æŸäº›å®¢è§‚äº‹å®æ˜¯éœ€è¦å†…åŒ–äºå¿ƒçš„ï¼Œä»¥ä¸‹æ˜¯å‡ ä¸ªå…³é”®ç‚¹ï¼ˆa flavourï¼‰ï¼ˆå½“ç„¶è¿˜æœ‰æ›´å¤šï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å¦‚æœè¿›ç¨‹ä¹‹é—´å¯èƒ½ä¸¢å¤±æŸäº›æ¶ˆæ¯ï¼Œé‚£ä¹ˆä¸å¯èƒ½åœ¨å®ç°ä¸€è‡´æ€§å­˜å‚¨çš„åŒæ—¶èƒ½å“åº”æ‰€æœ‰çš„è¯·æ±‚ã€‚è¿™å°±æ˜¯ &lt;a href=&apos;http://lpd.epfl.ch/sgilbert/pubs/BrewersConjecture-SigAct.pdf&apos;&gt;CAP å®šç†&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä»¥è¿™æ ·ä¸€ç§æ–¹å¼ï¼ˆa.å§‹ç»ˆæ˜¯æ­£ç¡®çš„ã€b.å§‹ç»ˆèƒ½ç»ˆæ­¢-è‹¥åœ¨ä¸€ä¸ªå¯èƒ½å› å¤±è´¥å´©æºƒåœæ­¢ï¼ˆcrash-&lt;code&gt;*&lt;/code&gt; stop failuresï¼‰çš„å¼‚æ­¥ç³»ç»Ÿä¸­æœ‰ï¼ˆç”šè‡³ä»…ï¼‰ä¸€å°æœºå™¨å¤±æ•ˆæ—¶ï¼ˆFLP çš„ç»“æœï¼‰ï¼‰ã€‚æˆ‘å¸Œæœ›åœ¨&lt;a href=&apos;http://www.slideshare.net/HenryRobinson/pwl-nonotes&apos;&gt;æ´›æ‰çŸ¶é¢˜ä¸º Papers We Love æŠ¥å‘Š&lt;/a&gt;çš„ç¬¬ä¸€éƒ¨åˆ†å¹»ç¯ç‰‡-è¿›è¡Œè¯æ˜ä¹‹å‰-å·²ç»åˆç†åœ°è§£é‡Šäº†è¿™ä¸ªç»“è®ºã€‚&lt;em&gt;å»ºè®®ï¼šæ²¡æœ‰å®é™…çš„å¿…è¦ç†è§£è¿™ä¸ªè¯æ˜ã€‚&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;ä¸€èˆ¬è€Œè¨€ï¼Œæ¶ˆæ¯äº¤äº’å°‘äºä¸¤è½®æ˜¯ä¸å¯èƒ½è¾¾æˆå…±è¯†ï¼ˆConsensusï¼‰ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;h4&gt;çœŸå®ç³»ç»Ÿ&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ€é‡è¦çš„ç»ƒä¹ æ˜¯é‡å¤åœ°é˜…è¯»æ–°å…´çš„ã€çœŸå®ç³»ç»Ÿçš„æè¿°ï¼Œå¹¶å°è¯•è¯„ä»·å®ƒä»¬çš„è®¾è®¡å†³ç­–ã€‚ä¸€éåˆä¸€éåœ°è¿™æ ·å»åšã€‚ä¸€äº›å»ºè®®ï¼š&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;Google:&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;a href=&apos;http://static.googleusercontent.com/media/research.google.com/en/us/archive/gfs-sosp2003.pdf&apos;&gt;GFS&lt;/a&gt;ã€&lt;a href=&apos;http://static.googleusercontent.com/media/research.google.com/en/us/archive/spanner-osdi2012.pdf&apos;&gt;Spanner&lt;/a&gt;ã€&lt;a href=&apos;http://static.googleusercontent.com/media/research.google.com/en/us/pubs/archive/41344.pdf&apos;&gt;F1&lt;/a&gt;ã€&lt;a href=&apos;http://static.googleusercontent.com/media/research.google.com/en/us/archive/chubby-osdi06.pdf&apos;&gt;Chubby&lt;/a&gt;ã€&lt;a href=&apos;http://static.googleusercontent.com/media/research.google.com/en/us/archive/bigtable-osdi06.pdf&apos;&gt;BigTable&lt;/a&gt;ã€&lt;a href=&apos;http://static.googleusercontent.com/media/research.google.com/en/us/pubs/archive/41378.pdf&apos;&gt;MillWheel&lt;/a&gt;ã€&lt;a href=&apos;http://eurosys2013.tudos.org/wp-content/uploads/2013/paper/Schwarzkopf.pdf&apos;&gt;Omega&lt;/a&gt;ã€&lt;a href=&apos;http://static.googleusercontent.com/media/research.google.com/en/us/pubs/archive/36356.pdf&apos;&gt;Dapper&lt;/a&gt;ã€&lt;a href=&apos;http://www.cs.utexas.edu/users/lorenzo/corsi/cs380d/papers/paper2-1.pdf&apos;&gt;Paxos Made Live&lt;/a&gt;ã€&lt;a href=&apos;http://cacm.acm.org/magazines/2013/2/160173-the-tail-at-scale/abstract&apos;&gt;The Tail At Scale&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;Not Google:&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;a href=&apos;http://research.microsoft.com/en-us/projects/dryad/eurosys07.pdf&apos;&gt;Dryad&lt;/a&gt;ã€&lt;a href=&apos;https://www.cs.cornell.edu/projects/ladis2009/papers/lakshman-ladis2009.pdf&apos;&gt;Cassandra&lt;/a&gt;ã€&lt;a href=&apos;http://ceph.com/papers/weil-ceph-osdi06.pdf&apos;&gt;Ceph&lt;/a&gt;ã€&lt;a href=&apos;https://ramcloud.stanford.edu/wiki/display/ramcloud/RAMCloud+Papers&apos;&gt;RAMCloud&lt;/a&gt;ã€&lt;a href=&apos;http://hyperdex.org/papers/&apos;&gt;HyperDex&lt;/a&gt;ã€&lt;a href=&apos;http://www.mpi-sws.org/~druschel/courses/ds/papers/cooper-pnuts.pdf&apos;&gt;PNUTS&lt;/a&gt;&lt;/p&gt;</description>
            <pubDate>2014-08-10</pubDate>
            <link>https://blog.xiayf.cn/posts/ds-4-dse.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/ds-4-dse.html</guid>
        </item>
        
        <item>
            <title>ä»“åº“ä½œä¸šæœºå™¨ç›‘æ§ç³»ç»Ÿè®¾è®¡ä¸å®ç°</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;è¿‘æœŸåœ¨å‚ä¸ä¸€ä¸ªä»“åº“ä½œä¸šæœºå™¨ç›‘æ§é¡¹ç›®ã€‚è¯¥é¡¹ç›®çš„éœ€æ±‚èƒŒæ™¯æ˜¯ï¼šå…¬å¸çš„ç”µå•†ä¸šåŠ¡åœ¨å…¨å›½å„åœ°æœ‰å¤šå¤„æˆ–å¤§æˆ–å°çš„ä»“åº“ï¼Œä»“åº“çš„ä½œä¸šäººå‘˜ï¼ˆæ²¡æœ‰ITæŠ€æœ¯èƒŒæ™¯ï¼‰ç»å¸¸åé¦ˆ/æŠ•è¯‰ä½œä¸šæœºå™¨æ–­ç½‘ã€æ–­ç”µã€è¿ä¸äº†æœåŠ¡ç­‰é—®é¢˜ã€‚å®é™…æƒ…å†µç»å¸¸ä¸åé¦ˆçš„ä¸ä¸€è‡´ï¼Œä½†è¿ç»´ä¾§å¹¶æ²¡æœ‰æ•°æ®å¯ä»¥è¯æ˜ï¼Œæ‰€ä»¥æ‰æœ‰äº†è¿™ä¸ªé¡¹ç›®çš„éœ€æ±‚ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¯¥é¡¹ç›®ç¬¬ä¸€æœŸçš„ç›®æ ‡ä»…æ˜¯&lt;em&gt;æ”¶é›†ã€å±•ç¤ºä½œä¸šæœºå™¨æŸäº›ç›‘æ§æŒ‡æ ‡æ•°æ®ï¼Œä»¥ä¾¿åœ¨å¿«é€Ÿå®šä½è§£å†³é—®é¢˜ï¼Œæˆ–è‡³å°‘æœ‰æ•°æ®å¯æŸ¥&lt;/em&gt;ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸ºäº†é¿å…å¤§é‡ç›‘æ§æ•°æ®ä¸ŠæŠ¥å½±å“åˆ°ç”Ÿäº§ç³»ç»Ÿçš„ç½‘ç»œæœåŠ¡ï¼Œç³»ç»Ÿé‡‡ç”¨å¦‚ä¸‹ç»“æ„ï¼š&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/EfLNUvneo3D1trl.png&apos; title=&apos;inner_warehouse_monitor&apos; alt=&apos;inner_warehouse_monitor&apos; width=&apos;600&apos;/&gt;
&lt;ol&gt;&lt;li&gt;å®ç°ä¸€ä¸ª agent ç”¨äºåœ¨ä»“åº“ä½œä¸š PC æˆ–ä½œä¸š PDA ä¸Šè·å–æœºå™¨çš„ç›‘æ§æ•°æ®ï¼›&lt;/li&gt;
&lt;li&gt;åœ¨ä»“åº“æœ¬åœ°æœåŠ¡å™¨ä¸Šå®ç°ä¸€ä¸ªæ•°æ®æ”¶é›†å¤„ç†æœåŠ¡ï¼Œæä¾› API ç»™ agent ä¸Šä¼ ç›‘æ§æ•°æ®ï¼›æ•°æ®æ”¶é›†å¤„ç†æœåŠ¡ä¼šå°†æ¥æ”¶åˆ°çš„æ•°æ®æŒä¹…åŒ–åˆ°æ•°æ®åº“ï¼Œæä¾›ç»™ä»“åº“æœ¬åœ°æœåŠ¡å™¨ä¸Šçš„ webApp è¿›è¡Œæ•°æ®å±•ç¤ºç­‰ï¼›&lt;/li&gt;
&lt;li&gt;ä¸­å¿ƒæœåŠ¡å™¨å¯ä»¥è°ƒç”¨å„ä¸ªä»“åº“æœ¬åœ°æœåŠ¡å™¨ä¸Šçš„ webApp æä¾›çš„æ•°æ®æŸ¥è¯¢æ¥å£ï¼ˆæ•°æ®ç”¨äºå®šä½ã€å‘ç°é—®é¢˜ï¼‰ï¼›å®šæœŸæŒ‰éœ€å¯¹å„ä¸ªä»“åº“æœ¬åœ°æœåŠ¡å™¨ä¸Šçš„æ•°æ®è¿›è¡Œå½’æ¡£ã€‚&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™æ ·ï¼Œä¸»è¦çš„å·¥ä½œéƒ½é›†ä¸­åœ¨&lt;strong&gt;ä½œä¸šæœºå™¨ä¸Šçš„ agent&lt;/strong&gt; å’Œ&lt;strong&gt;æ•°æ®æ”¶é›†å¤„ç†æœåŠ¡ã€webApp&lt;/strong&gt;ã€‚è¿™å…¶ä¸­æœ€å…³é”®çš„åˆæ˜¯&lt;strong&gt;æ•°æ®æ”¶é›†å¤„ç†æœåŠ¡&lt;/strong&gt;ã€‚è€ƒè™‘åˆ°éœ€è¦å¤šåœ°éƒ¨ç½²è¿ç»´ä»“åº“æœ¬åœ°æœåŠ¡å™¨ï¼Œè€Œä¸”æŸäº›å¤§ä»“åº“ä½œä¸šæœºå™¨çš„æ•°ç›®ç›®å‰å·²å¤šè¾¾800-1000ï¼Œæˆ‘ä»¬åšäº†å¦‚ä¸‹æŠ€æœ¯é€‰å‹ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;Golang å®ç° agentã€æ•°æ®æ”¶é›†å¤„ç†æœåŠ¡ã€webAppï¼›&lt;/li&gt;
&lt;li&gt;ä»¥ SQLite ä½œä¸ºæ•°æ®åº“æ¥å­˜å‚¨agentä¸ŠæŠ¥çš„æ‰€æœ‰æ•°æ®ï¼›&lt;/li&gt;
&lt;li&gt;ä»¥ &lt;a href=&apos;http://bitly.github.io/nsq/&apos;&gt;NSQ&lt;/a&gt; ä½œä¸ºå¼‚æ­¥æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶ï¼›&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é€‰ç”¨ Golang çš„ç†ç”±æ˜¯ï¼šå¯ä»¥é™æ€ç¼–è¯‘ï¼Œéƒ¨ç½²ç®€å•ï¼Œåªéœ€å°†ç¼–è¯‘å¥½çš„å¯æ‰§è¡ŒäºŒè¿›åˆ¶ç¨‹åºä¸¢åˆ°æœåŠ¡å™¨ä¸Šè·‘èµ·æ¥å°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é€‰ç”¨ SQLite çš„ç†ç”±æ˜¯ï¼šä¸å¿…åƒ MySQL é‚£æ ·å®‰è£… server ç¨‹åºï¼Œæ— éœ€é¢å¤–éƒ¨ç½²ç»´æŠ¤ã€‚å½“ç„¶ SQLite çš„æ–‡ä»¶é”ä¼šå¤§å¤§å½±å“æ•°æ®åº“è¯»å†™æ€§èƒ½ï¼Œæˆ‘ä»¬é€šè¿‡å°½å¯èƒ½æ‹†åˆ†æ•°æ®åº“ï¼Œå°†ä¸åŒçš„æŒ‡æ ‡æ•°æ®å­˜å‚¨åœ¨ä¸åŒçš„ SQLite DB æ–‡ä»¶ä¸­ï¼Œç”šè‡³å°†æ¯å°ä½œä¸šæœºå™¨æ¯ä¸ªæŒ‡æ ‡çš„æ¯å¤©çš„æ•°æ®åˆ†åˆ«å­˜å‚¨åœ¨ä¸åŒçš„ DB æ–‡ä»¶ä¸­ï¼Œæ¥å°½å¯èƒ½å‡å°æ–‡ä»¶é”çš„æ€§èƒ½å½±å“ï¼Œç›®å‰çœ‹æ¥æ•ˆæœè¿˜ä¸é”™ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é€‰æ‹© NSQ çš„ç†ç”±æ˜¯ï¼šGolang å®ç°ã€åˆ†å¸ƒå¼ã€ä¼¸ç¼©æ€§å¥½ã€æ€§èƒ½é«˜ã€æ”¯æŒ HTTP/TCP åè®®ã€è‡ªå¸¦webç®¡ç†ç•Œé¢ç­‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¯¦ç»†çš„ç³»ç»Ÿç»“æ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/OwhHWZbmcofzRue.png&apos; title=&apos;inner_warehouse_monitor-arch&apos; alt=&apos;inner_warehouse_monitor-arch&apos; width=&apos;600&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;NSQ æ”¯æŒå¤š topicï¼ˆä¸åŒ topic çš„æ•°æ®ä¸åŒï¼‰ï¼Œtopic åˆå¯ä»¥æœ‰å¤šä¸ª channelï¼ˆåŒä¸€ä¸ª topic çš„æ‰€æœ‰channelä¸­çš„æ•°æ®ç›¸åŒï¼Œä»¥å¤šæ’­çš„æ–¹å¼å®ç°ï¼Œæ¯ä¸ª channel åœ¨ client ä¸­æœ‰ä¸€ä¸ªå¯¹åº”çš„å¤„ç†æµç¨‹æ¥å¤„ç† channel ä¸­çš„æ•°æ®ï¼‰ã€‚æˆ‘ä»¬å°†ä½œä¸šæœºå™¨ä¸åŒçš„ç›‘æ§æŒ‡æ ‡æ•°æ®ä½œä¸ºä¸åŒ topic ä¼ å…¥ NSQï¼Œå¤šæ•°æŒ‡æ ‡æ•°æ®åªéœ€æŒä¹…åŒ–åˆ°æ•°æ®åº“ä»¥å¤‡åç”¨ï¼Œæ‰€ä»¥è¿™äº› topic ä»…éœ€ä¸€ä¸ª channelã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;webApp åŸºäº Beego æ¡†æ¶å®ç°ï¼Œé¿å…é‡å¤é€ è½®å­ã€å·¥ä½œé‡å°ã€‚webAppä¸­çš„æ•°æ®å±•ç¤ºé‡‡ç”¨ HighChartsã€Raphael å®ç°ï¼Œå…¼å®¹æ€§å¥½ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äºæœºå™¨æŒ‡æ ‡æ•°æ®ï¼Œå…¶å®ä¸åº”è¯¥ä½¿ç”¨å…³ç³»å‹æ•°æ®åº“æ¥å­˜å‚¨ï¼Œå› ä¸ºè¿™ç§æ•°æ®çš„ç‰¹ç‚¹æ˜¯ï¼šå†™å…¥ä¹‹ååªè¯»ä¸æ”¹ã€æ—¶é—´åºåˆ—çš„ã€å‡ ä¹æ²¡æœ‰å…³ç³»å‹çš„è¯»å–æ“ä½œã€è¿ç»­æ‰¹é‡æ•°æ®è¯»å–ï¼Œæ‰€ä»¥å¼€æºç›‘æ§ç³»ç»Ÿå¦‚ Cactiã€Ganglia ç­‰å‡ä½¿ç”¨ RRDtool æ¥è¯»å†™æŒ‡æ ‡æ•°æ®ã€‚æ‰€ä»¥å¦‚ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å°†æŒ‡æ ‡æ•°æ®çš„å­˜å‚¨å°½å¯èƒ½åœ°æ‹†åˆ†æˆå¤šä¸ªæ–‡ä»¶ä»¥æé«˜è¯»å†™æ€§èƒ½è€Œä¸ä¼šé€ æˆå…¶ä»–é—®é¢˜ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç³»ç»Ÿçš„å·¥ä½œæµç¨‹å¦‚ä¸‹æ‰€è¿°ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;ä½œä¸šæœºå™¨ä¸Šçš„ agent å¯åŠ¨åä¼šå…ˆå‘ NSQ çš„ register topic å‘é€ä¸€ä¸ªæ³¨å†Œæ¶ˆæ¯ï¼ŒNSQ Client æ ¹æ®è¯¥æ³¨å†Œæ¶ˆæ¯åœ¨ register æ•°æ®è¡¨ä¸­å°†è¯¥ä½œä¸šæœºå™¨çš„çŠ¶æ€æ”¹ä¸ºâ€œæ­£å¸¸è¿è¡Œä¸­â€ï¼›&lt;/li&gt;
&lt;li&gt;ç„¶åï¼Œagent å®šæœŸä¸ŠæŠ¥ç›‘æ§æ•°æ®åˆ° NSQï¼ŒNSQ Client ä¸­å„ç§æ•°æ®çš„å¤„ç†æµç¨‹å°†æ•°æ®æŒä¹…åŒ–åˆ° SQLite æ•°æ®åº“æ–‡ä»¶ï¼›&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·è®¿é—®/ä¸­å¿ƒæœåŠ¡å™¨è°ƒç”¨APIæ—¶ï¼ŒwebApp è¯»å– SQLite æ•°æ®åº“ï¼›&lt;/li&gt;
&lt;li&gt;æœ‰ä¸€ä¸ª Goroutine é’ˆå¯¹æ³¨å†Œè¿‡çš„ä½œä¸šæœºå™¨å®šæœŸæ£€æµ‹3åˆ†é’Ÿä»¥å†…æ˜¯å¦æ”¶åˆ°è¿‡å…¶ä¸ŠæŠ¥çš„å¿ƒè·³æ•°æ®ï¼Œè‹¥æœªæ”¶åˆ°ï¼Œåˆ™å°†æœºå™¨çŠ¶æ€ä»â€œæ­£å¸¸è¿è¡Œä¸­â€æ”¹æˆâ€œè¿è¡Œå¼‚å¸¸â€ï¼Œè‹¥æ”¶åˆ°ï¼Œåˆ™å°†â€œè¿è¡Œå¼‚å¸¸â€æ”¹ä¸ºâ€œæ­£å¸¸è¿è¡Œä¸­â€ï¼›&lt;/li&gt;
&lt;li&gt;ä½œä¸šæœºå™¨åœ¨æ­£å¸¸å…³æœºæ—¶ä¼šå‘ NSQ çš„ register topic å‘é€ä¸€ä¸ªæ­£å¸¸å…³æœºçš„æ¶ˆæ¯ï¼ŒClient è¯»å–åˆ°è¯¥æ¶ˆæ¯åï¼Œä¼šå°†è¯¥æœºå™¨åœ¨ register æ•°æ®è¡¨ä¸­çš„çŠ¶æ€æ”¹ä¸ºâ€œå·²æ­£å¸¸å…³æœºâ€ã€‚&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç›®å‰ï¼Œç³»ç»Ÿå·¥ä½œè‰¯å¥½ã€‚ä¹‹åä¼šå¯¹ç³»ç»Ÿåšå‹æµ‹ï¼Œå¦‚æœå‡ºç°ç“¶é¢ˆï¼Œä¼°è®¡å¯èƒ½è¿˜æ˜¯æ•°æ®å­˜å‚¨ï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬å¯èƒ½ä¼šå°è¯• RRDtool æˆ– &lt;a href=&apos;http://influxdb.org/&apos;&gt;InfluxDB&lt;/a&gt;ã€‚&lt;/p&gt;</description>
            <pubDate>2013-11-29</pubDate>
            <link>https://blog.xiayf.cn/posts/inner-warehouse-monitor-system.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/inner-warehouse-monitor-system.html</guid>
        </item>
        
        <item>
            <title>è¯»ä¹¦ï¼šJust For Fun - The Story of an Accidental Revolutionary</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;å‰äº›å¤©å¶ç„¶åœ¨å›¾çµç¤¾åŒºä¸Šçœ‹åˆ°&lt;a href=&apos;http://www.ituring.com.cn/book/1115?q=%E8%B6%8A%E7%8E%A9%E8%B6%8A%E5%A4%A7&apos;&gt;è¿™æœ¬ä¹¦çš„å‡ºç‰ˆè®¡åˆ’&lt;/a&gt;ï¼Œæ‰çŒ›ç„¶æƒ³èµ·ä¹‹å‰çœ‹è¿‡ä¸€ä¸¤ä¸ªç« èŠ‚ï¼Œé‚å†æ¬¡æ‰¾åˆ°è¯¥ä¹¦çš„&lt;a href=&apos;http://ishare.iask.sina.com.cn/f/14439267.html&apos;&gt;ä¸­æ–‡ç”µå­ç‰ˆ&lt;/a&gt;ï¼ˆ&lt;em&gt;åŸè°…æˆ‘&lt;/em&gt;ï¼‰ï¼ˆå…³äºè¯¥ç”µå­ç‰ˆï¼Œæˆ‘ä¸æ¸…æ¥šå…¶æ¥æºã€‚ä¸­å›½é’å¹´å‡ºç‰ˆç¤¾å‡ºè¿‡è¯¥ä¹¦çš„ä¸­æ–‡ç‰ˆï¼Œè¯‘åä¸ºã€Šä¹è€…ä¸ºç‹ã€‹ï¼Œä¸çŸ¥è¯¥ç”µå­ç‰ˆå³ä¸ºè¯¥ä¸­æ–‡ç‰ˆï¼Œè¿˜æ˜¯å¼€æºçˆ±å¥½è€…è‡ªå·±ç¿»è¯‘ã€‚ä¸è¿‡ç¿»è¯‘è´¨é‡ä¸é«˜ï¼Œåº”è¯¥ä¸æ˜¯æ­£å¼å‡ºç‰ˆçš„ï¼‰ï¼ŒèŠ±äº†ä¸€å¤©å·¦å³æ—¶é—´çœ‹å®Œã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ¬ä¹¦ç”± Linus Torvalds å’Œ David Diamond åˆè‘—ï¼Œä¹¦å†™æ–¹å¼æ˜¯ Linus è‡ªè¿°ï¼Œç©¿æ’ David Diamond çš„ä¸€äº›é‡‡è®¿æ—ç™½ï¼Œä¸»è¦è®²è¿° Linus å¦‚ä½•å¶ç„¶åœ°æˆä¸ºä¿¡æ¯æ—¶ä»£çš„ä¸€ä¸ªé©å‘½è€…ï¼ˆThe Story of an Accidental Revolutionaryï¼‰ã€‚Linus åœ¨ä¹¦ä¸­è¡¨è¾¾äº†å¯¹ Linux è¿™ä¸€ä¼Ÿå¤§çš„å¼€æºé¡¹ç›®çš„çœ‹æ³•ã€å¯¹äºäººç”Ÿæ„ä¹‰ã€äº‹ç‰©å‘å±•è§„å¾‹ç­‰é—®é¢˜çš„ä¸ªäººç†è§£ã€‚ä»¥ä¸‹æ˜¯ä¹¦ä¸­è®©æˆ‘å°è±¡æ¯”è¾ƒæ·±åˆ»çš„å‡ å¤„å†…å®¹ï¼š&lt;/p&gt;
&lt;h2&gt;ç”Ÿæ´»çš„æ„ä¹‰&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äºè¿™ä¸€å“²å­¦æ€§çš„é—®é¢˜ï¼Œä¼°è®¡ç°åœ¨å¾ˆå¤šäººè§åˆ°éƒ½ä¼šå‘ç¬‘ã€‚æœ¬ä¹¦ä»¥è¿™ä¸ªé—®é¢˜çš„è®¨è®ºå¼€å§‹ï¼Œå¹¶ä»¥è¿™ä¸ªé—®é¢˜ç»“å°¾ã€‚Linuså¹¶æ²¡æœ‰ç›´æ¥åœ°å›ç­”ï¼Œè€Œæ˜¯ä¸¾ä¾‹è¯´æ˜äººç±»ç¤¾ä¼šçš„äº‹ç‰©å‘å±•éƒ½å¿…ç„¶ç»è¿‡ä¸‰ä¸ªé˜¶æ®µ---ç”Ÿå­˜ã€ç¤¾ä¼šç§©åºã€å¨±ä¹ï¼Œé‚£ä¹ˆç”Ÿæ´»çš„æ„ä¹‰å°±æ˜¯ä¿ƒæˆè¿™ä¸€å‘å±•è¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;æçº³æ–¯ï¼šè¿™ä¸ªç­”æ¡ˆåŸºæœ¬ä¸Šç®€å•è€Œæ¼‚äº®ã€‚ å®ƒä¸ä¼šç»™ä½ çš„ç”Ÿæ´»ä»¥ä»»ä½•æ„ä¹‰ï¼Œä½†å¯ä»¥å‘Šè¯‰ä½ å°†å‘ç”Ÿä»€ä¹ˆã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ‰ä¸‰ä»¶äº‹å…·æœ‰ç”Ÿå‘½çš„æ„ä¹‰ã€‚å®ƒä»¬æ˜¯ä½ ç”Ÿæ´»å½“ä¸­æ‰€æœ‰äº‹æƒ…çš„åŠ¨æœºï¼ŒåŒ…æ‹¬ä½ æ‰€åšçš„ä»»ä½•äº‹æƒ…å’Œä¸€ä¸ªç”Ÿå‘½ä½“è¯¥åšçš„æ‰€æœ‰äº‹æƒ…ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç¬¬ä¸€æ˜¯ç”Ÿå­˜ï¼Œç¬¬äºŒæ˜¯ç¤¾ä¼šç§©åºï¼Œç¬¬ä¸‰æ˜¯å¨±ä¹ã€‚ç”Ÿæ´»ä¸­æ‰€æœ‰çš„äº‹æƒ…éƒ½æ˜¯æŒ‰è¿™ä¸ªé¡ºåºå‘å±•çš„ã€‚å¨±ä¹ä¹‹åä¾¿ä¸€æ— æ‰€çš„ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å› æ­¤ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œè¿™æ„å‘³ç€ç”Ÿæ´»çš„æ„ä¹‰å°±æ˜¯è¦è¾¾åˆ°ç¬¬ä¸‰ä¸ªé˜¶æ®µã€‚ä½ ä¸€æ—¦è¾¾åˆ°äº†ç¬¬ä¸‰ä¸ªé˜¶æ®µï¼Œå°±ç®—æˆåŠŸäº†ã€‚ä½†é¦–å…ˆè¦è¶Šè¿‡å‰ä¸¤ä¸ªé˜¶æ®µã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘è®¤ä¸ºè¿™ä¸€ç†è§£æ˜¯éå¸¸æ¼‚äº®çš„ã€‚å¯¹äºè¯¥é—®é¢˜ï¼ˆæˆ‘ä¸ºä»€ä¹ˆè€Œæ´»ï¼Ÿï¼‰ï¼Œä»¥å‰æˆ‘ä¹Ÿæ€è€ƒäº†å¾ˆå¤šï¼Œä½†æœ€åçš„ç­”æ¡ˆç«Ÿç„¶æ˜¯---æ´»ç€æœ¬æ¥å°±æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œä¸€åˆ‡æ„ä¹‰éƒ½æ˜¯äººä¸ºåœ°èµ‹äºˆã€‚ç­”æ¡ˆå¾ˆæ‚²è§‚ï¼ŒLinus çš„ç­”æ¡ˆæœ¬è´¨ä¸Šä¹Ÿæ˜¯å¦‚æ­¤ï¼Œåªä¸è¿‡é¿å…äº†ç›´æ¥é¢å¯¹è¯¥é—®é¢˜ï¼Œä»¥é¡ºä»äº‹ç‰©å‘å±•è§„å¾‹ä½œä¸ºç”Ÿæ´»çš„æ„ä¹‰ï¼Œå¯¹æˆ‘æœ‰æ‰€å¯å‘ï¼Œä¹Ÿè®©æˆ‘å¤šäº†äº›ç”Ÿæ´»çš„â€œæ­£èƒ½é‡â€ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äºæœªæ¥çš„é¢„è¨€ï¼Œç‰¹åˆ«æ˜¯è®¡ç®—æœºè¡Œä¸šçš„å‘å±•ï¼ŒLinus åŒæ ·å¹¶æ²¡æœ‰ç›´æ¥å›ç­”é—®é¢˜ï¼ŒåŒæ ·åœ°ä»¥æ­¤ä½œä¸ºå›ç­”ï¼šäººä»¬å¹¶ä¸æ˜¯çœŸçš„éœ€è¦è®¡ç®—æœºï¼ˆåŒ…å«ç½‘ç»œç­‰ç­‰ï¼‰ï¼Œè€Œæ˜¯éœ€è¦åŸºäºè®¡ç®—æœºå®ç°ç”Ÿå­˜ã€ç¤¾ä¼šç§©åºã€å¨±ä¹ä¸‰ä¸ªç›®æ ‡ï¼Œé‚£ä¹ˆæœªæ¥çš„ä¸€åˆ‡ã€è®¡ç®—æœºè¡Œä¸šçš„å‘å±•å¿…ç„¶æ˜¯æ›´å¥½åœ°å¸®åŠ©äººä»¬å®ç°è¿™ä¸‰ä¸ªç›®æ ‡ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;em&gt;å…³äºå¨±ä¹ï¼Œæœ‰æœ¬ä¹¦ã€Šå¨±ä¹è‡³æ­»ã€‹è¡¨è¾¾äº†å¯¹äººç±»ç¤¾ä¼šå‘å±•æ³›å¨±ä¹åŒ–ã€ç‰¹åˆ«æ˜¯æ•™è‚²è¶‹å‘å¨±ä¹åŒ–çš„æ‹…å¿§ã€‚ä»å¦ä¸€è§’åº¦ä½è¯äº† Linus çš„çœ‹æ³•ï¼Œåªä¸è¿‡ä¸€æ¶ˆææ‚²è§‚ï¼Œä¸€ç§¯æä¹è§‚ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;h2&gt;ä¸Andrew S. Tanenbaumçš„äº‰è®º&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸€äº‹ä»¶åœ¨ Wikipedia ä¸Šè¿˜æœ‰ä¸“é—¨çš„è¯æ¡-&lt;a href=&apos;http://en.wikipedia.org/wiki/Tanenbaum%E2%80%93Torvalds_debate&apos;&gt;Tanenbaum-Torvalds debate&lt;/a&gt;ã€‚ä»¥å‰ä¹Ÿå…³æ³¨è¿‡è¯¥äº‹ä»¶ï¼Œä½†æŠŠé—®é¢˜çš„é‡å¿ƒæ”¾åœ¨äº†â€œå¾®å†…æ ¸ï¼ˆMicro kernelï¼‰â€å’Œâ€œå®å†…æ ¸ï¼ˆMonolithic kernelï¼‰â€çš„ä¼˜ç¼ºç‚¹ä¸Šï¼Œçœ‹äº†è¯¥ä¹¦ä¹‹åæ‰çœŸæ­£ç†è§£ Linus çš„é€‰æ‹©ï¼Œå¹¶èµåŒä»–çš„çœ‹æ³•ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸€äº‰è®ºçš„åŸæ–‡è§&lt;a href=&apos;https://groups.google.com/forum/#!topic/comp.os.minix/wlhw16QWltI%5B1-25-false%5D&apos;&gt;é‚®ä»¶åˆ—è¡¨&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äº Tanenbaum æå‡ºçš„é—®é¢˜ï¼ŒLinus åšäº†å¦‚ä¸‹å›ç­”ï¼š&lt;/p&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;å®‰å¾·é²å¡”å—é²å§†å†™é“ï¼š&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&gt;æˆ‘åœ¨ç¾å›½å¾…äº†å‡ ä¸ªæ˜ŸæœŸï¼Œæ‰€ä»¥æ²¡æ¥å¾—åŠå¯¹Linuxåšå¤šå°‘è¯„è®º(ä¸æ˜¯è¯´å¦‚æœæˆ‘åœ¨ï¼Œæˆ‘å°±ä¼šè¯´ä»€ä¹ˆ)ã€‚ä½†æ˜¯ï¼ŒLinux ç¡®å®å€¼å¾—ä¸€è¯„ã€‚æˆ‘ç°åœ¨å°±æœ‰è¯è¦è¯´ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&gt;æ­£å¦‚ä½ ä»¬æ‰€çŸ¥ï¼ŒMINIX åªæ˜¯æˆ‘çš„çˆ±å¥½ï¼Œæ¯å½“æ™šä¸Šæˆ‘å†™çƒ¦äº†ä¹¦ï¼Œå¦‚æœå½“æ—¶æ²¡æœ‰ä»€ä¹ˆæˆ˜äº‰ã€ é©å‘½ã€ ç›´æ’­çš„å‚è®®é™¢å¬æ”¿ä¼šï¼Œæˆ‘å°±ä¼šæ‘†å¼„ MINIXã€‚æˆ‘çš„çœŸæ­£èŒä¸šæ˜¯å¤§å­¦æ•™æˆå’Œæ“ä½œç³»ç»Ÿé¢†åŸŸä¸­çš„ç ”ç©¶äººå‘˜ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½ ç”¨è¿™ä¸ªä½œä¸º MINIX å±€é™æ€§çš„å€Ÿå£ï¼Ÿå¯¹ä¸èµ·ï¼Œä½†æ˜¯ä½ è¾“äº†ã€‚æˆ‘çš„å€Ÿå£æ¯”ä½ çš„è¿˜å¤šï¼Œè€Œ Linux åœ¨å¾ˆå¤šé¢†åŸŸè¿˜æ˜¯èƒœ MINIX ä¸€ç­¹ã€‚æ›´åˆ«è¯´ MINIX çš„å¤§éƒ¨åˆ†ä¼¼ä¹æ˜¯ç”±å¸ƒé²æ–¯?ä¼Šæ–‡æ–¯ç¼–å†™çš„äº†ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åé©³ä¸€ï¼šä½ è¯´ä½ æŠŠ MINIX å½“ä½œçˆ±å¥½æ¥ç©â€•â€•é‚£ä¹ˆï¼Œè¯·é—®æ˜¯è°åœ¨æ‹¿ MINIX æŒ£é’±å‘¢ï¼Ÿåˆæ˜¯è°åœ¨å…è´¹å‘é€ Linux å‘¢ï¼Ÿå†æ¥è°ˆè°ˆçˆ±å¥½ã€‚è®© MINIX èƒ½å…è´¹è·å¾—ï¼Œæˆ‘å¯¹ MINIX çš„æœ€å¤§æŠ±æ€¨å°±ä¼šæ¶ˆå¤±ã€‚Linux åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå¯¹æˆ‘æ˜¯ä¸€ä¸ªçˆ±å¥½(ä½†æ˜¯ä¸€ä¸ªå¾ˆä¸¥è‚ƒçš„çˆ±å¥½ï¼Œæœ€æ£’çš„ä¸€ç§çˆ±å¥½)ã€‚æˆ‘æ²¡æœ‰ä»æˆ‘çš„çˆ±å¥½ä¸­èµšä¸€åˆ†é’±ï¼Œå®ƒä¹Ÿä¸æ˜¯æˆ‘åœ¨å¤§å­¦è¦ä¿®çš„è¯¾ç¨‹ä¹‹ä¸€ã€‚æˆ‘æ˜¯çº¯ç²¹ç”¨æˆ‘è‡ªå·±çš„æ—¶é—´ï¼Œåœ¨è‡ªå·±çš„æœºå™¨ä¸Šåšå‡ºæ¥çš„ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åé©³äºŒï¼šä½ æ˜¯æ•™æˆå’Œç ”ç©¶äººå‘˜ã€‚è¿™çœŸæ˜¯ä¸€ä¸ª MINIX å‡ºç°æ ¸å¿ƒç¼ºé™·çš„å¥½å€Ÿå£ã€‚æˆ‘åªèƒ½å¸Œæœ› Amoeba ä¸ä¼šåƒ MINIX é‚£æ ·å®æ‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&gt;1.å¾®å†…æ ¸å¯¹ Monolithic system&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ²¡é”™ï¼ŒLinux æ˜¯ Monolithic çš„ï¼Œæˆ‘åŒæ„å¾®å†…æ ¸æ˜¯å¥½ä¸€ç‚¹å„¿ã€‚ å¦‚æœä¸æ˜¯ä½ çš„è¯é¢˜æœ‰äº‰è®®æ€§ï¼Œæˆ‘å¯èƒ½ä¼šåŒæ„ä½ çš„å¤§éƒ¨åˆ†æ„è§ã€‚ä»ç†è®ºè§’åº¦(åŠå®¡ç¾è§’åº¦)è€Œè¨€ï¼ŒLinux è¾“äº†ã€‚å¦‚æœ GNU çš„ kernel åœ¨å»å¹´æ˜¥å¤©å°±å·²å®Œå–„çš„è¯ï¼Œæˆ‘å¯èƒ½å°±ä¸ä¼šå¼€å§‹è¿™ä¸ªå·¥ç¨‹ã€‚è€Œäº‹å®æ˜¯ï¼ŒGNU è¿˜æ²¡æœ‰å®Œå–„ï¼Œä¹Ÿè¿œéå¦‚æ­¤ã€‚å¦‚æœç°åœ¨å°±å·²å®ç°çš„è¿™ä¸€ç‚¹è€Œè®ºï¼ŒLinuxæ‰å¤§è·å…¨èƒœã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&gt;MINIX æ˜¯ä¸€ä¸ªåŸºäºå¾®å†…æ ¸çš„ç³»ç»Ÿã€‚Linux æ˜¯ Monolithic çš„ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœè¿™æ˜¯åˆ¤æ–­ä¸€ä¸ª kernel å¥½åçš„å”¯ä¸€æ ‡å‡†ï¼Œä½ çš„è§‚ç‚¹å°±å¯¹äº†ã€‚ä½†ä½ æ²¡æåˆ°çš„æ˜¯ï¼ŒMINIX åœ¨å¾®å†…æ ¸æ–¹é¢çš„è¡¨ç°å¹¶ä¸å‡ºè‰²ï¼Œè€Œä¸”å¯¹æ ¸å†…çœŸæ­£çš„å¤šä»»åŠ¡æ“ä½œä»å­˜åœ¨ç€é—®é¢˜ã€‚ å¦‚æœæˆ‘åšçš„æ˜¯ä¸€ä¸ªåœ¨å¤šçº¿ç¨‹æ–‡ä»¶ç³»ç»Ÿä¸Šæœ‰é—®é¢˜çš„ OS çš„è¯ï¼Œæˆ‘å°±ä¸ä¼šè¿™ä¹ˆå¿«æ¥è´£å¤‡åˆ«äººã€‚è€Œäº‹å®ä¸Šï¼Œæˆ‘ç«­å°½æ‰€èƒ½æ¥ä½¿äººä»¬å¿˜è®°è½¯ä»¶è®¾è®¡è€…åœ¨æ­¤é—®é¢˜ä¸Šçš„æƒ¨è´¥ã€‚(æ˜¯çš„ï¼Œæˆ‘çŸ¥é“ MINIX æ‹¥æœ‰ä¼—å¤šé»‘å®¢æ”¯æŒè€…ï¼Œä½†ä»–ä»¬åªæ˜¯é»‘å®¢ã€‚è€Œå¸ƒé²æ–¯?ä¼Šæ–‡æ–¯å‘Šè¯‰æˆ‘æœ‰å¾ˆå¤šå¯ä»¥ç«äº‰çš„æœºä¼šã€‚)&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&gt;2.å¯ç§»æ¤æ€§&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;â€œå¯ç§»æ¤æ€§æ˜¯ç»™é‚£äº›å†™ä¸å‡ºæ–°ç¨‹åºçš„äººä»¬å‡†å¤‡çš„ã€‚â€&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;â€•â€•æˆ‘ï¼Œç°åœ¨åˆšè¯´çš„ï¼Œå£å‡ºç‹‚è¨€&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;äº‹å®ä¸Šï¼ŒLinux æ¯” MINIX æ›´å…·æœ‰å¯ç§»æ¤æ€§ã€‚ â€œä½ è¯´ä»€ä¹ˆï¼Ÿâ€æˆ‘å¬è§ä½ è¯´ã€‚ æ˜¯çœŸçš„â€•â€•ä½†å´ä¸æ˜¯åœ¨ä½ æ‰€è¯´çš„æ„ä¹‰ä¸Šã€‚æˆ‘ä½¿ Linux å°½é‡ç¬¦åˆæ ‡å‡†(æˆ‘å½“æ—¶æ‰‹è¾¹å¹¶æ²¡æœ‰ POSIX æ ‡å‡†)ã€‚ æŠŠç¨‹åºç§»æ¤åˆ° Linux ä¸Šæ¯”åˆ° MINIX ä¸Šè¦å®¹æ˜“å¾—å¤šã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘åŒæ„ï¼Œå¯ç§»æ¤æ€§æ˜¯ä¸ªå¥½ä¸œè¥¿ï¼Œä½†æ˜¯åªæœ‰åœ¨å®ƒç¡®å®æœ‰æ„ä¹‰çš„åœ°æ–¹æ‰æ˜¯ä¸ªä»¤äººå‘å¾€çš„ç‰¹æ€§ã€‚æ²¡æœ‰å¿…è¦ä¸“é—¨ä½¿ä¸€ä¸ªæ“ä½œç³»ç»Ÿå¤ªå…·æœ‰å¯ç§»æ¤æ€§ï¼šèƒ½ç²˜åˆ°å¯ç§»æ¤çš„ API ä¸Šå°±è¡Œäº†ã€‚æ“ä½œç³»ç»Ÿçš„å®è´¨å°±æ˜¯åˆ©ç”¨ç¡¬ä»¶çš„ç‰¹ç‚¹ï¼Œå¹¶å°†å…¶éšè—åœ¨ä¸€å±‚é«˜çº§çš„ç³»ç»Ÿè°ƒç”¨åé¢ã€‚è€Œ Linux å°±æ˜¯å¦‚æ­¤ï¼Œå®ƒæ¯”ä»»ä½• kernel éƒ½æ›´å¤šåœ°åˆ©ç”¨äº†386çš„ç‰¹æ€§ã€‚å½“ç„¶è¿™ä½¿å¾—kernelç¡®å®ä¸å¯ç§»æ¤ï¼Œä½†æ˜¯è¿™ä¹Ÿä½¿è®¾è®¡å¤§ä¸ºç®€åŒ–ï¼Œæ˜¯ä¸€ä¸ªå¯ä»¥æ¥å—çš„æƒå®œä¹‹è®¡ï¼Œå› ä¸ºè¿™é¦–å…ˆä¿è¯äº† Linux çš„è¯ç”Ÿã€‚æˆ‘ä¹ŸåŒæ„ï¼ŒLinux åˆå¤ªä¸å…·æœ‰å¯ç§»æ¤æ€§äº†ã€‚å»å¹´ä¸€æœˆæˆ‘æ‹¥æœ‰äº†è‡ªå·±çš„386ï¼Œè€Œ Linux ç³»ç»Ÿçš„åˆ›å»ºåœ¨ä¸€å®šç¨‹åº¦ä¸Šæˆä¸ºäº†ä¸€ä¸ªè®©æˆ‘è®¤è¯†386çš„é¡¹ç›®ã€‚å¦‚æœè¦æˆä¸ºä¸€ä¸ªçœŸæ­£çš„é¡¹ç›®ï¼Œå¿…é¡»èƒ½å¤Ÿåœ¨å¯ç§»æ¤æ€§æ–¹é¢åšä¸€äº›äº‹æƒ…ã€‚ ä½†æ˜¯ï¼Œæˆ‘æœ€åˆçš„è®¾è®¡æ€æƒ³å°±æ˜¯æ²¡æœ‰è€ƒè™‘åˆ°å¯ç§»æ¤æ€§ï¼Œå¦‚æœæˆ‘è¿™æ ·è¯´å¹¶ä¸æ˜¯å¤ªè¿‡åˆ†åœ°ä¸ºè‡ªå·±è¾©æŠ¤ã€‚å»å¹´å››æœˆæˆ‘å¼€å§‹è¿™ä¸ªé¡¹ç›®æ—¶ï¼Œè®¤ä¸ºä¸ä¼šæœ‰ä»€ä¹ˆäººä¼šçœŸçš„ä½¿ç”¨å®ƒã€‚æˆ‘å¾ˆé«˜å…´æˆ‘çš„è¿™ä¸ªæƒ³æ³•é”™äº†ã€‚ éšç€æˆ‘å¯¹æºä»£ç çš„å‘å¸ƒï¼Œæ¯ä¸ªäººéƒ½å¯ä»¥å…è´¹æ¥è£…æˆª Linuxï¼Œå“ªæ€•è¿˜ä¸æ˜¯å¾ˆæ–¹ä¾¿ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æçº³æ–¯&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é™„ï¼šå¾ˆæŠ±æ­‰æˆ‘æœ‰æ—¶è¨€è¾è¿‡æ¿€ã€‚å¦‚æœä½ æ²¡æœ‰å…¶ä»–çš„æ“ä½œç³»ç»Ÿå¯ä¾›é€‰æ‹©çš„è¯ï¼ŒMINIX å·²ç»æŒºå¥½çš„äº†ã€‚å¦‚æœä½ æœ‰äº”åˆ°åä¸ª386æœºå™¨é—²ç€æ²¡ç”¨ï¼Œé‚£ä¹ˆ Amoeba ä¹Ÿä¼šä¸é”™ï¼Œåªæ˜¯æˆ‘ç¡®å®šæ— ç–‘æ˜¯æ²¡æœ‰çš„ã€‚æˆ‘ä¸€èˆ¬ä¸ä¼šå‹ƒç„¶å¤§æ€’ï¼Œä½†æ˜¯åœ¨æ¶‰åŠåˆ° Linux çš„é—®é¢˜æ—¶ï¼Œæˆ‘æ˜¯æœ‰ç‚¹å®¹æ˜“æ„Ÿæƒ…ç”¨äº‹ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸€åé©³éå¸¸ç²¾å½©ï¼Œå¹¶ä¸”æœ‰è¯´æœåŠ›ï¼ç‰¹åˆ«æ˜¯å¯¹äºâ€œå¯ç§»æ¤æ€§â€é—®é¢˜çš„è¯´æ˜ï¼Œå€¼å¾—æ¯ä¸ªç¨‹åºå‘˜é˜…è¯»ã€‚&lt;/p&gt;
&lt;h2&gt;çŸ¥è¯†äº§æƒ&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å…³äºçŸ¥è¯†äº§æƒï¼Œé€šå¸¸æœ‰ä¸¤ç§æˆªç„¶ä¸åŒçš„è§‚ç‚¹ï¼š&lt;/p&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;æœ‰äº›äººè®¤ä¸ºï¼Œä¸“åˆ©å’ŒåŠ³åŠ¨ä¿é™©å½¢å¼çš„çŸ¥è¯†äº§æƒæ³•è§„æ˜¯è‡ªç”±ä¸–ç•Œçš„ç¥¸å®³ï¼Œä¿¡æ¯æä¾›è€…(IP)æ³•è§„å¹¶ä¸ä»…ä»…æ˜¯è®­å¯¼ï¼Œå®é™…ä¸Šç®€ç›´å°±æ˜¯ç½ªæ¶ï¼Œåº”è¯¥å°½å¿«åœ°åŠ ä»¥é“²é™¤ã€‚ å¦ä¸€äº›äººè®¤ä¸ºæ•´ä¸ªä¸–ç•Œç»æµå®é™…ä¸Šæ˜¯ç”±çŸ¥è¯†äº§æƒæ‰€é©±åŠ¨çš„ã€‚è¿™äº›äººæƒ³é€šè¿‡ä»–ä»¬çš„åŠªåŠ›æ¥åŠ å¼ºIPæ³•è§„çš„æ³•å¾‹åœ°ä½ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è€Œ Linus æ˜¯è¿™ä¹ˆè®¤ä¸ºï¼š&lt;/p&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äºè®¸å¤šäººï¼ŒåŒ…æ‹¬å¯¹æˆ‘è‡ªå·±è€Œè¨€ï¼ŒçŸ¥è¯†äº§æƒæ˜¯æœ‰å…³äººç±»çš„åˆ›é€ æ´»åŠ¨çš„è§„åˆ™ï¼Œæ˜¯å…³äºé‚£äº›ä½¿æˆ‘ä»¬æˆä¸ºäººç±»â€•â€•è€Œä¸æ˜¯åŠ¨ç‰©(å½“ç„¶ï¼Œè¿™æœ¬èº«æ˜¯ä¸€ä»¶å¥½äº‹)çš„æ´»åŠ¨çš„è§„åˆ™ã€‚æ­£æ˜¯åœ¨è¿™ä¸ªæ„ä¹‰ä¸Šï¼Œâ€œçŸ¥è¯†äº§æƒâ€è¿™ä¸€åç§°æœ¬èº«å°±æ˜¯ä¸€ç§ä¾®è¾±ã€‚ å®ƒå¹¶ä¸æ˜¯å¦‚æœ‰å½¢è´¢äº§é‚£æ ·å¯ä»¥å‡ºå”®ï¼Œå®ƒæ˜¯åˆ›é€ æ€§æ´»åŠ¨æœ¬èº«ï¼Œè¿™æ˜¯äººç±»æ‰€èƒ½å¤Ÿåšåˆ°çš„æœ€ä¼Ÿå¤§çš„äº‹æƒ…ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;é‚£ç§åˆ›é€ â€•â€•ä¸ç®¡å®ƒæ˜¯ä»¥ç»˜ç”»ã€ éŸ³ä¹ã€ é›•å¡‘ã€ è±æˆ–æ˜¯ç¨‹åºçš„æ–¹å¼å‡ºç°ï¼Œéƒ½åº”å½“å—åˆ°å°Šé‡ï¼šåˆ›é€ è€…å’Œä»–æ‰€åˆ›é€ çš„äº‹ç‰©ä¹‹é—´æœ‰ç€ä½ æ‰€æ— æ³•åˆ‡æ–­çš„å¯†åˆ‡è”ç³»ã€‚è¿™å°±åƒæ¯äº²ä¸å­©å­ä¹‹é—´çš„è”ç³»ï¼Œæˆ–è€…å¦‚åŒä¸­å›½èœä¸å‘³ç²¾ä¹‹é—´çš„è”ç³»ã€‚ ä½†æ˜¯ä¸æ­¤åŒæ—¶ï¼Œå®ƒå´åˆæ˜¯ä¸–ç•Œä¸Šæ¯ä¸€ä¸ªäººéƒ½åº”å½“åˆ†äº«çš„äº‹ç‰©ï¼Œå› ä¸ºå®ƒæ˜¯å±äºäººç±»å…±åŒçš„ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;ä½ æ‹¥æœ‰ä½ æ‰€åˆ›é€ çš„ä¸œè¥¿å°±æ„å‘³ç€ä½ å¯ä»¥æ§åˆ¶å®ƒçš„ä½¿ç”¨ã€‚ ä¾‹å¦‚ï¼Œä½ æœ‰æƒå°†è¿™ä¸€è‰ºæœ¯æˆæœå‡ºå”®ç»™å…¶ä»–äººï¼Œè€Œä¸”åœ¨è¿™ä¸ªé—®é¢˜ä¸Šï¼Œé™¤äº†ç¾å›½å›½ç¨å±€ä»¥å¤–ï¼Œä»»ä½•äººéƒ½ä¸ä¼šè¯´ä»€ä¹ˆã€‚ ä½†æ˜¯ï¼Œå®ƒå…¶å®å¹¶ä¸ä»…ä»…æ˜¯é’±çš„é—®é¢˜ï¼Œè€Œæ˜¯å…¶ä»–äººåœ¨åŒæ ·çš„é—®é¢˜ä¸Šé™·äºå›°æƒ‘æ—¶å¸®ä»–ä»¬è§£å†³äº†é—®é¢˜ï¼Œçœå´äº†æ—¶é—´ä¸ç²¾åŠ›ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;è®¸å¤šè¦æ±‚åŠ å¼ºçŸ¥è¯†äº§æƒç«‹æ³•çš„è®¨è®ºæ˜¯åŸºäºè¿™æ ·ä¸€ç§è§‚ç‚¹ï¼Œå³ï¼šç»™åˆ›é€ è€…å’Œè‰ºæœ¯å®¶ä»¥æ›´å¤šçš„â€œä¿æŠ¤â€ã€‚è€Œäººä»¬ä¼¼ä¹ä¸æ›¾ã€æˆ–è€…è¯´æ˜¯ä»æœªæ„è¯†åˆ°ï¼Œè¿™æ ·ä¸€ç§å¼ºæœ‰åŠ›çš„æƒåˆ©å¯¼è‡´ä¸€äº›äººå‰¥å¤ºäº†å¦ä¸€äº›äººçš„æƒåˆ©ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘çƒ­çˆ±ç‰ˆæƒã€‚æˆ‘åªæ˜¯è®¤ä¸ºæ²¡å¿…è¦å°†ç‰ˆæƒæ‰€æœ‰è€…çš„æƒåˆ©æ— é™æ‰©å¤§ã€‚ä¸è¦æ‰©å¤§åˆ°å°†æ¶ˆè´¹è€…çš„æƒåˆ©éƒ½è¢«å‰¥å¤ºæ®†å°½ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;å¾ˆæ˜¾ç„¶ï¼Œåªæœ‰æå°‘çš„ä¸ªäººè·å¾—äº†ä¸“åˆ©ã€‚ å¦ä¸€æ–¹é¢ï¼Œå…¬å¸å´è·å¾—äº†å¤§é‡çš„ä¸“åˆ©ã€‚è¿™äº›ä¸“åˆ©æ˜¯ä»–ä»¬ç”¨æ¥å¯¹ä»˜å…¶ä»–å…¬å¸çš„æœ‰åŠ›æ­¦å™¨ï¼Œå¯ä»¥å¨èƒåˆ«äººå› ä¸“åˆ©ä¾µæƒè€Œè¦é¢ä¸´èµ·è¯‰ã€‚ç°ä»Šçš„ä¸“åˆ©ç³»ç»ŸåŸºæœ¬ä¸Šå¯ä»¥è¯´æ˜¯ä¿¡æ¯æä¾›è€…è¿™é—´çš„å†·æˆ˜ï¼Œè€Œä¸æ˜¯ä»–ä»¬ä¹‹å‰çš„æ ¸æˆ˜äº‰ã€‚ç›®å‰è¿™ç§æƒ…å†µä¹Ÿä¸è§å¾—æ¯”è¿‡å»çš„å†·æˆ˜å¥½ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœä½ æƒ³é¿å…ä¸“åˆ©ç”³è¯·è¿‡ç¨‹ä¸­çš„éº»çƒ¦ï¼Œä½ å¯ä»¥é‡‡ç”¨æ›´ä¸ºå‰å®³çš„æ‰‹æ®µï¼šå•†ä¸šç§˜å¯†ã€‚å•†ä¸šç§˜å¯†çš„ä¼˜ç‚¹åœ¨äºï¼Œä½ ä¸å¿…æ‹…å¿ƒä»€ä¹ˆå•†ä¸šç§˜å¯†åŠå…¬å®¤æˆ–è€…ç±»ä¼¼çš„æœºæ„ï¼šä½ åªéœ€è¦å°†å…¶å°å­˜èµ·æ¥ï¼Œç„¶åå°±ä¸å¿…é¡¾è™‘é‚£ä¹ˆå¤šäº†ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿‡å»äººä»¬ä¸€ç›´æ˜¯è¿™æ ·åšçš„ï¼Œå®é™…ä¸Šè¿™ä¹Ÿå°±æ˜¯æ³•è§„ä¹‹æ‰€ä»¥è¢«å¼•å…¥çš„åŸå› æ‰€åœ¨ã€‚ä¸ºäº†é¼“åŠ±ä¸ªäººå’Œå…¬å¸å…¬å¼€å…¶ç§˜å¯†ï¼Œä¸“åˆ©æ³•å…è®¸åœ¨ä¸€å®šæœŸé™å†…ä¿æŠ¤å¸‚åœºâ€•â€•å¦‚æœä½ å…¬å¼€ä½ æ‰€æ‹¥æœ‰çš„ç§˜å¯†çš„è¯ã€‚ä¸€ä¸ªé’ˆé”‹ç›¸å¯¹çš„åŸºæœ¬å½¢å¼æ˜¯ï¼šä½ å‘Šè¯‰å¤§å®¶ä½ æ˜¯å¦‚ä½•åšæˆæŸäº‹çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å…è®¸ä½ æ‹¥æœ‰ä¸€å®šå¹´é™çš„ç‰¹æ®Šæƒåˆ©ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨ä¸“åˆ©äº§ç”Ÿä¹‹å‰ï¼Œäººä»¬ä¼šå……æ»¡çŒœå¿Œåœ°ä¿å®ˆä»–ä»¬è‡ªå·±çš„æŠ€æœ¯ä¼˜åŠ¿ï¼Œä¸€ç›´åˆ°å°†å®ƒä»¬å¸¦å…¥åŸå¢“ã€‚å¾ˆæ˜¾ç„¶ï¼Œé‚£æ˜¯ä¸åˆ©äºæŠ€æœ¯è¿›æ­¥çš„ï¼Œå› ä¸ºæœ‰å‰é€”çš„æŠ€æœ¯ä»æ¥æ²¡æœ‰å‘å…¶ä»–äººå…¬å¼€è¿‡ã€‚å¯¹äºä¸“åˆ©ç‰¹æƒçš„æ‰¿è¯ºä½¿å¾—ä¸“åˆ©æˆä¸ºå°†ç§˜å¯†å‘Šè¯‰å¤§å®¶çš„ä¸€ç§å¼ºæœ‰åŠ›çš„åˆºæ¿€ï¼Œå› ä¸ºä½ å†ä¹Ÿä¸ç”¨æ‹…å¿ƒä½ çš„ç«äº‰å¯¹æ‰‹ä¼šå‘ç°ä½ åœ¨åšä»€ä¹ˆäº†ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;ç„¶è€Œï¼Œé‚£æ˜¯è¿‡å»ï¼Œç°åœ¨æƒ…å½¢ä¸åŒäº†ã€‚ å¦‚ä»Šï¼Œå³ä½¿æ˜¯å•†ä¸šç§˜å¯†ä¹Ÿæœ‰äº†æ³•å¾‹ä¿æŠ¤ï¼Œå°½ç®¡å®ƒä»¬çš„ç†ç”±ä¸–äººæ— æ³•ç†è§£ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;å¾ˆå¤§ç¨‹åº¦ä¸Šï¼Œåœ¨è¿™åœºçŸ¥è¯†äº§æƒæˆ˜äº‰ä¸­å¯»æ±‚å’Œå¹³çš„è§£å†³ä¹‹é“æ­£æ˜¯å…¬å¼€æºä»£ç æ‰€åŠªåŠ›çš„ç›®æ ‡ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;åŒä¸€äº‹ç‰©çš„å¦ä¸€é¢åœ¨äºï¼Œçš„ç¡®ï¼ŒçŸ¥è¯†äº§æƒå¯èƒ½æ˜¯ä¸å…¬å¹³çš„ï¼Œçš„ç¡®ï¼ŒçŸ¥è¯†äº§æƒæ³•è§„åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå°†å…¶ç›®æ ‡å®šä½äºå¤§å…¬å¸è€Œä¸æ˜¯æ¶ˆè´¹è€…æƒåˆ©ï¼Œç”šè‡³ä¹Ÿä¸æ˜¯ä¸ªäººè‘—ä½œè€…æˆ–åˆ›æ–°è€…ã€‚ ç„¶è€Œå…¶ä¸»ä½“æ˜¯ç§¯ææœ‰åˆ©çš„ã€‚çŸ¥è¯†äº§æƒé›†ä¸­äºå¼ºæœ‰åŠ›çš„æƒåˆ©ä¹‹ä¸Šï¼Œä¸ä¹‹ç›¸å¯¹åº”çš„äº‹å®æ˜¯è¿™ä¸€å¼ºæœ‰åŠ›çš„æ­¦å™¨åœ¨å¸‚åœºä¸Šæ˜¯å¦‚æ­¤çš„æœ‰æ•ˆã€‚ æ ¸æ­¦å™¨æ˜¯å†·æˆ˜æ—¶ä»£çš„ç»ˆæåŠ›é‡ï¼ŒåŒæ ·çš„åŸå› ä½¿å¾—çŸ¥è¯†äº§æƒåœ¨æŠ€æœ¯æˆ˜äº‰æ—¶ä»£é‡Œå¤§å—æ¬¢è¿ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;è™½ç„¶å¤§é‡çš„æ–°æªæ–½ä½¿éæ³•ä½¿ç”¨ä»–äººçš„çŸ¥è¯†äº§æƒå˜å¾—æ›´åŠ å›°éš¾ï¼Œä½†åŒæ—¶ä¹Ÿä½¿å¾—åˆæ³•ä½¿ç”¨ä»–äººçš„çŸ¥è¯†äº§æƒå˜å¾—æ›´åŠ å›°éš¾ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;em&gt;åŸè°…æˆ‘å–‹å–‹ä¸ä¼‘åœ°æ‘˜å½•äº†è¿™ä¹ˆå¤šå†…å®¹ï¼Œä½†å…¶å®ä¹¦ä¸­è¿™éƒ¨åˆ†çš„å†…å®¹è¿˜æœ‰å¾ˆå¤šç²¾å½©ä¹‹å¤„ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;çŸ¥è¯†äº§æƒæœ¬æ¥çš„ç›®çš„æ˜¯ä¿æŠ¤åˆ›é€ è€…çš„åŸºæœ¬æƒåˆ©ï¼Œä»¥ä¿ƒè¿›åˆ›æ–°å’Œåˆ†äº«ï¼Œä½†çŸ¥è¯†äº§æƒå¦‚æœèµ°è¿‡äº†å¤´ï¼ˆä¾‹å¦‚å¦‚ä»Šçš„ä¸“åˆ©æˆ˜äº‰ï¼‰å°±ä¼šå¯¼è‡´åˆ›æ–°éš¾ä»¥æ™®åŠï¼Œä»–äººæ— æ³•åˆæ³•åˆç†åœ°ä½¿ç”¨è¿™äº›åˆ›æ–°ã€‚å¼€æºè¿åŠ¨åˆ™é¼“åŠ±å……åˆ†åœ°å¼€æ”¾åˆ†äº«åˆ›æ–°ï¼ŒåŒæ—¶é€šè¿‡å„ç§å½¢å¼è®¸å¯è¯æ¥ä¿æŠ¤åˆ›é€ è€…çš„åŸºæœ¬æƒåˆ©ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€å¼€æºè¿åŠ¨çš„ç†å¿µä¸ä»…åªæ˜¯å½±å“è®¡ç®—æœºè¡Œä¸šï¼Œä¹Ÿä¼šå¯¹æ‰€æœ‰è¡Œä¸šäº§ç”Ÿå·¨å¤§çš„æ­£é¢å½±å“ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;äººç±»ç¤¾ä¼šçš„å‘å±•æ˜¯ä¸€ä¸ªç§¯ç´¯çš„è¿‡ç¨‹ï¼Œåˆ›æ–°çŸ¥è¯†çš„åˆ†äº«è¶Šå……åˆ†ï¼Œç§¯ç´¯ä¹Ÿå°±è¶Šå¿«ï¼Œäººç±»ç¤¾ä¼šçš„å‘å±•ä¹Ÿå°±è¶Šå¿«ã€‚è¿™ä¹Ÿæ˜¯æˆ‘æ¬£èµæ”¯æŒé»‘å®¢ç²¾ç¥å’Œå¼€æºè¿åŠ¨çš„ç¼˜ç”±ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;å…³äºä¹¦åçš„ç¿»è¯‘&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™æœ¬ä¹¦çš„ä¹¦åï¼Œä¸­å›½é’å¹´å‡ºç‰ˆç¤¾çš„ç‰ˆæœ¬æ˜¯è¯‘ä¸ºã€Šä¹è€…ä¸ºç‹ã€‹ï¼Œè€Œå°†è¦å‡ºç‰ˆçš„äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾çš„ç‰ˆæœ¬è²Œä¼¼è¦è¯‘ä¸ºã€Šè¶Šç©è¶Šå¤§-æˆ‘å’Œ Linux çš„æ•…äº‹ã€‹ï¼ˆæ­£å¼å‡ºç‰ˆå‰çš„æš‚è¯‘åï¼Ÿï¼‰ã€‚å¯¹äºè¿™ä¸¤ä¸ªè¯‘åæˆ‘éƒ½ä¸æ»¡æ„ã€‚åŸä¹¦å–åã€ŠJust For Fun --- The Story of an Accidental Revolutionaryã€‹ï¼Œæˆ‘æƒ³åº”è¯¥æ˜¯è€ƒè™‘äº†ä¸¤ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;Linus éå¸¸çœ‹é‡å°Šé‡è‡ªå·±çš„å…´è¶£ã€‚å…¶å® Linux å°±æ˜¯å§‹äºå®ƒçš„ä¸ªäººå…´è¶£ï¼Œä¹Ÿå› æ­¤ Linux åˆ°å¦‚ä»Šçš„å‘å±•åŠå…¶é€ æˆçš„å¹¿æ³›å½±å“ä¹Ÿæ˜¯å½“åˆLinusæ²¡æœ‰æ–™æƒ³ä¹Ÿä¸å¯èƒ½æ–™æƒ³åˆ°çš„ï¼Œäººç”Ÿå¾€å¾€å¦‚æ­¤ï¼Œå¾ˆå¤šäº‹æƒ…éƒ½æ˜¯ Accidental çš„ï¼›&lt;/li&gt;
&lt;li&gt;Linus è®¤ä¸ºä»»ä½•äººç±»ç¤¾ä¼šäº‹ç‰©å‘å±•çš„ç»ˆæé˜¶æ®µå°±æ˜¯---å¨±ä¹ï¼Œé‚£ä¹ˆç”Ÿæ´»çš„æ„ä¹‰å°±æ˜¯ä¸æ–­åŠªåŠ›ä¸ºè¾¾åˆ°è¿™ä¸€ç»ˆæé˜¶æ®µè€Œè´¡çŒ®è‡ªå·±çš„ä¸€ä»½åŠ›é‡ã€‚&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äºç¬¬äºŒç‚¹ï¼Œè¯¥ä¹¦çš„æœ€åä¸€èŠ‚ä¸­ä½œè€…åšäº†æ˜ç¡®çš„è¯´æ˜ï¼š&lt;/p&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äº†ï¼Œå°±æ˜¯è¿™ä¸‰ä»¶äº‹ï¼šç”Ÿå­˜ã€ä½ åœ¨ç¤¾ä¼šä¸­çš„ä½ç½®ã€è¿˜æœ‰å¿«ä¹ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸‰ä»¶äº‹å°±æ˜¯æˆ‘ä»¬æ­£åœ¨åšç€çš„äº‹æƒ…ã€‚ ä»»ä½•å…¶ä»–çš„äº‹ç‰©ï¼Œéƒ½æ˜¯ç¤¾ä¼šå­¦å®¶å¯èƒ½ä¼šç§°ä¹‹ä¸ºâ€œçªå‘è¡Œä¸ºâ€çš„ä¸œè¥¿ï¼Œå®ƒä»¬æºäºé‚£äº›è§„åˆ™æ›´ä¸ºç®€å•çš„è¡Œä¸ºæ¨¡å¼ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç„¶è€Œäº‹æƒ…ä¸ä»…ä»…æ˜¯â€œè¿™å°±æ˜¯æ¿€åŠ±äººç”Ÿæ´»çš„äº‹ç‰©â€ã€‚å¦‚æœæƒ…å½¢æ˜¯è¿™æ ·çš„è¯ï¼Œé‚£å®ƒä»¬ä¹Ÿå°±ä¸ä¼šæˆä¸ºå…³äºç”Ÿå‘½çš„ç†è®ºäº†ã€‚ä»¤äººæ„Ÿå…´è¶£çš„ï¼Œè¿™ä¸‰ç§æ¿€åŠ±å› ç´ æœ‰ç€å†…åœ¨çš„æ¬¡åºï¼Œè€Œè¿™ä¸€æ¬¡åºè¡¨æ˜äº†ç”Ÿå‘½çš„æ‰€åœ¨ã€‚äº‹æƒ…å¹¶ä¸ä»…ä»…æ˜¯ï¼Œæˆ‘ä»¬äººç±»è¢«è¿™ä¸‰ç§äº‹ç‰©æ‰€é©±ä½¿â€•â€•å¯¹äºäººç±»ä»¥å¤–çš„å…¶ä»–ç”Ÿå‘½è¡Œä¸ºä¹Ÿæ˜¯å¦‚æ­¤ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸€æ¬¡åºæ˜¯ï¼šç”Ÿå­˜ï¼›ç¤¾ä¼šäº¤å¾€ï¼›å¯»æ‰¾ä¹è¶£ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å®ƒä¹Ÿæ˜¯è¿›åŒ–çš„æ¬¡åºã€‚è¿™å°±æ˜¯æˆ‘ä»¬é€‰æ‹©äº†â€œJust for Funâ€ä½œä¸ºæœ¬ä¹¦åç§°çš„åŸå› ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å› ä¸ºæˆ‘ä»¬æ›¾ç»æ‰€åšçš„ä¸€åˆ‡äº‹æƒ…ï¼Œä¼¼ä¹æœ€ç»ˆéƒ½æ˜¯ä¸ºäº†æˆ‘ä»¬è‡ªå·±çš„ä¹è¶£ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¯‘åã€Šä¹è€…ä¸ºç‹ã€‹è™½ç„¶ç®€ç»ƒï¼Œå´ä¸èƒ½æ˜ç¡®åœ°è¡¨è¾¾è¿™ä¸¤å±‚æ„æ€ã€‚ã€Šè¶Šç©è¶Šå¤§-æˆ‘å’ŒLinuxçš„æ•…äº‹ã€‹åˆ™è·Ÿé—¹ç€ç©ä¼¼çš„ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸ºä»€ä¹ˆä¸ç›´è¯‘ä¸ºã€Šåªä¸ºä¹è¶£ã€‹å‘¢ï¼Ÿ&lt;/p&gt;
&lt;hr&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å…³äºæœ¬ä¹¦ï¼Œé˜®ä¸€å³°ä¹Ÿå†™è¿‡ä¸€ç¯‡é˜…è¯»ç¬”è®°ï¼Œè§&lt;a href=&apos;http://www.ruanyifeng.com/blog/2012/09/linus_torvalds.html&apos;&gt;ã€ŠLinus Torvalds è‡ªä¼ ã€‹æ‘˜å½•&lt;/a&gt;ã€‚&lt;/p&gt;</description>
            <pubDate>2013-11-07</pubDate>
            <link>https://blog.xiayf.cn/posts/reading-just-for-fun.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/reading-just-for-fun.html</guid>
        </item>
        
        <item>
            <title>æ­å»ºé«˜å¯ç”¨è´Ÿè½½å‡è¡¡ç»„ä»¶åŠç¼“å­˜DNS</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;è¯¥é¡¹å·¥ä½œï¼Œå¦‚é¢˜æ‰€ç¤ºï¼Œä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šé«˜å¯ç”¨è´Ÿè½½å‡è¡¡ç»„ä»¶ã€ç¼“å­˜ DNSã€‚&lt;/p&gt;
&lt;h2&gt;é«˜å¯ç”¨è´Ÿè½½å‡è¡¡ç»„ä»¶&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;éœ€æ±‚ï¼šä¼˜åŒ–ä¸šåŠ¡ç³»ç»Ÿæ¶æ„ä¸­æŸäº›å…³é”®ç¯èŠ‚ï¼Œé’ˆå¯¹ TCP å±‚æ•°æ®æµé‡è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œå¹¶ä¿è¯æœåŠ¡çš„é«˜å¯ç”¨ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æŠ€æœ¯é€‰å‹ï¼šHAProxy + Keepalivedï¼Œè¿™å¯¹ç»„åˆæ¯”è¾ƒå¸¸è§æˆç†Ÿã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦å¤–ï¼Œç”±äº HAProxy çš„è´Ÿè½½å‡è¡¡ä»»åŠ¡å¯èƒ½æ¯”è¾ƒå¤šï¼Œé äººå·¥ä¿®æ”¹é…ç½®æ¥å¢åˆ æ”¹ä»»åŠ¡ä¸æ–¹ä¾¿å¯é ï¼Œæ‰€ä»¥å®ç°äº†ä¸€ä¸ªç®€å•çš„ HAProxy ç®¡ç†ç³»ç»Ÿï¼Œ&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä»¥åç»å®é™…ä½¿ç”¨éªŒè¯å’Œå®Œå–„ä¼šå¼€æ”¾æºç ã€‚&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/lY67ipAcb12TnBS.png&apos; title=&apos;high availability load balancer&apos; alt=&apos;high availability load balancer&apos; width=&apos;100%&apos;/&gt;
&lt;h2&gt;ç¼“å­˜ DNS&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å…ˆä»¥ www.qq.com ä¸ºä¾‹ï¼Œè§£é‡Šä¸€ä¸‹åŸŸåè§£æè¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/1cyVpdBQSoAq9b6.jpg&apos; title=&apos;resolve qq.com&apos; alt=&apos;resolve qq.com&apos; width=&apos;600&apos;/&gt;
&lt;ol&gt;&lt;li&gt;ç”¨æˆ·å‘ Local DNS å‘èµ· &lt;code&gt;www.qq.com.&lt;/code&gt; æŸ¥è¯¢è¯·æ±‚ï¼›&lt;/li&gt;
&lt;li&gt;Local DNS å‘æ ¹æœåŠ¡å™¨å‘èµ· &lt;code&gt;com.&lt;/code&gt; æŸ¥è¯¢è¯·æ±‚ï¼›&lt;/li&gt;
&lt;li&gt;æ ¹æœåŠ¡å™¨å‘ Local DNS è¿”å› &lt;code&gt;com.&lt;/code&gt; è§£æè®°å½•ï¼›&lt;/li&gt;
&lt;li&gt;Local DNS å‘ &lt;code&gt;com.&lt;/code&gt; æƒå¨æœåŠ¡å™¨å‘èµ· &lt;code&gt;qq.com.&lt;/code&gt; æŸ¥è¯¢è¯·æ±‚ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;com.&lt;/code&gt; æƒå¨æœåŠ¡å™¨å‘ Local DNS è¿”å› &lt;code&gt;qq.com.&lt;/code&gt; è§£æè®°å½•ï¼›&lt;/li&gt;
&lt;li&gt;Local DNSå‘ &lt;code&gt;qq.com.&lt;/code&gt; æƒå¨æœåŠ¡å™¨å‘èµ· &lt;code&gt;www.qq.com.&lt;/code&gt; æŸ¥è¯¢è¯·æ±‚ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;qq.com.&lt;/code&gt; æƒå¨æœåŠ¡å™¨å‘ Local DNS è¿”å› &lt;code&gt;www.qq.com.&lt;/code&gt; è§£æè®°å½•ï¼›&lt;/li&gt;
&lt;li&gt;Local DNS å‘ç”¨æˆ·è¿”å› &lt;code&gt;www.qq.com&lt;/code&gt; è§£æè®°å½•ã€‚&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Local DNS ä¸€èˆ¬ç”±ç½‘ç»œè¿è¥å•†ï¼ˆå¦‚ç”µä¿¡ã€ç½‘é€šç­‰ï¼‰æä¾›ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç¼“å­˜ DNS å¤„äºç”¨æˆ·ç«¯ï¼ˆè¿™æ˜¯ä¸€ä¸ªç›¸å¯¹çš„æ¦‚å¿µï¼‰ä¸ local DNS ä¹‹é—´ï¼Œåˆ©ç”¨ DNS æœåŠ¡å™¨è½¯ä»¶çš„ç¼“å­˜åŠŸèƒ½ä»¥åŠç¼“å­˜ DNS ä¸ç”¨æˆ·ç«¯çš„è¿‘è·ç¦»ç‰¹ç‚¹æ¥åŠ é€ŸåŸŸåè§£æã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¹Ÿå¯ä»¥åœ¨ç¼“å­˜ DNS ä¸ŠæŒ‰éœ€æ±‚è¿›è¡ŒåŸŸååŠ«æŒã€‚è¿è¥å•†ä¸ºäº†ç‰Ÿåˆ©ï¼Œä¹Ÿä¼šåœ¨ local DNS ä¸Šè¿›è¡ŒåŸŸååŠ«æŒï¼Œè¿™å¯¹äºå„å¤§äº’è”ç½‘å…¬å¸å¯¹å¤–æä¾›çš„æœåŠ¡æ¥è¯´æ˜¯ä¸ªå¾ˆå¤§çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨å®Œæˆè¯¥å·¥ä½œåï¼Œæˆ‘ç¼–å†™äº†ä¸€ä»½å®‰è£…é…ç½®æ–‡æ¡£ï¼Œæ–¹ä¾¿å…¶ä»–åŒäº‹å‚è€ƒã€‚æ–‡æ¡£è§ï¼š &lt;a href=&apos;../assets/high-availability-load-balancer-and-dns.pdf&apos;&gt;HAProxy+HAProxyConsole+Keepalived+BINDå®‰è£…é…ç½®æ–‡æ¡£.pdf&lt;/a&gt;ã€‚&lt;/p&gt;</description>
            <pubDate>2013-10-16</pubDate>
            <link>https://blog.xiayf.cn/posts/ha-lb-and-dns.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/ha-lb-and-dns.html</guid>
        </item>
        
        <item>
            <title>é€šè¿‡ç¤ºä¾‹å­¦ä¹ Gitå†…éƒ¨æ„é€ ï¼ˆè¯‘ï¼‰</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;åŸæ–‡ï¼š&lt;a href=&apos;http://teohm.github.io/blog/2011/05/30/learning-git-internals-by-example/&apos;&gt;Learning Git Internals by Example&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;çŠ¶æ€ï¼šè‰ç¨¿&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è®¡åˆ’ä¿®è®¢æœ¬æ–‡ï¼Œæœªæ¥å¯èƒ½ä¼šç®€åŒ–ä¸€äº›...&lt;/p&gt;
&lt;h2&gt;åŠ¨æœº&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä»Subversionå’ŒMercurialåˆ‡æ¢åˆ°Gitä¹‹åçš„å‡ ä¸ªæœˆï¼Œæˆ‘å§‹ç»ˆè§‰å¾—Gitåœ¨æœ¬è´¨ä¸Šæ˜¯ä¸åŒäºSubversionå’ŒMercurialçš„ï¼Œä½†æ²¡æ³•ç¡®åˆ‡åœ°è¯´å‡ºåŒºåˆ«ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘ç»å¸¸åœ¨Githubä¸Šçœ‹åˆ°treeã€parentç­‰æœ¯è¯­ï¼Œä¹Ÿæä¸æ¸…æ¥šå®ƒä»¬ç¡®åˆ‡çš„å«ä¹‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å› æ­¤æˆ‘å†³å®šèŠ±äº›æ—¶é—´å­¦å­¦Gitã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘ä¼šå°è¯•æ¦‚è¿°ï¼Œå¹¶é˜è¿°ä¸€è·¯èµ°æ¥å­¦åˆ°çš„å…³äºGitçš„å…³é”®ä¿¡æ¯...ä½†è¿™ä»…æ˜¯æœ‰åŠ©äºæˆ‘å›ç­”Gitä¸å…¶ä»–æºç æ§åˆ¶å·¥å…·åŒºåˆ«çš„Gitå†…éƒ¨æ„é€ åŸºæœ¬çŸ¥è¯†ã€‚&lt;/p&gt;
&lt;h2&gt;å®ä½“ã€å¼•ç”¨ã€ç´¢å¼•ï¼ˆObjectsï¼ŒReferencesï¼ŒThe Indexï¼‰&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¦ç†è§£Gitå†…éƒ¨æ„é€ çš„æ ¸å¿ƒï¼Œæˆ‘ä»¬åº”ç†è§£ä¸‰ä¸ªä¸œè¥¿ï¼š &lt;strong&gt;å®ä½“&lt;/strong&gt;ã€&lt;strong&gt;å¼•ç”¨&lt;/strong&gt;ã€ &lt;strong&gt;ç´¢å¼•&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘å‘ç°è¿™ä¸ªæ¨¡å‹éå¸¸ä¼˜é›…ã€‚ç”¨ä¸€ä¸ªå°å°çš„å›¾è¡¨å°±èƒ½å®Œå…¨å±•ç°ï¼Œä¹Ÿæ˜“äºç†è§£è®°å¿†ã€‚&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/DZipXYwEqnguCF9.png&apos; title=&apos;Big Picture&apos; alt=&apos;Big Picture&apos; width=&apos;500&apos;/&gt;
&lt;h3&gt;å®ä½“&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½ æäº¤åˆ°ä¸€ä¸ªGitä»£ç ä»“åº“ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬æ¯ä¸ªæäº¤çš„è¯´æ˜ä¿¡æ¯ï¼ˆthe commit infoï¼‰éƒ½åœ¨ç›®å½• &lt;code&gt;.git/objects/&lt;/code&gt;ä¸­å­˜å‚¨ä¸º&lt;strong&gt;å®ä½“&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸€ä¸ªå®ä½“ä»¥ä¸€ä¸ª40å­—ç¬¦é•¿åº¦çš„å­—ç¬¦ä¸²ï¼ˆè¯¥å®ä½“å†…å®¹çš„SHA1å“ˆå¸Œå€¼ï¼‰æ¥æ ‡è¯†ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å®ä½“æœ‰&lt;strong&gt;4ç±»&lt;/strong&gt;:&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;&lt;em&gt;blob&lt;/em&gt; - å­˜å‚¨æ–‡ä»¶å†…å®¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;em&gt;tree&lt;/em&gt; - å­˜å‚¨ç›®å½•ç»“æ„å’Œæ–‡ä»¶åã€‚&lt;/li&gt;
&lt;li&gt;&lt;em&gt;commit&lt;/em&gt; - å­˜å‚¨æäº¤çš„è¯´æ˜ï¼Œç»„æˆGitçš„æäº¤å›¾è°±ã€‚&lt;/li&gt;
&lt;li&gt;&lt;em&gt;tag&lt;/em&gt; - å­˜å‚¨å¸¦æ³¨é‡Šçš„æ ‡ç­¾ï¼ˆtagï¼‰ã€‚&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸‹æ–‡çš„ç¤ºä¾‹ä¼šé˜æ˜è¿™äº›å®ä½“æ˜¯å¦‚ä½•ç›¸äº’å…³è”çš„ã€‚&lt;/p&gt;
&lt;h3&gt;å¼•ç”¨&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Gitä¸­ï¼Œä¸€ä¸ª&lt;em&gt;åˆ†æ”¯ï¼ˆbranchï¼‰&lt;/em&gt;ã€&lt;em&gt;è¿œç¨‹åˆ†æ”¯ï¼ˆremote branchï¼‰&lt;/em&gt;æˆ–ä¸€ä¸ª&lt;em&gt;æ ‡ç­¾ï¼ˆtagï¼‰&lt;/em&gt;ï¼ˆä¹Ÿç§°ä¸ºè½»é‡æ ‡ç­¾ï¼‰ä»…æ˜¯&lt;strong&gt;æŒ‡å‘ä¸€ä¸ªå®ä½“çš„ä¸€ä¸ªæŒ‡é’ˆ&lt;/strong&gt;ï¼Œè¿™é‡Œçš„å®ä½“é€šå¸¸æ˜¯ä¸€ä¸ªcommitå®ä½“ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™äº›å¼•ç”¨ä»¥æ–‡æœ¬æ–‡ä»¶çš„å½¢å¼å­˜å‚¨åœ¨ç›®å½•&lt;code&gt;.git/refs/&lt;/code&gt;ä¸­ã€‚&lt;/p&gt;
&lt;h4&gt;ç¬¦å·å¼•ç”¨ï¼ˆSymbolic Referencesï¼‰&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Gitæœ‰ä¸€ç§ç‰¹æ®Šçš„å¼•ç”¨ï¼Œç§°ä¸º&lt;em&gt;ç¬¦å·å¼•ç”¨&lt;/em&gt;ã€‚å®ƒå¹¶ä¸ç›´æ¥æŒ‡å‘ä¸€ä¸ªå®ä½“ï¼Œè€Œæ˜¯&lt;strong&gt;æŒ‡å‘å¦ä¸€ä¸ªå¼•ç”¨&lt;/strong&gt;ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œ&lt;code&gt;.git/HEAD&lt;/code&gt;å°±æ˜¯ä¸€ä¸ªç¬¦å·å¼•ç”¨ã€‚å®ƒæŒ‡å‘ä½ æ­£åœ¨å·¥ä½œçš„å½“å‰åˆ†æ”¯ã€‚&lt;/p&gt;
&lt;h3&gt;ç´¢å¼•&lt;/h3&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç´¢å¼•æ˜¯ä¸€ä¸ªæš‚å­˜åŒºï¼Œä»¥äºŒè¿›åˆ¶æ–‡ä»¶çš„å½¢å¼å­˜å‚¨ä¸ºæ–‡ä»¶&lt;code&gt;.git/index&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å½“&lt;code&gt;git add&lt;/code&gt;ä¸€ä¸ªæ–‡ä»¶ï¼ŒGitå°†è¯¥æ–‡ä»¶çš„ä¿¡æ¯æ·»åŠ åˆ°ç´¢å¼•ä¸­ã€‚å½“&lt;code&gt;git commit&lt;/code&gt;ï¼ŒGitä»…æäº¤ç´¢å¼•æ–‡ä»¶ä¸­åˆ—å‡ºçš„æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;ç¤ºä¾‹&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘ä»¬æ¥æ¼”ç»ƒä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œåˆ›å»ºä¸€ä¸ªGitä»£ç ä»“åº“ï¼Œæäº¤ä¸€äº›æ–‡ä»¶ï¼Œçœ‹çœ‹å¹•å&lt;code&gt;.git&lt;/code&gt;ç›®å½•ä¸­éƒ½å‘ç”Ÿäº†äº›ä»€ä¹ˆã€‚&lt;/p&gt;
&lt;h3&gt;åˆå§‹åŒ–æ–°çš„ä»£ç ä»“åº“&lt;/h3&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ git init canai&lt;/code&gt;&lt;/pre&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/8cQagykr73UeENP.png&apos; title=&apos;åˆå§‹åŒ–ä»£ç ä»“åº“å&apos; alt=&apos;åˆå§‹åŒ–ä»£ç ä»“åº“å&apos; width=&apos;500&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;åˆ›å»ºäº†ç©ºç›®å½•&lt;code&gt;.git/objects/&lt;/code&gt;å’Œ&lt;code&gt;.git/refs/&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è¿˜æ²¡æœ‰ç´¢å¼•ï¼ˆIndexï¼‰æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;åˆ›å»ºäº†ç¬¦å·ç´¢å¼•æ–‡ä»¶&lt;code&gt;HEAD&lt;/code&gt;ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ cat .git/HEAD
ref: refs/heads/master&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;æ·»åŠ æ–°æ–‡ä»¶&lt;/h3&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ echo &amp;amp;quot;A roti canai project.&amp;amp;quot; &amp;amp;gt;&amp;amp;gt; README
$ git add README&lt;/code&gt;&lt;/pre&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/8nJVFwti7TpLRXG.png&apos; title=&apos;æ·»åŠ æ–°æ–‡ä»¶å&apos; alt=&apos;æ·»åŠ æ–°æ–‡ä»¶å&apos; width=&apos;500&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;åˆ›å»ºäº†ç´¢å¼•ï¼ˆIndexï¼‰æ–‡ä»¶ã€‚å®ƒæœ‰ä¸€ä¸ªSHA1å“ˆå¸Œå€¼æŒ‡å‘ä¸€ä¸ªblobå®ä½“ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ git ls-files --stage
100644 5f89c6f016cad2d419e865df380595e39b1256db 0 README&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;&lt;li&gt;åˆ›å»ºäº†ä¸€ä¸ªblobå®ä½“ã€‚READMEæ–‡ä»¶çš„å†…å®¹å­˜å‚¨åœ¨è¯¥blobä¸­ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;# .git/objects/5f/89c6f016cad2d419e865df380595e39b1256db
$ git cat-file blob 5f89c6
A roti canai project.&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;é¦–æ¬¡æäº¤&lt;/h3&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ git commit -m&amp;amp;apos;first commit&amp;amp;apos;
[master (root-commit) d9976cf] first commit
1 files changed, 1 insertions(+), 0 deletions(-)
create mode 100644 README&lt;/code&gt;&lt;/pre&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/b3uUpRsyiJBwQrX.png&apos; title=&apos;é¦–æ¬¡æäº¤å&apos; alt=&apos;é¦–æ¬¡æäº¤å&apos; width=&apos;500&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;åˆ›å»ºäº†åˆ†æ”¯â€˜masterâ€™å¼•ç”¨ï¼ŒæŒ‡å‘â€˜masterâ€™åˆ†æ”¯ä¸­æœ€æ–°çš„commitå®ä½“ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ cat .git/refs/heads/master 
d9976cfe0430557885d162927dd70186d0f521e8&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;&lt;li&gt;åˆ›å»ºäº†ç¬¬ä¸€ä¸ªcommitå®ä½“ï¼ŒæŒ‡å‘ä»£ç ä»“åº“æ ¹ç›®å½•treeå®ä½“ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;# .git/objects/d9/976cfe0430557885d162927dd70186d0f521e8
$ git cat-file commit d9976cf
tree 0ff699bbafc5d17d0637bf058c924ab405b5dcfe
author Huiming Teo &amp;amp;lt;huiming@favoritemedium.com&amp;amp;gt; 1306739524 +0800
committer Huiming Teo &amp;amp;lt;huiming@favoritemedium.com&amp;amp;gt; 1306739524 +0800

first commit&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;&lt;li&gt;åˆ›å»ºäº†treeå®ä½“ã€‚è¯¥treeä»£è¡¨ç›®å½•â€œcanaiâ€ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;# .git/objects/0f/f699bbafc5d17d0637bf058c924ab405b5dcfe
$ git ls-tree 0ff699
100644 blob 5f89c6f016cad2d419e865df380595e39b1256db  README&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;æ·»åŠ ä¸€ä¸ªä¿®æ”¹è¿‡çš„æ–‡ä»¶&lt;/h3&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ echo &amp;amp;quot;Welcome everyone.&amp;amp;quot; &amp;amp;gt;&amp;amp;gt; README
$ git add README&lt;/code&gt;&lt;/pre&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/HV2OvpxglEh94fR.png&apos; title=&apos;æ·»åŠ ä¸€ä¸ªä¿®æ”¹è¿‡çš„æ–‡ä»¶å&apos; alt=&apos;æ·»åŠ ä¸€ä¸ªä¿®æ”¹è¿‡çš„æ–‡ä»¶å&apos; width=&apos;500&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;æ›´æ–°äº†ç´¢å¼•ï¼ˆIndexï¼‰æ–‡ä»¶ã€‚æ³¨æ„åˆ°äº†å—ï¼Ÿå®ƒè®°å½•äº†ä¸€ä¸ªæ–°blobã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ git ls-files --stage
100644 1192db4c15e019da7fc053225d09dea14bc3ac07 0 README&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;&lt;li&gt;åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„blobå®ä½“ã€‚READMEçš„æ•´ä¸ªå†…å®¹è¢«å­˜å…¥ä¸€ä¸ªæ–°çš„blobã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;# .git/objects/11/92db4c15e019da7fc053225d09dea14bc3ac07
$ git cat-file blob 1192db
A roti canai project.
Welcome everyone.&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;å‘å­ç›®å½•ä¸­æ·»åŠ æ–‡ä»¶&lt;/h3&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ mkdir doc
$ echo &amp;amp;quot;[[TBD]] manual toc&amp;amp;quot; &amp;amp;gt;&amp;amp;gt; doc/manual.txt
$ git add doc&lt;/code&gt;&lt;/pre&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/GkF3I2gZpNJtuqx.png&apos; title=&apos;å‘å­ç›®å½•æ·»åŠ æ–‡ä»¶å&apos; alt=&apos;å‘å­ç›®å½•æ·»åŠ æ–‡ä»¶å&apos; width=&apos;500&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;æ›´æ–°äº†ç´¢å¼•ï¼ˆIndexï¼‰æ–‡ä»¶ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ git ls-files --stage
100644 1192db4c15e019da7fc053225d09dea14bc3ac07 0 README
100644 ea283e4fb22719fad512405d41dffa050cd16f9a 0 doc/manual.txt&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;&lt;li&gt;åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„blobå®ä½“ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;# .git/objects/ea/283e4fb22719fad512405d41dffa050cd16f9a
$ git cat-file blob ea283
[[TBD]] manual toc&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;ç¬¬äºŒæ¬¡æäº¤&lt;/h3&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ git commit -m&amp;amp;apos;second commit&amp;amp;apos;
[master 556eaf3] second commit
 2 files changed, 2 insertions(+), 0 deletions(-)
 create mode 100644 doc/manual.txt&lt;/code&gt;&lt;/pre&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/p8sMkec5PlWzVEi.png&apos; title=&apos;ç¬¬äºŒæ¬¡æäº¤å&apos; alt=&apos;ç¬¬äºŒæ¬¡æäº¤å&apos; width=&apos;500&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;æ›´æ–°äº†åˆ†æ”¯â€œmasterâ€å¼•ç”¨ï¼ŒæŒ‡å‘è¯¥åˆ†æ”¯ä¸­æœ€æ–°çš„commitå®ä½“ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ cat .git/refs/heads/master 
556eaf374886d4c07a1906b9fdcaba195292b96&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;&lt;li&gt;åˆ›å»ºäº†ç¬¬äºŒä¸ªcommitå®ä½“ã€‚æ³¨æ„å®ƒçš„â€œparentâ€æ˜¯æŒ‡å‘é¦–ä¸ªcommitå®ä½“ã€‚è¿™æ ·å½¢æˆäº†ä¸€ä¸ªæäº¤å›¾è°±ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ git cat-file commit 556e
tree 7729a8b15b747bce541a9752a8f10d57daf221b6
parent d9976cfe0430557885d162927dd70186d0f521e8
author Huiming Teo &amp;amp;lt;huiming@favoritemedium.com&amp;amp;gt; 1306743598 +0800
committer Huiming Teo &amp;amp;lt;huiming@favoritemedium.com&amp;amp;gt; 1306743598 +0800

second commit&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;&lt;li&gt;åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ä»£ç ä»“åº“æ ¹ç›®å½•treeå®ä½“ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ git ls-tree 7729
100644 blob 1192db4c15e019da7fc053225d09dea14bc3ac07  README
040000 tree 6ff17d485bf857514f299f0bde0e2a5c932bd055  doc&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;&lt;li&gt;åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å­ç›®å½•treeå®ä½“ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ git ls-tree 6ff1
100644 blob ea283e4fb22719fad512405d41dffa050cd16f9a  manual.txt&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;æ·»åŠ ä¸€ä¸ªæ³¨é‡Šæ ‡ç­¾ï¼ˆannotated tagï¼‰&lt;/h3&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ git tag -a -m&amp;amp;apos;this is annotated tag&amp;amp;apos; v0.1 d9976&lt;/code&gt;&lt;/pre&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/M3ElNd58kHbDS9v.png&apos; title=&apos;æ·»åŠ ä¸€ä¸ªæ³¨é‡Šæ ‡ç­¾å&apos; alt=&apos;æ·»åŠ ä¸€ä¸ªæ³¨é‡Šæ ‡ç­¾å&apos; width=&apos;500&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;åˆ›å»ºäº†ä¸€ä¸ªæ ‡ç­¾å¼•ç”¨ï¼ŒæŒ‡å‘ä¸€ä¸ªtagå®ä½“ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ cat .git/refs/tags/v0.1 
c758f4820f02acf20bb3f6d7f6098f25ee6ed730&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;&lt;li&gt;åˆ›å»ºäº†ä¸€ä¸ªtagå®ä½“ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ git cat-file tag c758
object d9976cfe0430557885d162927dd70186d0f521e8
type commit
tag v0.1
tagger Huiming Teo &amp;amp;lt;huiming@favoritemedium.com&amp;amp;gt; 1306744918 +0800

this is annotated tag&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;æ·»åŠ ä¸€ä¸ªæ–°çš„ï¼ˆè½»é‡çš„ï¼‰æ ‡ç­¾&lt;/h3&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ git tag root-commit d9976&lt;/code&gt;&lt;/pre&gt;
&lt;img src=&apos;https://s2.loli.net/2025/05/24/ZdV1ijg8DwaxSpG.png&apos; title=&apos;æ·»åŠ ä¸€ä¸ªæ–°çš„è½»é‡æ ‡ç­¾å&apos; alt=&apos;æ·»åŠ ä¸€ä¸ªæ–°çš„è½»é‡æ ‡ç­¾å&apos; width=&apos;500&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;åˆ›å»ºäº†ä¸€ä¸ªæ ‡ç­¾å¼•ç”¨ï¼ŒæŒ‡å‘ä¸€ä¸ªcommitå®ä½“ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;$ cat .git/refs/tags/root-commit 
d9976cfe0430557885d162927dd70186d0f521e8&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;è¡¥å……é˜…è¯»&lt;/h2&gt;
&lt;ul&gt;&lt;li&gt;&lt;a href=&apos;http://book.git-scm.com/index.html&apos;&gt;Gitç¤¾åŒºä¹¦&lt;/a&gt;â€œç¬¬7ç« ï¼šå†…éƒ¨æ„é€ æ¢ç©¶â€&lt;/li&gt;
&lt;li&gt;&lt;a href=&apos;http://progit.org/book/ch9-0.html&apos;&gt;Pro Git&lt;/a&gt;â€œç¬¬9ç« ï¼šGitå†…éƒ¨æ„é€ â€ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;h2&gt;æ¥ä¸‹æ¥åšä»€ä¹ˆå‘¢ï¼Ÿ&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯»æ‰¾é€‚åˆåˆ†å¸ƒå¼å›¢é˜Ÿã€é•¿æœŸé¡¹ç›®çš„ä¸€ä¸ªæœ€å°åŒ–gitå·¥ä½œæµã€‚&lt;/p&gt;</description>
            <pubDate>2013-09-28</pubDate>
            <link>https://blog.xiayf.cn/posts/learning-git-internals-by-example.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/learning-git-internals-by-example.html</guid>
        </item>
        
        <item>
            <title>å·¥ä½œä¸­çš„æŠ€æœ¯äºº</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;å·¥ä½œå…¥èŒåŠä¸ªæœˆï¼Œæœ‰äº›äº‹æƒ…ä¸å¤ªé¡ºåˆ©ï¼Œè¿˜æ²¡æœ‰æ­£å¼ä¸Šæ‰‹å·¥ä½œï¼Œä¹Ÿè®¸å¤§å…¬å¸çš„èŠ‚å¥ä¾¿æ˜¯å¦‚æ­¤ï¼Œä½†æˆ‘å†…å¿ƒæ˜¯æ¯”è¾ƒæ€¥çš„ï¼Œå¸Œæœ›èƒ½å°½å¿«åœ°ä¸Šæ‰‹åšå®é™…çš„å·¥ä½œï¼Œè€Œä¸æ˜¯å­¦ä¹ å’Œç­‰å¾…ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™åŠä¸ªæœˆé‡Œï¼Œä¸»è¦æ˜¯ç†Ÿæ‚‰å·¥ä½œç¯å¢ƒï¼Œå­¦ä¹ äº†è§£å·¥ä½œç›¸å…³çš„æŠ€æœ¯ã€‚è™½è¯´å­¦ä¹ ï¼Œä½†å…¶å®å¤§éƒ¨åˆ†ç›¸å…³æŠ€æœ¯ä»¥å‰éƒ½äº†è§£æˆ–ä½¿ç”¨è¿‡ï¼Œåªæ˜¯ç»éªŒè¿˜ä¸å¤Ÿã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç¬¬ä¸€å‘¨ï¼Œé™¤äº†å¸¸è§„çš„å…¥èŒäº‹å®œï¼Œæ­å»ºäº†å¼€å‘æµ‹è¯•ç¯å¢ƒï¼Œå¹¶é˜…è¯»ç†è§£å·¥ä½œä¸­ä½¿ç”¨çš„webæ¡†æ¶ã€‚å¯¹äºè¿™ä¸ªæ¡†æ¶ï¼Œæœ‰å¤ªå¤šçš„åæ§½ç‚¹ï¼Œä¸¥æ ¼åœ°è¯´ç®—ä¸ä¸Šæ˜¯ä¸ªæ¡†æ¶ï¼Œå¯èƒ½æ˜¯å› ä¸ºå†™å¾—æ¯”è¾ƒæ—©ã€‚å¯¹äºæ¡†æ¶ï¼Œæˆ‘è®¤ä¸ºæœ€é‡è¦çš„æ˜¯ä¸ºå¤šäººåä½œå®Œæˆä¸€ä»¶äº‹æƒ…æä¾›å®ç°ä¸Šçš„è§„èŒƒï¼Œå…¶æ¬¡æ˜¯ä»£ç å¤ç”¨ï¼Œå‡å°‘å·¥ä½œé‡ã€‚ä½†è¿™ä¸ªæ¡†æ¶é™¤äº†ä¸€äº›ä¾›å¤ç”¨çš„ä»£ç ï¼Œå°±å•¥éƒ½æ²¡æœ‰äº†ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç¬¬äºŒå‘¨ï¼Œå­¦ä¹ å·©å›ºPHPåŸºç¡€ï¼Œä¸€ç›´æ²¡è®¤çœŸåœ°å­¦ä¹ è¿‡PHPï¼Œåªæ˜¯åœ¨å®ä¹ çš„æ—¶å€™åšäº†ä¸€äº›å¼€å‘ï¼Œç¨å¾®äº†è§£äº†ä¸‹Yiiæ¡†æ¶å’ŒZendæ¡†æ¶ï¼Œè§‰å¾—å¤ªå¤æ‚äº†ç‚¹ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåˆæ­¥äº†è§£ç»„å†…çš„è¿ç»´å·¥ä½œï¼Œç‰¹åˆ«æ˜¯æ•´ä¸ªç³»ç»Ÿçš„æ¶æ„ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç»è¿‡ä¸€ç•ªæ€è€ƒï¼ŒåŸºäºè‡ªå·±çš„ç†è§£ï¼Œæ˜¨å¤©ç¼–å†™äº†ä¸€ä¸ªç©å…·æ€§è´¨çš„MVC webæ¡†æ¶åŸå‹&lt;a href=&apos;https://github.com/youngsterxyf/minibean&apos;&gt;minibean&lt;/a&gt;ï¼Œè¯¥æ¡†æ¶ä»¥è·¯ç”±è½¬å‘å’Œæ§åˆ¶å™¨ä¸ºæ ¸å¿ƒï¼Œæ‰€æœ‰éé™æ€æ–‡ä»¶è¯·æ±‚çš„å¤„ç†éƒ½ä»¥Applicationç±»å¯¹è±¡ä¸ºå…¥å£ï¼ŒæŒ‰ç…§ä¸€å®šè§„åˆ™å¯¹è¯·æ±‚URIç»è·¯ç”±è½¬å‘æ‰¾åˆ°å¯¹åº”çš„æ§åˆ¶å™¨ç±»ï¼Œæ§åˆ¶å™¨å¯¹è±¡ä¸­è°ƒç”¨æ¨¡å‹ä¸è§†å›¾çš„ç±»å¯¹è±¡ç­‰ã€‚ä»¥åéšç€å¼€å‘ç»éªŒçš„å¢åŠ ä»¥åŠå¯¹å…¶ä»–å¼€æºæˆç†Ÿæ¡†æ¶çš„å­¦ä¹ ï¼Œä¼šä¸æ–­åœ°å®Œå–„è¯¥æ¡†æ¶ã€‚åœ¨ç¼–å†™è¯¥æ¡†æ¶çš„è¿‡ç¨‹ä¸­ï¼Œæ·±æ„Ÿè‡ªå·±ç»éªŒçš„ä¸è¶³ï¼Œç‰¹åˆ«æ˜¯å¯¹äºModelå±‚ï¼Œä»¥åå¯èƒ½ä¼šåˆ»æ„é˜…è¯»æŸäº›å¼€æºæ¡†æ¶çš„Modelå±‚å®ç°ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç›®å‰ç»„å†…å¼€å‘å·¥ä½œè¿˜å¾ˆåˆæ­¥ï¼Œè¿˜æ²¡æœ‰ä¸€ä¸ªæ­£è§„çš„å¼€å‘æµç¨‹ï¼Œä¹Ÿæ²¡æœ‰æ˜ç¡®çš„å¼€å‘è§„èŒƒã€‚è¿™æ ·è™½ç„¶æ²¡æ³•ä»å·²æœ‰çš„å·¥ä½œä¸­å­¦ä¹ å¾ˆå¤šï¼Œä½†ä¹Ÿè®¸æœ‰æœºä¼šå‚ä¸åˆ°è¿™äº›äº‹æƒ…åˆ›é€ è¿‡ç¨‹ä¸­ï¼Œæ”¶è·ä¼šæ›´å¤§ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç»è¿‡å’Œè€åŒäº‹è®¨è®ºï¼Œä»¥åå¼€å‘å·¥ä½œæ¶‰åŠçš„è¯­è¨€å’Œå·¥å…·åŒ…æ‹¬ï¼šNginxã€MySQLã€PHPã€Redis/Memcachedã€SVNç­‰ï¼Œå¯¹äºè¿™äº›ä¸œè¥¿ï¼Œæˆ‘éƒ½æ˜¯éœ€è¦æ·±å…¥å­¦ä¹ åŠ å¼ºçš„ï¼ˆå½“ç„¶é¦–å…ˆæ˜¯è¦è§£å†³ä¸šåŠ¡éœ€æ±‚ï¼‰ã€‚å¦å¤–ï¼Œé‰´äºåŸæœ‰çš„é‚£ä¸ªæ¡†æ¶å®åœ¨ä¸æ€ä¹ˆæ ·ï¼Œä»¥åæ–°çš„å·¥ä½œå¯èƒ½ä¼šé€‰æ‹©Zend Frameworkä½œä¸ºå¼€å‘æ¡†æ¶ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äºå·¥ä½œç¯å¢ƒï¼Œæˆ‘è§‰å¾—ä¸å¤ªæ»¡æ„çš„åœ°æ–¹ä¸»è¦æ˜¯æŠ€æœ¯æ°›å›´ä¸å¤ªæµ“åšï¼Œä»¥åæœ‰æœºä¼šå’Œå¤§å®¶ä¸€èµ·å»ºç«‹èµ·å¥½çš„æŠ€æœ¯æ°›å›´ï¼ŒæææŠ€æœ¯åˆ†äº«è®¨è®ºä»€ä¹ˆçš„ã€‚å¦å¤–ï¼Œæœ‰ç‚¹æ†‹å±ˆçš„æ˜¯ï¼Œè§‰ç€è‡ªå·±è¢«å°çœ‹äº†ï¼Œè€åŒäº‹è€è§‰å¾—åº”å±Šæ¯•ä¸šç”Ÿå•¥çš„ä¸æ‡‚ï¼Œæ‰€ä»¥ä¹Ÿä¸æ€¥ç€åˆ†é…å…·ä½“çš„å·¥ä½œç»™æˆ‘ï¼Œè€è®©æˆ‘å­¦ä¹ å­¦ä¹ å†å­¦ä¹ ã€‚ä¸ªäººè®¤ä¸ºæœ€å¥½çš„å­¦ä¹ æ–¹å¼æ˜¯ç»™ä¸ªå…·ä½“çš„éœ€æ±‚ï¼Œå…·ä½“çš„é—®é¢˜è®©æˆ‘å»è§£å†³ï¼Œæœ‰ç»éªŒçš„åŒäº‹åªéœ€å¯¹ç»“æœæŠŠæŠŠå…³å°±å¯ä»¥ã€‚å½“æˆ‘åœ¨è¿™è¿‡ç¨‹ä¸­é‡åˆ°æä¸å®šçš„é—®é¢˜å†å‘ä»–ä»¬è¯·æ•™ï¼Œä»¥è¿™ç§æ–¹å¼æ¥ä¸Šæ‰‹ç†Ÿæ‚‰å·¥ä½œä¹Ÿè®¸æ›´å¥½ã€‚æˆ‘ä¸ªäººä¹Ÿæ¯”è¾ƒå–œæ¬¢ç›´æ¥ä¸¢ä¸ªå®é™…çš„é—®é¢˜è®©æˆ‘å»è§£å†³ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äºä»Šåçš„è‡ªå·±ï¼Œæˆ‘æœ‰ä¸¤ç‚¹å¿ å‘Šï¼š&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;1ã€æ—¶åˆ»è­¦æƒ•è¿·å¤±&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è™½ç„¶å·¥ä½œå¾ˆé‡è¦ï¼Œè¦è§£å†³ä¸šåŠ¡éœ€æ±‚ï¼Œå·¥ä½œæ‰€æ¶‰åŠçš„æŠ€æœ¯ä¹Ÿåº”è¯¥æ‰å®æŒæ¡ï¼Œæ·±å…¥ç†è§£ï¼Œä½†ä¸èƒ½æŠŠè‡ªå·±å±€é™åœ¨æ­¤ï¼Œä¹Ÿä¸èƒ½è®©è‡ªå·±è¿·å¤±åœ¨è¿‡äºç»†èŠ‚çš„åœ°æ–¹ã€‚å…¬å¸æä¾›äº†ä¸€ä¸ªå®Œå–„çš„å¹³å°ï¼Œä½†è¿™ä¸ªå¹³å°åœ¨æˆ‘çœ‹æ¥è‡ªè¶³å¾—æœ‰äº›å°é—­ï¼Œæ‰€ä»¥éœ€è­¦æƒ•ï¼Œè¦ä¸æ–­åœ°å’ŒåŒäº‹ï¼Œå’Œå…¬å¸å¤–é¢çš„äººäº¤æµå­¦ä¹ ã€‚è¦ç»å¸¸è‡ªæˆ‘åæ€ï¼Œå›é¡¾è‡ªå·±èµ°è¿‡çš„è·¯ï¼Œè¦è®©è‡ªå·±çš„å¤§è„‘ç©ºé—²ä¸‹æ¥èŠ±äº›æ—¶é—´æ•´ä½“è§„åˆ’å³å°†è¦åšçš„äº‹æƒ…ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;2ã€ä¿æŒé”æ°”&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åˆæ­¥è§‰ç€æœ‰äº›åŒäº‹æ²¡ä»€ä¹ˆå·¥ä½œç”Ÿæ´»æŠ€æœ¯çš„æ¿€æƒ…ï¼Œå¯èƒ½æ˜¯é•¿æ—¶é—´å·¥ä½œçš„ç¼˜æ•…ï¼Œä¹Ÿå¯èƒ½æ˜¯å› ä¸ºæˆ‘è¿˜å¤ªå¹´è½»ã€‚ä½†ç›®å‰æˆ‘è¿˜ä¸æ„¿æ„è‡ªå·±è¿›å…¥é‚£ç§çŠ¶æ€ã€‚è‡ªå·±ä»¥ååº”è¯¥æ›´åŠ ä¸»åŠ¨ç§¯æåœ°å¯¹å¾…å·¥ä½œã€‚æˆ‘å–œæ¬¢ç§°å‘¼è‡ªå·±ä¸ºâ€œæŠ€æœ¯äººâ€ï¼Œå› ä¸ºâ€œæŠ€æœ¯äººâ€ä¸ä»…æ˜¯ææŠ€æœ¯çš„ï¼Œæ›´é‡è¦çš„æ˜¯å¯¹æŠ€æœ¯æœ‰çƒ­æƒ…ï¼Œæœ‰ä½¿å‘½æ„Ÿã€‚&lt;/p&gt;</description>
            <pubDate>2013-04-23</pubDate>
            <link>https://blog.xiayf.cn/posts/technical-person.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/technical-person.html</guid>
        </item>
        
        <item>
            <title>å¼„æ¸…é—®é¢˜ï¼Œå†æ±‚è§£å†³</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;ä»Šå¤©åŒäº‹é—®æˆ‘ï¼šæ˜¯å¦æœ‰ä»€ä¹ˆpythonåº“æˆ–å·¥å…·èƒ½å¤Ÿå°†ç½‘é¡µå†…å®¹è½¬æ¢æˆå›¾ç‰‡æ ¼å¼çš„ã€‚ä»–åœ¨åšè¿™æ–¹é¢çš„äº‹æƒ…ï¼Œè¿˜æ²¡æœ‰å¥½çš„æ–¹æ³•ï¼Œå› ä¸ºè§‰å¾—æˆ‘å¯¹pythonæ¯”è¾ƒç†Ÿæ‚‰ï¼Œæ‰€ä»¥é—®ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½†æ˜¯æˆ‘ä»ä¸€å¼€å§‹æˆ‘å°±çŠ¯é”™è¯¯äº†ã€‚å…¶å®æˆ‘è‡³å°‘åº”è¯¥é—®ä¸€ä¸‹ï¼šä¸ºä»€ä¹ˆè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿä¹Ÿå°±æ˜¯ä¸šåŠ¡éœ€æ±‚æ˜¯ä»€ä¹ˆï¼Ÿå¹¶ä¸”ç¨å¾®ä¸€æƒ³è¿™ä¸ªé—®é¢˜å…¶å®æ¯”è¾ƒå«ç³Šã€‚ç°åœ¨çš„webé¡µé¢å¯ä»¥å¾ˆç®€å•ï¼Œä¹Ÿå¯èƒ½å¾ˆå¤æ‚ã€‚é‚£ä¹ˆè¿™ä¸ªé—®é¢˜é‡Œçš„â€œç½‘é¡µâ€æ˜¯ä»€ä¹ˆæ ·çš„ç½‘é¡µå‘¢ï¼Ÿæ˜¯ä»»ä½•å¯èƒ½çš„ç½‘é¡µä¹ˆï¼Ÿç›®çš„æ˜¯éœ€è¦é€šè¿‡å›¾ç‰‡æ¥å±•ç¤ºç½‘é¡µçš„å“ªä¸ªéƒ¨åˆ†çš„ä¿¡æ¯è¿˜æ˜¯æ•´ä¸ªç½‘é¡µï¼Ÿè¿™äº›é—®é¢˜æˆ‘éƒ½æ²¡é—®ï¼Œä¹Ÿæ²¡ä»”ç»†è€ƒè™‘ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨æ²¡æœ‰æ˜ç¡®éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œæˆ‘å°±è®¤ä¸ºæ˜¯å°†ä»»ä½•å½¢å¼çš„ç½‘é¡µå®Œæ•´åœ°è½¬æ¢æˆå›¾ç‰‡ï¼Œä½†åˆæ²¡å¼„æ¸…å¦‚æœæ˜¯è¿™ç§æƒ…å†µé—®é¢˜çš„éš¾åº¦æœ‰å¤šå¤§ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨å¬å®Œé—®é¢˜åï¼Œæˆ‘å°±æƒ³åˆ°å¯èƒ½æœ‰ä¸¤ç§æ–¹æ³•ï¼š1. å…ˆå°†ç½‘é¡µè½¬æ¢æˆpdfï¼Œç„¶åè½¬æ¢æˆå›¾ç‰‡ï¼Œå› ä¸ºæˆ‘å¯¹äºå°†ç½‘é¡µè½¬æ¢æˆpdfæ ¼å¼çš„æ–¹æ³•æœ‰ç‚¹å°è±¡ï¼›2.å¯èƒ½å­˜åœ¨pythonå®ç°çš„å·¥å…·ç›´æ¥å°†ç½‘é¡µè½¬æ¢æˆå›¾ç‰‡æ ¼å¼ã€‚ä½ æ˜¯å¦å‘ç°æˆ‘çš„æ€è·¯æœ‰ä¸ªè¯¯åŒºï¼šé—®é¢˜çš„è§£å†³æ–¹æ¡ˆéœ€è¦pythonä»£ç å®ç°ï¼Œæˆ‘å‡è®¾äº†éœ€è¦å°†è¿™ä¸ªåŠŸèƒ½åµŒå…¥åˆ°ä¸€ä¸ªå¤§çš„ç¨‹åºä¸­ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç„¶åæˆ‘å°±å¼€å§‹è’™å¤´googleæ‰¾æ–¹æ¡ˆã€‚ç»è¿‡ä¸€ç•ªâ€œè‰°è‹¦å“ç»â€çš„æŸ¥æ‰¾ï¼Œå‘ç°ï¼š1.ç¡®å®æœ‰å¦‚xhtml2pdfç­‰å·¥å…·èƒ½å°†ç½‘é¡µè½¬æ¢æˆpdfæ ¼å¼ï¼Œä½†è²Œä¼¼å¯¹äºä¸­æ–‡çš„æ”¯æŒä¸æ˜¯å¾ˆå¥½ï¼›2.æ²¡æœ‰å¥½çš„pythonåº“æˆ–å·¥å…·èƒ½å¤Ÿç›´æ¥å°†ç½‘é¡µè½¬æ¢æˆå›¾ç‰‡æ ¼å¼ï¼Œæœ‰çš„æ–¹æ¡ˆè¦æ”¶è´¹ï¼Œæœ‰çš„æ–¹æ¡ˆéœ€è¦è°ƒç”¨ç¬¬ä¸‰æ–¹APIï¼Œè€Œå…¬å¸çš„æ•°æ®æ˜æ˜¾æ˜¯ä¸èƒ½è®©ç¬¬ä¸‰æ–¹è·å¾—çš„ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨æŸ¥æ‰¾è§£å†³æ–¹æ¡ˆçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¹Ÿé€æ­¥æ„è¯†åˆ°ä¸Šè¿°çš„é‚£äº›é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯è‹¥å‡è®¾éœ€è¦å°†ä»»ä½•å½¢å¼çš„ç½‘é¡µè½¬æ¢æˆå›¾ç‰‡æ ¼å¼ï¼Œè¿™ä¸ªéš¾åº¦éå¸¸å¤§ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºç°åœ¨å¾ˆå¤šç½‘é¡µçš„éƒ¨åˆ†å†…å®¹éƒ½æ˜¯ç”±JSç”Ÿæˆçš„ï¼Œè‹¥ä½ çš„ç¨‹åºåªæ˜¯ç®€å•åœ°ä»æœåŠ¡å™¨è·å–ç½‘é¡µï¼Œè¯¥ç½‘é¡µå«æœ‰çš„JSä»£ç å¹¶ä¸ä¼šæ‰§è¡Œï¼Œå°†è¯¥ç½‘é¡µè½¬æ¢æˆå›¾ç‰‡æ ¼å¼ï¼Œå›¾ç‰‡æ‰€åŒ…å«çš„ä¿¡æ¯ä¸æµè§ˆå™¨ä¸­å±•ç¤ºçš„å¹¶ä¸ç›¸åŒã€‚æ‰€ä»¥ä½ çš„ç¨‹åºèµ·ç éœ€è¦åŒ…å«ä¸€ä¸ªJSè§£é‡Šå™¨ã€‚OKï¼Œéš¾åº¦ä¸€ä¸‹å­å°±ä¸Šå»äº†ã€‚åœ¨æˆ‘é€æ­¥äº†è§£å…¶ä¸­çš„éš¾åº¦åï¼Œæˆ‘å¼€å§‹å°è¯•æ¢ä¸ªè§’åº¦æ¥è€ƒè™‘é—®é¢˜ï¼Œåæ€åŒäº‹æ‰€è¦è§£å†³çš„ä¸šåŠ¡éœ€æ±‚æ˜¯ä»€ä¹ˆã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨ä¸ä»–çš„è¿›ä¸€æ­¥æ²Ÿé€šä¹‹åï¼Œæˆ‘æ‰çŸ¥é“ï¼šä¸€äº›æ€»ç»“æ±‡æŠ¥é‚®ä»¶ä¸­éœ€è¦æ·»åŠ æ•°æ®ç»Ÿè®¡å›¾ï¼Œè€ŒåŸæœ‰çš„æ•°æ®ç»Ÿè®¡å›¾åœ¨Webç›‘æ§é¡µé¢ä¸­ï¼Œç”±Raphaeljsåº“ç»˜åˆ¶æˆSVGçŸ¢é‡å›¾ã€‚ç”±äºæ— æ³•æœŸæœ›é‚®ä»¶çš„æ¥æ”¶è€…æ˜¯ä»ç½‘é¡µç‰ˆé‚®ç®±é˜…è¯»é‚®ä»¶ï¼ˆä»–ä»¬å¾ˆå¯èƒ½ä½¿ç”¨å„ç§é‚®ä»¶å®¢æˆ·ç«¯å¦‚OutlookæŸ¥çœ‹é‚®ä»¶ï¼‰ï¼Œæ‰€ä»¥å‘é€å¸¦æœ‰JSçš„HTMLæ ¼å¼çš„é‚®ä»¶æ˜¯æ²¡ç”¨çš„ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨äº†è§£ä¸šåŠ¡éœ€æ±‚åï¼Œæˆ‘ä»¬å°±æ˜ç™½äº†å…¶å®é—®é¢˜æœ¬è´¨ä¸Šä¸æ˜¯è¦å°†ç½‘é¡µè½¬æ¢æˆå›¾ç‰‡ï¼Œè€Œæ˜¯è¦è·å¾—&lt;strong&gt;å›¾ç‰‡æ ¼å¼çš„æ•°æ®å¯è§†åŒ–ç»“æœ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é‚£ä¹ˆé—®é¢˜å°±ç®€å•å¤šäº†ï¼Œå¯èƒ½ä»ä»¥ä¸‹ä¸‰ä¸ªè§’åº¦å¯»æ‰¾è§£å†³æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;å°†ç½‘é¡µå®Œæ•´åœ°è½¬æ¢æˆå›¾ç‰‡æ ¼å¼&lt;/li&gt;
&lt;li&gt;å°†ç½‘é¡µä¸­çš„SVGå†…å®¹è½¬æ¢æˆå›¾ç‰‡æ ¼å¼&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨æœ¬åœ°çš„æ•°æ®å¯è§†åŒ–å·¥å…·å°†ç»Ÿè®¡æ•°æ®æºï¼Œå³Raphaeljsç»˜åˆ¶SVGçŸ¢é‡å›¾çš„JSONæ•°æ®æºç»˜åˆ¶æˆå›¾ç‰‡&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸‰ç§æ–¹æ¡ˆä¸­ç¬¬äºŒç§æœ€ä½³ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºç¬¬ä¸€ç§éœ€è¦åšä¸€äº›é¢å¤–çš„è½¬æ¢å·¥ä½œï¼Œè‡ªå·±å®ç°çš„éš¾åº¦è¾ƒå¤§ï¼Œç¬¬ä¸‰ç§æ–¹æ¡ˆä¸Webç›‘æ§é¡µé¢æ‰€ä½¿ç”¨çš„æ˜¯ä¸åŒçš„æ•°æ®å¯è§†åŒ–å·¥å…·ï¼Œæ‰€ä»¥äº§ç”Ÿçš„ç»“æœä¸€èˆ¬æ˜¯ä¸ç›¸åŒçš„ï¼Œé™¤éRaphaeljsæ”¯æŒå›¾ç‰‡æ ¼å¼çš„è¾“å‡ºï¼Œé‚£ä¹ˆåº”è¯¥å°±å¯ä»¥ä½¿ç”¨nodejsæ¥å®ç°ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç»è¿‡ç½‘ç»œæŸ¥æ‰¾ï¼Œå‘ç°ç¬¬ä¸€ç§æ–¹æ¡ˆä¸ç¬¬äºŒç§æ–¹æ¡ˆéƒ½æœ‰ç°æˆçš„å·¥å…·ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç¬¬ä¸€ç§æ–¹æ¡ˆï¼š&lt;a href=&apos;https://github.com/ariya/phantomjs&apos;&gt;phantomjs&lt;/a&gt;å¯ä»¥å®Œæˆï¼ŒphantomjsåŒ…å«äº†webkitï¼Œæ‰€ä»¥è§£é‡ŠJSä»€ä¹ˆçš„å°±ä¸å†æ˜¯ä¸ªé—®é¢˜äº†ï¼Œå®ƒæœ‰ä¸ª&lt;a href=&apos;https://github.com/ariya/phantomjs/wiki/Screen-Capture&apos;&gt;Screen Capture&lt;/a&gt;çš„åŠŸèƒ½æ¨¡å—æ”¯æŒå°†ç½‘é¡µå®Œæ•´åœ°è½¬æ¢æˆå›¾ç‰‡æ ¼å¼ï¼Œä½†ç”±äºè¦åšå¾ˆå¤šé¢å¤–çš„å·¥ä½œï¼Œæ‰€ä»¥æ•ˆç‡æ¯”è¾ƒä½ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç¬¬äºŒç§æ–¹æ¡ˆæ˜¯ä»Highchartsçš„&lt;a href=&apos;http://www.highcharts.com/demo/&apos;&gt;Demo&lt;/a&gt;ä¸­æŒ–æ˜å‡ºæ¥çš„ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;img src=&apos;https://s2.loli.net/2025/06/05/hg9KSu156BXmJzG.png&apos; title=&apos;highchartjs_demo&apos; alt=&apos;highchartjs_demo&apos; width=&apos;100%&apos;/&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Demoä¸­å¯ä»¥è¾“å‡ºå¤šç§å›¾ç‰‡æ ¼å¼ï¼Œé€šè¿‡chromeæµè§ˆå™¨çš„å¼€å‘è€…å·¥å…·å¯ä»¥å‘ç°å…¶å®ç°æ˜¯å‘æœåŠ¡å™¨export.highcharts.comå‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œè¯·æ±‚ä¸­åŒ…å«ç½‘é¡µä¸­ç”Ÿæˆçš„SVGçŸ¢é‡å›¾æ•°æ®ã€ç›®æ ‡å›¾ç‰‡æ ¼å¼ç­‰ä¿¡æ¯ï¼ŒæœåŠ¡å™¨å¯¹è¯¥è¯·æ±‚è¿›è¡Œå¤„ç†åè¿”å›ç›®æ ‡æ ¼å¼å›¾ç‰‡ã€‚é‚£ä¹ˆæœåŠ¡å™¨ç«¯æ˜¯å¦‚ä½•å°†SVGè½¬æ¢æˆå›¾ç‰‡æ ¼å¼çš„å‘¢ï¼Ÿåœ¨Highchartsçš„&lt;a href=&apos;http://docs.highcharts.com/&apos;&gt;æ–‡æ¡£&lt;/a&gt;ä¸­æœ‰ä¸ªåä¸º&lt;code&gt;Export module&lt;/code&gt;çš„éƒ¨åˆ†ï¼Œå…¶ä¸­è¯´æ˜äº†å®ç°åŸç†ä»¥åŠå¦‚ä½•æ­å»ºè¿™æ ·çš„ä¸€ä¸ªæ ¼å¼è½¬æ¢æœåŠ¡å™¨ã€‚ä»æ–‡æ¡£å¯ä»¥çœ‹å‡ºè¿™ä¸ªå®ç°æ–¹æ³•çš„æ ¸å¿ƒæ˜¯å€ŸåŠ©äº†&lt;a href=&apos;http://xmlgraphics.apache.org/batik/tools/rasterizer.html&apos;&gt;batik-rasterizer.jar&lt;/a&gt;è¿™ä¸ªJavaå·¥å…·åŒ…ï¼Œå®ƒèƒ½å°†SVGè½¬æ¢æˆå›¾ç‰‡æˆ–PDFæ ¼å¼ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä»ä¸Šè¿°è¯¥é—®é¢˜è§£å†³æ–¹æ¡ˆçš„å¯»æ‰¾è¿‡ç¨‹å¯ä»¥çœ‹å‡ºï¼Œ&lt;strong&gt;å¾ˆå¤šæ—¶å€™å¹¶ä¸æ˜¯é—®é¢˜æœ‰å¤šå¤æ‚æˆ–æœ‰å¤šéš¾ï¼Œè€Œæ˜¯æˆ‘ä»¬æ ¹æœ¬æ²¡æœ‰æ˜ç¡®ä¸šåŠ¡éœ€æ±‚ï¼Œæ²¡æœ‰ææ¸…æ¥šçœŸæ­£éœ€è¦è§£å†³çš„é—®é¢˜ï¼Œè€Œå¯¹æ¨¡ç³Šçš„é—®é¢˜æè¿°è‡ªä»¥ä¸ºæ˜¯åœ°ä½œå‡ºä¸€äº›å‡è®¾ï¼Œç„¶åè’™å¤´å»è§£å†³é”™è¯¯çš„é—®é¢˜ï¼Œä»è€Œæµªè´¹äº†å¾ˆå¤šæ—¶é—´&lt;/strong&gt;ã€‚&lt;/p&gt;</description>
            <pubDate>2013-04-09</pubDate>
            <link>https://blog.xiayf.cn/posts/understand-before-solve.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/understand-before-solve.html</guid>
        </item>
        
        <item>
            <title>å›é¡¾2012ï¼Œå±•æœ›2013</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;è¿‡å»çš„ä¸€å¹´é‡Œå‘ç”Ÿäº†å¾ˆå¤šäº‹æƒ…ï¼Œå¾ˆå¤§ä¸€éƒ¨åˆ†åŸæ¥å°±å·²åœ¨&lt;a href=&apos;http://youngsterxyf.github.io/2012/01/01/2011-summary/&apos;&gt;2011å¹´ç»ˆ-å›é¡¾ä¸å±•æœ›&lt;/a&gt;ä¸€æ–‡ä¸­æåŠ---å®ä¹ ã€æ‰¾å·¥ä½œã€æ¯•ä¸šï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰ï¼šæˆ‘å’Œå¥³æœ‹å‹å®šäº²äº†ï¼Œæ€»ç®—æœç€å©šå§»è¿‘äº†ä¸€æ­¥ï¼Œå“ˆå“ˆã€‚&lt;/p&gt;
&lt;h2&gt;å®ä¹ &lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å…³äºå®ä¹ æœ‰å¤ªå¤šçš„è¯æƒ³è¯´ã€‚7ä¸ªæœˆçš„æ—¶é—´é‡Œæµ“ç¼©äº†å¤ªå¤šçš„æ¬¢ä¹ï¼Œå¤ªæ¬¢ä¹äº†ã€‚åŸæœ¬ä»¥ä¸ºæˆ‘çš„è¯»ä¹¦ç”Ÿæ¶¯å°±è¦è¿™ä¹ˆå¹³æ·¡æ— å¥‡åœ°ç»“æŸäº†ï¼Œæ²¡æƒ³åˆ°åœ¨è¿™ä¸ªç»“å°¾å¤„ç«Ÿç„¶ç»™äº†æˆ‘ä¸ªå¤§æƒŠå–œï¼Œæ‰€è°“æƒŠå–œå¹¶ä¸æ˜¯è¿™ä»½å®ä¹ æœ‰å¤šç‰›é€¼ï¼Œè€Œæ˜¯é‡åˆ°äº†ä¸€ç¾¤æ¬¢ä¹çš„äººï¼Œä¸€ç¾¤â€œé‡å£å‘³â€çš„äººï¼Œä¸€ç¾¤å½ªæ‚çš„äººï¼Œè€Œå…¶ä¸­ç»å¤§éƒ¨åˆ†æ˜¯å¥³äººï¼Œå™¢ï¼Œå¥³ç”Ÿæ›´æ°å½“äº›ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨G1C1ï¼Œæˆ‘å¿«ä¹åœ°å†™ä»£ç ï¼Œä¸Šç­æ˜¯ç§äº«å—ï¼Œæˆ‘æƒ³ä»¥åå¾ˆå¯èƒ½ä¸ä¼šå†æœ‰è¿™æ ·çš„äº«å—äº†ã€‚åœ¨G1C1ï¼Œæˆ‘é€æ­¥åœ°å‘å±•æˆä¸ºä¸€ä¸ªåƒè´§ï¼Œæ‰€ä»¥æ¯«æ— ç–‘é—®åœ°èƒ–äº†ï¼ŒåŸæœ¬æˆ‘ä»¥ä¸ºè‡ªå·±ä¼šä¸€ç›´ç˜¦ä¸‹å»ã€‚å¦å¤–ï¼Œæˆ‘ä¹Ÿé»‘äº†ï¼Œå› ä¸ºç»è¿‡äº†æ— æ•°æ¬¡åœ°â€œè¢«é»‘â€ï¼Œä½†å¥¹ä»¬è¯´æˆ‘åº”è¯¥é«˜å…´æ‰å¯¹ï¼Œå¥¹ä»¬â€œé»‘â€æˆ‘æ˜¯å› ä¸ºâ€œçˆ±â€æˆ‘ã€‚å…³äºâ€œé»‘â€è¿™ä»¶äº‹æƒ…ï¼Œåˆšå…¥èŒçš„æ—¶å€™ï¼Œæˆ‘æ˜¯å¾ˆåŒæƒ…wenbinçš„ï¼Œå› ä¸ºè§ä»–è¢«â€œé»‘â€å¾—ä½“æ— å®Œè‚¤çš„ï¼Œå¯æˆ‘ä¹Ÿæ²¡é€ƒè„±ä½œä¸ºä¸€ä¸ªG1C1ç å†œçš„å®¿å‘½ï¼Œwenbinèµ°åï¼Œæ›¿ä»£äº†ä»–çš„è§’è‰²ï¼Œè€Œæˆ‘èµ°åï¼Œcomenåˆ™æ›¿ä»£äº†æˆ‘çš„è§’è‰²ï¼Œå¯æƒœä¹‹åå°±ä¸ä¼šå†æœ‰äº†ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åƒï¼Œæ˜¯Googleçš„ç‰¹è‰²ï¼Œæ•…åœ¨G1C1ä¹Ÿä¸ä¾‹å¤–ã€‚å› ä¸ºG1C1ä¸ä¸å…¶ä»–éƒ¨é—¨åœ¨ä¸€èµ·ï¼Œæ‰€ä»¥æ²¡æ³•åƒé£Ÿå ‚ã€‚ä½†æˆ‘ä»¬ä¹Ÿä¸äºï¼Œè€å¤§å¸¦ç€æˆ‘ä»¬åƒéäº†åŠå…¬å®¤æ–¹åœ†å‡ é‡Œåœ°å«å¾—å‡ºåçš„é¥­åº—ï¼Œåƒé¥±åƒå¥½ï¼Œå¹¶ä¸”ä¸€å¤©ä¸€æ¢ã€‚å¹¶ä¸”åƒé¥­çš„åœºæ™¯å®åœ¨ä¸å¾—ä¸è®©ç å†œæ„Ÿåˆ°å¹¸ç¦ï¼Œç”·å¥³æ¯”ä¾‹ç»å¸¸æ˜¯6ï¼š1ï¼Œä¸â€œäº¤å¤§ç”·å¥³ä¸ƒæ¯”ä¸€ï¼Œä¸€å¯¹æƒ…ä¾£ä¸‰å¯¹åŸºâ€çš„æƒ…å½¢é‚£æ˜¯æ°å¥½ç›¸åï¼Œè€Œä¸”æˆ‘ä»¬å®éªŒå®¤ç”šè‡³æ¯”ä¸ƒæ¯”ä¸€çš„æƒ…å†µè¿˜ä¸¥é‡ã€‚æ‰€ä»¥æˆ‘ä¸€ç›´æ¥å›æ„Ÿå—ä¸¤ç§æç«¯ã€‚åˆç”±äºå¥³ç”Ÿçš„é£Ÿé‡å¤šåŠåå°ï¼Œä½œä¸ºç”·ç”Ÿï¼Œæœ€åâ€œæ‰«ç›˜â€çš„å·¥ä½œé‚£è‡ªç„¶æ˜¯ä¹‰ä¸å®¹è¾çš„ï¼Œèƒ–ä¹Ÿå°±å¿…ç„¶çš„ç»“æœäº†ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å› ä¸ºå·¥ä½œå†…å®¹æ¯”è¾ƒå¤šå…ƒåŒ–ï¼Œæ‰€ä»¥G1C1å®ä¹ ç”Ÿçš„ä¸“ä¸šèƒŒæ™¯ä¸å°±è¯»å­¦æ ¡è¦†ç›–é¢å¾ˆå¤§ï¼Œå¯ä»¥è¯´æ˜¯â€œä¸€é”…å¤§æ‚çƒ©â€ã€‚ä¸“ä¸šä¸åŒï¼Œå¹¶æ²¡æœ‰å¦¨ç¢äº¤æµï¼Œåè€Œä½¿å·¥ä½œæ°›å›´æ›´åŠ æ´»è·ƒï¼Œå…·å¤‡ä¸“ä¸šç‰¹è‰²çš„é˜è¿°æ–¹å¼ä¸å†…å®¹ç›¸äº’ç¢°æ’äº¤èã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¾ˆæƒ³é€ä¸ªä»‹ç»æˆ‘æ‰€çŸ¥é“çš„G1C1erä»¬ï¼Œå¯è‹¦äºèƒ¸æ— åŠç‚¹å¢¨æ°´ï¼Œåªå¥½ä½œç½¢ã€‚ä½†ä½ ä»¬åº”çŸ¥é“ï¼Œåº”ç›¸ä¿¡ï¼Œç°åœ¨ï¼Œä»¥åï¼Œæˆ‘éƒ½ä¼šä¸€ç›´å¿µç€ä½ ä»¬ï¼Œæƒ³ç€ä½ ä»¬ã€‚æ„Ÿè°¢å’Œä½ ä»¬ä¸€èµ·åº¦è¿‡çš„ç¾å¥½é’æ˜¥æ—¶å…‰ã€‚&lt;/p&gt;
&lt;h2&gt;æ‰¾å·¥ä½œ&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘çš„æ±‚èŒç»å†å¹¶ä¸é¡ºåˆ©ï¼Œä¸»è¦åŸå› æ˜¯å¯¹äºæ±‚èŒçš„â€œæ±‚â€å­—åœ¨è®¤è¯†ä¸Šæœ‰æ‰€åå·®ã€‚æˆ‘ä¸å–œæ¬¢â€œæ±‚â€ï¼Œæˆ‘è®¤ä¸ºæ‰¾å·¥ä½œå°±å’Œæ‰¾å¯¹è±¡ä¸€æ ·ï¼Œæˆ‘æƒ³æ‰¾ä½ ï¼Œä½ è®¤å¯æˆ‘ï¼Œæ‰è¡Œã€‚æˆ‘å°±è¿™æ ·ï¼Œä½ ä¸è¦æˆ‘ï¼Œæ‹‰å€’ã€‚è¿™ç§æƒ³æ³•å¯¼è‡´æˆ‘å¹¶æ²¡æœ‰è®¤çœŸå‡†å¤‡ç¬”è¯•é¢è¯•ã€‚å…¶å®æ‰¾å·¥ä½œå’Œå­¦æ ¡é‡Œçš„åº”è¯•æ˜¯ä¸€æ ·ä¸€æ ·çš„ï¼Œæ‰€ä»¥ä½ å¾—åšé¢˜ï¼Œå„ç§åº”è¯•çš„é¢˜ç›®ï¼Œé™¤äº†ä¸€æµçš„å…¬å¸ï¼Œä¸€èˆ¬å…¬å¸è€ƒçš„éƒ½æ˜¯è€é¢˜ç›®æˆ–è€…ç±»ä¼¼çš„é¢˜ç›®ã€‚å¦å¤–ï¼Œè¦æ³¨æ„æ‰¾å·¥ä½œçš„ç›®æ ‡ä¸æ˜¯å‘å…¬å¸è¯æ˜ä½ çš„èƒ½åŠ›ï¼Œè€Œæ˜¯æ‹¿åˆ°offerï¼Œâ€œä¸æ‹©æ‰‹æ®µâ€åœ°æ‹¿åˆ°offerã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹è‡ªå·±æœªæ¥å‡ å¹´åšäº†åŸºæœ¬çš„å®šä½ä¹‹åï¼Œæˆ‘æ²¡æœ‰å‚åŠ é“¶è¡Œã€å›½ä¼ä¸€ç±»å…¬å¸çš„æ‹›è˜ï¼Œé›†ä¸­åº”è˜æŠ€æœ¯å‹çš„ç§ä¼å¤–ä¼å¤§å°å…¬å¸ï¼Œç”±äºè£¸è€ƒè£¸é¢ï¼Œç»“æœå¤šåŠä¸å¤ªç†æƒ³ã€‚è¿™é‡Œå¯¹äºåº”è˜çš„å…¬å¸ä¸åšè¯„ä»·ï¼Œæ±‚èŒçš„å…·ä½“è¿‡ç¨‹ä¹Ÿä¸è¯¦è¿°ï¼Œåªæ˜¯çœŸå¿ƒæ„Ÿè°¢é‚£äº›è®¤å¯æˆ‘èµè¯†æˆ‘çš„äººï¼Œè¿˜æœ‰è™½ç„¶æ‹’äº†æˆ‘ä½†çœŸå¿ƒå¸®åŠ©æˆ‘çš„äººï¼Œè°¢è°¢ä½ ä»¬ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ€åï¼Œè…¾è®¯æ”¶äº†æˆ‘ï¼Œè™½ç„¶å¾…é‡å’ŒèŒä½çš„å·¥ä½œå†…å®¹ä¸æ˜¯å¾ˆç†æƒ³ï¼Œä½†æˆ‘æƒ³åº”è¯¥æ˜¯ä¸ªä¸é”™çš„æœºä¼šï¼Œå€¼å¾—ä»¥åå¥½å¥½åŠªåŠ›å·¥ä½œï¼Œæ„Ÿè°¢å½“æ—¶çš„å‡ ä¸ªé¢è¯•å®˜ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¥åçš„åŒäº‹ï¼Œå½“ç„¶è¿˜è¦ç‰¹åˆ«æ„Ÿè°¢yuyeåŒå­¦ï¼Œä½ ä¹Ÿç®—æ˜¯ä¸€ä¸ªâ€œå¥‡è‘©â€å§ï¼Œå“ˆå“ˆï¼Œæ²¡æœ‰ä»»ä½•è´¬ä¹‰å“¦ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘ä¹‹æ‰€ä»¥é€‰æ‹©æŠ€æœ¯ä½œä¸ºæˆ‘çš„èŒä¸šç›®æ ‡ï¼Œä¸€æ–¹é¢å½“ç„¶æ˜¯å› ä¸ºæˆ‘æœ¬æ¥å­¦çš„å°±æ˜¯æŠ€æœ¯ï¼Œä½†æ›´é‡è¦çš„æ˜¯å› ä¸ºåšæŠ€æœ¯æ¯”è¾ƒçº¯ç²¹ï¼Œæˆ‘å¸Œæœ›è‡ªå·±ä»¥åå¿ƒé‡Œèƒ½ä¸€ç›´å¾ˆè¸å®å®‰å¿ƒã€‚&lt;/p&gt;
&lt;h2&gt;æ¯•ä¸š&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¯´åˆ°æ¯•ä¸šè®ºæ–‡ï¼Œä¸€ä¸ªå­—è¶³ä»¥æ¦‚æ‹¬---â€œæ°´â€ã€‚å“ˆå“ˆï¼Œä½†å¹¸å¥½é¡ºåˆ©æ¯•ä¸šäº†ï¼Œè™½ç„¶è¿‡ç¨‹å¾ˆç—›è‹¦ï¼Œå¾ˆç…ç†¬ã€‚ç°åœ¨çš„æˆ‘æ— æ‰€äº‹äº‹ï¼Œåç­‰æ¯•ä¸šï¼Œå“ˆå“ˆã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™æ¬¡æ¯•ä¸šä¸æœ¬ç§‘æ¯•ä¸šæœ‰ä»€ä¹ˆæœ¬è´¨åŒºåˆ«å‘¢ï¼Ÿé‚£å°±æ˜¯è¿™æ¬¡æˆ‘æ˜¯çœŸçš„è¦ç»“æŸè¯»ä¹¦çš„ç”Ÿæ´»äº†ï¼Œæ­£å¼è¿›å…¥ç¤¾ä¼šï¼Œéœ€è¦æ‰¿æ‹…çš„è´£ä»»ä¹Ÿæ˜¯å®Œå…¨ä¸ç›¸åŒçš„ï¼Œå¹¶ä¸”ä»¥åæˆ‘åº”è¯¥ä¸ä¼šç»§ç»­æ·±é€ æ±‚å­¦äº†ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å›é¡¾åå‡ å¹´çš„è¯»ä¹¦ç”Ÿæ¶¯ï¼Œå®åœ¨éš¾èˆã€‚&lt;/p&gt;
&lt;h2&gt;å®šäº²&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å’Œå¥³æœ‹å‹ç›¸å…³çš„æ–‡å­—ï¼Œæˆ‘å†™å¾—å¾ˆå°‘ï¼Œè‡ªå·±ä¹Ÿè§‰å¾—æœ‰ç‚¹å¯¹ä¸ä½å¥³æœ‹å‹ã€‚å…¶åŸå› ä¸€æ–¹é¢æ˜¯ä»æˆ‘ä»¬è®¤è¯†åˆ°ç°åœ¨4å¹´å¤šçš„æ—¶é—´é‡Œï¼Œæˆ‘æ­£é€æ­¥åœ°è¶‹å‘æ²‰é»˜ï¼Œæ–‡å­—è¡¨è¾¾è¶Šæ¥è¶Šå°‘ï¼›å¦ä¸€æ–¹é¢æ˜¯æˆ‘è§‰å¾—å¹¸ç¦å…¶å®æ˜¯ä¸€ä»¶æŒºç§å¯†çš„äº‹æƒ…ï¼Œä¸èƒ½å¤šæ™’ã€‚æ‰€ä»¥ï¼Œæˆ‘ä¸è¯´å¹¶ä¸æ˜¯å› ä¸ºæˆ‘ä¸å¹¸ç¦ï¼Œå…¶å®æˆ‘ä¸€ç›´å¹¸ç¦å¾—å·ç€ä¹å‘¢ï¼Œå“ˆå“ˆã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å®šäº²çš„è¿‡ç¨‹å¹¶æ²¡æœ‰æƒ³çš„é‚£ä¹ˆé¡ºåˆ©ï¼Œè¦è€ƒè™‘å¾ˆå¤šé—®é¢˜ï¼Œè¦å’ŒåŒæ–¹çˆ¶æ¯äº²äººæ²Ÿé€šï¼Œç‰¹åˆ«æ˜¯è¦å’Œå¥³æœ‹å‹æ²Ÿé€šï¼Œä»æ‹çˆ±é€æ­¥èµ°å‘å©šå§»ï¼Œä¼šé‡åˆ°å¾ˆå¤šå¾ˆå¤šç°å®çš„ç»†èŠ‚ã€‚é¢å¯¹ç°å®ï¼Œä¼šäº§ç”ŸçŸ›ç›¾ï¼Œä½†æ²¡æœ‰ä»€ä¹ˆå¤§ä¸äº†çš„ï¼Œç›¸çˆ±çš„äººè¯·è®°ä½ï¼ŒçŸ›ç›¾æ²¡æœ‰ä»€ä¹ˆå¤§ä¸äº†çš„ï¼Œä¸è¦å¤¸å¼ äº†é—®é¢˜è€Œæ”¾å¼ƒäº†æƒ…æ„Ÿã€‚&lt;/p&gt;
&lt;h2&gt;è°ˆè°ˆè‡ªå·±&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å›é¡¾ä»å¤§ä¸€åˆ°ç°åœ¨çš„å‡ å¹´æ—¶é—´ï¼Œæˆ‘çš„å˜åŒ–åº”è¯¥ç®—æ˜¯è›®å¤§çš„ï¼Œæˆ‘é€æ­¥åœ°ä¸å†å…³æ³¨é‚£äº›å¤§å±‚é¢ä¸Šçš„äº‹æƒ…ï¼Œä¸å»æƒ³é‚£äº›å½¢è€Œä¸Šçš„é—®é¢˜ã€‚é‚£äº›äº‹æƒ…ï¼Œé‚£äº›é—®é¢˜ï¼Œæƒ³ä¸é€ï¼Œçœ‹ä¸ç©¿ï¼Œä¹Ÿä¸ä¼šçœŸçš„æœ‰è§£ã€‚è¿™è¾ˆå­ï¼Œæˆ‘ä»¬èƒ½åšçš„å…¶å®å¾ˆå°‘å¾ˆå°‘ï¼Œåšäº›åŠ›æ‰€èƒ½åŠçš„äº‹æƒ…ä¹Ÿç®—æ˜¯ä¸æµªè´¹ç”Ÿå‘½å§ã€‚ä¹Ÿè®¸æœ‰äººè®¤ä¸ºè¿™æ˜¯â€œè®¤å‘½â€äº†ï¼Œè®¤ä¸ºæˆ‘åœ¨é€æ¸æˆä¸ºä¸€ä¸ªâ€œå•å‘åº¦â€çš„äººï¼Œä½†å…¶å®æˆ‘è¿˜æ˜¯æƒ³è¶æ´»ç€å¤šæ‰‘è…¾å‡ ä¸‹çš„ï¼ŒæŒ‰ç…§è‡ªå·±çš„æƒ³æ³•å»æ´»ï¼Œåªä¸è¿‡æƒ³æ³•æ¢äº†ä¸ªæ–¹é¢ã€‚&lt;/p&gt;
&lt;h2&gt;æœªæ¥ä¸€å¹´&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¹Ÿå¾—ä¸ºè¿™æ–°çš„ä¸€å¹´åšç‚¹è§„åˆ’ï¼Œå®šç‚¹ç›®æ ‡å•¥çš„ã€‚å¯ä»¥ä»å·¥ä½œã€å¥åº·ã€æƒ…æ„Ÿã€æŠ€æœ¯ç­‰å‡ ä¸ªæ–¹é¢æ¥è°ˆå§ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¯¹äºå·¥ä½œï¼Œæˆ‘å¸Œæœ›è‡ªå·±èƒ½å¤Ÿè¸å®äº›ï¼Œé€æ­¥ç²¾é€šå·¥ä½œç›¸å…³çš„æŠ€æœ¯ï¼Œå¤šè®¤è¯†ä¸€äº›äººï¼Œå¯¹æ‰€å¤„çš„æŠ€æœ¯è¡Œä¸šæœ‰ä¸ªæ›´æ¸…æ™°çš„è®¤è¯†ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;èº«å¿ƒå¥åº·åº”è¯¥å§‹ç»ˆæ”¾åœ¨ç¬¬ä¸€ä½ï¼Œè¦å¤šè¿åŠ¨é”»ç‚¼ï¼ŒåšæŒè·‘æ­¥ä»€ä¹ˆçš„ï¼Œå¤šå‡ºå»èµ°èµ°ï¼Œæ–­ç„¶æ‹’ç»â€œå®…â€çš„ä¹ æƒ¯ï¼Œç‰¹åˆ«æ˜¯è¦å¤šå’Œå¥³æœ‹å‹å‡ºå»ç©ï¼Œè¿™ä¸ªå¯ä»¥åšä¸ªè¯¦ç»†çš„è®¡åˆ’ã€‚æ—¶é—´æ˜¯é è‡ªå·±å®‰æ’çš„ï¼Œç†ç”±ä¹Ÿä¼šæœ‰åƒä¸‡ï¼Œä½†éƒ½ä¸åº”æ¥å—å…¶æˆä¸ºä¸æ³¨æ„èº«å¿ƒå¥åº·çš„åŸå› ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æƒ…æ„Ÿæ–¹é¢ï¼Œå¸Œæœ›è‡ªå·±èƒ½å¤Ÿä¸€å¦‚æ—¢å¾€ï¼Œå¹¶ä¸”æ›´åŠ è€å¿ƒï¼Œç»†å¿ƒï¼Œæ³¨æ„äº¤æµæ²Ÿé€šã€‚å¦å¤–ï¼Œè¦å°½å¿«å®Œæˆå©šå§»çš„æµç¨‹ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¯´åˆ°æŠ€æœ¯ï¼Œè¿˜æ˜¯è€æ¯›ç—…ï¼Œæœ‰å¤ªå¤šä¸œè¥¿æƒ³å­¦ï¼Œä¸è¿‡ç°åœ¨å­¦ä¹ æ–¹å¼åœ¨é€æ­¥è¿›å…¥è‰¯æ€§å¾ªç¯ï¼Œå¿ƒæ€ä¸Šä¹Ÿä¸ä¼šé‚£ä¹ˆç›²ç›®äº†ã€‚æ¥ä¸‹æ¥çš„ä¸€å¹´é‡Œï¼Œè‡ªå·±å¿…é¡»ä¸é¿é‡å°±è½»ï¼Œè¦æ”»å…³æŠŠæ ¸å¿ƒæŠ€æœ¯ç»ƒæ‰å®ï¼Œå¤šå†™ä»£ç ï¼Œå¤šæ•´ç†æ€»ç»“ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿‡å»çš„ä¸€å¹´é‡Œï¼Œä¹¦ç±é˜…è¯»ä¸å¤šï¼Œä¹Ÿä¸è§å¾—æ˜¯ä»¶åäº‹ã€‚ä¸è¿‡æ–°çš„ä¸€å¹´é‡Œï¼Œåº”è¯¥è¦ç²¾è¯»ä¸€äº›ä¹¦ï¼ŒåŒ…æ‹¬æ–‡å²ä¸æŠ€æœ¯ç±»çš„ï¼Œå¤šæ€è€ƒã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸Šè¿°ä¹Ÿè¯´ä¸ä¸Šæ˜¯è§„åˆ’ï¼Œåªæ˜¯å¯¹è‡ªå·±æç‚¹è¦æ±‚å’ŒæœŸæœ›ï¼Œå¸Œæœ›è‡ªå·±åœ¨å„æ–¹é¢éƒ½æœ‰æ‰€è¿›æ­¥ã€‚&lt;/p&gt;</description>
            <pubDate>2013-01-18</pubDate>
            <link>https://blog.xiayf.cn/posts/review12-lookinto13.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/review12-lookinto13.html</guid>
        </item>
        
        <item>
            <title>è£…é¥°å™¨ä¸å‡½æ•°å¼ Pythonï¼ˆè¯‘ï¼‰</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;åŸæ–‡ï¼š&lt;a href=&apos;http://www.brianholdefehr.com/decorators-and-functional-python&apos;&gt;Decorators and Functional Python&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è£…é¥°å™¨æ˜¯Pythonçš„ä¸€å¤§ç‰¹è‰²ã€‚é™¤äº†åœ¨è¯­è¨€ä¸­çš„åŸæœ¬ç”¨å¤„ï¼Œè¿˜å¸®åŠ©æˆ‘ä»¬ä»¥ä¸€ç§æœ‰è¶£çš„æ–¹å¼ï¼ˆå‡½æ•°å¼ï¼‰è¿›è¡Œæ€è€ƒã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘æ‰“ç®—è‡ªåº•å‘ä¸Šè§£é‡Šè£…é¥°å™¨å¦‚ä½•å·¥ä½œã€‚é¦–å…ˆè§£é‡Šå‡ ä¸ªè¯é¢˜ä»¥å¸®åŠ©ç†è§£è£…é¥°å™¨ã€‚ç„¶åï¼Œæ·±å…¥ä¸€ç‚¹æ¢ç´¢å‡ ä¸ªç®€å•çš„è£…é¥°å™¨ä»¥åŠå®ƒä»¬å¦‚ä½•å·¥ä½œã€‚æœ€åï¼Œè®¨è®ºä¸€äº›æ›´é«˜çº§çš„ä½¿ç”¨è£…é¥°å™¨çš„æ–¹å¼ï¼Œæ¯”å¦‚ï¼šä¼ é€’å¯é€‰å‚æ•°ç»™è£…é¥°å™¨æˆ–è€…ä¸²æ¥å‡ ä¸ªè£…é¥°å™¨ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é¦–å…ˆä»¥æˆ‘èƒ½æƒ³åˆ°çš„æœ€ç®€å•çš„æ–¹å¼æ¥å®šä¹‰Pythonå‡½æ•°æ˜¯ä»€ä¹ˆã€‚åŸºäºè¯¥å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥ç±»ä¼¼çš„ç®€å•æ–¹å¼æ¥å®šä¹‰è£…é¥°å™¨ã€‚&lt;/p&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;å‡½æ•°æ˜¯ä¸€ä¸ªå®Œæˆç‰¹å®šä»»åŠ¡çš„å¯å¤ç”¨ä»£ç å—ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¥½çš„ï¼Œé‚£ä¹ˆè£…é¥°å™¨åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;è£…é¥°å™¨æ˜¯ä¸€ä¸ªä¿®æ”¹å…¶ä»–å‡½æ•°çš„å‡½æ•°ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç°åœ¨åœ¨è£…é¥°å™¨çš„å®šä¹‰ä¸Šè¿›è¡Œè¯¦è¿°ï¼Œå…ˆè§£é‡Šä¸€äº›å…ˆå†³æ¡ä»¶ã€‚&lt;/p&gt;
&lt;h2&gt;å‡½æ•°æ˜¯ä¸€ç­‰å¯¹è±¡&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Pythonä¸­ï¼Œæ‰€æœ‰ä¸œè¥¿éƒ½æ˜¯å¯¹è±¡ã€‚è¿™æ„å‘³ç€å¯ä»¥é€šè¿‡åå­—å¼•ç”¨å‡½æ•°ï¼Œä»¥åŠåƒå…¶ä»–å¯¹è±¡é‚£æ ·ä¼ é€’ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;def traveling_function():
    print &amp;amp;quot;Here I am!&amp;amp;quot;

function_dict = {
    &amp;amp;quot;func&amp;amp;quot;: traveling_function
}

trav_func = function_dict[&amp;amp;apos;func&amp;amp;apos;]
trav_func()
# &amp;amp;gt;&amp;amp;gt; Here I am!&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;traveling_function&lt;/code&gt; è¢«èµ‹å€¼ç»™ &lt;code&gt;function_dict&lt;/code&gt; å­—å…¸ä¸­é”® &lt;code&gt;func&lt;/code&gt; çš„å€¼ï¼Œä»æ—§å¯ä»¥æ­£å¸¸è°ƒç”¨ã€‚&lt;/p&gt;
&lt;h2&gt;ä¸€ç­‰å‡½æ•°å…è®¸é«˜é˜¶å‡½æ•°&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘ä»¬å¯ä»¥åƒå…¶ä»–å¯¹è±¡é‚£æ ·ä¼ é€’å‡½æ•°ã€‚å¯ä»¥å°†å‡½æ•°ä½œä¸ºå€¼ä¼ é€’ç»™å­—å…¸ï¼Œæ”¾åœ¨åˆ—è¡¨ä¸­ï¼Œæˆ–è€…ä½œä¸ºå¯¹è±¡çš„å±æ€§è¿›è¡Œèµ‹å€¼ã€‚é‚£ä¸ºä»€ä¹ˆä¸èƒ½ä½œä¸ºå‚æ•°ä¼ ç»™å¦ä¸€ä¸ªå‡½æ•°å‘¢ï¼Ÿå½“ç„¶å¯ä»¥ï¼å¦‚æœä¸€ä¸ªå‡½æ•°æ¥å—å¦ä¸€ä¸ªå‡½æ•°ä½œä¸ºå…¶å‚æ•°æˆ–è€…è¿”å›å¦ä¸€ä¸ªå‡½æ•°ï¼Œåˆ™ç§°ä¹‹ä¸ºé«˜é˜¶å‡½æ•°ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;def self_absorbed_function():
    return &amp;amp;quot;I&amp;amp;apos;m an amazing function!&amp;amp;quot;

def printer(func):
    print &amp;amp;quot;The function passed to me says: &amp;amp;quot; + func()

# Call `printer` and give it `self_absorbed_function` as an argument
printer(self_absorbed_function)
# &amp;amp;gt;&amp;amp;gt;&amp;amp;gt; The function passed to me says: I&amp;amp;apos;m an amazing function!&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç°åœ¨ä½ ä¹Ÿçœ‹åˆ°å‡½æ•°å¯ä»¥ä½œä¸ºå‚æ•°ä¼ ç»™å¦ä¸€ä¸ªå‡½æ•°ï¼Œè€Œä¸”ä¼ ç»™å‡½æ•°çš„å‡½æ•°è¿˜å¯ä»¥è°ƒç”¨ã€‚è¿™å…è®¸æˆ‘ä»¬åˆ›å»ºä¸€äº›æœ‰æ„æ€çš„å‡½æ•°ï¼Œä¾‹å¦‚è£…é¥°å™¨ã€‚&lt;/p&gt;
&lt;h2&gt;è£…é¥°å™¨åŸºç¡€&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ¬è´¨ä¸Šï¼Œè£…é¥°å™¨å°±æ˜¯ä¸€ä¸ªä»¥å¦ä¸€ä¸ªå‡½æ•°ä¸ºå‚æ•°çš„å‡½æ•°ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®ƒä»¬ä¼šè¿”å›æ‰€åŒ…è£…å‡½æ•°çš„ä¸€ä¸ªä¿®æ”¹ç‰ˆæœ¬ã€‚æ¥çœ‹ä¸ªæˆ‘ä»¬èƒ½æƒ³åˆ°çš„æœ€ç®€å•çš„è£…é¥°å™¨---åŒä¸€æ€§ï¼ˆidentityï¼‰è£…é¥°å™¨ï¼Œæˆ–è®¸å¯¹æˆ‘ä»¬ç†è§£è£…é¥°å™¨çš„å·¥ä½œåŸç†æœ‰æ‰€å¸®åŠ©ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;def identity_decorator(func):
    def wrapper():
        func()
    return wrapper

def a_function():
    print &amp;amp;quot;I&amp;amp;apos;m a normal function.&amp;amp;quot;

# `decorated_function` æ˜¯ `identity_function` è¿”å›çš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯åµŒå¥—å‡½æ•° `wrapper`
decorated_function = identity_function(a_function)

# å¦‚ä¸‹è°ƒç”¨ `identity_function` è¿”å›çš„å‡½æ•°
decorated_function()
# &amp;amp;gt;&amp;amp;gt;&amp;amp;gt; I&amp;amp;apos;m a normal function&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™é‡Œï¼Œ &lt;code&gt;identity_decorator&lt;/code&gt; æ ¹æœ¬æ²¡æœ‰ä¿®æ”¹å®ƒåŒ…è£…çš„å‡½æ•°ï¼Œåªæ˜¯ç®€å•åœ°è¿”å›ä¸€ä¸ªå‡½æ•°ï¼ˆwrapperï¼‰ï¼Œè¿™ä¸ªå‡½æ•°åœ¨è¢«è°ƒç”¨ä¹‹æ—¶ï¼Œä¼šå»è°ƒç”¨åŸæ¥ä½œä¸º &lt;code&gt;identity_decorator&lt;/code&gt; å‚æ•°çš„å‡½æ•°ã€‚è¿™æ˜¯ä¸ªæ²¡æœ‰ç”¨å¤„çš„è£…é¥°å™¨ï¼&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å…³äº &lt;code&gt;identity_decorator&lt;/code&gt; çš„æœ‰è¶£ä¹‹å¤„æ˜¯ &lt;code&gt;wrapper&lt;/code&gt; èƒ½å¤Ÿè®¿é—®å˜é‡ &lt;code&gt;func&lt;/code&gt; ï¼Œå³ä½¿ &lt;code&gt;func&lt;/code&gt; å¹¶éæ˜¯å®ƒçš„å‚æ•°ã€‚è¿™å½’å› äºé—­åŒ…ã€‚&lt;/p&gt;
&lt;h2&gt;é—­åŒ…&lt;/h2&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;é—­åŒ…æ˜¯ä¸€ä¸ªèŠ±å“¨çš„æœ¯è¯­ï¼Œæ„ä¸ºå£°æ˜ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œè¯¥å‡½æ•°ä¼šç»´æŒä¸€ä¸ªæŒ‡å‘å£°æ˜æ‰€å¤„è¯æ³•ç¯å¢ƒçš„å¼•ç”¨ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸Šä¾‹ä¸­å®šä¹‰çš„å‡½æ•° &lt;code&gt;wrapper&lt;/code&gt; èƒ½å¤Ÿåœ¨å…¶å±€éƒ¨ä½œç”¨åŸŸï¼ˆlocal scopeï¼‰ä¸­è®¿é—® &lt;code&gt;func&lt;/code&gt;ã€‚è¿™æ„å‘³ç€åœ¨ &lt;code&gt;wrapper&lt;/code&gt; ï¼ˆè¿”å›å¹¶èµ‹å€¼ç»™å˜é‡ &lt;code&gt;decorated_function&lt;/code&gt; ï¼‰çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…ï¼Œå®ƒéƒ½å¯ä»¥è®¿é—® &lt;code&gt;func&lt;/code&gt; å˜é‡ã€‚ä¸€æ—¦ &lt;code&gt;identity_decorator&lt;/code&gt;è¿”å›ï¼Œé‚£ä¹ˆè®¿é—® &lt;code&gt;func&lt;/code&gt; çš„å”¯ä¸€æ–¹å¼å°±æ˜¯é€šè¿‡ &lt;code&gt;decorated_function&lt;/code&gt; ã€‚ &lt;code&gt;func&lt;/code&gt; åªä½œä¸ºä¸€ä¸ªå˜é‡å­˜åœ¨äº &lt;code&gt;decorated_function&lt;/code&gt; ä½œç”¨åŸŸç¯å¢ƒçš„å†…éƒ¨ã€‚&lt;/p&gt;
&lt;h2&gt;ä¸€ä¸ªç®€å•çš„è£…é¥°å™¨&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç°åœ¨æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªç¡®å®æœ‰ç‚¹ç”¨çš„è£…é¥°å™¨ã€‚è¿™ä¸ªè£…é¥°å™¨æ‰€åšçš„å°±æ˜¯è®°å½•å®ƒæ‰€ä¿®æ”¹çš„å‡½æ•°è¢«è°ƒç”¨äº†å¤šå°‘æ¬¡ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;def logging_decorator(func):
    def wrapper():
        wrapper.count += 1
        print &amp;amp;quot;The function I modify has been called {0} time(s)&amp;amp;quot;.format(wrapper.count)
        func()
    wrapper.count = 0
    return wrapper

def a_function():
    print &amp;amp;quot;I&amp;amp;apos;m a normal function.&amp;amp;quot;

modified_function = logging_decorator(a_function)

modified_function()
# &amp;amp;gt;&amp;amp;gt;&amp;amp;gt; The function I modify has been called 1 time(s).
# &amp;amp;gt;&amp;amp;gt;&amp;amp;gt; I&amp;amp;apos;m a normal function.

modified_function()
# &amp;amp;gt;&amp;amp;gt;&amp;amp;gt; The function I modify has been called 2 time(s).
# &amp;amp;gt;&amp;amp;gt;&amp;amp;gt; I&amp;amp;apos;m a normal function.&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘ä»¬è¯´è£…é¥°å™¨ä¼šä¿®æ”¹å‡½æ•°ï¼Œè¿™æ ·æ¥æƒ³å¯¹ç†è§£ä¹Ÿæ˜¯æœ‰å¸®åŠ©çš„ã€‚ä½†å¦‚ä¾‹å­æ‰€è§ï¼Œ &lt;code&gt;logging_decorator&lt;/code&gt; è¿”å›çš„æ˜¯ä¸€ä¸ªç±»ä¼¼äº &lt;code&gt;a_function&lt;/code&gt; çš„æ–°å‡½æ•°ï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ªæ—¥å¿—ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸Šä¾‹ä¸­ï¼Œ &lt;code&gt;logging_decorator&lt;/code&gt; ä¸ä»…æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œ &lt;code&gt;wrapper&lt;/code&gt; ã€‚æ¯æ¬¡ &lt;code&gt;logging_decorator&lt;/code&gt; è¿”å›çš„å‡½æ•°å¾—åˆ°è°ƒç”¨ï¼Œå®ƒå°±å¯¹ &lt;code&gt;wrapper.count&lt;/code&gt; çš„å€¼åŠ 1ï¼Œæ‰“å°å‡ºæ¥ï¼Œç„¶åè°ƒç”¨ &lt;code&gt;logging_decorator&lt;/code&gt; åŒ…è£…çš„å‡½æ•°ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½ ä¹Ÿè®¸æ­£ç–‘æƒ‘ä¸ºä»€ä¹ˆæˆ‘ä»¬çš„è®¡æ•°å™¨æ˜¯ &lt;code&gt;wrapper&lt;/code&gt; çš„ä¸€ä¸ªå±æ€§è€Œä¸æ˜¯ä¸€ä¸ªæ™®é€šçš„å˜é‡ã€‚éš¾é“ &lt;code&gt;wrapper&lt;/code&gt; çš„é—­åŒ…ç¯å¢ƒä¸æ˜¯è®©æˆ‘ä»¬è®¿é—®åœ¨å…¶å±€éƒ¨ä½œç”¨åŸŸä¸­å£°æ˜çš„ä»»æ„å˜é‡ä¹ˆï¼Ÿæ˜¯çš„ï¼Œä½†æœ‰ä¸ªé—®é¢˜ã€‚Pythonä¸­ï¼Œé—­åŒ…å…è®¸å¯¹å…¶å‡½æ•°ä½œç”¨åŸŸé“¾ä¸­ä»»ä¸€å˜é‡çš„è¿›è¡Œä»»æ„è¯»æ“ä½œï¼Œä½†åªå…è®¸å¯¹å¯å˜å¯¹è±¡ï¼ˆåˆ—è¡¨ã€å­—å…¸ã€ç­‰ç­‰ï¼‰è¿›è¡Œå†™æ“ä½œã€‚æ•´æ•°åœ¨Pythonä¸­æ˜¯éå¯å˜å¯¹è±¡ï¼Œå› æ­¤æˆ‘ä»¬ä¸èƒ½ä¿®æ”¹ &lt;code&gt;wrapper&lt;/code&gt; å†…éƒ¨æ•´å‹å˜é‡çš„å€¼ã€‚ç›¸åï¼Œæˆ‘ä»¬å°†è®¡æ•°å™¨ä½œä¸º &lt;code&gt;wrapper&lt;/code&gt; çš„ä¸€ä¸ªå±æ€§---ä¸€ä¸ªå¯å˜å¯¹è±¡ï¼Œå› æ­¤å¯ä»¥éšæˆ‘ä»¬è‡ªå·±å¢å¤§å®ƒçš„å€¼ã€‚&lt;/p&gt;
&lt;h2&gt;è£…é¥°å™¨è¯­æ³•&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨å‰ä¸€ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°å¯ä»¥å°†ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ä¼ ç»™è£…é¥°å™¨ï¼Œä»è€Œä½¿ç”¨è£…é¥°å™¨å‡½æ•°å¯¹è¯¥å‡½æ•°è¿›è¡ŒåŒ…è£…ã€‚ç„¶è€Œï¼ŒPythonè¿˜æœ‰ä¸€ä¸ªè¯­æ³•æ¨¡å¼ä½¿å¾—è¿™ä¸€åˆ‡æ›´åŠ ç›´è§‚ï¼Œæ›´å®¹æ˜“é˜…è¯»ï¼Œä¸€æ—¦ä½ ç†Ÿæ‚‰äº†è£…é¥°å™¨ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;# In the previous example, we used our decorator function by passing the
# function we wanted to modify to it, and assigning the result to a variable
def some_function():
    print &amp;amp;quot;I&amp;amp;apos;m happiest when decorated.&amp;amp;quot;

# Here we will make the assigned variable the same name as the wrapped function
some_function = logging_decorator(some_function)&lt;/code&gt;&lt;/pre&gt;
&lt;hr&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;# We can achieve the exact same thing with this syntax:
@logging_decorator
def some_function():
    print &amp;amp;quot;I&amp;amp;apos;m happiest when decorated&amp;amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½¿ç”¨è£…é¥°å™¨è¯­æ³•ï¼Œé¸Ÿç°å…¶ä¸­å‘ç”Ÿçš„äº‹æƒ…ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;è§£é‡Šå™¨åˆ°è¾¾è¢«è£…é¥°çš„å‡½æ•°ï¼Œç¼–è¯‘ &lt;code&gt;some_function&lt;/code&gt;ï¼Œå¹¶å°†å…¶å‘½åä¸º &apos;some_function&apos;ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶åå°†è¯¥å‡½æ•°ä¼ é€’ç»™è£…é¥°è¡Œä¸­æŒ‡å®šçš„è£…é¥°å™¨å‡½æ•°ï¼ˆ &lt;code&gt;logging_function&lt;/code&gt; ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;è£…é¥°å™¨å‡½æ•°ï¼ˆé€šå¸¸æ˜¯ç”¨æ¥åŒ…è£…åŸå‡½æ•°çš„å¦ä¸€ä¸ªå‡½æ•°ï¼‰çš„è¿”å›å€¼å–ä»£åŸæ¥çš„å‡½æ•°ï¼ˆ&lt;code&gt;some_function&lt;/code&gt; ï¼‰ï¼Œç»‘å®šåˆ°å˜é‡å &lt;code&gt;some_function&lt;/code&gt; ã€‚&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å°†è¿™äº›æ­¥éª¤è®°ä½ï¼Œè®©æˆ‘ä»¬æ¥æ›´æ¸…æ™°åœ°è§£é‡Š &lt;code&gt;identity_decorator&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;def identity_decorator(func):
    # Everything here happens when the decorator LOADS and is passed
    # the function as decribed in step 2 above
    def wrapper():
        # Things here happen each time the final wrapped function gets CALLED
        func()
    return wrapper&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¸Œæœ›é‚£äº›æ³¨é‡Šæœ‰åŠ©äºç†è§£ã€‚æ¯æ¬¡è°ƒç”¨è¢«åŒ…è£…çš„å‡½æ•°ï¼Œä»…æ‰§è¡Œè£…é¥°å™¨è¿”å›çš„å‡½æ•°ä¸­çš„æŒ‡ä»¤ã€‚è¿”å›å‡½æ•°ä¹‹å¤–çš„æŒ‡ä»¤ä»…æ‰§è¡Œä¸€æ¬¡---ä¸Šè¿°æ­¥éª¤2ä¸­æè¿°çš„ï¼šè£…é¥°å™¨é¦–æ¬¡æ¥æ”¶åˆ°ä¼ é€’ç»™å®ƒçš„å¾…åŒ…è£…å‡½æ•°ä¹‹æ—¶ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨è§‚å¯Ÿæ›´å¤šçš„æœ‰æ„æ€çš„è£…é¥°å™¨ä¹‹å‰ï¼Œæˆ‘æƒ³å†è§£é‡Šä¸€æ ·ä¸œè¥¿ã€‚&lt;/p&gt;
&lt;h2&gt;&lt;code&gt;*args&lt;/code&gt; ä¸ &lt;code&gt;**kwargs&lt;/code&gt;&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä»¥å‰ä½ ä¹Ÿè®¸æœ‰æ—¶ä¼šæŠŠè¿™ä¸¤è€…ç›¸æ··æ·†äº†ã€‚è®©æˆ‘ä»¬ä¸€æ¬¡æ€§åœ°è®¨è®ºå®ƒä»¬ã€‚&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;é€šè¿‡åœ¨å½¢å‚åˆ—è¡¨ä¸­ä½¿ç”¨ &lt;code&gt;*args&lt;/code&gt; è¯­æ³•ï¼Œpythonå‡½æ•°èƒ½å¤Ÿæ¥æ”¶å¯å˜æ•°é‡çš„ä½ç½®å‚æ•°(positional arguments)ã€‚ &lt;code&gt;*args&lt;/code&gt; ä¼šå°†æ‰€æœ‰æ²¡æœ‰å…³é”®å­—çš„å‚æ•°æ”¾å…¥ä¸€ä¸ªå‚æ•°å…ƒç»„ä¸­ï¼Œåœ¨å‡½æ•°é‡Œå¯ä»¥è®¿é—®å…ƒç»„ä¸­çš„å‚æ•°ã€‚ç›¸åï¼Œå°† &lt;code&gt;*args&lt;/code&gt; ç”¨äºå‡½æ•°è°ƒç”¨æ—¶çš„å®å‚åˆ—è¡¨ä¹‹æ—¶ï¼Œå®ƒä¼šå°†å‚æ•°å…ƒç»„å±•å¼€æˆä¸€ç³»åˆ—çš„ä½ç½®å‚æ•°ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;def function_with_many_arguments(*args):
    print args

# `args` within the function will be a tuple of any arguments we pass
# which can be used within the function like any other tuple
function_with_many_arguments(&amp;amp;apos;hello&amp;amp;apos;, 123, True)
# &amp;amp;gt;&amp;amp;gt;&amp;amp;gt; (&amp;amp;apos;hello&amp;amp;apos;, 123, True)&lt;/code&gt;&lt;/pre&gt;
&lt;hr&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;def function_with_3_parameters(num, boolean, string):
    print &amp;amp;quot;num is &amp;amp;quot; + str(num)
    print &amp;amp;quot;boolean is &amp;amp;quot; + str(boolean)
    print &amp;amp;quot;string is &amp;amp;quot; + string

arg_list = [1, False, &amp;amp;apos;decorators&amp;amp;apos;]

# arg_list will be expanded into 3 positional arguments by the `*` symbol
function_with_3_parameters(*arg_list)
# &amp;amp;gt;&amp;amp;gt;&amp;amp;gt; num is 1
# &amp;amp;gt;&amp;amp;gt;&amp;amp;gt; boolean is False
# &amp;amp;gt;&amp;amp;gt;&amp;amp;gt; string is decorators&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é‡è¿°ä¸€éï¼šåœ¨å½¢å‚åˆ—è¡¨ä¸­ï¼Œ &lt;code&gt;*args&lt;/code&gt;ä¼šå°†ä¸€ç³»åˆ—çš„å‚æ•°å‹ç¼©è¿›ä¸€ä¸ªåä¸º&apos;args&apos;çš„å…ƒç»„ï¼Œè€Œåœ¨å®å‚åˆ—è¡¨ä¸­ï¼Œ &lt;code&gt;*args&lt;/code&gt; ä¼šå°†ä¸€ä¸ªå¯è¿­ä»£çš„å‚æ•°æ•°æ®ç»“æ„å±•å¼€ä¸ºä¸€ç³»åˆ—çš„ä½ç½®å®å‚åº”ç”¨äºå‡½æ•°ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚ä½ æ‰€è§åœ¨å®å‚å±•å¼€çš„ä¾‹å­ä¸­ï¼Œ &lt;code&gt;*&lt;/code&gt; ç¬¦å·å¯ä¸&apos;args&apos;ä¹‹å¤–çš„åå­—ä¸€èµ·ä½¿ç”¨ã€‚å½“å‹ç¼©/å±•å¼€ä¸€èˆ¬çš„å‚æ•°åˆ—è¡¨ï¼Œä½¿ç”¨ &lt;code&gt;*args&lt;/code&gt; çš„å½¢å¼ä»…ä»…æ˜¯ä¸€ç§æƒ¯ä¾‹ã€‚&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;code&gt;**kwargs&lt;/code&gt; ä¸ &lt;code&gt;*args&lt;/code&gt; çš„è¡Œä¸ºç±»ä¼¼ï¼Œä½†ç”¨äºå…³é”®å­—å‚æ•°è€Œéä½ç½®å‚æ•°ã€‚å¦‚æœåœ¨å‡½æ•°çš„å½¢å‚åˆ—è¡¨ä¸­ä½¿ç”¨ &lt;code&gt;**kwargs&lt;/code&gt; ï¼Œå®ƒä¼šæ”¶é›†å‡½æ•°æ”¶åˆ°çš„æ‰€æœ‰é¢å¤–å…³é”®å­—å‚æ•°ï¼Œæ”¾å…¥ä¸€ä¸ªå­—å…¸ä¸­ã€‚å¦‚æœç”¨äºå‡½æ•°çš„å®å‚åˆ—è¡¨ï¼Œå®ƒä¼šå°†ä¸€ä¸ªå­—å…¸å±•å¼€ä¸ºä¸€ç³»åˆ—çš„å…³é”®å­—å‚æ•°ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;def funtion_with_many_keyword_args(**kwargs):
    print kwargs

function_with_many_keyword_args(a=&amp;amp;apos;apples&amp;amp;apos;, b=&amp;amp;apos;bananas&amp;amp;apos;, c=&amp;amp;apos;cantalopes&amp;amp;apos;)
# &amp;amp;gt;&amp;amp;gt; {&amp;amp;apos;a&amp;amp;apos;:&amp;amp;apos;apples&amp;amp;apos;, &amp;amp;apos;b&amp;amp;apos;:&amp;amp;apos;bananas&amp;amp;apos;, &amp;amp;apos;c&amp;amp;apos;:&amp;amp;apos;cantalopes&amp;amp;apos;}&lt;/code&gt;&lt;/pre&gt;
&lt;hr&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;def multiply_name(count=0, name=&amp;amp;apos;&amp;amp;apos;):
    print name * count

arg_dict = {&amp;amp;apos;count&amp;amp;apos;: 3, &amp;amp;apos;name&amp;amp;apos;: &amp;amp;apos;Brian&amp;amp;apos;}

multiply_name(**arg_dict)
# &amp;amp;gt;&amp;amp;gt; BrianBrianBrian&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ—¢ç„¶ä½ ç†è§£äº† &lt;code&gt;*args&lt;/code&gt; ä¸ &lt;code&gt;**kwargs&lt;/code&gt; çš„å·¥ä½œåŸç†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç»§ç»­ç ”ç©¶ä¸€ä¸ªä½ ä¼šå‘ç°å¾ˆæœ‰ç”¨çš„è£…é¥°å™¨ã€‚&lt;/p&gt;
&lt;h2&gt;ç¼“å­˜åˆ¶è¡¨ï¼ˆMemoizationï¼‰&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç¼“å­˜åˆ¶è¡¨æ˜¯é¿å…æ½œåœ¨çš„æ˜‚è´µçš„é‡å¤è®¡ç®—çš„ä¸€ç§æ–¹æ³•ï¼Œé€šè¿‡ç¼“å­˜å‡½æ•°æ¯æ¬¡æ‰§è¡Œçš„ç»“æœæ¥å®ç°ã€‚è¿™æ ·ï¼Œä¸‹ä¸€æ¬¡å‡½æ•°ä»¥ç›¸åŒçš„å‚æ•°æ‰§è¡Œï¼Œå°±å¯ä»¥ä»ç¼“å­˜ä¸­è·å–è¿”å›ç»“æœï¼Œä¸éœ€è¦å†æ¬¡è®¡ç®—ç»“æœã€‚&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;from functools import wraps

def memoize(func):
    cache = {}

    @wraps(func)
    def wrapper(*args):
        if args not in cache:
            cache[args] = func(*args)
        return cache[args]
    return wrapper

@memoize
def an_expensive_function(arg1, arg2, arg3):
    ...&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½ å¯èƒ½æ³¨æ„åˆ°äº†ç¤ºä¾‹ä»£ç ä¸­ä¸€ä¸ªå¥‡æ€ªçš„ &lt;code&gt;@wraps&lt;/code&gt; è£…é¥°å™¨ã€‚åœ¨å®Œæ•´åœ°è®¨è®º &lt;code&gt;memoize&lt;/code&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¹‹å‰æˆ‘å°†ç®€è¦åœ°è§£é‡Šè¿™ä¸ªè£…é¥°å™¨ã€‚&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ä½¿ç”¨è£…é¥°å™¨çš„ä¸€ä¸ªå‰¯ä½œç”¨æ˜¯è¢«åŒ…è£…çš„å‡½æ•°å¤±å»äº†æœ¬æ¥æœ‰çš„ &lt;code&gt;__name__&lt;/code&gt; ï¼Œ &lt;code&gt;__doc__&lt;/code&gt; ï¼Œ ä»¥åŠ &lt;code&gt;__module__&lt;/code&gt; å±æ€§ã€‚ &lt;code&gt;wraps&lt;/code&gt; å‡½æ•°æ˜¯ä¸€ä¸ªåŒ…è£…å¦ä¸€ä¸ªè£…é¥°å™¨è¿”å›çš„å‡½æ•°çš„è£…é¥°å™¨ï¼Œå°†é‚£ä¸‰ä¸ªå±æ€§çš„å€¼æ¢å¤ä¸ºå‡½æ•°æœªè£…é¥°ä¹‹æ—¶çš„å€¼ã€‚ä¾‹å¦‚ï¼š å¦‚æœä¸ä½¿ç”¨ &lt;code&gt;wraps&lt;/code&gt; è£…é¥°å™¨ï¼Œ &lt;code&gt;an_expensive_function&lt;/code&gt; çš„åå­—ï¼ˆé€šè¿‡ &lt;code&gt;an_expensive_function.__name__&lt;/code&gt; å¯ä»¥çœ‹åˆ°ï¼‰å°†æ˜¯ &apos;wrapper&apos; ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘è®¤ä¸º &lt;code&gt;memoize&lt;/code&gt; æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è£…é¥°å™¨ç”¨ä¾‹ã€‚å®ƒæœåŠ¡äºä¸€ä¸ªå¾ˆå¤šå‡½æ•°éƒ½éœ€è¦çš„ç›®çš„ï¼Œé€šè¿‡å°†å®ƒåˆ›å»ºä¸ºä¸€ä¸ªé€šç”¨è£…é¥°å™¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒçš„åŠŸèƒ½åº”ç”¨äºä»»ä¸€èƒ½å¤Ÿä»å…¶ä¸­è·ç›Šçš„å‡½æ•°ã€‚è¿™å°±é¿å…äº†åœ¨å¤šç§ä¸åŒçš„åœºåˆé‡å¤å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚å› ä¸ºä¸éœ€è¦é‡å¤è‡ªå·±ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ä»£ç æ›´å®¹æ˜“ç»´æŠ¤ï¼Œå¹¶ä¸”æ›´å®¹æ˜“é˜…è¯»å’Œç†è§£ã€‚åªè¦è¯»ä¸€ä¸ªå•è¯ä½ å°±èƒ½ç«‹åˆ»ç†è§£å‡½æ•°ä½¿ç”¨äº†ç¼“å­˜åˆ¶è¡¨ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;éœ€è¦æé†’çš„æ˜¯ï¼šç¼“å­˜åˆ¶è¡¨ä»…é€‚ç”¨äºçº¯å‡½æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ç»™å®šä¸€ä¸ªç‰¹å®šçš„å‚æ•°è®¾ç½®ï¼Œå‡½æ•°ç¡®å®šæ€»ä¼šäº§ç”Ÿç›¸åŒçš„ç»“æœã€‚å¦‚æœå‡½æ•°ä¾èµ–äºä¸ä½œä¸ºå‚æ•°ä¼ é€’çš„å…¨å±€å˜é‡ã€I/Oã€æˆ–è€…å…¶å®ƒä»»æ„å¯èƒ½å½±å“è¿”å›å€¼çš„ä¸œè¥¿ï¼Œç¼“å­˜åˆ¶è¡¨ä¼šäº§ç”Ÿä»¤äººè¿·æƒ‘çš„ç»“æœï¼å¹¶ä¸”ï¼Œä¸€ä¸ªçº¯å‡½æ•°ä¸ä¼šæœ‰ä»»ä½•å‰¯ä½œç”¨ã€‚å› æ­¤ï¼Œå¦‚æœä½ çš„å‡½æ•°ä¼šå¢å¤§ä¸€ä¸ªè®¡æ•°å™¨ï¼Œæˆ–è€…è°ƒç”¨å¦ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•ï¼Œæˆ–è€…å…¶å®ƒä»»æ„ä¸åœ¨å‡½æ•°çš„è¿”å›ç»“æœä¸­è¡¨ç¤ºçš„ä¸œè¥¿ï¼Œå½“ç»“æœæ˜¯ä»ç¼“å­˜ä¸­è¿”å›æ—¶ï¼Œå‰¯ä½œç”¨æ“ä½œå¹¶ä¸ä¼šå¾—åˆ°æ‰§è¡Œã€‚&lt;/p&gt;
&lt;h2&gt;ç±»çš„è£…é¥°å™¨&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ€åˆï¼Œæˆ‘ä»¬è¯´è£…é¥°å™¨æ˜¯ä¸€ä¸ªä¿®æ”¹å¦ä¸€ä¸ªå‡½æ•°çš„å‡½æ•°ï¼Œä½†å…¶å®å®ƒä»¬å¯ä»¥ç”¨äºä¿®æ”¹ç±»æˆ–è€…æ–¹æ³•ã€‚å¯¹ç±»è¿›è¡Œè£…é¥°å¹¶ä¸å¸¸è§ï¼Œä½†æŸäº›æƒ…å†µä¸‹ä½œä¸ºå…ƒç±»(metaclass)çš„ä¸€ä¸ªæ›¿ä»£ï¼Œç±»çš„è£…é¥°å™¨æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å·¥å…·ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;foo = [&amp;amp;apos;important&amp;amp;apos;, &amp;amp;apos;foo&amp;amp;apos;, &amp;amp;apos;stuff&amp;amp;apos;]

def add_foo(klass):
    klass.foo = foo
    return klass


@add_foo
class Person(object):
    pass

brian = Person()

print brian.foo
# &amp;amp;gt;&amp;amp;gt; [&amp;amp;apos;important&amp;amp;apos;, &amp;amp;apos;foo&amp;amp;apos;, &amp;amp;apos;stuff&amp;amp;apos;]&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç°åœ¨ï¼Œç±» &lt;code&gt;Person&lt;/code&gt; çš„ä»»ä¸€å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªè¶…çº§é‡è¦çš„ &lt;code&gt;foo&lt;/code&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å±æ€§ï¼æ³¨æ„ï¼Œå› ä¸ºæˆ‘ä»¬è£…é¥°çš„æ˜¯ä¸€ä¸ªç±»ï¼Œæ‰€ä»¥è£…é¥°å™¨è¿”å›çš„ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè€Œæ˜¯ä¸€ä¸ªç±»ã€‚æ›´æ–°ä¸€ä¸‹è£…é¥°å™¨çš„å®šä¹‰ï¼š&lt;/p&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;è£…é¥°å™¨æ˜¯ä¸€ä¸ªä¿®æ”¹å‡½æ•°ã€æˆ–æ–¹æ³•ã€æˆ–ç±»çš„å‡½æ•°ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;h2&gt;è£…é¥°å™¨ç±»&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;äº‹å®è¯æ˜æˆ‘æ—©å…ˆå¯¹ä½ éšç’äº†ä¸€äº›å…¶å®ƒäº‹æƒ…ã€‚ä¸ä»…è£…é¥°å™¨å¯ä»¥è£…é¥°ä¸€ä¸ªç±»ï¼Œå¹¶ä¸”è£…é¥°å™¨ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç±»ï¼å¯¹äºè£…é¥°å™¨çš„å”¯ä¸€è¦æ±‚å°±æ˜¯å®ƒçš„è¿”å›å€¼å¿…é¡»å¯è°ƒç”¨(callable)ã€‚è¿™æ„å‘³ç€è£…é¥°å™¨å¿…é¡»å®ç° &lt;code&gt;__call__&lt;/code&gt; é­”æœ¯æ–¹æ³•ï¼Œå½“ä½ è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä¼šéšå¼è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚å‡½æ•°å½“ç„¶æ˜¯éšå¼è®¾ç½®è¿™ä¸ªæ–¹æ³•çš„ã€‚æˆ‘ä»¬é‡æ–°å°† &lt;code&gt;identity_decorator&lt;/code&gt; åˆ›å»ºä¸ºä¸€ä¸ªç±»æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;class IdentityDecorator(object):
    def __init__(self, func):
        self.func = func

    def __call__(self):
        self.func()


@IdentityDecorator
def a_function():
    print &amp;amp;quot;I&amp;amp;apos;m a normal function.&amp;amp;quot;

a_function()
# &amp;amp;gt;&amp;amp;gt; I&amp;amp;apos;m a normal function.&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚ä¸‹æ˜¯ä¸Šä¾‹ä¸­å‘ç”Ÿçš„äº‹æƒ…ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å½“ &lt;code&gt;IdentityDecorator&lt;/code&gt; è£…é¥° &lt;code&gt;a_function&lt;/code&gt; æ—¶ï¼Œå®ƒçš„è¡Œä¸ºå°±å’Œè£…é¥°å™¨å‡½æ•°ä¸€æ ·ã€‚è¿™ä¸ªä»£ç ç‰‡æ®µç­‰ä»·äºä¸Šä¾‹ä¸­çš„è£…é¥°å™¨è¯­æ³•ï¼š &lt;code&gt;a_function = IdentityDecorator(a_function)&lt;/code&gt; ã€‚è°ƒç”¨ï¼ˆå®ä¾‹åŒ–ï¼‰è¯¥è£…é¥°å™¨ç±»æ—¶ï¼Œéœ€å°†å…¶è£…é¥°çš„å‡½æ•°ä½œä¸ºä¸€ä¸ªå®å‚ä¼ é€’ç»™å®ƒã€‚&lt;/li&gt;
&lt;li&gt;å®ä¾‹åŒ– &lt;code&gt;IdentityDecorator&lt;/code&gt; ä¹‹æ—¶ï¼Œä¼šä»¥è¢«è£…é¥°çš„å‡½æ•°ä½œä¸ºå®å‚è°ƒç”¨åˆå§‹åŒ–å‡½æ•° &lt;code&gt;__init__&lt;/code&gt; ã€‚æœ¬ä¾‹ä¸­ï¼Œåˆå§‹åŒ–å‡½æ•°æ‰€åšçš„äº‹æƒ…å°±æ˜¯å°†è¢«è£…é¥°å‡½æ•°èµ‹å€¼ç»™ä¸€ä¸ªå±æ€§ï¼Œè¿™æ ·ä¹‹åå°±å¯ä»¥é€šè¿‡å…¶å®ƒæ–¹æ³•è¿›è¡Œè°ƒç”¨ã€‚&lt;/li&gt;
&lt;li&gt;æœ€åï¼Œè°ƒç”¨ &lt;code&gt;a_function&lt;/code&gt; ï¼ˆå®é™…ä¸Šæ˜¯è¿”å›çš„åŒ…è£…äº† &lt;code&gt;a_function&lt;/code&gt; çš„ &lt;code&gt;IdentityDecorator&lt;/code&gt; å¯¹è±¡ï¼‰ä¹‹æ—¶ï¼Œä¼šè°ƒç”¨å¯¹è±¡çš„ &lt;code&gt;__call__&lt;/code&gt; æ–¹æ³•ã€‚è¿™ä»…æ˜¯ä¸€ä¸ªåŒä¸€æ€§è£…é¥°å™¨ï¼Œæ‰€ä»¥æ–¹æ³•åªæ˜¯ç®€å•åœ°è°ƒç”¨äº†è¯¥ç±»æ‰€è£…é¥°çš„å‡½æ•°ã€‚&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å†æ¬¡æ›´æ–°ä¸€ä¸‹æˆ‘ä»¬å¯¹è£…é¥°å™¨çš„å®šä¹‰ï¼&lt;/p&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;è£…é¥°å™¨æ˜¯ä¸€ä¸ªä¿®æ”¹å‡½æ•°ã€æ–¹æ³•æˆ–è€…ç±»çš„å¯è°ƒç”¨å¯¹è±¡ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;h2&gt;å¸¦å‚æ•°çš„è£…é¥°å™¨&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ‰æ—¶ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„æƒ…å†µæ”¹å˜è£…é¥°å™¨çš„è¡Œä¸ºã€‚ä½ å¯ä»¥é€šè¿‡ä¼ å‚æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;from functools import wraps

def argumentative_decorator(gift):
    def func_wrapper(func):
        @wraps(func)
        def returned_wrapper(*args, **kwargs):
             print &amp;amp;quot;I don&amp;amp;apos;t like this &amp;amp;quot; + gift + &amp;amp;quot;you gave me!&amp;amp;quot;
             return func(gift, *args, **kwargs)
        return returned_wrapper
    return func_wrapper

@argumentative_decorator(&amp;amp;quot;sweater&amp;amp;quot;)
def grateful_function(gift):
    print &amp;amp;quot;I love the &amp;amp;quot; + gift + &amp;amp;quot;!Thank you!&amp;amp;quot;

grateful_function()
# &amp;amp;gt;&amp;amp;gt; I don&amp;amp;apos;t like this sweater you gave me!
# &amp;amp;gt;&amp;amp;gt; I love the sweater! Thank you!&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚æœä¸ä½¿ç”¨è£…é¥°å™¨è¯­æ³•è¿™ä¸ªè£…é¥°å™¨å‡½æ•°æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;# If we tried to invoke without an argument:
grateful_function = argumentative_function(grateful_function)

# But when given an argument, the pattern changes to:
grateful_function = argumentative_decorator(&amp;amp;quot;sweater&amp;amp;quot;)(grateful_function)&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;éœ€è¦æ³¨æ„çš„åœ°æ–¹æ˜¯ï¼šå½“ç»™å®šå‚æ•°ï¼Œé¦–å…ˆä»…ä»¥é‚£äº›å‚æ•°è°ƒç”¨è£…é¥°å™¨---è¢«åŒ…è£…çš„å‡½æ•°å¹¶ä¸åœ¨å‚æ•°ä¸­ã€‚è£…é¥°å™¨è°ƒç”¨è¿”å›åï¼Œè£…é¥°å™¨è¦åŒ…è£…çš„å‡½æ•°è¢«ä¼ é€’ç»™è£…é¥°å™¨åˆå§‹è°ƒç”¨è¿”å›çš„å‡½æ•°ï¼ˆæœ¬ä¾‹ä¸­ï¼Œä¸º &lt;code&gt;argumentative_decorator(&amp;quot;sweater&amp;quot;)&lt;/code&gt; çš„è¿”å›å€¼ï¼‰ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é€æ­¥åœ°ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;è§£é‡Šå™¨åˆ°è¾¾è¢«è£…é¥°å‡½æ•°ä¹‹å¤„ï¼Œç¼–è¯‘ &lt;code&gt;grateful_function&lt;/code&gt; ï¼Œå¹¶å°†å…¶ç»‘å®šåˆ°åå­—&apos;grateful_function&apos;ã€‚&lt;/li&gt;
&lt;li&gt;ä¼ é€’å‚æ•°&quot;sweater&quot;è°ƒç”¨ &lt;code&gt;argumentative_decorator&lt;/code&gt; ï¼Œè¿”å› &lt;code&gt;func_wrapper&lt;/code&gt; ã€‚&lt;/li&gt;
&lt;li&gt;ä»¥ &lt;code&gt;grateful_function&lt;/code&gt; ä¸ºå‚è°ƒç”¨ &lt;code&gt;func_wrapper&lt;/code&gt; ï¼Œè¿”å› &lt;code&gt;returned_wrapper&lt;/code&gt; ã€‚&lt;/li&gt;
&lt;li&gt;æœ€åï¼Œ &lt;code&gt;returned_wrapper&lt;/code&gt; å–ä»£åŸæ¥çš„å‡½æ•° &lt;code&gt;grateful_function&lt;/code&gt; ï¼Œå¹¶ç»‘å®šåˆ°åå­—&apos;grateful_function&apos; ã€‚&lt;/li&gt;&lt;/ol&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘æƒ³è¿™ä¸€è¿‡ç¨‹ç›¸æ¯”æ²¡æœ‰è£…é¥°å™¨å‚æ•°ç†è§£èµ·æ¥æ›´éš¾ä¸€ç‚¹ï¼Œä½†æ˜¯å¦‚æœä½ èŠ±äº›æ—¶é—´å°†å…¶ç†è§£é€šé€ï¼Œæˆ‘å¸Œæœ›æ˜¯æœ‰æ„ä¹‰çš„ã€‚&lt;/p&gt;
&lt;h2&gt;å¸¦å¯é€‰å‚æ•°çš„è£…é¥°å™¨&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ‰å¤šç§æ–¹å¼è®©è£…é¥°å™¨æ¥å—å¯é€‰å‚æ•°ã€‚æ ¹æ®ä½ æ˜¯æƒ³ä½¿ç”¨ä½ç½®å‚æ•°ã€å…³é”®å­—å‚æ•°è¿˜æ˜¯ä¸¤è€…çš†æ˜¯ï¼Œéœ€è¦ä½¿ç”¨ç¨å¾®ä¸åŒçš„æ¨¡å¼ã€‚å¦‚ä¸‹æˆ‘å°†å±•ç¤ºä¸€ç§æ¥å—ä¸€ä¸ªå¯é€‰å…³é”®å­—å‚æ•°çš„æ–¹å¼ï¼š&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;from functools import wraps

GLOBAL_NAME = &amp;amp;quot;Brian&amp;amp;quot;

def print_name(function=None, name=GLOBAL_NAME):
    def actual_decorator(function):
        @wraps(function)
        def returned_func(*args, **kwargs):
            print &amp;amp;quot;My name is &amp;amp;quot; + name
            return function(*args, **kwargs)
        return returned_func

    if not function:    # User passed in a name argument
        def waiting_for_func(function):
            return actual_decorator(function)
        return waiting_for_func

    else:
        return actual_decorator(function)

@print_name
def a_function():
    print &amp;amp;quot;I like the name!&amp;amp;quot;

@print_name(name=&amp;amp;apos;Matt&amp;amp;apos;)
def another_function():
    print &amp;amp;quot;Hey, that&amp;amp;apos;s new!&amp;amp;quot;

a_function()
# &amp;amp;gt;&amp;amp;gt; My name is Brian
# &amp;amp;gt;&amp;amp;gt; I like that name!

another_function()
# &amp;amp;gt;&amp;amp;gt; My name is Matt
# &amp;amp;gt;&amp;amp;gt; Hey, that&amp;amp;apos;s new!&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœæˆ‘ä»¬ä¼ é€’å…³é”®å­—å‚æ•° &lt;code&gt;name&lt;/code&gt; ç»™ &lt;code&gt;print_name&lt;/code&gt;ï¼Œé‚£ä¹ˆå®ƒçš„è¡Œä¸ºå°±ä¸å‰ä¸€ä¸ªä¾‹å­ä¸­çš„ &lt;code&gt;argumentative_decorator&lt;/code&gt; ç›¸ä¼¼ã€‚å³ï¼Œé¦–å…ˆä»¥ &lt;code&gt;name&lt;/code&gt; ä¸ºå‚è°ƒç”¨ &lt;code&gt;print_name&lt;/code&gt; ã€‚ç„¶åï¼Œå°†å¾…åŒ…è£…çš„å‡½æ•°ä¼ é€’ç»™é¦–æ¬¡è°ƒç”¨è¿”å›çš„å‡½æ•°ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœæˆ‘ä»¬æ²¡æœ‰æä¾› &lt;code&gt;name&lt;/code&gt; å®å‚ï¼Œ &lt;code&gt;print_name&lt;/code&gt; çš„è¡Œä¸ºå°±ä¸å‰é¢æˆ‘ä»¬çœ‹åˆ°çš„ä¸å¸¦å‚æ•°çš„è£…é¥°å™¨ä¸€æ ·ã€‚è£…é¥°å™¨ä»…ä»¥å¾…åŒ…è£…çš„å‡½æ•°ä½œä¸ºå”¯ä¸€çš„å‚æ•°è¿›è¡Œè°ƒç”¨ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;print_name&lt;/code&gt; æ”¯æŒä¸¤ç§å¯èƒ½æ€§ã€‚å®ƒä¼šæ£€æŸ¥æ˜¯å¦æ”¶åˆ°ä½œä¸ºå‚æ•°çš„è¢«åŒ…è£…å‡½æ•°ã€‚å¦‚æœæ²¡æœ‰ï¼Œåˆ™è¿”å›å‡½æ•°&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;code&gt;waiting_for_func&lt;/code&gt;ï¼Œè¯¥å‡½æ•°å¯ä»¥è¢«åŒ…è£…å‡½æ•°ä½œä¸ºå‚æ•°è¿›è¡Œè°ƒç”¨ã€‚å¦‚æœæ”¶åˆ°è¢«åŒ…è£…å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œåˆ™è·³è¿‡ä¸­é—´æ­¥éª¤ï¼Œç›´æ¥è°ƒç”¨ &lt;code&gt;actual_decorator&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;h2&gt;ä¸²æ¥è£…é¥°å™¨&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç°åœ¨æ¥æ¢ç´¢ä¸€ä¸‹ä»Šå¤©è¦è®²çš„æœ€åä¸€ä¸ªè£…é¥°å™¨çš„ç‰¹æ€§ï¼šä¸²æ¥ã€‚ä½ å¯ä»¥åœ¨ä»»æ„ç»™å®šçš„å‡½æ•°ä¹‹ä¸Šå †å ä½¿ç”¨å¤šä¸ªè£…é¥°å™¨ï¼Œ è¿™ç§æ„å»ºå‡½æ•°çš„æ–¹å¼ä¸ä½¿ç”¨å¤šé‡ç»§æ‰¿æ„å»ºç±»ç›¸ç±»ä¼¼ã€‚ä¸è¿‡æœ€å¥½ä¸è¦ç–¯ç‹‚ä½¿ç”¨è¿™ç§ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;@print_name(&amp;amp;apos;Sam&amp;amp;apos;)
@logging_decorator
def some_function():
    print &amp;amp;quot;I&amp;amp;apos;m the wrapped function!&amp;amp;quot;

some_function()
# &amp;amp;gt;&amp;amp;gt; My name is Sam
# &amp;amp;gt;&amp;amp;gt; The function I modify has been called 1 time(s).
# &amp;amp;gt;&amp;amp;gt; I&amp;amp;apos;m the wrapped function!&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å½“ä½ ä¸²æ¥ä½¿ç”¨è£…é¥°å™¨æ—¶ï¼Œå®ƒä»¬å †å çš„é¡ºåºæ˜¯è‡ªåº•å‘ä¸Šçš„ã€‚å°†è¢«åŒ…è£…çš„å‡½æ•° &lt;code&gt;some_function&lt;/code&gt; ç»ç¼–è¯‘åä¼ é€’ç»™å®ƒä¹‹ä¸Šçš„ç¬¬ä¸€ä¸ªè£…é¥°å™¨ï¼ˆ &lt;code&gt;logging_decorator&lt;/code&gt; ï¼‰ã€‚ç„¶åç¬¬ä¸€ä¸ªè£…é¥°å™¨çš„è¿”å›å€¼è¢«ä¼ é€’ç»™ç¬¬äºŒä¸ªè£…é¥°å™¨ã€‚ä¾æ­¤é€ä¸ªåº”ç”¨é“¾ä¸Šæ¯ä¸ªè£…é¥°å™¨ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„ä¸¤ä¸ªè£…é¥°å™¨éƒ½æ˜¯ &lt;code&gt;print&lt;/code&gt; ä¸€ä¸ªå€¼ï¼Œç„¶åæ‰§è¡Œä¼ é€’ç»™å®ƒä»¬çš„å‡½æ•°ï¼Œè¿™æ„å‘³ç€å½“è°ƒç”¨è¢«åŒ…è£…å‡½æ•°æ—¶ï¼Œé“¾ä¸­çš„æœ€åä¸€ä¸ªè£…é¥°å™¨ &lt;code&gt;print_name&lt;/code&gt; æ‰“å°è¾“å‡ºä¸­çš„ç¬¬ä¸€è¡Œã€‚&lt;/p&gt;
&lt;h2&gt;æ€»ç»“&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘è®¤ä¸ºè£…é¥°å™¨æœ€å¤§çš„å¥½å¤„ä¹‹ä¸€åœ¨äºè®©ä½ èƒ½å¤Ÿä»æ›´é«˜çš„æŠ½è±¡å±‚æ¬¡è¿›è¡Œæ€è€ƒã€‚å‡å¦‚ä½ å¼€å§‹é˜…è¯»ä¸€ä¸ªå‡½æ•°å®šä¹‰ï¼Œçœ‹åˆ°æœ‰ä¸€ä¸ª &lt;code&gt;memoize&lt;/code&gt; è£…é¥°å™¨ï¼Œä½ ç«‹åˆ»å°±èƒ½æ˜ç™½ä½ æ­£åœ¨çœ‹çš„æ˜¯ä¸€ä¸ªä½¿ç”¨ç¼“å­˜åˆ¶è¡¨çš„å‡½æ•°ã€‚å¦‚æœç¼“å­˜åˆ¶è¡¨çš„ä»£ç åŒ…å«åœ¨å‡½æ•°ä½“å†…ï¼Œå°±ä¼šéœ€è¦é¢å¤–çš„è„‘åŠ›è¿›è¡Œè§£æï¼Œå¹¶ä¸”ä¼šæœ‰å¼•å…¥è¯¯è§£çš„å¯èƒ½ã€‚ä½¿ç”¨è£…é¥°å™¨ä¹Ÿå…è®¸ä»£ç å¤ç”¨ï¼Œä»è€ŒèŠ‚çœæ—¶é—´ã€ç®€åŒ–è°ƒè¯•ï¼Œå¹¶ä¸”ä½¿å¾—é‡æ„æ›´åŠ å®¹æ˜“ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç©ç©è£…é¥°å™¨ä¹Ÿæ˜¯ä¸€ç§å¾ˆå¥½çš„å­¦ä¹ å‡½æ•°å¼æ¦‚å¿µï¼ˆå¦‚é«˜é˜¶å‡½æ•°ä¸é—­åŒ…ï¼‰çš„æ–¹å¼ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘å¸Œæœ›æœ¬æ–‡é˜…è¯»èµ·æ¥å¾ˆæ„‰å¿«ï¼Œå¹¶ä¸”å†…å®¹ç¿”å®ã€‚&lt;/p&gt;</description>
            <pubDate>2013-01-04</pubDate>
            <link>https://blog.xiayf.cn/posts/decorators-and-functional-python.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/decorators-and-functional-python.html</guid>
        </item>
        
        <item>
            <title>Pythonè£…é¥°å™¨å…¥é—¨ï¼ˆè¯‘ï¼‰</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;åŸæ–‡: &lt;a href=&apos;http://www.thumbtack.com/engineering/a-primer-on-python-decorators/&apos;&gt;A primer on Python decorators&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Pythonå…è®¸ä½ ï¼Œä½œä¸ºç¨‹åºå‘˜ï¼Œä½¿ç”¨å‡½æ•°å®Œæˆä¸€äº›å¾ˆé…·çš„äº‹æƒ…ã€‚åœ¨Pythonä¸­ï¼Œå‡½æ•°æ˜¯&lt;a href=&apos;http://en.wikipedia.org/wiki/First-class_function&apos;&gt;ä¸€ç­‰å¯¹è±¡(first-class object)&lt;/a&gt;ï¼Œè¿™å°±æ„å‘³ç€ä½ å¯ä»¥åƒä½¿ç”¨å­—ç¬¦ä¸²ï¼Œæ•´æ•°ï¼Œæˆ–è€…ä»»ä½•å…¶ä»–å¯¹è±¡ä¸€æ ·ä½¿ç”¨å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥å°†å‡½æ•°èµ‹å€¼ç»™å˜é‡:&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;&amp;amp;gt;&amp;amp;gt;&amp;amp;gt; def square(n):
...     return n * n;
&amp;amp;gt;&amp;amp;gt;&amp;amp;gt; square(4)
16
&amp;amp;gt;&amp;amp;gt;&amp;amp;gt; alias = square
&amp;amp;gt;&amp;amp;gt;&amp;amp;gt; alias(4)
16&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç„¶è€Œï¼Œä¸€ç­‰å‡½æ•°çš„çœŸæ­£å¨åŠ›åœ¨äºä½ å¯ä»¥æŠŠå‡½æ•°ä¼ ç»™å…¶ä»–å‡½æ•°ï¼Œæˆ–è€…ä»å…¶ä»–å‡½æ•°ä¸­è¿”å›å‡½æ•°ã€‚Pythonçš„å†…ç½®å‡½æ•°mapåˆ©ç”¨äº†è¿™ç§èƒ½åŠ›ï¼šç»™mapä¼ ä¸ªå‡½æ•°ä»¥åŠä¸€ä¸ªåˆ—è¡¨ï¼Œå®ƒä¼šä¾æ¬¡ä»¥åˆ—è¡¨ä¸­æ¯ä¸ªå…ƒç´ ä¸ºå‚æ•°è°ƒç”¨ä½ ä¼ ç»™å®ƒçš„é‚£ä¸ªå‡½æ•°ï¼Œä»è€Œç”Ÿæˆä¸€ä¸ªæ–°çš„åˆ—è¡¨ã€‚å¦‚ä¸‹æ‰€ç¤ºçš„ä¾‹å­ä¸­åº”ç”¨äº†ä¸Šé¢çš„é‚£ä¸ªsquareå‡½æ•°:&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;&amp;amp;gt;&amp;amp;gt;&amp;amp;gt; number = [1, 2, 3, 4, 5]
&amp;amp;gt;&amp;amp;gt;&amp;amp;gt; map(square, numbers)
[1, 4, 9, 16, 25]&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚æœä¸€ä¸ªå‡½æ•°æ¥å—å…¶ä»–å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œä»¥åŠ/æˆ–è€…è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆå®ƒå°±è¢«ç§°ä¸º&lt;a href=&apos;http://en.wikipedia.org/wiki/Higher-order_function&apos;&gt;é«˜é˜¶å‡½æ•°&lt;/a&gt; ã€‚è™½ç„¶mapå‡½æ•°åªæ˜¯ç®€å•åœ°ä½¿ç”¨äº†æˆ‘ä»¬ä¼ ç»™å®ƒçš„å‡½æ•°ï¼Œè€Œæ²¡æœ‰æ”¹å˜è¿™ä¸ªå‡½æ•°ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨é«˜é˜¶å‡½æ•°å»æ”¹å˜å…¶ä»–å‡½æ•°çš„è¡Œä¸ºã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¾‹å¦‚ï¼Œå‡è®¾æœ‰è¿™æ ·ä¸€ä¸ªå‡½æ•°ï¼Œä¼šè¢«è°ƒç”¨å¾ˆå¤šæ¬¡ï¼Œä»¥è‡´è¿è¡Œä»£ä»·éå¸¸æ˜‚è´µ:&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;&amp;amp;gt;&amp;amp;gt;&amp;amp;gt; def fib(n):
...      &amp;amp;quot;Recursively (i.e., dreadfully) calculate the nth Fibonacci number.&amp;amp;quot;
...      return n if n in [0, 1] else fib(n - 2) + fib(n - 1)&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘ä»¬ä¸€èˆ¬ä¼šä¿å­˜è®¡ç®—è¿‡ç¨‹ä¸­æ¯æ¬¡é€’å½’è°ƒç”¨çš„ç»“æœï¼Œè¿™æ ·ï¼Œå¯¹äºå‡½æ•°è°ƒç”¨æ ‘ä¸­ç»å¸¸å‡ºç°æŸä¸ªnï¼Œå½“éœ€è¦è®¡ç®—nå¯¹åº”çš„ç»“æœæ—¶ï¼Œå°±ä¸éœ€è¦é‡å¤è®¡ç®—äº†ã€‚æœ‰å¤šç§æ–¹å¼å¯ä»¥åšåˆ°è¿™ç‚¹ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›ç»“æœå­˜åœ¨ä¸€ä¸ªå­—å…¸ä¸­ï¼Œå½“ä»¥æŸä¸ªå€¼ä¸ºå‚æ•°è°ƒç”¨fibå‡½æ•°æ—¶ï¼Œå°±å…ˆåˆ°è¿™ä¸ªå­—å…¸å»æŸ¥ä¸€ä¸‹å…¶ç»“æœæ˜¯å¦å·²ç»è®¡ç®—å‡ºæ¥äº†ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½†è¿™æ ·çš„è¯ï¼Œæ¯æ¬¡æˆ‘ä»¬æƒ³è¦è°ƒç”¨fibå‡½æ•°ï¼Œéƒ½éœ€è¦é‡å¤é‚£æ®µç›¸åŒçš„å­—å…¸æ£€æŸ¥æ ·æ¿å¼ä»£ç ã€‚ç›¸åï¼Œå¦‚æœè®©fibå‡½æ•°è‡ªå·±åœ¨å†…éƒ¨è´Ÿè´£å­˜å‚¨å…¶ç»“æœï¼Œé‚£ä¹ˆåœ¨å…¶ä»–ä»£ç ä¸­è°ƒç”¨fibï¼Œå°±éå¸¸æ–¹ä¾¿ï¼Œåªè¦ç®€å•åœ°è°ƒç”¨å®ƒå°±è¡Œäº†ã€‚è¿™æ ·ä¸€ç§æŠ€æœ¯è¢«ç§°ä¸º&lt;a href=&apos;http://en.wikipedia.org/wiki/Memoization&apos;&gt;memoization&lt;/a&gt;(æ³¨æ„æ²¡æœ‰å­—æ¯rçš„å“¦)ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘ä»¬å¯ä»¥æŠŠè¿™ç§memoizationä»£ç ç›´æ¥æ”¾å…¥fibå‡½æ•°ï¼Œä½†æ˜¯Pythonä¸ºæˆ‘ä»¬æä¾›äº†å¦å¤–ä¸€ç§æ›´åŠ ä¼˜é›…çš„é€‰æ‹©ã€‚å› ä¸ºå¯ä»¥ç¼–å†™ä¿®æ”¹å…¶ä»–å‡½æ•°çš„å‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªé€šç”¨çš„memoizationå‡½æ•°ï¼Œä»¥ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›è¿™ä¸ªå‡½æ•°çš„memoizationç‰ˆæœ¬:&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;def memoize(fn):
    stored_results = {}

    def memoized(*args):
        try:
            # try to get the cached result
            return stored_results[args]
        except KeyError:
            # nothing was cached for those args. let&amp;amp;apos;s fix that.
            result = stored_results[args] = fn(*args)
            return result
    return memoized&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¦‚ä¸Šï¼Œ &lt;code&gt;memoize&lt;/code&gt; å‡½æ•°ä»¥å¦ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå‡½æ•°ä½“ä¸­åˆ›å»ºäº†ä¸€ä¸ªå­—å…¸å¯¹è±¡ç”¨æ¥å­˜å‚¨å‡½æ•°è°ƒç”¨çš„ç»“æœï¼šé”®ä¸ºè¢«memoizedåŒ…è£…åçš„å‡½æ•°çš„å‚æ•°ï¼Œå€¼ä¸ºä»¥é”®ä¸ºå‚æ•°è°ƒç”¨å‡½æ•°çš„è¿”å›å€¼ã€‚ &lt;code&gt;memoize&lt;/code&gt; å‡½æ•°è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šé¦–å…ˆæ£€æŸ¥åœ¨ &lt;code&gt;stored_results&lt;/code&gt; å­—å…¸ä¸­æ˜¯å¦å­˜åœ¨ä¸å½“å‰å‚æ•°å¯¹åº”çš„æ¡ç›®ï¼›å¦‚æœæœ‰ï¼Œå¯¹åº”çš„å­˜å‚¨å€¼ä¼šè¢«è¿”å›ï¼›å¦åˆ™ï¼Œå°±è°ƒç”¨ç»è¿‡åŒ…è£…çš„å‡½æ•°ï¼Œå­˜å‚¨å…¶è¿”å›å€¼ï¼Œå¹¶ä¸”è¿”å›ç»™è°ƒç”¨è€…ã€‚memoizeè¿”å›çš„è¿™ç§æ–°å‡½æ•°å¸¸è¢«ç§°ä¸º&quot;åŒ…è£…å™¨&quot;å‡½æ•°ï¼Œå› ä¸ºå®ƒåªæ˜¯å¦å¤–ä¸€ä¸ªçœŸæ­£èµ·ä½œç”¨çš„å‡½æ•°å¤–é¢çš„ä¸€ä¸ªè–„å±‚ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¾ˆå¥½ï¼Œç°åœ¨æœ‰äº†ä¸€ä¸ªmemoizationå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠfibå‡½æ•°ä¼ ç»™å®ƒï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªç»è¿‡åŒ…è£…çš„fibï¼Œè¿™ä¸ªç‰ˆæœ¬çš„fibå‡½æ•°ä¸éœ€è¦é‡å¤ä»¥å‰é‚£æ ·çš„ç¹é‡å·¥ä½œ:&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;def fib(n):
    return n if n in [0, 1] else fib(n - 2) + fib(n - 1)
fib = memoize(fib)&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é€šè¿‡é«˜é˜¶å‡½æ•°memoizeï¼Œæˆ‘ä»¬è·å¾—äº†memoizationå¸¦æ¥çš„å¥½å¤„ï¼Œå¹¶ä¸”ä¸éœ€è¦å¯¹fibå‡½æ•°è‡ªå·±åšå‡ºä»»ä½•æ”¹å˜ï¼Œä»¥å…å¤¹æ‚ç€memoizationçš„ä»£ç è€Œæ¨¡ç³Šäº†å‡½æ•°çš„å®è´¨å·¥ä½œã€‚ä½†æ˜¯ï¼Œä½ ä¹Ÿè®¸æ³¨æ„åˆ°ä¸Šé¢çš„ä»£ç è¿˜ç®—æœ‰ç‚¹åˆ«æ‰­ï¼Œå› ä¸ºæˆ‘ä»¬å¿…é¡»å†™3éfibã€‚ç”±äºè¿™ç§æ¨¡å¼-ä¼ é€’ä¸€ä¸ªå‡½æ•°ç»™å¦ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åå°†ç»“æœè¿”å›ç»™ä¸åŸæ¥é‚£ä¸ªå‡½æ•°åŒåçš„å‡½æ•°å˜é‡-åœ¨ä½¿ç”¨åŒ…è£…å™¨å‡½æ•°çš„ä»£ç ä¸­æä¸ºå¸¸è§ï¼ŒPythonä¸ºå…¶æä¾›äº†ä¸€ç§ç‰¹æ®Šçš„è¯­æ³•ï¼šè£…é¥°å™¨:&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;@memoize
def fib(n):
    return n if n in [0, 1] else fib(n - 2) + fib(n -1)&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™é‡Œï¼Œæˆ‘ä»¬è¯´memoizeå‡½æ•°è£…é¥°äº†fibå‡½æ•°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯è¿™ä»…æ˜¯ä¸€ç§è¯­æ³•ä¸Šçš„ç®€ä¾¿å†™æ³•(è¯‘æ³¨ï¼šå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„&quot;è¯­æ³•ç³–&quot;)ã€‚è¿™æ®µä»£ç ä¸å‰é¢çš„ä»£ç ç‰‡æ®µåšçš„æ˜¯åŒæ ·çš„äº‹æƒ…ï¼šå®šä¹‰ä¸€ä¸ªåä¸ºfibçš„å‡½æ•°ï¼ŒæŠŠå®ƒä¼ ç»™memoizeå‡½æ•°ï¼Œå°†è¿”å›ç»“æœå­˜ä¸ºåä¸ºfibçš„å‡½æ•°å˜é‡ã€‚ç‰¹æ®Šçš„(çœ‹èµ·æ¥æœ‰ç‚¹å¥‡æ€ªçš„)@è¯­æ³•åªæ˜¯å‡å°‘äº†å†—ä½™ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½ å¯ä»¥å°†å¤šä¸ªè£…é¥°å™¨å †å èµ·æ¥ä½¿ç”¨ï¼Œå®ƒä»¬ä¼šè‡ªåº•å‘ä¸Šåœ°é€ä¸ªèµ·ä½œç”¨ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬è¿˜æœ‰å¦ä¸€ä¸ªç”¨æ¥å¸®åŠ©è°ƒè¯•çš„é«˜é˜¶å‡½æ•°:&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;def make_verbose(fn):
    def verbose(*args):
        # will print (e.g.) fib(5)
        print &amp;amp;apos;%s(%s)&amp;amp;apos; % (fb.__name__, &amp;amp;apos;, &amp;amp;apos;.join(repr(arg) for arg in args))
        return fn(*args)   # actually call the decorated function

    return verbose&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¸‹é¢çš„ä¸¤ä¸ªä»£ç ç‰‡æ®µåšçš„æ˜¯åŒæ ·çš„äº‹æƒ…:&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;@memoize
@make_verbose
def fib(n):
    return n if n in [0, 1] else fib(n - 2) + fib(n - 1)&lt;/code&gt;&lt;/pre&gt;
&lt;hr&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;def fib(n):
    return n if n in [0, 1] else fib(n - 2) + fib(n - 1)
fib = memoize(make_verbose(fib))&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æœ‰è¶£çš„æ˜¯ï¼ŒPythonå¹¶æ²¡æœ‰é™åˆ¶ä½ åœ¨@ç¬¦å·ååªèƒ½å†™ä¸€ä¸ªå‡½æ•°åï¼šä½ ä¹Ÿå¯ä»¥è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œä»è€Œèƒ½å¤Ÿé«˜æ•ˆåœ°ä¼ é€’å‚æ•°ç»™è£…é¥°å™¨ã€‚å‡è®¾æˆ‘ä»¬å¹¶ä¸æ»¡è¶³äºç®€å•çš„memoizationï¼Œè¿˜æƒ³å°†å‡½æ•°çš„ç»“æœå­˜å‚¨åˆ°&lt;a href=&apos;http://memcached.org/&apos;&gt;memcached&lt;/a&gt;ä¸­ã€‚å¦‚æœä½ å·²ç»å†™äº†ä¸€ä¸ª &lt;code&gt;memcached&lt;/code&gt; è£…é¥°å™¨å‡½æ•°ï¼Œé‚£ä¹ˆå¯ä»¥(ä¾‹å¦‚)ä¼ é€’ä¸€ä¸ªæœåŠ¡å™¨åœ°å€ç»™å®ƒ:&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;@memcached(&amp;amp;apos;127.0.0.1:11211&amp;amp;apos;)
def fib(n):
    return n if n in [0, 1] else fib(n - 2) + fib(n - 1)&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;éè£…é¥°å™¨è¯­æ³•çš„å†™æ³•ä¼šå¦‚ä¸‹å±•å¼€:&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;fib = memcached(&amp;amp;apos;127.0.0.1:11211&amp;amp;apos;)(fib)&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Pythoné…å¤‡æœ‰ä¸€äº›ä½œä¸ºè£…é¥°å™¨ä½¿ç”¨çš„éå¸¸æœ‰ç”¨çš„å‡½æ•°ã€‚ä¾‹å¦‚ï¼ŒPythonæœ‰ä¸€ä¸ª &lt;code&gt;classmethod&lt;/code&gt; å‡½æ•°ï¼Œå¯ä»¥åˆ›å»ºå¤§è‡´ç±»ä¼¼äºjavaçš„é™æ€æ–¹æ³•:&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;class Foo(object):
    SOME_CLASS_CONSTANT = 42

    @classmethod
    def add_to_my_constant(cls, value):
        # Here, `cls` will just be Foo, buf if you called this method on a
        # subclass of Foo, `cls` would be that subclass instead.
        return cls.SOME_CLASS_CONSTANT + value

Foo.add_to_my_constant(10)  # =&amp;amp;gt; 52

# unlike in Java, you can also call a classmethod on an instance
f = Foo()
f.add_to_my_constant(10)    # =&amp;amp;gt; 52&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;æ—æ³¨ï¼šæ–‡æ¡£å­—ç¬¦ä¸²&lt;/h2&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Pythonå‡½æ•°å¯ä»¥åŒ…å«æ›´å¤šçš„ä¿¡æ¯ï¼Œè€Œä¸ä»…ä»…æ˜¯ä»£ç ï¼šå®ƒä»¬ä¹ŸåŒ…å«æœ‰ç”¨çš„å¸®åŠ©ä¿¡æ¯ï¼Œæ¯”å¦‚å‡½æ•°åç§°ï¼Œæ–‡æ¡£å­—ç¬¦ä¸²:&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;&amp;amp;gt;&amp;amp;gt;&amp;amp;gt; def fib(n):
...     &amp;amp;quot;Recursively (i.e., dreadfully) calculate the nth Fibonacci number.&amp;amp;quot;
...     return n if n in [0, 1] else fib(n - 2) + fib(n - 1)
...
&amp;amp;gt;&amp;amp;gt;&amp;amp;gt; fib.__name__
&amp;amp;apos;fib&amp;amp;apos;
&amp;amp;gt;&amp;amp;gt;&amp;amp;gt; fib.__doc__
&amp;amp;apos;Recursively (i.e., dreadfully) calculate the nth Fibonacci number.&amp;amp;apos;&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;Pythonå†…ç½®å‡½æ•°&lt;a href=&apos;http://docs.python.org/library/functions.html#help&apos;&gt;help&lt;/a&gt;è¾“å‡ºçš„å°±æ˜¯è¿™äº›ä¿¡æ¯ã€‚ä½†æ˜¯ï¼Œå½“å‡½æ•°è¢«åŒ…è£…ä¹‹åï¼Œæˆ‘ä»¬çœ‹åˆ°å°±æ˜¯åŒ…è£…å™¨å‡½æ•°çš„åç§°å’Œæ–‡æ¡£å­—ç¬¦ä¸²äº†:&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;&amp;amp;gt;&amp;amp;gt;&amp;amp;gt; fib = memoized(fib)
&amp;amp;gt;&amp;amp;gt;&amp;amp;gt; fib.__name__
&amp;amp;apos;memoized&amp;amp;apos;
&amp;amp;gt;&amp;amp;gt;&amp;amp;gt; fib.__doc__&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é‚£æ ·çš„ä¿¡æ¯å¹¶æ²¡æœ‰ä»€ä¹ˆç”¨å¤„ã€‚å¹¸è¿çš„æ˜¯ï¼ŒPythonåŒ…å«ä¸€ä¸ªåä¸º &lt;code&gt;functools.wraps&lt;/code&gt; çš„åŠ©æ‰‹å‡½æ•°ï¼Œèƒ½å¤ŸæŠŠå‡½æ•°çš„å¸®åŠ©ä¿¡æ¯æ‹·è´åˆ°å…¶åŒ…è£…å™¨å‡½æ•°:&lt;/p&gt;
&lt;pre class=&quot;language-python&quot;&gt;&lt;code&gt;import functools
def memoize(fn):
    stored_results = {}
        
    @functools.wraps(fn)
    def memoized(*args):
        # (as before)

    return memoized&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½¿ç”¨è£…é¥°å™¨å¸®åŠ©ä½ ç¼–å†™è£…é¥°å™¨ä¼šä½¿å¾ˆå¤šäº‹æƒ…ä»¤äººéå¸¸æ»¡æ„ã€‚ç°åœ¨ï¼Œå¦‚æœä½¿ç”¨æ›´æ–°è¿‡çš„memoizeå‡½æ•°é‡è¯•å‰é¢çš„ä»£ç ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°å¾—åˆ°ä¿ç•™çš„æ–‡æ¡£:&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;&amp;amp;gt;&amp;amp;gt;&amp;amp;gt; fib = memoized(fib)
&amp;amp;gt;&amp;amp;gt;&amp;amp;gt; fib.__name__
&amp;amp;apos;fib&amp;amp;apos;
&amp;amp;gt;&amp;amp;gt;&amp;amp;gt; fib.__doc__
&amp;amp;apos;Recursively (i.e., dreadfully) calculate the nth Fibonacci number.&amp;amp;apos;&lt;/code&gt;&lt;/pre&gt;</description>
            <pubDate>2012-07-30</pubDate>
            <link>https://blog.xiayf.cn/posts/a-primer-on-python-decorators.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/a-primer-on-python-decorators.html</guid>
        </item>
        
        <item>
            <title>å…³äºæŠ€æœ¯çš„å­¦ä¹ æ–¹æ³•</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;å…³äºå­¦ä¹ ï¼Œæ—¶é—´çŸ­ä¸æ•ˆæœå¥½å§‹ç»ˆæ˜¯ä¸€å¯¹çŸ›ç›¾çš„ç»Ÿä¸€ä½“ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å¾ˆå¤šæ—¶å€™ï¼Œè¦æƒ³åœ¨æœ€çŸ­çš„æ—¶é—´å†…å®Œæˆä¸€ä»¶äº‹æƒ…ï¼Œæœ€å¥½çš„æ–¹æ³•å°±æ˜¯ä¾è‘«èŠ¦ç”»ç“¢ï¼Œä½†è¿™æ ·çš„è¯ï¼Œå³ä½¿å®Œæˆäº†äº‹æƒ…ï¼Œä¹Ÿåªæ˜¯çŸ¥å…¶ç„¶è€Œä¸çŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œé•¿ä¹…æ¥çœ‹ï¼Œå¯¹äºå­¦ä¹ è€…çš„èƒ½åŠ›ä¸ä¼šæœ‰å¤šå¤§çš„æé«˜ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä»é•¿è¿œæ¥çœ‹ï¼Œè¦æƒ³è‡ªå·±åŸºç¡€æ‰å®ï¼Œèƒ½åŠ›å¼ºï¼Œé‚£å°±å¾—ä¸€æ­¥ä¸€æ­¥çš„æ¥ï¼Œä»åŸºç¡€çŸ¥è¯†å¼€å§‹ï¼Œä¸€ç‚¹ä¸€ç‚¹çš„ææ‡‚ï¼Œä½†è¿™ç§æ–¹å¼éœ€è¦èŠ±è´¹å¾ˆå¤šæ—¶é—´ï¼ŒçŸ­æ—¶é—´å†…æ•ˆæœä¸æ˜æ˜¾ã€‚è€Œä¸”ï¼Œå¯èƒ½æ•ˆæœæ²¡æœ‰é¢„æœŸçš„é‚£ä¹ˆå¥½ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é‚£ä¹ˆï¼Œå¦‚æœåšä¸ªæƒè¡¡å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘æƒ³ï¼Œä¹Ÿè®¸æœ€å¥½çš„å­¦ä¹ æ–¹å¼æ˜¯ï¼šå…ˆä¾è‘«èŠ¦ç”»ç“¢åœ°å®è·µï¼Œè·å¾—ä¸€äº›ç›´è§‚æ„Ÿå—ï¼Œæœ€å¥½è¿˜æœ‰ä¸€äº›ç–‘é—®ã€‚åœ¨å®è·µå®Œæˆä¹‹åï¼Œåœ¨æ•´ç†è‡ªå·±çš„ç–‘é—®ï¼Œä»¥åŠå®è·µä¸­æ¶‰åŠçš„çŸ¥è¯†è¦ç‚¹ï¼Œé€šè¿‡æŸ¥é˜…å›¾ä¹¦æˆ–è€…ç½‘ç»œèµ„æ–™ï¼Œé€ä¸ªçŸ¥è¯†ç‚¹å·©å›ºï¼Œé€ä¸ªè§£å†³ç–‘é—®ï¼Œå¹¶æ•´ç†æˆæ–‡ã€‚è¿™ä¸ªæ•´ç†æ€»ç»“çš„è¿‡ç¨‹å¯èƒ½éœ€è¦è¾ƒé•¿çš„æ—¶é—´ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ç§æ–¹å¼çš„ä¼˜åŠ¿åœ¨äºï¼š1.èƒ½è®©ä½ å¿«é€Ÿåœ°å®Œæˆäº‹æƒ…ï¼›2.å®è·µä¸­ç”¨åˆ°çš„çŸ¥è¯†å¤šåŠä¼šåœ¨ä»¥åçš„å®è·µä¸­ç»å¸¸ç”¨åˆ°ï¼ŒæŒæ¡çš„å°±æ˜¯ä¸€äº›æœ€é‡è¦çš„ä¸œè¥¿ï¼Œè€Œä¸ä¼šå­¦ä¹ ä¸€äº›å¾ˆå°‘ä½¿ç”¨çš„æ·±å¥¥åé—¨çŸ¥è¯†ã€‚&lt;/p&gt;</description>
            <pubDate>2012-05-11</pubDate>
            <link>https://blog.xiayf.cn/posts/about-method-of-learning-technology.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/about-method-of-learning-technology.html</guid>
        </item>
        
        <item>
            <title>å­¦ä¹ çš„"é“"ä¸"æœ¯"</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;è¯»ç ”ä»¥æ¥ï¼Œä¸€ç›´è§‰å¾—è‡ªå·±çš„å­¦ä¹ æ–¹æ³•ä¸å¤Ÿé«˜æ•ˆã€‚è¯•å›¾å°†è¦å­¦ä¹ çš„ä¸œè¥¿è¿›è¡Œåˆ†ç±»ï¼Œç„¶åä»¥ä¸åŒçš„æ–¹æ³•å­¦ä¹ ä¹‹ã€‚é‚£ä¹ˆè¯¥å¦‚ä½•åˆ†ç±»å‘¢ï¼Ÿæˆ‘è§‰å¾—ä»¥&quot;é“&quot;ä¸&quot;æœ¯&quot;åŒºåˆ†ä¹‹æ¯”è¾ƒåˆé€‚ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½•ä¸º&quot;é“ &quot;ï¼Ÿæ±‰è¯­è¾å…¸ä¸­æœ‰ä¸¤æ¡è§£é‡Šï¼š&lt;strong&gt;1.æŒ‡æ³•åˆ™ã€è§„å¾‹ï¼›2.å­¦æœ¯æˆ–å®—æ•™çš„æ€æƒ³ä½“ç³»&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½•ä¸º&quot;æœ¯&quot;ï¼Ÿï¼š&lt;strong&gt;æŠ€è‰º&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å­—é¢ç†è§£ï¼Œâ€œæœ¯â€æ›´ä¸ºå…·ä½“ï¼Œæ˜¯å®Œæˆä¸€ä»¶äº‹æƒ…çš„å…·ä½“è¿‡ç¨‹ã€‚è€Œâ€œé“â€è€…åˆ™æ˜¯æŒ‡å¯¼å®è·µçš„æ€æƒ³ï¼Œæ˜¯èƒ½å¤Ÿä¸¾ä¸€åä¸‰çš„äº‹ç‰©è§„å¾‹ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é‚£ä¹ˆæ˜¯å¦â€œé“â€æ¯”â€œæœ¯â€æ›´é‡è¦å‘¢ï¼Ÿæˆ‘æƒ³æœªå¿…ã€‚ä»»ä½•ç†è®ºï¼Œä»»ä½•â€œé“â€éƒ½æœ€ç»ˆæ¥æºäºâ€œæœ¯â€çš„å®è·µè¿‡ç¨‹ï¼Œä¹Ÿæœ€ç»ˆéœ€è¦åœ¨â€œæœ¯â€ä¸Šå¾—åˆ°å®æ–½ï¼Œæ‰èƒ½ä½“ç°å…¶ä»·å€¼ã€‚â€œé“â€ä¸â€œæœ¯â€ä¸¤è€…ç›¸è¾…ç›¸æˆã€‚é‚£ä¹ˆåœ¨æˆ‘ä»¬å­¦ä¹ ä¸€é—¨å­¦é—®çš„è¿‡ç¨‹ä¸­ï¼Œå°±å­˜åœ¨ä¸€ä¸ªâ€œé“â€ä¸â€œæœ¯â€ä½•è€…ä¸ºå…ˆçš„é—®é¢˜ï¼Œå³ä»â€œé“â€è¿˜æ˜¯â€œæœ¯â€å…¥æ‰‹å­¦ä¹ ï¼Ÿ&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å­Ÿå²©è¯´è¿‡è¿™ä¹ˆä¸€æ®µè¯ï¼š&lt;/p&gt;
&lt;blockquote&gt;&lt;p class=&quot;text-align-justify&quot;&gt;æˆ‘ä¸»å¼ ,åœ¨å…·å¤‡åŸºç¡€ä¹‹å,å­¦ä¹ ä»»ä½•æ–°ä¸œè¥¿,éƒ½è¦æŠ“ä½ä¸»çº¿,çªå‡ºé‡ç‚¹ã€‚å¯¹äºå…³é”®ç†è®ºçš„å­¦ä¹ ,è¦é›†ä¸­ç²¾åŠ›,é€Ÿæˆ˜é€Ÿå†³ã€‚è€Œæ—ææœ«èŠ‚å’Œéæœ¬è´¨æ€§çš„çŸ¥è¯†å†…å®¹,å®Œå…¨å¯ä»¥ç•™ç»™å®è·µå»é›¶æ•²ç¢æ‰“ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;åŸå› æ˜¯è¿™æ ·çš„,ä»»ä½•ä¸€ä¸ªé«˜çº§çš„çŸ¥è¯†å†…å®¹,å…¶ä¸­éƒ½åªæœ‰ä¸€å°éƒ¨åˆ†æ˜¯æœ‰æ€æƒ³åˆ›æ–°ã€æœ‰é‡å¤§å½±å“çš„,è€Œå…¶å®ƒå¾ˆå¤šä¸œè¥¿éƒ½æ˜¯çç¢çš„ã€éæœ¬è´¨çš„ã€‚å› æ­¤,é›†ä¸­å­¦ä¹ æ—¶å¿…é¡»æŠŠæ¡ä½çœŸæ­£é‡è¦é‚£éƒ¨åˆ†,æŠŠå…¶å®ƒä¸œè¥¿ç•™ç»™å®è·µã€‚å¯¹äºé‡ç‚¹çŸ¥è¯†,åªæœ‰é›†ä¸­å­¦ä¹ å…¶ç†è®º,æ‰èƒ½ç¡®ä¿ä½“ç³»æ€§ã€è¿è´¯æ€§ã€æ­£ç¡®æ€§,è€Œå¯¹äºé‚£äº›æ—ææœ«èŠ‚,åªæœ‰è¾¹å¹²è¾¹å­¦èƒ½å¤Ÿè®©ä½ äº†è§£å®ƒä»¬çš„çœŸå®ä»·å€¼æ˜¯å¤§æ˜¯å°,æ‰èƒ½è®©ä½ ç•™ä¸‹æ›´ç”ŸåŠ¨çš„å°è±¡ã€‚å¦‚æœä½ æŠŠç²¾åŠ›ç”¨é”™äº†åœ°æ–¹,æ¯”å¦‚ç”¨é›†ä¸­å¤§å—çš„æ—¶é—´æ¥å­¦ä¹ é‚£äº›æœ¬æ¥åªéœ€è¦æŸ¥æŸ¥æ‰‹å†Œå°±å¯ä»¥æ˜ç™½çš„å°æŠ€å·§,è€Œå¯¹äºçœŸæ­£é‡è¦çš„ã€æ€æƒ³æ€§ä¸œè¥¿æ”¾åœ¨å¹³æ—¶é›¶æ•²ç¢æ‰“,é‚£ä¹ˆè‚¯å®šæ˜¯äº‹å€åŠŸåŠ,ç”šè‡³é€‚å¾—å…¶åã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è™½ç„¶è¿™æ®µè¯å¹¶æ²¡æœ‰æ˜ç¡®åŒºåˆ†å­¦ä¹ çš„â€œé“â€ä¸â€œæœ¯â€ï¼Œä»¥åŠä½•è€…ä¸ºå…ˆçš„é—®é¢˜ã€‚ä½†å´å¤§è‡´è¯´æ˜äº†ä½•ä¸ºæ­£ç¡®çš„å­¦ä¹ æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä»â€œé“â€ä¸â€œæœ¯â€çš„è§’åº¦æ¥ç†è§£ï¼Œé‚£å…³é”®çš„ï¼Œæ ¸å¿ƒçš„ï¼Œåˆ›æ–°çš„éƒ¨åˆ†å³ä¸ºâ€œé“â€ï¼Œâ€œå¤§é“â€ã€‚è€Œé‚£ç»†èŠ‚çš„åˆ™æ˜¯â€œæœ¯â€çš„éƒ¨åˆ†ï¼Œæ˜¯éœ€è¦é•¿æ—¶é—´çš„å®è·µçš„ï¼Œä¹Ÿè®¸åªæœ‰åœ¨å®è·µä¸­é‡åˆ°çš„ç»†èŠ‚æ‰æ˜¯æœ‰æ„ä¹‰çš„ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä½†é‚£â€œå…·å¤‡åŸºç¡€ä¹‹åâ€çš„â€œåŸºç¡€â€æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘æƒ³åº”è¯¥æ˜¯ï¼š1.æ˜ç¡®é—®é¢˜æ˜¯ä»€ä¹ˆã€‚è¿™ä¸€ç‚¹æ˜¯å†æ€ä¹ˆå¼ºè°ƒéƒ½ä¸ä¸ºè¿‡çš„ã€‚è¦è§£å†³ä¸€ä¸ªé—®é¢˜å´æ²¡æœ‰çœŸæ­£æ˜ç¡®é—®é¢˜åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œé‚£ä½ åŠªåŠ›å¤šåŠæ˜¯ç™½è´¹çš„ã€‚2.è¿™ä¸œè¥¿æ˜¯ç”¨æ¥å¹²ä»€ä¹ˆç”¨çš„ï¼Œæ˜¯ç”¨æ¥è§£å†³ä»€ä¹ˆé—®é¢˜çš„ï¼Ÿå¯¹äºå·¥ç§‘å­¦ç”Ÿæ¥è¯´ï¼Œå­¦ä¹ æ–°ä¸œè¥¿çš„æ—¶å€™ï¼Œè¿™ä¸€ç‚¹æ˜¯éœ€è¦é¦–å…ˆæ˜ç¡®çš„ï¼Œåªæœ‰æ˜ç¡®äº†â€œå¹²ä»€ä¹ˆç”¨çš„â€ï¼Œæ‰èƒ½æŠ“ä½å­¦ä¹ çš„é‡ç‚¹ï¼Œæé«˜å­¦ä¹ çš„æ•ˆç‡ã€‚3. ä¸ä»¥å‰çš„ç±»ä¼¼çš„ä¸œè¥¿ç›¸æ¯”ï¼Œå…¶åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿä¸€æ ·ä¸œè¥¿ï¼Œä¸€ç§ç†è®ºå…¶ä»·å€¼å¾€å¾€åœ¨äºå¯¹å‰äººçš„çªç ´ï¼Œè¿™çªç ´çš„åœ°æ–¹æ‰æ˜¯æˆ‘ä»¬çœŸæ­£è¦æŒæ¡çš„ã€‚åœ¨å­¦ä¹ ä¸€æ ·ä¸œè¥¿ä¹‹å‰ï¼Œä¸å¦¨å¤šé—®é—®è‡ªå·±ä¸ºä»€ä¹ˆè¦å­¦è¿™ä¸ªï¼Œè¿™ä¸œè¥¿å¯¹è‡ªå·±æœ‰å¤šå¤§çš„æå‡ï¼Ÿä¸æ–­åœ°é‡å¤å­¦ä¹ ç±»ä¼¼çš„ä¸œè¥¿ï¼Œå¤šåŠæ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å…·å¤‡äº†åŸºç¡€ä¹‹åï¼Œå¯¹äºå…³é”®ç†è®ºçš„å­¦ä¹ ï¼Œæ˜¯ä¸æ˜¯åªè¦æŠ±ç€ä¹¦æœ¬ï¼Œç†è®ºå¯¹ç†è®ºçš„å­¦ä¹ å°±è¡Œå‘¢ï¼Ÿæˆ‘æƒ³è¿™æ˜¯ä¸‡ä¸‡ä¸å¯çš„ã€‚ç‰¹åˆ«æ˜¯å¯¹äºç€é‡äºå®è·µæ€§çš„å­¦é—®ï¼Œæ¯”å¦‚ç¼–ç¨‹ï¼Œç†è®ºå¯¹ç†è®ºåœ°å­¦ä¹ ï¼Œåªä¼šè®©ä½ åƒåŠ›ä¸è®¨å¥½ã€‚ç»å¤§å¤šæ•°çš„åˆ›æ–°ç†è®ºï¼Œæ ¸å¿ƒç†è®ºï¼Œéƒ½ä¸æ˜¯ä¸€ä¸‹å­å°±èƒ½ç†è§£çš„ï¼Œç‰¹åˆ«æ˜¯å½“ä½ å¯¹è¿™ä¸€é¢†åŸŸçš„å­¦é—®å¹¶ä¸ç†Ÿæ‚‰çš„æƒ…å†µä¸‹ï¼Œå®ƒéœ€è¦åœ¨åå¤çš„å®è·µä¸­é€æ­¥åœ°åŠ æ·±ç†è§£ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;é‚£ä¹ˆå¯¹äºå…³é”®å†…å®¹çš„å­¦ä¹ ï¼Œæˆ‘è§‰å¾—è¿™æ ·å­¦ä¹ ä¼šæ¯”è¾ƒåˆé€‚ï¼šå…ˆå¿«é€Ÿåœ°ï¼Œåœ¨å°½å¯èƒ½çŸ­çš„æ—¶é—´å†…æŠŠå…³é”®å†…å®¹æµ‘æ²¦åæ£åœ°è¿‡ä¸€éï¼Œèƒ½ç†è§£å¤šå°‘æ˜¯å¤šå°‘ï¼Œç›®çš„æ˜¯ä¸ºäº†è·å¾—ä¸€ä¸ªç†è®ºçš„ä¸€ä¸ªBig Pictureï¼Œæ˜ç¡®ç†è®ºçš„å„ä¸ªéƒ¨åˆ†ä¹‹é—´çš„å¤§è‡´å…³ç³»ã€‚ç„¶åå¯¹äºæ¯ä¸ªéƒ¨åˆ†ï¼Œä»¥åŠéƒ¨åˆ†ä¹‹é—´çš„å…³ç³»ï¼Œé€ä¸ªåœ°é€šè¿‡å®è·µæ¥éªŒè¯ä½ çš„ç†è§£ï¼Œä½†è¿™ä¸ªå®è·µè¿‡ç¨‹å¹¶ä¸å±äºâ€œæœ¯â€ï¼Œå› ä¸ºå®ƒä¸æ˜¯ä¸ºäº†æŠ€è‰ºï¼Œè€Œåªæ˜¯ä¸ºäº†éªŒè¯è‡ªå·±å¯¹ç†è®ºçš„ç†è§£ã€‚è¿™ä¸€éªŒè¯è¿‡ç¨‹ç»“æŸä¹‹åï¼Œä½ åº”è¯¥å°±èƒ½å¤Ÿå¯¹å…³é”®ç†è®ºæœ‰ä¸ªæ•´ä½“çš„æ­£ç¡®çš„ç†è§£äº†ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ç„¶åï¼Œä½ å°±æ”¾å¼€æ‰‹å»å¹²å§ï¼Œå»è§£å†³é‚£äº›ç°å®ä¸­çš„é—®é¢˜ï¼&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;ä¹Ÿè®¸ï¼Œä½ ä¼šè¯´ï¼Œä¸ç”¨è¿™ä¹ˆå¤æ‚å§ï¼Ÿæ˜¯çš„ï¼Œå¦‚æœä½ åªæ˜¯ä¸ºäº†è§£å†³ä¸€ä¸ªå®é™…çš„é—®é¢˜ï¼Œè€Œè¿™ä¸ªé—®é¢˜ä¹Ÿå­˜åœ¨ç›¸è¿‘çš„è§£å†³æ–¹æ¡ˆï¼Œä½ ä¸æƒ³ä¹Ÿä¸éœ€è¦å¼„æ‡‚è¿™ä¸ªé—®é¢˜ï¼Œå¥½å§ï¼Œé‚£ä½ å°±ç›´æ¥å»æ‰¾è§£å†³æ–¹æ¡ˆå§ã€‚ä½†ä½ è§£å†³è¿™ä¸ªé—®é¢˜ä¹‹åï¼Œä½ å­¦åˆ°äº†ä»€ä¹ˆå‘¢ï¼Ÿå½“ä½ å†æ¬¡é‡åˆ°ä¸€ä¸ªæœ¬è´¨ä¸Šä¸€æ ·çš„é—®é¢˜çš„æ—¶å€™ï¼Œä½ è¿˜æ˜¯èƒ½å¿«é€Ÿåœ°è§£å†³ä¹ˆï¼Ÿæ²¡æœ‰çœŸæ­£å¼„æ‡‚é—®é¢˜ï¼Œæ²¡æœ‰å¼„æ‡‚é—®é¢˜èƒŒåçš„çŸ¥è¯†ï¼Œé‚£ä½ å°±å‡†å¤‡ç€ä¸ºç±»ä¼¼çš„é—®é¢˜é‡å¤åœ°å»å¯»æ‰¾è§£å†³æ–¹æ¡ˆå§ã€‚æ©ï¼Œçœ‹èµ·æ¥æœ‰ç‚¹å‚»å“¦ã€‚&lt;/p&gt;</description>
            <pubDate>2012-03-31</pubDate>
            <link>https://blog.xiayf.cn/posts/dao-and-shu-about-learning.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/dao-and-shu-about-learning.html</guid>
        </item>
        
        <item>
            <title>Pythonå­¦ä¹ è·¯çº¿(é’ˆå¯¹å…·å¤‡ä¸€å®šç¼–ç¨‹ç»éªŒè€…)</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;ç›¸æ¯”C,C++,JAVAç­‰ç¼–ç¨‹è¯­è¨€ï¼ŒPythonæ˜¯æ˜“å­¦çš„ã€‚ä½†è¦æƒ³æ·±å…¥åœ°ç†è§£Pythonï¼Œå¹¶ç†Ÿç»ƒåœ°ç¼–å†™Pythoné£æ ¼çš„Pythonä»£ç ã€‚æˆ‘æƒ³è¿˜æ˜¯æœ‰ä¸€é•¿æ®µè·¯ç¨‹è¦èµ°çš„ã€‚ä¸‹é¢å³æ˜¯æˆ‘çš„ä¸€ç‚¹ç»éªŒæ€»ç»“ï¼Œä¸»è¦æ˜¯ä¸ºäº†æ•´ç†è‡ªå·±å­¦ä¹ çš„æ€è·¯ã€‚&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;èŠ±1-2å¤©çš„æ—¶é—´é˜…è¯»ä¸€æœ¬å¥½çš„Pythonå…¥é—¨ä¹¦ç±ï¼Œå¹¶åœ¨äº²æ‰‹å®è·µä¹¦ä¸­çš„ä»£ç ã€‚æ¨èå…¥é—¨ä¹¦ç±ï¼šã€ŠA byte of Pythonã€‹(ä¸­æ–‡ç¿»è¯‘ã€Šç®€æ˜Pythonæ•™ç¨‹ã€‹)æˆ–ã€ŠPractical Programming:An Introduction to Computer Science Using Pythonã€‹(ä¸­æ–‡ç¿»è¯‘ã€ŠPythonå®è·µæ•™ç¨‹ã€‹)æˆ–è€…å…¶ä»–çš„æ¯”è¾ƒè–„çš„å…¥é—¨ä¹¦ç±ã€‚&lt;/li&gt;
&lt;li&gt;æŠ›å¼€ä¹¦ç±ï¼Œç”¨Pythonå»å†™ä¸€åˆ‡ä½ æƒ³å†™çš„ç¨‹åºã€‚è¿™æ—¶æœ€å¥½çš„å‚è€ƒæ–‡æ¡£å³ä¸ºï¼š(1).Pythonå‘½ä»¤è§£é‡Šå™¨ä¸­çš„help(),dir()è¾…åŠ©æ–¹æ³•ï¼›(2).Pythonå®˜ç½‘æ–‡æ¡£ï¼š&lt;a href=&apos;http://docs.python.org/&apos;&gt;http://docs.python.org/&lt;/a&gt; ã€‚é‡åˆ°ä¸æ¸…æ¥šçš„åœ°æ–¹å°±ç”¨è¿™ä¸¤ä¸ªæ–¹æ³•æŸ¥ï¼Œå†ä¸è¡Œå°±å»googleä¸€ä¸‹ã€‚&lt;/li&gt;
&lt;li&gt;ä¸¤ä¸‰ä¸ªæœˆä¹‹åï¼Œç§¯ç´¯ä¸€ç‚¹çš„ä»£ç é‡ï¼Œå†é‡æ–°æ‰¾æœ¬è®²è§£æ¯”è¾ƒè¯¦ç»†çš„ä¹¦ï¼Œé‡æ–°æ¢³ç†ä¸€ä¸‹è‡ªå·±å¯¹Pythonçš„ç†è§£ï¼Œçº æ­£è‡ªå·±å®è·µä¸­ä¸€äº›ä¸å¥½çš„æ–¹å¼ã€‚æ¨èä¹¦ç±ï¼šã€ŠBeginning Python: From Novice to Professionalã€‹(ä¸­æ–‡ç¿»è¯‘ã€ŠPythonåŸºç¡€æ•™ç¨‹ã€‹)ï¼Œã€ŠLearning Pythonã€‹(ä¸­æ–‡ç¿»è¯‘ã€ŠPythonå­¦ä¹ æ‰‹å†Œã€‹)ï¼Œã€ŠDive into Pythonã€‹ï¼Œã€ŠCore Python Programmingã€‹ç­‰ã€‚å¦å¤–ï¼Œä¹Ÿåº”è¯¥åœ¨ç¼–ç çš„è¿‡ç¨‹ä¸­é‡å¤åœ°å»æŸ¥é˜…Pythonæ ‡å‡†å‡½æ•°åº“ï¼Œæ ‡å‡†åº“é‡Œå·²æœ‰æ¨¡å—å®ç°çš„åŠŸèƒ½å°±ä¸è¦è‡ªå·±å®ç°ã€‚&lt;/li&gt;
&lt;li&gt;ä¹‹åï¼Œæ ¹æ®å®é™…éœ€è¦ï¼Œå»äº†è§£ä½¿ç”¨ä¸€ä¸‹Pythonçš„å„ä¸ªæ–¹é¢çš„å‡½æ•°åº“(æ¯”å¦‚http://docs.python.org/modindex.htmlä¸­ç½—åˆ—å‡ºæ¥çš„ï¼Œä»¥åŠmatplotlib, numpyç­‰ç”¨äºç§‘å­¦è®¡ç®—ï¼Œå›¾å½¢å›¾åƒå¤„ç†çš„)ï¼Œç‰¹åˆ«æ˜¯è¯¸å¤šçš„Webæ¡†æ¶(django, web2py, cherrypy, tornadoç­‰)ï¼Œå¯ä»¥å…ˆä»ç®€å•çš„å¼€å§‹ã€‚å¦‚æœæ˜¯å¯¹Pythonçš„åº•å±‚å®ç°æ„Ÿå…´è¶£ï¼Œé‚£ä¹ˆå°±è¯¥å»çœ‹çœ‹Pythonæºç ï¼Œé˜…è¯»ä¸€ä¸‹ã€ŠPythonæºç å‰–æã€‹; å¦‚æœå¯¹æ–‡æœ¬å¤„ç†æ„Ÿå…´è¶£ï¼Œå¯ä»¥é˜…è¯»ä¸€ä¸‹ã€ŠText processing in Pythonã€‹ç­‰ï¼› å¦‚æœå¯¹ç½‘ç»œæ„Ÿå…´è¶£ï¼Œå¯ä»¥é˜…è¯»ã€ŠFoundations of Python Network Programmingã€‹ï¼Œå°è¯•å®ç°ä¸€ä¸ªç®€å•çš„web server ...&lt;/li&gt;
&lt;li&gt;Pythonç›¸å…³çš„å¼€æºå‡½æ•°åº“éå¸¸éå¸¸çš„å¤šï¼Œå„ä¸ªæ–¹é¢çš„éƒ½æœ‰ï¼Œæ‰€ä»¥å­¦ä¹ è€…åº”è¯¥å°è¯•ç€å»ç”¨å®ƒä»¬ï¼Œäº†è§£å®ƒä»¬ï¼Œè€Œä¸æ˜¯å•¥éƒ½è¦è‡ªå·±æ¥å®ç°ã€‚å› ä¸ºPythonæ“…é•¿çš„å°±æ˜¯å¿«é€Ÿå¼€å‘ï¼Œè€Œä¸”ç«™åœ¨å‰äººçš„è‚©è†€ä¸Šï¼Œæˆ‘ä»¬æ‰èƒ½ç«™å¾—æ›´é«˜ï¼Œçœ‹å¾—æ›´è¿œã€‚å½“ç„¶å¦‚æœä½ æƒ³åŠ æ·±è‡ªå·±å¯¹æŸä¸ªæ–¹é¢çš„ç†è§£ï¼Œä¹Ÿå¯ä»¥å°è¯•å»å®ç°ä¸€äº›ç®€å•çš„æ¨¡å—ã€‚&lt;/li&gt;
&lt;li&gt;æ€»ä¹‹ä¸€å¥è¯ï¼šå­¦ä¹ Pythonçš„å…³é”®å°±æ˜¯ç”¨ï¼è€Œä¸”æ˜¯è¦å¤šç”¨åˆ«äººçš„ã€‚åŠ¨æ‰‹å®è·µæ‰æ˜¯ç‹é“ï¼é‚£ä¹ˆå¤šä¼˜ç§€çš„å¼€æºå‡½æ•°åº“ä¸è¦æµªè´¹äº†ï¼&lt;/li&gt;&lt;/ol&gt;</description>
            <pubDate>2012-02-21</pubDate>
            <link>https://blog.xiayf.cn/posts/the-path-of-learning-python.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/the-path-of-learning-python.html</guid>
        </item>
        
        <item>
            <title>2011å¹´ç»ˆ-å›é¡¾ä¸å±•æœ›</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;æ˜¨æ™šå®éªŒå®¤èšé¤ï¼Œå’Œå¸ˆå…„ä»¬å–é†‰äº†ï¼Œæ˜å¹´çš„è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä¹Ÿå°±å’Œä»–ä»¬ä¸€æ ·å°†è¦æ¯•ä¸šã€‚æ—¶é—´ï¼Œæ€»æ˜¯å¾€å‰çœ‹è§‰å¾—å¾ˆæ¼«é•¿ï¼Œå¯å›è¿‡å¤´å»çœ‹çœ‹ï¼Œä¸€å¹´ä¹Ÿå°±æ˜¯ç¬é—´çš„äº‹æƒ…ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;2011ï¼Œæˆ‘ä»ç ”ä¸€èµ°å‘ç ”äºŒï¼Œ2012ï¼Œæˆ‘å°†ä»ç ”äºŒèµ°å‘ç ”ä¸‰ï¼Œç»§è€Œæ¯•ä¸šï¼Œå·¥ä½œã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;å›é¡¾è¿‡å»ä¸€å¹´ï¼Œäºæˆ‘è‡ªå·±è€Œè¨€ï¼Œè¿‡å¾—å¾ˆå¹³æ·¡ï¼Œä¹Ÿè®¸æ˜¯å¤§å­¦ä»¥æ¥æœ€å¹³æ·¡çš„ä¸€å¹´ï¼Œåªèƒ½è¯´ä¹Ÿè®¸ï¼Œå› ä¸ºå¯¹äº2011ï¼Œæˆ‘è®°ä¸å¾—å¤ªå¤šçš„äº‹æƒ…ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸€å¹´é‡Œï¼Œæˆ‘ï¼Œä¸€ä¸ªæŠ€æœ¯ç”·ï¼Œæ¯”ä»¥å‰æ›´å®…ï¼Œè¯ä¹Ÿç›¸å¯¹å°‘äº†å¾ˆå¤šï¼Œç›´æ¥è¡¨ç°ä¸ºQQç©ºé—´æˆ–è€…æ ¡å†…ä¸Šçš„æ–‡å­—å†™å¾—å¾ˆå°‘ã€‚å¾ˆå°‘å’Œåˆ«äººè°ˆè®ºè‡ªå·±ï¼Œå› ä¸ºæˆ‘è§‰å¾—çº ç»“äºé‚£ä¸ªâ€œå°æˆ‘â€æ˜¯ä»¶å¾ˆâ€œå°é’å¹´â€çš„äº‹æƒ…ã€‚äººä¸äººä¹‹é—´ä¸å¯é¿å…çš„éš”è†œå¯¼è‡´äº†ä¸ªäººçš„äº‹æƒ…ä¸ç®¡å¤šå¤§åœ¨åˆ«äººçœ¼é‡Œéƒ½æ˜¯å¾®ä¸è¶³é“çš„ï¼Œåœ¨åˆ«äººçš„å¿ƒé‡Œæ€ä¸èµ·åŠç‚¹æ³¢æ¾œï¼Œè¯´è¿‡äº†ä¹Ÿå°±å¿˜äº†ã€‚æ‰€ä»¥é‚£äº›å…³äºè‡ªå·±çš„ï¼Œè¿˜æ˜¯æ”¾åœ¨å¿ƒé‡Œæ¯”è¾ƒå¥½ï¼Œæ¯‹é¡»è¯´äº›æ²¡æ„ä¹‰çš„ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸€å¹´é‡Œï¼Œæˆ‘æƒ³å¾—æŒºå¤šï¼Œä½†çœŸæ­£åšäº†æˆ–è€…è¯´åšå¥½çš„å´å¾ˆå°‘ã€‚è¿™æ˜¯ä»¶ä¸¥é‡çš„äº‹æƒ…ã€‚ç‰¹åˆ«åœ¨æŠ€æœ¯ä¸Šï¼Œä¸œçœ‹è¥¿çœ‹ï¼Œä¸œå­¦è¥¿å­¦ï¼Œçœ¼ç•Œç¡®å®å¼€é˜”å¾ˆå¤šï¼Œä¹Ÿå…»æˆäº†è¾ƒä¸ºè‰¯å¥½çš„æŠ€æœ¯è¶£å‘³ã€‚ä½†ä»æŠ€æœ¯èƒ½åŠ›ä¸Šæ¥è¯´ï¼ŒçœŸä¸å¥½è¯´ï¼Œæˆ‘éƒ½ä¸çŸ¥é“è‡ªå·±æœ‰å‡ æ–¤å‡ ä¸¤ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸€å¹´é‡Œï¼Œæœ€å¤§çš„æ”¶è·ï¼Œä¹Ÿè®¸æ˜¯å¯¹â€œå­¦ä¹ â€çš„é‡æ–°è®¤è¯†ï¼Œä»¥åŠè¯•å›¾ä»â€œå­¦çŸ¥è¯†â€å‘â€œåšäº‹æƒ…â€è½¬å˜(è¿™é‡Œçš„â€œåšäº‹æƒ…â€ç‰¹æŒ‡â€œè§£å†³å®é™…é—®é¢˜â€)ï¼Œä»¥å‰çš„è‡ªå·±å¤ªå–œæ¬¢å¤ªæ²‰è¿·äºå­¦ä¸œè¥¿ï¼Œè€Œå¿½ç•¥äº†è‡ªä¸»åœ°åšäº‹æƒ…ã€‚â€œç”Ÿæœ‰æ¶¯ï¼Œè€ŒçŸ¥æ— æ¶¯â€çš„æ— å¥ˆæ˜¯å¿…é¡»é¢å¯¹çš„ï¼Œå¯¹äºæœ‰é™çš„äººç”Ÿæ¥è¯´ï¼ŒçŸ¥è¯†å¿…é¡»å¯¹è‡ªå·±æœ‰ç”¨æ‰å€¼å¾—å­¦ï¼Œç‰¹åˆ«æ˜¯æŠ€æœ¯ç›¸å…³çš„çŸ¥è¯†ï¼Œé‚£æ€ä¹ˆçŸ¥é“å“ªäº›çŸ¥è¯†å¯¹è‡ªå·±æœ‰ç”¨å‘¢ï¼Ÿå¾—â€œè¾¹ç”¨è¾¹å­¦â€ï¼Œéœ€è¦ç”¨çš„æ—¶å€™å†å­¦ã€‚æ‰€ä»¥åº”å¤šåšäº‹æƒ…ï¼Œåº”æ‰¾å®é™…çš„é—®é¢˜ï¼Œå°è¯•å»è§£å†³ï¼Œåœ¨è§£å†³é—®é¢˜çš„è¿‡ç¨‹ä¸­å­¦ä¹ ã€‚è§£å†³å®é™…é—®é¢˜æ‰æ˜¯æ ¹æœ¬ï¼Œæ‰æ˜¯ç›®çš„ï¼Œè€Œä¸æ˜¯å­¦ä¹ ã€‚å­¦ç”Ÿæ—¶ä»£ä¹ æƒ¯äº†å­¦ï¼Œä¹ æƒ¯äº†è¾¹å­¦è¾¹ç”¨ï¼Œä½†å¯¹äºç ”ç©¶ç”Ÿï¼Œå¯¹äºä»¥åçš„å·¥ä½œæ¥è¯´ï¼Œå…‰é¡¾ç€å­¦æ˜¯æ²¡ç”¨çš„ï¼Œè€Œä¸”ä¸€å‘³çš„å­¦ä¹Ÿæ˜¯éå¸¸éš¾ä»¥æ·±å…¥çš„ï¼Œè¦å¯¹æŸä¸ªæ–¹é¢æœ‰ä¸ªæ·±å…¥çš„ç†è§£ï¼Œå¿…é¡»é€šè¿‡åšäº‹æƒ…ï¼Œå‘ç°é—®é¢˜ï¼Œè§£å†³é—®é¢˜ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸€è½¬å˜è¿‡ç¨‹è®©æˆ‘éå¸¸çº ç»“ï¼Œè€Œä¸”åˆ°ç›®å‰ä¸ºæ­¢è¿˜ç®—ä¸ä¸ŠæˆåŠŸã€‚å¯èƒ½å¯¹äºå¾ˆå¤šäººæ¥è¯´ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½å¾ˆç®€å•ï¼Œä½†å¯¹äºæˆ‘æ¥è¯´ï¼Œå¥½å¥‡å¿ƒå¼ºï¼Œå–œæ¬¢å­¦ä¸œè¥¿çš„æ¥è¯´ï¼Œç¡®å®æå…¶è‰°éš¾çš„ã€‚æ¯åšä¸€ä»¶äº‹æƒ…ï¼Œéƒ½å¾ˆå¯èƒ½é™·å…¥å­¦ä¹ çš„çŠ¶æ€ï¼Œè€Œä¸ä¼šåŠæ—¶åœ°é€‚å¯è€Œæ­¢ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸€è¿‡ç¨‹å¸Œæœ›åœ¨2012å¹´æœ‰ä¸ªå¾ˆå¥½çš„è¿›å±•ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸€å¹´é‡Œï¼Œæˆ‘é€æ­¥æ„è¯†åˆ°è‡ªå·±å­˜åœ¨çš„å¦ä¸€ä¸ªå¤§é—®é¢˜---ä¸å¤Ÿè‡ªä¿¡ï¼Œå…¶å¤–åœ¨è¡¨ç°ä¸ºå’Œåˆ«äººä¸€èµ·æ—¶ï¼Œæå…¶å®¹æ˜“å°†è‡ªå·±çš„è§‚ç‚¹è®©ä½äºåˆ«äººçš„è§‚ç‚¹ï¼Œå³ä½¿æˆ‘å¹¶ä¸è®¤ä¸ºè‡ªå·±çš„è§‚ç‚¹å­˜åœ¨ä»€ä¹ˆé—®é¢˜ï¼Œæˆ–è€…åˆ«äººçš„è§‚ç‚¹æ¯”æˆ‘çš„æ›´æ­£ç¡®ã€‚æˆ‘åªæ˜¯ä¸æƒ³å‡Œé©¾äºåˆ«äººä¹‹ä¸Šï¼Œä¸æƒ³è®©è‡ªå·±å½±å“åˆ°åˆ«äººã€‚è¿™å¬èµ·æ¥ä¼¼ä¹ä¸å…³ä¹è‡ªä¿¡ï¼Œä½†æˆ‘æƒ³æœ¬è´¨ä¸Šæ˜¯çš„ã€‚â€œä¸å¤Ÿè‡ªä¿¡â€è¿™çœ‹èµ·æ¥ä¹Ÿä¼¼ä¹ä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ï¼Œä½†æˆ‘æƒ³å¯¹äºä¸€ä¸ªæˆå¹´äººï¼Œç‰¹åˆ«æ˜¯ä¸€ä¸ªç”·äººï¼Œè‡ªä¿¡æ˜¯éå¸¸é‡è¦çš„ï¼Œå¯¹äºäº‹ä¸šä¹Ÿæ˜¯ä»¶éå¸¸é‡è¦çš„äº‹æƒ…ã€‚ä»¥å‰è‡ªå·±æ´»å¾—å¤ªè°¨æ…ï¼Œä¸å–œæ¬¢åœ¨å…¬å…±åœºåˆè¡¨ç°è‡ªå·±ï¼Œè§‰å¾—æé«˜è‡ªå·±çš„å†…åœ¨ä¿®ä¸ºæ‰æ˜¯é‡è¦çš„ã€‚ä½†å…¶å®æ´»åœ¨ç¤¾ä¼šä¸­ï¼Œé€‚æ—¶é€‚å½“åœ°è¡¨ç°è‡ªå·±ï¼Œè¡¨è¾¾è‡ªå·±çš„è§‚ç‚¹ï¼ŒåšæŒè‡ªå·±çš„çœ‹æ³•æ˜¯éå¸¸é‡è¦çš„ã€‚æœ‰ä¸ªè¯å«â€œå†…åœ£å¤–ç‹â€ï¼Œä»¥åæˆ‘å¾—æ›´åŠ æ³¨é‡â€œå¤–ç‹â€ï¼Œå†…å¤–å…¼ä¿®ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸€å¹´é‡Œï¼Œæˆ‘æ´»å¾—åˆå¾ˆéšæ€§(å’Œâ€œæ´»å¾—è°¨æ…â€çŸ›ç›¾è€Œå…±å­˜)ï¼Œä¸å¤ªæ³¨æ„è‡ªå·±çš„è¨€è¡Œï¼Œè„è¯å£å¤´ç¦…ä¹Ÿæ¯”è¾ƒå¤šï¼Œè™½ç„¶åœ¨æˆ‘çœ‹æ¥ï¼Œæˆ‘çš„è„è¯å…¨æ˜¯åœ¨è¡¨è¾¾ä¸€ç§æƒ…ç»ªï¼Œä»…æ­¤è€Œå·²ã€‚ä½†æˆ‘æƒ³åœ¨åˆ«äººæ¥çœ‹ï¼Œå…¶æ„Ÿå—ä¹Ÿè®¸å¹¶ä¸æ˜¯è¿™æ ·çš„ã€‚æˆ‘ä»¬å¹´è½»äººè¿˜æ˜¯è¦æ³¨æ„è‡ªå·±çš„å½¢è±¡çš„ï¼Œå‘µå‘µã€‚å¦å¤–ï¼Œå°½é‡å°‘è¯„è®ºåˆ«äººï¼Œç‰¹åˆ«æ˜¯åˆ«äººçš„ç¼ºç‚¹ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è¿™ä¸€å¹´é‡Œï¼Œæˆ‘å¾ˆæ‡’æ•£ï¼Œè‡ªå·±éƒ½æœ‰äº›çœ‹ä¸è¿‡å»äº†ï¼Œâ€œè¿™æ ·çš„æ—¥å­ï¼Œå†å¥½çš„ï¼Œæ²¡æœ‰äº†â€ï¼Œæˆ‘æƒ³ä¸æ˜¯ä»¶å¥½äº‹æƒ…ã€‚èƒ½å¤Ÿè‡ªæˆ‘å®‰æ…°ç‚¹æ˜¯è¿˜è¯»äº†ç‚¹ä¹¦ï¼Œæ•´ç†ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;ç¤¾ç§‘æ–‡è‰ºç±»&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ä½›ç¥–åœ¨ä¸€å·çº¿&lt;/li&gt;
&lt;li&gt;ä¹¦è™«å°æœ­&lt;/li&gt;
&lt;li&gt;å¤æ‚æ€§æ€æƒ³å¯¼è®º&lt;/li&gt;
&lt;li&gt;äººç”Ÿ&lt;/li&gt;
&lt;li&gt;ç»™ç ”ç©¶ç”Ÿçš„å­¦æœ¯å»ºè®®&lt;/li&gt;
&lt;li&gt;è¾¹åŸ&lt;/li&gt;
&lt;li&gt;æœ±é••åŸºç­”è®°è€…é—®&lt;/li&gt;
&lt;li&gt;çª—é‡Œçª—å¤–&lt;/li&gt;
&lt;li&gt;è”å¤§å…«å¹´&lt;/li&gt;
&lt;li&gt;ç¬‘è°ˆå¤§å…ˆç”Ÿ&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;&lt;strong&gt;æŠ€æœ¯ç±»&lt;/strong&gt; (éƒ¨åˆ†æ˜¯æŒ‰éœ€é€‰å–ç« èŠ‚é˜…è¯»)&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;Shellè„šæœ¬å­¦ä¹ æŒ‡å—&lt;/li&gt;
&lt;li&gt;Linuxå†…æ ¸è®¾è®¡ä¸å®ç°&lt;/li&gt;
&lt;li&gt;é¸Ÿå“¥çš„Linuxç§æˆ¿èœ&lt;/li&gt;
&lt;li&gt;PHPå’ŒMySQL Webå¼€å‘ï¼ˆåŸä¹¦ç¬¬3ç‰ˆï¼‰&lt;/li&gt;
&lt;li&gt;åˆ†å¸ƒå¼å¤„ç†å®è·µ&lt;/li&gt;
&lt;li&gt;Java Collections&lt;/li&gt;
&lt;li&gt;å¯çˆ±çš„Python&lt;/li&gt;
&lt;li&gt;æµªæ½®ä¹‹å·…&lt;/li&gt;
&lt;li&gt;CSS Webè®¾è®¡å¿«é€Ÿä¸Šæ‰‹&lt;/li&gt;
&lt;li&gt;ç¼–ç¨‹äººç”Ÿ&lt;/li&gt;
&lt;li&gt;Cé™·é˜±ä¸ç¼ºé™·&lt;/li&gt;
&lt;li&gt;è°ƒè¯•ä¹æ³•&lt;/li&gt;
&lt;li&gt;é»‘å®¢ä¸ç”»å®¶&lt;/li&gt;
&lt;li&gt;Python UNIX å’ŒLinux ç³»ç»Ÿç®¡ç†æŒ‡å—&lt;/li&gt;
&lt;li&gt;ç‰ˆæœ¬æ§åˆ¶ä¹‹é“&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ¯”è¾ƒè€Œè¨€ï¼Œæ•°é‡ä¸Šä¸ç®—å°‘ï¼Œä¹Ÿä¸ç®—å¤šï¼Œä½†ä¸»è¦é—®é¢˜è¿˜æ˜¯è´¨é‡ä¸Šï¼Œè§‰å¾—è‡ªå·±æœ‰äº›æµ‘æ²¦åæ£ï¼Œè¯»å¾—å¤ªåŒ†å¿™ã€‚è¿™æ˜¯ä»¥åçš„é˜…è¯»éœ€è¦æ³¨æ„çš„ï¼Œå…‹åˆ¶ç„¦èºçš„å¿ƒç†ï¼Œæ…¢æ…¢é˜…è¯»æ¶ˆåŒ–ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ–°çš„ä¸€å¹´ï¼Œå…·ä½“æ¥è¯´ï¼Œæˆ‘éœ€è¦é¢å¯¹çš„å‡ ä»¶å¤§äº‹æƒ…ï¼Œå¤§è‡´åŒ…æ‹¬:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å°è®ºæ–‡&lt;/li&gt;
&lt;li&gt;å®ä¹ &lt;/li&gt;
&lt;li&gt;æ¯•ä¸šè®ºæ–‡ï¼ŒåŒ…æ‹¬ç­”è¾©&lt;/li&gt;
&lt;li&gt;æ‰¾å·¥ä½œ&lt;/li&gt;
&lt;li&gt;...&lt;/li&gt;&lt;/ul&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;2012å¹´åº•ï¼Œæˆ‘å°†è¦æ¯•ä¸šäº†(è™½ç„¶ï¼Œå½¢å¼ä¸Šæ˜¯2013å¹´æ¯•ä¸š)ï¼Œæˆ‘å°±è¦å·¥ä½œäº†ï¼Œè¿™ä¹Ÿè®¸æ˜¯å’Œé«˜è€ƒç›¸å½“çš„ä¸€ä»¶å¤§äº‹ï¼Œå¸Œæœ›è‡ªå·±èƒ½å¤Ÿä¸¾é‡è‹¥è½»ï¼Œè¸å®å‡†å¤‡ï¼Œé¡ºåˆ©åº”å¯¹ã€‚(å†å…·ä½“ç‚¹æ˜¯ä¸æ˜¯åº”è¯¥è¯´å¤šå¤šcodingï¼Œå¤šåšäº‹æƒ…ï¼å“ˆå“ˆ)&lt;/p&gt;</description>
            <pubDate>2012-01-01</pubDate>
            <link>https://blog.xiayf.cn/posts/2011-summary.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/2011-summary.html</guid>
        </item>
        
        <item>
            <title>Linuxæ·»åŠ å®šæ—¶ä»»åŠ¡</title>
            <description>&lt;p class=&quot;text-align-justify&quot;&gt;åœ¨Linuxä¸‹å¦‚æœå¸Œæœ›æŸä¸ªä»»åŠ¡å®šæ—¶åœ°æ‰§è¡Œï¼Œä¸€èˆ¬æ˜¯ä½¿ç”¨cronæœåŠ¡å™¨ï¼Œå°†ä»»åŠ¡æ·»åŠ åˆ°cronä»»åŠ¡åˆ—è¡¨ä¸­ã€‚&lt;/p&gt;
&lt;h4&gt;å¯åŠ¨ï¼Œå…³é—­ï¼Œé‡å¯cron(éœ€è¶…çº§ç”¨æˆ·æƒé™)&lt;/h4&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;/etc/init.d/cron start
/etc/init.d/cron stop
/etc/init.d/cron restart&lt;/code&gt;&lt;/pre&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ³¨:archlinuxä¸‹ä¸º/etc/rc.d/crond start|stop|restart&lt;/p&gt;
&lt;h4&gt;æŸ¥çœ‹ç”¨æˆ·è®¾ç½®çš„å®šæ—¶ä»»åŠ¡åˆ—è¡¨&lt;/h4&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;crontab [-u xxx] -l       #  xxxä¸ºç”¨æˆ·å&lt;/code&gt;&lt;/pre&gt;
&lt;h4&gt;ç¼–è¾‘ç”¨æˆ·çš„å®šæ—¶ä»»åŠ¡åˆ—è¡¨(è¶…çº§ç”¨æˆ·æƒé™)&lt;/h4&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;crontab -u xxx -e&lt;/code&gt;&lt;/pre&gt;
&lt;h4&gt;åˆ é™¤ç”¨æˆ·çš„å®šæ—¶ä»»åŠ¡åˆ—è¡¨(è¶…çº§ç”¨æˆ·æƒé™)&lt;/h4&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;crontab -u xxx -r&lt;/code&gt;&lt;/pre&gt;
&lt;h4&gt;å®šæ—¶ä»»åŠ¡çš„ç¼–è¾‘è§„åˆ™&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;cronçš„å®šæ—¶ä»»åŠ¡ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šï¼ˆ1ï¼‰è®¾ç½®çš„æ—¶é—´ï¼ˆ2ï¼‰è¯¥æ—¶é—´ä¸‹è¦æ‰§è¡Œçš„ä»»åŠ¡å‘½ä»¤ã€‚&lt;/p&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;æ—¶é—´åˆ†5ä¸ªéƒ¨åˆ†ï¼Œä¾æ¬¡ä¸ºï¼š&lt;/p&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;minute              0-59
hour                0-23 
day of month        1-31
month               1-12
day of week         0-7 (0 or 7 is Sun, or use names)&lt;/code&gt;&lt;/pre&gt;
&lt;h4&gt;ç¤ºä¾‹ï¼ˆæ¯å¤©ä¸´æ™¨2ç‚¹å¤‡ä»½æ•°æ®åº“ï¼‰&lt;/h4&gt;
&lt;pre class=&quot;language-text&quot;&gt;&lt;code&gt;0 2 * * * mysqldump -hhostname -uusername -ppassword databasename &amp;amp;gt; backupfile.sql&lt;/code&gt;&lt;/pre&gt;
&lt;h4&gt;ä½¿è®¾ç½®ç”Ÿæ•ˆ&lt;/h4&gt;
&lt;p class=&quot;text-align-justify&quot;&gt;è®¾ç½®å®Œæˆåï¼Œé‡å¯cronå³å¯ä½¿è®¾ç½®çš„è®¡åˆ’ä»»åŠ¡å®šæ—¶æ‰§è¡Œäº†&lt;/p&gt;
&lt;h3&gt;è¯¦ç»†å†…å®¹å‚è€ƒ&lt;/h3&gt;
&lt;ul&gt;&lt;li&gt;&lt;a href=&apos;http://fanqiang.chinaunix.net/system/linux/2005-06-13/3306.shtml&apos;&gt;http://fanqiang.chinaunix.net/system/linux/2005-06-13/3306.shtml&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&apos;http://fanqiang.chinaunix.net/adm/storage/2005-03-23/2985.shtml&apos;&gt;http://fanqiang.chinaunix.net/adm/storage/2005-03-23/2985.shtml&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&apos;http://now-code.com/archives/196&apos;&gt;http://now-code.com/archives/196&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;</description>
            <pubDate>2011-12-07</pubDate>
            <link>https://blog.xiayf.cn/posts/cron-usage.html</link>
            <guid isPermaLink="true">https://blog.xiayf.cn/posts/cron-usage.html</guid>
        </item>
        
    </channel>
</rss>