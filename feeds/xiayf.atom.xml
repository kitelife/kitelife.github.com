<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>æ•°æ®ä¸æ™ºèƒ½ - xiayf</title><link href="http://youngsterxyf.github.io/" rel="alternate"></link><link href="http://youngsterxyf.github.io/feeds/xiayf.atom.xml" rel="self"></link><id>http://youngsterxyf.github.io/</id><updated>2023-04-05T00:00:00+08:00</updated><entry><title>å›¢é˜Ÿå¼€å‘æµç¨‹è§„èŒƒ</title><link href="http://youngsterxyf.github.io/2023/04/05/team-dev-process-std/" rel="alternate"></link><published>2023-04-05T00:00:00+08:00</published><updated>2023-04-05T00:00:00+08:00</updated><author><name>xiayf</name></author><id>tag:youngsterxyf.github.io,2023-04-05:/2023/04/05/team-dev-process-std/</id><summary type="html">&lt;p&gt;&lt;em&gt;æœ¬æ–‡åŸæ˜¯é’ˆå¯¹å®é™…å·¥ä½œä¸­å›¢é˜Ÿçš„æƒ…å†µç¼–å†™çš„ä¸€ä»½æµç¨‹è§„èŒƒè¯´æ˜ï¼Œéšå»æ•æ„Ÿä¿¡æ¯ä¹‹åå­˜æ”¾äºæ­¤ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="https://s2.loli.net/2023/04/05/wQ9bOaXyNiCjh5H.jpg"&gt;&lt;/p&gt;
&lt;p&gt;å¼€å‘æµç¨‹è§„èŒƒ æ˜¯ä¸€ç§å›¢é˜Ÿ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;em&gt;æœ¬æ–‡åŸæ˜¯é’ˆå¯¹å®é™…å·¥ä½œä¸­å›¢é˜Ÿçš„æƒ…å†µç¼–å†™çš„ä¸€ä»½æµç¨‹è§„èŒƒè¯´æ˜ï¼Œéšå»æ•æ„Ÿä¿¡æ¯ä¹‹åå­˜æ”¾äºæ­¤ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="https://s2.loli.net/2023/04/05/wQ9bOaXyNiCjh5H.jpg"&gt;&lt;/p&gt;
&lt;p&gt;å¼€å‘æµç¨‹è§„èŒƒ æ˜¯ä¸€ç§å›¢é˜Ÿæ–‡åŒ–ï¼Œä¹Ÿæ˜¯æœåŠ¡å’Œä¸šåŠ¡ç¨³å®šæ€§çš„åŸºæœ¬ä¿éšœçº¿ã€‚&lt;/p&gt;
&lt;h2&gt;ä¸€ã€æ–‡æ¡£&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;å…±è¯†ï¼šâ€œè°‹å®šè€ŒååŠ¨â€&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å›¢é˜Ÿçš„å¼€å‘å·¥ä½œä¸»è¦æ¥è‡ª3ä¸ªæ–¹é¢ï¼šå·¥ç¨‹ä¼˜åŒ–ï¼ˆå¹³å“ä¼˜åŒ–ã€æ€§èƒ½ä¼˜åŒ–ã€ç¨³å®šæ€§/å¯ç”¨æ€§ä¼˜åŒ–ç­‰ï¼‰ã€ç®—æ³•ä¸šåŠ¡éœ€æ±‚ã€äº§å“ä¸šåŠ¡éœ€æ±‚ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰æ¯ä¸€é¡¹å¼€å‘å·¥ä½œå®é™…ç¼–ç ä¹‹å‰ï¼Œéƒ½éœ€è¦æ¢³ç†ä¸€ä»½æ–‡æ¡£ï¼Œæ”¾åœ¨ å¼€å‘æ–‡æ¡£ ç›®å½•ä¸‹&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰æ–‡æ¡£å‘½åè§„åˆ™å¦‚ç¤ºä¾‹ â€œw1-20220721-xxxéœ€æ±‚â€ã€â€œw1-20220721-xxxä¼˜åŒ–â€ï¼Œâ€œw1â€ æ˜¯æ–‡æ¡£çš„æŒ‰åºç¼–å·ã€‚&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰æ¯ä¸€é¡¹å·¥ä½œï¼Œä¸Šçº¿/æ¨å…¨åï¼Œéƒ¨ç½²ç›¸å…³ä¿¡æ¯ã€å·¥ç¨‹æŒ‡æ ‡å˜åŒ–ã€ä¸šåŠ¡æŒ‡æ ‡å˜åŒ–ã€èµ„æºæˆæœ¬å˜åŒ–ã€é—ç•™å¾…ä¼˜åŒ–çš„éå…³é”®é—®é¢˜ç­‰ç›¸å…³ä¿¡æ¯ä¹Ÿåº”è¡¥å……åˆ°æ–‡æ¡£ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰å¦‚æœèµ°å®éªŒæµç¨‹ï¼Œä¹Ÿåœ¨åœ¨æ–‡æ¡£ä¸­åŠ ä¸Šâ€œå®éªŒæ¨è¿›æ¿å—â€ï¼Œè®°å½•å®éªŒæ¨è¿›æƒ…å†µï¼Œé‡åˆ°çš„é—®é¢˜ç­‰ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå¤šåœºæ™¯å®éªŒæ¨è¿›çš„æƒ…å†µã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;1.1 å·¥ç¨‹ä¼˜åŒ– æ–‡æ¡£&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;èƒŒæ™¯/ç°çŠ¶æè¿°/é—®é¢˜åˆ†æ&lt;/li&gt;
&lt;li&gt;ä¼˜åŒ–æ–¹æ¡ˆ/è®¾è®¡æ–¹æ¡ˆ&lt;/li&gt;
&lt;li&gt;é¢„æœŸæ”¶ç›Š&lt;/li&gt;
&lt;li&gt;åˆ†å·¥æ’æœŸ&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;1.2 ç®—æ³•ä¸šåŠ¡éœ€æ±‚æ–‡æ¡£&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ˜ç¡®ç®—æ³•è´Ÿè´£äººï¼Œé“¾æ¥ä¸Šç®—æ³•ä¾§ç›¸å…³æ–‡æ¡£ï¼ˆè¦æ±‚ç®—æ³•åŒå­¦æä¾›ï¼‰ - æ–‡æ¡£ä¸­åŒ…å« èƒŒæ™¯ã€é¢„æœŸæ”¶ç›Šã€ç®—æ³•é€»è¾‘/æ¨¡å‹ç­‰è¦ç‚¹ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;æ˜ç¡®å·¥ç¨‹æ–¹æ¡ˆï¼Œå¯¹äºå¤æ‚çš„ç®—æ³•ä¸šåŠ¡éœ€æ±‚ï¼Œåº”è¯¥ç»™å‡ºè®¾è®¡æ¦‚è¦&lt;/li&gt;
&lt;li&gt;é¢„ä¼°èµ„æºæˆæœ¬&lt;/li&gt;
&lt;li&gt;æ˜ç¡®é¡¹ç›®ä¼˜å…ˆçº§ å’Œ æ’æœŸ / Deadline&lt;/li&gt;
&lt;li&gt;å¯¹äºé«˜ä¼˜ç´§æ€¥éœ€æ±‚ï¼Œå°½å¯èƒ½é¢„å…ˆæ˜ç¡®è¿›åº¦é£é™©ç‚¹&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;1.3 äº§å“ä¸šåŠ¡éœ€æ±‚æ–‡æ¡£&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ˜ç¡®äº§å“è´Ÿè´£äººï¼Œé“¾æ¥ä¸Šäº§å“ä¾§ç›¸å…³æ–‡æ¡£ï¼ˆè¦æ±‚äº§å“åŒå­¦æä¾›ï¼‰ - æ–‡æ¡£ä¸­åŒ…å« èƒŒæ™¯ã€é¢„æœŸæ”¶ç›Šã€äº§å“è§„åˆ™ç­‰è¦ç‚¹ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;æ˜ç¡®å·¥ç¨‹æ–¹æ¡ˆï¼Œå¯¹äºå¤æ‚çš„äº§å“ä¸šåŠ¡éœ€æ±‚ï¼Œåº”è¯¥ç»™å‡ºè®¾è®¡æ¦‚è¦&lt;/li&gt;
&lt;li&gt;é¢„ä¼°èµ„æºæˆæœ¬&lt;/li&gt;
&lt;li&gt;æ˜ç¡®é¡¹ç›®ä¼˜å…ˆçº§ å’Œ æ’æœŸ / Deadline&lt;/li&gt;
&lt;li&gt;å¯¹äºé«˜ä¼˜ç´§æ€¥éœ€æ±‚ï¼Œå°½å¯èƒ½é¢„å…ˆæ˜ç¡®è¿›åº¦é£é™©ç‚¹&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;1.4 æ‰€æœ‰æ–‡æ¡£&lt;/h3&gt;
&lt;p&gt;ï¼ˆå¼ºåˆ¶ï¼‰å¿…é¡»åŒ…å«ï¼š
- æµ‹è¯•ç”¨ä¾‹è®¾è®¡å’Œå…¨é¢å®Œæ•´çš„æµ‹è¯•æŠ¥å‘Š/diff æŠ¥å‘Š
- åŒ…å«å¯¹åº”å„ä¸ªä»£ç åº“å˜æ›´çš„ MR é“¾æ¥ã€å‘å¸ƒç‰ˆæœ¬çš„ tag é“¾æ¥&lt;/p&gt;
&lt;h2&gt;äºŒã€ç¼–ç &lt;/h2&gt;
&lt;h3&gt;2.1 ç»Ÿä¸€ä»£ç è§„èŒƒ&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;å…±è¯†ï¼šæ–°ä»£ç ç»Ÿä¸€æ–°é£æ ¼ï¼Œè€ä»£ç é£æ ¼ç»´æŒä¸å˜ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4&gt;2.1.1 C++&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://google.github.io/styleguide/cppguide.html"&gt;Google C++ Style Guide&lt;/a&gt;ã€&lt;a href="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/contents/"&gt;Google C++ é£æ ¼æŒ‡å—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä»£ç è§„èŒƒ/é£æ ¼æ£€æŸ¥å·¥å…·ï¼š&lt;a href="https://github.com/cpplint/cpplint"&gt;cpplint&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;Google å®˜æ–¹æä¾›çš„å·¥å…·ï¼Œç”¨äºæ£€æµ‹ C++ ä»£ç æ˜¯å¦ç¬¦åˆ Google C++ Style Guide&lt;/li&gt;
&lt;li&gt;VS Code æ’ä»¶ï¼š&lt;a href="https://marketplace.visualstudio.com/items?itemName=mine.cpplint"&gt;cpplint - Visual Studio Marketplace&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Vim æ’ä»¶ï¼š&lt;a href="https://github.com/vim-syntastic/syntastic"&gt;vim-syntastic/syntastic: Syntax checking hacks for vim (github.com)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Clion æ’ä»¶ï¼š&lt;a href="https://plugins.jetbrains.com/plugin/7871-clion-cpplint"&gt;CLion-cpplint - CLion Plugin | Marketplace (jetbrains.com)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä»£ç æ ¼å¼åŒ–å·¥å…·ï¼š&lt;a href="https://clang.llvm.org/docs/ClangFormat.html"&gt;clang-format&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;é¡¹ç›®æ ¹ç›®å½•ä¸‹æ”¾ç½® .clang-format æ–‡ä»¶ï¼Œç¼–è¾‘å™¨/IDE é…ç½®æˆç¼–ç æ—¶è‡ªåŠ¨æ ¼å¼åŒ–æˆ–è€…ä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ–ï¼š&lt;/li&gt;
&lt;li&gt;VS Code æ’ä»¶ï¼š&lt;a href="https://marketplace.visualstudio.com/items?itemName=xaver.clang-format"&gt;Clang-Format - Visual Studio Marketplace&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Vim é›†æˆï¼š&lt;a href="https://clang.llvm.org/docs/ClangFormat.html#vim-integration"&gt;https://clang.llvm.org/docs/ClangFormat.html#vim-integration&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Clion é›†æˆï¼š&lt;a href="https://clang.llvm.org/docs/ClangFormat.html#clion-integration"&gt;https://clang.llvm.org/docs/ClangFormat.html#clion-integration &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;---
BasedOnStyle: Google
---
Language: Cpp
IndentWidth: 4
ColumnLimit: 120
DerivePointerAlignment: false
PointerAlignment: Left
SortIncludes: CaseSensitive
Standard: Auto
AccessModifierOffset: -4
SpacesBeforeTrailingComments: 2
AllowShortBlocksOnASingleLine: Never
AllowShortIfStatementsOnASingleLine: Never
AllowShortLoopsOnASingleLine: false
AllowShortFunctionsOnASingleLine: Empty
AlignTrailingComments: true
BinPackParameters: false
AllowAllParametersOfDeclarationOnNextLine: false
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;2.1.2 Java&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://google.github.io/styleguide/javaguide.html"&gt;Google Java Style Guide&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.jetbrains.com/idea/"&gt;IDE - Jetbrains IDEA&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;ä¸‹è½½ä»£ç é£æ ¼å®šä¹‰æ–‡ä»¶ï¼š&lt;a href="https://raw.githubusercontent.com/google/styleguide/gh-pages/intellij-java-google-style.xml"&gt;intellij-java-google-style.xml&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å¯¼å…¥ IDEA
&lt;img alt="" src="https://s2.loli.net/2023/04/05/IZHhXTGDQnqiPAl.jpg"&gt;&lt;/li&gt;
&lt;li&gt;å®‰è£… Save Actions æ’ä»¶&lt;/li&gt;
&lt;li&gt;é…ç½® Save Actions æ’ä»¶
&lt;img alt="" src="https://s2.loli.net/2023/04/05/iHYtmc7Lah1OXEs.jpg"&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;2.1.3 Python&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Python 3 + &lt;a href="https://docs.python.org/3/library/venv.html"&gt;venv è™šæ‹Ÿç¯å¢ƒ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://google.github.io/styleguide/pyguide.html"&gt;Google Python Style Guide&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä»£ç è§„èŒƒ/é£æ ¼æ£€æŸ¥å·¥å…·ï¼š&lt;a href="https://pylint.pycqa.org/en/latest/"&gt;pylint&lt;/a&gt;ã€&lt;a href="https://google.github.io/styleguide/pyguide.html#21-lint"&gt;https://google.github.io/styleguide/pyguide.html#21-lint&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;Vim é›†æˆï¼š&lt;a href="https://github.com/vim-syntastic/syntastic"&gt;vim-syntastic/syntastic: Syntax checking hacks for vim (github.com)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;VS Code é›†æˆï¼š&lt;a href="https://code.visualstudio.com/docs/python/linting#_pylint"&gt;Linting Python in Visual Studio Code&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;PyCharm æ’ä»¶ï¼š&lt;a href="https://plugins.jetbrains.com/plugin/11084-pylint"&gt;Pylint - IntelliJ IDEA &amp;amp; PyCharm Plugin | Marketplace (jetbrains.com)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä»£ç æ ¼å¼åŒ–å·¥å…·ï¼š&lt;a href="https://github.com/google/yapf/"&gt;yapf&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;Vim é›†æˆï¼š&lt;a href="https://github.com/google/yapf/tree/main/plugins#vim"&gt;https://github.com/google/yapf/tree/main/plugins#vim&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;VS Code é›†æˆï¼š&lt;a href="https://code.visualstudio.com/docs/python/editing#_formatting"&gt;Editing Python Code in Visual Studio Code&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;PyCharm é›†æˆï¼š&lt;a href="https://github.com/google/yapf/issues/631"&gt;How do I install yapf in pycharm Â· Issue #631 Â· google/yapf (github.com)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;2.2 ä»£ç åˆ†æ”¯ç®¡ç†&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;å…±è¯†ï¼šä¸€ä¸ªä»£ç åº“ä¸€ä¸ªä¸»åˆ†æ”¯ï¼›æ‰€æœ‰å¼€å‘åˆ†æ”¯åœ¨æµ‹è¯•/å®éªŒéªŒè¯ä¹‹åéƒ½éœ€è¦åˆå…¥ä¸»åˆ†æ”¯&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ï¼ˆå¼ºåˆ¶ï¼‰åŸºæœ¬çš„ git å·¥ä½œæµï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯é¡¹å¼€å‘å·¥ä½œï¼Œéƒ½ä»ä¸»åˆ†æ”¯ç­¾å‡ºä¸€ä¸ªï¼ˆå…¬å…±ï¼‰å¼€å‘åˆ†æ”¯&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯å¤šäººåä½œçš„å¼€å‘å·¥ä½œï¼Œåˆ™åŸºäºæ–°ç­¾å‡ºçš„å…¬å…±å¼€å‘åˆ†æ”¯ï¼Œæ¯ä¸ªäººå„è‡ªç­¾å‡ºä¸ªäººçš„å¼€å‘åˆ†æ”¯ï¼Œè¿›è¡Œç‹¬ç«‹å¼€å‘&lt;/li&gt;
&lt;li&gt;ä¸ªäººå¼€å‘è‡ªæµ‹å®Œæˆåï¼Œåˆå…¥å…¬å…±å¼€å‘åˆ†æ”¯ï¼Œè¿›è¡Œé›†æˆæµ‹è¯•è”è°ƒ&lt;/li&gt;
&lt;li&gt;å¦‚æœèµ°å®éªŒæµç¨‹ï¼Œåˆ™ä½¿ç”¨ï¼ˆå…¬å…±ï¼‰å¼€å‘åˆ†æ”¯çš„ sandbox é•œåƒéƒ¨ç½²å®éªŒé›†ç¾¤&lt;/li&gt;
&lt;li&gt;å®éªŒæ¨å…¨åè½¬ä¸‹çº¿åï¼Œï¼ˆå…¬å…±ï¼‰å¼€å‘åˆ†æ”¯åˆå…¥ä¸»åˆ†æ”¯ï¼Œå¹¶åŸºäºä¸»åˆ†æ”¯ä¸Šçš„æ­£å¼ tag é•œåƒå‘å¸ƒåŸºå‡†é›†ç¾¤&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ï¼ˆå»ºè®®ï¼‰åˆ†æ”¯å‘½åè§„èŒƒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ï¼ˆå…¬å…±ï¼‰å¼€å‘åˆ†æ”¯ï¼š&lt;ul&gt;
&lt;li&gt;å¸¸è§„éœ€æ±‚å¼€å‘åˆ†æ”¯ï¼šfeature/[ç›®æ ‡æœåŠ¡å]-[æ–‡æ¡£ ID]&lt;/li&gt;
&lt;li&gt;ç´§æ€¥éœ€æ±‚å¼€å‘åˆ†æ”¯ï¼šurgent/[ç›®æ ‡æœåŠ¡å]-[æ–‡æ¡£ ID]&lt;/li&gt;
&lt;li&gt;ç´§æ€¥ä¿®å¤å¼€å‘åˆ†æ”¯ï¼šhotfix/[ç›®æ ‡æœåŠ¡å]-[æ–‡æ¡£ ID]&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¸ªäººå¼€å‘åˆ†æ”¯ï¼šåœ¨ï¼ˆå…¬å…±ï¼‰å¼€å‘åˆ†æ”¯åå¸¦ä¸Šä¸ªäºº IDï¼Œç¤ºä¾‹ï¼šfeature/[ç›®æ ‡æœåŠ¡å]-[æ–‡æ¡£ ID]-[ä¸ªäºº ID]&lt;/li&gt;
&lt;li&gt;å¯¹ç´§æ€¥éœ€æ±‚å’Œç´§æ€¥ä¿®å¤å¼€å‘åˆ†æ”¯ï¼Œå¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ªæ–‡æ¡£ï¼Œæ‹¿åˆ°æ–‡æ¡£ IDï¼Œå†…å®¹å¯èƒ½æ¥ä¸åŠå†™å¾—éå¸¸å®Œå–„ï¼Œä½†ä¹‹ååº”è¯¥è¿›è¡Œè¡¥å……å®Œå–„&lt;/li&gt;
&lt;li&gt;ä¸ç¬¦åˆè§„èŒƒçš„å¼€å‘åˆ†æ”¯ï¼Œä¸èƒ½æ¨é€åˆ°è¿œç¨‹ä»£ç åº“ï¼ˆä¸èƒ½å¯¹å›¢é˜Ÿå…¶ä»–äººå¯è§ï¼‰ï¼Œé€šè¿‡ git hook æ¥å¼ºè¡Œé™åˆ¶&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ï¼ˆå»ºè®®ï¼‰æ‰€æœ‰ï¼ˆå…¬å…±ï¼‰å¼€å‘åˆ†æ”¯ã€ï¼ˆéœ€è¦ä»£ç è¯„å®¡çš„ï¼‰ä¸ªäººå¼€å‘åˆ†æ”¯ï¼Œéƒ½åº”è¯¥åˆ›å»ºå¯¹åº”çš„ MRï¼Œé‚€è¯·å…¶ä»–äººè¿›è¡Œä»£ç è¯„å®¡æ—¶ï¼Œæä¾›å¯¹åº”çš„ MR&lt;/p&gt;
&lt;h3&gt;2.3 Commit è§„èŒƒ&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://www.conventionalcommits.org/zh-hans/v1.0.0/"&gt;çº¦å®šå¼æäº¤ (conventionalcommits.org)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ï¼ˆå»ºè®®ï¼‰å‚è€ƒ Apache é¡¶çº§é¡¹ç›®çš„å®è·µï¼ˆå¦‚ apache/arrowï¼‰ï¼Œcommit log çš„â€œæè¿°â€éƒ¨åˆ†å…ˆå¸¦ä¸Šæ–‡æ¡£é“¾æ¥ã€‚&lt;/p&gt;
&lt;h3&gt;2.4 MR ä¸ä»£ç è¯„å®¡&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;å…±è¯†ï¼šè´¨é‡æŠŠå…³ã€ç»éªŒä¼ æ‰¿&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä»å›¢é˜Ÿå’Œé•¿è¿œæ¥çœ‹ï¼ŒCode Review çš„é‡è¦æ€§å†æ€ä¹ˆå¼ºè°ƒéƒ½ä¸ä¸ºè¿‡ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰æ¯ä¸ªå¼€å‘åˆ†æ”¯çš„å·¥ä½œåœ¨å¼€å®éªŒæˆ–è€…åˆå…¥ä¸»åˆ†æ”¯ä¹‹å‰ï¼Œéƒ½éœ€è¦é‚€è¯·è‡³å°‘ 3 åèµ„æ·±åŒå­¦è¿›è¡Œ Code Review&lt;/li&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰è¯„å®¡å‘˜åœ¨ç¡®è®¤æ²¡æœ‰æ„è§æˆ–è€…æ‰€æœ‰ä¼˜åŒ–æ„è§éƒ½å·²å¾—åˆ°åˆç†è§£å†³åå¯¹ MR è¿›è¡Œç‚¹èµ ğŸ‘&lt;/li&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰å¼€å‘åˆ†æ”¯/MR éœ€è¦æ”’ 3 ä¸ªä»¥ä¸Šçš„ç‚¹èµæ‰èƒ½å¼€å®éªŒæµé‡æˆ–è€…åˆå…¥ä¸»åˆ†æ”¯&lt;/li&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰å¯¹äºåŸºäºåˆ†æ”¯å¼€å®éªŒæµé‡çš„åˆ†æ”¯ä»£ç ï¼Œä¹Ÿå¿…é¡»ç» code review åï¼ŒåŸºäºåˆ†æ”¯è¿›è¡Œæ‰“å®éªŒ tagï¼Œå¹¶åŸºäºå®éªŒ tag è¿›è¡Œçº¿ä¸Šå‘å¸ƒã€‚&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰é€‚å½“çº¦æŸåˆ†æ”¯åˆå…¥æƒé™ï¼Œä»…èµ„æ·±åŒå­¦ï¼ˆå…·ä½“åå•ï¼Ÿï¼‰æ‰èƒ½å°†å¼€å‘åˆ†æ”¯/MR åˆå…¥ä¸»åˆ†æ”¯&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;å˜æ›´åº”è¯¥ç»„ç»‡æˆ1ä¸ªæˆ–å¤šä¸ªè¡¥ä¸/MRï¼Œè§†å˜æ›´å¤§å°è€Œå®šï¼Œç»„ç»‡æ–¹å¼éµå¾ªä»¥ä¸‹è§„èŒƒæŒ‡å—ï¼š
&lt;span style="color: #0000ff"&gt;-&lt;/span&gt; MR åº”è¯¥å°ä¸€ç‚¹
&lt;span style="color: #0000ff"&gt;-&lt;/span&gt; MR åº”è¯¥éƒ½å¯ä»¥ç‹¬ç«‹ç¼–è¯‘å¹¶ä¸”æ˜¯æ­£ç¡®çš„ï¼ˆæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹éƒ½é€šè¿‡ï¼‰ã€‚ä¸éœ€è¦ä½ éªŒè¯è¿™ä¸€ç‚¹ï¼Œä½†æ˜¯éœ€è¦åœ¨ä»£ç ä¸­æ”¾å…¥ä¸€ç§æ ‡è®°æ¥åæ˜  MR æ˜¯å¦è¿åäº†è¿™æ¡è§„åˆ™ã€‚ä¾‹å¦‚ï¼šåœ¨ fix ä¸€ä¸ªé—®é¢˜ä¹‹å‰ï¼Œå…ˆå¼•å…¥ä¸€ä¸ªå›å½’æµ‹è¯•ç”¨ä¾‹ç”¨ä¾‹ã€‚
&lt;span style="color: #0000ff"&gt;-&lt;/span&gt; MR åº”è¯¥è‡ªåŒ…å«ï¼ˆé«˜å†…èšï¼‰ï¼Œå¹¶ä¸”åªåšä¸€ä»¶äº‹æƒ…ã€‚
&lt;span style="color: #0000ff"&gt;-&lt;/span&gt; æ¯ä¸ª MR éƒ½åº”è¯¥åŒ…å«ä¸€ä»½æè¿°æ€§çš„æäº¤æ—¥å¿—ï¼ˆcommit logï¼‰ã€‚
&lt;span style="color: #0000ff"&gt;-&lt;/span&gt; MR çš„æè¿°ä¿¡æ¯ä¸åº”è¯¥å‡è®¾ä»£ç è¯„å®¡äººæ˜¯ä¸€ä¸ªä¸“å®¶ã€‚å®ƒåº”è¯¥åŒ…å«è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œç¡®ä¿å³ä½¿ä¸€ä¸ªæ™®é€šçš„å°ç™½ä¹Ÿèƒ½ç†è§£ã€‚
&lt;span style="color: #0000ff"&gt;-&lt;/span&gt; MR çš„æè¿°ä¿¡æ¯åº”è¯¥è‡ªåŒ…å«ï¼Œä¹Ÿä¸è¦å¼•ç”¨æ— æ³•ä¿æŒå…³è”çš„è®¨è®ºä¿¡æ¯ï¼ˆâ€œå¦‚æ¯æ—¥æ²Ÿé€šè¾¾æˆçš„ä¸€è‡´ç»“è®ºâ€ï¼‰ã€‚
&lt;span style="color: #0000ff"&gt;-&lt;/span&gt; MR åº”è¯¥åŒ…å«å˜æ›´çš„åŠ¨æœºï¼ˆèƒŒæ™¯ï¼‰ã€‚ä¸èƒ½ç®€å•åœ°è¯´ä¸€å¥â€œè®© X å®Œæˆ Yâ€ï¼Œè€Œåº”è¯¥ä»”ç»†è§£é‡Šä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšã€‚ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦é™„ï¼š&lt;a href="https://google.github.io/eng-practices/"&gt;Google Engineering Practices Documentation&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;2.5 CI çº¦æŸ&lt;/h3&gt;
&lt;p&gt;å› å½“å‰ä¸€ä¸ªä»£ç åº“æ”¯æŒäº§å‡ºä¸åŒæœåŠ¡çš„äºŒè¿›åˆ¶ç¨‹åºå’Œ Docker é•œåƒï¼Œä¸ºåŠ é€Ÿ CIï¼Œä½¿ç”¨äº†æ¡ä»¶ç¼–è¯‘ï¼Œæ ¹æ®ä¸åŒæ¡ä»¶è§¦å‘ä¸åŒ CI æµæ°´çº¿ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ ¹æ®åˆ†æ”¯åçš„ç›®æ ‡æœåŠ¡åå¯¹åº”è§¦å‘ä¸åŒ CI æµæ°´çº¿ï¼ˆall åˆ™è§¦å‘æ‰€æœ‰çš„ CI æµæ°´çº¿ï¼‰&lt;/li&gt;
&lt;li&gt;MR åˆå…¥ master åˆ†æ”¯æ—¶ï¼Œå¿…é¡»è§¦å‘æ‰€æœ‰ CI æµæ°´çº¿ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;åŸºäº .gitlab-ci.yml é…ç½®å¼ºè¡Œçº¦æŸã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h3&gt;2.6 ç‰ˆæœ¬ Tag è§„èŒƒ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ­£å¼tag&lt;ul&gt;
&lt;li&gt;åªèƒ½åœ¨ master åˆ†æ”¯ä¸Šæ‰“ tagï¼Œtag å‘½åè§„èŒƒä¸º vä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·ï¼ŒåŸºäº è¯­ä¹‰åŒ–ç‰ˆæœ¬&lt;/li&gt;
&lt;li&gt;tag å†…å®¹å¿…é¡»åŒ…å«å¿…è¦çš„æè¿°æ€§ä¿¡æ¯ï¼Œå£°æ˜æ­¤æ¬¡å˜æ›´çš„å†…å®¹ï¼ŒåŒ…å«ç›¸å…³çš„ MRã€æ–‡æ¡£é“¾æ¥&lt;/li&gt;
&lt;li&gt;hotfix ç‰ˆæœ¬ tagï¼Œåº”è¯¥ä»¥ fix ä¹‹å‰çš„ tag ä¸ºå‰ç¼€ï¼ŒåŠ ä¸Šâ€œ-hotfixâ€ åç¼€ï¼Œç¤ºä¾‹ï¼šv10.0.1-hotfixï¼›å¦‚æœå¯¹åŒä¸€ä¸ª tag çš„ä»£ç å‘ç”Ÿäº†ä¸åªä¸€æ¬¡ hotfixï¼Œåˆ™ç»§ç»­è¡¥å……ä¸Šç§’çº§çš„æ—¶é—´æˆ³ä½œä¸ºåç¼€&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å®éªŒtag&lt;ul&gt;
&lt;li&gt;åœ¨åˆ†æ”¯ä¸Šæ‰“tagè¿›è¡Œçº¿ä¸Šå®éªŒå¼€é‡ï¼Œtagå‘½åè§„èŒƒï¼šexp.æ–‡æ¡£ç¼–å·.è¿­ä»£ç‰ˆæœ¬å·ï¼Œç¤ºä¾‹ï¼šexp.w88.0&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;2.7 ç›‘æ§æ‰“ç‚¹å’Œæ—¥å¿—&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;å…±è¯†ï¼šä»¥å°½å¯èƒ½å°çš„æ€§èƒ½å¼€é”€æœ€å¤§åŒ–ç³»ç»Ÿçš„å¯è§‚æµ‹æ€§&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰å¤šä½¿ç”¨ ROC æ‰“ç‚¹ï¼Œå€ŸåŠ©å¤šç»´æ•°æ®åˆ†æï¼Œæ–¹ä¾¿é—®é¢˜å®šä½åˆ†æ&lt;/li&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰æ³¨æ„æ—¥å¿—çº§åˆ«ï¼ˆDEBUGã€INFOã€ERRORã€FATALï¼‰çš„è¯­ä¹‰&lt;ul&gt;
&lt;li&gt;ä¸è¦ä½¿ç”¨é DEBUG çº§åˆ«æ¥è¾“å‡º DEBUG æ—¥å¿—&lt;/li&gt;
&lt;li&gt;æ³¨æ„ FATAL çš„å®é™…å½±å“&lt;/li&gt;
&lt;li&gt;ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„æ—¥å¿—çº§åˆ«ï¼Œç”Ÿäº§ç¯å¢ƒä¸è¦è¾“å‡º DEBUG æ—¥å¿—ï¼Œhttps://github.com/google/glog#setting-flags &lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰ä½¿ç”¨ glog vlog æ¥è¿›ä¸€æ­¥æ§åˆ¶ä¸åŒç¯å¢ƒ/åœºæ™¯ä¸‹çš„æ—¥å¿—é‡ï¼Œhttps://github.com/google/glog#verbose-logging&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰ä¸è¦é»˜é»˜åœ°å¤±è´¥&lt;ul&gt;
&lt;li&gt;ERROR/WARNING æ—¥å¿—&lt;/li&gt;
&lt;li&gt;Event æ‰“ç‚¹&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰ä½¿ç”¨ Event æ‰“ç‚¹å……åˆ†è¡¨ç°è¾“å…¥é‡ã€è¾“å…¥ç±»å‹ã€è¾“å‡ºé‡ã€å˜åŒ–è¶‹åŠ¿&lt;ul&gt;
&lt;li&gt;è¯·æ±‚ QPSã€å¢é‡æ¶ˆæ¯ TPSã€ä¸åŒç±»å‹å¢é‡æ¶ˆæ¯çš„ TPSã€ã€‚ã€‚ã€‚&lt;/li&gt;
&lt;li&gt;åŸºå‡†æ•°æ®çš„ç»Ÿè®¡è®¡æ•°&lt;/li&gt;
&lt;li&gt;è¯·æ±‚æ¥æºï¼šå®¢æˆ·ç«¯ç±»å‹ç²’åº¦ã€å®¢æˆ·ç«¯ ip ç²’åº¦ã€åœºæ™¯ç»´åº¦ã€åª’ä½“ç»´åº¦ã€ã€‚ã€‚ã€‚&lt;/li&gt;
&lt;li&gt;trigger æ•°ã€å„ç±»è¿‡æ»¤å™¨æ•°ç›®ç»Ÿè®¡&lt;/li&gt;
&lt;li&gt;æ£€ç´¢ç»“æœæ•°é‡ã€æˆªæ–­å/å®é™…è¿”å›ç»™å®¢æˆ·ç«¯çš„ç»“æœæ•°é‡&lt;/li&gt;
&lt;li&gt;å„ç±»è¿‡æ»¤å™¨çš„è¿‡æ»¤é‡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰ä½¿ç”¨ Transaction è¡¨ç°è€—æ—¶åˆ†å¸ƒ - æ•´ä½“è€—æ—¶å¤šå°‘ã€æ—¶é—´éƒ½èŠ±åœ¨å“ªäº›ç¯èŠ‚ï¼ˆåŒ…æ‹¬ RPC æ¡†æ¶å†…çš„ç­‰å¾…æ—¶å»¶ï¼‰ï¼šTt = T1 + T2 + ...&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰ä½¿ç”¨ Metric è¡¨ç°è·¨èŠ‚ç‚¹/é›†ç¾¤/åœºæ™¯çš„ä¸šåŠ¡æŒ‡æ ‡å˜åŒ–è¶‹åŠ¿&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰æ€§èƒ½è€ƒè™‘ï¼Œæ‰“ç‚¹æ¥å£è°ƒç”¨æ¬¡æ•°åº”å°äºç­‰äºè¯·æ±‚ QPSã€æ¶ˆæ¯ TPS&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;2.8 æœ€ä½³å®è·µ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰å°½æ—©ä¸¥æ ¼æ£€æµ‹è¯·æ±‚ã€æ•°æ®ã€é…ç½®ç­‰è¾“å…¥çš„åˆæ³•æ€§&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰å°½é‡ä¸ä½¿ç”¨é…ç½®ä¸­å¿ƒçš„é…ç½®ç›‘å¬&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰å¤šäº†è§£ä½¿ç”¨åŸºç¡€åº“ - boostã€abseil-cpp ç­‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;ä¸‰ã€æµ‹è¯•&lt;/h2&gt;
&lt;h3&gt;3.1 å•å…ƒæµ‹è¯•&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ˜ç¡®å•å…ƒæµ‹è¯•ä¸é›†æˆæµ‹è¯•çš„åŒºåˆ«ï¼Œ&lt;a href="https://zh.wikipedia.org/wiki/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"&gt;å•å…ƒæµ‹è¯• - ç»´åŸºç™¾ç§‘ï¼Œè‡ªç”±çš„ç™¾ç§‘å…¨ä¹¦ (wikipedia.org)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å•å…ƒæµ‹è¯•çš„ä½œç”¨ï¼š&lt;ul&gt;
&lt;li&gt;éªŒè¯æŸä¸ªé€»è¾‘çš„å½“å‰å®éªŒæ˜¯å¦ç¬¦åˆé¢„æœŸ&lt;/li&gt;
&lt;li&gt;æ›´é‡è¦çš„æ˜¯å¯¹ä»¥åçš„ä»£ç å˜æ›´å¯èƒ½é€ æˆçš„éé¢„æœŸå½±å“/ç ´åè¿›è¡Œä¸€å®šçš„é˜²å¾¡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;GoogleTestï¼Œç”¨å¥½ Mocking&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ï¼ˆå¼ºåˆ¶ï¼‰CI å¼ºåˆ¶è¦æ±‚æ–°å¢/å˜æ›´ä»£ç çš„æµ‹è¯•è¦†ç›–ç‡ã€‚ï¼ˆåŸºäº .gitlab-ci.yml é…ç½®å¼ºè¡Œçº¦æŸï¼Ÿï¼‰&lt;/p&gt;
&lt;h3&gt;3.2 é›†æˆæµ‹è¯•&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰ä»»ä½•ä»£ç å˜æ›´ï¼Œéƒ½å¿…é¡»ç»è¿‡è‡ªæµ‹/é›†æˆæµ‹è¯•&lt;ul&gt;
&lt;li&gt;ä»»åŠ¡å¯ä»¥æ­£å¸¸è·‘èµ·æ¥ï¼Œå˜æ›´çš„é€»è¾‘å·²ç”Ÿæ•ˆï¼Œäº§å‡ºçš„ç»“æœç¡®è®¤ç¬¦åˆé¢„æœŸ&lt;/li&gt;
&lt;li&gt;æœåŠ¡å¯ä»¥æ­£å¸¸è¿è¡Œèµ·æ¥ï¼Œå˜æ›´çš„é€»è¾‘å·²ç”Ÿæ•ˆï¼Œå¯ä»¥æ­£å¸¸åŠ è½½æ•°æ®/ç´¢å¼•ï¼Œè¯·æ±‚å“åº”çš„ç»“æœç¡®è®¤ç¬¦åˆé¢„æœŸ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰æµ‹è¯•ç¯å¢ƒ/å·¥å…·&lt;ul&gt;
&lt;li&gt;ç‹¬ç«‹çš„æµ‹è¯•éªŒè¯é›†ç¾¤&lt;/li&gt;
&lt;li&gt;å¼€å‘æœºç¯å¢ƒä¸‹çš„ Docker ç¯å¢ƒ + ä»£ç åº“ä¸­çš„ Dockerfile&lt;ul&gt;
&lt;li&gt;docker build -t image-name .&lt;/li&gt;
&lt;li&gt;docker run -dp 8003:8003 image-name&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ˜“ç”¨çš„è„šæœ¬ - ä¸€é”®å¯åŠ¨+ç´¢å¼•æ•°æ®åŠ è½½ã€æ˜“ç”¨çš„å®¢æˆ·ç«¯å·¥å…·ã€æ˜“ç”¨çš„æ•°æ®æ ¡éªŒå·¥å…·&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;3.3 æ‰¹é‡ Diff æµ‹è¯•&lt;/h3&gt;
&lt;p&gt;ï¼ˆå¼ºåˆ¶ï¼‰å¦‚æœä»£ç å˜æ›´å½±å“äº†ç´¢å¼•æˆ–è€…æ£€ç´¢é€»è¾‘ï¼Œåˆ™åº”è¯¥è¿›è¡Œå……åˆ†çš„ diffï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœèµ°å®éªŒï¼Œåˆ™éƒ¨ç½²æ–°å®éªŒé›†ç¾¤åå¼€å®éªŒä¹‹å‰ï¼Œè¿›è¡Œ åŸºå‡†é›†ç¾¤ VS. å®éªŒé›†ç¾¤ çš„è¯·æ±‚ç»“æœ diff&lt;/li&gt;
&lt;li&gt;å¦‚æœä¸èµ°å®éªŒï¼Œåˆ™åŸºäºç‹¬ç«‹çš„æµ‹è¯•éªŒè¯é›†ç¾¤ï¼Œè¿›è¡Œ ç”Ÿäº§é›†ç¾¤ VS. æµ‹è¯•é›†ç¾¤ çš„è¯·æ±‚ç»“æœ diff&lt;ul&gt;
&lt;li&gt;diff å®Œæˆåï¼Œå³åˆ»é‡Šæ”¾æµ‹è¯•é›†ç¾¤èµ„æº&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¯¹äº diff ç»“æœï¼Œä¸ç®¡æœ€åçš„ diff ç‡æœ‰å¤šå°ï¼Œåªè¦æœ‰ diffï¼Œå°±éœ€è¦ç¡®è®¤ diff æ¥æº/åŸå› æ˜¯å¦ç¬¦åˆé¢„æœŸ&lt;/li&gt;
&lt;li&gt;diff çš„ä¸åŒè¯·æ±‚æ•°é‡å¿…é¡»è¾¾åˆ° 1000 ä»¥ä¸Š&lt;/li&gt;
&lt;li&gt;ç»Ÿä¸€ä½¿ç”¨æ˜“ç”¨ä¸”åŠŸèƒ½å®Œå–„çš„ diff å·¥å…·&lt;/li&gt;
&lt;li&gt;ç”Ÿäº§é›†ç¾¤å‘ç‰ˆæˆ–è€…å®éªŒé›†ç¾¤å¼€æµé‡ä¹‹å‰ï¼Œåœ¨å‘¨çŸ¥ç›¸å…³äººå‘˜æ—¶ï¼Œå¿…é¡»ä¸€å¹¶æä¾› diff ç»“æœä»¥åŠå·²ç¡®è®¤ diff æ¥æºç¬¦åˆé¢„æœŸ&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;å››ã€å‘å¸ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰æµé‡é«˜å³°æœŸä¸å‘ç‰ˆ&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰å‘¨äº”æ™šä¸ŠåŠå‘¨æœ«ä¸å‘ç‰ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;4.1 å‘å¸ƒä¹‹å‰&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰è¯„ä¼°ç¡®è®¤å¥½æœ¬æ¬¡å‘å¸ƒå‰åæœåŠ¡é›†ç¾¤è´Ÿè½½æ˜¯å¦ä¼šæœ‰å˜åŒ–ï¼Œå¦‚æœå˜æ›´ä¼šå½±å“é›†ç¾¤è´Ÿè½½ä¸Šæ¶¨ï¼Œåˆ™åº”æå‰æ‰©å®¹&lt;/li&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰åœ¨ç›¸å…³å¤§ç¾¤å†…è¿›è¡Œé€šå‘Šï¼Œé€šå‘Šæ¨¡æ¿å¦‚ä¸‹ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;å˜æ›´é€šçŸ¥ï¼š
- å˜æ›´å†…å®¹ï¼šxxxx
- æ¶‰åŠé›†ç¾¤å’Œåœºæ™¯ï¼šxxx
- æ“ä½œäººï¼šxxx
- ç›¸å…³æ–‡æ¡£ï¼ˆå«éœ€æ±‚èƒŒæ™¯ã€å·¥ç¨‹æ–¹æ¡ˆã€ä»£ç  MRã€diff / æµ‹è¯•æŠ¥å‘Šç­‰ä¿¡æ¯ï¼‰ æˆ– å®éªŒé“¾æ¥ï¼šxxx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;4.2 å‘å¸ƒæœŸé—´&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰å…ˆç°åº¦å‘å¸ƒä¸€è¡Œæˆ–è€…å°‘é‡è¡Œï¼Œç¡®è®¤å„é¡¹å·¥ç¨‹æŒ‡æ ‡+ä¸šåŠ¡æŒ‡æ ‡æ— å¼‚å¸¸åï¼Œå†å…¨é‡å‘å¸ƒ&lt;/li&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰å‘å¸ƒæœŸé—´éœ€è¦ä¿æŒå…³æ³¨å‘Šè­¦ä»¥åŠå…³é”®å·¥ç¨‹æŒ‡æ ‡å’Œä¸šåŠ¡æŒ‡æ ‡&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;4.3 å‘å¸ƒä¹‹å&lt;/h3&gt;
&lt;p&gt;ï¼ˆå¼ºåˆ¶ï¼‰å‘ç‰ˆå®Œæˆåï¼Œç¡®è®¤å„é¡¹å·¥ç¨‹æŒ‡æ ‡/ä¸šåŠ¡æŒ‡æ ‡æ­£å¸¸åï¼Œåœ¨ç›¸å…³å¤§ç¾¤å†…å‘¨çŸ¥å‘ç‰ˆå®Œæˆï¼Œç¡®è®¤å„é¡¹æŒ‡æ ‡å¹³ç¨³/ç¬¦åˆé¢„æœŸ&lt;/p&gt;
&lt;h2&gt;äº”ã€å®éªŒ&lt;/h2&gt;
&lt;h3&gt;5.1 å®éªŒå¼€é‡ä¹‹å‰&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰äººå·¥åˆ· demoï¼Œå…¨é“¾è·¯éªŒè¯&lt;/li&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰å®éªŒé›†ç¾¤èµ„æºé¢„ä¼°å‡†å¤‡ï¼ŒåŒ…æ‹¬è¯„ä¼°é“¾è·¯ä¸­é—´ç¯èŠ‚èµ„æºè´Ÿè½½å˜åŒ–&lt;/li&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰åœ¨ç›¸å…³å¤§ç¾¤å†…é€šå‘Šï¼Œé€šå‘Šä¿¡æ¯ï¼šå®éªŒåã€å®éªŒé“¾æ¥&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;5.2 å®éªŒæœŸé—´&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰å®éªŒåˆšå¼€é‡æ—¶ï¼Œå…³æ³¨å®æ—¶æŠ¥è¡¨ 10~30 åˆ†é’Ÿå˜åŒ–è¶‹åŠ¿ï¼š&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰æ¯å¤©åŠæ—¶æŸ¥çœ‹å®éªŒå¹³å°ä¸Šå½“å‰å®éªŒçš„å¤©çº§å®éªŒæŠ¥è¡¨ï¼Œå¦‚æœæœ‰è¾ƒæ˜æ˜¾çš„è´Ÿå‘æŒ‡æ ‡ï¼Œåˆ™åº”åŠæ—¶é€šå‘Šå‡ºæ¥ï¼Œä¸ç›¸å…³åŒå­¦ä¸€èµ·åˆ†æå¯èƒ½çš„åŸå› &lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;5.3 å®éªŒæ‰©é‡æˆ–æ¨å…¨ä¹‹å‰&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰å®éªŒé›†ç¾¤èµ„æºé¢„ä¼°å‡†å¤‡ï¼ŒåŒ…æ‹¬è¯„ä¼°é“¾è·¯ä¸­é—´ç¯èŠ‚èµ„æºè´Ÿè½½å˜åŒ–&lt;/li&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰ä¸ç›¸å…³ç®—æ³•åŒå­¦ç¡®è®¤å¥½å®éªŒæ—¶é•¿ä¸å®éªŒæ•ˆæœæ˜¯å¦è¾¾åˆ°æ‰©é‡è¦æ±‚&lt;/li&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰åœ¨ç›¸å…³å¤§ç¾¤å†…é€šå‘Šï¼Œé€šå‘Šä¿¡æ¯ï¼šå®éªŒåã€å®éªŒé“¾æ¥ã€æµé‡ä»å¤šå°‘å˜åŒ–åˆ°å¤šå°‘&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;5.4 å®éªŒæ‰©é‡æˆ–æ¨å…¨æ“ä½œæœŸé—´&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ï¼ˆå¼ºåˆ¶ï¼‰å¯¹å®éªŒé›†ç¾¤è´Ÿè½½æƒ…å†µä¿æŒå…³æ³¨&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰å¯¹äºæ¨å…¨æ“ä½œï¼Œå°½å¯èƒ½ç°åº¦æ¨å…¨ï¼Œä¸­é—´æ­¥éª¤ç•™ä¸€å®šæ—¶é—´ç¡®è®¤é›†ç¾¤è´Ÿè½½å’Œæµé‡å˜åŒ–æ˜¯å¦ç¬¦åˆé¢„æœŸ&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰å…ˆå¼€åè½¬ï¼Œå†è¿›è¡Œæ¨å…¨ï¼Œé¿å…ä¸å¿…è¦çš„èµ„æºè…¾æŒªæ‰©ç¼©ï¼Œä¹Ÿèƒ½ä¸€å®šç¨‹åº¦ä¸Šæ§åˆ¶é£é™©&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;å…­ã€è§„èŒƒè½åœ°&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰è§„èŒƒæµç¨‹æ”¯æŒå·¥å…·å’Œå¹³å°ä¸æ–­ä¼˜åŒ–ï¼Œå°½å¯èƒ½å‡å°‘è§„èŒƒæµç¨‹é€ æˆçš„äººåŠ›è´Ÿæ‹…&lt;/li&gt;
&lt;li&gt;ï¼ˆå»ºè®®ï¼‰ä¸æ–­æ›´æ–°å®Œå–„è§„èŒƒ&lt;/li&gt;
&lt;/ul&gt;</content><category term="å…¶ä»–"></category><category term="å¼€å‘"></category><category term="æµç¨‹"></category><category term="è§„èŒƒ"></category></entry><entry><title>ä¸ä¸€ä¸ªå‰ leader çš„äº¤æµç¬”è®°</title><link href="http://youngsterxyf.github.io/2022/11/16/talk-about-how-to-do/" rel="alternate"></link><published>2022-11-16T00:00:00+08:00</published><updated>2022-11-16T00:00:00+08:00</updated><author><name>xiayf</name></author><id>tag:youngsterxyf.github.io,2022-11-16:/2022/11/16/talk-about-how-to-do/</id><summary type="html">&lt;p&gt;å¦‚ä¸‹è¿™ä»½ç¬”è®°ï¼Œæ˜¯ 19 å¹´å’Œä¸€ä¸ªå‰ leader äº¤æµåè®°å½•ä¸‹æ¥çš„ã€‚è¯´æ˜¯äº¤æµï¼Œå…¶å®æ˜¯é’ˆå¯¹æˆ‘å½“æ—¶å·¥ä½œä¸­å­˜åœ¨çš„é—®é¢˜ï¼Œä»–ç»™æˆ‘æå‡ºçš„ä¸€äº› â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;å¦‚ä¸‹è¿™ä»½ç¬”è®°ï¼Œæ˜¯ 19 å¹´å’Œä¸€ä¸ªå‰ leader äº¤æµåè®°å½•ä¸‹æ¥çš„ã€‚è¯´æ˜¯äº¤æµï¼Œå…¶å®æ˜¯é’ˆå¯¹æˆ‘å½“æ—¶å·¥ä½œä¸­å­˜åœ¨çš„é—®é¢˜ï¼Œä»–ç»™æˆ‘æå‡ºçš„ä¸€äº›æ”¹è¿›å»ºè®®ã€‚å¦‚ä»Šå†çœ‹çœ‹ï¼Œä»ç„¶èƒ½å¼•èµ·è‡ªå·±çš„æ€è€ƒã€‚&lt;/p&gt;
&lt;h2&gt;2019-10-27&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;å¦‚ä½•è®¨è®ºéœ€æ±‚/æŠ€æœ¯æ–¹æ¡ˆ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç³»ç»Ÿæ€§ç†è§£éœ€æ±‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å…¨é¢æ¢³ç†æŠ€æœ¯æ–¹æ¡ˆï¼Œè®ºè¯æ–¹æ¡ˆçš„ä¸åˆç†ä¹‹å¤„&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚ä½•è¯æ˜æ–¹æ¡ˆä¸åˆç†ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;èµ„æºæˆæœ¬ï¼ˆæœºå™¨ã€äººåŠ›ï¼‰ï¼Œé‡å¤å·¥ä½œä¹Ÿæ˜¯å¯¹èµ„æºçš„ä¸€ç§æµªè´¹&lt;/li&gt;
&lt;li&gt;å¯¹æ•ˆæœï¼ˆæ”¶å…¥ç­‰ï¼‰çš„å½±å“&lt;/li&gt;
&lt;li&gt;è¦ç«™åœ¨â€œå…¬æ­£â€çš„è§’åº¦æ¥è®ºè¯ï¼Œä»å¤§å®¶å…±æœ‰çš„è®¤çŸ¥(æœºå™¨ã€å¸¦å®½ã€å†…å­˜)å‡ºå‘&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ€åæ‰æ˜¯ä»€ä¹ˆç³»ç»Ÿå¤æ‚åº¦ï¼ˆè¯´åˆ°è¿™ä¸ªç‚¹ï¼Œå¾ˆå®¹æ˜“æ‰¯æ·¡ï¼Œè°éƒ½ä¼šè¯´è‡ªå·±å¤æ‚ï¼‰&lt;/p&gt;
&lt;p&gt;è®¨è®ºé—®é¢˜çš„æ—¶å€™ï¼Œè‡ªå·±ä¸åšï¼Œä½†ä¸è¦ä»â€œç¡¬æ¨ç»™åˆ«äººçš„è§’åº¦â€å»è®¨è®ºï¼Œè€Œæ˜¯è¦ä»â€œä¸ºå•¥è‡ªå·±ä¸åº”è¯¥åšâ€çš„è§’åº¦å‡ºå‘ã€‚æ¯”å¦‚åšäº†ï¼Œå¯¼è‡´ç³»ç»Ÿè€¦åˆï¼Œå¤æ‚ï¼Œåšäº†å¯¼è‡´å¤šä½™çš„è°ƒç”¨é‡æ›´å¤šç­‰ ã€‚&lt;/p&gt;
&lt;h2&gt;2019-12-17&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;è·¨å›¢é˜Ÿå·¥ä½œè®¨è®ºæ—¶ï¼Œå›´ç»•åº”è¯¥æ€ä¹ˆåšï¼ˆæ€ä¹ˆåšæœ€åˆç†ï¼‰æ¥è®¨è®ºï¼Œè€Œä¸æ˜¯å›´ç»•å¦‚æœè‡ªå·±æ¥åšä¼šæœ‰ä»€ä¹ˆå›°éš¾æ¥è®¨è®º&lt;/li&gt;
&lt;li&gt;é¡¹ç›®/ç³»ç»Ÿè¦æœ‰ ç›®æ ‡/é•¿è¿œæ¶æ„å›¾ï¼ˆæœ€ç»ˆåšæˆä»€ä¹ˆæ ·å­ï¼Œæ ¸å¿ƒ KPIï¼‰&lt;/li&gt;
&lt;li&gt;åšå¥½å‘ä¸Šæ±‡æŠ¥&lt;/li&gt;
&lt;li&gt;ä¸è¦æ‹¿â€œåšçš„è¿‡ç¨‹ä¸­çš„å›°éš¾â€æ¥æªå¡ä¸åšï¼Œè€Œæ˜¯è¦ä»å®¢è§‚äº‹å®çš„è§’åº¦æ¥é—®åº”ä¸åº”è¯¥åš&lt;/li&gt;
&lt;li&gt;ä¸è¦èšç„¦äºè§£å†³ç°å®ä¸–ç•Œçš„ä¸€ä¸ªä¸ªé—®é¢˜ï¼Œè€Œæ˜¯è¦é å…·ä½“çš„ä¸€ä¸ªä¸ªé—®é¢˜ï¼ŒæŠ½è±¡å‡ºä¸€å¼ å¤§å›¾&lt;/li&gt;
&lt;li&gt;æŠŠè‡ªå·±çš„ç³»ç»Ÿåšæˆé“¾è·¯ä¸Šæœ€æè‡´çš„é‚£ä¸ªï¼Œè€Œä¸æ˜¯ç­‰åˆ«äººåšå¥½åæ¥åæ¨è‡ªå·±å˜é©&lt;/li&gt;
&lt;li&gt;è¦åŒºåˆ†é‡è¦å’Œä¸é‡è¦çš„äº‹æƒ…ï¼Œæ ¸å¿ƒçš„äº‹æƒ…è¦ä»”ç»†æ£æ‘©ï¼Œæ²¡æœ‰äººæ˜¯å‚»å­ï¼Œé‚£äº›èµ„æ·±çš„äººè¯´å‡ºçš„è¯æ›´è¦æ£æ‘©ï¼Œç†è§£&lt;/li&gt;
&lt;li&gt;è¦æœ‰è§„åˆ’å’Œæ„¿æ™¯ï¼Œleader æ²¡æœ‰è¿™äº›ï¼Œå›¢é˜Ÿèµ°ä¸è¿œ&lt;/li&gt;
&lt;/ol&gt;</content><category term="å…¶ä»–"></category><category term="è®¨è®º"></category><category term="æ€è€ƒ"></category><category term="ç²¾è¿›"></category></entry><entry><title>è¯»æ–‡ç¬”è®°ï¼šå…³äº MMAP ä¸ SSD</title><link href="http://youngsterxyf.github.io/2022/09/14/reading-about-mmap-ssd/" rel="alternate"></link><published>2022-09-14T00:00:00+08:00</published><updated>2022-09-14T00:00:00+08:00</updated><author><name>xiayf</name></author><id>tag:youngsterxyf.github.io,2022-09-14:/2022/09/14/reading-about-mmap-ssd/</id><summary type="html">&lt;p&gt;è®¾è®¡ä¸€ç§å­˜å‚¨ï¼Œç¬¬ä¸€è¦æ˜ç¡®åº”ç”¨åœºæ™¯å’Œå­˜å‚¨ç³»ç»Ÿçš„å·¥ä½œè´Ÿè½½ï¼Œç¬¬äºŒè¦äº†è§£åº•å±‚ç¡¬ä»¶çš„ç‰¹ç‚¹ã€‚&lt;/p&gt;
&lt;h2&gt;1ã€&lt;a href="https://db.cs.cmu.edu/mmap-cidr2022/"&gt;Are You Sure You Want to Use MMAP in Your Database Management â€¦&lt;/a&gt;&lt;/h2&gt;</summary><content type="html">&lt;p&gt;è®¾è®¡ä¸€ç§å­˜å‚¨ï¼Œç¬¬ä¸€è¦æ˜ç¡®åº”ç”¨åœºæ™¯å’Œå­˜å‚¨ç³»ç»Ÿçš„å·¥ä½œè´Ÿè½½ï¼Œç¬¬äºŒè¦äº†è§£åº•å±‚ç¡¬ä»¶çš„ç‰¹ç‚¹ã€‚&lt;/p&gt;
&lt;h2&gt;1ã€&lt;a href="https://db.cs.cmu.edu/mmap-cidr2022/"&gt;Are You Sure You Want to Use MMAP in Your Database Management System? &lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;MMAPï¼ˆMemory-mapped file I/Oï¼‰æ˜¯æ“ä½œç³»ç»Ÿæä¾›çš„ä¸€ç§åŠŸèƒ½ç‰¹æ€§ - å°†äºŒçº§å­˜å‚¨ï¼ˆç£ç›˜ã€SSDï¼‰ä¸Šä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹æ˜ å°„åˆ°ç¨‹åº/è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œç„¶åç¨‹åºå°±å¯ä»¥ä»¥æŒ‡é’ˆè®¿é—®å†…å­˜é¡µçš„æ–¹å¼æ¥è®¿é—®æ–‡ä»¶å†…å®¹ã€‚å½“ç¨‹åºè®¿é—®åˆ°æŸä¸ªå†…å­˜é¡µæ—¶ï¼Œæ“ä½œç³»ç»Ÿå°±ä¼šè‡ªåŠ¨å°†å¯¹åº”æ–‡ä»¶å†…å®¹åŠ è½½åˆ°è¯¥å†…å­˜é¡µä¸­ï¼Œå½“å†…å­˜ç”¨æ»¡äº†ï¼Œä¹Ÿä¼šè‡ªåŠ¨å‰”é™¤æŸäº›å†…å­˜é¡µã€‚&lt;/p&gt;
&lt;p&gt;MMAP å…¶å®å°±ä¸€ä¸ªç°æˆçš„ç¼“å†²æ± ï¼ˆbuffer poolï¼‰ï¼Œæ ¸å¿ƒç‰¹ç‚¹å°±æ˜¯ç®€å•æ˜“ç”¨ï¼Œä¸éœ€è¦é‡å¤å¼€å‘ï¼Œç¼ºç‚¹æ˜¯åœ¨éœ€è¦æ—¶æ— æ³•ç²¾ç¡®æ§åˆ¶å…¶è¡Œä¸ºã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ MMAP çš„ä¼˜åŠ¿æ˜¯ç”±æ“ä½œç³»ç»Ÿå°è£…äº†å¦‚ä¸‹åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»ç£ç›˜è¯»æ•°æ®&lt;/li&gt;
&lt;li&gt;ä¸åŒçº¿ç¨‹è¯»ç›¸åŒæ•°æ®çš„å¹¶å‘å¤„ç†&lt;/li&gt;
&lt;li&gt;ç¼“å­˜å’Œç¼“å†²ç®¡ç†ï¼ˆCaching and buffer managementï¼‰&lt;/li&gt;
&lt;li&gt;ä»å†…å­˜ä¸­å‰”é™¤/é©±é€å†…å­˜é¡µ&lt;/li&gt;
&lt;li&gt;åŒä¸€ä¸ªæœºå™¨ä¸Šä¸åŒè¿›ç¨‹ä¹‹é—´å¯ä»¥å‹å¥½äº¤äº’ ğŸ¤”&lt;/li&gt;
&lt;li&gt;è·Ÿè¸ªè„é¡µä»¥åŠå°†è„é¡µå†™å…¥ç£ç›˜ ğŸ¤”&lt;/li&gt;
&lt;li&gt;ç›¸æ¯” read/write ç³»ç»Ÿè°ƒç”¨ï¼Œmmap ä¸éœ€è¦å°†å†…å­˜é¡µä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼Œè€Œæ˜¯ç›´æ¥ä»æ“ä½œç³»ç»Ÿçš„å†…å­˜é¡µç¼“å­˜ä¸­ç›´æ¥è®¿é—®å†…å­˜é¡µï¼Œæœ‰ä¸€å®šçš„æ€§èƒ½ä¼˜åŠ¿&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;MMAP ç›¸å…³ POSIX APIï¼šmmapã€madviseã€mlockã€msyncã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="https://s2.loli.net/2022/11/16/U7xMgzj36dZDGaO.jpg"&gt;&lt;/p&gt;
&lt;p&gt;â‘  A program calls mmap and receives a pointer to the memory-mapped file contents.&lt;/p&gt;
&lt;p&gt;â‘¡ The OS reserves part of the programâ€™s virtual address space but does not load any part of the file.&lt;/p&gt;
&lt;p&gt;â‘¢ The program accesses the fileâ€™s contents using the pointer.&lt;/p&gt;
&lt;p&gt;â‘£ The OS attempts to retrieve the page.&lt;/p&gt;
&lt;p&gt;â‘¤ Since no valid mapping exists for the specified virtual address, the OS triggers a page fault to load the referenced part of the file from secondary storage into a physical memory page.&lt;/p&gt;
&lt;p&gt;â‘¥ The OS adds an entry to the page table that maps the virtual address to the new physical address.&lt;/p&gt;
&lt;p&gt;â‘¦ The initiating CPU core also caches this entry in its local translation lookaside buffer (TLB) to accelerate future accesses.&lt;/p&gt;
&lt;p&gt;ä¸è¿‡è®ºæ–‡ä½œè€…è®¤ä¸º mmap å­˜åœ¨ä¸€äº›æ•°æ®å®‰å…¨æ€§å’Œç³»ç»Ÿæ€§æ€§èƒ½é—®é¢˜ï¼Œä¸ºè§£å†³è¿™äº›é—®é¢˜è€Œå¼•å…¥çš„å·¥ç¨‹æˆæœ¬ä¼šæŠµæ¶ˆæ‰ç®€å•æ€§ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1ã€äº‹åŠ¡å®‰å…¨æ€§ï¼ˆTransactional Safetyï¼‰&lt;/strong&gt;ï¼šç”±äºé€æ˜çš„é¡µå¼è°ƒåº¦æœºåˆ¶ï¼Œæ“ä½œç³»ç»Ÿå¯èƒ½ä¼šä»»æ„æ—¶åˆ»å°†ä¸€ä¸ªè„é¡µåˆ·åˆ°äºŒçº§å­˜å‚¨ä¸­ï¼Œä¸ç®¡å†™äº‹åŠ¡æ˜¯å¦å·²æäº¤ã€‚DBMS æ— æ³•ç»„ç»‡è¿™ç§å†…å­˜æ•°æ®åˆ·å‡ºï¼Œå¹¶ä¸”å‘ç”Ÿæ—¶ä¹Ÿä¸ä¼šæ¥æ”¶åˆ°ä»»ä½•ä¿¡å·ã€‚æ‰€ä»¥åŸºäº mmap çš„æ•°æ®åº“ç³»ç»Ÿåªèƒ½é‡‡ç”¨å¤æ‚çš„åè®®æ¥ç¡®ä¿ï¼ˆå†™/æ›´æ–°ï¼‰äº‹åŠ¡å®‰å…¨ï¼Œæ‰‹æ®µä¸Šå¤§æ¦‚åˆ†3ç§ï¼šæ“ä½œç³»ç»Ÿå†™æ—¶å¤åˆ¶ã€ç”¨æˆ·ç©ºé—´å†™æ—¶å¤åˆ¶ã€å½±å­é¡µç®¡ç†ï¼ˆshadow pagingï¼‰&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2ã€I/O åœé¡¿ï¼ˆI/O Stallsï¼‰&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;mmap ä¸æ”¯æŒå¼‚æ­¥è¯»ï¼›è‡ªå·±æç¼“å†²æ± çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨å¼‚æ­¥ I/Oï¼ˆæ¯”å¦‚ libaioã€io_uringï¼‰æ¥é¿å…æŸ¥è¯¢æ—¶é˜»å¡çº¿ç¨‹&lt;/li&gt;
&lt;li&gt;å¯¹äº mmapï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨/é€æ˜åœ°å‰”é™¤ä¸€äº›å†…å­˜é¡µï¼Œè¿™æ ·å¯èƒ½å¯¼è‡´ - å¦‚æœæŸäº›åªè¯»æŸ¥è¯¢å‘½ä¸­äº†å·²è¢«å‰”é™¤çš„å†…å­˜é¡µï¼Œå°±ä¼šæ— æ³•é¢„çŸ¥åœ°è§¦å‘é˜»å¡æ€§çš„é¡µé”™è¯¯/ç¼ºé¡µå¤„ç†&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è§£å†³æ–¹æ¡ˆï¼š1ã€ä½¿ç”¨ mlockï¼Œä¸è¿‡æ“ä½œç³»ç»Ÿå¯¹ä¸€ä¸ªè¿›ç¨‹èƒ½é”ä½çš„å†…å­˜é¡µæ•°é‡æœ‰é™åˆ¶ï¼›2ã€ä½¿ç”¨ madvise çš„ MADV_SEQUENTIAL æ ‡è®°ï¼Œä»…èƒ½é—®é¢˜çš„ä¸€éƒ¨åˆ†ï¼›3ã€ä½¿ç”¨é¢å¤–çš„çº¿ç¨‹æ¥è¿›è¡Œå†…å­˜é¡µé¢„å–ï¼Œé¿å…ä¸»çº¿ç¨‹è¢«é˜»å¡ï¼Œä¸è¿‡ä¼šå¼•å…¥è¾ƒå¤§çš„å¤æ‚æ€§&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3ã€é”™è¯¯å¤„ç†&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;DBMS çš„æ ¸å¿ƒèŒè´£ä¹‹ä¸€æ˜¯ç¡®ä¿æ•°æ®å®Œæ•´æ€§ - æ¯”å¦‚ï¼šæ ¡éªŒç£ç›˜æ•°æ®æ˜¯å¦æœ‰æŸå&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ mmapï¼ŒDBMS éœ€è¦åœ¨æ¯æ¬¡å†…å­˜é¡µè®¿é—®æ—¶æ£€æŸ¥æ ¡éªŒå’Œï¼ˆchecksumï¼‰ï¼Œå› ä¸ºå†…å­˜é¡µä¸€æ¬¡è®¿é—®ä¹‹åæ“ä½œç³»ç»Ÿå¯èƒ½ä¼šå°†è¯¥é¡µé©±é€åˆ°ç£ç›˜&lt;/li&gt;
&lt;li&gt;å¦‚æœ DBMS æ˜¯ä½¿ç”¨éå†…å­˜å®‰å…¨çš„ç¼–ç¨‹è¯­è¨€ç¼–å†™çš„ï¼Œå°±æœ‰å¯èƒ½åœ¨æŒ‡é’ˆæ“ä½œæ—¶æŸåå†…å­˜é¡µå†…å®¹ï¼Œæ‰€ä»¥éœ€è¦åœ¨å†…å­˜é¡µåˆ·åˆ°äºŒçº§å­˜å‚¨ä¹‹å‰è¿›è¡Œé”™è¯¯æ£€æµ‹ï¼Œmmap ä¼šé»˜é»˜åœ°å°†æŸåçš„å†…å­˜é¡µæŒä¹…åŒ–åˆ°äºŒçº§å­˜å‚¨&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ mmap ä¹Ÿæ›´éš¾ä¼˜é›…åœ°è¿›è¡Œ I/O é”™è¯¯å¤„ç†ï¼Œå’Œ mmap å†…å­˜äº¤äº’çš„ä»»ä½•ä»£ç éƒ½å¯èƒ½æŠ›å‡º SIGBUS ä¿¡å·ï¼ŒDBMS å¿…é¡»ä½¿ç”¨ä¿¡å·å¤„ç†å™¨ï¼ˆsignal handlersï¼‰æ¥å¤„ç† â“&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;4ã€æ€§èƒ½é—®é¢˜ï¼ˆæœ€é‡å¤§ï¼‰&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¤§å®¶æ™®éè®¤ä¸º mmap æ€§èƒ½ä¼˜äºä¼ ç»Ÿæ–‡ä»¶ I/Oï¼ˆread/writeï¼‰ï¼Œå› ä¸ºå®ƒé¿å…ä¸¤ä¸ªå¼€é”€ï¼š(1) æ˜¾å¼è°ƒç”¨ read/write ç³»ç»Ÿè°ƒç”¨çš„å¼€é”€ (2) mmap ä¼šè¿”å›æŒ‡å‘æ“ä½œç³»ç»Ÿé¡µç¼“å­˜çš„é¡µæŒ‡é’ˆï¼Œå› æ­¤é¿å…äº†åˆ°ç”¨æˆ·å†…å­˜ç©ºé—´çš„ä¸€æ¬¡å†…å­˜æ‹·è´ï¼Œä¹Ÿå› æ­¤é™ä½äº†å†…å­˜å ç”¨ï¼›ç”±æ­¤ï¼Œå¤§å®¶ä¹Ÿè®¤ä¸ºåœ¨ SSD ä¸Š mmap çš„æ€§èƒ½ä¼˜åŠ¿ä¼šè¿›ä¸€æ­¥æ‰©å¤§ã€‚&lt;/li&gt;
&lt;li&gt;ä¸è¿‡å®éªŒæµ‹è¯•å‘ç°ï¼šå¯¹äºé«˜å¸¦å®½çš„äºŒçº§å­˜å‚¨è®¾å¤‡ï¼ˆæ¯”å¦‚ SSDï¼‰ï¼ŒDBMS ç®¡ç†çš„æ•°æ®é‡å¤§äºå†…å­˜ç©ºé—´æ—¶ï¼Œæ“ä½œç³»ç»Ÿçš„é¡µé©±é€æœºåˆ¶ï¼ˆpage eviction mechanismsï¼‰å¤šçº¿ç¨‹æ‰©å±•æ€§æ¯”è¾ƒå·®ï¼ˆå¤‡æ³¨ï¼šå› ä¸º SSD I/O å¸¦å®½å¤§ã€è®¿é—®é€Ÿåº¦å¿«ï¼Œé¡µé©±é€æœºåˆ¶å°±å¯èƒ½æˆäº†ç“¶é¢ˆï¼‰ï¼ˆwe have found that the OSâ€™s page eviction mechanisms cannot scale beyond a few threads for larger-thanmemory DBMS workloads on high-bandwidth secondary storage devices. We believe that one of the main reasons these performance issues have gone largely unnoticed is due to historically limited file I/O bandwidthï¼‰ã€‚ç“¶é¢ˆæºäº3ä¸ªå› ç´ ï¼š&lt;ul&gt;
&lt;li&gt;é¡µè¡¨äº‰ç”¨ï¼ˆpage table contentionï¼‰/ é”ï¼ˆå¤‡æ³¨ï¼šå½“å‰ linux å†…æ ¸å®ç°ä¼˜åŒ–äº†è¿™ä¸ªé—®é¢˜ï¼Œ&lt;a href="https://github.com/torvalds/linux/blob/master/Documentation/mm/split_page_table_lock.rst"&gt;linux/split_page_table_lock.rst at master Â· torvalds/linux (github.com)&lt;/a&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;å•çº¿ç¨‹é¡µé©±é€ï¼ˆsingle-threaded page evictionï¼‰ï¼Œ&lt;a href="https://biriukov.dev/docs/page-cache/4-page-cache-eviction-and-page-reclaim/"&gt;Page Cache eviction and page reclaim | Viacheslav Biriukov&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æ—è·¯è½¬æ¢ç¼“å†²å‡»è½ï¼ˆTLB shootdownsï¼‰ï¼šTLB shootdowns occur during page eviction when a core needs to invalidate mappings in a remote TLB. Whereas flushing the local TLB is inexpensive, issuing interprocessor interrupts to synchronize remote TLBs can take thousands of cycles&lt;ul&gt;
&lt;li&gt;&lt;a href="https://juejin.cn/post/6844904084957315086"&gt;æ·±å…¥ç†è§£ Linux å†…æ ¸--jemalloc å¼•èµ·çš„ TLB shootdown åŠä¼˜åŒ– - æ˜é‡‘ (juejin.cn)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.kernel.org/doc/html/v4.18/core-api/cachetlb.html"&gt;Cache and TLB Flushing Under Linux â€” The Linux Kernel documentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å®éªŒåˆ†æï¼š&lt;/p&gt;
&lt;p&gt;As a baseline, we used the fio storage benchmarking tool (v3.25) with direct I/O (O_DIRECT) to bypass the OS page cache. Our analysis focused exclusively on read-only workloads, which represent the best-case scenario for mmap-based DBMSs.&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="https://s2.loli.net/2022/11/16/FlAJqH8E4K1UWvp.jpg"&gt;
&lt;img alt="" src="https://s2.loli.net/2022/11/16/qhz3OQHlgaZ2YMn.jpg"&gt;&lt;img alt="" src="https://s2.loli.net/2022/11/16/oczkfgLw9EMR1ue.jpg"&gt;&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆï¼Œåˆ°åº•è¦ä¸è¦ä½¿ç”¨ mmap å‘¢ï¼Ÿç›´æ¥ä½¿ç”¨ ssdï¼Ÿè¿˜æ˜¯è‡ªå·±æä¸€ä¸ª buffer poolï¼Ÿ&lt;/p&gt;
&lt;p&gt;è®ºæ–‡ä½œè€…ç»™å‡ºè¿™æ ·çš„ç»“è®ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»¥ä¸‹æƒ…å†µä¸è¦ä½¿ç”¨ mmapï¼š&lt;ul&gt;
&lt;li&gt;éœ€è¦ä»¥äº‹åŠ¡å®‰å…¨çš„æ–¹å¼è¿›è¡Œæ›´æ–°æ“ä½œ&lt;/li&gt;
&lt;li&gt;å¸Œæœ›å¤„ç†ç¼ºé¡µé”™è¯¯æ—¶ä¸ä¼šé˜»å¡åœ¨æ…¢ I/O ä¸Šï¼Œæˆ–è€…å¸Œæœ›æ˜ç¡®æ§åˆ¶å“ªäº›æ•°æ®åº”è¯¥åœ¨å†…å­˜ä¸­&lt;/li&gt;
&lt;li&gt;å…³å¿ƒé”™è¯¯å¤„ç†ï¼Œä¹Ÿå¸Œæœ›å§‹ç»ˆè¿”å›æ­£ç¡®çš„æ•°æ®ç»“æœ&lt;/li&gt;
&lt;li&gt;è¦æ±‚åœ¨å¿«é€ŸæŒä¹…åŒ–å­˜å‚¨è®¾å¤‡ï¼ˆæ¯”å¦‚ SSDï¼‰ä¸Šè·å¾—é«˜åå&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä»¥ä¸‹æƒ…å†µå¯èƒ½åº”è¯¥ä½¿ç”¨ mmapï¼š&lt;ul&gt;
&lt;li&gt;å†…å­˜å¯ä»¥å®¹çº³æ•´ä¸ªæ•°æ®å·¥ä½œé›†ï¼ˆæˆ–è€…è¯´æ•´ä¸ªæ•°æ®åº“ï¼‰ï¼Œå¹¶ä¸”æ˜¯åªè¯»çš„å·¥ä½œè´Ÿè½½&lt;/li&gt;
&lt;li&gt;å¸Œæœ›å°†ä¸€ä¸ªäº§å“å¿«é€Ÿæ¨å‘å¸‚åœºï¼Œä¹Ÿä¸å…³æ³¨æ•°æ®ä¸€è‡´æ€§æˆ–è€…é•¿æœŸçš„å·¥ç¨‹æŠ€æœ¯å€º&lt;/li&gt;
&lt;li&gt;Otherwise, never ğŸ¤£ğŸ™ƒ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½©è›‹ï¼šè®ºæ–‡çš„å¥‡æ•°é¡µé¡µçœ‰  ğŸ˜‚
&lt;img alt="" src="https://s2.loli.net/2022/11/16/AIqHKTC213FYaxX.jpg"&gt;&lt;/p&gt;
&lt;h2&gt;2ã€&lt;a href="https://ayende.com/blog/196161-C/re-are-you-sure-you-want-to-use-mmap-in-your-database-management-system"&gt;re: Are You Sure You Want to Use MMAP in Your Database Management System? &lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡ä½œè€…è®¤ä¸ºè‡ªå·±å®ç°ä¸€ä¸ªå†…å­˜åˆ†é¡µç®¡ç†å™¨/ç¼“å†²æ± æ¯”è¾ƒå¤æ‚ï¼Œä½¿ç”¨ mmap æ¥å®ç°å­˜å‚¨ç³»ç»Ÿä¼šå¾ˆå¿«ã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¿‡åæ§½äº†åŸè®ºæ–‡æ²¡æœ‰ç»™å‡ºå¯ä¾›é€‰æ‹©çš„æ›¿ä»£æ–¹æ¡ˆï¼ŒåŸºå‡†æµ‹è¯•å’Œç»“è®ºä¹‹é—´ä¹Ÿæ²¡å¤ªå¤šç›¸å…³æ€§ï¼ˆcompares apples to camelsï¼‰ï¼Œä¹Ÿä½ä¼°äº†è‡ªå·±å®ç°ä¸€ä¸ªæ›¿ä»£ mmap çš„ç¼“å†²æ± çš„å¤æ‚æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ç”¨ mmap çš„è¯ï¼Œè®ºæ–‡æåŠçš„é‚£äº›é—®é¢˜ï¼Œä¹Ÿæ˜¯è¦è§£å†³çš„ï¼ˆIf you arenâ€™t using mmap, on the other hand, you still need to handle all those issues. That is a key point that I believe isnâ€™t addressed in the paper. Solving those issues properly (and efficiently) is a seriously challenging task. Given that you are building a specialized solution, you can probably do better than the generic mmap, but it will absolutely have a cost. That cost is both in terms of runtime overhead as well as increased development time.ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;åŸè®ºæ–‡çš„å®éªŒè¯´æ˜äº† mmap çš„æ€§èƒ½é—®é¢˜ï¼Œä½†æ˜¯æ¢ä¸ª buffer pool çš„å®ç°èƒ½ä¸èƒ½è·å¾—æ›´å¥½çš„æ€§èƒ½å‘¢ï¼Ÿè¯¥æ–‡ä½œè€…æŒæ‚²è§‚æ€åº¦ã€‚&lt;/p&gt;
&lt;p&gt;å­˜å‚¨ç³»ç»Ÿå®é™…é¢å¯¹çš„å·¥ä½œè´Ÿè½½ä¸ä¼šæ˜¯å®Œå…¨çš„éšæœºè¯»ï¼ˆå†™ï¼‰æˆ–é¡ºåºæ‰«æï¼Œé€šå¸¸éƒ½å…·æœ‰ä¸€å®šçš„çƒ­ç‚¹æ•°æ®ï¼Œè¿™æ—¶ buffer pool çš„ä¼˜åŠ¿å°±ä¼šä½“ç°å‡ºæ¥ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å…³äºâ€œé—®é¢˜ 1 - äº‹åŠ¡å®‰å…¨æ€§â€ - ä¸ç”¨ mmapï¼Œè§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ¡ˆæ²¡ä»€ä¹ˆä¸åŒï¼ˆI donâ€™t actually care if the data is written to memory behind my back. What I care about is MVCC (a totally separate concern than buffer management). The fact that Iâ€™m copying the modified data to the side means that I Can support concurrent transactions with far greater ease.ï¼‰&lt;/li&gt;
&lt;li&gt;å…³äºâ€œé—®é¢˜ 2 - I/O åœé¡¿â€ - è¯¥æ–‡ä½œè€…è®¤ä¸ºç¡®å®ä¸ªé—®é¢˜ï¼ˆnot having control over the I/O means that you may incur a page fault at any timeï¼‰ï¼Œå¹¶ä¸”æ˜¯åŸºäº mmap çš„ç³»ç»Ÿè¦é¢å¯¹çš„æœ€å¤§é—®é¢˜ã€‚ä¸è¿‡å®é™…æƒ…å†µæ˜¯ linux ç³»ç»Ÿä¸­ io_uring ä¹‹å¤–çš„å¼‚æ­¥ I/O æ–¹æ¡ˆåœ¨æŸäº›æ—¶å€™å¼‚æ­¥æ“ä½œä¹Ÿä¼šæ˜¯é˜»å¡çš„ã€‚æ˜¯å¦ä½¿ç”¨ mmapï¼Œè¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆä¹Ÿæ²¡æœ‰æœ¬è´¨åŒºåˆ«ã€‚&lt;/li&gt;
&lt;li&gt;å…³äºâ€œé—®é¢˜ 3 - é”™è¯¯å¤„ç†â€ - è¯¥æ–‡ä½œè€…ä»¥è‡ªå·±å¼€å‘çš„ Voron ä¸ºä¾‹è¯´æ˜å³ä½¿ä½¿ç”¨ mmapï¼Œä¹Ÿå¯ä»¥è¾ƒå¥½åœ°å®ç°æ ¡éªŒå’Œæ£€æŸ¥ï¼ˆä½¿ç”¨ä¸€ä¸ª bitmap æ¥è®°å½•å“ªäº›å†…å­˜é¡µè¢«è®¿é—®è¿‡ï¼Œåœ¨ç¬¬ä¸€æ¬¡è®¿é—®æŸä¸ªå†…å­˜é¡µçš„æ—¶å€™æ£€æŸ¥æ ¡éªŒå’Œï¼‰ï¼Œå¹¶è®¤ä¸ºç¨‹åºä¸€æ¬¡è¿è¡Œè¿‡ç¨‹ä¸­å¯¹äºæŒ‡å®šçš„ä¸€ä¸ªå†…å­˜é¡µæ£€æŸ¥ä¸€æ¬¡å°±å¯ä»¥ï¼Œå…¶ä»–æƒ…å†µä¸‹çš„æ£€æŸ¥éƒ½æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚When you use read() to get data from the disk, you have no guarantees that the data wasnâ€™t fetched from a cache along the way. So you may validate the data you read is â€œcorrectâ€, while the on disk representation is broken. For that reason, we only do the check once, instead of each time. ğŸ¤” å¥½åƒä¸æ˜¯è¿™ä¸ªç†ï¼Ÿ&lt;ul&gt;
&lt;li&gt;è‡³äºå‘ç° I/O é”™è¯¯ï¼Œå¦‚ä½•å¤„ç†ï¼Ÿè¯¥æ–‡ä½œè€…è®¤ä¸ºç­”æ¡ˆåªæœ‰ä¸€ä¸ª - è®©å®ƒå´©æºƒç„¶åé‡æ–°æ¢å¤å¹¶è¿è¡Œï¼ˆCrash and then run recovery from scratchï¼‰ï¼Œå› ä¸ºå¦‚æœ I/O ç³»ç»Ÿè¿”å›äº†ä¸€ä¸ªé”™è¯¯ï¼Œåº”ç”¨é€»è¾‘ä¹Ÿä¸ä¼šæœ‰ä»»ä½•æ–¹å¼çŸ¥é“ I/O ç³»ç»Ÿçš„å½“å‰çŠ¶æ€æ˜¯ä»€ä¹ˆï¼Œåº”è¯¥æ€ä¹ˆè§£å†³ï¼Œå”¯ä¸€çš„æ–¹å¼å°±æ˜¯åœä¸‹æ¥ï¼Œé‡æ–°åŠ è½½ä¸€åˆ‡ï¼ˆåº”ç”¨ WAL è¿›è¡Œæ¢å¤ï¼‰ï¼Œå›åˆ°ä¸€ä¸ªç¨³å®šçŠ¶æ€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å…³äºâ€œé—®é¢˜ 4 - æ€§èƒ½é—®é¢˜â€ - &lt;ul&gt;
&lt;li&gt;é¡µè¡¨äº‰ç”¨ï¼ˆpage table contentionï¼‰ï¼šlinux å†…æ ¸å·²ä¼˜åŒ–è§£å†³&lt;/li&gt;
&lt;li&gt;å•çº¿ç¨‹é¡µé©±é€ï¼ˆsingle-threaded page evictionï¼‰ï¼šå¦‚æœå†™/æ›´æ–°é¢‘ç‡ä¸é«˜ï¼Œè„é¡µä¸å¤šçš„è¯ï¼Œä¹Ÿä¸ä¼šæˆä¸ºæ€§èƒ½ç“¶é¢ˆ&lt;/li&gt;
&lt;li&gt;&lt;a href="https://stackoverflow.com/questions/3748384/what-is-tlb-shootdown"&gt;æ—è·¯è½¬æ¢ç¼“å†²å‡»è½ï¼ˆTLB shootdownsï¼‰&lt;/a&gt;ï¼šåœ¨ä¸€å®šæ¡ä»¶ä¸‹æ‰ä¼šæˆä¸ºæ€§èƒ½ç“¶é¢ˆï¼Œå½“ä½ çœŸçš„é‡åˆ°æ—¶åº”è¯¥ä¹Ÿä¼šå¤šèŠ±é’±ä¹°å†…å­˜æ¥è§£å†³ ğŸ¤£ğŸ™ƒï¼ˆIn order to actually observe the cost of TLS Shootdown in a significant manner, you need to have: (1) really fast I/O (2)working set that significantly exceeds memory (3) no other work that needs to be done for processing a request; In practice, if you have really fast I/O, you spent money on that, youâ€™ll more likely get more RAM as well. And you typically need to do something with the data you read, which means that you wonâ€™t notice the TLB shootdown as muchï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;3ã€&lt;a href="https://www.usenix.org/system/files/conference/fast16/fast16-papers-lu.pdf"&gt;WiscKey: Separating Keys from Values in SSD-Conscious Storage&lt;/a&gt; /   &lt;a href="https://dgraph.io/blog/post/badger/"&gt;Introducing Badger: A fast key-value store written purely in Go&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;WiscKey æ˜¯ä¸€ä¸ªåŸºäº LSM (Log Structured Merge)æ ‘çš„ KV å­˜å‚¨å¼•æ“ï¼Œé’ˆå¯¹ SSD çš„éšæœºè¯»å’Œé¡ºåºè¯»æ€§èƒ½ç‰¹ç‚¹ï¼Œå°† Key å’Œ Value åˆ†å¼€å­˜å‚¨ï¼Œä»¥å°½å¯èƒ½ç¼©å° I/O æ”¾å¤§é—®é¢˜ï¼Œæå‡æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;Value å­˜æ”¾åœ¨ Log æ–‡ä»¶ä¸­ï¼ŒLSM æ ‘ä»…å­˜å‚¨ Key å’Œ Value åœ¨ Log æ–‡ä»¶çš„ä½ç½®ä»¥åŠé•¿åº¦/å¤§å°ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äº Value æ¯”è¾ƒå¤§çš„åº”ç”¨åœºæ™¯ï¼Œæ€§èƒ½ä¼˜åŠ¿æ˜æ˜¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="https://s2.loli.net/2022/11/16/y84VKqJZWMSjBu7.jpg"&gt;&lt;/p&gt;
&lt;p&gt;å› ä¸º LSM æ ‘ä¸å­˜å‚¨ Value æœ¬èº«ï¼Œé€šå¸¸æ¯”è¾ƒå°ï¼Œå¯ä»¥å…¨éƒ¨æ”¾åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥ä¸è€ƒè™‘è·å– Value çš„å€¼ï¼Œç‚¹æŸ¥å’ŒèŒƒå›´æŸ¥æ‰¾é€Ÿåº¦éå¸¸å¿«ã€‚&lt;/p&gt;
&lt;p&gt;LSM æ ‘æ¯”è¾ƒå°ï¼Œæ‰€ä»¥ Compaction æ¬¡æ•°å°‘ï¼Œé€Ÿåº¦å¿«ï¼ˆç‰¹åˆ«æ˜¯å¦‚æœæ•´ä¸ª LSM éƒ½æ”¾åœ¨å†…å­˜ä¸­çš„è¯ï¼‰ã€‚Compaction è¿‡ç¨‹ä¸­ä¸éœ€è¦è¯»å†™ Value çš„å€¼ï¼Œæ‰€ä»¥ I/O æ”¾å¤§å€æ•°è¦å°å¾ˆå¤šã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="https://s2.loli.net/2022/11/16/2tvp5LROXG4UYrw.jpg"&gt;&lt;/p&gt;
&lt;p&gt;ç‚¹æŸ¥è¿‡ç¨‹ï¼Œä» LSM æ ‘ä¸­è·å– Value çš„ä½ç½®å’Œå¤§å°åï¼Œéœ€è¦ä» Value Log ä¸­è·å– Value å€¼ã€‚å› ä¸º LSM æ ‘å°ï¼Œæ‰€ä»¥è¯»æ”¾å¤§å€æ•°å°ï¼Œç»¼åˆèµ·æ¥çœ‹ï¼ŒWiscKey ç‚¹æŸ¥çš„æ€§èƒ½ä¼˜åŠ¿ä¾æ—§æ˜æ˜¾ã€‚&lt;/p&gt;
&lt;p&gt;èŒƒå›´æŸ¥æ‰¾/éå†è¿‡ç¨‹ï¼Œå…ˆä» LSM æ ‘ä¸­è·å¾—ç›®æ ‡èŒƒå›´å†…çš„æ‰€æœ‰ Value çš„ä½ç½®å’Œå¤§å°ï¼Œæ”¾å…¥é˜Ÿåˆ—ï¼Œä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œå¹¶å‘é¢„å–ï¼Œåˆ©ç”¨ SSD éšæœºè¯»çš„ååèƒ½åŠ›éšå¹¶å‘æ ‘è¿‘çº¿æ€§å¢é•¿çš„ç‰¹ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="https://s2.loli.net/2022/11/16/APbQlhq3nWsf47j.jpg"&gt;
&lt;img alt="" src="https://s2.loli.net/2022/11/16/j357k6XMfYO2udm.jpg"&gt;&lt;/p&gt;
&lt;p&gt;Value Log ä¹Ÿéœ€è¦ GCï¼Œæ¸…ç†æ‰æ— ç”¨çš„ Value å€¼ã€‚LSM æ ‘çš„ Compaction ä¸»è¦æ˜¯ä¸ºäº†æå‡æŸ¥æ‰¾/æ£€ç´¢çš„æ€§èƒ½/æ•ˆç‡ï¼Œæ§åˆ¶è¯»æ”¾å¤§ï¼Œå‡å°‘å†…å­˜/ç£ç›˜ç©ºé—´å ç”¨æ˜¯æ¬¡è¦çš„ã€‚Value Log çš„ GC åˆ™ä¸»è¦æ˜¯ä¸ºäº†å‡å°‘å†…å­˜/ç£ç›˜ç©ºé—´å ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å®ç°åœ¨çº¿çš„è½»é‡çº§ GCï¼ŒValue Log ä¸­ä¹Ÿå­˜å‚¨äº† Keyï¼Œ&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="https://s2.loli.net/2022/11/16/JMKxWiaCovyhgr8.jpg"&gt;&lt;/p&gt;
&lt;p&gt;tail æŒ‡å‘ Value Log æœ‰æ•ˆå€¼èŒƒå›´å†…æ—¶åºä¸Šæœ€å…ˆå†™å…¥çš„é‚£ä¸ª value çš„ä½ç½®ã€‚&lt;/p&gt;
&lt;p&gt;head æŒ‡å‘ Value Log ä¸­ä¸‹ä¸€ä¸ªæ–° value å†™å…¥çš„ä½ç½®ã€‚&lt;/p&gt;
&lt;p&gt;tail å’Œ head åŠå…¶å¯¹åº”çš„ä½ç½®ä¿¡æ¯å‡ä½œä¸º kv å­˜å…¥ LSM æ ‘ä¸­ï¼ˆhead çš„æŒ‡å‘ä»€ä¹ˆæ—¶å€™ä¼šæ›´æ–°ï¼Ÿï¼šæ¯æ¬¡æœ‰æ–°å€¼å†™å…¥çš„æ—¶å€™éƒ½æ›´æ–°ï¼Ÿè¿˜æ˜¯åœ¨ GC çš„è¿‡ç¨‹ä¸­æ‰ä¼šæ›´æ–°ï¼Ÿï¼‰&lt;/p&gt;
&lt;p&gt;GC çš„æµç¨‹ä¸ºï¼š&lt;/p&gt;
&lt;p&gt;â‘  ä» tail æŒ‡å‘çš„ä½ç½®å¼€å§‹é¡ºåºæ‰«æä¸€å—æ•°æ®ï¼Œæ ¹æ®å…¶ä¸­çš„ key æ£€ç´¢ LSM æ ‘ï¼Œç¡®è®¤å½“å‰ value æ˜¯å¦æœ‰æ•ˆï¼ˆæ²¡æœ‰è¢«åˆ é™¤ä¹Ÿæ²¡æœ‰è¢«è¦†ç›–ï¼‰&lt;/p&gt;
&lt;p&gt;â‘¡ å¦‚æœæœ‰æ•ˆåˆ™æ’å…¥åˆ° head æŒ‡å‘çš„ä½ç½®ï¼Œhead æŒ‡å‘ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªä½ç½®ï¼›å¦‚æœæ— æ•ˆï¼Œåˆ™ç›´æ¥ä¸¢å¼ƒ&lt;/p&gt;
&lt;p&gt;â‘¢ ä¸€å—æ•°æ®å¤„ç†å®Œæˆåï¼Œç§»åŠ¨ tail æŒ‡å‘åˆ°ä¸‹ä¸€ä¸ªä½ç½®ï¼Œé‡Šæ”¾/å›æ”¶åŸæ¥æ•°æ®å—çš„å­˜å‚¨ç©ºé—´ï¼›ç„¶åç»§ç»­å¾ªç¯å¤„ç†&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç–‘é—®&lt;/strong&gt;ï¼š1. GC è¿‡ç¨‹ä¸­æ¯æ¬¡å‘ head æ’å…¥æœ‰æ•ˆå€¼æ—¶ï¼Œæ˜¯å¦å…ˆè¦ä» LSM æ ‘ä¸­æŸ¥è¯¢æœ€æ–°æŒ‡å‘çš„ä½ç½®ï¼Ÿ2. åœ¨æ ¹æ® key ä» LSM æ ‘æŸ¥è¯¢åå°†æœ‰æ•ˆå€¼å†™å…¥ head ä½ç½®å‰ï¼Œæœ‰æ–°æ•°æ®å†™å…¥çš„è¯ï¼Œæ€ä¹ˆå¤„ç†ï¼ŸGC æœŸé—´æ˜¯å¦è¦åœæ­¢æ­£å¸¸çš„å†™æ“ä½œï¼Ÿè¿˜æ˜¯è¯´å¯¹æŸä¸ªä¸´ç•ŒåŒºåŠ é”ï¼Ÿ &lt;/p&gt;
&lt;p&gt;LSM æ ‘åŸç†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="https://s2.loli.net/2022/11/16/k6cHFOUluo1Ibfp.jpg"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="https://s2.loli.net/2022/11/16/17WubUhqSpCjMr5.jpg"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="https://s2.loli.net/2022/11/16/Tomk3VOEs7jduQl.jpg"&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://zhuanlan.zhihu.com/p/181498475"&gt;LSMæ ‘è¯¦è§£ - çŸ¥ä¹ (zhihu.com)&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;4ã€&lt;a href="http://www.vldb.org/pvldb/vol14/p364-didona.pdf"&gt;Toward a Better Understanding and Evaluation of Tree Structures on Flash SSDsï¼ˆVLDBï¼‰&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;PTS - Persistent tree data structure&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ LSM æ ‘ï¼ˆRocksDBï¼‰å’Œ B+ æ ‘ï¼ˆWiredTigerï¼‰æ¥åˆ†æ SSD åŸºå‡†æµ‹è¯•ï¼ˆBenchmarkingï¼‰ä¸­å¯èƒ½è¸©åˆ°çš„ 7 ä¸ªå‘ï¼ˆpitfallï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ï¼ˆ1ï¼‰Running short tests / æµ‹è¯•è¿‡äºçŸ­å¹³å¿«&lt;/strong&gt; âš¡ï¸&lt;/p&gt;
&lt;p&gt;éšç€ä½¿ç”¨æ—¶é—´çš„å¢åŠ ï¼ŒSSD çš„æ€§èƒ½ä¼šä¸€å®šçš„åŠ¨æ€å˜åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;Because both the PTS and SSD performance vary over time, short-lived tests are unable to capture how the systems will behave under a continuousï¼ˆnon-burstyï¼‰workload.&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="https://s2.loli.net/2022/11/16/HSuzIeC8itjndGw.jpg"&gt;&lt;/p&gt;
&lt;p&gt;WA-Aï¼ˆåº”ç”¨/å­˜å‚¨ç³»ç»Ÿçš„å†™æ”¾å¤§ï¼‰ increases over time while the levels of the LSM-Tree fills up, and its curve flattens once the layout of the LSM tree has stabilized.&lt;/p&gt;
&lt;p&gt;WA-Dï¼ˆSSD è®¾å¤‡çš„å†™æ”¾å¤§ï¼‰ increases over time because of the effect of garbage collection.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ï¼ˆ2ï¼‰Ignoring the device write amplification (WA-D) / å¿½è§†äº† SSD è®¾å¤‡æœ¬èº«çš„å†™æ”¾å¤§&lt;/strong&gt; âš¡ï¸&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;WA-D directly affects the throughput of the device, which strongly correlates with the application-level throughput.&lt;/li&gt;
&lt;li&gt;WA-D is an essential measure of the I/O efficiency of a PTS. ç«¯åˆ°ç«¯çš„å†™æ”¾å¤§å€æ•°åº”è¯¥æ˜¯ WA-A ä¹˜ä»¥ WA-D&lt;/li&gt;
&lt;li&gt;WA-D measures the flash-friendliness of a PTS. &lt;ul&gt;
&lt;li&gt;A low WA-D indicates that a PTS generates a write access that does not incur much garbage collection overhead in the SSD. &lt;/li&gt;
&lt;li&gt;ä»¥å‰å¤§å®¶å¯èƒ½è®¤ä¸º LSM æ ‘ï¼ˆé¡ºåºå†™ï¼‰ç›¸æ¯” B+ æ ‘ï¼ˆéšæœºå†™ï¼‰å¯¹ SSD æ›´å‹å¥½ï¼Œä½†å®æµ‹ WA-D é¢ è¦†äº†è¿™ä¸ªè®¤çŸ¥ &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ï¼ˆ3ï¼‰Ignoring the internal state of the SSD / å¿½è§†äº† SSD çš„åˆå§‹å†…éƒ¨çŠ¶æ€&lt;/strong&gt; âš¡ï¸&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="https://s2.loli.net/2022/11/16/pFyqSCVZnrHB1g9.jpg"&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Trim(Discard)çš„å‡ºç°ä¸»è¦æ˜¯ä¸ºäº†æé«˜GCçš„æ•ˆç‡ä»¥åŠå‡å°‘å†™å…¥æ”¾å¤§çš„å‘ç”Ÿï¼Œæœ€å¤§ä½œç”¨æ˜¯æ¸…ç©ºå¾…åˆ é™¤çš„æ— æ•ˆæ•°æ®&lt;/strong&gt;ã€‚åœ¨SSDæ‰§è¡Œè¯»ã€æ“¦ã€å†™æ­¥éª¤çš„æ—¶å€™ï¼Œé¢„å…ˆæŠŠæ“¦é™¤çš„æ­¥éª¤å…ˆåšäº†ï¼Œè¿™æ ·æ‰èƒ½å‘æŒ¥å‡ºSSDçš„æ€§èƒ½ï¼Œé€šå¸¸SSDæ‰é€Ÿå¾ˆå¤§ä¸€éƒ¨åˆ†åŸå› å°±æ˜¯å¾…åˆ é™¤çš„æ— æ•ˆæ•°æ®å¤ªå¤šï¼Œæ¯æ¬¡å†™å…¥çš„æ—¶å€™ä¸»æ§éƒ½è¦å…ˆåšæ¸…ç©ºå¤„ç†ï¼Œæ‰€ä»¥æ€§èƒ½å—åˆ°äº†é™åˆ¶ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The steady-state performance of a PTS can greatly differ depending on the initial state of the drive, this is surprising.&lt;/p&gt;
&lt;p&gt;This phenomenon is caused by how the LBA (logic block address)  access patterns of RocksDB and WiredTiger intertwine with the SSD garbage collection mechanism as a function of the initial state the drive.&lt;/p&gt;
&lt;p&gt;WiredTiger only writes to a limited portion of the logical block address space.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ï¼ˆ4ï¼‰Ignore the dataset size / å¿½è§†äº†æ•°æ®é›†å¤§å°&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="https://s2.loli.net/2022/11/16/SlVWJfP5rO7xpNQ.jpg"&gt;&lt;/p&gt;
&lt;p&gt;The amount of data stored by the SSD changes its behavior and affects overall performance.&lt;/p&gt;
&lt;p&gt;The performance degradation brought by the larger dataset is primarily due to the idiosyncrasiesï¼ˆç‰¹è´¨/ç‰¹ç‚¹ï¼‰ of the SSD: larger datasets lead to more valid pages in each flash block, which increases the amount of data being relocated upon performing garbage collection, i.e., the WA-D&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ï¼ˆ5ï¼‰Ignoring the extra storage capacity a PTS needs to manage data and store additional meta-data / æœªè€ƒè™‘ç©ºé—´æ”¾å¤§ï¼ˆSpace amplificationï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ¶‰åŠå­˜å‚¨æˆæœ¬&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ï¼ˆ6ï¼‰Ignoring SSD over-provisioning&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æˆæœ¬ä¸æ€§èƒ½ä¹‹é—´çš„æƒè¡¡æŠ˜ä¸­ - å¯ä»¥é¢„ç•™ä¸€éƒ¨åˆ† SSD ç©ºé—´ç»™ SSD åš GC ä½¿ç”¨ï¼Œè¿™éƒ¨åˆ†ç©ºé—´å¯¹æ–‡ä»¶ç³»ç»Ÿä¸å¯è§ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="https://s2.loli.net/2022/11/16/YEFp5g69mnqBe3w.jpg"&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ï¼ˆ7ï¼‰Ignoring the effect of the underlying storage technology on performance&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;5ã€SSD åŸç†ç›¸å…³èµ„æ–™&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://zhuanlan.zhihu.com/p/102089411"&gt;æµ…è°ˆåˆ†å¸ƒå¼å­˜å‚¨ä¹‹SSDåŸºæœ¬åŸç† - çŸ¥ä¹ (zhihu.com)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://mp.weixin.qq.com/s/_uiCsFXWjepeHSdgiUABhg"&gt;èŠèŠ SSD çš„åŸºæœ¬åŸç† (qq.com)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://xiongduo.cn/posts/coding-for-ssds-part-1-introduction-and-table-of-contents.html"&gt;ä¸ºSSDç¼–ç¨‹ï¼ˆ1ï¼‰ï¼šç®€ä»‹å’Œç›®å½• (xiongduo.cn)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.ssdfans.com/?p=8077"&gt;SSDèƒŒåçš„ç§˜å¯†ï¼šSSDåŸºæœ¬å·¥ä½œåŸç† (ssdfans.com)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><category term="å…¶ä»–"></category><category term="è®ºæ–‡"></category><category term="SSD"></category><category term="å­¦ä¹ "></category><category term="æ€§èƒ½"></category></entry><entry><title>Disruptor ç­‰å¾…ç­–ç•¥å¼•å‘çš„ CPU è´Ÿè½½å¼‚å¸¸é—®é¢˜</title><link href="http://youngsterxyf.github.io/2020/07/14/disruptor-waitstrategy-cpu-busy/" rel="alternate"></link><published>2020-07-14T00:00:00+08:00</published><updated>2020-07-14T00:00:00+08:00</updated><author><name>xiayf</name></author><id>tag:youngsterxyf.github.io,2020-07-14:/2020/07/14/disruptor-waitstrategy-cpu-busy/</id><summary type="html">&lt;h2&gt;èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;å·¥ä½œä¸­ï¼Œæˆ‘è´Ÿè´£çš„ç³»ç»Ÿæ˜¯ä¸€ä¸ªæ•°æ®æµå¤„ç†æœåŠ¡ - ä»¥æµæ°´çº¿ï¼ˆpipelineï¼‰çš„å½¢å¼åˆ†å¤šçº§å¼‚æ­¥å¤„ç†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="https://i.loli.net/2020/07/14/ONwUsrlhLmIq8BW.jpg"&gt;&lt;/p&gt;
&lt;p&gt;å…¶ä¸­çš„ é˜Ÿåˆ— å®é™…ä½¿ç”¨çš„æ˜¯ &lt;a href="https://github.com/LMAX-Exchange/disruptor"&gt;Disruptor&lt;/a&gt;ï¼Œå¤šç”Ÿ â€¦&lt;/p&gt;</summary><content type="html">&lt;h2&gt;èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;å·¥ä½œä¸­ï¼Œæˆ‘è´Ÿè´£çš„ç³»ç»Ÿæ˜¯ä¸€ä¸ªæ•°æ®æµå¤„ç†æœåŠ¡ - ä»¥æµæ°´çº¿ï¼ˆpipelineï¼‰çš„å½¢å¼åˆ†å¤šçº§å¼‚æ­¥å¤„ç†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="https://i.loli.net/2020/07/14/ONwUsrlhLmIq8BW.jpg"&gt;&lt;/p&gt;
&lt;p&gt;å…¶ä¸­çš„ é˜Ÿåˆ— å®é™…ä½¿ç”¨çš„æ˜¯ &lt;a href="https://github.com/LMAX-Exchange/disruptor"&gt;Disruptor&lt;/a&gt;ï¼Œå¤šç”Ÿäº§è€…å•æ¶ˆè´¹è€…æ¨¡å¼ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ThreadFactory factory = &lt;span style="color: #0000ff"&gt;new&lt;/span&gt; ThreadFactoryBuilder().setNameFormat(name).setDaemon(&lt;span style="color: #0000ff"&gt;true&lt;/span&gt;).build();
Disruptor&amp;lt;Event&amp;lt;T&amp;gt;&amp;gt;  disruptor = &lt;span style="color: #0000ff"&gt;new&lt;/span&gt; Disruptor&amp;lt;&amp;gt;(Event&amp;lt;T&amp;gt;::&lt;span style="color: #0000ff"&gt;new&lt;/span&gt;, bufferSize, factory, ProducerType.MULTI, &lt;span style="color: #0000ff"&gt;new&lt;/span&gt; SleepingWaitStrategy());
disruptor.handleEventsWith((Event&amp;lt;T&amp;gt; event, &lt;span style="color: #2b91af"&gt;long&lt;/span&gt; sequence, &lt;span style="color: #2b91af"&gt;boolean&lt;/span&gt; endOfBatch) -&amp;gt; {
    consumer.accept(event.value, endOfBatch);
    event.value = &lt;span style="color: #0000ff"&gt;null&lt;/span&gt;;
});
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æœåŠ¡è¿è¡Œåœ¨ k8s é›†ç¾¤ä¸Šï¼Œæ¯ä¸ªå®¹å™¨èŠ‚ç‚¹ä¸Šå¯èƒ½ä¼šè¿è¡Œå¤šä¸ª pipelineï¼Œä¹Ÿå³æ„å‘³ç€å•ä¸ªèŠ‚ç‚¹ä¸Šä¼šå­˜åœ¨å¤šä¸ª disruptor å®ä¾‹ã€‚&lt;/p&gt;
&lt;h2&gt;ç°è±¡&lt;/h2&gt;
&lt;p&gt;è¿‘æœŸçªç„¶æ”¶åˆ°æµ‹è¯•ç¯å¢ƒå¾ˆå¤šèŠ‚ç‚¹ï¼ˆç”Ÿäº§ç¯å¢ƒä¹Ÿæœ‰å°‘é‡èŠ‚ç‚¹ï¼‰çš„ CPU ä½¿ç”¨ç‡å‘Šè­¦ - CPU ä½¿ç”¨ç‡æŒç»­ 5 åˆ†é’Ÿä»¥ä¸Šè¶…è¿‡ 90%ï¼Œå¦‚ä¸‹å…¶ä¸­ä¸€ä¸ªä»»åŠ¡èŠ‚ç‚¹çš„ CPU ä½¿ç”¨ç‡ç›‘æ§å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="https://i.loli.net/2020/07/14/XJVsiMI3b9m5dlB.jpg"&gt;
&lt;img alt="" src="https://i.loli.net/2020/07/14/2YwPQAqaICr879x.jpg"&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;cpu.busy = cpu.system + cpu.user + è½¯/ç¡¬ä¸­æ–­&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æ³¨æ„å…¶ä¸­ &lt;code&gt;cpu.system&lt;/code&gt; æ¯” &lt;code&gt;cpu.user&lt;/code&gt; é«˜ä¸å°‘ï¼Œ&lt;code&gt;cpu.busy&lt;/code&gt; åˆæ¯” &lt;code&gt;cpu.system&lt;/code&gt; é«˜ä¸å°‘ã€‚ä¹Ÿå³ CPU æ—¶é—´ç‰‡èµ„æºä¸»è¦æ¶ˆè€—åœ¨ å†…æ ¸æ€ å’Œä¸­æ–­é€»è¾‘ä¸Šï¼ˆå¯¹äºè¿™äº›ä»»åŠ¡è€Œè¨€ &lt;code&gt;cpu.user&lt;/code&gt; æŒ‡æ ‡ä¹Ÿæ˜¯å¼‚å¸¸çš„ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›èŠ‚ç‚¹è¿è¡Œçš„ä»»åŠ¡ï¼Œå‡ ä¹æ²¡æœ‰æ•°æ®éœ€è¦å¤„ç†ï¼Œä¹Ÿå°±æ˜¯è¯´å‡ ä¹æ˜¯ç©ºè·‘çš„ã€‚ä»çº¿ç¨‹æ•°é‡ç›‘æ§ä»¥åŠ jstack è¾“å‡ºçš„å †æ ˆè·Ÿè¸ªä¿¡æ¯ï¼Œä¹Ÿæœªå‘ç°æ˜æ˜¾å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;h2&gt;åŸå› æ’æŸ¥&lt;/h2&gt;
&lt;p&gt;å°†æµ‹è¯•ç¯å¢ƒçš„ä»»åŠ¡åœ¨æœ¬åœ°ç¯å¢ƒè¿è¡Œèµ·æ¥ï¼Œå¹¶åŸºäº &lt;a href="https://www.lightbend.com/blog/profiling-jvm-applications"&gt;How to profile JVM applications&lt;/a&gt; ä¸€æ–‡ä¸­æåˆ°çš„ç«ç„°å›¾å·¥å…·ï¼Œäº§å‡ºå¯¹åº” JVM åº”ç”¨çš„ç«ç„°å›¾ï¼š
&lt;img alt="" src="https://i.loli.net/2020/07/14/zQMWsBeKbuZLamN.jpg"&gt;&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸­å¯ä»¥å¤§è‡´çœ‹å‡ºå…¶ä¸­ &lt;code&gt;com/lmax/disruptor/SleepingWaitStrategy:::waitFor&lt;/code&gt; / &lt;code&gt;jdk/internal/misc/Unsafe:::park&lt;/code&gt; æ¯”è¾ƒå¯ç–‘ï¼Œåœ¨è°ƒç”¨æ ˆä¸­è€—æ—¶æœ€é•¿ã€‚&lt;/p&gt;
&lt;p&gt;ä»é¡¹ç›®æºç å’Œ jstack è¾“å‡ºçš„å †æ ˆè·Ÿè¸ªä¿¡æ¯å¯ä»¥çœ‹åˆ°ï¼Œæµ‹è¯•ä»»åŠ¡ä¸­å¤§è‡´æ¶‰åŠ 18ä¸ª disruptor å®ä¾‹ï¼Œå‡ä½¿ç”¨ &lt;code&gt;SleepingWaitStrategy&lt;/code&gt; ç­‰å¾…ç­–ç•¥ï¼Œè¯¥ç­–ç•¥çš„ &lt;a href="https://github.com/LMAX-Exchange/disruptor/blob/master/src/main/java/com/lmax/disruptor/SleepingWaitStrategy.java#L56"&gt;waitFor&lt;/a&gt; æ–¹æ³•å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #2b91af"&gt;long&lt;/span&gt; waitFor(&lt;span style="color: #0000ff"&gt;final&lt;/span&gt; &lt;span style="color: #2b91af"&gt;long&lt;/span&gt; sequence, Sequence cursor, &lt;span style="color: #0000ff"&gt;final&lt;/span&gt; Sequence dependentSequence, &lt;span style="color: #0000ff"&gt;final&lt;/span&gt; SequenceBarrier barrier) &lt;span style="color: #0000ff"&gt;throws&lt;/span&gt; AlertException {
    &lt;span style="color: #2b91af"&gt;long&lt;/span&gt; availableSequence;
    &lt;span style="color: #008000"&gt;// é»˜è®¤ 200&lt;/span&gt;
    &lt;span style="color: #2b91af"&gt;int&lt;/span&gt; counter = retries;

    &lt;span style="color: #0000ff"&gt;while&lt;/span&gt; ((availableSequence = dependentSequence.get()) &amp;lt; sequence) {
      counter = applyWaitMethod(barrier, counter);
    }

    &lt;span style="color: #0000ff"&gt;return&lt;/span&gt; availableSequence;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;waitFor æ–¹æ³•ä¸­æ ¸å¿ƒè°ƒç”¨äº† &lt;a href="https://github.com/LMAX-Exchange/disruptor/blob/master/src/main/java/com/lmax/disruptor/SleepingWaitStrategy.java#L76"&gt;applyWaitMethod&lt;/a&gt; ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #0000ff"&gt;private&lt;/span&gt; &lt;span style="color: #2b91af"&gt;int&lt;/span&gt; applyWaitMethod(&lt;span style="color: #0000ff"&gt;final&lt;/span&gt; SequenceBarrier barrier, &lt;span style="color: #2b91af"&gt;int&lt;/span&gt; counter) &lt;span style="color: #0000ff"&gt;throws&lt;/span&gt; AlertException {
    barrier.checkAlert();

    &lt;span style="color: #0000ff"&gt;if&lt;/span&gt; (counter &amp;gt; 100)
    {
        --counter;
    }
    &lt;span style="color: #0000ff"&gt;else&lt;/span&gt; &lt;span style="color: #0000ff"&gt;if&lt;/span&gt; (counter &amp;gt; 0)
    {
        --counter;
        Thread.yield();
    }
    &lt;span style="color: #0000ff"&gt;else&lt;/span&gt;
    {
        &lt;span style="color: #008000"&gt;// sleepTimeNs é»˜è®¤ 100&lt;/span&gt;
        &lt;span style="color: #008000"&gt;// é—´æ¥è°ƒç”¨  jdk/internal/misc/Unsafe:::park æ–¹æ³•&lt;/span&gt;
        LockSupport.parkNanos(sleepTimeNs);
    }

    &lt;span style="color: #0000ff"&gt;return&lt;/span&gt; counter;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/LockSupport.html#parkNanos-long-"&gt;LockSupport.parkNanos&lt;/a&gt; æ–¹æ³•çš„ä½œç”¨ç®€å•è€Œè¨€å³è®©å½“å‰çº¿ç¨‹ç¡çœ  sleepTimeNs çº³ç§’ã€‚&lt;/p&gt;
&lt;p&gt;Disruptor ä½œä¸ºä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œè‡ªå¸¦ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± çš„çº¿ç¨‹å·¥å‚å³æ„é€ æ–¹æ³•ä¼ å…¥çš„ factoryï¼Œçº¿ç¨‹æ•°é‡ç­‰äº &lt;a href="https://github.com/LMAX-Exchange/disruptor/blob/master/src/main/java/com/lmax/disruptor/dsl/Disruptor.java#L165"&gt;disruptor.handleEventsWith&lt;/a&gt; è°ƒç”¨æ—¶ä¼ å…¥çš„å›è°ƒæ–¹æ³•æ•°é‡ï¼ŒhandleEventsWith çš„å‚æ•°æ•°é‡ä¸å®šï¼ˆ&lt;code&gt;public final EventHandlerGroup&amp;lt;T&amp;gt; handleEventsWith(final EventHandler&amp;lt;? super T&amp;gt;... handlers)&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;18ä¸ª Disruptor å®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹ä¸æ–­æ£€æŸ¥é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰æ–°çš„ &lt;code&gt;Event&amp;lt;T&amp;gt;&lt;/code&gt; ä»»åŠ¡éœ€è¦å¤„ç†ï¼Œå¦‚æœæœ‰ï¼Œåˆ™è°ƒç”¨ EventHandler å›è°ƒæ–¹æ³•è¿›è¡Œå¤„ç†ï¼Œå¦åˆ™ç¡çœ  sleepTimeNs çº³ç§’ã€‚&lt;/p&gt;
&lt;p&gt;åˆ°æ­¤ï¼Œç»“åˆç›‘æ§æŒ‡æ ‡ï¼Œå¯ä»¥å¤§è‡´çŒœæµ‹ï¼šç”±äº sleepTimeNs è¾ƒå°ï¼Œå¯¼è‡´å¤šä¸ªçº¿ç¨‹çš„çŠ¶æ€ä¸æ–­åœ¨ &lt;code&gt;è¿è¡Œ&lt;/code&gt;ã€&lt;code&gt;ç¡çœ &lt;/code&gt;ã€&lt;code&gt;ç­‰å¾…è°ƒåº¦&lt;/code&gt; ä¹‹é—´åˆ‡æ¢ï¼Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢éå¸¸é¢‘ç¹ã€‚&lt;/p&gt;
&lt;p&gt;å›´ç»• LockSupport.parkNanos ç¼–å†™ä¸€ä¸ªæµ‹è¯•ç¨‹åºï¼Œæ¥å¤ç°è¿™ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #0000ff"&gt;import&lt;/span&gt; java.util.concurrent.CountDownLatch;
&lt;span style="color: #0000ff"&gt;import&lt;/span&gt; java.util.concurrent.ExecutorService;
&lt;span style="color: #0000ff"&gt;import&lt;/span&gt; java.util.concurrent.Executors;
&lt;span style="color: #0000ff"&gt;import&lt;/span&gt; java.util.concurrent.locks.LockSupport;

&lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #0000ff"&gt;class&lt;/span&gt; &lt;span style="color: #2b91af"&gt;Test&lt;/span&gt; {

  &lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #0000ff"&gt;static&lt;/span&gt; &lt;span style="color: #2b91af"&gt;void&lt;/span&gt; main(String[] args) &lt;span style="color: #0000ff"&gt;throws&lt;/span&gt; InterruptedException {
    ExecutorService tp = Executors.newFixedThreadPool(18);
    &lt;span style="color: #0000ff"&gt;for&lt;/span&gt; (&lt;span style="color: #2b91af"&gt;int&lt;/span&gt; idx = 0; idx &amp;lt; 18; idx++) {
      tp.submit(() -&amp;gt; {
        &lt;span style="color: #0000ff"&gt;while&lt;/span&gt; (&lt;span style="color: #0000ff"&gt;true&lt;/span&gt;) {
          LockSupport.parkNanos(100);
        }
      });
    }
    CountDownLatch wg = &lt;span style="color: #0000ff"&gt;new&lt;/span&gt; CountDownLatch(1);
    wg.await();
  }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åœ¨ 3.2 GHz 6-Core Intel Core i7 é…ç½® macOS ç³»ç»Ÿä¸­ï¼Œè¿™ä¸ªæµ‹è¯•ç¨‹åºå¯ä»¥ç¨³å®šåœ°å°† CPU ä½¿ç”¨ç‡æ§åˆ¶åœ¨ 700%+ï¼Œå¦‚ä¸‹ &lt;code&gt;top -pid [æµ‹è¯•ç¨‹åºçš„è¿›ç¨‹ id]&lt;/code&gt; å‘½ä»¤çš„è¾“å‡ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="https://i.loli.net/2020/07/14/Z6jixvuWY1yTnL4.jpg"&gt;&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ CSW ä¸ºçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¬¡æ•°ã€‚&lt;/p&gt;
&lt;p&gt;æ—¢ç„¶é—®é¢˜åŸå› åœ¨äºå¤šä¸ªçº¿ç¨‹é¢‘ç¹ç¡çœ å¯¼è‡´ï¼Œé‚£ä¹ˆè§£å†³æ–¹æ¡ˆä¹Ÿæ¯”è¾ƒç®€å•ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨æ›´å¤§çš„å€¼æ¥æ›¿æ¢ sleepTimeNs é»˜è®¤å€¼ï¼š&lt;code&gt;new Disruptor&amp;lt;&amp;gt;(Event&amp;lt;T&amp;gt;::new, bufferSize, factory, ProducerType.MULTI, new SleepingWaitStrategy(200, 1000 * 1000 / 10)); // 0.1 ms&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å…¶ä»–ç­‰å¾…ç­–ç•¥ï¼ˆWaitStrategyï¼‰ï¼Œæ¯”å¦‚ï¼š&lt;code&gt;com.lmax.disruptor.BlockingWaitStrategy&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸è¿‡è§£å†³æ–¹æ¡ˆä¹Ÿæœ‰å¾®å°çš„è´Ÿä½œç”¨ - éƒ¨åˆ†æ–°ä»»åŠ¡/&lt;code&gt;Event&amp;lt;T&amp;gt;&lt;/code&gt;å®ä¾‹çš„å¤„ç†æ—¶å»¶ä¼šå¢å¤§ï¼Œä½†åœ¨æˆ‘ä»¬çš„æ•°æ®æµå¤„ç†åœºæ™¯ä¸‹ï¼Œè¿™ç‚¹æ—¶å»¶å¢å¤§å¯¹ä¸šåŠ¡å®Œå…¨æ²¡æœ‰å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¿‡ï¼Œè¿™ä¸ªé—®é¢˜åº”è¯¥æ˜¯ä¸€ç›´å­˜åœ¨ï¼Œä¸ºä»€ä¹ˆè¿‘æœŸæ‰æ”¶åˆ°å‘Šè­¦ï¼Œä¸ºä»€ä¹ˆä»¥å‰ä»ç›‘æ§ä¸Šæœªå‘ç°ï¼Ÿ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸ºä»€ä¹ˆè¿‘æœŸæ‰æ”¶åˆ°å‘Šè­¦ï¼Ÿå› ä¸ºè¿™ä¸ªç›‘æ§å‘Šè­¦æ˜¯è¿‘æœŸå…¬å¸ç›‘æ§å¹³å°æ‰ç»Ÿä¸€é…ç½®çš„&lt;/li&gt;
&lt;li&gt;ä¸ºä»€ä¹ˆä»¥å‰ä»ç›‘æ§ä¸Šæœªå‘ç°ï¼Ÿå› ä¸ºå…¬å¸åˆ‡æ¢äº†æ–°çš„ç›‘æ§å¹³å°ï¼Œè€çš„ç›‘æ§å¹³å°æ²¡æœ‰ cpu.busy è¿™ä¸ªæŒ‡æ ‡ï¼Œè€Œè¿™äº›æ²¡ä»€ä¹ˆæ•°æ®è¦å¤„ç†çš„ä»»åŠ¡é•¿æ—¶é—´ä¸éœ€è¦å¼€å‘ç»´æŠ¤ï¼Œä¹Ÿå°±æœªå¾—åˆ°åŠæ—¶å…³æ³¨ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;æ‰©å±•èµ„æ–™&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;ä¸Šä¸‹æ–‡åˆ‡æ¢è€—æ—¶å¤šå°‘ï¼Ÿ&lt;a href="https://blog.tsunanet.net/2010/11/how-long-does-it-take-to-make-context.html"&gt;How long does it take to make a context switch?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;LockSupport.parkNanos(100)&lt;/code&gt; çœŸçš„å°±æ˜¯ç¡çœ  100 çº³ç§’å—ï¼Ÿ&lt;a href="https://hazelcast.com/blog/locksupport-parknanos-under-the-hood-and-the-curious-case-of-parking/"&gt;LockSupport.parkNanos() Under the Hood and the Curious Case of Parking&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="å…¶ä»–"></category><category term="é—®é¢˜æ’æŸ¥"></category><category term="Java"></category><category term="Disruptor"></category></entry><entry><title>å¦‚ä½•å‰–æ JVM åº”ç”¨ï¼ˆè¯‘ï¼‰</title><link href="http://youngsterxyf.github.io/2020/07/13/how-to-profile-jvm-applications/" rel="alternate"></link><published>2020-07-13T00:00:00+08:00</published><updated>2020-07-13T00:00:00+08:00</updated><author><name>xiayf</name></author><id>tag:youngsterxyf.github.io,2020-07-13:/2020/07/13/how-to-profile-jvm-applications/</id><summary type="html">&lt;p&gt;åŸæ–‡é“¾æ¥ï¼š&lt;a href="https://www.lightbend.com/blog/profiling-jvm-applications"&gt;How to profile JVM applications&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Hi å¤§å®¶å¥½ã€‚å·¥å…·å›¢é˜Ÿï¼ˆtooling teamï¼‰è¿‘æœŸçš„ä¸€ä¸ªå…³æ³¨ç‚¹æ˜¯æ”¹è¿› sbt è´¡çŒ®æµç¨‹ï¼ˆ improvement of the contribution process to sbtï¼‰ã€‚æˆ‘ä»¬ä¸€ç›´åœ¨æ€è€ƒçš„ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;åŸæ–‡é“¾æ¥ï¼š&lt;a href="https://www.lightbend.com/blog/profiling-jvm-applications"&gt;How to profile JVM applications&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Hi å¤§å®¶å¥½ã€‚å·¥å…·å›¢é˜Ÿï¼ˆtooling teamï¼‰è¿‘æœŸçš„ä¸€ä¸ªå…³æ³¨ç‚¹æ˜¯æ”¹è¿› sbt è´¡çŒ®æµç¨‹ï¼ˆ improvement of the contribution process to sbtï¼‰ã€‚æˆ‘ä»¬ä¸€ç›´åœ¨æ€è€ƒçš„å¦ä¸€ä¸ªäº‹æƒ…æ˜¯ sbt çš„æ€§èƒ½ã€‚ä¸ºä¸€ä¸¾è§£å†³è¿™ä¸¤ä»¶äº‹æƒ…ï¼Œæˆ‘è°ƒç ”äº† Jason Zauggã€Johannes Rudolph è¿™äº›äººå¦‚ä½•å‰–æ JVM åº”ç”¨ï¼Œè¿™ç¯‡æ–‡ç« å³æ˜¯è°ƒç ”ç»“æœã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œè®ºè¿°çš„æŠ€æœ¯åº”è¯¥å¯ä»¥åº”ç”¨äºJava å’Œ Scalaï¼Œä¹ŸåŸºæœ¬ä¸ä½ ä½¿ç”¨çš„å·¥å…·æ— å…³ã€‚&lt;/p&gt;
&lt;h2&gt;ç«ç„°å›¾ï¼ˆä½¿ç”¨ async-profiler ç”Ÿæˆï¼‰&lt;/h2&gt;
&lt;p&gt;å‰–æ JVM åº”ç”¨çš„æ–¹å¼æœ‰å¤šç§ï¼Œä½†æ–°æ™‹çƒ­é—¨æ˜¯Netflix é«˜çº§æ€§èƒ½æ¶æ„å¸ˆï¼ˆSenior Performance Architectï¼‰Brendan Gregg å‘æ˜çš„&lt;strong&gt;ç«ç„°å›¾&lt;/strong&gt;ã€‚å¼€å‘è€…å…ˆæ”¶é›†å †æ ˆè¸ªè¿¹æŠ½æ ·æ•°æ®ï¼ˆstack trace samplesï¼‰ï¼Œç„¶åå°†å…¶å¤„ç†æˆä¸€å¼ äº¤äº’å¼çš„ svg å›¾ã€‚è‹¥è¦å¿«é€Ÿäº†è§£ç«ç„°å›¾ï¼Œå¯é˜…è¯»å¦‚ä¸‹é“¾æ¥èµ„æ–™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=ugRrFdda_JQ"&gt;Using FlameGraphs To Illuminate The JVM by Nitsan Wakart&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=D53T1Ejig1Q"&gt;USENIX ATC â€™17: Visualizing Performance with Flame Graphs&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘æ¨èçš„ç¬¬ä¸€ä¸ªç«ç„°å›¾å·¥å…·æ˜¯  Andrei Pangin å‘èµ·çš„ async-profilerï¼Œåœ¨ macOS å’Œ Linux æ“ä½œç³»ç»Ÿç¯å¢ƒä¸‹å‡å¯ä½¿ç”¨ï¼Œä¸Šæ‰‹ä½¿ç”¨ä¹Ÿæ›´ç®€å•ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸‹è½½å®‰è£…å™¨ &lt;a href="https://github.com/jvm-profiling-tools/async-profiler/releases/tag/v1.2"&gt;async-profiler 1.2&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å‡è®¾ä½ çš„ç³»ç»Ÿä¸­å­˜åœ¨ä¸€ä¸ªå‘½ä»¤æŸ¥æ‰¾è·¯å¾„ &lt;code&gt;$HOME/bin&lt;/code&gt;ï¼Œåœ¨ &lt;code&gt;$HOME/bin&lt;/code&gt; ç›®å½•ä¸‹åˆ›å»ºç¬¦å·é“¾æ¥æŒ‡å‘ &lt;code&gt;build/&lt;/code&gt; å’Œ &lt;code&gt;profiler.sh&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ln -s ~/App/async-profiler/profiler.sh $HOME/bin/profiler.sh
ln -s ~/App/async-profiler/build $HOME/bin/build
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ¥ä¸‹æ¥ï¼Œå…³é—­æ‰€æœ‰ Java åº”ç”¨ï¼Œä»¥åŠä»»ä½•å¯èƒ½å½±å“å‰–æè¿‡ç¨‹çš„ä¸œè¥¿ï¼Œæ¯”å¦‚ Slackï¼Œç„¶ååœ¨ç»ˆç«¯ç¨‹åºï¼ˆterminalï¼‰ä¸­è¿è¡Œä½ çš„åº”ç”¨ã€‚å¯¹äºæˆ‘è€Œè¨€ï¼Œåˆ™æ˜¯å°è¯•å‰–æ &lt;code&gt;sbt&lt;/code&gt; çš„åˆå§‹åŒ–åŠ è½½è¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ sbt exit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­ï¼Œè¿è¡Œï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ jps
92746 sbt-launch.jar
92780 Jps
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç”±æ­¤æˆ‘ä»¬çŸ¥é“åº”ç”¨çš„è¿›ç¨‹ IDã€‚å¯¹äºæˆ‘è€Œè¨€ï¼Œç›®æ ‡è¿›ç¨‹ ID æ˜¯ &lt;code&gt;92746&lt;/code&gt;ã€‚åœ¨åº”ç”¨è¿è¡Œçš„åŒæ—¶ï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="border: 1px solid #FF0000"&gt;$&lt;/span&gt; profiler.sh -d 60 &amp;lt;process id&amp;gt;
Started [cpu] profiling
--- Execution profile ---
Total samples:         31602
Non-Java:              3239 (10.25%)
GC active:             46 (0.15%)
&lt;span style="color: #0000ff"&gt;Unknown&lt;/span&gt; (native)&lt;span style="border: 1px solid #FF0000"&gt;:&lt;/span&gt;      14667 (46.41%)
&lt;span style="color: #0000ff"&gt;Not&lt;/span&gt; walkable (native)&lt;span style="border: 1px solid #FF0000"&gt;:&lt;/span&gt; 3 (0.01%)
&lt;span style="color: #0000ff"&gt;Unknown&lt;/span&gt; (Java)&lt;span style="border: 1px solid #FF0000"&gt;:&lt;/span&gt;        433 (1.37%)
&lt;span style="color: #0000ff"&gt;Not&lt;/span&gt; walkable (Java)&lt;span style="border: 1px solid #FF0000"&gt;:&lt;/span&gt;   8 (0.03%)
Thread &lt;span style="color: #0000ff"&gt;exit&lt;/span&gt;&lt;span style="border: 1px solid #FF0000"&gt;:&lt;/span&gt;           1 (0.00%)
Deopt:                 9 (0.03%)

Frame buffer &lt;span style="color: #0000ff"&gt;usage&lt;/span&gt;&lt;span style="border: 1px solid #FF0000"&gt;:&lt;/span&gt;    55.658%

Total: 1932000000 (6.11%)  samples: 1932
  [ 0] java.lang.ClassLoader&lt;span style="border: 1px solid #FF0000"&gt;$&lt;/span&gt;NativeLibrary.&lt;span style="color: #0000ff"&gt;load&lt;/span&gt;
  [ 1] java.lang.ClassLoader.loadLibrary0
  [ 2] java.lang.ClassLoader.loadLibrary
  [ 3] java.lang.Runtime.loadLibrary0
  [ 4] java.lang.&lt;span style="color: #0000ff"&gt;System&lt;/span&gt;.loadLibrary
....
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å‘½ä»¤ä¼šè¾“å‡ºä¸€å¤§å †æœ‰ç”¨çš„å †æ ˆè·Ÿè¸ªä¿¡æ¯ï¼ˆstacktracesï¼‰ï¼Œä¸ºå°†è¿™äº›ä¿¡æ¯å¯è§†åŒ–ä¸ºä¸€å¼ ç«ç„°å›¾ï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;profiler.sh -d 60 -f /tmp/flamegraph.svg &amp;lt;process id&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å‘½ä»¤æœ€ååº”è¯¥ä¼šäº§å‡ºæ–‡ä»¶ &lt;code&gt;/tmp/flamegraph.svg&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="flamegraph" src="https://i.loli.net/2020/07/13/dZVkB9xq2Gy6NfA.png"&gt;&lt;/p&gt;
&lt;p&gt;ä½ è‡ªå·±æ¥ä½“éªŒä¸€ä¸‹ &lt;a href="https://downloads.lightbend.com/website/blog/2019/flamegraph.svg?_ga=2.187105832.1642569835.1594378538-197429397.1594378538"&gt;flamegraph.svg&lt;/a&gt; è¾“å‡ºçš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h2&gt;ç«ç„°å›¾ï¼ˆä½¿ç”¨ perf-map-agent ç”Ÿæˆï¼‰&lt;/h2&gt;
&lt;p&gt;è™½ç„¶ async-profiler ä¸Šæ‰‹ä½¿ç”¨å¾ˆç®€å•ï¼Œä½†ç«ç„°å›¾çœŸæ­£æœ‰è¶£ä¹‹å¤„åœ¨äºå¯ä»¥æ··åˆå±•ç° JVM å †æ ˆè¿½è¸ªå’ŒåŸç”Ÿä»£ç ï¼ˆnative codeï¼‰å †æ ˆè·Ÿè¸ªä¿¡æ¯ï¼Œè®©å¼€å‘è€…å¯ä»¥çœ‹åˆ° CPU å®é™…æ¶ˆè€—åœ¨ç¨‹åºçš„ä½•å¤„ã€‚Lightbend å…¬å¸çš„ Johannes Rudolph ä¸ºæ­¤å†™äº†ä¸€ä¸ªå·¥å…· - &lt;a href="https://github.com/jvm-profiling-tools/perf-map-agent"&gt;perf-map-agent&lt;/a&gt;ã€‚è¯¥å·¥å…·åœ¨ macOS ç¯å¢ƒä¸‹ä¼šä½¿ç”¨ &lt;code&gt;dtrace&lt;/code&gt;ï¼Œåœ¨ Linux ç¯å¢ƒä¸‹ä¼šä½¿ç”¨ &lt;code&gt;perf&lt;/code&gt;ã€‚å¦‚æœä½ æƒ³ç¡®è®¤ç“¶é¢ˆæ˜¯å¦å‡ºç°åœ¨åŸç”Ÿä»£ç ä¸­ï¼Œè¿™ä¸ªå·¥å…·ä¼šç‰¹åˆ«æœ‰ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆè¦ç¼–è¯‘ &lt;a href="https://github.com/jvm-profiling-tools/perf-map-agent"&gt;perf-map-agent&lt;/a&gt;ã€‚å¯¹äº macOS ç¯å¢ƒï¼Œåœ¨è¿è¡Œ &lt;code&gt;cmake .&lt;/code&gt; ä¹‹å‰éœ€è¦å…ˆè®¾ç½® &lt;code&gt;JAVA_HOME&lt;/code&gt; ç¯å¢ƒå˜é‡ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ cd work
$ git clone https://github.com/brendangregg/FlameGraph.git

$ git clone https://github.com/jvm-profiling-tools/perf-map-agent.git
$ cd perf-map-agent
$ export JAVA_HOME=&lt;span style="color: #0000ff"&gt;$(&lt;/span&gt;/usr/libexec/java_home&lt;span style="color: #0000ff"&gt;)&lt;/span&gt;
$ cmake .
-- The C compiler identification is AppleClang 9.0.0.9000039
-- The CXX compiler identification is AppleClang 9.0.0.9000039
...
$ make
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åœ¨ä¸€ä¸ªæ–°çš„ç»ˆç«¯ä¸­ï¼Œå¸¦ &lt;code&gt;-XX:+PreserveFramePointer&lt;/code&gt; æ ‡è®°å‚æ•°è¿è¡Œ sbtï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ sbt -J-Dsbt.launcher.standby=20s -J-XX:+PreserveFramePointer exit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­è¿è¡Œï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ cd quicktest/
$ export JAVA_HOME=&lt;span style="color: #0000ff"&gt;$(&lt;/span&gt;/usr/libexec/java_home&lt;span style="color: #0000ff"&gt;)&lt;/span&gt;
$ export FLAMEGRAPH_DIR=$HOME/work/FlameGraph
$ jps
94592 Jps
94549 sbt-launch.jar
$ $HOME/work/perf-map-agent/bin/dtrace-java-flames 94549
dtrace: system integrity protection is on, some features will not be available

dtrace: description &lt;span style="color: #a31515"&gt;&amp;#39;profile-99 &amp;#39;&lt;/span&gt; matched 2 probes
Flame graph SVG written to DTRACE_FLAME_OUTPUT=&lt;span style="color: #a31515"&gt;&amp;#39;/Users/xxx/work/quicktest/flamegraph-94549.svg&amp;#39;&lt;/span&gt;.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç†è®ºä¸Šè¿™æ ·ä¼šäº§å‡ºæ›´å…¨é¢çš„ç«ç„°å›¾ï¼Œä¸è¿‡å¯¹äº &lt;code&gt;sbt exit&lt;/code&gt;ï¼Œäº§å‡ºçš„ç«ç„°å›¾çœ‹èµ·æ¥å¯èƒ½æœ‰ç‚¹å‡Œä¹±ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="flamegraph-2" src="https://i.loli.net/2020/07/13/s9BbWAnluTPwE3J.png"&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœ sbt æ“ä½œå·²ç»ç»è¿‡å³æ—¶ç¼–è¯‘å™¨ä¼˜åŒ–ï¼ˆthe operations are already JITedï¼‰ï¼Œæˆ–è€…æ“ä½œæ¯”è¾ƒç‰¹æ®Šï¼ˆthe operation is more specificï¼‰ï¼Œé‚£ä¹ˆç«ç„°å›¾çš„æ•ˆæœä¼šæ›´å¥½ã€‚ä¸ºäº†å¾—åˆ°æ•ˆæœæ›´å¥½çš„ç«ç„°å›¾ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç›¸åŒçš„æ“ä½œå¤šé‡å¤å‡ æ¬¡ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ sbt -J-Dsbt.launcher.standby=20s -J-XX:+PreserveFramePointer reload reload reload reload exit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿™æ ·å°±å¯ä»¥äº§å‡ºç¨‹åºçš„ç¨³å®šæ€ç«ç„°å›¾ï¼Œé€æ­¥æ”¾å¤§ç«ç„°å›¾ï¼Œå°±å¯ä»¥æ‰¾åˆ°æ‰§è¡Œçš„çƒ­ç‚¹è·¯å¾„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="flamegraph-3" src="https://i.loli.net/2020/07/13/93YyjxR5ATS1Dnq.png"&gt;&lt;/p&gt;
&lt;h2&gt;Flamescope&lt;/h2&gt;
&lt;p&gt;Netflix å…¬å¸è¿‘æœŸå‘å¸ƒäº†ä¸€ä¸ªæ–°çš„ç«ç„°å›¾å¯è§†åŒ–å·¥å…· - &lt;a href="https://medium.com/netflix-techblog/netflix-flamescope-a57ca19d47bb"&gt;Flamescope&lt;/a&gt;ï¼Œå¯ä»¥å°†ç«ç„°å›¾è¿‡æ»¤é™åˆ¶åœ¨ä¸€ä¸ªç‰¹å®šçš„æ—¶é—´èŒƒå›´å†…ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="FlameScope" src="https://i.loli.net/2020/07/13/djm2hkvC98irQu7.png"&gt;&lt;/p&gt;
&lt;p&gt;Martin Spier å’Œ Brendan Gregg ä¸ºç ”ç©¶æ‰°åŠ¨ä»¥åŠå…¶ä»–æ—¶é—´ç›¸å…³çš„é—®é¢˜ï¼ˆperturbations and other time-based issuesï¼‰è€Œå¼€å‘äº†è¿™ä¸ªå·¥å…·ã€‚å¸¸è§„çš„ç«ç„°å›¾æ˜¯èšåˆäº†æ‰€æœ‰å †æ ˆè¿½è¸ªæŠ½æ ·æ•°æ®ï¼Œå¦‚æœç³»ç»Ÿä¸­å‘ç”Ÿäº†ä¸€ä¸ªçŸ­æ—¶å°æ•…éšœï¼Œå°±ä¼šè¢«æ·±åŸ‹äºå…¶ä»–è¿½è¸ªä¿¡æ¯ä¸­ï¼Œè¿™ä¸ªå·¥å…·å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;h2&gt;JMH (sbt-jmh)&lt;/h2&gt;
&lt;p&gt;å› ä¸º JIT å­˜åœ¨é¢„çƒ­ç­‰ç‰¹ç‚¹ï¼Œå¢å¤§äº†åŸºå‡†æµ‹è¯•çš„å›°éš¾ã€‚JMH ä¼šå°†ç›¸åŒçš„æµ‹è¯•è¿è¡Œå¤šæ¬¡ï¼Œæ¶ˆé™¤ JIT é¢„çƒ­ç­‰ç‰¹ç‚¹é€ æˆçš„å½±å“ï¼Œä»è€Œæ›´å‡†ç¡®åœ°æµ‹é‡ä»£ç çš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äº sbt ç”¨æˆ·è€Œè¨€ï¼ŒLightbend å…¬å¸ Konrad Malawski ç¼–å†™çš„ &lt;a href="https://github.com/ktoso/sbt-jmh"&gt;sbt-jmh&lt;/a&gt; è¿›ä¸€æ­¥ç®€åŒ–äº† JMH æµ‹è¯•ã€‚å¹¶ä¸”å®ƒä¹Ÿé›†æˆäº† async-profilerã€‚&lt;/p&gt;
&lt;h2&gt;VisualVM&lt;/h2&gt;
&lt;p&gt;æˆ‘ä¹Ÿæƒ³æä¸€ä¸‹ä¼ ç»Ÿçš„ JVM å‰–æå·¥å…·ã€‚å› ä¸º &lt;a href="https://visualvm.github.io/"&gt;VisualVM&lt;/a&gt; å¼€æºäº†ï¼Œæ‰€ä»¥å°±æ¥è¯´è¯´å®ƒã€‚&lt;/p&gt;
&lt;p&gt;1ã€å…ˆæ‰“å¼€ VisualVM
2ã€åœ¨ä¸€ä¸ªç»ˆç«¯ä¸­å¯åŠ¨ sbt
3ã€ä» VisualVM ç•Œé¢çš„ Local åº”ç”¨ç›®å½•ä¸‹åº”è¯¥å¯ä»¥çœ‹åˆ° &lt;code&gt;xsbt.boot.Boot&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="https://i.loli.net/2020/07/13/EB7vsuo1HjaTtQw.jpg"&gt;&lt;/p&gt;
&lt;p&gt;4ã€æ‰“å¼€å®ƒï¼Œé€‰æ‹© æŠ½æ ·åŠŸèƒ½ï¼ˆsamplerï¼‰ æˆ– å‰–æåŠŸèƒ½ï¼ˆprofilerï¼‰ï¼Œåœ¨ä½ æƒ³è¦å¼€å§‹çš„æ—¶é—´ç‚¹ç‚¹å‡» CPU æŒ‰é’®&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="https://i.loli.net/2020/07/13/aoiIDfMKw9pjY4Z.jpg"&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ å¯¹ &lt;a href="https://www.yourkit.com/"&gt;YourKit&lt;/a&gt; æ¯”è¾ƒç†Ÿæ‚‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒï¼Œç”¨æ³•æ¯”è¾ƒç›¸ä¼¼ã€‚&lt;/p&gt;
&lt;h2&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;ç«ç„°å›¾å¯¹å †æ ˆè·Ÿè¸ªæŠ½æ ·æ•°æ®è¿›è¡Œå¯è§†åŒ–ï¼Œæ–¹ä¾¿è¯†åˆ«åº”ç”¨ä»£ç ä¸­çš„çƒ­ç‚¹è·¯å¾„ã€‚ä¹Ÿæœ‰åŠ©äºç¡®è®¤ä»£ç å˜æ›´æ˜¯å¦å®é™…å½±å“äº†åº”ç”¨æ€§èƒ½ã€‚&lt;/p&gt;</content><category term="å…¶ä»–"></category><category term="ç¿»è¯‘"></category><category term="Java"></category><category term="å·¥å…·"></category><category term="é—®é¢˜æ’æŸ¥"></category></entry><entry><title>åšå®¢æ„å»ºç¯å¢ƒå‡†å¤‡</title><link href="http://youngsterxyf.github.io/2020/06/14/blog-build-env/" rel="alternate"></link><published>2020-06-14T00:00:00+08:00</published><updated>2020-06-14T00:00:00+08:00</updated><author><name>xiayf</name></author><id>tag:youngsterxyf.github.io,2020-06-14:/2020/06/14/blog-build-env/</id><summary type="html">&lt;p&gt;å¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´ã€‚&lt;/p&gt;
&lt;p&gt;1ã€Python è™šæ‹Ÿç¯å¢ƒ&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;virtualenv -p python3 ~/.py3
source ~/.py3/bin/activate
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;2ã€å®‰è£… Python ä¾èµ–åŒ…&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pip install pelican[Markdown]   &lt;span style="color: #008000"&gt;# å¯èƒ½éœ€è¦å…ˆå®‰è£… pipï¼šeasy_install pip&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;3ã€å®‰è£…ä¸»é¢˜åŒ…&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;git â€¦&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;å¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´ã€‚&lt;/p&gt;
&lt;p&gt;1ã€Python è™šæ‹Ÿç¯å¢ƒ&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;virtualenv -p python3 ~/.py3
source ~/.py3/bin/activate
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;2ã€å®‰è£… Python ä¾èµ–åŒ…&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pip install pelican[Markdown]   &lt;span style="color: #008000"&gt;# å¯èƒ½éœ€è¦å…ˆå®‰è£… pipï¼šeasy_install pip&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;3ã€å®‰è£…ä¸»é¢˜åŒ…&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;git clone https://github.com/youngsterxyf/my-pelican-themes.git ~/github/youngsterxyf/my-pelican-themes
pelican-themes -i ~/github/youngsterxyf/my-pelican-themes/my-gum
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;4ã€æ„å»º&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;make html
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;hr&gt;
&lt;p&gt;å¦ï¼Œæ›´æ–°è‰ºæœ¯å­—ä½“æˆ–å­—é›†ï¼š&lt;/p&gt;
&lt;p&gt;(1) ä¸‹è½½ fontmin-appï¼šhttps://github.com/ecomfe/fontmin-app&lt;/p&gt;
&lt;p&gt;(2) å¯¼å…¥å­—ä½“ SentyZHAOï¼ˆæ±‰ä»ªæ–°è’‚èµµå­Ÿé «ä½“ï¼‰ï¼šhttps://github.com/youngsterxyf/blog-content/blob/master/new-blog/SentyZHAO.ttf&lt;/p&gt;
&lt;p&gt;&lt;img alt="fontmin" src="https://i.loli.net/2020/06/14/Xn8b9kZDIfWoLmp.png"&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¦ï¼Œåæˆˆè¡Œä¹¦å­—ä½“è§ï¼šhttp://www.foundertype.com/index.php/FontInfo/index/id/5350&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;(3) ç”Ÿæˆå­—ä½“æ ·å¼ï¼Œå¹¶æ‹·è´æ›´æ–°åˆ°ç›®æ ‡ä¸»é¢˜åŒ…ç›®å½•ä¸­ï¼šhttps://github.com/youngsterxyf/my-pelican-themes/tree/master/my-gum/static&lt;/p&gt;
&lt;p&gt;(4) æ›´æ–°ä¸»é¢˜åŒ…ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pelican-themes -r my-gum
pelican-themes -i ~/github/youngsterxyf/my-pelican-themes
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;(5) é‡æ–°æ„å»ºç”Ÿæˆåšå®¢&lt;/p&gt;</content><category term="å…¶ä»–"></category></entry><entry><title>è¯»æ–‡ç¬”è®°ï¼šKafka å®˜æ–¹è®¾è®¡æ–‡æ¡£</title><link href="http://youngsterxyf.github.io/2019/10/13/reading-kafka-design/" rel="alternate"></link><published>2019-10-13T00:00:00+08:00</published><updated>2019-10-13T00:00:00+08:00</updated><author><name>xiayf</name></author><id>tag:youngsterxyf.github.io,2019-10-13:/2019/10/13/reading-kafka-design/</id><summary type="html">&lt;p&gt;åŸæ–‡ï¼š&lt;a href="http://kafka.apache.org/documentation/#design"&gt;http://kafka.apache.org/documentation/#design&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;æ•°æ®æŒä¹…åŒ–&lt;/h2&gt;
&lt;h4&gt;ä¸ç”¨æƒ§æ€•æ–‡ä»¶ç³»ç»Ÿ&lt;/h4&gt;
&lt;p&gt;ç£ç›˜çš„è¯»å†™é€Ÿåº¦ï¼Œå–å†³äºå¦‚ä½•è¯»å†™ã€‚å¯¹äºçº¿æ€§è¯»å†™æ–¹å¼ï¼Œæ“ä½œç³»ç»Ÿåšäº†å…… â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;åŸæ–‡ï¼š&lt;a href="http://kafka.apache.org/documentation/#design"&gt;http://kafka.apache.org/documentation/#design&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;æ•°æ®æŒä¹…åŒ–&lt;/h2&gt;
&lt;h4&gt;ä¸ç”¨æƒ§æ€•æ–‡ä»¶ç³»ç»Ÿ&lt;/h4&gt;
&lt;p&gt;ç£ç›˜çš„è¯»å†™é€Ÿåº¦ï¼Œå–å†³äºå¦‚ä½•è¯»å†™ã€‚å¯¹äºçº¿æ€§è¯»å†™æ–¹å¼ï¼Œæ“ä½œç³»ç»Ÿåšäº†å……åˆ†çš„ä¼˜åŒ–ï¼šæå‰è¯» - é¢„å–è‹¥å¹²æ•°æ®å—ï¼Œæ»åå†™ - å°†å°çš„é€»è¾‘å†™æ“ä½œåˆå¹¶æˆä¸€ä¸ªå¤§çš„ç‰©ç†å†™æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href="http://queue.acm.org/detail.cfm?id=1563874"&gt;ç ”ç©¶&lt;/a&gt;è¡¨æ˜ï¼š&lt;a href="http://deliveryimages.acm.org/10.1145/1570000/1563874/jacobs3.jpg"&gt;é¡ºåºè¯»å†™ç£ç›˜ï¼ˆsequential disk accessï¼‰çš„é€Ÿåº¦æœ‰äº›æ—¶å€™æ¯”éšæœºè®¿é—®å†…å­˜è¿˜è¦å¿«&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç°ä»£æ“ä½œç³»ç»Ÿæ¿€è¿›åœ°å°½å¯èƒ½å°†ç©ºé—²å†…å­˜ç”¨ä½œç£ç›˜ç¼“å­˜ã€‚æ‰€æœ‰ç£ç›˜è¯»å†™éƒ½ç»è¿‡æ“ä½œç³»ç»Ÿæä¾›çš„ç»Ÿä¸€ç¼“å­˜ã€‚è¿™ä¸ªç‰¹æ€§æ²¡æ³•è½»æ˜“å…³é—­ï¼Œé™¤éç›´æ¥ I/O ï¼ˆdirect I/Oï¼‰ï¼Œå› æ­¤ï¼Œå¦‚æœç¨‹åºåœ¨ç”¨æˆ·è¿›ç¨‹ä¸­è¿›è¡Œæ•°æ®ç¼“å­˜ï¼Œç¼“å­˜çš„æ•°æ®é€šå¸¸ä¹Ÿæ˜¯å’Œæ“ä½œç³»ç»Ÿé¡µç¼“å­˜é‡å¤çš„ï¼Œç¼“å­˜ä¸¤éï¼Œæ²¡å•¥æ„ä¹‰ï¼Œä¹Ÿæµªè´¹å†…å­˜ã€‚&lt;/p&gt;
&lt;p&gt;è€Œä¸”ï¼ŒKafka æ˜¯æ„å»ºåœ¨ JVM ä¹‹ä¸Šçš„ï¼Œäº†è§£ Java å†…å­˜ä½¿ç”¨æ–¹å¼çš„äººåº”è¯¥éƒ½çŸ¥é“ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¯¹è±¡çš„å†…å­˜å¼€é”€éå¸¸é«˜ï¼Œé€šå¸¸æ˜¯å®é™…æ•°æ®å¤§å°çš„2å€ï¼ˆç”šè‡³æ›´å¤šï¼‰&lt;/li&gt;
&lt;li&gt;éšç€å †ä¸Šæ•°æ®é‡å¢å¤§ï¼ŒJava çš„ GC è¡¨ç°ä¹Ÿä¼šæ›´ç³Ÿç³•&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å› æ­¤ï¼Œä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿå¹¶ä¾èµ–äºæ“ä½œç³»ç»Ÿå†…å­˜é¡µç¼“å­˜ï¼Œä¼˜äºåœ¨ç¨‹åºä¸­ç»´æŠ¤ä¸€å—å†…å­˜ç¼“å­˜æˆ–å…¶å®ƒç»“æ„ã€‚è‡³å°‘æ“ä½œç³»ç»Ÿå†…å­˜é¡µç¼“å­˜çš„å¯ç”¨å†…å­˜ç¿»å€äº†ã€‚å¦å¤–ï¼Œå¦‚æœä½¿ç”¨ç´§å‡‘çš„å­—èŠ‚ç»“æ„æ¥ç¼“å­˜æ•°æ®ï¼Œç›¸æ¯”ä½¿ç”¨å¯¹è±¡ï¼Œå¯ç”¨å†…å­˜å¯èƒ½è¿˜ä¼šç¿»å€ã€‚åœ¨ 32GB å†…å­˜çš„æœºå™¨ä¸Šè¿™ä¹ˆæï¼Œç¼“å­˜å¯ç”¨åˆ° 20-30GBï¼Œè¿˜ä¸ä¼šå¯¹ GC é€ æˆäº†ä»€ä¹ˆåå½±å“ã€‚å¹¶ä¸”ï¼Œå³ä½¿æœåŠ¡é‡å¯ï¼Œè¿™å—ç¼“å­˜ç©ºé—´ä¹Ÿæ˜¯çƒ­çš„ï¼ˆé™¤éæœºå™¨é‡å¯ï¼‰ï¼Œç”¨æˆ·è¿›ç¨‹å†…çš„å†…å­˜ç¼“å­˜åœ¨æœåŠ¡é‡å¯åå¾—é‡å»ºï¼ˆ10GBçš„æ•°æ®ç¼“å­˜å¯èƒ½éœ€è¦10åˆ†é’Ÿå·¦å³ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ ·ä¹Ÿå¯ä»¥ç®€åŒ–ä»£ç é€»è¾‘ï¼Œå› ä¸ºç¼“å­˜å’Œæ–‡ä»¶ç³»ç»Ÿä¹‹é—´çš„ä¸€è‡´æ€§ç”±æ“ä½œç³»ç»Ÿæ¥ä¿è¯äº†ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ ·ä¸€åˆ†æï¼Œè®¾è®¡å°±ç®€å•äº†ï¼šæˆ‘ä»¬åå…¶é“è€Œè¡Œä¹‹ï¼Œæ‰€æœ‰æ•°æ®éƒ½ç›´æ¥å†™åˆ°æ–‡ä»¶ç³»ç»Ÿä¸ŠæŒä¹…åŒ–æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œä¸éœ€è¦åœ¨ç¨‹åºä¸­ä½¿ç”¨å†…å­˜ç¼“å­˜ï¼Œä¹Ÿä¸å¿…ç¡®ä¿å°†æ•°æ®åˆ·åˆ°ç£ç›˜ã€‚è¿™å®é™…æ„å‘³ç€æ•°æ®è½¬ç§»åˆ°äº†å†…æ ¸çš„å†…å­˜é¡µç¼“å­˜ã€‚&lt;/p&gt;
&lt;h4&gt;å¸¸é‡æ—¶é—´å°±èƒ½æå®š&lt;/h4&gt;
&lt;p&gt;B æ ‘çš„ O(log N) æ—¶é—´å¤æ‚åº¦ï¼Œå¯¹äºç£ç›˜æ“ä½œæ¥è¯´ï¼Œå¹¶ä¸èƒ½ç­‰åŒäºå¸¸é‡æ—¶é—´å¤æ‚åº¦ã€‚&lt;/p&gt;
&lt;p&gt;Kafka é‡‡ç”¨æ—¥å¿—æ–‡ä»¶æ–¹å¼ï¼Œç¡®ä¿è¯»å†™æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ã€‚&lt;/p&gt;
&lt;p&gt;Kafka ä¸ä¼šåœ¨æ¶ˆæ¯ä¸€è¢«æ¶ˆè´¹å°±ç«‹å³åˆ é™¤ï¼Œè€Œæ˜¯ä¿ç•™ä¸€æ®µæ—¶é—´ï¼Œè¿™æ ·å¯¹äºæ¶ˆè´¹è€…æ¥è¯´ä¹Ÿæ›´çµæ´»ä¸€äº›ã€‚&lt;/p&gt;
&lt;h2&gt;æ•ˆç‡&lt;/h2&gt;
&lt;p&gt;å¯¹äº Kafka è¿™ç±»ç³»ç»Ÿè€Œè¨€ï¼Œå³ä½¿åƒå‰è¿°é‚£æ ·æ¶ˆé™¤äº†ç³Ÿç³•çš„ç£ç›˜è®¿é—®æ¨¡å¼ï¼Œä¹Ÿä¼šé‡åˆ°ä¸¤ä¸ªå¯¼è‡´æ•°æ®æ•ˆç‡ä½çš„é—®é¢˜ï¼š&lt;strong&gt;è¿‡å¤šçš„å° I/O æ“ä½œ&lt;/strong&gt;ï¼Œä»¥åŠ&lt;strong&gt;è¿‡å¤šçš„å­—èŠ‚æ‹·è´&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å° I/O é—®é¢˜åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´ï¼Œä»¥åŠæœåŠ¡ç«¯å†…éƒ¨çš„æ•°æ®æŒä¹…åŒ–æ“ä½œä¸­éƒ½ä¼šå‘ç”Ÿã€‚å¯¹æ­¤ï¼ŒKafka åè®®å»ºç«‹åœ¨ â€œæ¶ˆæ¯é›†â€ ï¼ˆå³ä¸€æ‰¹æ¶ˆæ¯ï¼‰çš„æŠ½è±¡ä¹‹ä¸Šï¼Œè¿™æ ·ç½‘ç»œè¯·æ±‚è¯»å†™çš„æ˜¯ä¸€æ‰¹ä¸€æ‰¹çš„æ¶ˆæ¯ï¼Œå‡å°‘äº†ç½‘ç»œå¾€è¿”çš„æ—¶é—´å¼€é”€ï¼ˆæ³¨ï¼šæ¶ˆæ¯å¤„ç†çš„å®æ—¶æ€§ä¼šç›¸å¯¹å·®ä¸€ç‚¹ï¼‰ã€‚æœåŠ¡ç«¯ä¹Ÿæ˜¯ä¸€æ¬¡å°†ä¸€æ‰¹æ¶ˆæ¯å†™åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œæ¶ˆè´¹è€…ä¹ŸæŒ‰åºä¸€æ¬¡è·å–ä¸€æ‰¹æ¶ˆæ¯ã€‚è¿™ä¸€ç®€å•çš„ä¼˜åŒ–å¯ä»¥å°†ååèƒ½åŠ›æå‡å‡ ä¸ªæ•°é‡çº§ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºè¿‡å¤šçš„å­—èŠ‚æ‹·è´é—®é¢˜ï¼Œåœ¨æ¶ˆæ¯é‡å¤§çš„æ—¶å€™ï¼Œå½±å“æ¯”è¾ƒæ˜æ˜¾ã€‚Kafka é‡‡ç”¨äº†ä¸€ç§æ ‡å‡†åŒ–çš„äºŒè¿›åˆ¶æ¶ˆæ¯æ ¼å¼ï¼Œproducerã€brokerã€consumer éƒ½ä½¿ç”¨è¿™ç§æ ¼å¼ï¼Œè¿™æ ·æ•°æ®å—åœ¨ä¼ è¾“æœŸé—´ä¸éœ€è¦å˜åŠ¨ã€‚&lt;/p&gt;
&lt;p&gt;broker ç»´æŠ¤çš„æ¶ˆæ¯æ—¥å¿—åªæ˜¯ä¸€ä¸ªç›®å½•ä¸‹çš„ä¸€å †æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹æ˜¯æŒ‰åºå†™å…¥çš„æ¶ˆæ¯é›†ï¼Œæ¶ˆæ¯é›†çš„æ•°æ®æ ¼å¼åŒäº producerã€consumer ä½¿ç”¨çš„ã€‚å…±ç”¨ä¸€ç§æ•°æ®æ ¼å¼æ–¹ä¾¿äº†ä¸€ä¸ªé‡è¦çš„æ“ä½œä¼˜åŒ–ï¼šæŒä¹…åŒ–æ—¥å¿—å—çš„ç½‘ç»œä¼ è¾“ã€‚å¯¹äºä»å†…å­˜é¡µç¼“å­˜ï¼ˆpagecacheï¼‰åˆ°ç½‘ç»œå¥—æ¥å­—ï¼ˆsocketï¼‰çš„æ•°æ®ä¼ è¾“æ“ä½œï¼Œç°ä»£ UNIX æ“ä½œç³»ç»Ÿæä¾›äº†ä¸€ç§é«˜åº¦ä¼˜åŒ–çš„ä»£ç æ‰§è¡Œè·¯å¾„ã€‚Linux ä¸­ä½¿ç”¨ &lt;a href="http://man7.org/linux/man-pages/man2/sendfile.2.html"&gt;sendfile ç³»ç»Ÿè°ƒç”¨&lt;/a&gt; å¯ä»¥åˆ©ç”¨è¿™ä¸ªä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;è¦ç†è§£ sendfile çš„æ”¶ç›Šï¼Œéœ€è¦å…ˆç†è§£ä»æ–‡ä»¶åˆ°å¥—æ¥å­—ä¼ è¾“æ•°æ®çš„å¸¸è§„ä»£ç æ‰§è¡Œè·¯å¾„ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ“ä½œç³»ç»Ÿä»ç£ç›˜å°†æ•°æ®è¯»åˆ°å†…æ ¸ç©ºé—´çš„å†…å­˜é¡µç¼“å­˜ï¼ˆpagecacheï¼‰&lt;/li&gt;
&lt;li&gt;åº”ç”¨ç¨‹åºä»å†…æ ¸ç©ºé—´å‡æ•°æ®è¯»åˆ°ç”¨æˆ·ç©ºé—´ç¼“å†²åŒº&lt;/li&gt;
&lt;li&gt;åº”ç”¨ç¨‹åºå°†æ•°æ®ä»ç”¨æˆ·ç©ºé—´ç¼“å†²åŒºè¯»åˆ°å†…æ ¸ç©ºé—´çš„å¥—æ¥å­—ç¼“å†²åŒº&lt;/li&gt;
&lt;li&gt;æ“ä½œç³»ç»Ÿå°†æ•°æ®ä»å¥—æ¥å­—ç¼“å†²åŒºè¯»åˆ° NIC ç¼“å†²åŒºï¼Œç½‘å¡ä» NIC ç¼“å†²åŒºè¯»å–æ•°æ®é€šè¿‡ç½‘ç»œå‘å‡ºå»&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™ä¸€ä»£ç æ‰§è¡Œè·¯å¾„ï¼Œæ¶‰åŠ 4 æ¬¡æ•°æ®æ‹·è´å’Œ 2 æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼Œå¾ˆæ˜¾ç„¶æ˜¯ä½æ•ˆçš„ã€‚ä½¿ç”¨ sendfileï¼Œå¯ä»¥é¿å…å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´ä¹‹é—´ä¸€äº›ä¸å¿…è¦çš„æ•°æ®æ‹·è´ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥ç›´æ¥å°†æ•°æ®ä»å†…å­˜é¡µç¼“å­˜å‘é€åˆ°ç½‘ç»œã€‚&lt;/p&gt;
&lt;p&gt;è¿›ä¸€æ­¥äº†è§£ sendfile ä»¥åŠ Java å¹³å°å¦‚ä½•æ”¯æŒé›¶æ‹·è´ï¼Œå¯ä»¥é˜…è¯»&lt;a href="https://developer.ibm.com/articles/j-zerocopy/"&gt;è¿™ç¯‡æ–‡ç« &lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2&gt;ç”Ÿäº§è€…ï¼ˆThe Producerï¼‰&lt;/h2&gt;
&lt;h4&gt;è´Ÿè½½å‡è¡¡&lt;/h4&gt;
&lt;p&gt;æ¶ˆæ¯åº”è¯¥å‘åˆ°å“ªä¸ªåˆ†åŒºï¼ˆpartitionï¼‰ç”±å®¢æˆ·ç«¯æ ¹æ®å“ˆå¸Œç®—æ³•ï¼ˆæˆ–è€…éšæœºï¼‰å†³å®šï¼Œå¹¶ä¸”æ¶ˆæ¯æ˜¯ç›´æ¥ç”± producer å‘åˆ°ç›®æ ‡åˆ†åŒºçš„ leader brokerï¼Œæ²¡æœ‰ä»»ä½•ä¸­é—´è·¯ç”±å±‚ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰ Kafka èŠ‚ç‚¹éƒ½å¯ä»¥å“åº”å…ƒæ•°æ®è¯·æ±‚ - å‘ŠçŸ¥å®¢æˆ·ç«¯ï¼ˆproducer æˆ– consumerï¼‰å“ªäº›æœåŠ¡èŠ‚ç‚¹è¿˜å­˜æ´»ä»¥åŠæŸä¸ª topic çš„å„ä¸ªåˆ†åŒº leader åˆ†åˆ«æ˜¯å“ªä¸ªèŠ‚ç‚¹ï¼ˆç–‘æƒ‘ï¼šå¦‚æœæŸä¸ªåˆ†åŒº leader èŠ‚ç‚¹æŒ‚æ‰ä¹‹åï¼Œå®¢æˆ·ç«¯å¦‚ä½•è·çŸ¥ï¼Ÿä½•æ—¶å¯ä»¥è·çŸ¥ï¼Ÿï¼‰&lt;/p&gt;
&lt;h2&gt;æ¶ˆæ¯äº¤ä»˜è¯­ä¹‰&lt;/h2&gt;
&lt;p&gt;producer å’Œ consumer ä¹‹é—´çš„æ¶ˆæ¯äº¤ä»˜è¯­ä¹‰ï¼Œåˆ† 3 ç§ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æœ€å¤šæ¶ˆè´¹ä¸€æ¬¡ - æ¶ˆæ¯å¯èƒ½ä¼šä¸¢å¤±ï¼Œä½†ä¸ä¼šè¢«é‡å¤æ¶ˆè´¹&lt;/li&gt;
&lt;li&gt;æœ€å°‘æ¶ˆè´¹ä¸€æ¬¡ - æ¶ˆæ¯ä¸ä¼šä¸¢ï¼Œä½†å¯èƒ½è¢«é‡å¤æ¶ˆè´¹&lt;/li&gt;
&lt;li&gt;ä»…æ¶ˆè´¹ä¸€æ¬¡ - æ¯ä¸ªæ¶ˆæ¯éƒ½ä¼šè¢«æ¶ˆè´¹ä¸”ä»…æ¶ˆè´¹ä¸€æ¬¡&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™ä¸ªé—®é¢˜å¯ä»¥åˆ†æˆä¸¤ä¸ªé˜¶æ®µçš„é—®é¢˜ï¼š&lt;strong&gt;producer å‘ broker å‘å¸ƒä¸€ä¸ªæ¶ˆæ¯æ—¶çš„æŒä¹…æ€§ä¿è¯&lt;/strong&gt; ä»¥åŠ &lt;strong&gt;consumer æ¶ˆè´¹ä¸€ä¸ªæ¶ˆæ¯æ—¶çš„è¯­ä¹‰ä¿è¯&lt;/strong&gt; ï¼ˆthe durability guarantees for publishing a message and the guarantees when consuming a messageï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;producer å‘ Kafka é›†ç¾¤å‘æ¶ˆæ¯æ—¶ï¼Œä¼šæä¾›ä¸€ä¸ªè¯·æ±‚å‚æ•° &lt;code&gt;acks&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;acks=0ï¼šè¡¨ç¤º producer ä¸éœ€è¦ç­‰åˆ†åŒº leader broker è¿”å›ä»»ä½•å“åº”ï¼Œå°†æ¶ˆæ¯å­˜å…¥å¥—æ¥å­—ç¼“å†²åŒºï¼ˆsocket bufferï¼‰å°±å½“åšæ¶ˆæ¯å·²ç»å‘é€æˆåŠŸã€‚æ‰€ä»¥å¯é æ€§æ˜¯æ²¡æœ‰ä¿è¯çš„ã€‚&lt;/li&gt;
&lt;li&gt;acks=1ï¼šè¡¨ç¤º åˆ†åŒº leader broker å°†æ¶ˆæ¯å†™å…¥è‡ªå·±çš„æœ¬åœ°æ—¥å¿—æ–‡ä»¶ï¼Œå°±å‘ producer å“åº”æˆåŠŸï¼Œä¸å¿…ç­‰å¾…åˆ†åŒºå‰¯æœ¬ broker åŒæ­¥å¥½æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;li&gt;acks=-1 æˆ– acks=allï¼šè¡¨ç¤º åˆ†åŒº leader broker éœ€è¦ç­‰å¾…æ‰€æœ‰åŒæ­¥å‰¯æœ¬ broker åŒæ­¥å¥½æ¶ˆæ¯å¹¶å“åº”æˆåŠŸï¼Œæ‰å‘ producer å“åº”æˆåŠŸ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç¬¬ 2 ç§æƒ…å†µï¼Œå¦‚æœåˆ†åŒº leader broker æŒ‚æ‰/ä¸å­˜æ´»ï¼Œåˆ™å‰¯æœ¬æœªæ¥å¾—åŠåŒæ­¥çš„æ¶ˆæ¯ä¼šä¸¢å¤±ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ 3 ç§æƒ…å†µï¼Œåªè¦æœ‰åŒæ­¥å‰¯æœ¬æ­£å¸¸åŒæ­¥æ¶ˆæ¯ï¼Œé‚£ä¹ˆå³ä½¿ leader æŒ‚äº†ä¹Ÿä¸ä¼šä¸¢æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœ leader è¢«ç³»ç»Ÿåˆ¤å®šä¸ºä¸å­˜æ´»ï¼Œåˆ™ä¼šä»ï¼ˆåŒæ­¥ï¼‰å‰¯æœ¬ä¸­é€‰ä¸¾ä¸€ä¸ªæ–°çš„ leaderï¼Œé‚£ä¹ˆ Kafka å¦‚ä½•åˆ¤å®šä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦å­˜æ´»ï¼Ÿå­˜æ´»åˆ¤å®šä¾èµ– 2 ä¸ªæ¡ä»¶ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;èŠ‚ç‚¹å¿…é¡»ç»´æŒä¸ Zookeeper çš„ session è¿æ¥ï¼ˆé€šè¿‡ Zookeeper çš„å¿ƒè·³æœºåˆ¶ï¼‰&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯ä¸€ä¸ªä»èŠ‚ç‚¹ï¼ˆfollowerï¼‰ï¼Œåˆ™å¿…é¡»ä¸æ–­ä» leader èŠ‚ç‚¹åŒæ­¥æ¶ˆæ¯æ•°æ®ï¼Œä¸”åŒæ­¥è¿›åº¦æ²¡æœ‰è½åå¤ªå¤š&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¦‚æœ producer åœ¨å‘é€æ¶ˆæ¯çš„è¿‡ç¨‹ä¸­å‘ç”Ÿç½‘ç»œé—®é¢˜ï¼Œå®ƒæ²¡æ³•åˆ¤å®šåˆ†åŒº leader æ˜¯å¦æ”¶åˆ°æ¶ˆæ¯ã€‚0.11.0.0 ç‰ˆæœ¬ä¹‹å‰ï¼Œproducer åªèƒ½é‡å‘æ¶ˆæ¯ï¼Œåˆ«æ— ä»–æ³•ï¼Œå› æ­¤åªèƒ½æä¾›â€œæœ€å°‘æ¶ˆè´¹ä¸€æ¬¡çš„â€äº¤ä»˜è¯­ä¹‰ã€‚0.11.0.0 ç‰ˆæœ¬ä¹‹åï¼ŒKafka producer æ”¯æŒä¸€ä¸ªå¹‚ç­‰äº¤ä»˜åŠŸèƒ½é€‰é¡¹ï¼Œå¯ä»¥ç¡®ä¿æ¶ˆæ¯é‡å‘ä¸ä¼šå¯¼è‡´ Kafka çš„æ¶ˆæ¯æ—¥å¿—ä¸­å‡ºç°é‡å¤çš„æ¡ç›®ï¼šbroker ä¸ºæ¯ä¸ª producer åˆ†é…ä¸€ä¸ª IDï¼Œç„¶ååŸºäºæ¶ˆæ¯åºå·æ¥å»é‡ã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿæ˜¯ä» 0.11.0.0 ç‰ˆæœ¬å¼€å§‹ï¼ŒProducer æ”¯æŒä»¥ç±»äº‹åŠ¡çš„è¯­ä¹‰å‘å¤šä¸ª topic åˆ†åŒºå‘é€æ¶ˆæ¯ï¼šè¦ä¹ˆæ‰€æœ‰æ¶ˆæ¯éƒ½å‘é€æˆåŠŸï¼Œè¦ä¹ˆéƒ½ä¸æˆåŠŸã€‚è¿™ä¸ªèƒ½åŠ›ä¸»è¦ç”¨äºå®ç° Kafka topic ä¹‹é—´çš„ä»…å¤„ç†ä¸€æ¬¡è¯­ä¹‰ã€‚&lt;/p&gt;
&lt;p&gt;ä» consumer è§’åº¦æ¥çœ‹ï¼ŒåŒä¸€ä¸ªåˆ†åŒºçš„æ‰€æœ‰å‰¯æœ¬ï¼Œæ—¥å¿—æ•°æ®ç›¸åŒï¼Œæ¶ˆè´¹è¿›åº¦ä¹Ÿä¸€æ ·ã€‚consumer å¯ä»¥æ§åˆ¶è‡ªå·±å¯¹åˆ†åŒºæ—¥å¿—æ•°æ®çš„æ¶ˆè´¹ä½ç½®ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœ consumer è¯»å–æ¶ˆæ¯åï¼Œå…ˆå‘ kafka æäº¤æ¶ˆè´¹ä½ç½®ï¼Œå†å¤„ç†æ¶ˆæ¯ï¼›å¦‚æœè¯¥ consumer æŒ‚æ‰æˆ–é‡å¯ï¼Œä¼šå¯èƒ½å¯¼è‡´ä¸¢æ¶ˆæ¯ï¼Œä»è€Œåªèƒ½æ»¡è¶³â€œæœ€å¤šå¤„ç†ä¸€æ¬¡â€äº¤ä»˜è¯­ä¹‰ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœ consumer è¯»å–æ¶ˆæ¯åï¼Œæ˜¯å…ˆå¤„ç†ï¼Œå†æäº¤æ¶ˆè´¹ä½ç½®ï¼›å¦‚æœè¯¥ consumer æŒ‚æ‰æˆ–é‡å¯ï¼Œåˆ™å¯èƒ½å¯¼è‡´é‡å¤æ¶ˆè´¹æ¶ˆæ¯ï¼Œä»è€Œåªèƒ½æ»¡è¶³â€œæœ€å°‘å¤„ç†ä¸€æ¬¡â€äº¤ä»˜è¯­ä¹‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¦‚ä½•å®ç°â€œä»…å¤„ç†ä¸€æ¬¡â€è¯­ä¹‰ï¼Ÿå€ŸåŠ© Producer çš„äº‹åŠ¡èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;h2&gt;å¤åˆ¶&lt;/h2&gt;
&lt;p&gt;å¤åˆ¶çš„ç²’åº¦/å•å…ƒæ˜¯ topic åˆ†åŒºã€‚Kafka é›†ç¾¤ä¸­ï¼Œæ¯ä¸ªåˆ†åŒºéƒ½æœ‰ä¸€ä¸ª leader broker èŠ‚ç‚¹ï¼Œ0ä¸ªæˆ–å¤šä¸ªä»èŠ‚ç‚¹ï¼ˆfollowerï¼‰ã€‚åˆ†åŒºè¯»å†™éƒ½æ˜¯ç”± leader broker å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚åŒä¸€ä¸ªæ™®é€šçš„ consumerï¼Œä»èŠ‚ç‚¹ä» leader broker æ‹‰å–ï¼ˆpullï¼‰æ¶ˆæ¯ï¼Œç„¶åå†™åˆ°è‡ªå·±çš„æ¶ˆæ¯æ—¥å¿—æ–‡ä»¶ä¸­ã€‚è®©ä»èŠ‚ç‚¹ä»¥ pull çš„æ–¹å¼è·å– leader çš„æ¶ˆæ¯æ•°æ®ï¼Œå¥½å¤„åœ¨äºæ‰¹é‡è¯»å†™ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äº follower èŠ‚ç‚¹è€Œè¨€ï¼Œâ€œæ˜¯å¦å­˜æ´»â€çš„å®é™…å«ä¹‰æ˜¯â€œæ˜¯å¦é¡ºåˆ©åœ°ä» leader åŒæ­¥æ¶ˆæ¯â€ï¼Œleader èŠ‚ç‚¹ä¼šè¿½è¸ªâ€œåŒæ­¥ä¸­â€èŠ‚ç‚¹é›†ï¼ˆISRsï¼‰ã€‚å¦‚æœä¸€ä¸ª follower æŒ‚æ‰äº†/å¡ä½äº†/åŒæ­¥è½åå¤ªå¤šäº†ï¼Œåˆ™å°†å…¶ä»è¿™ä¸ª ISRs ä¸­ç§»é™¤ã€‚follow æ˜¯å¦å¡ä½æˆ–è€…åŒæ­¥è½åå¤ªå¤šï¼Œä¾æ® &lt;code&gt;replica.lag.time.max.ms&lt;/code&gt; é…ç½®å‚æ•°åˆ¤å®šã€‚&lt;/p&gt;
&lt;p&gt;å°†æŸæ¶ˆæ¯å†™åˆ°æŸä¸ªåˆ†åŒºï¼Œå¦‚æœè¯¥åˆ†åŒºæ‰€æœ‰åŒæ­¥ä¸­å‰¯æœ¬éƒ½å·²ç»å°†è¯¥æ¶ˆæ¯å†™åˆ°è‡ªå·±çš„æ¶ˆæ¯æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œåˆ™å¯ä»¥è®¤ä¸ºè¯¥æ¶ˆæ¯çš„å†™æ“ä½œå·²æäº¤ï¼ˆcommittedï¼‰ï¼Œä¹Ÿå°±æ˜¯çœŸæ­£çš„å†™æˆåŠŸã€‚&lt;/p&gt;
&lt;p&gt;åªæœ‰å†™æäº¤çš„æ¶ˆæ¯æ‰ä¼šåˆ†å‘ç»™ consumerã€‚&lt;/p&gt;
&lt;p&gt;producer å¯ä»¥é€‰æ‹©æ˜¯å¦ç­‰å¾…æ¶ˆæ¯å†™æ“ä½œæäº¤ï¼Œåœ¨å»¶è¿Ÿï¼ˆlatencyï¼‰å’ŒæŒä¹…æ€§ï¼ˆdurabilityï¼‰ä¹‹é—´æƒè¡¡ã€‚&lt;/p&gt;
&lt;p&gt;Kafka é›†ç¾¤åœ¨æŸåˆ†åŒºçš„ leader èŠ‚ç‚¹æŒ‚æ‰ä¹‹åï¼Œä¼šå¿«é€Ÿè¿›è¡Œå¤±è´¥è½¬ç§»ï¼ˆa short fail-over periodï¼‰ï¼Œé€‰ä¸¾å‡ºæ–°çš„åˆ†åŒº leader èŠ‚ç‚¹ï¼Œå¯ç”¨æ€§ä¸ä¼šå—åˆ°å½±å“ã€‚ä½†å¦‚æœå‘ç”Ÿç½‘ç»œåˆ†åŒºï¼ˆnetwork partitionsï¼‰é—®é¢˜ï¼Œåˆ™æ— æ³•ä¿è¯å¯ç”¨æ€§ã€‚CAP - Cï¼ˆConsistencyï¼‰ï¼šä¸€è‡´æ€§ï¼ŒAï¼ˆAvailabilityï¼‰ï¼šå¯ç”¨æ€§ï¼ŒPï¼ˆPartition Toleranceï¼‰ï¼šåˆ†åŒºå®¹é”™æ€§ - æ”¾å¼ƒäº† åˆ†åŒºå®¹é”™æ€§ã€‚&lt;/p&gt;
&lt;h4&gt;æ—¥å¿—æ•°æ®å¤åˆ¶ï¼šä»²è£æˆå‘˜é›†ï¼ˆQuorumsï¼‰ã€åŒæ­¥ä¸­å‰¯æœ¬é›†ï¼ˆISRsï¼‰å’ŒçŠ¶æ€æœº&lt;/h4&gt;
&lt;p&gt;ï¼ˆå¤‡æ³¨ï¼šè¿™ä¸€èŠ‚æˆ‘ç†è§£å¾—è¿˜ä¸å¤ªé€å½»ã€‚ï¼‰&lt;/p&gt;
&lt;p&gt;ä¸€ç±»å¸¸è§çš„åˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯ä¸»ä»æ¨¡å¼çš„ï¼Œç”±ä¸»èŠ‚ç‚¹å†³å®šçŠ¶æ€å˜åŒ–çš„é¡ºåºï¼ˆthe order of a series of valuesï¼‰ã€‚ä»èŠ‚ç‚¹é€šè¿‡æ—¥å¿—å¤åˆ¶ï¼ˆreplicated logï¼‰æ–¹å¼åŒæ­¥çŠ¶æ€æ•°æ®ã€‚å¯¹äºæäº¤å†³ç­–ï¼ˆcommit decisionï¼‰å’Œé€‰ä¸»ï¼ˆleader electionï¼‰ï¼Œé€šå¸¸æ˜¯åŸºäºå¤šæ•°äººæŠ•ç¥¨çš„æœºåˆ¶ã€‚å‡è®¾å‰¯æœ¬ä¸ªæ•°ï¼ˆæ³¨ï¼šä¸ªäººç†è§£åŒ…å«ä¸»èŠ‚ç‚¹ï¼‰ä¸º 2f+1ï¼Œé‚£ä¹ˆåªæœ‰å½“ f+1 ä¸ªå‰¯æœ¬å†™å…¥æˆåŠŸï¼Œä¸»èŠ‚ç‚¹æ‰ä¼šå°†è¿™ä¸ªå†™æ“ä½œæ ‡è®°ä¸ºå·²æäº¤ï¼ˆcommittedï¼‰ã€‚å½“ä¸»èŠ‚ç‚¹æŒ‚æ‰ä¹‹åï¼ŒåŸºäº f ä¸ªçŠ¶æ€æœ€æ–°çš„å‰¯æœ¬èŠ‚ç‚¹ï¼Œå¯ä»¥é€‰ä¸¾å‡ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œä¸”çŠ¶æ€ä¸ä¼šæœ‰ä»»ä½•ä¸¢å¤±ã€‚&lt;/p&gt;
&lt;p&gt;å¤šæ•°äººæŠ•ç¥¨æ–¹å¼ï¼Œæœ‰ä¸€ä¸ªä¼˜ç‚¹ï¼šå»¶è¿Ÿå–å†³äºé€Ÿåº¦å¿«çš„èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯æ…¢çš„ã€‚ç¼ºç‚¹æ˜¯ï¼šå¯¹äºå®é™…çš„ç”Ÿäº§ç³»ç»Ÿï¼ŒæŠ—é£é™©èƒ½åŠ›è¿˜ä¸å¤Ÿï¼Œè€Œä¸”ä¸å¤Ÿçµæ´»ï¼Œä¸èƒ½è®©ä½¿ç”¨è€…åšæƒè¡¡ã€‚&lt;/p&gt;
&lt;p&gt;Kafka é€‰æ‹©ä»²è£æˆå‘˜é›†ï¼ˆquorum setï¼‰çš„æ–¹å¼ä¸æ­¤ä¸åŒï¼Œè€Œä¸æ˜¯åŸºäºå¤šæ•°äººæŠ•ç¥¨ï¼Œè€Œæ˜¯åŠ¨æ€ç»´æŠ¤ä¸€ç»„åŒæ­¥ä¸­å‰¯æœ¬ï¼ˆISRï¼‰ï¼Œè¿™äº›å‰¯æœ¬ä¸ä¸»èŠ‚ç‚¹ä¿æŒåŒæ­¥ã€‚åªæœ‰è¿™ç»„å‰¯æœ¬ä¸­çš„æˆå‘˜æ‰æœ‰èµ„æ ¼å½“é€‰ä¸ºä¸»èŠ‚ç‚¹ã€‚ISR é›†å‘ç”Ÿå˜åŒ–æ—¶ä¼šæŒä¹…åŒ–åˆ° Zookeeper ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;åŸºäº ISR æ¨¡å‹ï¼Œå¦‚æœ topic åˆ†åŒºæœ‰ f+1 ä¸ªå‰¯æœ¬ï¼Œåˆ™å¯ä»¥å®¹å¿ f ä¸ªèŠ‚ç‚¹æŒ‚æ‰ï¼Œä¹Ÿä¸ä¼šä¸¢å¤±ä»»ä½•å·²æäº¤çš„æ¶ˆæ¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ Kafka ISR æ¨¡å‹å®é™…å®ç°æœ€ç›¸è¿‘çš„å­¦æœ¯è®ºæ–‡æ˜¯å¾®è½¯çš„ &lt;a href="http://research.microsoft.com/apps/pubs/default.aspx?id=66814"&gt;PacificA&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h4&gt;å¯ç”¨æ€§å’ŒæŒä¹…æ€§ä¿è¯&lt;/h4&gt;
&lt;p&gt;æ³¨æ„ï¼šproducer å‘é€æ¶ˆæ¯æ—¶è®¾å®š &lt;code&gt;acks=all&lt;/code&gt; å¹¶ä¸æ˜¯è¦æ±‚æ‰€æœ‰çš„å‰¯æœ¬éƒ½ç¡®è®¤å†™å…¥æˆåŠŸï¼Œè€Œæ˜¯åœ¨å½“å‰åŒæ­¥ä¸­å‰¯æœ¬ï¼ˆISRï¼‰éƒ½ç¡®è®¤å†™å…¥æˆåŠŸæ—¶ï¼Œåˆ†åŒº leader å°±å‘ producer å“åº”æˆåŠŸã€‚ä¾‹å¦‚ï¼šæŸä¸ª topic è¢«è®¾ç½®ä¸º 2 ä¸ªå‰¯æœ¬ï¼Œç„¶åå…¶ä¸­ä¸€ä¸ªå‰¯æœ¬èŠ‚ç‚¹æŒ‚æ‰ï¼Œæ­¤æ—¶è¦æ±‚ &lt;code&gt;acks=all&lt;/code&gt; çš„å†™æ“ä½œä¹Ÿä¼šæˆåŠŸã€‚å¦‚æœå‰©ä¸‹çš„å‰¯æœ¬èŠ‚ç‚¹ä¹ŸæŒ‚äº†ï¼Œé‚£ä¹ˆå°±ä¼šä¸¢æ¶ˆæ¯å•¦ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·åœ¨ å¯ç”¨æ€§ å’Œ æŒä¹…æ€§ ä¹‹é—´æƒè¡¡ï¼ŒKafka æä¾›ä¸¤ä¸ª topic çº§åˆ«çš„é…ç½®ï¼Œç”¨äº æŒä¹…æ€§ æ¯” å¯ç”¨æ€§ é‡è¦çš„æƒ…å†µï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://kafka.apache.org/documentation/#design_uncleanleader"&gt;ç¦ç”¨è„ leader é€‰ä¸¾&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æŒ‡å®šä¸€ä¸ªæœ€å° ISR é›†å¤§å°ï¼ˆ&lt;code&gt;min.insync.replicas&lt;/code&gt; å‚æ•°è®¾ç½®ï¼‰ï¼šåªæœ‰å½“ ISR é›†å¤§å°å¤§äºè®¾å®šçš„æœ€å°å€¼ï¼Œåˆ†åŒº [leader] æ‰ä¼šæ¥å—æ¶ˆæ¯å†™å…¥ã€‚è¿™ä¸ªè®¾ç½®åªæœ‰å½“ producer ä½¿ç”¨ &lt;code&gt;acks=all&lt;/code&gt; æ—¶æ‰ä¼šç”Ÿæ•ˆã€‚ï¼ˆæ³¨ï¼šåœ¨æˆ‘ä»¬ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œåˆ†åŒºå‰¯æœ¬æ•°é€šå¸¸ç”³è¯·ä¸º 3ï¼ˆåŒ…å« leaderï¼‰ï¼Œé‚£ä¹ˆ &lt;code&gt;min.insync.replicas&lt;/code&gt; åº”è¯¥è®¾å®šä¸º 2ï¼Œä½†é»˜è®¤æ˜¯ 1ã€‚ä½¿ç”¨ 1ï¼Œé‚£ä¹ˆå½“åˆ†åŒºåªæœ‰ä¸€ä¸ªå‰¯æœ¬ï¼ˆå³ leaderï¼‰ï¼Œproducer ä¹Ÿèƒ½å†™å…¥æˆåŠŸï¼Œä½†å¦‚æœè¿™ä¸ªå‰¯æœ¬åˆæŒ‚äº†ï¼Œå°±ä¼šä¸¢æ•°æ®ã€‚ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;h4&gt;å‰¯æœ¬ç®¡ç†&lt;/h4&gt;
&lt;p&gt;ä¸€ä¸ª Kafka é›†ç¾¤ä¸Šä¸€èˆ¬ä¼šæœ‰å¤šä¸ª topicï¼Œæ¯ä¸ª topic åˆæœ‰å¤šä¸ª partitionï¼Œä¸ºäº†èŠ‚ç‚¹ä¹‹é—´è´Ÿè½½å‡è¡¡ï¼Œé€šå¸¸ä»¥&lt;strong&gt;å¾ªç¯ï¼ˆround-robinï¼‰æ–¹å¼&lt;/strong&gt;åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šåˆ†å¸ƒ partition å’Œ åˆ†åŒº leader è§’è‰²ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œåœ¨åˆ†åŒº leader èŠ‚ç‚¹ä¹‹åé‡æ–°é€‰å‡º leader ä¹‹å‰ï¼Œå­˜åœ¨ä¸€æ®µä¸å¯ç”¨çš„æ—¶é—´çª—å£ï¼Œä¸ºäº†ç¼©çŸ­è¿™ä¸ªæ—¶é—´çª—å£ï¼ŒKafka ä¼šä»æ‰€æœ‰ broker ä¸­é€‰æ‹©ä¸€ä¸ªä½œä¸ºâ€œæ§åˆ¶å™¨ï¼ˆcontrollerï¼‰â€ï¼Œè¿™ä¸ªæ§åˆ¶å™¨ä¼šæ£€æµ‹ broker çº§åˆ«çš„é—®é¢˜ï¼ˆfailuresï¼‰ï¼Œåœ¨å‘ç°æŸä¸ª broker æŒ‚æ‰ä¹‹åï¼Œè´Ÿè´£ä¸ºå—å½±å“çš„åˆ†åŒºæŒ‡å®šæ–°çš„ leaderï¼Œè€Œä¸æ˜¯æ¯ä¸ªåˆ†åŒºè‡ªå·±è´Ÿè´£é‡æ–°é€‰ä¸»ï¼Œè¿™æ ·çš„é€‰ä¸»è¿‡ç¨‹æ›´è½»é‡æ›´å¿«ã€‚å¦‚æœæ§åˆ¶å™¨èŠ‚ç‚¹æŒ‚äº†ï¼Œè¿˜å­˜æ´»çš„ broker ä¸­çš„ä¸€ä¸ªä¼šæˆä¸ºæ–°çš„æ§åˆ¶å™¨ã€‚&lt;/p&gt;
&lt;h2&gt;æ¶ˆè´¹è€…æ¶ˆè´¹è¿›åº¦è·Ÿè¸ª&lt;/h2&gt;
&lt;p&gt;Kafka ä¸ºæ¯ä¸ªæ¶ˆè´¹ç»„ï¼ˆconsumer groupï¼‰æŒ‡å®šä¸€ä¸ª broker æ¥å­˜å‚¨ç›®æ ‡ topic å„ä¸ªåˆ†åŒºçš„æ¶ˆè´¹è¿›åº¦ï¼ˆoffsetsï¼‰ï¼Œè¿™ä¸ª broker ç§°ä¸º &lt;strong&gt;ç»„åè°ƒå™¨ï¼ˆgroup coordinatorï¼‰&lt;/strong&gt;ã€‚è¿™ä¸ªæ¶ˆè´¹ç»„ä¸­çš„ä»»ä¸€æ¶ˆè´¹è€…å®ä¾‹éƒ½åº”è¯¥å°†æ¶ˆè´¹è¿›åº¦æäº¤åˆ°è¿™ä¸ªç»„åè°ƒå™¨ï¼Œæˆ–è€…ä»è¿™ä¸ªç»„åè°ƒå™¨è·å–å¯åŠ¨ä¹‹å‰ä¸Šæ¬¡çš„æ¶ˆè´¹è¿›åº¦ã€‚Kafka åŸºäºæ¶ˆè´¹ç»„çš„åç§°ä¸ºæ¶ˆè´¹ç»„åˆ†é…åè°ƒå™¨ã€‚æ¶ˆè´¹è€…å¯ä»¥å‘ä»»ä¸€ broker å‘é€ FindCoordinatorRequest è¯·æ±‚æ¥æŸ¥æ‰¾è‡ªå·±çš„åè°ƒå™¨ï¼Œå¹¶ä» FindCoordinatorResponse å“åº”ä¸­è·å–åè°ƒå™¨çš„è¯¦ç»†ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ç»„åè°ƒå™¨æ¥æ”¶åˆ°ä¸€ä¸ª OffsetCommitRequest è¯·æ±‚åï¼Œä¼šå°†è¯·æ±‚æ•°æ®å†™åˆ°ä¸€ä¸ªç‰¹æ®Šçš„&lt;a href="http://kafka.apache.org/documentation/#compaction"&gt;ç»å‹å®çš„ï¼ˆcompactedï¼‰&lt;/a&gt; Kafka topic - &lt;em&gt;__consumer_offsets&lt;/em&gt;ã€‚åœ¨ç›®æ ‡åˆ†åŒºçš„æ‰€æœ‰å‰¯æœ¬éƒ½ç¡®è®¤æ”¶åˆ°äº†ï¼Œåè°ƒå™¨æ‰ä¼šå‘æ¶ˆè´¹è€…å‘é€è¿›åº¦æäº¤æˆåŠŸçš„å“åº”ã€‚è¿™ä¸ª topic çš„æ¶ˆæ¯æ—¥å¿—æ•°æ®ä¼šå®šæœŸè¿›è¡Œå‹å®ï¼ˆcompactï¼‰ï¼Œå› ä¸ºåªéœ€è¦ä¸ºæ¯ä¸ªåˆ†åŒºç»´æŠ¤æœ€æ–°çš„æ¶ˆè´¹è¿›åº¦ã€‚åè°ƒå™¨ä¹Ÿä¼šåœ¨å†…å­˜ä¸­ç¼“å­˜æ¶ˆè´¹è¿›åº¦ï¼Œæ–¹ä¾¿å¿«é€Ÿå“åº”æ¶ˆè´¹è¿›åº¦æŸ¥è¯¢è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨ï¼šå¦‚æœæ¶ˆè´¹è€…/æ¶ˆè´¹ç»„ç‰¹åˆ«å¤šï¼ˆä¾‹å¦‚ï¼šæˆ‘ä»¬å¹¿å‘Šå¼•æ“æœåŠ¡ï¼Œè¯»å–æ­£æ’æ¶ˆæ¯ topicï¼Œä¸€ä¸ªæœºå™¨å®ä¾‹å°±æ˜¯ä¸€ä¸ª consumer groupï¼Œæ•°é‡åœ¨å‡ ç™¾åˆ°å‡ åƒä¸ç­‰ï¼‰ï¼Œé‚£ä¹ˆç»„åè°ƒå™¨çš„å‹åŠ›ä¼šæ¯”è¾ƒå¤§ï¼Œé‚£ä¹ˆç¡®ä¿ç»„åè°ƒå™¨çš„è§’è‰²å‡åŒ€åˆ†é…åˆ°é›†ç¾¤çš„æ‰€æœ‰ brokerï¼Œæ¯”è¾ƒå…³é”®ã€‚å¦å¤–ï¼Œ&lt;em&gt;__consumer_offsets&lt;/em&gt; è¿™ä¸ª topic çš„åˆ†åŒºæ•°é‡ä¸èƒ½å¤ªå°‘ï¼Œæœ€å¥½å’Œ broker æ•°é‡ç›¸åŒæˆ–è€…æ•´æ•°å€æ•°é‡ã€‚&lt;/p&gt;</content><category term="å…¶ä»–"></category><category term="æ–‡ç« "></category><category term="ç¬”è®°"></category><category term="ç»å…¸"></category><category term="Kafka"></category><category term="è¿›è¡Œä¸­"></category></entry><entry><title>è¯»æ–‡ç¬”è®°ï¼šPhoton - Fault-tolerant and Scalable Joining of Continuous Data Streams</title><link href="http://youngsterxyf.github.io/2019/10/10/reading-photon/" rel="alternate"></link><published>2019-10-10T00:00:00+08:00</published><updated>2019-10-10T00:00:00+08:00</updated><author><name>xiayf</name></author><id>tag:youngsterxyf.github.io,2019-10-10:/2019/10/10/reading-photon/</id><summary type="html">&lt;p&gt;åŸæ–‡ï¼š&lt;a href="https://static.googleusercontent.com/media/research.google.com/zh-CN//pubs/archive/41318.pdf"&gt;Photon: Fault-tolerant and Scalable Joining of Continuous Data Streams&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Photon æ˜¯è°·æ­Œå¹¿å‘Šç³»ç»Ÿä¸­ç”¨äº join å¹¿å‘Šæ›å…‰æ—¥å¿—æµå’Œç‚¹å‡»æ—¥å¿—æµçš„ä¸€å¥—ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;æ•°æ®æµ join ä¸ºä»€ä¹ˆæ²¡ç”¨ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;åŸæ–‡ï¼š&lt;a href="https://static.googleusercontent.com/media/research.google.com/zh-CN//pubs/archive/41318.pdf"&gt;Photon: Fault-tolerant and Scalable Joining of Continuous Data Streams&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Photon æ˜¯è°·æ­Œå¹¿å‘Šç³»ç»Ÿä¸­ç”¨äº join å¹¿å‘Šæ›å…‰æ—¥å¿—æµå’Œç‚¹å‡»æ—¥å¿—æµçš„ä¸€å¥—ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;æ•°æ®æµ join ä¸ºä»€ä¹ˆæ²¡ç”¨ flink è¿™ç±»é€šç”¨çš„æµå¼å¤„ç†æ¡†æ¶ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æ•°æ®æµ joinï¼Œç‰¹åˆ«æ˜¯å¹¿å‘Šæ•°æ®æµ joinï¼ŒæŠ€æœ¯ä¸Šéš¾åœ¨å“ªé‡Œï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä»»ä¸€æ¡æµéƒ½å¯èƒ½ä¹±åºæˆ–å»¶è¿Ÿï¼Œå¹¿å‘Šç‚¹å‡»æ¶‰åŠè®¡è´¹çš„é—®é¢˜ï¼Œè®¡è´¹ä¸èƒ½å¤šç®—å¹¿å‘Šä¸»çš„é’±ï¼Œä¹Ÿè¦å°½å¯èƒ½é¿å…æ¼è®¡è´¹ï¼Œé™ä½å¹¿å‘Šæ”¶å…¥æŸå¤±ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;è¯¥ç³»ç»Ÿåœ¨è°·æ­Œç”Ÿäº§ç¯å¢ƒä¸­æ¯åˆ†é’Ÿå¤„ç†ç™¾ä¸‡çº§çš„äº‹ä»¶ï¼Œç«¯åˆ°ç«¯å»¶è¿Ÿå°äº 10 ç§’ï¼ˆæ³¨ï¼šå¯¹äºå¹¿å‘Šå®æ—¶ç«ä»·çš„å¹¿å‘Šä¸»è€Œè¨€ï¼Œè¿™ä¸ªå»¶è¿Ÿçš„é•¿çŸ­å¾ˆé‡è¦ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å¹¿å‘Šæ›å…‰ã€ç‚¹å‡»æ•´ä½“æµç¨‹ä¸ºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç”¨æˆ·æœç´¢æŸä¸ªå…³é”®è¯æ—¶ï¼Œè°·æ­Œçš„æœåŠ¡å™¨ä¼šè¿”å›å¹¿å‘Šå’Œæœç´¢ç»“æœã€‚å¹¿å‘ŠæœåŠ¡å™¨ä¼šå°†å¹¿å‘Š query å’Œç»“æœæ•°æ®ä½œä¸ºæ—¥å¿—å‘é€åˆ°å¤šä¸ªæ—¥å¿—æ•°æ®ä¸­å¿ƒï¼ˆmultiple logs-datacentersï¼‰ï¼Œæœ€ç»ˆæŒä¹…åŒ–å­˜å‚¨åœ¨ GFS ä¸Šã€‚æ¯æ¬¡ query éƒ½ä¼šè¢«èµ‹äºˆä¸€ä¸ªå”¯ä¸€æ€§ ID &lt;em&gt;query_id&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;å¯¹äºæœç´¢ç»“æœä¸­çš„å¹¿å‘Šï¼Œç”¨æˆ·å¯èƒ½ä¼šç‚¹å‡»ã€‚å¹¿å‘Šç‚¹å‡»ä¼šè§¦å‘ä¸€æ¬¡è¯·æ±‚ï¼Œè°·æ­Œçš„åç«¯æœåŠ¡å™¨å°†è¯·æ±‚é‡å®šå‘åˆ°å¹¿å‘Šä¸»çš„ç½‘ç«™ã€‚åœ¨é‡å®šå‘ä¹‹å‰ï¼Œè°·æ­ŒæœåŠ¡å™¨ä¼šå°†ç‚¹å‡»äº‹ä»¶è®°å½•åˆ°æ—¥å¿—ä¸­ï¼Œå‘é€åˆ°å¤šä¸ªæ—¥å¿—æ•°æ®ä¸­å¿ƒã€‚ç‚¹å‡»äº‹ä»¶æ—¥å¿—ä¸­åŒ…å«å¹¿å‘Šæ›å…‰çš„ query_idï¼Œç‚¹å‡»äº‹ä»¶ä¹Ÿä¼šè¢«èµ‹äºˆä¸€ä¸ªå”¯ä¸€æ€§ ID &lt;em&gt;click_id&lt;/em&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è®¡è´¹æ˜¯åœ¨ç‚¹å‡»ä¹‹åï¼Œä½†è®¡è´¹æ‰€éœ€è¦çš„å¹¿å‘Šå‡ºä»·ç­‰ä¿¡æ¯æ˜¯åœ¨æ›å…‰è¯·æ±‚ä¸­è®°å½•çš„ï¼Œå‡ºäºæ•°æ®æ•æ„Ÿæ€§ã€å¸¦å®½ã€è¯·æ±‚å¤„ç†å»¶è¿Ÿç­‰å¤šæ–¹é¢çš„è€ƒé‡ï¼Œè®¡è´¹ç›¸å…³çš„ä¿¡æ¯å¹¶ä¸ä¼šè¿”å›åˆ°ç”¨æˆ·å®¢æˆ·ç«¯ï¼Œä¹Ÿå°±æ˜¯è¯´ç‚¹å‡»è¯·æ±‚ä¸­ä¸ä¼šåŒ…å«è®¡è´¹ç›´æ¥ç›¸å…³çš„ä¿¡æ¯ï¼Œéœ€è¦å°† ç‚¹å‡»æ—¥å¿— å’Œ æ›å…‰æ—¥å¿— åšä¸€æ¬¡ joinï¼Œå¾—åˆ°ä¸€æ¡å®Œæ•´çš„ä¸Šä¸‹æ–‡æ—¥å¿—ï¼Œæ‰æ–¹ä¾¿åšåç»­è®¡è´¹ç­‰å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="https://i.loli.net/2020/06/14/EDOy6VKxeJUcgAW.jpg"&gt;&lt;/p&gt;
&lt;p&gt;è®ºæ–‡ä¸­æäº†åˆ°è¯¥ç³»ç»Ÿè§£å†³äº†å‡ ä¸ªæŠ€æœ¯æŒ‘æˆ˜ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä»…å¤„ç†ä¸€æ¬¡è¯­ä¹‰ï¼ˆexactly-once semanticsï¼‰ï¼šå®é™…ä¸Šè¾¾åˆ°çš„æ˜¯ æœ€å¤šå¤„ç†ä¸€æ¬¡è¯­ä¹‰ ï¼ˆAt most onceï¼‰ï¼Œä¹Ÿå°±æ˜¯ç»å¯¹ä¸èƒ½å¤šç®—é’±ï¼Œç„¶åå°½å¯èƒ½é¿å…å°‘ç®—é’±&lt;/li&gt;
&lt;li&gt;è‡ªåŠ¨åŒ–çš„è·¨æ•°æ®ä¸­å¿ƒå®¹é”™ï¼šä¹Ÿå°±æ˜¯å¤šæ•°æ®ä¸­å¿ƒéƒ¨ç½²ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ•°æ®ä¸­å¿ƒä¸å¯ç”¨ï¼ˆæ¯”å¦‚ ç½‘ç»œé—®é¢˜ï¼‰ï¼Œä¹Ÿä¸ä¼šå½±å“ç³»ç»Ÿæ­£å¸¸å¤„ç†æ•°æ®&lt;/li&gt;
&lt;li&gt;æ¨ªå‘æ‰©å±•æ€§é«˜ï¼šä¹Ÿå°±æ˜¯åŠ æœºå™¨å°±èƒ½åº”å¯¹æ¶ˆæ¯é‡å¢é•¿&lt;/li&gt;
&lt;li&gt;ä½æ—¶å»¶&lt;/li&gt;
&lt;li&gt;æµä¹±åº&lt;/li&gt;
&lt;li&gt;ä¸»æµå»¶è¿Ÿï¼ˆdelayed primary streamï¼‰ï¼šè¿™é‡Œè¯´çš„â€ä¸»æµâ€œæ˜¯æ›å…‰æ—¥å¿—æµ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åœ¨æˆ‘çœ‹æ¥ï¼Œè¯¥ç³»ç»Ÿçš„äº®ç‚¹ä¸»è¦åœ¨å‰ 3 ç‚¹ï¼Œåè¾¹ç»†è¯´ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºè§£å†³ 1ã€2 æŒ‘æˆ˜ç‚¹ï¼Œç³»ç»Ÿå¼•å…¥ä¸€ä¸ªæœåŠ¡æ¨¡å—ï¼šIdRegistryï¼Œè¿™ä¸ªæœåŠ¡çš„åŠŸèƒ½ï¼šæä¾›ç‚¹å‡»äº‹ä»¶ idï¼ˆ&lt;em&gt;click_id&lt;/em&gt;ï¼‰ çš„å­˜å‚¨å’ŒæŸ¥è¯¢ï¼Œå¦‚æœæŸä¸ª click_id å¯ä»¥ä» IdRegistry ä¸­æŸ¥åˆ°ï¼Œåˆ™è¡¨ç¤ºè¯¥ç‚¹å‡»äº‹ä»¶å·²ç»å¤„ç†è¿‡äº†ï¼Œä¸è¦å†æ¬¡å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;å¹¶ä¸”ï¼Œå¤šæ•°æ®ä¸­å¿ƒéƒ½éƒ¨ç½²ä¸€å¥— Photonï¼Œä½† IdRegistry å…±äº«ä¸€ä¸ªï¼Œå¤šå¥— Photon ç³»ç»Ÿçš„è¾“å…¥ç›¸åŒï¼Œé‚£ä¹ˆ IdRegistry é™¤äº†æä¾›å»é‡çš„åŠŸèƒ½ï¼Œè¿˜æä¾›äº†è´Ÿè½½å‡è¡¡çš„åŠŸèƒ½ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œå‡è®¾ N ä¸ªæ•°æ®ä¸­å¿ƒï¼Œæ¯ä¸ªæ•°æ®ä¸­å¿ƒ Photon join äº§å‡ºçš„æ—¥å¿—æ•°æ®é‡ä¸ºæ€»é‡çš„ 1/Nã€‚&lt;/p&gt;
&lt;p&gt;å½“æŸä¸ªæ•°æ®ä¸­å¿ƒçš„ Photon ä¸å¯ç”¨æ—¶ï¼Œç›¸å½“äºå…¶è´Ÿè½½åŠ¨æ€åœ°é‡æ–°åˆ†é…åˆ°å…¶å®ƒæ•°æ®ä¸­å¿ƒï¼Œè™½ç„¶æ€»ä½“èƒ½åŠ›ä¸Šé™ä½äº†ï¼Œä½†åªè¦å¤„ç†èƒ½åŠ›æœ‰å†—ä½™ï¼Œå°±ä¸ä¼šå½±å“æ­£å¸¸å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆå¾ˆæ˜æ˜¾ï¼ŒIdRegistry å¾ˆå¯èƒ½æˆä¸ºç³»ç»Ÿçš„çŸ­æ¿ï¼›å¦å¤–ï¼Œæ›å…‰/ç‚¹å‡»çš„å”¯ä¸€æ€§ ID å¦‚ä½•ç”Ÿæˆï¼Ÿå¦‚æœç”±ä¸€ä¸ªä¸­å¿ƒæœåŠ¡æ¥æä¾›å”¯ä¸€æ€§ ID çš„ç”Ÿæˆï¼Œé‚£ä¹ˆè¿™ä¸ªæœåŠ¡ä¹Ÿä¼šæˆä¸ºç³»ç»Ÿçš„çŸ­æ¿ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œç³»ç»Ÿæ²¡æœ‰é€‰æ‹©ä¸€ä¸ªä¸­å¿ƒæœåŠ¡æ¥ç”Ÿæˆå”¯ä¸€æ€§ idï¼Œè€Œæ˜¯å°† id è®¾è®¡ä¸ºåŒ…å«3ä¸ªéƒ¨åˆ†ï¼š&lt;em&gt;ServerIP&lt;/em&gt;ã€&lt;em&gt;ProcessID&lt;/em&gt;ã€&lt;em&gt;Timestamp&lt;/em&gt;ã€‚ç”±äºæ—¥å¿—æ–‡ä»¶ä¸­è¡Œä¹‹é—´å¤§è‡´æ˜¯æŒ‰ç…§æ—¶é—´æˆ³æœ‰åºçš„ï¼Œæ‰€ä»¥ id ä¸­åŒ…å«æ—¶é—´æˆ³çš„ä¸€ä¸ªé¢å¤–å¥½å¤„æ˜¯ï¼šæ ¹æ® id å³å¯å¤§è‡´å®šä½æ—¥å¿—å†…å®¹ã€‚å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå’Œæ¨ªå‘æ‰©å±•æ€§ç›¸å…³çš„å¥½å¤„ï¼Œåè¾¹ç»†è¯´ã€‚&lt;/p&gt;
&lt;p&gt;IdRegistry çš„è§’è‰²è‡³å…³é‡è¦ï¼Œæ‰€ä»¥å°†å…¶å®ç°ä¸ºä¸€ä¸ªåŸºäº Paxos åè®®çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œæ ¹æ® CAP åŸåˆ™ï¼Œå¯ç”¨æ€§ï¼ˆæ­¤å¤„æ˜¯æŒ‡&lt;strong&gt;ååèƒ½åŠ›&lt;/strong&gt;ï¼‰å—é™ã€‚è§£å†³æ–¹æ¡ˆæ˜¯ï¼š&lt;/p&gt;
&lt;p&gt;1ã€æé«˜å•æœºå¤„ç†èƒ½åŠ›ï¼šæœåŠ¡ç«¯æ”’æ‰¹å¤„ç†ï¼Œå°½å¯èƒ½å‡å°‘ç½‘ç»œå¾€è¿”æ¬¡æ•°å¯¼è‡´çš„ç­‰å¾…ï¼ˆç‰¹åˆ«æ˜¯ï¼šç”±äº IdRegistry æ˜¯è·¨åœ°åŸŸåˆ†å¸ƒå¼ï¼Œéƒ¨ç½²ä¸ŠèŠ‚ç‚¹ä¹‹é—´æœ€å¤§å»¶è¿Ÿæ˜¯ 100ms å·¦å³ï¼‰&lt;/p&gt;
&lt;p&gt;2ã€åˆ†ç‰‡ï¼ˆShardingï¼‰ï¼šæ ¹æ® click_id è¿›è¡Œåˆ†ç‰‡ï¼Œä½†å¦‚æœæ˜¯å›ºå®šåˆ†ç‰‡ï¼Œé‚£ä¹ˆéšç€ä»¥åä¸šåŠ¡é‡å¢å¤§ï¼Œä¸å¥½æ‰©å±•ã€‚Photon ä½¿ç”¨äº†ä¸€ç§åŸºäºæ—¶é—´æ®µåŠ¨æ€åˆ†ç‰‡æ–¹æ¡ˆï¼Œè¿™ä¸ªæ–¹æ¡ˆåŸºäº click_id è‡ªå¸¦æ—¶é—´æˆ³ã€‚å¤§è‡´é€»è¾‘æ˜¯ï¼šä½¿ç”¨ä¸€ä¸ªé…ç½®ï¼Œå†…å®¹å¤§è‡´å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="https://i.loli.net/2020/06/14/VRlgr2CoD8zw7Mm.jpg"&gt;&lt;/p&gt;
&lt;p&gt;å¯¹äºæ¯ä¸ª click æ—¥å¿—ï¼Œå…ˆæ ¹æ® click_id ä¸­çš„æ—¶é—´æˆ³ï¼Œåˆ¤æ–­åˆ†ç‰‡æ•°ï¼Œå¹¶è®¡ç®—å¯¹åº”çš„åˆ†ç‰‡ idã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="https://i.loli.net/2020/06/14/JMWyQvrDZCaAEdH.jpg"&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ç³»ç»Ÿçš„æ¨¡å—å…³ç³»å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="https://i.loli.net/2020/06/14/zghk6oVaqZ5uEs3.jpg"&gt;&lt;/p&gt;
&lt;p&gt;Photon çš„ Dispatcher æ¨¡å—å¹¶æ²¡æœ‰ä»¥ Kafka è¿™ç§æ¶ˆæ¯é˜Ÿåˆ—ä½œä¸ºè¾“å…¥ï¼Œè€Œæ˜¯ç›´æ¥ç›‘å¬æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ—¥å¿—æ–‡ä»¶å˜æ›´ï¼Œè¿™ä¸€ç‚¹æœ‰ç‚¹å¥‡æ€ªï¼Œä¸æ˜¯ç‰¹åˆ«ç†è§£ã€‚&lt;/p&gt;
&lt;p&gt;Joiner è´Ÿè´£å®é™…çš„ join å·¥ä½œï¼Œç”±äº 3ã€4 éƒ½æ¯”è¾ƒè€—æ—¶ï¼Œæ‰€ä»¥ä¸ºäº†å°½å¯èƒ½å‡å°‘ Joiner çš„å·¥ä½œé‡ï¼ŒDispatcher å°†ç‚¹å‡»äº‹ä»¶æ—¥å¿—å‘é€ç»™ Joinerï¼Œä¼šå…ˆåˆ° IdRegistry ä¸­æŸ¥ä¸€ä¸‹è¯¥äº‹ä»¶æ˜¯å¦å·²è¢«å¤„ç†è¿‡ï¼Œä»è€Œèµ·åˆ°è¿‡æ»¤ä½œç”¨ã€‚å› å¤šæ•°æ®ä¸­å¿ƒéƒ¨ç½²ï¼Œå®é™…è¿‡æ»¤æ¯”ä¸ºï¼š$ \frac{N-1}{N} $ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ç¡®ä¿ Joiner é«˜å¯ç”¨ï¼ŒJoiner æ˜¯æ— çŠ¶æ€çš„ï¼Œå‘ Dispatcher æä¾› RPC æ¥å£ï¼ŒJoiner å†…éƒ¨æœ‰é™æµï¼Œä»¥ä¿è¯ä¸ä¼šå› ä¸ºå•ä¸ª Joiner è´Ÿè½½è¿‡å¤§ï¼Œå¯¼è‡´å¤„ç†æ—¶å»¶å¢å¤§ã€‚Dispatcher è°ƒç”¨ Joiner å¤±è´¥åä¼šé‡è¯•ï¼Œé‡è¯•ä½¿ç”¨çš„æ˜¯æŒ‡æ•°é€€é¿ç®—æ³•ã€‚ä½†å¤„ç†å¤±è´¥çš„ç‚¹å‡»äº‹ä»¶ï¼Œæ˜¯å¦å¤–å­˜å‚¨åœ¨ GFS ä¸Šï¼Œåº”è¯¥æ˜¯ç”±å¦å¤–çš„çº¿ç¨‹æ¥è´Ÿè´£é‡è¯•ï¼Œä¸ä¼šå½±å“æ­£å¸¸çš„äº‹ä»¶å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;å½“ Joiner æ”¶åˆ°ä¸€ä¸ªç‚¹å‡»äº‹ä»¶çš„å¤„ç†è¯·æ±‚æ—¶ï¼Œä¼šæ ¹æ®ç‚¹å‡»æ—¥å¿—æ•°æ®ä¸­çš„ &lt;em&gt;query_id&lt;/em&gt; ä» EventStore æŸ¥è¯¢æ›å…‰æ—¥å¿—è¯¦æƒ…ï¼Œä½†å› ä¸ºæ›å…‰æ—¥å¿—æ•°æ®æµå¯èƒ½ä¼šæœ‰å»¶è¿Ÿï¼Œæ‰€ä»¥å¯èƒ½ä¼šæŸ¥ä¸åˆ°ï¼ŒæŸ¥ä¸åˆ°ä¸”å‘ç° click_id ä¸­çš„æ—¶é—´æˆ³æ—©äºæŸä¸ªé˜ˆå€¼ï¼ˆæ¯”å¦‚æ˜¯ Nå¤©å‰çš„ä¸€ä¸ªäº‹ä»¶ï¼‰ï¼ŒJoiner ä¼šå°†è¯¥ click_id æ ‡è®°ä¸ºä¸å¯ joinï¼Œç„¶åå‘ Dispatcher è¿”å›æˆåŠŸï¼›å¦‚æœ click_id ä¸­çš„æ—¶é—´æˆ³ä¸æ—©äºé˜ˆå€¼ï¼Œåˆ™å‘ Dispatcher è¿”å›å¤±è´¥ï¼Œç”± Dispatcher æ¥é‡è¯•ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ç¡®ä¿ä¸ä¼šå¤šè®¡è´¹ï¼ŒJoiner åœ¨å°† join ç»“æœå†™å…¥ Joined Click Logs ä¹‹å‰ï¼Œä¼šå‘ IdRegistry æ³¨å†Œ click_idã€‚&lt;/p&gt;
&lt;p&gt;å‡è®¾æ³¨å†Œå®é™…ä¸Šå·²æˆåŠŸï¼Œä½†å› ç½‘ç»œåŸå› æˆ– RPC è°ƒç”¨è¶…æ—¶ Joiner æœªæ”¶åˆ°æˆåŠŸå“åº”ï¼Œæ­¤æ—¶æ€ä¹ˆåŠï¼ŸJoiner å‘ IdRegistry æ³¨å†Œ click_id æ—¶ï¼Œä¼šé™„å¸¦ä¸€ä¸ªé¢å¤–çš„ å”¯ä¸€æ€§ tokenï¼Œä¹ŸåŒ…å«3ä¸ªéƒ¨åˆ†ï¼šJoiner æœåŠ¡å™¨åœ°å€ã€è¿›ç¨‹ IDã€æ—¶é—´æˆ³ï¼ŒIdRegistry ä¼šæŠŠè¿™ä¸ªå”¯ä¸€æ€§ token ä½œä¸ºå€¼å­˜å‚¨ä¸‹æ¥ï¼Œæ‰€ä»¥å¯¹äºè¿™ç§æƒ…å†µï¼ŒJoiner å¯ä»¥é‡å¤å‘æ³¨å†Œè¯·æ±‚ï¼Œå¦‚æœ IdRegistry æ ¹æ® token å‘ç°å·²æ³¨å†ŒæˆåŠŸçš„ click_id å’Œå½“å‰æ”¶åˆ°çš„ click_id æ¥è‡ªåŒä¸€ä¸ª Joinerï¼Œåˆ™ä¹Ÿä¼šè¿”å›æ³¨å†ŒæˆåŠŸã€‚&lt;/p&gt;
&lt;p&gt;å‡è®¾æ³¨å†ŒæˆåŠŸï¼Œåˆå¹¶ç»“æœå†™å…¥å¼‚å¸¸ï¼Œå¼‚å¸¸åˆ†ä¸º 2 ç§ï¼Œéœ€è¦è§£å†³ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å†™å…¥ä¹‹å‰ï¼ŒJoiner èŠ‚ç‚¹å®•æœºæˆ–é‡å¯&lt;/li&gt;
&lt;li&gt;åˆå¹¶ç»“æœå®é™…å†™å…¥æˆåŠŸï¼Œä½†å› ä¸ºç½‘ç»œåŸå› ï¼ŒJoiner æœªæ”¶åˆ°å“åº”&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸ºå°½å¯èƒ½å‡å°‘å› æŸä¸ª Joiner èŠ‚ç‚¹ç¡¬ä»¶å¼‚å¸¸å¯¼è‡´çš„ join ç»“æœä¸¢å¤±ï¼ŒIdRegistry å¯¹äºå•ä¸ª Joiner çš„è¯·æ±‚æœ‰é™æµï¼Œè¿™ä¸ªé™æµä¼šé—´æ¥å¯¼è‡´ Joiner å¯¹ Dispatcher é™æµã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è¿›ä¸€æ­¥å‡å°‘å› ä¸ºä¸Šé¢2ç§å¼‚å¸¸æƒ…å†µä»¥åŠå…¶å®ƒå¼‚å¸¸å¯¼è‡´çš„ Join ç»“æœä¸¢å¤±ï¼ŒPhoton è¿˜æä¾›ä¸€ä¸ªæ ¡éªŒç³»ç»Ÿï¼šè·å–åŸå§‹ç‚¹å‡»äº‹ä»¶æ—¥å¿—ï¼Œå¦‚æœè¯¥æ—¥å¿— click_id åœ¨ IdRegistry ä¸­å­˜åœ¨ï¼Œä½†åˆå¹¶ç»“æœä¸­ä¸å­˜åœ¨ï¼Œåˆ™æ ¹æ® IdRegistry å­˜å‚¨çš„å¯¹åº” click_id çš„ tokenï¼Œåˆ¤æ–­å¯¹åº”çš„ Joiner æ˜¯å¦å­˜æ´»ï¼Œå¦‚æœå­˜æ´»ï¼Œåˆ™äº¤äºè¯¥ Joiner é‡æ–°å¤„ç†ï¼Œå¦‚æœå¯¹åº”çš„ Joiner å·²ä¸å­˜åœ¨ï¼Œåˆ™ä» IdRegistry ä¸­åˆ é™¤è¯¥ click_id è®°å½•ï¼Œç„¶åäº¤äºä»»ä¸€ Joiner æ¥å¤„ç†ï¼Œéƒ½ä¸€æ ·ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;EventStore è·å–åŸå§‹çš„æ›å…‰æ—¥å¿—ï¼Œå‘ Joiner æä¾›æŸ¥è¯¢æ¥å£ï¼Œè¿”å›åŸå§‹çš„æ›å…‰æ—¥å¿—å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;åŸºäºæ—¶é—´å±€éƒ¨æ€§ï¼ŒEventStore å†…éƒ¨åˆ† 2 å±‚ï¼Œç¬¬ä¸€å±‚ä¸º CacheEventStore - ä¸€ä¸ªç±»ä¼¼ Memcached çš„ KV å†…å­˜æ˜ å°„ï¼ŒK æ˜¯ query_idï¼ŒV æ˜¯æ›å…‰æ—¥å¿—å†…å®¹ï¼ŒåŸºäºä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æ ¹æ® query_id è¿›è¡Œåˆ†ç‰‡ï¼Œç¼“å­˜å‡ åˆ†é’Ÿæœ€æ–°çš„æ›å…‰æ—¥å¿—æ•°æ®ï¼Œå¯ä»¥å‘½ä¸­ 90% å·¦å³çš„æŸ¥è¯¢è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœ CacheEventStore æŸ¥è¯¢ missï¼Œåˆ™äº¤äºç¬¬äºŒå±‚ LogsEventStore æ¥å¤„ç†ã€‚LogsEventStore å¯¹ query_id å’Œ æ›å…‰æ—¥å¿—æ‰€åœ¨çš„æ—¥å¿—æ–‡ä»¶åŠç›®æ ‡èµ·å§‹è¡Œï¼ˆå› ä¸ºæ—¥å¿—æ–‡ä»¶æ•°æ®å¤§è‡´æŒ‰æ—¶é—´æˆ³æœ‰åºï¼Œæ ¹æ® query_id ä¸­çš„æ—¶é—´æˆ³å¤§è‡´å¯ä»¥çŸ¥é“æŸ¥è¯¢çš„èµ·å§‹è¡Œï¼‰å»ºç«‹ç´¢å¼•ï¼ˆå®é™…å­˜å‚¨åœ¨ BigTable ä¸­ï¼‰ï¼ŒæŸ¥è¯¢æ—¶ï¼Œå…ˆæ ¹æ® query_idï¼ŒæŸ¥åˆ°ç›®æ ‡æ—¥å¿—æ–‡ä»¶å’Œèµ·å§‹è¡Œï¼Œç„¶åä»æ—¥å¿—æ–‡ä»¶ä¸­è¯»å–åŸå§‹æ›å…‰æ—¥å¿—å†…å®¹ã€‚&lt;/p&gt;</content><category term="å…¶ä»–"></category><category term="è®ºæ–‡"></category><category term="ç¬”è®°"></category></entry><entry><title>è¯»æ–‡ç¬”è®°ï¼šæ—¥å¿— - æ¯ä¸ªè½¯ä»¶å·¥ç¨‹å¸ˆéƒ½åº”è¯¥äº†è§£çš„å®æ—¶æ•°æ®ç»Ÿä¸€æŠ½è±¡</title><link href="http://youngsterxyf.github.io/2019/10/10/reading-the-log/" rel="alternate"></link><published>2019-10-10T00:00:00+08:00</published><updated>2019-10-10T00:00:00+08:00</updated><author><name>xiayf</name></author><id>tag:youngsterxyf.github.io,2019-10-10:/2019/10/10/reading-the-log/</id><summary type="html">&lt;p&gt;åŸæ–‡ï¼š&lt;a href="https://engineering.linkedin.com/distributed-systems/log-what-every-software-engineer-should-know-about-real-time-datas-unifying"&gt;The Log: What every software engineer should know about real-time data's unifying abstraction&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¸€å¥è¯æ¦‚æ‹¬ï¼Œè¿™ç¯‡æ–‡ç« ç»†è¯´äº† Kafka çš„æœ¬è´¨åŸç†ã€è§£å†³çš„é—®é¢˜ã€é€‚ç”¨æ€§ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;Kafka æœ¬è´¨ä¸Šæ˜¯æä¾›æ—¥ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;åŸæ–‡ï¼š&lt;a href="https://engineering.linkedin.com/distributed-systems/log-what-every-software-engineer-should-know-about-real-time-datas-unifying"&gt;The Log: What every software engineer should know about real-time data's unifying abstraction&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¸€å¥è¯æ¦‚æ‹¬ï¼Œè¿™ç¯‡æ–‡ç« ç»†è¯´äº† Kafka çš„æœ¬è´¨åŸç†ã€è§£å†³çš„é—®é¢˜ã€é€‚ç”¨æ€§ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;Kafka æœ¬è´¨ä¸Šæ˜¯æä¾›æ—¥å¿—æ•°æ®æµã€‚&lt;/p&gt;
&lt;p&gt;æ—¥å¿—æ˜¯å®¢è§‚ä¸–ç•Œçš„äº‹ä»¶è®°å½•ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A log is perhaps the simplest possible storage abstraction. It is an append-only, totally-ordered sequence of records ordered by time.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ—¥å¿—æ•°æ®çš„ç‰¹ç‚¹æ˜¯ï¼šåªå¢ä¸æ”¹ï¼Œè‡ªå¸¦æ—¶é—´æˆ³ï¼Œæ•°æ®å­˜å‚¨çš„å…ˆåé¡ºåºå³ï¼ˆå¤§è‡´ï¼‰æ˜¯å®é™…å‘ç”Ÿçš„æ—¶é—´å…ˆåé¡ºåºã€‚&lt;/p&gt;
&lt;p&gt;æ•°æ®åº“å¯ä»¥åŸºäºæ—¥å¿—æ¥è¿˜åŸå†å²æ“ä½œè¡Œä¸ºï¼Œå¹¶æœ€ç»ˆç”Ÿæˆæœ€æ–°çŠ¶æ€ï¼Œä¸»ä»åŒæ­¥å°±æ˜¯è¿™ä¹ˆå¹²çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿè€Œè¨€ï¼Œæ—¥å¿—å¯ä»¥è§£å†³ 2 ä¸ªé—®é¢˜ï¼šæŒ‰åºæ”¹å˜çŠ¶æ€å’Œåˆ†å‘æ•°æ®ï¼ˆordering changes and distributing dataï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;çŠ¶æ€æœºå¤åˆ¶åŸåˆ™ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;If two identical, deterministic processes begin in the same state and get the same inputs in the same order, they will produce the same output and end in the same state.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å„ä¸ªèŠ‚ç‚¹å¯ä»¥ä¾æ®æ—¥å¿—æ¥åŒæ­¥çŠ¶æ€ï¼Œè¾¾åˆ°ï¼ˆæœ€ç»ˆï¼‰ä¸€è‡´æ€§ã€‚å¹¶ä¸”ï¼Œå¯ä»¥ä¾æ®èŠ‚ç‚¹å¤„ç†åˆ°å“ªè¡Œæ—¥å¿—å³å¯ç¡®å®š/è¡¨è¾¾è¯¥èŠ‚ç‚¹çš„çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;ï¼ˆæ—¥å¿—ï¼‰äº‹ä»¶æµï¼ˆeventsï¼‰å’Œæ•°æ®è¡¨ï¼ˆtablesï¼‰æ˜¯ä¸€ä½“ä¸¤é¢ï¼ˆa facinating dualityï¼‰ï¼šæ•°æ®è¡¨çš„å˜æ›´æ“ä½œå³æ˜¯ä¸€ä¸ªæ—¥å¿—äº‹ä»¶æµï¼ŒåŸºäºæ—¥å¿—äº‹ä»¶æµå¯ä»¥ç”Ÿæˆæ•°æ®è¡¨ï¼Œå¹¶å°†å…¶çŠ¶æ€ä¸æ–­æ›´æ–°åˆ°æœ€æ–°ï¼Œæ•°æ®è¡¨çš„çŠ¶æ€æ˜¯æ—¥å¿—äº‹ä»¶æµçš„åœ¨æŸä¸ªæ—¶é—´ç‚¹çš„åˆ‡é¢ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;events -&amp;gt; table -&amp;gt; events = events &amp;lt;-&amp;gt; table&lt;/p&gt;
&lt;p&gt;The magic of the log is that if it is a complete log of changes, it holds not only the contents of the final version of the table, but also allows recreating all other versions that might have existed. It is, effectively, a sort of backup of every previous state of the table.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æºç ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆæ¯”å¦‚ gitï¼‰ä¹Ÿæ˜¯åŸºäºæ—¥å¿—å®ç°çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œä¸€æ¬¡ commit ç›¸å½“äºä¸€æ¬¡æ—¥å¿—è®°å½•ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;å¯¹äºäº’è”ç½‘/é‡‘èç­‰è¡Œä¸šçš„å…¬å¸æ¥è¯´ï¼Œæ•°æ®æ˜¯é‡è¦èµ„äº§ï¼Œå¦‚ä½•å°½å¯èƒ½å‘æŒ¥æ•°æ®çš„æ½œåœ¨ä»·å€¼ä¸ºå…¬å¸å¢æ”¶ï¼Œè‡³å…³é‡è¦ã€‚å› ä¸ºç®¡ç†ã€æŠ€æœ¯ä¸Šçš„åŸå› ï¼Œå…¬å¸é€šå¸¸åˆ†å¤šä¸ªä¸šåŠ¡éƒ¨é—¨ï¼Œå„ä¸šåŠ¡éƒ¨é—¨æä¾›è‹¥å¹²æœåŠ¡ï¼Œå„ä¸ªæœåŠ¡éƒ½ä¼šäº§å‡ºæ•°æ®ï¼Œè¿™äº›æ•°æ®å¾ˆå¯èƒ½éœ€è¦è·¨éƒ¨é—¨è·¨æœåŠ¡æµé€šï¼Œæµé€šçš„é€Ÿåº¦è¶Šå¿«ï¼Œå‘¨æœŸè¶ŠçŸ­ï¼Œæ”¶ç›Šè¶Šå¤§ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥å‰ï¼Œæ•°æ®çš„å¤„ç†æ–¹å¼ä¸»è¦æ˜¯æ‰¹å¤„ç†ï¼Œå¹¶ä¸æ˜¯å› ä¸ºæ²¡æœ‰æµå¤„ç†çš„æŠ€æœ¯ï¼Œè€Œæ˜¯æ•°æ®æµé€šçš„åŸºç¡€è®¾æ–½è·Ÿä¸ä¸Šï¼Œæ²¡åšåˆ°æŒç»­çš„æ•°æ®æµã€‚&lt;strong&gt;ï¼ˆæ³¨ï¼šè¿™ä¸ªè¯´æ³•ï¼Œæˆ‘ä¸ªäººåªéƒ¨åˆ†è®¤åŒï¼Œå¾ˆå¤šæ—¶å€™ï¼Œæ‰¹å¤„ç†çš„æ—¶å»¶å’Œæ”¶ç›Šå¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†éœ€æ±‚ï¼Œå®æ—¶æµå¤„ç†çš„è¾¹é™…æ•ˆç›Šå¯èƒ½å¹¶ä¸æ˜æ˜¾ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æµå¼å¤„ç†æ˜¯æ‰¹å¤„ç†çš„æ³›åŒ–å½¢å¼ï¼ˆstream processing is a generalization of batch processing, and, given the prevalence of real-time data, a very important generalizationï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†é¿å…å› æ•°æ®æµé€šå¯¼è‡´å„ä¸ªæœåŠ¡ä¹‹é—´çš„ç›´æ¥è€¦åˆï¼Œæ–°å¢ä¸€ä¸ªç»Ÿä¸€çš„æ•°æ®é€šé“ä¸­é—´æœåŠ¡ï¼Œå„ä¸ªæœåŠ¡åªç®¡å¯¹æ•°æ®é€šé“è¿›è¡Œå†™å…¥æˆ–è¯»å‡ºï¼Œä¸ç”¨å…³å¿ƒæ•°æ®æ˜¯å“ªä¸ªæœåŠ¡å†™å…¥çš„ï¼Œæˆ–è€…å“ªäº›æœåŠ¡åœ¨æ¶ˆè´¹/ä½¿ç”¨è‡ªå·±äº§å‡ºçš„æ•°æ®ã€‚&lt;strong&gt;ï¼ˆè§£è€¦ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ®çš„é€Ÿç‡å¯èƒ½ä¸ä¸€æ ·ï¼Œä¹Ÿå¯èƒ½ä¼šç»å†å¼‚å¸¸é‡å¯ç­‰æƒ…å†µï¼Œè®©æ¶ˆè´¹è€…æ¥æ§åˆ¶é€Ÿç‡ï¼Œå¹¶ä¸”å¤šä¸ªæ¶ˆè´¹è€…ä¹‹é—´ä¸ä¼šç›¸äº’å¹²æ‰°ï¼Œä¼šæ›´å¥½ã€‚&lt;/p&gt;
&lt;p&gt;åŸºäºæ•°æ®æµé€šçš„éœ€æ±‚å’Œæ—¥å¿—çš„ç†å¿µï¼ŒLinkedin è®¾è®¡å¼€å‘äº† Kafkaã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºæ—¥å¿—æ•°æ®é‡å¯èƒ½ä¼šå¾ˆå¤§ï¼Œæ—¥å¿—æ•°æ®æœ¬è´¨ä¸Šæ˜¯æœ‰åºä¸²è¡Œçš„ï¼Œå¦‚æœæ”¯æŒæ•°æ®åˆ†ç‰‡ï¼Œåˆ†ç‰‡ä¹‹é—´å¹¶è¡Œæ¶ˆè´¹ï¼Œåˆ†ç‰‡å†…æ—¥å¿—æ•°æ®å…¨å±€æœ‰åºï¼Œæ•°æ®æµé€šçš„ååèƒ½åŠ›å°±å¯ä»¥æ— é™æ‰©å±•ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;åŸºäº Kafka è¿™ç±»æ•°æ®ç®¡é“ï¼ŒæœåŠ¡ä¹‹é—´å¯ä»¥å®ç°å¤šçº§ä¸²è”ã€‚ï¼ˆæ³¨ï¼šæˆ‘ä»¬ç°åœ¨åšçš„æœåŠ¡å°±æ˜¯è¿™ä¹ˆå¹²ï¼‰&lt;/p&gt;
&lt;p&gt;è¿™ç§åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„ä¸­ï¼Œè‡³å°‘æ¶‰åŠ producerï¼ˆç”Ÿäº§è€…ï¼‰ã€brokerï¼ˆä¸­é—´äººï¼‰ã€consumerï¼ˆæ¶ˆè´¹è€…ï¼‰ä¸‰ä¸ªè§’è‰²ï¼Œè§’è‰²ä¹‹é—´åœ¨æŸäº›å·¥ä½œä¸Šå¦‚ä½•åˆ†å·¥ä¹Ÿæ˜¯å€¼å¾—æ€è€ƒçš„ï¼š&lt;/p&gt;
&lt;p&gt;ç”Ÿäº§è€…äº§ç”Ÿçš„æ•°æ®åº”è¯¥æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ - ç»Ÿä¸€æ ¼å¼/ç¼–ç ã€æ–¹ä¾¿è§£æ&lt;/p&gt;
&lt;p&gt;ä¸­é—´äººï¼ˆkafkaï¼‰éœ€è¦è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ- å¯¹äºå•ä¸ªç”Ÿäº§è€…å†™å…¥çš„æ•°æ®ï¼Œä¿è¯æŒ‰å†™å…¥é¡ºåºæœ‰åºåœ°åˆ†å‘ç»™æ¶ˆè´¹è€…ï¼›è§£å†³æ•°æ®é«˜å¯ç”¨ï¼Œé«˜ååèƒ½åŠ›ï¼›æ”¯æŒå›æº¯/é‡å¤æ¶ˆè´¹ï¼ˆå› æ­¤æ•°æ®éœ€è¦ä¿ç•™æŒ‡å®šæ—¶é—´é•¿åº¦ï¼‰ï¼Œä»è€Œæ¶ˆè´¹è€…å‡ºé—®é¢˜åå¯ä»¥ä»å¤´æ¶ˆè´¹æ•°æ®æ¢å¤çŠ¶æ€ã€‚å› ä¸ºæ”¯æŒå¾ˆå¤šæ¶ˆè´¹è€…æ¶ˆè´¹åŒä¸€ä¸ªæ•°æ®æµï¼Œæ‰€ä»¥å¹³å‡ä¸‹æ¥ï¼ŒKafka æœåŠ¡çš„æˆæœ¬ä¼šæ¯”è¾ƒä½ã€‚&lt;/p&gt;
&lt;p&gt;æ¶ˆè´¹è€…æŒ‰å„è‡ªçš„éœ€æ±‚è¿›è¡Œæ•°æ®è½¬æ¢å­˜å‚¨ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;å¯¹äºå®ç°é«˜ååèƒ½åŠ›ï¼Œé™¤äº†åˆ†ç‰‡ï¼ŒKakfa è¿˜å……åˆ†åˆ©ç”¨äº†æ”’æ‰¹å¤„ç†ï¼šç”Ÿäº§è€…å¯ä»¥æ‰¹é‡å‘é€ï¼Œä¸­é—´äººå°†æ•°æ®æ”’æ‰¹å†™å…¥ç£ç›˜æ—¥å¿—æ–‡ä»¶ ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œç”±äºæ¶‰åŠå¤§é‡çš„ç£ç›˜æ–‡ä»¶å’Œç½‘ç»œä¹‹é—´æ•°æ®è¯»å†™ï¼ŒKafka è¿˜å……åˆ†åˆ©ç”¨æ“ä½œç³»ç»Ÿå†…æ ¸çš„é›¶æ‹·è´ä¼ è¾“èƒ½åŠ›ã€‚&lt;/p&gt;</content><category term="å…¶ä»–"></category><category term="è®ºæ–‡"></category><category term="ç¬”è®°"></category></entry><entry><title>Lucene æŸ¥è¯¢è§£æå™¨è¯­æ³•ï¼ˆè¯‘ï¼‰</title><link href="http://youngsterxyf.github.io/2019/09/04/lucene-query-parser-syntax/" rel="alternate"></link><published>2019-09-04T00:00:00+08:00</published><updated>2019-09-04T00:00:00+08:00</updated><author><name>xiayf</name></author><id>tag:youngsterxyf.github.io,2019-09-04:/2019/09/04/lucene-query-parser-syntax/</id><summary type="html">&lt;p&gt;åŸæ–‡ï¼š&lt;a href="http://lucene.apache.org/core/8_2_0/queryparser/org/apache/lucene/queryparser/classic/package-summary.html#package.description"&gt;Query Parser Syntax&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;æ¦‚è§ˆ&lt;/h2&gt;
&lt;p&gt;Lucene é™¤äº†æä¾› API æ–¹ä¾¿å¼€å‘è€…åˆ›å»ºæŸ¥è¯¢è¯·æ±‚ï¼Œè¿˜é€šè¿‡ä¸€ä¸ªæŸ¥è¯¢è§£æå™¨ï¼ˆä¸€ä¸ªè¯æ³•åˆ†æå™¨ï¼Œä½¿ç”¨ JavaCC å°†ä¸€ä¸ªå­—ç¬¦ä¸² â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;åŸæ–‡ï¼š&lt;a href="http://lucene.apache.org/core/8_2_0/queryparser/org/apache/lucene/queryparser/classic/package-summary.html#package.description"&gt;Query Parser Syntax&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;æ¦‚è§ˆ&lt;/h2&gt;
&lt;p&gt;Lucene é™¤äº†æä¾› API æ–¹ä¾¿å¼€å‘è€…åˆ›å»ºæŸ¥è¯¢è¯·æ±‚ï¼Œè¿˜é€šè¿‡ä¸€ä¸ªæŸ¥è¯¢è§£æå™¨ï¼ˆä¸€ä¸ªè¯æ³•åˆ†æå™¨ï¼Œä½¿ç”¨ JavaCC å°†ä¸€ä¸ªå­—ç¬¦ä¸²ç¿»è¯‘æˆä¸€ä¸ª Lucene æŸ¥è¯¢ï¼‰æä¾›ä¸€ç§åŠŸèƒ½ä¸°å¯Œçš„æŸ¥è¯¢è¯­è¨€ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬æ¥è¯´ï¼ŒæŸ¥è¯¢è§£æå™¨æ”¯æŒçš„è¯­æ³•åœ¨ä¸åŒå‘å¸ƒç‰ˆæœ¬ä¹‹é—´å¯èƒ½ä¼šæœ‰å˜åŒ–ã€‚å½“å‰è¿™ä¸ªæ–‡æ¡£é¡µé¢æè¿°çš„æ˜¯å½“å‰è¿™ä¸ªå‘å¸ƒç‰ˆæœ¬çš„è¯­æ³•ã€‚å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ä¸€ä¸ªä¸åŒç‰ˆæœ¬çš„ Luceneï¼Œè¯·å‚è€ƒè¯¥ç‰ˆæœ¬è‡ªå¸¦çš„ docs/queryparsersyntax.html æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨é€‰æ‹©ä½¿ç”¨è¿™ä¸ªæŸ¥è¯¢è§£æå™¨ä¹‹å‰ï¼Œè¯·è€ƒè™‘ä»¥ä¸‹ 3 ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœä½ å‡†å¤‡ä»¥ç¼–ç¨‹çš„æ–¹å¼ç”Ÿæˆä¸€ä¸ªæŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œç„¶åä½¿ç”¨æŸ¥è¯¢è§£æå™¨æ¥è§£æå®ƒã€‚é‚£ä¹ˆï¼Œä½ åº”è¯¥è®¤çœŸè€ƒè™‘ä¸€ä¸‹æ˜¯å¦åº”è¯¥ç›´æ¥ä½¿ç”¨æŸ¥è¯¢ API æ¥æ„å»ºæŸ¥è¯¢ã€‚æ¢å¥è¯è¯´ï¼ŒæŸ¥è¯¢è§£æå™¨ä¸“é—¨ç”¨äºäººç±»è¾“å…¥çš„æ–‡æœ¬ï¼Œè€Œä¸æ˜¯ç¨‹åºç”Ÿæˆçš„æ–‡æœ¬ã€‚&lt;/li&gt;
&lt;li&gt;ä¸å¯åˆ†è¯ï¼ˆuntokenizedï¼‰çš„åŸŸï¼ˆè¯‘è€…æ³¨ï¼šæŠ±æ­‰ï¼Œæ­¤å¤„æ²¡å¤ªç†è§£ï¼‰æœ€å¥½ç›´æ¥æ·»åŠ åˆ°æŸ¥è¯¢ä¸­ï¼Œè€Œä¸æ˜¯é€šè¿‡æŸ¥è¯¢è§£æå™¨æ¥è§£æã€‚å¦‚æœä¸€ä¸ªåŸŸçš„å€¼æ˜¯é€šè¿‡åº”ç”¨è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œé‚£ä¹ˆåº”è¯¥ä¸ºè¿™ä¸ªåŸŸè‡ªåŠ¨ç”ŸæˆæŸ¥è¯¢å­å¥ã€‚åˆ†æå™¨ï¼ˆæŸ¥è¯¢è§£æå™¨æ‰€ä½¿ç”¨çš„ï¼‰æ˜¯ä¸“é—¨ç”¨äºå°†äººç±»è¾“å…¥çš„æ–‡æœ¬è½¬æ¢æˆä¸€äº›è¯ï¼ˆtermsï¼‰ï¼Œé‚£ä¹ˆç¨‹åºè‡ªåŠ¨ç”Ÿæˆçš„å€¼ï¼Œä¹Ÿåº”è¯¥ç”±ç¨‹åºè‡ªåŠ¨æ·»åŠ åˆ°æŸ¥è¯¢ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;ä»æŸ¥è¯¢å½¢å¼æ¥çœ‹ï¼Œå¦‚æœåŸŸçš„å€¼æ˜¯æ™®é€šæ–‡æœ¬ï¼Œåˆ™åº”è¯¥ä½¿ç”¨æŸ¥è¯¢è§£æå™¨ã€‚æ‰€æœ‰å…¶å®ƒå€¼ç±»å‹ï¼Œæ¯”å¦‚ï¼šæ—¥æœŸèŒƒå›´ã€å…³é”®è¯ç­‰ç­‰ï¼Œæœ€å¥½é€šè¿‡æŸ¥è¯¢ API ç›´æ¥æ·»åŠ ã€‚å¦‚æœä¸€ä¸ªåŸŸçš„å€¼ä»…é™äºä¸€ä¸ªæœ‰é™çš„é›†åˆï¼ˆå¯ä»¥é€šè¿‡ä¸€ä¸ªä¸‹æ‹‰èœå•æŒ‡å®šï¼‰ï¼Œåˆ™ä¸åº”è¯¥æ·»åŠ åˆ°æŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆåç»­ä¼šè¢«è§£æï¼‰ä¸­ï¼Œè€Œæ˜¯åº”è¯¥ä½œä¸ºä¸€ä¸ª TermQuery å­å¥æ·»åŠ åˆ°æŸ¥è¯¢ä¸­ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;è¯ï¼ˆTermsï¼‰&lt;/h2&gt;
&lt;p&gt;ä¸€ä¸ªæŸ¥è¯¢è¯­å¥å¯ä»¥æ‹†è§£æˆ è¯ï¼ˆtermsï¼‰ å’Œ æ“ä½œç¬¦ï¼ˆoperatorsï¼‰ã€‚è¯åˆåˆ†ä¸ºä¸¤ç§ï¼šå•ä¸ªè¯ï¼ˆsingle Termsï¼‰å’ŒçŸ­è¯­ï¼ˆPhrasesï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å•ä¸ªè¯æ˜¯æŒ‡ â€testâ€œ æˆ– â€Helloâ€œ è¿™ç±»å•è¯ã€‚&lt;/p&gt;
&lt;p&gt;çŸ­è¯­æ˜¯æŒ‡ä»¥åŒå¼•å·åŒ…å›´èµ·æ¥çš„ä¸€ç»„å•è¯ï¼Œæ¯”å¦‚ï¼šâ€hello dollyâ€œã€‚&lt;/p&gt;
&lt;p&gt;å¤šä¸ªè¯ï¼ˆMultiple termsï¼‰å¯ä»¥ä½¿ç”¨å¸ƒå°”æ“ä½œç¬¦ç»„åˆåœ¨ä¸€èµ·ï¼Œå®ç°ä¸€ä¸ªæ›´åŠ å¤æ‚çš„æŸ¥è¯¢ï¼ˆå¦‚ä¸‹æ–‡æ‰€ç¤ºï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å¤‡æ³¨ï¼šç”¨äºåˆ›å»ºç´¢å¼•çš„è§£æå™¨ä¹Ÿä¼šç”¨äºè§£ææŸ¥è¯¢å­—ç¬¦ä¸²ä¸­çš„è¯å’ŒçŸ­è¯­ã€‚å› æ­¤ï¼Œé€‰æ‹©åˆé€‚çš„è§£æå™¨å¾ˆé‡è¦ï¼Œå¦åˆ™è§£æå™¨å¯èƒ½ä¼šè¢«æŸ¥è¯¢å­—ç¬¦ä¸²ä¸­çš„è¯å¹²æ‰°ï¼ˆè¯‘è€…æ³¨ï¼šè¿™å¥åº”è¯¥æ˜¯æŒ‡è‹±æ–‡è§£æå™¨å¯èƒ½æ— æ³•å¯¹ä¸­æ–‡è¿›è¡Œæ­£ç¡®åˆ†è¯çš„é—®é¢˜ï¼‰ã€‚&lt;/p&gt;
&lt;h2&gt;åŸŸï¼ˆFieldsï¼‰&lt;/h2&gt;
&lt;p&gt;Lucene æ”¯æŒåˆ†å¤šä¸ªå­—æ®µ/åŸŸçš„æ•°æ®ã€‚æœç´¢æ—¶ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªåŸŸï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é»˜è®¤åŸŸã€‚åŸŸçš„åç§°ä»¥åŠé»˜è®¤åŸŸä¸å…·ä½“å®ç°ç›¸å…³ã€‚&lt;/p&gt;
&lt;p&gt;è¾“å…¥åŸŸçš„åç§°ï¼Œåè·Ÿä¸€ä¸ªå†’å·ï¼ˆ:ï¼‰ï¼Œä»¥åŠç›®æ ‡æœç´¢è¯ï¼Œå³å¯å¯¹ä»»æ„ä¸€ä¸ªåŸŸè¿›è¡Œæœç´¢ã€‚&lt;/p&gt;
&lt;p&gt;ä¸¾ä¾‹æ¥è¯´ï¼Œå‡è®¾ä¸€ä¸ª Lucene ç´¢å¼•åŒ…å« 2 ä¸ªåŸŸï¼štitle å’Œ textï¼Œtext æ˜¯é»˜è®¤åŸŸã€‚è‹¥æƒ³æŸ¥æ‰¾æ ‡é¢˜ä¸º â€The Right Wayâ€œ ä¸”æ–‡æœ¬å†…å®¹åŒ…å« â€don't go this wayâ€œ çš„æ–‡æ¡£ï¼Œå¯ä»¥è¾“å…¥ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;title:&lt;span style="color: #a31515"&gt;&amp;quot;The Right Way&amp;quot;&lt;/span&gt; &lt;span style="color: #0000ff"&gt;AND&lt;/span&gt; &lt;span style="color: #2b91af"&gt;text&lt;/span&gt;&lt;span style="border: 1px solid #FF0000"&gt;:&lt;/span&gt;&lt;span style="color: #0000ff"&gt;go&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æˆ–è€…ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;title:&lt;span style="color: #a31515"&gt;&amp;quot;The Right Way&amp;quot;&lt;/span&gt; &lt;span style="color: #0000ff"&gt;AND&lt;/span&gt; &lt;span style="color: #0000ff"&gt;go&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å› ä¸º text æ˜¯é»˜è®¤åŸŸï¼Œæ‰€ä»¥åŸŸçš„æ ‡å¿—å¯ä»¥çœç•¥ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šæŒ‡å®šçš„åŸŸä»…å¯¹ç´§è·Ÿå…¶åçš„è¯ç”Ÿæ•ˆï¼Œå› æ­¤ï¼Œå¦‚ä¸‹æŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;title:The Right Way
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å°†å¯¹ title åŸŸä»…æŸ¥æ‰¾ â€Theâ€œï¼Œå¹¶å¯¹é»˜è®¤åŸŸï¼ˆå½“å‰è¿™ä¸ªä¾‹å­ä¸­æ˜¯æŒ‡ text åŸŸï¼‰æŸ¥æ‰¾ â€Rightâ€œ å’Œ â€Wayâ€œã€‚&lt;/p&gt;
&lt;h2&gt;è¯ä¿®é¥°è¯­ï¼ˆTerm Modifiersï¼‰&lt;/h2&gt;
&lt;p&gt;Lucene æ”¯æŒä¿®é¥°æŸ¥è¯¢è¯ï¼ˆmodifying query termsï¼‰æ¥æä¾›å¤šç§æœç´¢æ–¹å¼ã€‚&lt;/p&gt;
&lt;h3&gt;é€šé…ç¬¦æœç´¢&lt;/h3&gt;
&lt;p&gt;Lucene æ”¯æŒå¯¹å•ä¸ªè¯(single terms)ï¼ˆä¸æ˜¯çŸ­è¯­æŸ¥è¯¢ phrase queriesï¼‰è¿›è¡Œå•ä¸ªå­—ç¬¦å’Œå¤šä¸ªå­—ç¬¦çš„é€šé…æœç´¢ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;?&lt;/code&gt; ç¬¦å·è¿›è¡Œå•ä¸ªå­—ç¬¦çš„é€šé…æœç´¢ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;*&lt;/code&gt; ç¬¦å·è¿›è¡Œå¤šä¸ªå­—ç¬¦çš„é€šé…æœç´¢ã€‚&lt;/p&gt;
&lt;p&gt;å•å­—ç¬¦é€šé…æœç´¢ç”¨äºæŸ¥æ‰¾æ›¿æ¢å•ä¸ªå­—ç¬¦å³å¯åŒ¹é…çš„è¯ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œè‹¥è¦æœç´¢ â€textâ€œ æˆ– â€testâ€œï¼Œå¯ä»¥å¦‚ä¸‹æŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;te?t
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¤šå­—ç¬¦é€šé…æœç´¢ç”¨äºæŸ¥æ‰¾æ›¿æ¢0ä¸ªæˆ–å¤šä¸ªå­—ç¬¦å³å¯åŒ¹é…çš„è¯ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œè‹¥è¦æœç´¢ â€testâ€œã€â€testsâ€œ æˆ– â€testerâ€œï¼Œå¯ä»¥å¦‚ä¸‹æŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;test*
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¹Ÿå¯ä»¥å¯¹è¯çš„ä¸­é—´éƒ¨åˆ†è¿›è¡Œé€šé…æœç´¢ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;te*t
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¤‡æ³¨ï¼šä¸å¯ä»¥å°† &lt;code&gt;*&lt;/code&gt; æˆ– &lt;code&gt;?&lt;/code&gt; ç¬¦å·ç”¨ä½œä¸€æ¬¡æœç´¢çš„é¦–ä¸ªå­—ç¬¦ã€‚&lt;/p&gt;
&lt;h3&gt;æ­£åˆ™è¡¨è¾¾å¼æœç´¢&lt;/h3&gt;
&lt;p&gt;Lucene æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼æœç´¢ï¼ŒåŒ¹é…æ–œæ ï¼ˆ&lt;code&gt;/&lt;/code&gt;ï¼‰ ä¹‹é—´çš„æ¨¡å¼ã€‚æ­£åˆ™è¡¨è¾¾å¼çš„è¯­æ³•åœ¨ä¸åŒçš„å‘å¸ƒç‰ˆæœ¬ä¹‹é—´å¯èƒ½ä¼šæœ‰å·®å¼‚ï¼Œç›®å‰æ”¯æŒçš„è¯­æ³•åœ¨ &lt;a href="http://lucene.apache.org/core/8_2_0/core/org/apache/lucene/util/automaton/RegExp.html?is-external=true"&gt;RegExp&lt;/a&gt; ç±»æ–‡æ¡£ä¸­æœ‰è¯´æ˜ã€‚ä¸¾ä¾‹æ¥è¯´ï¼ŒæŸ¥æ‰¾åŒ…å« â€moatâ€œ æˆ– â€boatâ€œ çš„æ–‡æ¡£ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;/[mb]oat/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;æ¨¡ç³Šæœç´¢&lt;/h3&gt;
&lt;p&gt;Lucene æ”¯æŒåŸºäº Damerau-Levenshtein ç¼–è¾‘è·ç¦»çš„æ¨¡ç³Šæœç´¢ã€‚åœ¨å•ä¸ªè¯çš„æœ€åæ·»åŠ æ³¢æµªç¬¦ï¼ˆ~ï¼‰å³å¯è¿›è¡Œæ¨¡ç³Šæœç´¢ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œä½¿ç”¨æ¨¡ç³Šæœç´¢æŸ¥æ‰¾æ‹¼å†™ä¸Šè¿‘ä¼¼ â€roamâ€œ çš„è¯ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;roam~
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿™ä¸ªæŸ¥è¯¢è¯­å¥ä¼šæ‰¾åˆ° foam å’Œ roams è¿™ç±»è¯ã€‚&lt;/p&gt;
&lt;p&gt;æ¨¡ç³Šæœç´¢å¯ä»¥é€šè¿‡ä¸€ä¸ªé¢å¤–ï¼ˆå¯é€‰ï¼‰çš„å‚æ•°æ¥æŒ‡å®šå…è®¸çš„æœ€å¤§ç¼–è¾‘æ¬¡æ•°ã€‚è¿™ä¸ªå‚æ•°å€¼ç•Œäº 0 å’Œ 2 ä¹‹é—´ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;roam~1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æœæœªæŒ‡å®šè¯¥å‚æ•°ï¼Œåˆ™é»˜è®¤ä½¿ç”¨ 2 ä¸ªç¼–è¾‘è·ç¦»ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥å‰ï¼Œè¿™é‡Œè¿˜å…è®¸ä½¿ç”¨æµ®ç‚¹æ•°ã€‚ç°åœ¨è¿™ä¸ªè¯­æ³•å·²è¢«è€ƒè™‘å¼ƒç”¨ï¼Œå°†äº Lucene 5.0 ä¸­ç§»é™¤ã€‚&lt;/p&gt;
&lt;h3&gt;é‚»è¿‘æœç´¢&lt;/h3&gt;
&lt;p&gt;Lucene æ”¯æŒæŸ¥æ‰¾æŒ‡å®šè·ç¦»çš„é‚»è¿‘è¯ã€‚åœ¨çŸ­è¯­çš„æœ€åæ·»åŠ æ‹¨æµªç¬¦ï¼ˆ~ï¼‰å³å¯è¿›è¡Œé‚»è¿‘æœç´¢ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œåœ¨æ–‡æ¡£ä¸­æœç´¢ â€apacheâ€œ å’Œ â€jakartaâ€œ ç›¸è· 10 ä¸ªè¯çš„æ¨¡å¼ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;quot;jakarta apache&amp;quot;~10
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;èŒƒå›´æœç´¢&lt;/h3&gt;
&lt;p&gt;èŒƒå›´æŸ¥è¯¢å¯ä»¥è¦æ±‚åŸŸçš„å€¼åœ¨èŒƒå›´æŸ¥è¯¢è¯­å¥æŒ‡å®šçš„ä¸Šä¸‹ç•Œä¹‹é—´ã€‚èŒƒå›´æŸ¥è¯¢å¯¹äºä¸Šä¸‹ç•Œå¯ä»¥åŒ…å«ä¹Ÿå¯ä»¥ä¸åŒ…å«ã€‚æ’åºæŒ‰ç…§å­—å…¸åºè¿›è¡Œã€‚&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;mod_date:[20020101 TO 20030101]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿™ä¸ªæŸ¥è¯¢è¯­å¥ä¼šæŸ¥æ‰¾ mod_date åŸŸçš„å€¼åœ¨ 20020101 å’Œ 20030101 ï¼ˆåŒ…å«ä¸Šä¸‹ç•Œï¼‰ ä¹‹é—´çš„æ–‡æ¡£ã€‚æ³¨æ„ï¼šèŒƒå›´æŸ¥è¯¢å¹¶ä¸æ˜¯ä»…é€‚ç”¨äºæ—¥æœŸåŸŸï¼Œä¹Ÿå¯ä»¥å¯¹éæ—¥æœŸçš„åŸŸè¿›è¡ŒèŒƒå›´æŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;title:{Aida TO Carmen}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿™ä¸ªæŸ¥è¯¢è¯­å¥ä¼šæŸ¥æ‰¾åˆ° title åŸŸçš„å€¼åœ¨ Aida å’Œ Carmen ï¼ˆä¸åŒ…å«ä¸Šä¸‹ç•Œï¼‰ä¹‹é—´çš„æ‰€æœ‰æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;p&gt;åŒ…å«ä¸Šä¸‹ç•Œçš„èŒƒå›´æŸ¥è¯¢ä½¿ç”¨æ–¹æ‹¬å·æ¥è¡¨ç¤ºã€‚ä¸åŒ…å«ä¸Šä¸‹ç•Œçš„èŒƒå›´æŸ¥è¯¢ä½¿ç”¨å¤§æ‹¬å·æ¥è¡¨ç¤ºã€‚&lt;/p&gt;
&lt;h3&gt;è¯åŠ æƒï¼ˆBoosting a termï¼‰&lt;/h3&gt;
&lt;p&gt;Lucene ä¼šåŸºäºæ–‡æ¡£ä¸­æ‰¾åˆ°çš„è¯å¯¹åŒ¹é…åˆ°çš„æ–‡æ¡£æä¾›ç›¸å…³æ€§çº§åˆ«ï¼ˆè¯‘è€…ç–‘é—®ï¼šåŸºäºå‘é‡ä½™å¼¦æ¥è®¡ç®—ç›¸å…³æ€§ï¼Ÿï¼‰ã€‚å¯ä»¥åœ¨ç›®æ ‡æœç´¢è¯ä¹‹åç´§æ¥ä¸€ä¸ªè„±å­—ç¬¦ â€œ^â€ï¼Œåè·Ÿä¸€ä¸ªåŠ æƒç³»æ•°ï¼ˆä¸€ä¸ªæ•°å­—ï¼‰æ¥æå‡è¯¥æœç´¢è¯çš„ç›¸å…³æ€§æƒé‡ã€‚åŠ æƒç³»ç»Ÿè¶Šé«˜ï¼ŒæŸ¥è¯¢å‘½ä¸­çš„æ–‡æ¡£ä¸è¯¥è¯çš„ç›¸å…³æ€§è¶Šå¼ºã€‚&lt;/p&gt;
&lt;p&gt;åŠ æƒæ“ä½œå…è®¸å¯¹è¯è¿›è¡ŒåŠ æƒæ§åˆ¶æ–‡æ¡£çš„ç›¸å…³æ€§ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ æ­£åœ¨æœç´¢ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;jakarta apache
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç„¶åå¸Œæœ›æœç´¢ç»“æœå’Œè¯ â€jakartaâ€œ æ›´ç›¸å…³ä¸€äº›ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ â€^â€œ ç¬¦å·åè·Ÿä¸€ä¸ªåŠ æƒç³»æ•°å¯¹è¿™ä¸ªè¯è¿›è¡ŒåŠ æƒï¼Œå³å¦‚ä¸‹è¿™æ ·æŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;jakarta^4 apache
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿™ä¼šä½¿å¾—æŸ¥æ‰¾åˆ°çš„æ–‡æ¡£å’Œè¯ â€jakartaâ€œ çœ‹èµ·æ¥æ›´ç›¸å…³ä¸€äº›ã€‚ä¹Ÿå¯ä»¥å¯¹çŸ­è¯­è¿›è¡ŒåŠ æƒï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;quot;jakarta apache&amp;quot;^4 &amp;quot;Apache Lucene&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é»˜è®¤ï¼ŒåŠ æƒç³»æ•°æ˜¯ 1ã€‚åŠ æƒç³»ç»Ÿå¯ä»¥å°äº 1ï¼ˆæ¯”å¦‚ï¼š0.2ï¼‰ï¼Œä½†å¿…é¡»å¤§äº 0ã€‚&lt;/p&gt;
&lt;h2&gt;å¸ƒå°”æ“ä½œç¬¦&lt;/h2&gt;
&lt;p&gt;å¸ƒå°”æ“ä½œç¬¦å…è®¸ä½¿ç”¨é€»è¾‘æ“ä½œç¬¦ç»„åˆå¤šä¸ªè¯ã€‚Lucene æ”¯æŒçš„å¸ƒå°”æ“ä½œç¬¦åŒ…å« &lt;code&gt;AND&lt;/code&gt;ã€&lt;code&gt;+&lt;/code&gt;ã€&lt;code&gt;OR&lt;/code&gt;ã€&lt;code&gt;NOT&lt;/code&gt; åŠ &lt;code&gt;-&lt;/code&gt;ï¼ˆå¤‡æ³¨ï¼šå¸ƒå°”æ“ä½œç¬¦å¿…é¡»å…¨éƒ¨æ˜¯å¤§å†™å­—æ¯ï¼‰ã€‚&lt;/p&gt;
&lt;h3&gt;OR&lt;/h3&gt;
&lt;p&gt;â€œORâ€ æ“ä½œç¬¦æ˜¯é»˜è®¤çš„è¿æ¥æ“ä½œç¬¦ã€‚è¿™æ„å‘³ç€å¦‚æœä¸¤ä¸ªè¯ä¹‹é—´æ²¡æœ‰å¸ƒå°”æ“ä½œç¬¦ï¼Œåˆ™ä½¿ç”¨ â€œORâ€ æ“ä½œç¬¦ã€‚OR æ“ä½œç¬¦é“¾æ¥ä¸¤ä¸ªè¯ï¼Œå¹¶åŒ¹é…åŒ…å«å…¶ä¸­ä»»æ„ä¸€ä¸ªè¯çš„æ–‡æ¡£ã€‚è¿™ç›¸å½“äºé›†åˆçš„å¹¶é›†æ“ä½œã€‚â€œ||â€ ç¬¦åˆå¯ç”¨äºæ›¿ä»£å•è¯ â€œORâ€ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ï¼Œä½¿ç”¨å¦‚ä¸‹æŸ¥è¯¢è¯­å¥æ¥æœç´¢åŒ…å« â€œjakarta apacheâ€ æˆ–ä»…æ˜¯ â€œjakartaâ€ çš„æ–‡æ¡£ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;quot;jakarta apache&amp;quot; jakarta
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æˆ–ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;quot;jakarta apache&amp;quot; OR jakarta
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;AND&lt;/h3&gt;
&lt;p&gt;"AND" æ“ä½œç¬¦ä¼šåŒ¹é…æ–‡æœ¬å†…å®¹ä¸­åŒæ—¶å­˜åœ¨ä¸¤ä¸ªè¯ï¼ˆå› ä¸º AND æ˜¯äºŒå…ƒæ“ä½œç¬¦ï¼‰çš„æ–‡æ¡£ã€‚è¿™ç›¸å½“äºé›†åˆçš„äº¤é›†æ“ä½œã€‚â€œ&amp;amp;&amp;amp;â€ ç¬¦å·å¯ç”¨äºæ›¿ä»£å•è¯ â€œANDâ€ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ï¼Œä½¿ç”¨å¦‚ä¸‹æŸ¥è¯¢è¯­å¥æ¥æœç´¢åŒ…å« â€œjakarta apacheâ€ å’Œ â€œApache Luceneâ€ çš„æ–‡æ¡£ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;quot;jakarta apache&amp;quot; AND â€œApache Luceneâ€
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;+&lt;/h3&gt;
&lt;p&gt;â€œ+â€ï¼ˆå¿…éœ€ï¼‰æ“ä½œç¬¦è¦æ±‚æ–‡æ¡£çš„æŸä¸ªåŸŸä¸­åŒ…å« â€œ+â€ ç¬¦å·ä¹‹åçš„è¯ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ï¼Œä½¿ç”¨å¦‚ä¸‹æŸ¥è¯¢è¯­å¥æ¥æœç´¢ï¼ˆå¿…é¡»ï¼‰åŒ…å« â€œjakartaâ€ ä»¥åŠå¯èƒ½åŒ…å« â€œluceneâ€ï¼ˆåŒ…ä¸åŒ…å«éƒ½å¯ä»¥ï¼‰çš„æ–‡æ¡£ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;+jakarta lucene
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;NOT&lt;/h3&gt;
&lt;p&gt;è‹¥æ–‡æ¡£åŒ…å«â€NOTâ€œä¹‹åçš„è¯ï¼Œâ€NOTâ€œ æ“ä½œä¼šæ’æŸ¥è¯¥æ–‡æ¡£ã€‚è¿™ç›¸å½“äºé›†åˆçš„å·®é›†æ“ä½œã€‚â€!â€œ ç¬¦å·å¯ç”¨äºæ›¿ä»£å•è¯ â€NOTâ€œã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ï¼Œä½¿ç”¨å¦‚ä¸‹æŸ¥è¯¢è¯­å¥æœç´¢åŒ…å« â€jakarta apacheâ€œ ä½†ä¸åŒ…å« â€Apache Luceneâ€œ çš„æ–‡æ¡£â€ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;quot;jakarta apache&amp;quot; NOT &amp;quot;Apache Lucene&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¤‡æ³¨ï¼šâ€œNOTâ€ æ“ä½œç¬¦ä¸å¯ä»¥ç”¨äºå•ä¸ªè¯ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹æœç´¢ä¸ä¼šè¿”å›ä»»ä½•ç»“æœï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;NOT &amp;quot;jakarta apache&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;-&lt;/h3&gt;
&lt;p&gt;å¦‚æœæ–‡æ¡£åŒ…å«â€-â€œç¬¦å·ä¹‹åçš„è¯ï¼Œé‚£ä¹ˆâ€-â€œï¼ˆç¦æ­¢ï¼‰æ“ä½œç¬¦ä¼šæ’é™¤è¿™äº›æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ï¼Œä½¿ç”¨å¦‚ä¸‹æŸ¥è¯¢è¯­å¥æ¥æŸ¥è¯¢åŒ…å« â€jakarta apacheâ€œ ä½†ä¸åŒ…å« â€Apache Luceneâ€œ çš„æ–‡æ¡£ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;quot;jakarta apache&amp;quot; -&amp;quot;Apache Lucene&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;åˆ†ç»„&lt;/h2&gt;
&lt;p&gt;Lucene æ”¯æŒä½¿ç”¨åœ†æ‹¬å·å¯¹å­å¥è¿›è¡Œåˆ†ç»„ï¼Œæ„æˆå­æŸ¥è¯¢ã€‚å¦‚æœä½ æƒ³æ§åˆ¶ä¸€ä¸ªæŸ¥è¯¢è¯­å¥çš„å¸ƒå°”é€»è¾‘ï¼Œè¿™å¯¹éå¸¸æœ‰ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ï¼Œä½¿ç”¨å¦‚ä¸‹æŸ¥è¯¢è¯­å¥æ¥æœç´¢åŒ…å« â€œjakartaâ€ æˆ– â€œapacheâ€ï¼Œä»¥åŠ â€œwebsiteâ€ çš„æ–‡æ¡£ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;(jakarta OR apache) AND website
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æ­¤å°±æ¶ˆé™¤äº†ä»»ä½•å›°æƒ‘ï¼Œç¡®ä¿ä½ æƒ³è¡¨è¾¾æ˜¯ï¼šå¿…é¡»å­˜åœ¨ â€websiteâ€œï¼Œä»¥åŠå¯èƒ½å­˜åœ¨è¯ â€jakartaâ€œ æˆ– â€apacheâ€œã€‚&lt;/p&gt;
&lt;h2&gt;åŸŸåˆ†ç»„&lt;/h2&gt;
&lt;p&gt;Lucene æ”¯æŒä½¿ç”¨åœ†æ‹¬å·å¯¹å•ä¸ªåŸŸçš„å¤šä¸ªå­å¥è¿›è¡Œåˆ†ç»„ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œè‹¥æƒ³æœç´¢ä¸€ä¸ª title ä¸­æ—¢åŒ…å«å•è¯â€œreturnâ€ä¸”åŒ…å«çŸ­è¯­â€œpink pantherâ€ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;title:&lt;span style="color: #a31515"&gt;(&lt;/span&gt;+&lt;span style="color: #0000ff"&gt;return&lt;/span&gt; +&lt;span style="color: #a31515"&gt;&amp;quot;pink panther&amp;quot;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰&lt;/h2&gt;
&lt;p&gt;Lucene æ”¯æŒå¯¹æŸ¥è¯¢è¯­æ³•ä½¿ç”¨çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ç§»ã€‚ç›®å‰è¿™äº›ç‰¹æ®Šå­—ç¬¦å¦‚ä¸‹åˆ—è¡¨æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;+ - &amp;amp;&amp;amp; || ! ( ) { } [ ] ^ &amp;quot; ~ * ? : \ /
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åœ¨ç‰¹æ®Šå­—ç¬¦ä¹‹å‰åŠ  &lt;code&gt;\&lt;/code&gt; æ¥è½¬ä¹‰ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨å¦‚ä¸‹æŸ¥è¯¢è¯­å¥æ¥æœç´¢ &lt;code&gt;(1+1):2&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;\(1\+1\)\:2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="å…¶ä»–"></category><category term="ç¿»è¯‘"></category><category term="Lucene"></category><category term="ElasticSearch"></category><category term="Kibana"></category></entry><entry><title>ä¸€ä¸ª Python å°é¡¹ç›®çš„å°ç»“</title><link href="http://youngsterxyf.github.io/2019/08/14/a-python-project-summary/" rel="alternate"></link><published>2019-08-14T00:00:00+08:00</published><updated>2019-08-14T00:00:00+08:00</updated><author><name>xiayf</name></author><id>tag:youngsterxyf.github.io,2019-08-14:/2019/08/14/a-python-project-summary/</id><summary type="html">&lt;p&gt;å‰æ®µæ—¶é—´ä¸´æ—¶æ¥æ‰‹ä¸€ä¸ª Python å°é¡¹ç›®ï¼Œè¿™ä¸ªé¡¹ç›®å®ç°çš„ç±»ä¼¼ä¸€ä¸ªç®¡æ§å¹³å°ï¼Œå…¶ä¸­æ ¸å¿ƒåŠŸèƒ½æ˜¯ä¸ºç®—æ³•åŒå­¦æä¾›æœºå™¨å­¦ä¹ æ¨¡å‹è®­ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;å‰æ®µæ—¶é—´ä¸´æ—¶æ¥æ‰‹ä¸€ä¸ª Python å°é¡¹ç›®ï¼Œè¿™ä¸ªé¡¹ç›®å®ç°çš„ç±»ä¼¼ä¸€ä¸ªç®¡æ§å¹³å°ï¼Œå…¶ä¸­æ ¸å¿ƒåŠŸèƒ½æ˜¯ä¸ºç®—æ³•åŒå­¦æä¾›æœºå™¨å­¦ä¹ æ¨¡å‹è®­ç»ƒä»»åŠ¡çš„å…¨æµç¨‹ç®¡ç†ï¼Œå¹³å°åç«¯åŸºäº Flask æ¡†æ¶å®ç°ï¼Œå‰ç«¯åŸºäº Ant Design Pro å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;ä»£ç ç¨å¾®æœ‰äº›ä¹±ï¼Œæ‰€ä»¥åšäº†éƒ¨åˆ†ä»£ç çš„é‡æ„ï¼Œåœ¨æ­¤åšç‚¹ç»éªŒå°ç»“ã€‚&lt;/p&gt;
&lt;h3&gt;1ã€å¹¶è¡ŒåŒ–æˆ–å¼‚æ­¥åŒ–&lt;/h3&gt;
&lt;p&gt;éƒ¨åˆ†è¯·æ±‚å¤„ç†é€»è¾‘ï¼Œç”±äºæ¯”è¾ƒè€—æ—¶ï¼Œæ•…ä½¿ç”¨çº¿ç¨‹æ± æ¥åŠ é€Ÿï¼Œæˆ–è€…ä½¿ç”¨ç‹¬ç«‹çº¿ç¨‹å¼‚æ­¥å¤„ç†ï¼Œæˆ–è€…å…ˆå­˜å‚¨ä¸€ä¸ªä¸­é—´çŠ¶æ€ï¼Œç”±åå°å®šæ—¶ä»»åŠ¡æ¥å®Œæˆå®é™…çš„å¤„ç†å·¥ä½œã€‚å¯¹äºå¼‚æ­¥å¤„ç†ç»“æœï¼Œå‰ç«¯é€šè¿‡è½®è¯¢æ¥è·å–ã€‚&lt;/p&gt;
&lt;p&gt;çº¿ç¨‹æ± çš„ä½¿ç”¨ï¼Œä¸»è¦ä½¿ç”¨ map æ–¹æ³•ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #0000ff"&gt;from&lt;/span&gt; multiprocessing.dummy &lt;span style="color: #0000ff"&gt;import&lt;/span&gt; Pool

input_list = [...]
pool: Pool = Pool(len(input_list))
pool.map(func, input_list)
pool.close()
pool.join()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç‹¬ç«‹çº¿ç¨‹å¼‚æ­¥å¤„ç†ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #0000ff"&gt;import&lt;/span&gt; multiprocessing

p = multiprocessing.Process(target=func, args=(...))
p.start()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å®šæ—¶ä»»åŠ¡ï¼ŒåŸºäº apscheduler åº“å®ç°ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #0000ff"&gt;from&lt;/span&gt; apscheduler.schedulers.background &lt;span style="color: #0000ff"&gt;import&lt;/span&gt; BackgroundScheduler

scheduler = BackgroundScheduler()

scheduler.add_join(func, &lt;span style="color: #a31515"&gt;&amp;#39;interval&amp;#39;&lt;/span&gt;, seconds=1)

scheduler.start()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å› ä¸ºå¯¹äº Python åº”ç”¨ï¼Œé€šå¸¸ä¼šä½¿ç”¨ gunicorn è¿™ç§ WSGI HTTP æœåŠ¡å™¨ä»¥å¤šè¿›ç¨‹å¯åŠ¨å¤šä¸ªåº”ç”¨å®ä¾‹ï¼Œæå‡è¯·æ±‚ååèƒ½åŠ›ã€‚ä½†æ˜¯å¯¹äºå®šæ—¶ä»»åŠ¡æˆ‘ä»¬å¸Œæœ›åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¯¹æ­¤ï¼Œå¦‚æœä½¿ç”¨ gunicornï¼Œå¯ä»¥åŸºäºå®ƒçš„ preload æœºåˆ¶æ¥å®ç°ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #008000"&gt;# wsgi.py&lt;/span&gt;
&lt;span style="color: #0000ff"&gt;import&lt;/span&gt; app

&lt;span style="color: #0000ff"&gt;if&lt;/span&gt; __name__ == &lt;span style="color: #a31515"&gt;&amp;quot;__main__&amp;quot;&lt;/span&gt;:
    app.run()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #008000"&gt;# æ³¨æ„å…¶ä¸­çš„ --preload å‚æ•°&lt;/span&gt;
gunicorn --workers=4 --preload --log-level=info --access-logfile=access.log -b 0.0.0.0:8080 wsgi:app
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;preload æœºåˆ¶ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ import app ç±»æ‰€åœ¨çš„æ¨¡å—åŠå…¶ä¾èµ–çš„å„ä¸ªæ¨¡å—ï¼ˆimport è¿‡ç¨‹ä¸­ä¼šæ‰§è¡Œå…¶ä¸­çš„è¯­å¥ï¼‰ï¼Œç„¶å fork å‡ºå¤šä¸ªè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æ‰§è¡Œ app.run()ã€‚&lt;/p&gt;
&lt;h4&gt;2ã€å®ç°ä¸€äº›é€šç”¨æ–¹æ¡ˆå¯¹å¼‚å¸¸è¿›è¡Œæ•è·æˆ–é‡è¯•&lt;/h4&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #0000ff"&gt;def&lt;/span&gt; exception_try(times: int = 3, sleep_then_try_seconds=&lt;span style="color: #0000ff"&gt;None&lt;/span&gt;):
    &lt;span style="color: #0000ff"&gt;def&lt;/span&gt; decorator(f):
        &lt;span style="color: #0000ff"&gt;def&lt;/span&gt; wrapper(*args, **kwargs):
            count = 0
            exception = &lt;span style="color: #0000ff"&gt;None&lt;/span&gt;
            &lt;span style="color: #0000ff"&gt;while&lt;/span&gt; count &amp;lt; times:
                &lt;span style="color: #0000ff"&gt;try&lt;/span&gt;:
                    &lt;span style="color: #0000ff"&gt;return&lt;/span&gt; f(*args, **kwargs)
                &lt;span style="color: #0000ff"&gt;except&lt;/span&gt; Exception &lt;span style="color: #0000ff"&gt;as&lt;/span&gt; e:
                    exception = e
                    count += 1
                    logging.exception(&lt;span style="color: #a31515"&gt;&amp;quot;Try {} times&amp;quot;&lt;/span&gt;.format(count))
                    &lt;span style="color: #0000ff"&gt;if&lt;/span&gt; (sleep_then_try_seconds &lt;span style="color: #0000ff"&gt;is&lt;/span&gt; &lt;span style="color: #0000ff"&gt;not&lt;/span&gt; &lt;span style="color: #0000ff"&gt;None&lt;/span&gt;) &lt;span style="color: #0000ff"&gt;and&lt;/span&gt; count &amp;lt; times:
                        time.sleep(sleep_then_try_seconds)
            &lt;span style="color: #0000ff"&gt;raise&lt;/span&gt; exception
        &lt;span style="color: #0000ff"&gt;return&lt;/span&gt; wrapper
    &lt;span style="color: #0000ff"&gt;return&lt;/span&gt; decorator
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;@exception_try(times=3, sleep_then_try_seconds=0.5)
&lt;span style="color: #0000ff"&gt;def&lt;/span&gt; connect(self):
    &lt;span style="color: #0000ff"&gt;return&lt;/span&gt; pymysql.connect(host=self.host, user=self.user, password=self.password, db=self.db, charset=self.charset)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿™ä¸ªè£…é¥°å™¨æ–¹æ³•ç”¨äºå®ç°å¼‚å¸¸é‡è¯•ï¼Œå¹¶ä¸”å¯ä»¥æŒ‡å®šé‡è¯•çš„æ—¶é—´é—´éš”ï¼Œå®é™…ä½¿ç”¨ä¸‹æ¥æ•ˆæœè¾ƒå¥½ã€‚è€Œä¸”ä¹Ÿä¸ä¼šå› ä¸º &lt;code&gt;try...except&lt;/code&gt; å¯¼è‡´å¤§å—ä»£ç ç¼©è¿›ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¡®ä¿æ•°æ®åº“è¿æ¥å…³é—­ï¼ˆå…¶å®ƒç±»ä¼¼èµ„æºä¹Ÿå¯ä»¥è¿™æ ·å®ç°ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #0000ff"&gt;def&lt;/span&gt; with_db(db: Connection, exception_callback=&lt;span style="color: #0000ff"&gt;None&lt;/span&gt;):
    &lt;span style="color: #0000ff"&gt;def&lt;/span&gt; decorator(f):
        &lt;span style="color: #0000ff"&gt;def&lt;/span&gt; db_context(*a, **kw):
            &lt;span style="color: #0000ff"&gt;try&lt;/span&gt;:
                &lt;span style="color: #0000ff"&gt;return&lt;/span&gt; f(db, *a, **kw)
            &lt;span style="color: #0000ff"&gt;except&lt;/span&gt; Exception &lt;span style="color: #0000ff"&gt;as&lt;/span&gt; e:
                logging.exception(str(e))
                &lt;span style="color: #0000ff"&gt;if&lt;/span&gt; exception_callback &lt;span style="color: #0000ff"&gt;is&lt;/span&gt; &lt;span style="color: #0000ff"&gt;not&lt;/span&gt; &lt;span style="color: #0000ff"&gt;None&lt;/span&gt;:
                    exception_callback(e)
            &lt;span style="color: #0000ff"&gt;finally&lt;/span&gt;:
                &lt;span style="color: #0000ff"&gt;try&lt;/span&gt;:
                    db.close()
                &lt;span style="color: #0000ff"&gt;except&lt;/span&gt;:
                    &lt;span style="color: #0000ff"&gt;pass&lt;/span&gt;
        &lt;span style="color: #0000ff"&gt;return&lt;/span&gt; db_context

    &lt;span style="color: #0000ff"&gt;return&lt;/span&gt; decorator
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #008000"&gt;# å°† conf.db.connect() å¯¹è±¡ä½œä¸º delete_task_from_job_queue çš„ç¬¬ä¸€ä¸ªå‚æ•°æ³¨å…¥ï¼Œtask_id è¿™ä¸ªå‚æ•°ä»¥ä¸å®šå‚æ•°çš„æ–¹å¼ä¼ å…¥ delete_task_from_job_queue&lt;/span&gt;
with_db(conf.db.connect())(delete_task_from_job_queue)(task_id)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿™ä¸ªè£…é¥°å™¨æ–¹æ³•ç”¨äºç¡®ä¿æ•°æ®åº“è¿æ¥åœ¨å¼‚å¸¸å‘ç”Ÿä¹Ÿèƒ½æ­£å¸¸å…³é—­ï¼Œé˜²æ­¢èµ„æºæ³„éœ²ã€‚&lt;/p&gt;
&lt;h4&gt;3ã€å¾ªç¯ç­‰å¾…æˆ–è¶…æ—¶&lt;/h4&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #0000ff"&gt;class&lt;/span&gt; &lt;span style="color: #2b91af"&gt;TimeoutCondition&lt;/span&gt;(object):

    &lt;span style="color: #0000ff"&gt;def&lt;/span&gt; __init__(self, condition_func, timeout_seconds):
        self.condition = condition_func
        self.timeout = timeout_seconds
        self.begin = &lt;span style="color: #0000ff"&gt;None&lt;/span&gt;
        self.timeout_false = &lt;span style="color: #0000ff"&gt;True&lt;/span&gt;
        self.cond_true = &lt;span style="color: #0000ff"&gt;True&lt;/span&gt;

    &lt;span style="color: #0000ff"&gt;def&lt;/span&gt; __bool__(self):
        &lt;span style="color: #0000ff"&gt;if&lt;/span&gt; self.begin &lt;span style="color: #0000ff"&gt;is&lt;/span&gt; &lt;span style="color: #0000ff"&gt;None&lt;/span&gt;:
            self.begin = timeit.default_timer()
        self.cond_true = self.condition()
        self.timeout_false = self.timeout &amp;lt;= 0 &lt;span style="color: #0000ff"&gt;or&lt;/span&gt; (timeit.default_timer() - self.begin) &amp;lt; self.timeout
        &lt;span style="color: #0000ff"&gt;return&lt;/span&gt; self.cond_true &lt;span style="color: #0000ff"&gt;and&lt;/span&gt; self.timeout_false

    &lt;span style="color: #0000ff"&gt;def&lt;/span&gt; is_timeout(self):
        &lt;span style="color: #0000ff"&gt;return&lt;/span&gt; self.cond_true &lt;span style="color: #0000ff"&gt;and&lt;/span&gt; &lt;span style="color: #0000ff"&gt;not&lt;/span&gt; self.timeout_false
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cond = TimeoutCondition(&lt;span style="color: #0000ff"&gt;lambda&lt;/span&gt; : len(service_list) == 0, 5)
&lt;span style="color: #0000ff"&gt;while&lt;/span&gt; cond:
    time.sleep(1)
    service_list = get_service_list()
&lt;span style="color: #0000ff"&gt;if&lt;/span&gt; cond.is_timeout():
    &lt;span style="color: #0000ff"&gt;return&lt;/span&gt; &lt;span style="color: #0000ff"&gt;None&lt;/span&gt;, &lt;span style="color: #0000ff"&gt;None&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;TimeoutCondition&lt;/code&gt; ç”¨äºå®ç°å¾ªç¯ç­‰å¾…æŸä¸ªæ¡ä»¶æ»¡è¶³ï¼Œä½†ä¸ºäº†é¿å…æ­»å¾ªç¯ï¼Œæ‰€ä»¥åŠ ä¸€ä¸ªè¶…æ—¶æ¡ä»¶åˆ¤æ–­ã€‚å®ä¾‹åŒ–å‚æ•°ç¬¬ä¸€ä¸ªæ˜¯åŸå§‹çš„æ¡ä»¶åˆ¤æ–­ lambda è¯­å¥ï¼Œç¬¬äºŒä¸ªæ˜¯ä¸€ä¸ªè¶…æ—¶è®¾ç½®ã€‚å¦å¤–ï¼Œå€ŸåŠ©é­”æœ¯æ–¹æ³• &lt;code&gt;__bool__&lt;/code&gt;ï¼Œè®© TimeoutCondtion çš„å®ä¾‹ç”¨èµ·æ¥åƒæ˜¯ä¸€ä¸ªå¸ƒå°”å˜é‡ï¼Œè°ƒç”¨ &lt;code&gt;is_timeout()&lt;/code&gt; æ–¹æ³•å¯ä»¥åŒºåˆ†å¾ªç¯ç­‰å¾…é€€å‡ºæ˜¯å› ä¸ºåŸå§‹æ¡ä»¶æ»¡è¶³ï¼Œè¿˜æ˜¯è¶…æ—¶é€€å‡ºçš„ã€‚&lt;/p&gt;
&lt;h4&gt;4ã€æŒ‰éƒ¨ç½²ç¯å¢ƒé…ç½®åº”ç”¨çš„è¡Œä¸º&lt;/h4&gt;
&lt;p&gt;åº”ç”¨åœ¨ä¸åŒçš„ç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰ä¸­åº”è¯¥å…è®¸åŠ è½½ä¸åŒçš„é…ç½®ï¼Œé…ç½®ä¸åŒçš„è¡Œä¸ºã€‚&lt;/p&gt;
&lt;p&gt;å½“å‰åº”ç”¨å¤„äºä»€ä¹ˆç¯å¢ƒï¼Œå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡æ¥é…ç½®ï¼Œåº”ç”¨åˆå§‹åŒ–æ—¶æœ€å…ˆæ£€æµ‹å½“å‰å¤„äºä»€ä¹ˆç¯å¢ƒï¼Œä¹‹åçš„åˆå§‹åŒ–æµç¨‹å°±å¯ä»¥ä¾æ®ç¯å¢ƒé…ç½®æ¥åŠ è½½é…ç½®ï¼Œå®šåˆ¶åº”ç”¨è¡Œä¸ºã€‚&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #008000"&gt;# conf/__init__.py&lt;/span&gt;
&lt;span style="color: #0000ff"&gt;class&lt;/span&gt; &lt;span style="color: #2b91af"&gt;AppConfig&lt;/span&gt;(object):
    app_env = os.getenv(&lt;span style="color: #a31515"&gt;&amp;#39;APP_ENV&amp;#39;&lt;/span&gt;, &lt;span style="color: #a31515"&gt;&amp;#39;development&amp;#39;&lt;/span&gt;)
    is_prod = app_env == &lt;span style="color: #a31515"&gt;&amp;#39;production&amp;#39;&lt;/span&gt;
    is_dev = app_env == &lt;span style="color: #a31515"&gt;&amp;#39;development&amp;#39;&lt;/span&gt;
    is_testing = app_env == &lt;span style="color: #a31515"&gt;&amp;#39;testing&amp;#39;&lt;/span&gt;

    &lt;span style="color: #008000"&gt;# å…¶ä½™åº”ç”¨é…ç½®é¡¹&lt;/span&gt;
    ...

conf = AppConfig()


&lt;span style="color: #0000ff"&gt;def&lt;/span&gt; _load_config_by_env(env: str):
    &lt;span style="color: #a31515"&gt;&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;
&lt;span style="color: #a31515"&gt;    ä¸åŒç¯å¢ƒåŠ è½½ä¸åŒçš„é…ç½®æ–‡ä»¶&lt;/span&gt;
&lt;span style="color: #a31515"&gt;    é…ç½®ç›®å½•ç»“æ„ï¼š&lt;/span&gt;
&lt;span style="color: #a31515"&gt;    conf/&lt;/span&gt;
&lt;span style="color: #a31515"&gt;        __init__.py&lt;/span&gt;
&lt;span style="color: #a31515"&gt;        development.py&lt;/span&gt;
&lt;span style="color: #a31515"&gt;        production.py&lt;/span&gt;
&lt;span style="color: #a31515"&gt;        testing.py&lt;/span&gt;
&lt;span style="color: #a31515"&gt;    &amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;
    module = importlib.import_module(&lt;span style="color: #a31515"&gt;&amp;#39;conf.{}&amp;#39;&lt;/span&gt;.format(env))
    &lt;span style="color: #0000ff"&gt;if&lt;/span&gt; &lt;span style="color: #0000ff"&gt;not&lt;/span&gt; hasattr(module, &lt;span style="color: #a31515"&gt;&amp;#39;Config&amp;#39;&lt;/span&gt;):
        logging.warning(&lt;span style="color: #a31515"&gt;&amp;#39;Not find {} config&amp;#39;&lt;/span&gt;.format(env))
        &lt;span style="color: #0000ff"&gt;return&lt;/span&gt;
    &lt;span style="color: #0000ff"&gt;for&lt;/span&gt; name, value &lt;span style="color: #0000ff"&gt;in&lt;/span&gt; getattr(module, &lt;span style="color: #a31515"&gt;&amp;#39;Config&amp;#39;&lt;/span&gt;).__dict__.items():
        &lt;span style="color: #0000ff"&gt;if&lt;/span&gt; name.startswith(&lt;span style="color: #a31515"&gt;&amp;#39;__&amp;#39;&lt;/span&gt;):
            &lt;span style="color: #0000ff"&gt;continue&lt;/span&gt;
        conf.__dict__[name] = value
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #008000"&gt;# æ ¹æ®ç¯å¢ƒé…ç½®æ—¥å¿—çº§åˆ«&lt;/span&gt;
log_level = logging.INFO &lt;span style="color: #0000ff"&gt;if&lt;/span&gt; conf.is_prod &lt;span style="color: #0000ff"&gt;else&lt;/span&gt; logging.DEBUG
logging.basicConfig(format=consts.LOG_FORMAT, level=log_level)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;5ã€æ–¹ä¾¿æ’æŸ¥é—®é¢˜çš„æ—¥å¿—è¾“å‡º&lt;/h4&gt;
&lt;p&gt;æ—¥å¿—æ˜¯é—®é¢˜æ’æŸ¥çš„ä¸»è¦ä¿¡æ¯æ¥æºï¼Œæ‰€ä»¥æ—¥å¿—è®°å½•å¾—å¥½ä¸å¥½ï¼Œå¾ˆå…³é”®ã€‚&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #008000"&gt;# https://github.com/python/cpython/blob/3.7/Lib/logging/__init__.py#L457&lt;/span&gt;
&lt;span style="color: #008000"&gt;# æ—¥å¿—æ—¶é—´ - æ—¥å¿—çº§åˆ« - ä»£ç æ–‡ä»¶è·¯å¾„ - è¡Œå· - è¿›ç¨‹ ID - çº¿ç¨‹åç§° - æ—¥å¿—å†…å®¹&lt;/span&gt;
LOG_FORMAT = &lt;span style="color: #a31515"&gt;&amp;#39;%(asctime)-15s - %(levelname)s - %(pathname)s - %(lineno)d - %(process)d - %(threadName)s - %(message)s&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;6ã€API è§„èŒƒä¸å¼‚å¸¸æç¤º&lt;/h4&gt;
&lt;p&gt;ä¸ºäº†ç»Ÿä¸€å‰ç«¯ API å“åº”å¤„ç†ï¼Œæœ‰å¿…è¦å¯¹ API å“åº”ä½“çš„ç»“æ„æŒ‡å®šæ ‡å‡†ã€‚ä»¥æˆ‘ä¸ªäººçš„ä¹ æƒ¯ï¼Œæ‰€æœ‰ä»åº”ç”¨ä»£ç ä¸­è¿”å›çš„å“åº”ï¼ŒHTTP çŠ¶æ€ç éƒ½åº”è¯¥æ˜¯ 200ï¼Œå…·ä½“å½“å‰ API è¯·æ±‚æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œå¦‚æœå¤±è´¥ï¼Œå¤±è´¥çš„åŸå› æ˜¯ä»€ä¹ˆéƒ½åº”è¯¥åŒ…å«åœ¨å“åº”ä½“ä¸­ï¼Œå“åº”ä½“å¤§è‡´çš„ç»“æ„ä¸ºï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;{
    &amp;quot;code&amp;quot;: &lt;span style="border: 1px solid #FF0000"&gt;...&lt;/span&gt;,
    &amp;quot;msg&amp;quot;: &lt;span style="color: #a31515"&gt;&amp;quot;...&amp;quot;&lt;/span&gt;,
    &amp;quot;data&amp;quot;: &lt;span style="border: 1px solid #FF0000"&gt;...&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;code è¡¨ç¤ºè¯·æ±‚å¤„ç†å¤±è´¥æ—¶ï¼Œdata å­—æ®µå¯é€‰ï¼Œcode è¡¨ç¤ºè¯·æ±‚å¤„ç†æˆåŠŸæ—¶ï¼Œmsg å­—æ®µå¯é€‰ã€‚&lt;/p&gt;
&lt;p&gt;å‰ç«¯é…åˆå¯¹å“åº”ä½“è¿›è¡Œç»Ÿä¸€æ£€æµ‹å’Œæç¤ºï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #0000ff"&gt;import&lt;/span&gt; { notification } &lt;span style="color: #0000ff"&gt;from&lt;/span&gt; &lt;span style="color: #a31515"&gt;&amp;#39;antd&amp;#39;&lt;/span&gt;;

&lt;span style="color: #0000ff"&gt;function&lt;/span&gt; defaultHTTPCodeHandler(response) {
  &lt;span style="color: #0000ff"&gt;if&lt;/span&gt; (response.status &amp;gt;= 400) {
    &lt;span style="color: #008000"&gt;// æ³¨æ„ clone&lt;/span&gt;
    response.clone().text().then(respBody =&amp;gt; {
      notification.error({message: &lt;span style="color: #a31515"&gt;&amp;#39;API å¼‚å¸¸å“åº”&amp;#39;&lt;/span&gt;, description: &lt;span style="color: #a31515"&gt;`${&lt;/span&gt;response.status&lt;span style="color: #a31515"&gt;}, ${&lt;/span&gt;respBody&lt;span style="color: #a31515"&gt;}`&lt;/span&gt;, duration: &lt;span style="color: #0000ff"&gt;null&lt;/span&gt;});
      console.log(&lt;span style="color: #a31515"&gt;`${&lt;/span&gt;response.status&lt;span style="color: #a31515"&gt;}, ${&lt;/span&gt;respBody&lt;span style="color: #a31515"&gt;}`&lt;/span&gt;);
    });
  }
}

&lt;span style="color: #0000ff"&gt;function&lt;/span&gt; defaultMsgCodeHandler(response) {
  &lt;span style="color: #0000ff"&gt;if&lt;/span&gt; (response.status === 200) {
    &lt;span style="color: #008000"&gt;// æ³¨æ„ clone&lt;/span&gt;
    response.clone().json().then(jsonBody =&amp;gt; {
      &lt;span style="color: #008000"&gt;// 0ã€200ã€10000 éƒ½å±äºæˆåŠŸå“åº”&lt;/span&gt;
      &lt;span style="color: #0000ff"&gt;if&lt;/span&gt; (jsonBody !== &lt;span style="color: #0000ff"&gt;undefined&lt;/span&gt; &amp;amp;&amp;amp; jsonBody.code !== &lt;span style="color: #0000ff"&gt;undefined&lt;/span&gt; &amp;amp;&amp;amp; jsonBody.code !== 0 &amp;amp;&amp;amp; jsonBody.code !== 200 &amp;amp;&amp;amp; jsonBody.code != 10000) {
        notification.error({message: &lt;span style="color: #a31515"&gt;&amp;#39;è¯·æ±‚å¤±è´¥&amp;#39;&lt;/span&gt;, description: &lt;span style="color: #a31515"&gt;`${&lt;/span&gt;jsonBody.code&lt;span style="color: #a31515"&gt;}, ${&lt;/span&gt;jsonBody.msg&lt;span style="color: #a31515"&gt;}`&lt;/span&gt;, duration: &lt;span style="color: #0000ff"&gt;null&lt;/span&gt;});
        console.log(&lt;span style="color: #a31515"&gt;`${&lt;/span&gt;jsonBody.code&lt;span style="color: #a31515"&gt;}, ${&lt;/span&gt;jsonBody.msg&lt;span style="color: #a31515"&gt;}`&lt;/span&gt;);
      }
    });
  }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¹¶ä¸”ç»Ÿä¸€å°è£…å‘èµ·è¯·æ±‚çš„é€»è¾‘ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #0000ff"&gt;export&lt;/span&gt; &lt;span style="color: #0000ff"&gt;function&lt;/span&gt; corsFetch(url, init, httpCodeCallback, msgCodeCallback) {
  &lt;span style="color: #0000ff"&gt;const&lt;/span&gt; host = myHost();
  &lt;span style="color: #0000ff"&gt;let&lt;/span&gt; urlPrefix = host;
  &lt;span style="color: #008000"&gt;// è‡ªå¸¦ hostï¼Œåˆ™ä¸é¢å¤–è¡¥å…… host å‰ç¼€&lt;/span&gt;
  &lt;span style="color: #0000ff"&gt;if&lt;/span&gt; (url.startsWith(&lt;span style="color: #a31515"&gt;&amp;quot;http://&amp;quot;&lt;/span&gt;) || url.startsWith(&lt;span style="color: #a31515"&gt;&amp;quot;https://&amp;quot;&lt;/span&gt;)) {
    urlPrefix = &lt;span style="color: #a31515"&gt;&amp;#39;&amp;#39;&lt;/span&gt;;
  }
  &lt;span style="color: #0000ff"&gt;const&lt;/span&gt; httpCodeHandler = httpCodeCallback === &lt;span style="color: #0000ff"&gt;undefined&lt;/span&gt; ? defaultHTTPCodeHandler : httpCodeCallback;
  &lt;span style="color: #0000ff"&gt;const&lt;/span&gt; msgCodeHandler = msgCodeCallback === &lt;span style="color: #0000ff"&gt;undefined&lt;/span&gt; ? defaultMsgCodeHandler : msgCodeCallback;
  &lt;span style="color: #008000"&gt;// å¯¹äºçº¿ä¸Šç¯å¢ƒæˆ–è€…æµ‹è¯•ç¯å¢ƒï¼Œä¸è·¨åŸŸ&lt;/span&gt;
  &lt;span style="color: #0000ff"&gt;if&lt;/span&gt; (host === PROD_ENV_HOST || host === TEST_ENV_HOST) {
    &lt;span style="color: #0000ff"&gt;const&lt;/span&gt; promise = fetch(urlPrefix + url, init);
    promise.then((response) =&amp;gt; httpCodeHandler(response));
    promise.then((response) =&amp;gt; msgCodeHandler(response));
    &lt;span style="color: #0000ff"&gt;return&lt;/span&gt; promise;
  }
  &lt;span style="color: #008000"&gt;// å¯¹äºæœ¬åœ°æµ‹è¯•ç¯å¢ƒï¼Œè·¨åŸŸè®¿é—®é¢„å‘ç¯å¢ƒ API æ•°æ®ï¼Œæ–¹ä¾¿æµ‹è¯•&lt;/span&gt;
  &lt;span style="color: #0000ff"&gt;let&lt;/span&gt; corsInit = {
    credentials: &lt;span style="color: #a31515"&gt;&amp;#39;include&amp;#39;&lt;/span&gt;,
    mode: &lt;span style="color: #a31515"&gt;&amp;#39;cors&amp;#39;&lt;/span&gt;,
    redirect: &lt;span style="color: #a31515"&gt;&amp;#39;follow&amp;#39;&lt;/span&gt;,
  };
  &lt;span style="color: #0000ff"&gt;if&lt;/span&gt; (init !== &lt;span style="color: #0000ff"&gt;undefined&lt;/span&gt;) {
    corsInit = { ...corsInit, ...init };
  }
  &lt;span style="color: #0000ff"&gt;if&lt;/span&gt; (urlPrefix !== &lt;span style="color: #a31515"&gt;&amp;#39;&amp;#39;&lt;/span&gt;) {
    urlPrefix = TEST_ENV_HOST;
  }
  &lt;span style="color: #0000ff"&gt;const&lt;/span&gt; promise = fetch(urlPrefix + url, corsInit);
  promise.then((response) =&amp;gt; httpCodeHandler(response));
  promise.then((response) =&amp;gt; msgCodeHandler(response));
  &lt;span style="color: #0000ff"&gt;return&lt;/span&gt; promise;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å…¶ä¸­ä¸ºäº†æ–¹ä¾¿æœ¬åœ°å¼€å‘æµ‹è¯•ï¼Œå…è®¸æœ¬åœ°å¼€å‘ç¯å¢ƒè·¨åŸŸè®¿é—®æµ‹è¯•ç¯å¢ƒï¼ˆæœ€å¥½ä¸è¦ç›´æ¥è·¨è¶Šè®¿é—®ç”Ÿäº§ç¯å¢ƒï¼‰ï¼Œå¹¶ä¸”è‡ªåŠ¨åŒºåˆ†ï¼ŒcorsFetch è°ƒç”¨æ–¹æ— æ„ŸçŸ¥ã€‚&lt;/p&gt;</content><category term="å…¶ä»–"></category><category term="æ€»ç»“"></category><category term="Python"></category></entry><entry><title>Reactor å®˜æ–¹æ–‡æ¡£ç¿»è¯‘ç®€åŒ–ç‰ˆ</title><link href="http://youngsterxyf.github.io/2019/06/26/simplified-reactor-doc-zh/" rel="alternate"></link><published>2019-06-26T00:00:00+08:00</published><updated>2019-06-26T00:00:00+08:00</updated><author><name>xiayf</name></author><id>tag:youngsterxyf.github.io,2019-06-26:/2019/06/26/simplified-reactor-doc-zh/</id><summary type="html">&lt;p&gt;åŸæ–‡ï¼š&lt;a href="https://projectreactor.io/docs/core/release/reference/"&gt;Reactor 3 Reference Guide&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;1. èµ·æ­¥&lt;/h3&gt;
&lt;h4&gt;1.1 Reactor ç®€ä»‹&lt;/h4&gt;
&lt;p&gt;Reactor æ˜¯ä¸º JVM å‡†å¤‡çš„ä¸€ä¸ªå®Œå…¨éé˜»å¡çš„ååº”å¼ç¼–ç¨‹åŸºç¡€ç»„ä»¶ï¼Œæ”¯æŒé«˜æ•ˆçš„éœ€æ±‚ç®¡ç†ï¼ˆä»¥ç®¡ç† â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;åŸæ–‡ï¼š&lt;a href="https://projectreactor.io/docs/core/release/reference/"&gt;Reactor 3 Reference Guide&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;1. èµ·æ­¥&lt;/h3&gt;
&lt;h4&gt;1.1 Reactor ç®€ä»‹&lt;/h4&gt;
&lt;p&gt;Reactor æ˜¯ä¸º JVM å‡†å¤‡çš„ä¸€ä¸ªå®Œå…¨éé˜»å¡çš„ååº”å¼ç¼–ç¨‹åŸºç¡€ç»„ä»¶ï¼Œæ”¯æŒé«˜æ•ˆçš„éœ€æ±‚ç®¡ç†ï¼ˆä»¥ç®¡ç†â€œåå‹â€çš„å½¢å¼ï¼‰ï¼Œç›´æ¥ä¸ Java 8 çš„å‡½æ•°å¼ API é›†æˆï¼Œå°¤å…¶æ˜¯ &lt;code&gt;CompletableFuture&lt;/code&gt;ã€&lt;code&gt;Stream&lt;/code&gt; ä»¥åŠ &lt;code&gt;Duration&lt;/code&gt;ï¼Œæä¾›å¯ç»„åˆçš„å¼‚æ­¥åºåˆ— API - &lt;code&gt;Flux&lt;/code&gt;ï¼ˆé€‚ç”¨äº N ä¸ªå…ƒç´ çš„åºåˆ—ï¼‰å’Œ &lt;code&gt;Mono&lt;/code&gt;ï¼ˆé€‚ç”¨äº 0 æˆ– 1ä¸ªå…ƒç´ çš„åºåˆ—ï¼‰--- å¹¶ä¸”å…¨é¢åœ°ï¼ˆextensivelyï¼‰å®ç°äº† &lt;a href="https://www.reactive-streams.org/"&gt;ååº”å¼æµï¼ˆReative Streamsï¼‰&lt;/a&gt; è§„èŒƒã€‚&lt;/p&gt;
&lt;p&gt;å€ŸåŠ© &lt;code&gt;reactor-netty&lt;/code&gt; é¡¹ç›®ï¼ŒReactor ä¹Ÿæ”¯æŒè¿›ç¨‹é—´çš„éé˜»å¡é€šä¿¡ï¼Œé€‚ç”¨äºå¾®æœåŠ¡æ¶æ„ã€‚&lt;code&gt;reactor-netty&lt;/code&gt; ä¸º HTTPï¼ˆåŒ…æ‹¬ Websocketsï¼‰ã€TCP ä»¥åŠ UDP æä¾›æ”¯æŒåå‹çš„ç½‘ç»œå¼•æ“ï¼Œå®Œå…¨æ”¯æŒååº”å¼ç¼–ç è§£ç ã€‚&lt;/p&gt;
&lt;h4&gt;1.2 ç†è§£ BOM&lt;/h4&gt;
&lt;p&gt;Reactor 3 å¼€å§‹é‡‡ç”¨ BOM ï¼ˆBill of Materialsï¼Œç‰©æ–™æ¸…å•ï¼‰å‘å¸ƒæ¨¡å‹ï¼ˆè‡ª &lt;code&gt;reactor-core 3.0.4&lt;/code&gt; å¼€å§‹ï¼Œä½¿ç”¨ &lt;code&gt;Aluminium&lt;/code&gt;ï¼ˆé“ï¼‰ç‰ˆæœ¬åºåˆ—ï¼‰ï¼Œä¸€ä¸ªç‰ˆæœ¬åŒ…å«ä¸€ç»„ç›¸å…³ç»„ä»¶çš„ç‰ˆæœ¬ï¼Œè¿™äº›ç‰ˆæœ¬ç»„ä»¶ä¹‹é—´å…¼å®¹æ€§éå¸¸å¥½ï¼Œå…è®¸è¿™äº›ç»„ä»¶é‡‡ç”¨ä¸åŒçš„ç‰ˆæœ¬å‘½åæ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;BOM å‘å¸ƒæ¨¡å‹æœ¬èº«ä¹Ÿæ˜¯ç‰ˆæœ¬åŒ–çš„ï¼Œä»¥ä¸€ä¸ªä»£å·åæ¥ä¸€ä¸ªä¿®é¥°è¯æ¥å‘½åä¸€ä¸ªç‰ˆæœ¬åºåˆ—ã€‚å¦‚ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹åˆ—è¡¨ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Aluminium-RELEASE
Californium-BUILD-SNAPSHOT
Aluminium-SR1
Bismuth-RELEASE
Californium-SR32
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä»£å·ç­‰ä»·äºå¸¸è§„çš„ &lt;code&gt;å¤§ç‰ˆæœ¬å·.å°ç‰ˆæœ¬å·&lt;/code&gt; å½¢å¼ï¼Œé€šå¸¸ä»¥å­—æ¯å‡åºæ–¹å¼å–è‡ª &lt;a href="https://en.wikipedia.org/wiki/Periodic_table#Overview"&gt;å…ƒç´ å‘¨æœŸè¡¨&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æŒ‰ç…§æ—¶é—´é¡ºåºï¼Œä¿®é¥°è¯åˆ†åˆ«ä¸ºå¦‚ä¸‹å‡ ä¸ªï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;BUILD-SNAPSHOTï¼šä¸ºå¼€å‘æµ‹è¯•æ„å»ºçš„ç‰ˆæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;M1 .. Nï¼šé‡Œç¨‹ç¢‘ç‰ˆæœ¬æˆ–è€…å¼€å‘è€…é¢„è§ˆç‰ˆæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;RELEASEï¼šä¸€ä¸ªä»£å·ç³»åˆ—ä¸­çš„é¦–ä¸ª GAï¼ˆGeneral Availability é€šç”¨ï¼‰å‘è¡Œç‰ˆã€‚&lt;/li&gt;
&lt;li&gt;SR1 .. Nï¼šä¸€ä¸ªä»£å·ç³»åˆ—ä¸­çš„åç»­ GA å‘è¡Œç‰ˆ - ç›¸å½“äºä¸€ä¸ªè¡¥ä¸ç‰ˆæœ¬ã€‚ï¼ˆSR ä»£è¡¨ â€œService Releaseâ€ï¼ˆæœåŠ¡ç‰ˆæœ¬ï¼‰ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;1.3 å¦‚ä½•è·å– Reactor&lt;/h4&gt;
&lt;h5&gt;1.3.1 ä»¥ Maven ç®¡ç†ä¾èµ–åŒ…&lt;/h5&gt;
&lt;p&gt;Maven åŸç”Ÿæ”¯æŒ BOM æ¨¡å‹æ¦‚å¿µã€‚é¦–å…ˆï¼Œåœ¨ä½ çš„ &lt;code&gt;pom.xml&lt;/code&gt; æ–‡ä»¶æ·»åŠ å¦‚ä¸‹ä»£ç ç‰‡æ®µæ¥å¼•å…¥ BOMï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;dependencyManagement&amp;gt; 
    &amp;lt;dependencies&amp;gt;
        &amp;lt;dependency&amp;gt;
            &amp;lt;groupId&amp;gt;io.projectreactor&amp;lt;/groupId&amp;gt;
            &amp;lt;artifactId&amp;gt;reactor-bom&amp;lt;/artifactId&amp;gt;
            &amp;lt;version&amp;gt;Bismuth-RELEASE&amp;lt;/version&amp;gt;
            &amp;lt;type&amp;gt;pom&amp;lt;/type&amp;gt;
            &amp;lt;scope&amp;gt;import&amp;lt;/scope&amp;gt;
        &amp;lt;/dependency&amp;gt;
    &amp;lt;/dependencies&amp;gt;
&amp;lt;/dependencyManagement&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;em&gt;å¤‡æ³¨ï¼šæ³¨æ„å…¶ä¸­çš„ &lt;code&gt;dependencyManagement&lt;/code&gt; æ ‡ç­¾ï¼Œæ·»åŠ åˆ° &lt;code&gt;dependencies&lt;/code&gt; ä¸€èŠ‚ä¸­ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœé¡¶éƒ¨æ ‡ç­¾ï¼ˆ&lt;code&gt;dependencyManagement&lt;/code&gt;ï¼‰å·²ç»å­˜åœ¨ï¼Œåˆ™åªæ·»åŠ ä¸Šé¢è¯¥æ ‡ç­¾çš„å†…éƒ¨å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œå°†ä¾èµ–åŒ…æ·»åŠ åˆ°é¡¹ç›®ä¸­ï¼Œå’Œä¸€èˆ¬ä¾èµ–åŒ…ä¸€æ ·ï¼Œä¸è¿‡æ²¡æœ‰ &lt;code&gt;&amp;lt;version&amp;gt;&lt;/code&gt;ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;dependencies&amp;gt;
    &amp;lt;dependency&amp;gt;
        &amp;lt;groupId&amp;gt;io.projectreactor&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;reactor-core&amp;lt;/artifactId&amp;gt; 
    &amp;lt;/dependency&amp;gt;
    &amp;lt;dependency&amp;gt;
        &amp;lt;groupId&amp;gt;io.projectreactor&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;reactor-test&amp;lt;/artifactId&amp;gt; 
        &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;
    &amp;lt;/dependency&amp;gt;
&amp;lt;/dependencies&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h5&gt;1.3.2 ä»¥ Gradle ç®¡ç†ä¾èµ–åŒ…&lt;/h5&gt;
&lt;p&gt;Gradle æ ¸å¿ƒå¹¶ä¸æ”¯æŒ Maven BOMï¼Œä¸è¿‡å¯ä»¥å€ŸåŠ© Spring çš„ &lt;a href="https://github.com/spring-gradle-plugins/dependency-management-plugin"&gt;gradle-dependency-management&lt;/a&gt; æ’ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œåº”ç”¨æ’ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;plugins {
    id &amp;quot;io.spring.dependency-management&amp;quot; version &amp;quot;1.0.6.RELEASE&amp;quot;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç„¶åä½¿ç”¨å®ƒæ¥å¼•å…¥ BOMï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;dependencyManagement {
     imports {
          mavenBom &amp;quot;io.projectreactor:reactor-bom:Bismuth-RELEASE&amp;quot;
     }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æœ€åå°†ä¾èµ–æ·»åŠ åˆ°é¡¹ç›®ä¸­ï¼Œæ— éœ€æŒ‡å®šç‰ˆæœ¬å·ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;dependencies {
     compile &amp;#39;io.projectreactor:reactor-core&amp;#39; 
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;2. ååº”å¼ç¼–ç¨‹ç®€ä»‹&lt;/h3&gt;
&lt;p&gt;Reactor æ˜¯ååº”å¼ç¼–ç¨‹èŒƒå¼çš„ä¸€ä¸ªå®ç°ã€‚ååº”å¼ç¼–ç¨‹çš„å®šä¹‰å½’çº³èµ·æ¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ååº”å¼ç¼–ç¨‹æ˜¯ä¸€ä¸ªå¼‚æ­¥ç¼–ç¨‹èŒƒå¼ï¼Œå…³æ³¨æ•°æ®æµå’Œå˜åŒ–çš„ä¼ æ’­ã€‚è¿™æ„å‘³ç€é€šè¿‡è¢«é‡‡ç”¨ç¼–ç¨‹è¯­è¨€å¯ä»¥è½»æ¾åœ°è¡¨è¾¾é™æ€ï¼ˆæ¯”å¦‚ æ•°ç»„ï¼‰æˆ–åŠ¨æ€ï¼ˆæ¯”å¦‚ äº‹ä»¶å‘å°„å™¨ï¼‰æ•°æ®æµã€‚ --- https://en.wikipedia.org/wiki/Reactive_programming&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ååº”å¼ç¼–ç¨‹æ–¹å‘çš„é¦–ä¸ªé‡è¦å·¥ä½œæ˜¯ï¼šå¾®è½¯åœ¨ .NET ç”Ÿæ€ä½“ç³»ä¸­åˆ›å»ºäº†ååº”å¼æ‰©å±•ï¼ˆRxï¼‰åº“ï¼Œç„¶å RxJava åœ¨ JVM ä¸Šå®ç°äº†ååº”å¼ç¼–ç¨‹ã€‚æ—¶å…‰é£é€ï¼Œç» Reative Streams çš„å¤§åŠ›æ¨è¿›ï¼ŒJava ç¤¾åŒºç»ˆäºå‡ºç°äº†ååº”å¼ç¼–ç¨‹æ ‡å‡†ï¼Œè¯¥è§„èŒƒå®šä¹‰äº†ä¸€ç»„æ¥å£ä»¥åŠ JVM ä¸Šååº”å¼ç¼–ç¨‹åº“ä¹‹é—´çš„äº¤äº’è§„åˆ™ã€‚Java 9 æ ‡å‡†åº“å·²å°†è¿™ç»„æ¥å£é›†æˆåˆ° &lt;code&gt;Flow&lt;/code&gt; ç±»ï¼ˆè¯‘æ³¨ï¼šè§&lt;a href="https://docs.oracle.com/javase/9/docs/api/java/util/concurrent/Flow.html"&gt;https://docs.oracle.com/javase/9/docs/api/java/util/concurrent/Flow.html&lt;/a&gt;ï¼‰ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ååº”å¼ç¼–ç¨‹èŒƒå¼åœ¨é¢å‘å¯¹è±¡è¯­è¨€ä¸­é€šå¸¸è¡¨ç°ä¸ºä¸€ä¸ªè§‚å¯Ÿè€…è®¾è®¡æ¨¡å¼çš„æ‰©å±•ã€‚ä½ ä¹Ÿå¯ä»¥å°†ä¸»æµçš„ååº”å¼æµæ¨¡å¼ï¼ˆreactive streams patternï¼‰å’Œå¤§å®¶ç†ŸçŸ¥çš„è¿­ä»£å™¨è®¾è®¡æ¨¡å¼åšå¯¹æ¯”ï¼Œæ‰€æœ‰è¿™äº›åº“ä¸­éƒ½å­˜åœ¨å¯¹æ ‡äº &lt;code&gt;Iterable&lt;/code&gt; - &lt;code&gt;Iterator&lt;/code&gt; çš„æ¦‚å¿µï¼ˆè¯‘æ³¨ï¼šæ¯”å¦‚ å‘å¸ƒè€…-æ¶ˆè´¹è€…ï¼‰ã€‚ä¸»è¦å·®åˆ«åœ¨äºï¼šè¿­ä»£å™¨æ˜¯åŸºäº pull æ–¹å¼ï¼Œååº”å¼æµåˆ™åŸºäº push æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨è¿­ä»£å™¨æ˜¯ä¸€ä¸ªå‘½ä»¤å¼ç¼–ç¨‹çš„æ¨¡å¼ï¼Œå³ä½¿å¦‚ä½•è®¿é—®æ•°æ®ï¼ˆaccessing valuesï¼‰å®Œå…¨æ˜¯ &lt;code&gt;Iterable&lt;/code&gt; çš„èŒè´£ï¼Œä½†å®é™…ä¸Šï¼Œä½•æ—¶è®¿é—®åºåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªï¼ˆ&lt;code&gt;next()&lt;/code&gt;ï¼‰å€¼å–å†³äºå¼€å‘è€…çš„é€‰æ‹©ã€‚åœ¨ååº”å¼æµä¸­ï¼Œä¸Šè¿° &lt;code&gt;Iterable&lt;/code&gt; - &lt;code&gt;Iterator&lt;/code&gt; å¯¹çš„ç­‰ä»·ç‰©ä¸º &lt;code&gt;Publisher&lt;/code&gt; - &lt;code&gt;Subscriber&lt;/code&gt;ã€‚ä¸è¿‡ï¼Œåœ¨å‡ºç°æ–°çš„æ•°æ®/äº‹ä»¶æ—¶ï¼Œç”± &lt;code&gt;Publisher&lt;/code&gt; é€šçŸ¥ &lt;code&gt;Subscriber&lt;/code&gt;ï¼Œè¿™ä¸ªâ€œæ¨â€ç‰¹æ€§ä¹Ÿæ˜¯å®ç°ååº”å¼çš„å…³é”®ä¹‹å¤„ã€‚å¹¶ä¸”ï¼Œåœ¨è¢«æ¨é€çš„å€¼ä¸Šåº”ç”¨å“ªäº›æ“ä½œæ˜¯å£°æ˜å¼è¡¨è¾¾è€Œä¸æ˜¯å‘½ä»¤å¼è¡¨è¾¾çš„ï¼šç¨‹åºå‘˜è¡¨è¾¾çš„æ˜¯è®¡ç®—é€»è¾‘è€Œä¸æ˜¯æè¿°ç²¾ç¡®çš„æ§åˆ¶æµã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº†â€œæ¨â€çš„ç‰¹æ€§ï¼Œååº”å¼æµä¹Ÿè‰¯å¥½åœ°å®šä¹‰äº†å¦‚ä½•å¤„ç†é”™è¯¯å’Œç»“æŸæµã€‚ä¸€ä¸ª &lt;code&gt;Publisher&lt;/code&gt; å¯ä»¥å‘å®ƒçš„ &lt;code&gt;Subscriber&lt;/code&gt; æ¨é€æ–°çš„å€¼ï¼ˆé€šè¿‡è°ƒç”¨è®¢é˜…è€…çš„ &lt;code&gt;onNext&lt;/code&gt; æ–¹æ³•ï¼‰ï¼Œä¹Ÿå¯ä»¥æ¨é€é”™è¯¯ï¼ˆè°ƒç”¨ &lt;code&gt;onError&lt;/code&gt; æ–¹æ³•ï¼‰æˆ–ç»“æŸï¼ˆè°ƒç”¨ &lt;code&gt;onComplete&lt;/code&gt;æ–¹æ³•ï¼‰ä¿¡å·ã€‚é”™è¯¯å’Œç»“æŸä¿¡å·éƒ½å¯ä»¥ç»ˆç»“äº‹ä»¶åºåˆ—ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;onNext x 0..N [onError | onComplete]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿™ä¸ªæ–¹å¼éå¸¸çµæ´»ã€‚è¿™ä¸ªæ¨¡å¼æ”¯æŒâ€œæ²¡æœ‰å€¼â€ã€â€œä¸€ä¸ªå€¼â€æˆ–â€œnä¸ªå€¼â€ï¼ˆåŒ…æ‹¬å€¼æ— é™çš„åºåˆ—ï¼Œæ¯”å¦‚æ—¶é’Ÿçš„æŒç»­æ»´ç­”äº‹ä»¶ï¼‰çš„å„ç§ä½¿ç”¨åœºæ™¯ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œèµ·åˆï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·ä¸€ä¸ªå¼‚æ­¥çš„ååº”å¼çš„ç¼–ç¨‹åº“ï¼Ÿ&lt;/p&gt;
&lt;h4&gt;2.1 é˜»å¡å³æ˜¯èµ„æºæµªè´¹&lt;/h4&gt;
&lt;p&gt;ç°ä»£çš„è½¯ä»¶åº”ç”¨ï¼Œå¹¶å‘ç”¨æˆ·é‡éå¸¸å·¨å¤§ï¼Œå³ä½¿ç°ä»£ç¡¬ä»¶çš„å¤„ç†èƒ½åŠ›ä¸€ç›´åœ¨æå‡ï¼Œè½¯ä»¶çš„æ€§èƒ½ä»æ—§æ˜¯ä¸€ä¸ªå…³é”®é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;å®½æ³›æ¥è®²ï¼Œæå‡ä¸€ä¸ªç¨‹åºçš„æ€§èƒ½ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¹¶è¡ŒåŒ–&lt;/strong&gt; ä½¿ç”¨æ›´å¤šçš„çº¿ç¨‹å’Œæ›´å¤šçš„ç¡¬ä»¶èµ„æºã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºå½“å‰çš„ç¡¬ä»¶èµ„æºï¼Œ&lt;strong&gt;å¯»æ±‚æ›´é«˜æ•ˆçš„ä½¿ç”¨æ–¹å¼&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šå¸¸ï¼ŒJava å¼€å‘è€…ä¼šä½¿ç”¨é˜»å¡æ€§çš„ä»£ç ç¼–å†™ç¨‹åºï¼Œè¿™ç§ä»£ç ç¼–å†™æ–¹å¼å®¹æ˜“è§¦åŠæ€§èƒ½ç“¶é¢ˆï¼Œç„¶åå¼•å…¥æ›´å¤šçš„çº¿ç¨‹æ¥è¿è¡Œç›¸ä¼¼çš„é˜»å¡æ€§ä»£ç ã€‚ä½†æ˜¯ï¼Œè¿™ç§èµ„æºåˆ©ç”¨çš„æ‰©å±•æ–¹å¼å¾ˆå¿«å°±ä¼šå¼•å‘ç«æ€ï¼ˆcontentionï¼‰å’Œå¹¶å‘çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;æ›´ç³Ÿç³•çš„æ˜¯ï¼Œé˜»å¡å°±æ„å‘³ç€æµªè´¹èµ„æºã€‚å¦‚æœä½ ç¨åŠ åˆ†æï¼Œå°±ä¼šå‘ç°ä¸€æ—¦ç¨‹åºç‰µæ¶‰ä¸€äº›ç­‰å¾…å»¶è¿Ÿï¼ˆå°¤å…¶æ˜¯ I/0 æ“ä½œï¼Œæ¯”å¦‚ç­‰å¾…ä¸€ä¸ªæ•°æ®åº“è¯·æ±‚æˆ–è€…ä¸€ä¸ªç½‘ç»œè°ƒç”¨ï¼‰ï¼Œèµ„æºå°±ä¼šè¢«æµªè´¹ï¼Œå› ä¸ºæ­¤æ—¶çº¿ç¨‹ï¼ˆå¯èƒ½æ˜¯å¤§é‡çº¿ç¨‹ï¼‰æ˜¯ç©ºé—²çš„ï¼Œç­‰å¾…ç€æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œå¹¶è¡ŒåŒ–æ–¹å¼å¹¶éé“¶å¼¹ã€‚ä¸ºäº†å‹æ¦¨å‡ºç¡¬ä»¶çš„å…¨éƒ¨èƒ½åŠ›ï¼Œå¹¶è¡ŒåŒ–æ˜¯å¿…è¦çš„ï¼Œä½†å¹¶è¡ŒåŒ–çš„ä»£ç ç†è§£ï¼ˆreason aboutï¼‰èµ·æ¥ä¹Ÿéå¸¸å¤æ‚ï¼Œå®é™…å¨åŠ›ä¹Ÿä¼šå› ä¸ºèµ„æºæµªè´¹è€Œå¤§æ‰“æŠ˜æ‰£ã€‚&lt;/p&gt;
&lt;h4&gt;2.2 å¼‚æ­¥å¯ä»¥è§£å†³é—®é¢˜å—ï¼Ÿ&lt;/h4&gt;
&lt;p&gt;å‰é¢æåˆ°çš„ç¬¬äºŒç§æ–¹å¼ - å¯»æ±‚æ›´é«˜æ•ˆçš„ä½¿ç”¨æ–¹å¼ - æ˜¯èµ„æºæµªè´¹é—®é¢˜çš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚é€šè¿‡ç¼–å†™å¼‚æ­¥éé˜»å¡çš„ä»£ç ï¼Œåœ¨å‘ç”Ÿé˜»å¡ç­‰å¾…æ—¶ï¼Œåˆ‡æ¢æ‰§è¡Œå¦ä¸€ä¸ªæ´»è·ƒä»»åŠ¡ï¼Œæ´»è·ƒä»»åŠ¡ä½¿ç”¨çš„æ˜¯ç›¸åŒçš„åº•å±‚èµ„æºï¼Œç„¶ååœ¨å¼‚æ­¥å¤„ç†è¿‡ç¨‹ç»“æŸåå†åˆ‡å›åˆ°å½“å‰è¿›ç¨‹æ¥æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯æˆ‘ä»¬å¦‚ä½•ç¼–å†™åœ¨ JVM ä¸Šå¼‚æ­¥æ‰§è¡Œçš„ä»£ç ï¼Ÿ Java æä¾›äº†ä¸¤ç§å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å›è°ƒ&lt;/strong&gt;ï¼šå¼‚æ­¥æ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼Œä½†æ¥å—ä¸€ä¸ªé¢å¤–çš„ &lt;code&gt;callbackï¼ˆå›è°ƒï¼‰&lt;/code&gt;å‚æ•°ï¼ˆä¸€ä¸ª lambda è¡¨è¾¾å¼æˆ–åŒ¿åç±»ï¼‰ï¼Œåœ¨å¾—åˆ°å¼‚æ­¥å¤„ç†ç»“æœæ—¶ä¼šè°ƒç”¨è¿™ä¸ªå›è°ƒã€‚ä¸€ä¸ªä¼—æ‰€å‘¨çŸ¥çš„ä¾‹å­æ˜¯ Swing çš„ &lt;code&gt;EventListener&lt;/code&gt; æ´¾ç”Ÿç±»ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Future&lt;/strong&gt;ï¼šè¿™ç§å¼‚æ­¥æ–¹æ³•åœ¨è°ƒç”¨æ—¶ä¼š&lt;em&gt;å³åˆ»&lt;/em&gt;è¿”å›ä¸€ä¸ª &lt;code&gt;Future&amp;lt;T&amp;gt;&lt;/code&gt;ã€‚è¿™ä¸ªå¼‚æ­¥è¿‡ç¨‹ä¼šè®¡ç®—å‡ºä¸€ä¸ª &lt;code&gt;T&lt;/code&gt; ç±»å‹çš„å€¼ï¼Œä¸è¿‡éœ€è¦é€šè¿‡ &lt;code&gt;Future&lt;/code&gt; å¯¹è±¡æ¥è®¿é—®ã€‚è®¡ç®—å‡ºæ¥çš„å€¼ä¸èƒ½ç«‹å³å¯ç”¨ï¼Œå¯ä»¥å¯¹ &lt;code&gt;Future&lt;/code&gt; å¯¹è±¡è¿›è¡Œæ¢è¯¢ç›´åˆ°å€¼è®¡ç®—å‡ºæ¥ã€‚ä¾‹å¦‚ï¼š&lt;code&gt;ExecutorService&lt;/code&gt; è¿è¡Œ &lt;code&gt;Callable&amp;lt;T&amp;gt;&lt;/code&gt; ä»»åŠ¡å°±æ˜¯æä¾› &lt;code&gt;Future&lt;/code&gt; å¯¹è±¡æ¥è·å–å¼‚æ­¥ç»“æœã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é‚£ä¹ˆè¿™ä¸¤ç§æŠ€æœ¯æ–¹æ¡ˆå°±è¶³å¤Ÿå¥½äº†å—ï¼Ÿåœ¨å¾ˆå¤šä½¿ç”¨åœºæ™¯ä¸‹å¹¶ä¸ç†æƒ³ï¼Œè¿™ä¸¤ç§æ–¹å¼éƒ½æœ‰å±€é™ã€‚&lt;/p&gt;
&lt;p&gt;å¤šä¸ªå›è°ƒéš¾ä»¥ç»„åˆä½¿ç”¨ï¼Œå®¹æ˜“å¯¼è‡´ä»£ç éš¾ä»¥é˜…è¯»å’Œç»´æŠ¤ï¼ˆå°±æ˜¯æ‰€è°“çš„â€œå›è°ƒåœ°ç‹±â€ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼šåœ¨ç•Œé¢ä¸Šä¸ºç”¨æˆ·æ˜¾ç¤ºä»–æœ€å–œçˆ±çš„5ä¸ªç‰©ä»¶ï¼Œå¦‚æœç”¨æˆ·è¿˜æ²¡æœ‰ä»»ä½•å–œæ¬¢çš„ç‰©ä»¶ï¼Œåˆ™ç»™å‡ºå»ºè®®ç‰©ä»¶ã€‚è¿™ä¸ªé€»è¾‘æ¶‰åŠ3ä¸ªæœåŠ¡ï¼ˆç¬¬ä¸€ä¸ªæœåŠ¡æä¾›ç‰©ä»¶ IDï¼Œç¬¬äºŒä¸ªæœåŠ¡è·å–ç‰©ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œç¬¬ä¸‰ä¸ªæœåŠ¡æä¾›å»ºè®®ç‰©ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;em&gt;å›è°ƒåœ°åŸŸçš„ç¤ºä¾‹&lt;/em&gt;&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;userService.getFavorites(userId, &lt;span style="color: #0000ff"&gt;new&lt;/span&gt; Callback&amp;lt;List&amp;lt;String&amp;gt;&amp;gt;() { &lt;span style="color: #008000"&gt;// 1&lt;/span&gt;
    &lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #2b91af"&gt;void&lt;/span&gt; onSuccess(List&amp;lt;String&amp;gt; list) { &lt;span style="color: #008000"&gt;// 2&lt;/span&gt;
        &lt;span style="color: #0000ff"&gt;if&lt;/span&gt; (list.isEmpty()) { &lt;span style="color: #008000"&gt;// 3&lt;/span&gt;
            suggestionService.getSuggestions(&lt;span style="color: #0000ff"&gt;new&lt;/span&gt; Callback&amp;lt;List&amp;lt;Favorite&amp;gt;&amp;gt;() {
                &lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #2b91af"&gt;void&lt;/span&gt; onSuccess(List&amp;lt;Favorite&amp;gt; list) { &lt;span style="color: #008000"&gt;// 4&lt;/span&gt;
                    UiUtils.submitOnUiThread(() -&amp;gt; { &lt;span style="color: #008000"&gt;// 5&lt;/span&gt;
                        list.stream()
                            .limit(5)
                            .forEach(uiList::show); &lt;span style="color: #008000"&gt;// 6&lt;/span&gt;
                    })
                }

                &lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #2b91af"&gt;void&lt;/span&gt; onError(Throwable error) { &lt;span style="color: #008000"&gt;// 7&lt;/span&gt;
                    UiUtils.errorPopup(error);
                }
            });
        } &lt;span style="color: #0000ff"&gt;else&lt;/span&gt; {
            list.stream() &lt;span style="color: #008000"&gt;// 8&lt;/span&gt;
                .limit(5)
                .forEach(favId -&amp;gt; favoriteService.getDetails(favId, &lt;span style="color: #008000"&gt;// 9&lt;/span&gt;
                    &lt;span style="color: #0000ff"&gt;new&lt;/span&gt; Callback&amp;lt;Favorite&amp;gt;() {
                        &lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #2b91af"&gt;void&lt;/span&gt; onSuccess(Favorite details) {
                            UiUtils.submitOnUiThread(() -&amp;gt; uiList.show(details));
                        }

                        &lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #2b91af"&gt;void&lt;/span&gt; onError(Throwable error) {
                            UiUtils.errorPopup(error);
                        }
                    }
                ));
        }
    }

    &lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #2b91af"&gt;void&lt;/span&gt; onError(Throwable error) {
        UiUtils.errorPopup(error);
    }
})
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ol&gt;
&lt;li&gt;åŸºäºå›è°ƒçš„æœåŠ¡ï¼š&lt;code&gt;Callback&lt;/code&gt; æ¥å£å®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œå¼‚æ­¥å¤„ç†æˆåŠŸæ—¶è°ƒç”¨å…¶ä¸­çš„ &lt;code&gt;onSuccess&lt;/code&gt;ï¼Œå¼‚æ­¥å¤„ç†å‘ç”Ÿé”™è¯¯æ—¶è°ƒç”¨ &lt;code&gt;onError&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸€ä¸ªæœåŠ¡ä»¥å…¶ç»“æœ - å–œçˆ±ç‰©ä»¶çš„ ID åˆ—è¡¨ - è°ƒç”¨å›è°ƒæ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœåˆ—è¡¨ä¸ºç©ºï¼Œåˆ™å¿…é¡»è½¬åˆ° &lt;code&gt;suggestionService&lt;/code&gt; æ¥å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;suggestionService&lt;/code&gt; å‘ç¬¬äºŒä¸ªå›è°ƒä¼ é€’ä¸€ä¸ª &lt;code&gt;List&amp;lt;Favorite&amp;gt;&lt;/code&gt; åˆ—è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äº UI æ¸²æŸ“ï¼Œå¿…é¡»è®©æ¶ˆè´¹æ•°æ®çš„ä»£ç è¿è¡Œåœ¨ UI çš„çº¿ç¨‹ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† Java 8 çš„ &lt;code&gt;Stream&lt;/code&gt; å°†å»ºè®®ç‰©ä»¶çš„æ•°é‡é™åˆ¶ä¸º5ä¸ªï¼Œç„¶ååœ¨ UI ä¸­æ¸²æŸ“æˆä¸€ä¸ªå›¾å½¢åŒ–åˆ—è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨æ¯ä¸ªå›è°ƒå±‚çº§ï¼Œæˆ‘ä»¬éƒ½ä»¥ç›¸åŒçš„æ–¹å¼å¤„ç†é”™è¯¯ï¼šåœ¨å¼¹å‡ºæ¡†ä¸­æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;å›åˆ° å–œçˆ±ç‰©ä»¶ ID åˆ—è¡¨çš„å±‚çº§ã€‚å¦‚æœ &lt;code&gt;userService&lt;/code&gt; æœåŠ¡è¿”å›ä¸€ä¸ªä¸ä¸ºç©ºçš„ ID åˆ—è¡¨ï¼Œåˆ™è½¬åˆ° &lt;code&gt;favoriteService&lt;/code&gt; å»è·å–å¸¦è¯¦ç»†ä¿¡æ¯çš„ &lt;code&gt;Favorite&lt;/code&gt; å¯¹è±¡ã€‚å› ä¸ºåªéœ€è¦5ä¸ªå–œçˆ±ç‰©ä»¶ï¼Œæ‰€ä»¥å…ˆä½¿ç”¨æµå¼å¤„ç†å°† ID æ•°é‡é™åˆ¶ä¸º 5 ä¸ªã€‚&lt;/li&gt;
&lt;li&gt;å†ä¸€æ¬¡ï¼Œä½¿ç”¨ä¸€ä¸ªå›è°ƒã€‚è¿™ä¸€æ¬¡æˆ‘ä»¬è·å–åˆ°å®Œæ•´çš„ &lt;code&gt;Favorite&lt;/code&gt; å¯¹è±¡ï¼Œå¹¶åœ¨ UI çº¿ç¨‹ä¸­å°†å…¶åœ¨ UI ä¸Šæ¸²æŸ“å‡ºæ¥ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;çœ‹çœ‹æœ‰å¤šå°‘ä»£ç ï¼Œç†è§£èµ·æ¥ä¹Ÿæœ‰ç‚¹å›°éš¾ï¼Œå…¶ä¸­ä¹Ÿæœ‰ä¸€äº›é‡å¤çš„ä»£ç ç‰‡æ®µã€‚å†æ¥çœ‹çœ‹ä½¿ç”¨ Reactor å¦‚ä½•æ¥å®ç°è¿™æ®µé€»è¾‘ï¼š&lt;/p&gt;
&lt;p&gt;&lt;em&gt;å’Œå›è°ƒå®ç°æ–¹å¼ç­‰ä»·çš„ Reactor å®ç°&lt;/em&gt;&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;userService.getFavorite(userId) &lt;span style="color: #008000"&gt;// 1&lt;/span&gt;
            .flatMap(favoriteService::getDetails) &lt;span style="color: #008000"&gt;// 2&lt;/span&gt;
            .switchIfEmpty(suggestionService.getSuggestions()) &lt;span style="color: #008000"&gt;// 3&lt;/span&gt;
            .take(5) &lt;span style="color: #008000"&gt;// 4&lt;/span&gt;
            .publishOn(UiUtils.uiThreadScheduler()) &lt;span style="color: #008000"&gt;// 5&lt;/span&gt;
            .subscribe(uiList::show, UiUtils::errorPopup); &lt;span style="color: #008000"&gt;// 6&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ol&gt;
&lt;li&gt;å¼€å¯ä¸€ä¸ªå–œçˆ±ç‰©ä»¶ ID çš„æµã€‚&lt;/li&gt;
&lt;li&gt;&lt;em&gt;å¼‚æ­¥åœ°&lt;/em&gt;å°† ID è½¬æ¢æˆå¸¦è¯¦ç»†ä¿¡æ¯çš„ &lt;code&gt;Favorite&lt;/code&gt; å¯¹è±¡ï¼ˆ&lt;code&gt;flatMap&lt;/code&gt;ï¼‰ã€‚è‡³æ­¤æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ª &lt;code&gt;Favorite&lt;/code&gt; å¯¹è±¡æµã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœ &lt;code&gt;Favorite&lt;/code&gt; æµä¸ºç©ºï¼Œåˆ™åˆ‡æ¢åˆ°å¤‡é€‰å¤„ç†æ–¹å¼ &lt;code&gt;suggestionService&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æˆ‘ä»¬åªå…³æ³¨äº§å‡ºæµä¸­çš„å‰ï¼ˆæœ€å¤šï¼‰5ä¸ªå…ƒç´ ã€‚&lt;/li&gt;
&lt;li&gt;æœ€åï¼Œåœ¨ UI çº¿ç¨‹ä¸­å¤„ç†æ¯ä»½æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;çœŸæ­£è§¦å‘æµçš„å¤„ç†ï¼šæè¿°äº†å¦‚ä½•å¤„ç†æœ€ç»ˆçš„æ•°æ®ï¼ˆæ˜¾ç¤ºä¸ºä¸€ä¸ª UI åˆ—è¡¨ï¼‰ï¼Œä»¥åŠåœ¨å‘ç”Ÿé”™è¯¯æ—¶å¦‚ä½•å¤„ç†ï¼ˆæ˜¾ç¤ºä¸€ä¸ªå¼¹å‡ºæ¡†ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¦‚æœå¸Œæœ›ç¡®ä¿åœ¨ 800ms ä»¥å†…è·å–åˆ°å–œçˆ±ç‰©ä»¶ ID åˆ—è¡¨ï¼Œå¦‚æœè¶…æ—¶ï¼Œåˆ™ä»ç¼“å­˜ä¸­è·å–æ•°æ®ï¼Œå¦‚ä½•å®ç°ï¼ŸåŸºäºå›è°ƒçš„ä»£ç å®ç°ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„ä»»åŠ¡ã€‚ä½¿ç”¨ Reactorï¼Œåªéœ€åœ¨æ“ä½œé“¾ä¸­æ·»åŠ ä¸€ä¸ª &lt;code&gt;timeout&lt;/code&gt; ç®—å­å°±èƒ½è½»æ¾æå®šï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;em&gt;è¶…æ—¶å›é€€å¤„ç†çš„ Reactor ä»£ç ç¤ºä¾‹&lt;/em&gt;&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;userService.getFavorites(userId)
            .timeout(Duration.ofMillis(800)) &lt;span style="color: #008000"&gt;// 1&lt;/span&gt;
            .onErrorResume(cacheService.cachedFavoritesFor(userId)) &lt;span style="color: #008000"&gt;// 2&lt;/span&gt;
            .flatMap(favoriteService::getDetails)
            .switchIfEmpty(suggestionService.getSuggestions())
            .take(5)
            .publishOn(UiUtils.uiThreadScheduler())
            .subscribe(uiList::show, UiUtils::errorPopup);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ol&gt;
&lt;li&gt;å¦‚æœå‰ç½®å¤„ç†è¶…è¿‡ 800ms è¿˜æ²¡è¾“å‡ºä»»ä½•äº‹ä»¶ï¼Œåˆ™ä¸‹å‘ä¸€ä¸ªé”™è¯¯ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨æ”¶åˆ°é”™è¯¯äº‹ä»¶æ—¶ï¼Œå›é€€åˆ°è°ƒç”¨ &lt;code&gt;cacheService&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ“ä½œé“¾çš„ä½™ä¸‹éƒ¨åˆ†å’Œå‰ä¸€ä¸ªä¾‹å­ç±»ä¼¼ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;Future&lt;/code&gt; å¯¹è±¡ç›¸æ¯”å›è°ƒæ›´å¥½ä¸€ç‚¹ï¼Œä¸è¿‡ç»„åˆä½¿ç”¨èµ·æ¥ä¹Ÿä¸å¤ªæ–¹ä¾¿ï¼Œå°½ç®¡ Java 8 å¼•å…¥ &lt;code&gt;CompletableFuture&lt;/code&gt; æ”¹å–„äº†è¿™ä¸€é—®é¢˜ã€‚å°†å¤šä¸ª &lt;code&gt;Future&lt;/code&gt; å¯¹è±¡ç»„ç»‡åœ¨ä¸€èµ·ï¼Œå¯è¡Œä½†å¹¶ä¸å®¹æ˜“ã€‚å¦å¤–ï¼Œ&lt;code&gt;Future&lt;/code&gt; è¿˜æœ‰å…¶å®ƒé—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®¹æ˜“ç¢°åˆ°å¦ä¸€ä¸ªé˜»å¡çš„æƒ…å†µï¼šè°ƒç”¨ &lt;code&gt;Future&lt;/code&gt; å¯¹è±¡çš„ &lt;code&gt;get()&lt;/code&gt; æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;ä¸æ”¯æŒæƒ°æ€§è®¡ç®—ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹å¤šä¸ªå€¼çš„å¤„ç†å’Œé«˜çº§é”™è¯¯å¤„ç†ç¼ºä¹æ”¯æŒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¥çœ‹çœ‹å¦ä¸€ä¸ªä¾‹å­ï¼šå…ˆè·å–ä¸€ä¸ª ID åˆ—è¡¨ï¼Œç„¶åæ ¹æ® ID è·å–ä¸€ä¸ªåå­—ä»¥åŠè·å–ä¸€ä¸ªç»Ÿè®¡æ•°å€¼ï¼Œå†å°†åå­—å’Œç»Ÿè®¡æ•°å€¼ç»„åˆèµ·æ¥ä½¿ç”¨ï¼Œè¿™å‡ ä¸ªæ­¥éª¤éƒ½å¿…é¡»æ˜¯å¼‚æ­¥çš„ã€‚å¦‚ä¸‹ç¤ºä¾‹ä»¥ä¸€ç»„ &lt;code&gt;CompletableFuture&lt;/code&gt; æ¥å®ç°è¿™ä¸ªé€»è¾‘ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;CompletableFuture&amp;lt;List&amp;lt;String&amp;gt;&amp;gt; ids = ifhIds(); &lt;span style="color: #008000"&gt;// 1&lt;/span&gt;

CompletableFuture&amp;lt;List&amp;lt;String&amp;gt;&amp;gt; results = ids.thenComposeAsync(l -&amp;gt; { &lt;span style="color: #008000"&gt;// 2&lt;/span&gt;
    Stream&amp;lt;CompletableFuture&amp;lt;String&amp;gt;&amp;gt; zip = 
            l.stream().map(i -&amp;gt; { &lt;span style="color: #008000"&gt;// 3&lt;/span&gt;
                CompletableFuture&amp;lt;String&amp;gt; nameTask = ifhName(i); &lt;span style="color: #008000"&gt;// 4&lt;/span&gt;
                CompletableFuture&amp;lt;Integer&amp;gt; statTask = ifhStat(i); &lt;span style="color: #008000"&gt;// 5&lt;/span&gt;
                &lt;span style="color: #0000ff"&gt;return&lt;/span&gt; nameTask.thenCombineAsync(statTask, (name, stat) -&amp;gt; &lt;span style="color: #a31515"&gt;&amp;quot;Name &amp;quot;&lt;/span&gt; + name + &lt;span style="color: #a31515"&gt;&amp;quot; has stats &amp;quot;&lt;/span&gt; + stat); &lt;span style="color: #008000"&gt;// 6&lt;/span&gt;
            });
    List&amp;lt;CompletableFuture&amp;lt;String&amp;gt;&amp;gt; combinationList = zip.collect(Collectors.toList()); &lt;span style="color: #008000"&gt;// 7&lt;/span&gt;
    CompletableFuture&amp;lt;String&amp;gt;[] combinationArray = combinationList.toArray(&lt;span style="color: #0000ff"&gt;new&lt;/span&gt; CompletableFuture[combinationList.size()]);

    CompletableFuture&amp;lt;Void&amp;gt; allDone = CompletableFuture.allOf(combinationArray); &lt;span style="color: #008000"&gt;// 8&lt;/span&gt;
    &lt;span style="color: #0000ff"&gt;return&lt;/span&gt; allDone.thenApply(v -&amp;gt; combinationList.stream()
                    .map(CompletableFuture::join) &lt;span style="color: #008000"&gt;// 9&lt;/span&gt;
                    .collect(Collectors.toList()));
});

List&amp;lt;String&amp;gt; results = result.join(); &lt;span style="color: #008000"&gt;// 10&lt;/span&gt;
assertThat(results).contains(
        &lt;span style="color: #a31515"&gt;&amp;quot;Name NameJoe has stats 103&amp;quot;&lt;/span&gt;,
        &lt;span style="color: #a31515"&gt;&amp;quot;Name NameBart has stats 104&amp;quot;&lt;/span&gt;,
        &lt;span style="color: #a31515"&gt;&amp;quot;Name NameHenry has stats 105&amp;quot;&lt;/span&gt;,
        &lt;span style="color: #a31515"&gt;&amp;quot;Name NameNicole has stats 106&amp;quot;&lt;/span&gt;,
        &lt;span style="color: #a31515"&gt;&amp;quot;Name NameABSLAJNFOAJNFOANFANSF has stats 121&amp;quot;&lt;/span&gt;);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ol&gt;
&lt;li&gt;ä¸€å¼€å§‹è·å¾—ä¸€ä¸ª &lt;code&gt;Future&lt;/code&gt; ç»“æœ - ä¸ºåç»­å¤„ç†æä¾›ä¸€ä¸ª &lt;code&gt;id&lt;/code&gt; åˆ—è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;ä¸€æ—¦è·å¾— &lt;code&gt;id&lt;/code&gt; åˆ—è¡¨å°±å¯ä»¥å¼€å§‹è¿›ä¸€æ­¥çš„å¼‚æ­¥å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;é€ä¸ªå¤„ç†åˆ—è¡¨ä¸­çš„å…ƒç´ ã€‚&lt;/li&gt;
&lt;li&gt;å¼‚æ­¥è·å–å…³è”çš„åå­—ã€‚&lt;/li&gt;
&lt;li&gt;å¼‚æ­¥è·å–å…³è”çš„ç»Ÿè®¡æ•°å€¼ã€‚&lt;/li&gt;
&lt;li&gt;ç»„åˆä¸¤ä¸ªå¼‚æ­¥ç»“æœã€‚&lt;/li&gt;
&lt;li&gt;è‡³æ­¤æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ª &lt;code&gt;Future&lt;/code&gt; å¯¹è±¡åˆ—è¡¨ï¼Œè¡¨ç¤ºæ‰€æœ‰çš„ç»„åˆä»»åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;å°† &lt;code&gt;Future&lt;/code&gt; å¯¹è±¡æ•°ç»„ä¼ ç»™ &lt;code&gt;CompletableFuture.allOf&lt;/code&gt; æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¾“å‡ºä¸€ä¸ª &lt;code&gt;Future&lt;/code&gt; å¯¹è±¡ï¼Œå½“ &lt;code&gt;Future&lt;/code&gt; å¯¹è±¡æ•°ç»„ä»£è¡¨çš„å¼‚æ­¥ä»»åŠ¡éƒ½å®Œæˆæ—¶ï¼Œè¿™ä¸ª &lt;code&gt;Future&lt;/code&gt; å¯¹è±¡ä»£è¡¨çš„å¼‚æ­¥ä»»åŠ¡ä¹Ÿå°±å®Œæˆäº†ã€‚&lt;/li&gt;
&lt;li&gt;æ­¤å¤„çš„ç‰¹æ®Šä¹‹å¤„åœ¨äºï¼šåœ¨ï¼ˆ&lt;code&gt;allOf&lt;/code&gt; è¿”å›çš„ï¼‰&lt;code&gt;CompletableFuture&amp;lt;Void&amp;gt;&lt;/code&gt; å¯¹è±¡è¡¨ç¤ºçš„å¼‚æ­¥ä»»åŠ¡ç»“æŸæ—¶ï¼Œéå† &lt;code&gt;Future&lt;/code&gt; å¯¹è±¡åˆ—è¡¨ï¼ˆcombinationListï¼‰ï¼Œä½¿ç”¨ &lt;code&gt;join()&lt;/code&gt; æ–¹æ³•ï¼ˆæ­¤æ¬¡ä¸ä¼šé˜»å¡ï¼Œå› ä¸º &lt;code&gt;allOf&lt;/code&gt; ä¼šç¡®ä¿æ‰€æœ‰å¼‚æ­¥ä»»åŠ¡éƒ½å·²å®Œæˆï¼‰è·å–æ”¶é›†å¼‚æ­¥ä»»åŠ¡ç»“æœã€‚&lt;/li&gt;
&lt;li&gt;è§¦å‘æ‰§è¡Œæ•´ä¸ªå¼‚æ­¥å¤„ç†æµæ°´çº¿ï¼ˆè°ƒç”¨ &lt;code&gt;join()&lt;/code&gt; æ–¹æ³•ï¼‰ï¼Œç„¶è€Œç­‰ç€å¼‚æ­¥å¤„ç†å®Œæˆå¹¶è¿”å›ä¸€ä¸ªç»“æœåˆ—è¡¨ï¼Œå°±å¯ä»¥è¿›è¡Œæ–­è¨€åˆ¤æ–­äº†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Reactor è‡ªå¸¦äº†å¾ˆå¤šç»„åˆç®—å­ï¼Œå¯ä»¥ç®€åŒ–è¿™ä¸ªå¤„ç†è¿‡ç¨‹çš„å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Flux&amp;lt;String&amp;gt; ids = ifhrIds(); &lt;span style="color: #008000"&gt;// 1&lt;/span&gt;

Flux&amp;lt;String&amp;gt; combinations = 
        ids.flatMap(id -&amp;gt; { &lt;span style="color: #008000"&gt;// 2&lt;/span&gt;
            Mono&amp;lt;String&amp;gt; nameTask = ifhrName(id); &lt;span style="color: #008000"&gt;// 3&lt;/span&gt;
            Mono&amp;lt;Integer&amp;gt; statTask = ifhrStat(id); &lt;span style="color: #008000"&gt;// 4&lt;/span&gt;

            &lt;span style="color: #0000ff"&gt;return&lt;/span&gt; nameTask.zipWith(statTask, &lt;span style="color: #008000"&gt;// 5&lt;/span&gt;
                    (name, stat) -&amp;gt; &lt;span style="color: #a31515"&gt;&amp;quot;Name &amp;quot;&lt;/span&gt; + name + &lt;span style="color: #a31515"&gt;&amp;quot; has stats &amp;quot;&lt;/span&gt; + stat);
        });

Mono&amp;lt;List&amp;lt;String&amp;gt;&amp;gt; result = combinations.collectList(); &lt;span style="color: #008000"&gt;// 6&lt;/span&gt;

List&amp;lt;String&amp;gt; results = result.block(); &lt;span style="color: #008000"&gt;// 7&lt;/span&gt;
assertThat(results).containsExactly( &lt;span style="color: #008000"&gt;// 8&lt;/span&gt;
    &lt;span style="color: #a31515"&gt;&amp;quot;Name NameJoe has stats 103&amp;quot;&lt;/span&gt;,
    &lt;span style="color: #a31515"&gt;&amp;quot;Name NameBart has stats 104&amp;quot;&lt;/span&gt;,
    &lt;span style="color: #a31515"&gt;&amp;quot;Name NameHenry has stats 105&amp;quot;&lt;/span&gt;,
    &lt;span style="color: #a31515"&gt;&amp;quot;Name NameNicole has stats 106&amp;quot;&lt;/span&gt;,
    &lt;span style="color: #a31515"&gt;&amp;quot;Name NameABSLAJNFOAJNFOANFANSF has stats 121&amp;quot;&lt;/span&gt;
);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ol&gt;
&lt;li&gt;è¿™æ¬¡ï¼Œä¸€å¼€å§‹æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªå¼‚æ­¥æä¾›çš„å­—ç¬¦ä¸²åºåˆ—ï¼ˆ&lt;code&gt;ids&lt;/code&gt;ï¼‰ï¼ˆä¸€ä¸ª &lt;code&gt;Flux&amp;lt;String&amp;gt;&lt;/code&gt; å¯¹è±¡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºåºåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå¼‚æ­¥å¤„ç†ä¸¤æ¬¡ï¼ˆåœ¨ &lt;code&gt;flatMap&lt;/code&gt; çš„ lambda å‚æ•°å€¼ä¸­ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;è·å–å…³è”çš„åå­—ã€‚&lt;/li&gt;
&lt;li&gt;è·å–å…³è”çš„ç»Ÿè®¡å€¼ã€‚&lt;/li&gt;
&lt;li&gt;å¼‚æ­¥ç»„åˆä¸¤ä¸ªå€¼&lt;/li&gt;
&lt;li&gt;åœ¨å¼‚æ­¥å¤„ç†çš„ç»“æœå¯ç”¨æ—¶ï¼Œå°†å®ƒä»¬èšåˆåˆ°ä¸€ä¸ª &lt;code&gt;List&lt;/code&gt; å¯¹è±¡ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šç»§ç»­å¼‚æ­¥å¤„ç† &lt;code&gt;Flux&lt;/code&gt;ï¼Œæ¯”å¦‚ï¼šå¼‚æ­¥ç»„åˆä½¿ç”¨å®ƒæˆ–è€…ç›´æ¥è®¢é˜…å®ƒã€‚æœ€å¯èƒ½çš„æ˜¯ï¼Œè¿”å›è¿™ä¸ª &lt;code&gt;Mono&lt;/code&gt; ç±»å‹çš„ &lt;code&gt;result&lt;/code&gt;ã€‚å› ä¸ºè¿™é‡Œåªæ˜¯ä¸ªæµ‹è¯•ï¼Œæ‰€ä»¥ä½¿ç”¨äº† blockï¼Œç­‰å¾…å¤„ç†ç»“æŸï¼Œç›´æ¥è¿”å›å€¼çš„èšåˆåˆ—è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹ç»“æœè¿›è¡Œæ–­è¨€åˆ¤æ–­ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä½¿ç”¨å›è°ƒå’Œ &lt;code&gt;Future&lt;/code&gt; å¯¹è±¡çš„é—®é¢˜æ˜¯ç±»ä¼¼çš„ï¼Œååº”å¼ç¼–ç¨‹ä»¥ &lt;code&gt;å‘å¸ƒè€…ï¼ˆPublisherï¼‰- è®¢é˜…è€…ï¼ˆSubscriberï¼‰&lt;/code&gt; è§£å†³äº†è¿™äº›é—®é¢˜ã€‚ &lt;/p&gt;
&lt;h4&gt;2.3 ä»å‘½ä»¤å¼åˆ°ååº”å¼ç¼–ç¨‹&lt;/h4&gt;
&lt;p&gt;ååº”å¼ç¼–ç¨‹åº“ï¼Œæ¯”å¦‚ Reactorï¼Œç›®æ ‡æ˜¯è§£å†³ JVM ä¸Šâ€œç»å…¸â€å¼‚æ­¥å¤„ç†æ–¹å¼çš„å¼Šç«¯ï¼ŒåŒæ—¶ä¹Ÿä¸“æ³¨äºæä¾›ä»¥ä¸‹å‡ ä¸ªæ–¹é¢çš„ç‰¹æ€§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¯ç»„åˆæ€§&lt;/strong&gt; å’Œ &lt;strong&gt;ä»£ç å¯è¯»æ€§&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;å°†æ•°æ®è§†ä½œä¸€ä¸ª&lt;strong&gt;æµ&lt;/strong&gt;ï¼Œå¹¶æä¾›ä¸°å¯Œçš„&lt;strong&gt;ç®—å­&lt;/strong&gt;æ¥æ“ä½œæµ&lt;/li&gt;
&lt;li&gt;åœ¨&lt;strong&gt;è®¢é˜…ï¼ˆsubscriberï¼‰&lt;/strong&gt;ä¹‹å‰ä¸ä¼šå®é™…åšä»»ä½•äº‹æƒ…&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åå‹&lt;/strong&gt; æˆ–è€…è¯´ æ¶ˆè´¹è€…é€šçŸ¥ç”Ÿäº§è€…æµé€Ÿè¿‡é«˜çš„èƒ½åŠ›&lt;/li&gt;
&lt;li&gt;ä¸å¹¶å‘æ— å…³ï¼ˆconcurrency-agnosticï¼‰çš„&lt;strong&gt;é«˜é˜¶ï¼ˆhigh levelï¼‰&lt;/strong&gt;æŠ½è±¡ï¼Œ&lt;strong&gt;é€‚ç”¨æ€§å¼ºï¼ˆhigh valueï¼‰&lt;/strong&gt;ï¼ˆè¯‘æ³¨ï¼šå¹¶å‘æ— å…³æ˜¯æŒ‡è¿™ç§æŠ½è±¡å¯¹äºå¹¶å‘éå¹¶å‘çš„åœºæ™¯éƒ½é€‚ç”¨ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;3. Reactor æ ¸å¿ƒç‰¹æ€§&lt;/h3&gt;
&lt;p&gt;Reactor é¡¹ç›®çš„ä¸»è¦æˆæœæ˜¯ &lt;code&gt;reactor-core&lt;/code&gt; - ä¸€ä¸ªéµå¾ª&lt;a href="https://www.reactive-streams.org/"&gt;ååº”å¼æµ&lt;/a&gt;è§„èŒƒå¹¶æ”¯æŒ Java 8 çš„ååº”å¼ç¼–ç¨‹åº“ã€‚&lt;/p&gt;
&lt;p&gt;Reactor å¼•å…¥ 2 ä¸ªå¯ç»„åˆçš„ååº”å¼ç±»å‹ï¼ˆå®ç°äº† &lt;code&gt;Publisher&lt;/code&gt; æ¥å£å¹¶ä¸”æä¾›ä¸°å¯Œçš„ç®—å­ï¼‰ï¼š &lt;code&gt;Flux&lt;/code&gt; å’Œ &lt;code&gt;Mono&lt;/code&gt;ã€‚ä¸€ä¸ª &lt;code&gt;Flux&lt;/code&gt; å¯¹è±¡ä»£è¡¨åŒ…å« 0 åˆ° N ä¸ªå…ƒç´ çš„ååº”å¼åºåˆ—ï¼Œ&lt;code&gt;Mono&lt;/code&gt; å¯¹è±¡ä»£è¡¨å•å€¼æˆ–ç©ºï¼ˆ0æˆ–1ä¸ªå…ƒç´ ï¼‰çš„ç»“æœã€‚&lt;/p&gt;
&lt;h4&gt;3.1 Flux - 0-N ä¸ªå€¼çš„å¼‚æ­¥åºåˆ—&lt;/h4&gt;
&lt;p&gt;&lt;img alt="" src="https://i.loli.net/2020/06/14/oKMX4rTvUViZRHj.jpg"&gt;&lt;/p&gt;
&lt;h4&gt;3.2 Mono - åŒ…å« 0 æˆ– 1 ä¸ªå€¼çš„å¼‚æ­¥ç»“æœ&lt;/h4&gt;
&lt;p&gt;&lt;img alt="" src="https://i.loli.net/2020/06/14/8WxGgH9UkcQwuX4.jpg"&gt;&lt;/p&gt;
&lt;h4&gt;3.3 åˆ›å»ºä¸€ä¸ª Flux æˆ– Mono å¹¶è¿›è¡Œè®¢é˜…çš„ä¸€äº›ç®€å•æ–¹æ³•&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;Flux&lt;/code&gt; å’Œ &lt;code&gt;Mono&lt;/code&gt; çš„ç±»ä¸­åŒ…å«å¤§é‡çš„å·¥å‚æ–¹æ³•ï¼Œä¸Šæ‰‹ä½¿ç”¨ Reactor æœ€ç®€å•çš„æ–¹å¼æ˜¯ä»ä¸­é€‰æ‹©ä¸€ä¸ªç”¨èµ·æ¥ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ª &lt;code&gt;String&lt;/code&gt; åºåˆ—ï¼Œå¯ä»¥é€ä¸ªåˆ—ä¸¾å‡ºè¿™äº›å­—ç¬¦ä¸²ï¼Œæˆ–è€…å°†è¿™äº›å­—ç¬¦ä¸²æ”¾åˆ°ä¸€ä¸ªé›†åˆä¸­ï¼Œç„¶ååŸºäºè¿™ä¸ªé›†åˆåˆ›å»ºä¸€ä¸ª Fluxï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Flux&amp;lt;&lt;span style="border: 1px solid #FF0000"&gt;&lt;/span&gt;String&amp;gt; seq1 = Flux.just(&lt;span style="color: #a31515"&gt;&amp;quot;foo&amp;quot;&lt;/span&gt;, &lt;span style="color: #a31515"&gt;&amp;quot;bar&amp;quot;&lt;/span&gt;, &lt;span style="color: #a31515"&gt;&amp;quot;foobar&amp;quot;&lt;/span&gt;);

List&amp;lt;String&amp;gt; iterable = Arrays.asList(&lt;span style="color: #a31515"&gt;&amp;quot;foo&amp;quot;&lt;/span&gt;, &lt;span style="color: #a31515"&gt;&amp;quot;bar&amp;quot;&lt;/span&gt;, &lt;span style="color: #a31515"&gt;&amp;quot;foobar&amp;quot;&lt;/span&gt;);
Flux&amp;lt;String&amp;gt; seq2 = Flux.fromIterable(iterable);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å…¶å®ƒä¸€äº›å·¥å‚æ–¹æ³•çš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Mono&amp;lt;String&amp;gt; noData = Mono.empty();
Mono&amp;lt;String&amp;gt; data = Mono.just(&lt;span style="color: #a31515"&gt;&amp;quot;foo&amp;quot;&lt;/span&gt;);
Flux&amp;lt;Integer&amp;gt; numbersFromFiveToSeven = Flux.range(5, 3);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¯¹äºè®¢é˜…æ“ä½œï¼Œ&lt;code&gt;Flux&lt;/code&gt; å’Œ &lt;code&gt;Mono&lt;/code&gt; å€ŸåŠ©äº† Java 8 çš„ lambda è¡¨è¾¾å¼ã€‚æœ‰å¤§é‡ &lt;code&gt;.subscribe()&lt;/code&gt; çš„é‡è½½æ–¹æ³•/å˜ç§æ–¹æ³•ï¼ˆvariantsï¼‰å¯é€‰é€‰æ‹©ä½¿ç”¨ï¼Œä½¿ç”¨ lambda è¡¨è¾¾å¼æ¥å®ç°å›è°ƒçš„ä¸åŒç»„åˆï¼Œå¦‚ä¸‹æ‰€ç¤ºæ˜¯è¿™äº›æ–¹æ³•çš„ç­¾åï¼š&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Flux ä¸­åŸºäº lambda è¡¨è¾¾å¼çš„è®¢é˜…æ–¹æ³•å˜ç§&lt;/em&gt;&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;subscribe();

subscribe(Consumer&amp;lt;? &lt;span style="color: #0000ff"&gt;super&lt;/span&gt; T&amp;gt; consumer);

subscribe(Consumer&amp;lt;? &lt;span style="color: #0000ff"&gt;super&lt;/span&gt; T&amp;gt; consumer,
          Consumer&amp;lt;? &lt;span style="color: #0000ff"&gt;super&lt;/span&gt; Throwable&amp;gt; errorConsumer);

subscribe(Consumer&amp;lt;? &lt;span style="color: #0000ff"&gt;super&lt;/span&gt; T&amp;gt; consumer,
          Consumer&amp;lt;? &lt;span style="color: #0000ff"&gt;super&lt;/span&gt; Throwable&amp;gt; errorConsumer,
          Runnable completeConsumer);

subscribe(Consumer&amp;lt;? &lt;span style="color: #0000ff"&gt;super&lt;/span&gt; T&amp;gt; consumer,
          Consumer&amp;lt;? &lt;span style="color: #0000ff"&gt;super&lt;/span&gt; Throwable&amp;gt; errorConsumer,
          Runnable completeConsumer,
          Consumer&amp;lt;? &lt;span style="color: #0000ff"&gt;super&lt;/span&gt; Subscription&amp;gt; subscriptionConsumer);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;blockquote&gt;
&lt;p&gt;è¿™äº›è®¢é˜…æ–¹æ³•éƒ½ä¼šè¿”å›ä¸€ä¸ªè®¢é˜…æ“ä½œçš„å¼•ç”¨ï¼Œå½“ä¸å†éœ€è¦æ›´å¤šçš„æ•°æ®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå¼•ç”¨æ¥å–æ¶ˆè®¢é˜…ã€‚ä¸€æ—¦å–æ¶ˆï¼Œæ•°æ®æºå°±åº”è¯¥åœæ­¢äº§å‡ºæ•°æ®ï¼Œå¹¶æ¸…ç†ä½¿ç”¨çš„æ‰€æœ‰èµ„æºã€‚è¿™ä¸€ â€œå–æ¶ˆå¹¶æ¸…ç†â€ è¡Œä¸ºåœ¨ Reactor ä¸­ä»¥é€šç”¨çš„ &lt;code&gt;Disposable&lt;/code&gt; æ¥å£æ¥è¡¨ç°ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h5&gt;3.3.1 lambda è¡¨è¾¾å¼çš„æ›¿ä»£æ–¹æ¡ˆï¼šBaseSubscriber&lt;/h5&gt;
&lt;p&gt;&lt;code&gt;Flux&lt;/code&gt; å’Œ &lt;code&gt;Mono&lt;/code&gt; æä¾›äº†ä¸€ä¸ªç›¸æ¯”ä¸Šé¢é‚£ä¹ˆè®¢é˜…æ–¹æ³•æ›´é€šç”¨çš„ &lt;code&gt;subscribe&lt;/code&gt; æ–¹æ³•ï¼Œå…¶å‚æ•°æ˜¯ä¸€ä¸ªå®Œæ•´çš„ &lt;code&gt;Subscriber&lt;/code&gt; å®ä¾‹ï¼Œè€Œä¸æ˜¯æ ¹æ®å‡ ä¸ª lambda è¡¨è¾¾å¼ç»„åˆå‡ºä¸€ä¸ª &lt;code&gt;Subscriber&lt;/code&gt; å®ä¾‹ã€‚ä¸ºäº†æ–¹ä¾¿å®ç°è¿™æ ·çš„ä¸€ä¸ª &lt;code&gt;Subscriber&lt;/code&gt;ï¼ŒReactor æä¾›äº†ä¸€ä¸ªåä¸º &lt;code&gt;BaseSubscriber&lt;/code&gt; çš„å¯æ‰©å±•çš„æŠ½è±¡ç±»ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ¥å®ç°ä¸€ä¸ªï¼Œæˆ‘ä»¬å°†å…¶å‘½åä¸º &lt;code&gt;SampleSubscriber&lt;/code&gt;ã€‚å¦‚ä¸‹ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•å°†å…¶åº”ç”¨åˆ°ä¸€ä¸ª &lt;code&gt;Flux&lt;/code&gt; åºåˆ—ä¸Šï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;SampleSubscriber&amp;lt;Integer&amp;gt; ss = &lt;span style="color: #0000ff"&gt;new&lt;/span&gt; SampleSubscriber&amp;lt;Integer&amp;gt;();
Flux&amp;lt;Integer&amp;gt; ints = Flux.range(1, 4);
&lt;span style="color: #008000"&gt;//&lt;/span&gt;
ints.subscribe(i -&amp;gt; System.out.println(i),
    error -&amp;gt; System.err.println(&lt;span style="color: #a31515"&gt;&amp;quot;Error &amp;quot;&lt;/span&gt; + error),
    () -&amp;gt; {System.out.println(&lt;span style="color: #a31515"&gt;&amp;quot;Done&amp;quot;&lt;/span&gt;);},
    s -&amp;gt; s.request(10));
&lt;span style="color: #008000"&gt;//&lt;/span&gt;
ints.subscribe(ss);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚ä¸‹ç¤ºä¾‹æ¼”ç¤ºäº† &lt;code&gt;SampleSubscriber&lt;/code&gt; ç»§æ‰¿è‡ª &lt;code&gt;BaseSubscriber&lt;/code&gt; çš„ä¸€ä¸ªæœ€ç®€åŒ–å®ç°ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #0000ff"&gt;package&lt;/span&gt; io.projectreactor.samples;

&lt;span style="color: #0000ff"&gt;import&lt;/span&gt; org.reactivestreams.Subscription;
&lt;span style="color: #0000ff"&gt;import&lt;/span&gt; reactor.core.publisher.BaseSubscriber;

&lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #0000ff"&gt;class&lt;/span&gt; &lt;span style="color: #2b91af"&gt;SampleSubscriber&lt;/span&gt;&amp;lt;T&amp;gt; &lt;span style="color: #0000ff"&gt;extends&lt;/span&gt; BaseSubscriber&amp;lt;T&amp;gt; {

    &lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #2b91af"&gt;void&lt;/span&gt; hookOnSubscribe(Subscription subscription) {
        System.out.println(&lt;span style="color: #a31515"&gt;&amp;quot;Subscribed&amp;quot;&lt;/span&gt;);
        request(1);
    }

    &lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #2b91af"&gt;void&lt;/span&gt; hookOnNext(T value) {
        System.out.println(value);
        request(1);
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;BaseSubscriber&lt;/code&gt; è¿˜æä¾›äº†ä¸€ä¸ª &lt;code&gt;requestUnbounded()&lt;/code&gt; æ–¹æ³•æ¥åˆ‡æ¢åˆ°æ— é™æ¶ˆè´¹æ¨¡å¼ï¼ˆç›¸å½“äº &lt;code&gt;request(Long.MAX_VALUES)&lt;/code&gt;ï¼‰ï¼Œå¦å¤–ä¹Ÿæä¾›äº†ä¸€ä¸ª &lt;code&gt;cancel()&lt;/code&gt; æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº† &lt;code&gt;hookOnSubscribe&lt;/code&gt; å’Œ &lt;code&gt;hookOnNext&lt;/code&gt;ï¼Œ&lt;code&gt;BaseSubscriber&lt;/code&gt; è¿˜æä¾›äº†å…¶ä»–é’©å­æ–¹æ³•ï¼ˆæ–¹æ³•ä½“ä¸ºç©ºï¼Œæä¾›ç»§æ‰¿é‡å†™ï¼‰ï¼š&lt;code&gt;hookOnComplete&lt;/code&gt;ã€&lt;code&gt;hookOnError&lt;/code&gt;ã€&lt;code&gt;hookOnCancel&lt;/code&gt; ä»¥åŠ &lt;code&gt;hookFinally&lt;/code&gt;ï¼ˆå½“äº‹ä»¶/æ¶ˆæ¯åºåˆ—ï¼ˆæµï¼‰ç»ˆæ­¢æ—¶ï¼Œä¸€å®šä¼šè°ƒç”¨è¯¥æ–¹æ³•ï¼Œè°ƒç”¨æ—¶ä¼šä¼ å…¥ä¸€ä¸ª &lt;code&gt;SignalType&lt;/code&gt; ç±»å‹å‚æ•°è¡¨ç¤ºç»ˆæ­¢çš„ç±»å‹ï¼‰ã€‚&lt;/p&gt;
&lt;h5&gt;3.3.2 å…³äºåå‹å’Œè°ƒæ•´è¯·æ±‚é‡çš„æ–¹å¼&lt;/h5&gt;
&lt;p&gt;åœ¨ Reactor ä¸­å®ç°åå‹ï¼Œæ˜¯é€šè¿‡å‘ä¸Šæ¸¸ç®—å­å‘é€ä¸€ä¸ª &lt;code&gt;è¯·æ±‚ï¼ˆrequestï¼‰&lt;/code&gt;æ¥é€çº§ä¼ æ’­æ¶ˆè´¹è€…çš„å‹åŠ›ï¼Œç›´åˆ°æ•°æ®æºã€‚å½“å‰è¯·æ±‚çš„æ€»é‡æœ‰æ—¶åˆç§°ä¸ºå½“å‰çš„â€œéœ€æ±‚é‡â€ æˆ–è€… â€œå¾…æ»¡è¶³ï¼ˆpendingï¼‰çš„è¯·æ±‚é‡â€ã€‚éœ€æ±‚é‡çš„ä¸Šé™æ˜¯ &lt;code&gt;Long.MAX_VALUE&lt;/code&gt;ï¼Œè¡¨ç¤ºä¸€ä¸ªæ— é™é‡çš„è¯·æ±‚ï¼ˆæ„æ€æ˜¯â€œå°½å¿«äº§å‡ºæ•°æ®â€œ - åå‹ä¹Ÿå°±å¤±æ•ˆäº†ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æœ€ç»ˆçš„è®¢é˜…è€…åœ¨è®¢é˜…ä¹‹å‰ä¼šå‘å‡ºé¦–ä¸ªè¯·æ±‚ï¼Œè®¢é˜…æ‰€æœ‰æ¶ˆæ¯/æ•°æ®æœ€ç›´æ¥çš„æ–¹å¼æ˜¯å³åˆ»è§¦å‘ä¸€ä¸ªæ— é™é‡ï¼ˆLong.MAX_VALUEï¼‰çš„è¯·æ±‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;subscribe()&lt;/code&gt; ä»¥åŠå¤§éƒ¨åˆ†åŸºäº lambda è¡¨è¾¾å¼çš„å˜ç§æ–¹æ³•ï¼ˆé™¤äº†é‚£ä¸ªæ¥å— &lt;code&gt;Consumer&amp;lt;Subscription&amp;gt;&lt;/code&gt; ç±»å‹å‚æ•°çš„æ–¹æ³•ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;block()&lt;/code&gt;ã€&lt;code&gt;blockFirst()&lt;/code&gt; å’Œ &lt;code&gt;blockLast()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;è°ƒç”¨ &lt;code&gt;toIterable()&lt;/code&gt; æˆ– &lt;code&gt;toStream()&lt;/code&gt; è¿›è¡Œéå†&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¹é¦–ä¸ªè¯·æ±‚è¿›è¡Œå®šåˆ¶çš„æœ€ç®€å•æ–¹å¼æ˜¯ä»¥ä¸€ä¸ª &lt;code&gt;BaseSubscriber&lt;/code&gt; æ´¾ç”Ÿç±»å®ä¾‹æ¥ &lt;code&gt;subscribe&lt;/code&gt;ï¼Œæ´¾ç”Ÿç±»é‡å†™ &lt;code&gt;BaseSubscriber&lt;/code&gt; çš„ &lt;code&gt;hookOnSubscribe&lt;/code&gt; æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Flux.range(1, 10)
    .doOnRequest(r -&amp;gt; System.out.println(&lt;span style="color: #a31515"&gt;&amp;quot;request of &amp;quot;&lt;/span&gt; + r))
    .subscribe(&lt;span style="color: #0000ff"&gt;new&lt;/span&gt; BaseSubscriber&amp;lt;Integer&amp;gt;() {

      @Override
      &lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #2b91af"&gt;void&lt;/span&gt; hookOnSubscribe(Subscription subscription) {
        request(1);
      }

      @Override
      &lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #2b91af"&gt;void&lt;/span&gt; hookOnNext(Integer integer) {
        System.out.println(&lt;span style="color: #a31515"&gt;&amp;quot;Cancelling after having received &amp;quot;&lt;/span&gt; + integer);
        cancel();
      }
    });
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¸Šé¢è¿™ä¸ªä»£ç ç‰‡æ®µè¾“å‡ºå¦‚ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;request of 1
Cancelling after having received 1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;æ”¹å˜ä¸‹æ¸¸éœ€æ±‚é‡çš„ç®—å­&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è°¨è®°ï¼šè®¢é˜…æ—¶æŒ‡å®šçš„éœ€æ±‚é‡ï¼Œä¸Šæ¸¸æ“ä½œé“¾ä¸­çš„æ¯ä¸ªç®—å­éƒ½å¯ä»¥å¯¹å…¶ä½œå‡ºè°ƒæ•´ã€‚ä¸€ä¸ªå…¸å‹æ¡ˆä¾‹æ˜¯ &lt;code&gt;buffer(N)&lt;/code&gt; ç®—å­ï¼šå¦‚æœå®ƒæ”¶åˆ°ä¸€ä¸ª &lt;code&gt;request(2)&lt;/code&gt; è¯·æ±‚ï¼Œå®ƒä¼šç†è§£ä¸º2ä¸ªç¼“å†²åŒºçš„è¯·æ±‚é‡ã€‚å› ä¸ºç¼“å†²åŒºéœ€è¦ N ä¸ªå…ƒç´ æ‰è®¤ä¸ºæ˜¯æ»¡çš„ï¼Œæ‰€ä»¥ &lt;code&gt;buffer&lt;/code&gt; ç®—å­å°†è¯·æ±‚é‡è°ƒæ•´æˆäº† &lt;code&gt;2 x N&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä½ ä¹Ÿè®¸ä¹Ÿæ³¨æ„åˆ°æŸäº›ç®—å­å­˜åœ¨è¿™æ ·çš„å˜ç§ - æ¥å—ä¸€ä¸ªåä¸º &lt;code&gt;prefetch&lt;/code&gt; çš„ &lt;code&gt;int&lt;/code&gt; ç±»å‹å‚æ•°ã€‚è¿™æ˜¯å¦å¤–ä¸€ç±»ä¿®æ”¹ä¸‹æ¸¸è¯·æ±‚é‡çš„ç®—å­ã€‚è¿™ç±»ç®—å­ï¼ˆæ¯”å¦‚ &lt;code&gt;flatMap&lt;/code&gt;ï¼‰é€šå¸¸æ˜¯å¤„ç†å†…éƒ¨åºåˆ—ï¼ˆinner sequencesï¼‰ï¼Œä»æ¯ä¸ªè¿›å…¥çš„å…ƒç´ æ´¾ç”Ÿå‡ºä¸€ä¸ª &lt;code&gt;Publisher&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;é¢„å–ï¼ˆprefetchï¼‰&lt;/code&gt;æ˜¯è°ƒæ•´å†…éƒ¨åºåˆ—è¯·æ±‚é‡çš„ä¸€ä¸ªæ–¹å¼ã€‚å¦‚æœæœªæŒ‡å®šï¼Œå¤šæ•°è¿™ç±»ç®—å­ä¼šä»¥ 32 ä¸ºåˆå§‹éœ€æ±‚é‡ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç±»ç®—å­é€šå¸¸ä¹Ÿä¼šå®ç°ä¸€ä¸ª&lt;strong&gt;å¡«è¡¥ä¼˜åŒ–æ–¹æ¡ˆ&lt;/strong&gt;ï¼šç®—å­ä¸€æ—¦çœ‹åˆ° 25% çš„é¢„å–è¯·æ±‚é‡å·²å®Œæˆï¼Œå°±ä¼šå‘ä¸Šæ¸¸å†å‘èµ· 25% çš„è¯·æ±‚é‡ã€‚è¿™æ˜¯ä¸€ä¸ªå¯å‘å¼ä¼˜åŒ–ï¼Œå¦‚æ­¤è¿™ç±»ç®—å­å°±å¯ä»¥ä¸»åŠ¨åœ°ä¸ºå³å°†åˆ°æ¥çš„è¯·æ±‚é‡åšå¥½å‡†å¤‡ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œå†ä»‹ç»ä¸€å¯¹ç›´æ¥ç”¨äºè°ƒæ•´è¯·æ±‚é‡çš„ç®—å­ï¼š&lt;code&gt;limitRate&lt;/code&gt; å’Œ &lt;code&gt;limitRequest&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;limitRate(N)&lt;/code&gt; æŠŠä¸‹æ¸¸çš„è¯·æ±‚é‡æ‹†åˆ†æˆå¤šä¸ªæ›´å°é‡çš„è¯·æ±‚å‘ä¸Šæ¸¸ä¼ æ’­ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª &lt;code&gt;100&lt;/code&gt; çš„è¯·æ±‚ä¼ åˆ°ç®—å­ &lt;code&gt;limitRate(10)&lt;/code&gt;ï¼Œåˆ™ä¼šå˜æˆ 10 æ¬¡è¯·æ±‚ï¼Œä¸€æ¬¡è¯·æ±‚ 10ï¼Œä¼ æ’­åˆ°ä¸Šæ¸¸ã€‚æ³¨æ„ï¼š&lt;code&gt;limitRate&lt;/code&gt; å®é™…ä¸Šä»¥è¿™ç§å½¢å¼å®ç°äº†å‰é¢æåˆ°çš„å¡«è¡¥ä¼˜åŒ–æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªç®—å­æœ‰ä¸€ä¸ªå˜ç§ï¼Œå…è®¸å¼€å‘è€…è°ƒæ•´é¢„å–å¡«è¡¥é‡ï¼ˆå³ç®—å­å˜ç§çš„ &lt;code&gt;lowTide&lt;/code&gt; å‚æ•°ï¼‰ï¼š&lt;code&gt;limitRate(highTide, lowTide)&lt;/code&gt;ã€‚&lt;code&gt;lowTide&lt;/code&gt; å‚æ•°è®¾å®šä¸º &lt;code&gt;0&lt;/code&gt; æ—¶ï¼Œä¼šå¯¼è‡´ä¸¥æ ¼é™åˆ¶ä¸€æ¬¡è¯·æ±‚ &lt;code&gt;highTide&lt;/code&gt; ä¸ªï¼Œè€Œä¸æ˜¯ç»å¡«è¡¥ç­–ç•¥è¿›ä¸€æ­¥è°ƒæ•´è¿‡çš„ä¸€æ¬¡è¯·æ±‚é‡ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œ&lt;code&gt;limitRequest(N)&lt;/code&gt; åˆ™æ˜¯é™åˆ¶äº†ä¸‹æ¸¸æœ€å¤§çš„éœ€æ±‚æ€»é‡ã€‚å®ƒä¼šç´¯åŠ è¯·æ±‚é‡ç›´åˆ° &lt;code&gt;N&lt;/code&gt;ã€‚å¦‚æœä¸€æ¬¡è¯·æ±‚æ²¡æœ‰è®©éœ€æ±‚æ€»é‡è¶…è¿‡ &lt;code&gt;N&lt;/code&gt;ï¼Œåˆ™è¿™æ¬¡è¯·æ±‚ä¼šå®Œæ•´åœ°ä¼ æ’­åˆ°ä¸Šæ¸¸ï¼ˆè¯‘æ³¨ï¼šæ„æ€æ˜¯å¦‚æœä¸€æ¬¡è¯·æ±‚è®©éœ€æ±‚æ€»é‡è¶…è¿‡äº† &lt;code&gt;N&lt;/code&gt;ï¼Œè¿™æ¬¡è¯·æ±‚çš„è¯·æ±‚é‡ä¼šè¢«è£å‰ªï¼‰ã€‚å¦‚æœæ•°æ®æºå‘å‡ºçš„æ•°æ®æ€»é‡è¾¾åˆ°äº†é™åˆ¶çš„æ€»é‡ï¼Œ&lt;code&gt;limitRequest&lt;/code&gt; åˆ™è®¤ä¸ºè¿™ä¸ªåºåˆ—å¯ä»¥ç»“æŸäº†ï¼Œå‘ä¸‹æ¸¸å‘é€ä¸€ä¸ª &lt;code&gt;onComplete&lt;/code&gt; ä¿¡å·ï¼Œå¹¶å–æ¶ˆæ•°æ®æºã€‚&lt;/p&gt;
&lt;h4&gt;3.4 åŠ¨æ€åœ°ï¼ˆprogrammaticallyï¼‰åˆ›å»ºä¸€ä¸ªåºåˆ—&lt;/h4&gt;
&lt;h5&gt;3.4.1 åŒæ­¥çš„ generate&lt;/h5&gt;
&lt;p&gt;åŠ¨æ€åˆ›å»ºä¸€ä¸ª &lt;code&gt;Flux&lt;/code&gt; æœ€ç®€å•çš„æ–¹å¼æ˜¯å€ŸåŠ© &lt;code&gt;generate&lt;/code&gt; æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸€æ–¹å¼å¯ä»¥å®ç°&lt;strong&gt;åŒæ­¥çš„&lt;/strong&gt;ä¸”&lt;strong&gt;ä¸€ä¸ªæ¥ä¸€ä¸ª&lt;/strong&gt;åœ°ä¸‹å‘æ•°æ®ï¼Œè¿™æ„å‘³ç€æ¥æ”¶æ–¹ï¼ˆsinkï¼‰æ˜¯ä¸€ä¸ª &lt;code&gt;SynchronousSink&lt;/code&gt;ï¼Œå…¶ &lt;code&gt;next()&lt;/code&gt; æ–¹æ³•åœ¨ä¸€æ¬¡å›è°ƒæ–¹æ³•è°ƒç”¨ä¸­æœ€å¤šåªèƒ½è°ƒç”¨ä¸€æ¬¡ã€‚å¯ä»¥åœ¨å…¶åå†è°ƒç”¨ &lt;code&gt;error(Throwable)&lt;/code&gt; æˆ– &lt;code&gt;complete()&lt;/code&gt;ï¼Œè§†ä½ çš„éœ€æ±‚è€Œå®šã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;generate&lt;/code&gt; æ–¹æ³•å˜ç§çš„è¿™ä¸ªåº”è¯¥æ˜¯æœ€æœ‰ç”¨çš„ï¼šå…è®¸ä¿æŒä¸€ä¸ªçŠ¶æ€ï¼Œåœ¨è°ƒç”¨æ¥æ”¶æ–¹çš„ &lt;code&gt;next&lt;/code&gt; æ–¹æ³•æ—¶å¯ä»¥åŸºäºè¿™ä¸ªçŠ¶æ€æ¥å†³å®šä¸‹å‘ä»€ä¹ˆæ•°æ®ã€‚é‚£ä¹ˆè¿™ä¸ªç”Ÿæˆå™¨å‡½æ•°å°±æˆäº†ä¸€ä¸ª &lt;code&gt;BiFunction&amp;lt;S, SynchronousSink&amp;lt;T&amp;gt;, S&amp;gt;&lt;/code&gt; å®ä¾‹ï¼Œå…¶ä¸­ &lt;code&gt;&amp;lt;S&amp;gt;&lt;/code&gt; å³æ˜¯çŠ¶æ€å¯¹è±¡çš„ç±»å‹ã€‚å¯¹äºåˆå§‹çŠ¶æ€ï¼Œå¯ä»¥æä¾›ä¸€ä¸ª &lt;code&gt;Supplier&amp;lt;S&amp;gt;&lt;/code&gt; æ¥è·å–ï¼Œè¿™æ ·ç”Ÿæˆå™¨å‡½æ•°æ¯è½®è°ƒç”¨éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ª &lt;code&gt;int&lt;/code&gt; å®ä¾‹ä½œä¸ºçŠ¶æ€ï¼š&lt;/p&gt;
&lt;p&gt;&lt;em&gt;åŸºäºçŠ¶æ€çš„ &lt;code&gt;generate&lt;/code&gt; æ–¹æ³•ä½¿ç”¨ç¤ºä¾‹&lt;/em&gt;&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Flux&amp;lt;String&amp;gt; flux = Flux.generate(
    () -&amp;gt; 0, &lt;span style="color: #008000"&gt;// 1&lt;/span&gt;
    (state, sink) -&amp;gt; {
        sink.next(&lt;span style="color: #a31515"&gt;&amp;quot;3 x &amp;quot;&lt;/span&gt; + state + &lt;span style="color: #a31515"&gt;&amp;quot; = &amp;quot;&lt;/span&gt; + 3*state); &lt;span style="color: #008000"&gt;// 2&lt;/span&gt;
        &lt;span style="color: #0000ff"&gt;if&lt;/span&gt; (state == 10) sink.complete(); &lt;span style="color: #008000"&gt;// 3&lt;/span&gt;
        &lt;span style="color: #0000ff"&gt;return&lt;/span&gt; state + 1; &lt;span style="color: #008000"&gt;// 4&lt;/span&gt;
    });
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ol&gt;
&lt;li&gt;ä»¥ 0 ä½œä¸ºåˆå§‹çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;åŸºäºçŠ¶æ€ï¼ˆstateï¼‰å†³å®šä¸‹å‘ä»€ä¹ˆæ¶ˆæ¯/æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;åŸºäºçŠ¶æ€å†³å®šä½•æ—¶å¯ä»¥åœæ­¢æµ/åºåˆ—ã€‚&lt;/li&gt;
&lt;li&gt;è¿”å›ä¸€ä¸ªæ–°çŠ¶æ€ï¼Œä¸‹æ¬¡è°ƒç”¨æ—¶å¯ä»¥ä½¿ç”¨ï¼ˆé™¤éåœ¨è¿™æ¬¡è°ƒç”¨æ—¶å·²ç»ç»ˆæ­¢åºåˆ—ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ª &lt;code&gt;&amp;lt;S&amp;gt;&lt;/code&gt; ç±»å‹çš„å¯å˜å¯¹è±¡ã€‚æ¯”å¦‚ï¼Œä¸Šé¢çš„ç¤ºä¾‹å¯ä»¥ä½¿ç”¨ä¸€ä¸ª &lt;code&gt;AtomicLong&lt;/code&gt; å®ä¾‹ä½œä¸ºçŠ¶æ€æ¥é‡å†™ï¼Œæ¯è½®è°ƒç”¨éƒ½ä¼šæ”¹å˜å®ƒçš„å€¼ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Flux&amp;lt;String&amp;gt; flux = Flux.generate(
    AtomicLong::&lt;span style="color: #0000ff"&gt;new&lt;/span&gt;,
    (state, sink) -&amp;gt; {
        &lt;span style="color: #2b91af"&gt;long&lt;/span&gt; i = state.getAndIncrement();
        sink.next(&lt;span style="color: #a31515"&gt;&amp;quot;3 x &amp;quot;&lt;/span&gt; + i + &lt;span style="color: #a31515"&gt;&amp;quot; = &amp;quot;&lt;/span&gt; + 3*i);
        &lt;span style="color: #0000ff"&gt;if&lt;/span&gt; (i == 10) sink.complete();
        &lt;span style="color: #0000ff"&gt;return&lt;/span&gt; state;
    });
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;blockquote&gt;
&lt;p&gt;å¦‚æœçŠ¶æ€å¯¹è±¡åœ¨åºåˆ—ç»ˆæ­¢æ—¶éœ€è¦æ¸…ç†ä¸€äº›èµ„æºï¼Œåˆ™åº”è¯¥ä½¿ç”¨ &lt;code&gt;generate(Supplier&amp;lt;S&amp;gt;, BiFunction, Consumer&amp;lt;S&amp;gt;)&lt;/code&gt; å˜ç§æ–¹æ³•æ¥æ¸…ç†æœ€åçš„çŠ¶æ€å®ä¾‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¦‚ä¸‹ç¤ºä¾‹ä½¿ç”¨çš„ &lt;code&gt;generate&lt;/code&gt; æ–¹æ³•æ¥å—ä¸€ä¸ª &lt;code&gt;Consumer&lt;/code&gt; ç±»å‹å‚æ•°ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Flux&amp;lt;String&amp;gt; flux = Flux.generate(
    AtomicLong::&lt;span style="color: #0000ff"&gt;new&lt;/span&gt;,
    (state, sink) -&amp;gt; {
        &lt;span style="color: #2b91af"&gt;long&lt;/span&gt; i = state.getAndIncrement();
        sink.next(&lt;span style="color: #a31515"&gt;&amp;quot;3 x &amp;quot;&lt;/span&gt; + i + &lt;span style="color: #a31515"&gt;&amp;quot; = &amp;quot;&lt;/span&gt; + 3*i);
        &lt;span style="color: #0000ff"&gt;if&lt;/span&gt; (i == 10) sink.complete();
        &lt;span style="color: #0000ff"&gt;return&lt;/span&gt; state;
    }, (state) -&amp;gt; System.out.println(&lt;span style="color: #a31515"&gt;&amp;quot;state: &amp;quot;&lt;/span&gt; + state));
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h5&gt;3.4.2 å¼‚æ­¥å¤šçº¿ç¨‹çš„ create&lt;/h5&gt;
&lt;p&gt;&lt;code&gt;create&lt;/code&gt; æ˜¯åŠ¨æ€åˆ›å»ºä¸€ä¸ª &lt;code&gt;Flux&lt;/code&gt; çš„æ›´é«˜çº§çš„æ–¹å¼ï¼Œé€‚ç”¨äºæ¯è½®ä¸‹å‘å¤šä¸ªæ•°æ®ï¼Œç”šè‡³æ˜¯ä»å¤šä¸ªçº¿ç¨‹ä¸­ä¸‹å‘æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªæ–¹æ³•ä¼šå‘å›è°ƒæ–¹æ³•ä¼ å…¥ä¸€ä¸ª &lt;code&gt;FluxSink&lt;/code&gt; å®ä¾‹å‚æ•°ï¼Œåœ¨å›è°ƒæ–¹æ³•ä½“ä¸­å¯ä»¥è°ƒç”¨è¿™ä¸ªå‚æ•°çš„ &lt;code&gt;next&lt;/code&gt;ã€&lt;code&gt;error&lt;/code&gt; å’Œ &lt;code&gt;complete&lt;/code&gt; æ–¹æ³•ã€‚ä¸ &lt;code&gt;generate&lt;/code&gt; ä¸åŒï¼Œå®ƒæ²¡æœ‰åŸºäºçŠ¶æ€çš„å˜ç§æ–¹æ³•ã€‚å¦å¤–ï¼Œå›è°ƒæ–¹æ³•ä¸­ï¼Œå¯ä»¥å¤šçº¿ç¨‹åœ°è§¦å‘äº‹ä»¶ï¼ˆtrigger multi-threaded eventsï¼‰ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;create&lt;/code&gt; éå¸¸é€‚ç”¨äºå°†ä¸€ä¸ªå·²æœ‰çš„ API ï¼ˆæ¯”å¦‚ï¼šä¸€ä¸ªåŸºäºç›‘å¬å™¨çš„å¼‚æ­¥ APIï¼‰æ¡¥æ¥åˆ°ååº”å¼ä¸Šä¸‹æ–‡ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;create&lt;/code&gt; å¹¶ä¸ä¼šè‡ªåŠ¨å¹¶è¡ŒåŒ–æ‰§è¡Œä½ çš„ä»£ç ï¼Œä¹Ÿä¸ä¼šè®©å¤„ç†è¿‡ç¨‹è‡ªåŠ¨å˜æˆå¼‚æ­¥çš„ï¼Œå³ä½¿å®ƒå¯ä»¥é…åˆå¼‚æ­¥ API ä½¿ç”¨ã€‚å¦‚æœåœ¨ &lt;code&gt;create&lt;/code&gt; çš„ lambda è¡¨è¾¾å¼ä¸­å‘ç”Ÿé˜»å¡ï¼Œå°±ä¼šå­˜åœ¨æ­»é”æˆ–è€…å…¶å®ƒå‰¯ä½œç”¨çš„é£é™©ã€‚å³ä½¿å€ŸåŠ© &lt;code&gt;subscribeOn&lt;/code&gt;ï¼Œä¹Ÿè¦å½“å¿ƒ &lt;code&gt;create&lt;/code&gt; lambda è¡¨è¾¾å¼ä¸­é•¿æ—¶é—´çš„é˜»å¡ï¼ˆæ¯”å¦‚æ— é™å¾ªç¯è°ƒç”¨ &lt;code&gt;sink.next(t)&lt;/code&gt;ï¼‰é”ä½æµæ°´çº¿å¤„ç†ï¼š ï¼ˆè¯‘æ³¨ï¼šå¼‚æ­¥çš„ï¼‰æ•°æ®è¯·æ±‚å¯èƒ½æ ¹æœ¬å¾—ä¸åˆ°æ‰§è¡Œï¼Œå› ä¸ºï¼ˆè¯‘æ³¨ï¼šçº¿ç¨‹æ± åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼‰åŒä¸€ä¸ªçº¿ç¨‹ä¸€ç›´è¢«æ— é™å¾ªç¯å ç”¨ç€ã€‚ä½¿ç”¨ &lt;code&gt;subscribeOn(Scheduler, false)&lt;/code&gt; å˜ç§æ–¹æ³•ï¼š&lt;code&gt;requestOnSeparateThread = false&lt;/code&gt; å°†ä½¿ç”¨ &lt;code&gt;Scheduler&lt;/code&gt; çš„çº¿ç¨‹æ¥æ‰§è¡Œ &lt;code&gt;create&lt;/code&gt; æ–¹æ³•çš„å›è°ƒï¼Œåœ¨åŸå§‹çš„çº¿ç¨‹ä¸­æ‰§è¡Œ &lt;code&gt;request&lt;/code&gt;ï¼Œä»è€Œè®©æ•°æ®ä»ç„¶å¯ä»¥æµåŠ¨èµ·æ¥ã€‚ï¼ˆè¯‘æ³¨ï¼šæ­¤å¤„é€»è¾‘æœ‰ç‚¹ç»•ï¼Œä¹Ÿå¯èƒ½æ˜¯å› ä¸º subscribeOn æ–¹æ³•æœ¬èº«è¯­ä¹‰å°±ä¸å¤ªç›´è§‚ï¼‰ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å‡è®¾æˆ‘ä»¬è¦ä½¿ç”¨ä¸€ä¸ªåŸºäºç›‘å¬å™¨çš„ APIï¼Œå®ƒæŒ‰å—å¤„ç†æ•°æ®ï¼Œæä¾›ä¸¤ç±»äº‹ä»¶ï¼šï¼ˆ1ï¼‰æ¥äº†ä¸€å—æ•°æ®ï¼Œï¼ˆ2ï¼‰å¤„ç†å¯ä»¥ç»“æŸäº†ï¼ˆç»ˆæ­¢äº‹ä»¶ï¼‰ï¼Œå¦‚ä¸‹ &lt;code&gt;MyEventListener&lt;/code&gt; æ¥å£å®šä¹‰æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #0000ff"&gt;interface&lt;/span&gt; &lt;span style="color: #2b91af"&gt;MyEventListener&lt;/span&gt;&amp;lt;T&amp;gt; {
    &lt;span style="color: #2b91af"&gt;void&lt;/span&gt; onDataChunk(List&amp;lt;T&amp;gt; chunk);
    &lt;span style="color: #2b91af"&gt;void&lt;/span&gt; processComplete();
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨ &lt;code&gt;create&lt;/code&gt; å°†è¿™ä¸ª API æ¡¥æ¥åˆ°ä¸€ä¸ª &lt;code&gt;Flux&amp;lt;T&amp;gt;&lt;/code&gt; å®ä¾‹ä¸Šï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Flux&amp;lt;String&amp;gt; bridge = Flux.create(sink -&amp;gt; {
    myEventProcessor.register(  &lt;span style="color: #008000"&gt;// 4&lt;/span&gt;
        &lt;span style="color: #0000ff"&gt;new&lt;/span&gt; MyEventListener&amp;lt;String&amp;gt;() { &lt;span style="color: #008000"&gt;// 1&lt;/span&gt;
            &lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #2b91af"&gt;void&lt;/span&gt; onDataChunk(List&amp;lt;String&amp;gt; chunk) {
                &lt;span style="color: #0000ff"&gt;for&lt;/span&gt;(String s : chunk) {
                    sink.next(s); &lt;span style="color: #008000"&gt;// 2&lt;/span&gt;
                }
            }

            &lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #2b91af"&gt;void&lt;/span&gt; processComplete() {
                sink.complete(); &lt;span style="color: #008000"&gt;// 3&lt;/span&gt;
            }
        }
    );
});
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ol&gt;
&lt;li&gt;æ¡¥æ¥åˆ° &lt;code&gt;MyEventListener&lt;/code&gt; API&lt;/li&gt;
&lt;li&gt;æ•°æ®å—ä¸­æ¯ä¸ªå…ƒç´ éƒ½æˆäº† &lt;code&gt;Flux&lt;/code&gt; ä¸­çš„å…ƒç´ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;processComplete&lt;/code&gt; äº‹ä»¶è½¬æ¢æˆäº† &lt;code&gt;onComplete&lt;/code&gt; äº‹ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰è¿™äº›é€»è¾‘éƒ½æ˜¯åœ¨ &lt;code&gt;myEventProcessor&lt;/code&gt; æ‰§è¡Œæ—¶å¼‚æ­¥å®Œæˆçš„ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ­¤å¤–ï¼Œå› ä¸º &lt;code&gt;create&lt;/code&gt; å¯ä»¥æ¡¥æ¥å¼‚æ­¥ APIï¼Œå¹¶ç®¡ç†åå‹ï¼Œé€šè¿‡æŒ‡å®šä¸€ä¸ª &lt;code&gt;OverflowStrategy&lt;/code&gt; ç­–ç•¥ï¼Œå¯ä»¥è°ƒæ•´å¦‚ä½•æ™ºèƒ½åœ°å¤„ç†åå‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;IGNORE&lt;/code&gt; å®Œå…¨å¿½ç•¥ä¸‹æ¸¸çš„åå‹è¯·æ±‚ã€‚è¿™ä¸€ç­–ç•¥åœ¨ä¸‹æ¸¸çš„é˜Ÿåˆ—æ»¡æ—¶ï¼ˆwhen queues get full downstreamï¼‰ä¼šå¯¼è‡´ &lt;code&gt;IllegalStateException&lt;/code&gt; å¼‚å¸¸æŠ›å‡ºã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ERROR&lt;/code&gt; åœ¨ä¸‹æ¸¸å¤„ç†ä¸è¿‡æ¥æ—¶ä¼šä¸‹å‘ï¼ˆonErrorï¼‰ä¸€ä¸ª &lt;code&gt;IllegalStateException&lt;/code&gt; å¼‚å¸¸æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;DROP&lt;/code&gt; å¦‚æœä¸‹æ¸¸è¿˜æ²¡å‡†å¤‡å¥½æ¥æ”¶å½“å‰äº‹ä»¶ï¼Œåˆ™ç›´æ¥ä¸¢å¼ƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;BUFFER&lt;/code&gt; ï¼ˆé»˜è®¤ç­–ç•¥ï¼‰å¦‚æœä¸‹æ¸¸å¤„ç†ä¸è¿‡æ¥ï¼Œåˆ™å°†æ‰€æœ‰äº‹ä»¶æ”¾å…¥ç¼“å†²åŒºã€‚ï¼ˆç¼“å†²åŒºå¤§å°æ— é™åˆ¶ï¼Œæ‰€ä»¥å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æº¢å‡º&lt;code&gt;OutOfMemoryError&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;Mono&lt;/code&gt; ä¹Ÿæœ‰ä¸€ä¸ª &lt;code&gt;create&lt;/code&gt; ç”Ÿæˆå™¨æ–¹æ³•ã€‚Mono çš„ create æ–¹æ³•ä¼ å…¥å›è°ƒçš„ &lt;code&gt;MonoSink&lt;/code&gt; å‚æ•°ä¸å…è®¸ä¸‹å‘å¤šä¸ªæ¶ˆæ¯ï¼Œåœ¨ç¬¬ä¸€ä¸ªæ¶ˆæ¯ä¹‹åå®ƒä¼šä¸¢å¼ƒæ‰€æœ‰çš„æ¶ˆæ¯ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h5&gt;3.4.3 å¼‚æ­¥å•çº¿ç¨‹çš„ push&lt;/h5&gt;
&lt;p&gt;&lt;code&gt;push&lt;/code&gt; çš„åŠŸèƒ½ä»‹äº &lt;code&gt;generate&lt;/code&gt; å’Œ &lt;code&gt;create&lt;/code&gt; ä¹‹é—´ï¼Œé€‚ç”¨äºå¤„ç†æ¥è‡ªå•ä¸ªç”Ÿäº§è€…çš„äº‹ä»¶ã€‚&lt;code&gt;push&lt;/code&gt; ä¹Ÿå¯ä»¥æ˜¯å¼‚æ­¥çš„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;code&gt;create&lt;/code&gt; æ”¯æŒçš„è¶…é™ç­–ç•¥æ¥ç®¡ç†åå‹ï¼Œç„¶è€Œï¼ŒåŒæ—¶ï¼ˆat a timeï¼‰åªèƒ½æœ‰ä¸€ä¸ªç”Ÿäº§çº¿ç¨‹è°ƒç”¨ &lt;code&gt;next&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Flux&amp;lt;String&amp;gt; bridge = Flux.push(sink -&amp;gt; {
    myEventProcessor.register(
        &lt;span style="color: #0000ff"&gt;new&lt;/span&gt; SingleThreadEventListener&amp;lt;String&amp;gt;() { &lt;span style="color: #008000"&gt;// 1&lt;/span&gt;

            &lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #2b91af"&gt;void&lt;/span&gt; onDataChunk(List&amp;lt;String&amp;gt; chunk) {
                &lt;span style="color: #0000ff"&gt;for&lt;/span&gt; (String s: chunk) {
                    sink.next(&lt;span style="border: 1px solid #FF0000"&gt;&lt;/span&gt;s); &lt;span style="color: #008000"&gt;// 2&lt;/span&gt;
                }
            }

            &lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #2b91af"&gt;void&lt;/span&gt; processComplete() {
                sink.complete(); &lt;span style="color: #008000"&gt;// 3&lt;/span&gt;
            }

            &lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #2b91af"&gt;void&lt;/span&gt; processError(Throwable e) {
                sink.error(e); &lt;span style="color: #008000"&gt;// 4&lt;/span&gt;
            }
        }
    );
});
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ol&gt;
&lt;li&gt;æ¡¥æ¥åˆ° &lt;code&gt;SingleThreadEventListener&lt;/code&gt; çš„ APIã€‚&lt;/li&gt;
&lt;li&gt;åœ¨å•ä¸ªç›‘å¬å™¨çº¿ç¨‹ä¸­ä½¿ç”¨ &lt;code&gt;next&lt;/code&gt; å‘ä¸‹æ¸¸ï¼ˆsink - æ¥æ”¶æ–¹ï¼‰æ¨é€äº‹ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;complete&lt;/code&gt; äº‹ä»¶ä¹Ÿæ˜¯ç”±åŒä¸€ä¸ªç›‘å¬å™¨çº¿ç¨‹å‘å‡ºçš„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;error&lt;/code&gt; äº‹ä»¶ä¹Ÿæ˜¯ç”±åŒä¸€ä¸ªç›‘å¬å™¨çº¿ç¨‹å‘å‡ºçš„ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;æ¨/æ‹‰ æ··åˆæ¨¡å‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¤šæ•° Reactor ç®—å­ï¼Œæ¯”å¦‚ &lt;code&gt;create&lt;/code&gt;ï¼Œéƒ½éµä» &lt;strong&gt;æ¨/æ‹‰ï¼ˆpush/pullï¼‰&lt;/strong&gt; æ··åˆæ¨¡å‹ã€‚è¿™æ„å‘³ç€å°½ç®¡å¤§éƒ¨åˆ†çš„å¤„ç†è¿‡ç¨‹éƒ½æ˜¯å¼‚æ­¥çš„ï¼ˆæš—æŒ‡â€œæ¨â€çš„æ–¹å¼ï¼‰ï¼Œä¹Ÿå­˜åœ¨å°éƒ¨åˆ†é€»è¾‘æ˜¯ &lt;em&gt;æ‹‰ï¼ˆpullï¼‰&lt;/em&gt;æ–¹å¼ï¼šæ•°æ®è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;æ¶ˆè´¹è€…ä»æ•°æ®æº&lt;em&gt;æ‹‰å–&lt;/em&gt;æ•°æ®ï¼Œæ„æŒ‡ï¼šæ•°æ®æºåœ¨æ¶ˆè´¹è€…é¦–æ¬¡è¯·æ±‚åæ‰ä¼šå‘å‡ºæ•°æ®ï¼Œç„¶ååªæœ‰è¦æ•°æ®å°±ä¼šæ¨é€ç»™æ¶ˆè´¹è€…ï¼Œä¸è¿‡æ•°æ®é‡ä¸ä¼šè¶…è¿‡æ¶ˆè´¹è€…è¯·æ±‚çš„é‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;push()&lt;/code&gt; å’Œ &lt;code&gt;create()&lt;/code&gt; éƒ½å¯ä»¥é…ç½®ï¼ˆset upï¼‰ä¸€ä¸ª &lt;code&gt;onRequest&lt;/code&gt; äº‹ä»¶æ¶ˆè´¹è€…æ¥ç®¡ç†è¯·æ±‚é‡ï¼Œå¹¶ä¸”ç¡®ä¿ä»…å½“å­˜åœ¨å·²å‘èµ·çš„è¯·æ±‚ï¼Œæ•°æ®æ‰ä¼šæ¨é€ç»™ä¸‹æ¸¸ã€‚&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Flux&amp;lt;String&amp;gt; bridge = Flux.create(sink -&amp;gt; {
    myMessageProcessor.register(
        &lt;span style="color: #0000ff"&gt;new&lt;/span&gt; MyMessageListener&amp;lt;String&amp;gt;() {

            &lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #2b91af"&gt;void&lt;/span&gt; onMessage(List&amp;lt;String&amp;gt; messages) {
                &lt;span style="color: #0000ff"&gt;for&lt;/span&gt; (String s: messages) {
                    sink.next(s); &lt;span style="color: #008000"&gt;// 3&lt;/span&gt;
                }
            }
        }
    );
    sink.onRequest(n -&amp;gt; {
        List&amp;lt;String&amp;gt; messages = myMessageProcessor.getHistory(n); &lt;span style="color: #008000"&gt;// 1&lt;/span&gt;
        &lt;span style="color: #0000ff"&gt;for&lt;/span&gt; (String s: messages) {
            sink.next(s); &lt;span style="color: #008000"&gt;// 2&lt;/span&gt;
        }
    });    
});
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;em&gt;è¯‘è€…æ³¨ï¼šä¸Šé¢è¿™ä¸ªç¤ºä¾‹æœ‰ç‚¹é—®é¢˜ï¼Œå®é™…å¹¶ä¸å­˜åœ¨è¿™æ ·ä¸€ä¸ª create æ–¹æ³•ï¼Œå¹¶ä¸” sink.onRequest å®é™…ä»£è¡¨ä¸€ä¸ªæ— é™é‡ï¼ˆn = Long.MAX_VALUEï¼‰çš„è¯·æ±‚ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨è¯·æ±‚å‘èµ·åï¼Œæ‹‰å–æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœå³åˆ»æœ‰æ¶ˆæ¯äº†ï¼Œåˆ™æ¨é€ç»™ä¸‹æ¸¸ã€‚&lt;/li&gt;
&lt;li&gt;åç»­å¼‚æ­¥åˆ°è¾¾çš„æ¶ˆæ¯ä¹Ÿä¼šæ¨é€ç»™ä¸‹æ¸¸ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4&gt;3.5 å¤šçº¿ç¨‹ å’Œ è°ƒåº¦å™¨ ï¼ˆThreading and Schedulersï¼‰&lt;/h4&gt;
&lt;p&gt;Reactorï¼Œä¸ RxJava ç±»ä¼¼ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯&lt;strong&gt;å¹¶å‘æ— å…³çš„&lt;/strong&gt;ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒReactor å¹¶ä¸å¼ºåˆ¶ä½¿ç”¨å¹¶å‘ï¼ˆa concurrency
 modelï¼‰ï¼Œè€Œæ˜¯ï¼Œè®©å¼€å‘è€…æŒ‰éœ€å†³å®šæ˜¯å¦ä½¿ç”¨å¹¶å‘ã€‚ç„¶è€Œï¼ŒReactor ä¹Ÿæä¾›ä¸€äº›åŠŸèƒ½æ–¹ä¾¿å¼€å¯å¹¶å‘ã€‚&lt;/p&gt;
&lt;p&gt;è·å–åˆ°ä¸€ä¸ª &lt;code&gt;Flux&lt;/code&gt; æˆ– &lt;code&gt;Mono&lt;/code&gt; å¤„ç†æµï¼Œå¹¶ä¸æ„å‘³ç€å®ƒåœ¨ä¸€ä¸ªä¸“ç”¨ï¼ˆdedicatedï¼‰çš„çº¿ç¨‹ï¼ˆ&lt;code&gt;Thread&lt;/code&gt;ï¼‰ ä¸­è¿è¡Œã€‚ç›¸åï¼Œå¤šæ•°ç®—å­ä¹Ÿæ˜¯è¿è¡Œåœ¨å‰ä¸€ä¸ªç®—å­è¿è¡Œçš„çº¿ç¨‹ä¸­ã€‚é™¤éç‰¹æ„æŒ‡å®šï¼Œé¦–ä¸ªï¼ˆtopmostï¼‰ç®—å­ï¼ˆæ•°æ®æºï¼‰å°±è¿è¡Œåœ¨æ‰§è¡Œ &lt;code&gt;subscribe()&lt;/code&gt; æ–¹æ³•è°ƒç”¨çš„çº¿ç¨‹ä¸­ã€‚å¦‚ä¸‹ç¤ºä¾‹åœ¨ä¸€ä¸ªæ–°å»ºçº¿ç¨‹ä¸­è¿è¡Œä¸€ä¸ª &lt;code&gt;Mono&lt;/code&gt; å¤„ç†æµã€‚&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #0000ff"&gt;static&lt;/span&gt; &lt;span style="color: #2b91af"&gt;void&lt;/span&gt; main(String[] args) {
    &lt;span style="color: #0000ff"&gt;final&lt;/span&gt; Mono&amp;lt;String&amp;gt; mono = Mono.just(&lt;span style="color: #a31515"&gt;&amp;quot;Hello &amp;quot;&lt;/span&gt;); &lt;span style="color: #008000"&gt;// 1&lt;/span&gt;

    &lt;span style="color: #0000ff"&gt;new&lt;/span&gt; Thread(() -&amp;gt; mono
        .map(msg -&amp;gt; msg + &lt;span style="color: #a31515"&gt;&amp;quot;thread &amp;quot;&lt;/span&gt;)
        .subscribe(v -&amp;gt; &lt;span style="color: #008000"&gt;// 2 &lt;/span&gt;
            System.out.println(v + Thread.currentThread().getName()) &lt;span style="color: #008000"&gt;// 3&lt;/span&gt;
        )
    ).join();
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ol&gt;
&lt;li&gt;&lt;code&gt;Mono&amp;lt;String&amp;gt;&lt;/code&gt; æ˜¯åœ¨ä¸»ï¼ˆ&lt;code&gt;main&lt;/code&gt;ï¼‰çº¿ç¨‹ä¸­è£…é…çš„ï¼ˆassembledï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶è€Œï¼Œ è®¢é˜…æ“ä½œå‘ç”Ÿåœ¨ &lt;code&gt;Thread-0&lt;/code&gt; çº¿ç¨‹ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;å› è€Œï¼Œ&lt;code&gt;map&lt;/code&gt; å’Œ &lt;code&gt;onNext&lt;/code&gt; çš„å›è°ƒï¼ˆè¯‘æ³¨ï¼š&lt;code&gt;onNext&lt;/code&gt; çš„å›è°ƒå³ subscribe æ–¹æ³•ä¼ å…¥çš„ lambda è¡¨è¾¾å¼ï¼‰å®é™…ä¸Šä¹Ÿæ˜¯åœ¨ &lt;code&gt;Thread-0&lt;/code&gt; ä¸Šæ‰§è¡Œã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸Šè¿°çš„ä»£ç ä¼šè¾“å‡ºå¦‚ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;hello thread Thread-0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Reactor ä¸­ï¼Œè¿è¡Œæ¨¡å‹ä»¥åŠå®é™…çš„è¿è¡Œè¿‡ç¨‹å‘ç”Ÿåœ¨ä»€ä¹ˆåœ°æ–¹ç”±ä½¿ç”¨ä»€ä¹ˆ &lt;code&gt;Scheduler&lt;/code&gt; å†³å®šã€‚&lt;a href="https://projectreactor.io/docs/core/release/api/reactor/core/scheduler/Scheduler.html"&gt;&lt;code&gt;Scheduler&lt;/code&gt;&lt;/a&gt; ç±»ä¼¼äº &lt;code&gt;ExecutorService&lt;/code&gt;ï¼Œè´Ÿæœ‰è°ƒåº¦èŒè´£ï¼Œä½†å…·å¤‡ä¸€ä¸ªä¸“ç”¨çš„æŠ½è±¡ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ï¼Œå……å½“ä¸€ä¸ªæ—¶é’Ÿçš„è§’è‰²ï¼Œå¯ç”¨çš„å®ç°æ›´å¤šã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href="https://projectreactor.io/docs/core/release/api/reactor/core/scheduler/Schedulers.html"&gt;&lt;code&gt;Schedulers&lt;/code&gt;&lt;/a&gt; ç±»æä¾›äº†ä¸€äº›é™æ€æ–¹æ³•æ¥è®¿é—®è¿™äº›è¿è¡Œä¸Šä¸‹æ–‡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“å‰çº¿ç¨‹ï¼ˆ&lt;code&gt;Schedulers.immediate()&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å•ä¸ªå¯å¤ç”¨çš„çº¿ç¨‹ï¼ˆ&lt;code&gt;Schedulers.single()&lt;/code&gt;ï¼‰ã€‚æ³¨æ„ï¼šè¿™ä¸ªæ–¹æ³•ä¼šä¸ºæ‰€æœ‰è°ƒç”¨æ–¹ï¼ˆè¯‘æ³¨ï¼šè°ƒç”¨ Schedulers.single()ï¼‰å¤ç”¨åŒä¸€ä¸ªçº¿ç¨‹ï¼ŒæŒ‡å¯¼ &lt;code&gt;Scheduler&lt;/code&gt; é”€æ¯ï¼ˆdisposedï¼‰ã€‚å¦‚æœæœŸæœ›æ¯æ¬¡è°ƒç”¨è¿”å›ä¸€ä¸ªä¸“ç”¨çº¿ç¨‹ï¼Œåˆ™åº”è¯¥ä½¿ç”¨ &lt;code&gt;Schedulers.newSingle()&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªå¼¹æ€§çš„çº¿ç¨‹æ± ï¼ˆ&lt;code&gt;Schedulers.elastic()&lt;/code&gt;ï¼‰ã€‚è¿™ä¸ª Scheduler ä¼šæŒ‰éœ€åˆ›å»ºæ–°çš„å·¥ä½œè€…çº¿ç¨‹æ± ï¼ˆworker poolï¼‰ï¼Œå¹¶å¤ç”¨ç©ºé—²çš„å·¥ä½œè€…çº¿ç¨‹æ± ã€‚å¦‚æœå·¥ä½œè€…çº¿ç¨‹æ± ç©ºé—²æ—¶é—´å¤ªé•¿ï¼ˆé»˜è®¤ 60sï¼‰åˆ™ä¼šè¢«é”€æ¯ã€‚å¯¹äº I/O é˜»å¡å·¥ä½œè€Œè¨€è¿™æ˜¯ä¸€ä¸ªå¥½é€‰æ‹©ã€‚&lt;code&gt;Schedulers.elastic()&lt;/code&gt; å¯ä»¥ç®€ä¾¿åœ°ä¸ºé˜»å¡å¤„ç†è¿‡ç¨‹æä¾›ç‹¬ç«‹çš„çº¿ç¨‹ï¼ˆits own threadï¼‰ï¼Œè¿™æ ·é˜»å¡æ“ä½œå°±ä¸ä¼šå ç”¨ï¼ˆtie upï¼‰å…¶ä»–èµ„æºã€‚è¯¦æƒ…è¯·å‚è€ƒ &lt;a href="https://projectreactor.io/docs/core/release/reference/#faq.wrap-blocking"&gt;å¦‚ä½•åŒ…è£…ä¸€ä¸ªåŒæ­¥é˜»å¡çš„è°ƒç”¨ï¼Ÿ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å›ºå®šæ•°é‡å·¥ä½œè€…çš„ï¼ˆè¯‘æ³¨ï¼šæˆ‘æš‚æ—¶çš„ç†è§£ - å·¥ä½œè€…ï¼ˆworkerï¼‰ä¹Ÿæ˜¯ä¸€ä¸ªçº¿ç¨‹æ± ï¼‰ä¸€ä¸ªæ± ï¼Œä¸“é—¨ä¸ºå¹¶è¡Œå¤„ç†å·¥ä½œåšè¿‡è°ƒä¼˜ï¼ˆSchedulers.parallel()ï¼‰ã€‚å®ƒä¼šåˆ›å»ºå’Œ CPU æ ¸å¿ƒæ•°é‡ç›¸åŒçš„å·¥ä½œè€…ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;code&gt;Schedulers.fromExecutorService(ExecutorService)&lt;/code&gt; åŸºäºå·²æœ‰çš„ ExecutorService åˆ›å»ºä¸€ä¸ª Schedulerã€‚ï¼ˆä¹Ÿå¯ä»¥åŸºäºä¸€ä¸ª Executor æ¥åˆ›å»ºï¼Œä½†ä¸å»ºè®®è¿™ä¹ˆå¹²ï¼ˆè¯‘æ³¨ï¼šå› ä¸º Executor ä¸èƒ½é”€æ¯é‡Šæ”¾ï¼‰ï¼‰&lt;/p&gt;
&lt;p&gt;ä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;strong&gt;newXXX&lt;/strong&gt; è¿™ç±»æ–¹æ³•åˆ›å»ºå„ç§è°ƒåº¦å™¨ï¼ˆschedulerï¼‰ç±»å‹çš„å…¨æ–°å®ä¾‹ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ &lt;code&gt;Schedulers.newElastic(yourScheduleName)&lt;/code&gt; åˆ›å»ºä¸€ä¸ªåä¸º &lt;code&gt;yourScheduleName&lt;/code&gt; çš„å…¨æ–°çš„å¼¹æ€§è°ƒåº¦å™¨ï¼ˆelastic schedulerï¼‰ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;elastic&lt;/code&gt; è°ƒåº¦å™¨ç”¨äºå…¼å®¹å¤„ç†ä¸å¯é¿å…çš„å†å²é—ç•™çš„é˜»å¡æ€§ä»£ç ï¼Œä½† &lt;code&gt;single&lt;/code&gt; å’Œ &lt;code&gt;parallel&lt;/code&gt; è°ƒåº¦å™¨ä¸è¡Œï¼Œå› è€Œï¼Œå¦‚æœåœ¨ &lt;code&gt;single&lt;/code&gt; æˆ– &lt;code&gt;parallel&lt;/code&gt; è°ƒåº¦å™¨ä¸Šä½¿ç”¨ Reactor çš„é˜»å¡æ€§ APIï¼ˆ&lt;code&gt;block()&lt;/code&gt;ã€&lt;code&gt;blockFirst()&lt;/code&gt;ã€&lt;code&gt;blockLast()&lt;/code&gt;ï¼Œæˆ–è€…è¿›è¡Œ &lt;code&gt;toIterable()&lt;/code&gt; æˆ– &lt;code&gt;toStream()&lt;/code&gt; è¿­ä»£ï¼‰ï¼Œä¼šå¯¼è‡´æŠ›å‡º &lt;code&gt;IllegalStateException&lt;/code&gt; å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœè‡ªå®šä¹‰è°ƒåº¦å™¨æ‰€åˆ›å»ºçš„çº¿ç¨‹å®ä¾‹å®ç°äº† &lt;code&gt;NonBlocking&lt;/code&gt; æ ‡è®°æ€§æ¥å£ï¼ˆmarker interfaceï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªè°ƒåº¦å™¨ä¹Ÿå¯ä»¥è¢«æ ‡è®°ä¸ºâ€ä»…é€‚ç”¨äºéé˜»å¡æ€§ä½¿ç”¨ï¼ˆnon blocking onlyï¼‰â€œã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æŸäº›ç®—å­é»˜è®¤ä¼šä» &lt;code&gt;Schedulers&lt;/code&gt; é€‰æ‹©ä¸€ä¸ªç‰¹å®šçš„è°ƒåº¦å™¨æ¥ä½¿ç”¨ï¼ˆé€šå¸¸ä¹Ÿæ”¯æŒé€‰æ‹©å…¶ä»–çš„ï¼‰ã€‚ä¾‹å¦‚ï¼Œè°ƒç”¨å·¥å‚æ–¹æ³• &lt;code&gt;Flux.interval(Duration.ofMills(300))&lt;/code&gt; ä¼šç”Ÿæˆä¸€ä¸ª &lt;code&gt;Flux&amp;lt;Long&amp;gt;&lt;/code&gt; å®ä¾‹ - æ¯ 300 ms è¾“å‡ºä¸€ä¸ªæ»´ç­”äº‹ä»¶ã€‚è¿™ä¸ªæ–¹æ³•åº•å±‚å®ç°é»˜è®¤ä½¿ç”¨ &lt;code&gt;Schedulers.parallel()&lt;/code&gt;ã€‚å¦‚ä¸‹ä»£ç è¡Œæ¼”ç¤ºäº†å¦‚ä½•å°†è°ƒåº¦å™¨ä¿®æ”¹æˆç±»ä¼¼äº &lt;code&gt;Schedulers.single()&lt;/code&gt; çš„è°ƒåº¦å™¨æ–°å®ä¾‹ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Flux.interval(Duration.ofMillis(300), Schedulers.newSingle(&lt;span style="color: #a31515"&gt;&amp;quot;test&amp;quot;&lt;/span&gt;));
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Reactor æä¾›äº†ä¸¤ç§æ–¹å¼æ¥åˆ‡æ¢ååº”å¼é“¾ä¸­çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆæˆ–è€…è¯´ &lt;code&gt;è°ƒåº¦å™¨&lt;/code&gt;ï¼‰ï¼š&lt;code&gt;publishOn&lt;/code&gt; å’Œ &lt;code&gt;subscribeOn&lt;/code&gt;ã€‚ä¸¤è€…éƒ½æ˜¯æ¥å—ä¸€ä¸ª &lt;code&gt;Scheduler&lt;/code&gt; ç±»å‹å‚æ•°å¹¶å°†æ‰§è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢åˆ°è¿™ä¸ªè°ƒåº¦å™¨ã€‚ä¸è¿‡ï¼Œé“¾ä¸­ &lt;code&gt;publishOn&lt;/code&gt; æ‰€å¤„çš„ä½ç½®å¾ˆå…³é”®ï¼Œè€Œ &lt;code&gt;subscribeOn&lt;/code&gt; å¤„äºå“ªä¸ªä½ç½®éƒ½æ— æ‰€è°“ã€‚è¦ç†è§£è¿™ä¸ªå·®åˆ«çš„åŸå› ï¼Œå¾—å…ˆç†è§£ &lt;a href="https://projectreactor.io/docs/core/release/reference/#reactive.subscribe"&gt;è®¢é˜…ä¹‹å‰å®é™…ä»€ä¹ˆéƒ½æ²¡æœ‰å‘ç”Ÿ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Reactorï¼Œä¸²æ¥ç®—å­ï¼Œå°±æ˜¯å°†å¾ˆå¤š &lt;code&gt;Flux&lt;/code&gt; å’Œ &lt;code&gt;Mono&lt;/code&gt; çš„å®ç°ä¸€ä¸ªå¥—ä¸€ä¸ªï¼Œé€å±‚å°è£…ã€‚ä¸€æ—¦è®¢é˜…ï¼Œå°±åˆ›å»ºäº†ä¸€ä¸ª &lt;code&gt;Subscriber&lt;/code&gt; å¯¹è±¡é“¾ï¼Œæ²¿é“¾å›æº¯å³å¯æ‰¾åˆ°ç¬¬ä¸€ä¸ªå‘å¸ƒè€…ã€‚è¿™äº›å®ç°ç»†èŠ‚æ˜¯éšè—åœ¨æ¥å£èƒŒåï¼Œå¼€å‘è€…å¯è§çš„æ˜¯æœ€å¤–å±‚çš„é‚£ä¸ª &lt;code&gt;Flux&lt;/code&gt;ï¼ˆæˆ– &lt;code&gt;Mono&lt;/code&gt;ï¼‰ä»¥åŠ &lt;code&gt;Subscription&lt;/code&gt;ï¼ˆè¯‘æ³¨ï¼šReactor ä¸­ Subscription æ˜¯ä¸€ä¸ªæ¥å£ç±»å‹ï¼Œæ˜¯ &lt;code&gt;Subscriber&lt;/code&gt; æ¥å£ä¸­ &lt;code&gt;onSubscribe&lt;/code&gt; æ–¹æ³•å‚æ•°çš„ç±»å‹ - &lt;code&gt;public void onSubscribe(Subscription s)&lt;/code&gt;ï¼Œç”¨äºå‘ç”Ÿäº§è€…è¯·æ±‚æ•°æ® æˆ–è€… å–æ¶ˆè®¢é˜…ï¼‰ï¼Œä½†è¿™äº›ç®—å­ç‰¹å®šçš„é“¾ä¸­æ¶ˆè´¹è€…æ˜¯å¹•ååŠŸè‡£ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰äº†ä¸Šé¢è¿™äº›è®¤çŸ¥ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥äº†è§£ &lt;code&gt;publishOn&lt;/code&gt; å’Œ &lt;code&gt;subscribeOn&lt;/code&gt; è¿™ä¸¤ä¸ªç®—å­ï¼š&lt;/p&gt;
&lt;h5&gt;3.5.1 publishOn æ–¹æ³•&lt;/h5&gt;
&lt;p&gt;&lt;code&gt;publishOn&lt;/code&gt; å’Œå…¶ä»–ç®—å­çš„ç”¨æ³•ä¸€æ ·ï¼Œç”¨åœ¨è®¢é˜…é“¾çš„ä¸­é—´ç¯èŠ‚ï¼Œæ¥æ”¶æ¥è‡ªä¸Šæ¸¸çš„ä¿¡å·ï¼Œç„¶åå‘ä¸‹æ¸¸é‡æ”¾è¿™äº›ä¿¡å·ï¼Œä¸è¿‡ä¸‹å‘äº‹ä»¶å›è°ƒï¼ˆ&lt;code&gt;onEvent&lt;/code&gt;ã€&lt;code&gt;onError&lt;/code&gt;ã€&lt;code&gt;onComplete&lt;/code&gt;ï¼‰æ˜¯åœ¨å…³è” &lt;code&gt;Scheduler&lt;/code&gt; çš„ä¸€ä¸ªå·¥ä½œè€…ä¸Šæ‰§è¡Œçš„ã€‚å› æ­¤ï¼Œè¿™ä¸ªç®—å­ä¼šå½±å“åç»­ç®—å­åœ¨å“ªæ‰§è¡Œï¼ˆç›´åˆ°è®¢é˜…é“¾ä¸Šåˆä¸²æ¥äº†å¦ä¸€ä¸ª &lt;code&gt;publishOn&lt;/code&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†æ‰§è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢åˆ° &lt;code&gt;Scheduler&lt;/code&gt; é€‰æ‹©çš„ä¸€ä¸ªçº¿ç¨‹ä¸Š&lt;/li&gt;
&lt;li&gt;æ ¹æ®è§„èŒƒï¼ˆas per the specificationï¼‰ï¼Œ&lt;code&gt;onNext&lt;/code&gt; æ˜¯æŒ‰æ—¶åºä¾æ¬¡è°ƒç”¨ä¸‹å‘äº‹ä»¶çš„ï¼Œæ‰€ä»¥æ˜¯å ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼ˆè¯‘æ³¨ï¼šè¿™å¥ä¸å¤ªç†è§£ï¼ŒonNext happen in sequence, so this uses up a single threadï¼‰&lt;/li&gt;
&lt;li&gt;é™¤éç®—å­å·¥ä½œåœ¨ä¸€ä¸ªç‰¹å®šçš„ &lt;code&gt;Scheduler&lt;/code&gt; ä¸Šï¼ˆè¯‘æ³¨ï¼šæŸäº›ç®—å­çš„å†…éƒ¨å®ç°å†³å®šäº†è¿™ä¸€ç‚¹ï¼‰ï¼Œ&lt;code&gt;publishOn&lt;/code&gt; ä¹‹åçš„ç®—å­éƒ½æ˜¯åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸Šæ‰§è¡Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Scheduler s = Schedulers.newParallel(&lt;span style="color: #a31515"&gt;&amp;quot;parallel-scheduler&amp;quot;&lt;/span&gt;, 4); &lt;span style="color: #008000"&gt;// 1&lt;/span&gt;

&lt;span style="color: #0000ff"&gt;final&lt;/span&gt; Flux&amp;lt;String&amp;gt; flux = Flux
    .range(1, 2)
    .map(i -&amp;gt; 10 + i) &lt;span style="color: #008000"&gt;// 2&lt;/span&gt;
    .publishOn(s) &lt;span style="color: #008000"&gt;// 3&lt;/span&gt;
    .map(i -&amp;gt; &lt;span style="color: #a31515"&gt;&amp;quot;value &amp;quot;&lt;/span&gt; + i); &lt;span style="color: #008000"&gt;// 4&lt;/span&gt;

&lt;span style="color: #0000ff"&gt;new&lt;/span&gt; Thread(() -&amp;gt; flux.subscribe(System.out::println));
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ol&gt;
&lt;li&gt;åˆ›å»ºä¸€ä¸ªæ–°çš„ &lt;code&gt;Scheduler&lt;/code&gt;ï¼Œå†…å« 4 ä¸ªçº¿ç¨‹&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸€ä¸ª &lt;code&gt;map&lt;/code&gt; è¿è¡Œåœ¨ &amp;lt;ç¬¬5æ­¥&amp;gt; çš„åŒ¿åçº¿ç¨‹ä¸Š&lt;/li&gt;
&lt;li&gt;&lt;code&gt;publishOn&lt;/code&gt; å°†æ•´ä¸ªåºåˆ—çš„åç»­å¤„ç†åˆ‡æ¢åˆ°ä» &amp;lt;ç¬¬1æ­¥&amp;gt; é€‰å‡ºçš„çº¿ç¨‹ä¸Š&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒä¸ª &lt;code&gt;map&lt;/code&gt; è¿è¡Œåœ¨ä¸Šé¢è¯´çš„ä» &amp;lt;ç¬¬1æ­¥&amp;gt; é€‰å‡ºçš„çº¿ç¨‹ä¸Š&lt;/li&gt;
&lt;li&gt;è¿™ä¸ªåŒ¿åçº¿ç¨‹æ˜¯ &lt;em&gt;è®¢é˜…&lt;/em&gt; æ“ä½œå‘ç”Ÿçš„åœ°æ–¹ã€‚æ‰“å°è¯­å¥å‘ç”Ÿåœ¨ &lt;code&gt;publishOn&lt;/code&gt; åˆ‡æ¢çš„æœ€æ–°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸Š&lt;/li&gt;
&lt;/ol&gt;
&lt;h5&gt;3.5.2 subscribeOn æ–¹æ³•&lt;/h5&gt;
&lt;p&gt;&lt;code&gt;subscribeOn&lt;/code&gt; åœ¨æ„é€ åå‘é“¾æ—¶åº”ç”¨äºè®¢é˜…å¤„ç†è¿‡ç¨‹ï¼ˆè¯‘æ³¨ï¼šæ‰€è°“æ„é€ åå‘é“¾æ—¶ï¼Œæ˜¯æŒ‡è°ƒç”¨ subscribe æ–¹æ³•æ—¶ï¼‰ã€‚å› æ­¤ï¼Œæ— è®ºä½ å°† &lt;code&gt;subscribeOn&lt;/code&gt; æ”¾åœ¨ç®—å­é“¾çš„ä½•å¤„ï¼Œ&lt;strong&gt;å®ƒå§‹ç»ˆä¼šå½±å“æºå¤´ä¸‹å‘æ•°æ®çš„æ‰§è¡Œä¸Šä¸‹æ–‡&lt;/strong&gt;ã€‚ç„¶è€Œï¼Œè¿™å¹¶ä¸ä¼šå½±å“ &lt;code&gt;publishOn&lt;/code&gt; ä¹‹åç®—å­è°ƒç”¨çš„è¡Œä¸ºï¼Œå®ƒä»¬ä»ç„¶ä¼šåˆ‡æ¢åˆ° &lt;code&gt;publishOn&lt;/code&gt; æŒ‡å®šçš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»è®¢é˜…æ“ä½œå‘ç”Ÿæ—¶æ•´ä¸ªç®—å­é“¾æ‰€åœ¨çš„çº¿ç¨‹åˆ‡æ¢åˆ°æ–°çš„çº¿ç¨‹&lt;/li&gt;
&lt;li&gt;ä»æŒ‡å®š &lt;code&gt;Scheduler&lt;/code&gt; ä¸­é€‰æ‹©ä¸€ä¸ªçº¿ç¨‹&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;åªæœ‰é“¾ä¸­æœ€æ—©çš„ &lt;code&gt;subscribeOn&lt;/code&gt; è°ƒç”¨ä¼šå‘ç”Ÿå®é™…ä½œç”¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Scheduler s = Schedulers.newParallel(&lt;span style="color: #a31515"&gt;&amp;quot;parallel-scheduler&amp;quot;&lt;/span&gt;, 4); &lt;span style="color: #008000"&gt;// 1&lt;/span&gt;

&lt;span style="color: #0000ff"&gt;final&lt;/span&gt; Flux&amp;lt;String&amp;gt; flux = Flux
    .range(1, 2)
    .map(i -&amp;gt; 10 + i) &lt;span style="color: #008000"&gt;// 2&lt;/span&gt;
    .subscribeOn(s) &lt;span style="color: #008000"&gt;// 3&lt;/span&gt;
    .map(i -&amp;gt; &lt;span style="color: #a31515"&gt;&amp;quot;value &amp;quot;&lt;/span&gt; + i); &lt;span style="color: #008000"&gt;// 4&lt;/span&gt;

&lt;span style="color: #0000ff"&gt;new&lt;/span&gt; Thread(() -&amp;gt; flux.subscribe(System.out::println)); &lt;span style="color: #008000"&gt;// 5 &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ol&gt;
&lt;li&gt;åˆ›å»ºä¸€ä¸ªæ–°çš„ &lt;code&gt;Scheduler&lt;/code&gt;ï¼Œå†…å« 4 ä¸ªçº¿ç¨‹&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸€ä¸ª &lt;code&gt;map&lt;/code&gt; è¿è¡Œåœ¨è¿™ 4 ä¸ªçº¿ç¨‹ä¸­çš„æŸä¸ªçº¿ç¨‹ä¸Š&lt;/li&gt;
&lt;li&gt;...å› ä¸º &lt;code&gt;subscribeOn&lt;/code&gt; å°†æ•´ä¸ªåºåˆ—å¤„ç†é“¾ä»è®¢é˜…æ“ä½œå‘ç”Ÿæ—¶çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆç¬¬5æ­¥ï¼‰åˆ‡æ¢åˆ°äº†æ–°çš„ä¸Šä¸‹æ–‡&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒä¸ª &lt;code&gt;map&lt;/code&gt; å’Œç¬¬ä¸€ä¸ª &lt;code&gt;map&lt;/code&gt; è¿è¡Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸Š&lt;/li&gt;
&lt;li&gt;è¿™ä¸ªåŒ¿åçº¿ç¨‹æ˜¯ &lt;em&gt;è®¢é˜…æ“ä½œ&lt;/em&gt; ä¸€å¼€å§‹å‘ç”Ÿçš„åœ°æ–¹çš„ï¼Œä½†æ˜¯ &lt;code&gt;subscribeOn&lt;/code&gt; å³åˆ»å°†ä¸Šä¸‹æ–‡åˆ‡æ¢åˆ°è°ƒåº¦å™¨4ä¸ªçº¿ç¨‹ä¸­çš„ä¸€ä¸ªä¸Š&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;4. é«˜çº§ç‰¹æ€§å’Œæ¦‚å¿µ&lt;/h3&gt;
&lt;h4&gt;4.1 ä½¿ç”¨ ConnectableFlux å°†æ¶ˆæ¯å¹¿æ’­åˆ°å¤šä¸ªè®¢é˜…è€…&lt;/h4&gt;
&lt;p&gt;&lt;em&gt;ä»¥åæœ‰ç©ºå†ç¿»è¯‘&lt;/em&gt;&lt;/p&gt;
&lt;h4&gt;4.2 3ç§åˆ†æ‰¹å¤„ç†æ–¹å¼&lt;/h4&gt;
&lt;p&gt;&lt;em&gt;ä»¥åæœ‰ç©ºå†ç¿»è¯‘&lt;/em&gt;&lt;/p&gt;
&lt;h4&gt;4.3 ä½¿ç”¨ ParallelFlux å¹¶è¡ŒåŒ–å¤„ç†&lt;/h4&gt;
&lt;p&gt;å¦‚ä»Šå¤šæ ¸æ¶æ„å·²æ˜¯ä¸‹é‡Œå·´äººï¼Œç›¸åº”åœ°ï¼Œè½»æ¾å®ç°å¹¶è¡ŒåŒ–å·¥ä½œçš„å·¥å…·æ‰‹æ®µå¾ˆå…³é”®ã€‚Reactor æä¾›äº†ä¸€ä¸ªç‰¹æ®Šç±»å‹ - &lt;code&gt;ParallelFlux&lt;/code&gt; - å¸®åŠ©å®ç°å¹¶è¡ŒåŒ–å¤„ç†ã€‚&lt;code&gt;ParallelFlux&lt;/code&gt; æä¾›çš„ç®—å­æ˜¯ä¸ºå¹¶è¡ŒåŒ–å·¥ä½œä¼˜åŒ–è¿‡çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹ä»»æ„ &lt;code&gt;Flux&lt;/code&gt; å®ä¾‹è°ƒç”¨ &lt;code&gt;parallel()&lt;/code&gt;ç®—å­å°±èƒ½å¾—åˆ°ä¸€ä¸ª &lt;code&gt;ParallelFlux&lt;/code&gt; å®ä¾‹ã€‚è¿™ä¸ªæ–¹æ³•æœ¬èº«å¹¶ä¸èƒ½å®ç°å¹¶è¡ŒåŒ–å·¥ä½œï¼Œè€Œæ˜¯å°†å·¥ä½œè´Ÿè½½æ‹†åˆ†åˆ°å¤šä¸ªâ€œè½¨é“â€ï¼ˆé»˜è®¤â€œè½¨é“â€æ•°é‡ç­‰äº CPU æ ¸æ•°ï¼‰&lt;sup id="fnref:1"&gt;&lt;a class="footnote-ref" href="#fn:1"&gt;1&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å‘ŠçŸ¥äº§å‡ºçš„ ParallelFlux å®ä¾‹æ¯ä¸ªâ€œè½¨é“â€åœ¨å“ªæ‰§è¡Œï¼ˆä»¥åŠå¦‚ä½•å¹¶è¡Œæ‰§è¡Œâ€œè½¨é“â€ï¼‰ï¼Œåˆ™å¿…é¡»ä½¿ç”¨ &lt;code&gt;runOn(Scheduler)&lt;/code&gt;ã€‚æ³¨æ„ï¼šå¯¹äºå¹¶è¡Œå·¥ä½œï¼Œæ¨èä½¿ç”¨ä¸€ä¸ªä¸“ç”¨è°ƒåº¦å™¨ - &lt;code&gt;Schedulers.parallel()&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹æ¯”å¦‚ä¸‹ä¸¤ä¸ªç¤ºä¾‹ï¼Œç¬¬ä¸€ä¸ªç¤ºä¾‹çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Flux.range(1, 10)
    .parallel(2) &lt;span style="color: #008000"&gt;// 1&lt;/span&gt;
    .subscribe(i -&amp;gt; System.out.println(Thread.currentThread().getName() + &lt;span style="color: #a31515"&gt;&amp;quot; -&amp;gt; &amp;quot;&lt;/span&gt; + i));
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ol&gt;
&lt;li&gt;è¿™é‡Œå¼ºåˆ¶æŒ‡å®šäº†â€œè½¨é“â€æ•°é‡ï¼Œè€Œä¸ä¾èµ–äº CPU æ ¸æ•°ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç¬¬äºŒä¸ªç¤ºä¾‹çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Flux.range(1, 10)
    .parallel(2)
    .runOn(Schedulers.parallel())
    .subscribe(i -&amp;gt; System.out.println(Thread.currentThread().getName() + &lt;span style="color: #a31515"&gt;&amp;quot; -&amp;gt; &amp;quot;&lt;/span&gt; + i));
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç¬¬ä¸€ä¸ªç¤ºä¾‹è¾“å‡ºå¦‚ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;main -&amp;gt; 1
main -&amp;gt; 2
main -&amp;gt; 3
main -&amp;gt; 4
main -&amp;gt; 5
main -&amp;gt; 6
main -&amp;gt; 7
main -&amp;gt; 8
main -&amp;gt; 9
main -&amp;gt; 10
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç¬¬äºŒä¸ªç¤ºä¾‹æ­£ç¡®åœ°åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¸Šå®ç°äº†å¹¶è¡ŒåŒ–ï¼Œè¾“å…¥å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #0000ff"&gt;parallel&lt;/span&gt;-1 -&amp;gt; 1
&lt;span style="color: #0000ff"&gt;parallel&lt;/span&gt;-2 -&amp;gt; 2
&lt;span style="color: #0000ff"&gt;parallel&lt;/span&gt;-1 -&amp;gt; 3
&lt;span style="color: #0000ff"&gt;parallel&lt;/span&gt;-2 -&amp;gt; 4
&lt;span style="color: #0000ff"&gt;parallel&lt;/span&gt;-1 -&amp;gt; 5
&lt;span style="color: #0000ff"&gt;parallel&lt;/span&gt;-2 -&amp;gt; 6
&lt;span style="color: #0000ff"&gt;parallel&lt;/span&gt;-1 -&amp;gt; 7
&lt;span style="color: #0000ff"&gt;parallel&lt;/span&gt;-1 -&amp;gt; 9
&lt;span style="color: #0000ff"&gt;parallel&lt;/span&gt;-2 -&amp;gt; 8
&lt;span style="color: #0000ff"&gt;parallel&lt;/span&gt;-2 -&amp;gt; 10
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æœæ•°æ®åºåˆ—&lt;sup id="fnref:2"&gt;&lt;a class="footnote-ref" href="#fn:2"&gt;2&lt;/a&gt;&lt;/sup&gt;å·²ç»åœ¨å¹¶è¡ŒåŒ–å¤„ç†ï¼Œè€Œä½ åˆæƒ³å°†å…¶è½¬å›ä¸€ä¸ª â€œå¸¸è§„çš„â€ &lt;code&gt;Flux&lt;/code&gt; å®ä¾‹ï¼Œç„¶åä¸²è¡Œæ‰§è¡Œç®—å­é“¾ä½™ä¸‹çš„éƒ¨åˆ†ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ &lt;code&gt;ParallelFlux&lt;/code&gt; çš„ &lt;code&gt;sequential()&lt;/code&gt; æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šå¦‚æœç›´æ¥ä½¿ç”¨ä¸€ä¸ª &lt;code&gt;Subscriber&lt;/code&gt; ç±»å‹å‚æ•°è€Œä¸æ˜¯ lambda è¡¨è¾¾å¼æ¥è°ƒç”¨ &lt;code&gt;subscribe&lt;/code&gt; æ–¹æ³•ï¼Œé‚£ä¹ˆå†…éƒ¨å®ç°ä¼šéšå¼åœ°è°ƒç”¨ &lt;code&gt;sequential()&lt;/code&gt; æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;ç”±æ­¤ä¹Ÿè¦æ³¨æ„ï¼š&lt;code&gt;subscribe(Subscriber&amp;lt;T&amp;gt;)&lt;/code&gt; ä¼šåˆå¹¶æ‰€æœ‰æ•°æ®â€œè½¨é“â€ï¼Œè€Œ &lt;code&gt;subscribe(Consumer&amp;lt;T&amp;gt;)&lt;/code&gt; æ˜¯è¿è¡Œæ‰€æœ‰çš„æ•°æ®â€œè½¨é“â€ã€‚å¦‚æœä»¥ lambda è¡¨è¾¾å¼è°ƒç”¨ &lt;code&gt;subscribe&lt;/code&gt; æ–¹æ³•ï¼Œé‚£ä¹ˆæ¯ä¸ª lambda è¡¨è¾¾å¼éƒ½ä¼šè¢«å¤åˆ¶æˆå¤šä¸ªå®ä¾‹ï¼ˆæ•°é‡ç­‰äºâ€œè½¨é“â€æ•°é‡ï¼‰å»æ‰§è¡Œ&lt;sup id="fnref:3"&gt;&lt;a class="footnote-ref" href="#fn:3"&gt;3&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;è¯‘æ³¨ï¼šè¿™é‡Œçš„â€œè½¨é“â€å…¶å®ä¸å¤ªç›´ç™½ã€‚åœ¨å®ç°ä¸Šï¼Œ&lt;code&gt;ParallelFlux&lt;/code&gt; ä¼šå°†æœ€å &lt;code&gt;subscribe&lt;/code&gt; çš„ onNext å›è°ƒæŒ‰å¹¶è¡Œåº¦ï¼ˆé»˜è®¤ç­‰äº CPU æ ¸æ•° Nï¼‰å¤åˆ¶æˆ N ä¸ªï¼Œé‚£ä¹ˆæœ€ç»ˆè°ƒç”¨ ParallelFlux çš„ N ä¸ª Subscriberï¼Œä» ParallelFlux å®ä¾‹åˆ°ä¸€ä¸ª Subscriber çš„æ•°æ®æµè·¯å¾„å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªâ€œè½¨é“â€ï¼ŒParallelFlux åœ¨æ¥æ”¶åˆ°ä¸Šæ¸¸æ¶ˆæ¯åæŒ‰ç…§ round-robin æ–¹å¼é€‰æ‹©ä¸€ä¸ª Subscriber è°ƒç”¨å…¶ &lt;code&gt;onNext&lt;/code&gt; ä¸‹å‘æ¶ˆæ¯ï¼Œä½† &lt;code&gt;onNext&lt;/code&gt; æ˜¯è¿è¡Œåœ¨ä»€ä¹ˆçº¿ç¨‹ä¸Šï¼Œæ˜¯ç”± runOn ç®—å­å†³å®šçš„ï¼Œå¦‚æœä¸ä½¿ç”¨ runOn ç®—å­ï¼Œé‚£ä¹ˆæ‰€æœ‰ Subscriber çš„ &lt;code&gt;onNext&lt;/code&gt; æ–¹æ³•è°ƒç”¨éƒ½æ˜¯åŒæ­¥è¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸Šçš„ã€‚&amp;#160;&lt;a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:2"&gt;
&lt;p&gt;è¯‘æ³¨ï¼šåŸæ–‡ä¸­ç”¨äº†å¤šä¸ªè¯æ¥è¡¨è¾¾ç›¸è¿‘çš„æ„æ€ï¼šsequenceï¼ˆåºåˆ—ï¼‰ã€streamï¼ˆæµï¼‰ã€flowï¼ˆæµï¼‰ï¼Œé˜…è¯»æ—¶å¯ä»¥ç›¸äº’æ›¿ä»£ç†è§£ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ eventï¼ˆäº‹ä»¶ï¼‰ã€dataï¼ˆæ•°æ®ï¼‰ã€messageï¼ˆæ¶ˆæ¯ï¼‰ï¼Œåœ¨å½“å‰ä¸Šä¸‹æ–‡ä¸­ï¼Œå¯ä»¥çœ‹æˆæ˜¯ç­‰ä»·çš„ã€‚&amp;#160;&lt;a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:3"&gt;
&lt;p&gt;è¯‘æ³¨ï¼šè¿™è¯å†™å¾—çœŸè ¢ã€‚è¯¦ç»†è§£é‡Šè§è„šæ³¨ 1ã€‚&amp;#160;&lt;a class="footnote-backref" href="#fnref:3" title="Jump back to footnote 3 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="å…¶ä»–"></category><category term="ç¿»è¯‘"></category><category term="Reactor"></category><category term="Reactive"></category></entry><entry><title>Java System.getProperty VS. System.getenvï¼ˆè¯‘ï¼‰</title><link href="http://youngsterxyf.github.io/2019/06/25/java-prop-env/" rel="alternate"></link><published>2019-06-25T00:00:00+08:00</published><updated>2019-06-25T00:00:00+08:00</updated><author><name>xiayf</name></author><id>tag:youngsterxyf.github.io,2019-06-25:/2019/06/25/java-prop-env/</id><summary type="html">&lt;p&gt;åŸæ–‡ï¼š&lt;a href="https://www.baeldung.com/java-system-get-property-vs-system-getenv"&gt;Java System.getProperty vs System.getenv&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;1ã€ç®€ä»‹&lt;/h2&gt;
&lt;p&gt;Java åº”ç”¨ä»£ç ä¸­ä¼šè‡ªåŠ¨å¼•å…¥ &lt;code&gt;java.lang&lt;/code&gt; åŒ…ã€‚è¿™ä¸ªåŒ…åŒ…å«å¾ˆå¤šå¸¸ç”¨çš„ç±»ï¼ŒåŒ…æ‹¬ &lt;code&gt;NullPointerException&lt;/code&gt;ã€&lt;code&gt;Object&lt;/code&gt;ã€&lt;code&gt;Math&lt;/code&gt;ã€&lt;code&gt;String&lt;/code&gt; ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ &lt;code&gt;java.lang.System&lt;/code&gt; ç±» â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;åŸæ–‡ï¼š&lt;a href="https://www.baeldung.com/java-system-get-property-vs-system-getenv"&gt;Java System.getProperty vs System.getenv&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;1ã€ç®€ä»‹&lt;/h2&gt;
&lt;p&gt;Java åº”ç”¨ä»£ç ä¸­ä¼šè‡ªåŠ¨å¼•å…¥ &lt;code&gt;java.lang&lt;/code&gt; åŒ…ã€‚è¿™ä¸ªåŒ…åŒ…å«å¾ˆå¤šå¸¸ç”¨çš„ç±»ï¼ŒåŒ…æ‹¬ &lt;code&gt;NullPointerException&lt;/code&gt;ã€&lt;code&gt;Object&lt;/code&gt;ã€&lt;code&gt;Math&lt;/code&gt;ã€&lt;code&gt;String&lt;/code&gt; ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ &lt;code&gt;java.lang.System&lt;/code&gt; ç±»æ˜¯ä¸€ä¸ª final ç±»ï¼Œè¿™æ„å‘³ç€å¼€å‘è€…æ— æ³•ç»§æ‰¿å®ƒï¼Œå…¶æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯é™æ€çš„ï¼ˆstaticï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;System ç±»ä¸­æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«æ¥&lt;strong&gt;è¯»å–ç³»ç»Ÿå±æ€§ï¼ˆsystem propertiesï¼‰å’Œç¯å¢ƒå˜é‡ï¼ˆenvironment variablesï¼‰&lt;/strong&gt;ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸¤è€…çš„åŒºåˆ«ã€‚&lt;/p&gt;
&lt;h2&gt;2ã€ä½¿ç”¨ System.getProperty()&lt;/h2&gt;
&lt;p&gt;Java å¹³å°ä½¿ç”¨ä¸€ä¸ª &lt;code&gt;Properties&lt;/code&gt; å¯¹è±¡æ¥æä¾›&lt;strong&gt;æœ¬åœ°ç³»ç»Ÿç›¸å…³çš„ä¿¡æ¯å’Œé…ç½®&lt;/strong&gt;ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º &lt;strong&gt;ç³»ç»Ÿå±æ€§&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç³»ç»Ÿå±æ€§åŒ…æ‹¬å½“å‰ç”¨æˆ·ã€å½“å‰ Java è¿è¡Œæ—¶ç‰ˆæœ¬ ä»¥åŠ æ–‡ä»¶è·¯å¾„åˆ†éš”ç¬¦è¯¸å¦‚æ­¤ç±»çš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ä¸‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ &lt;code&gt;System.getProperty("log_dir")&lt;/code&gt; æ¥è¯»å– &lt;em&gt;log_dir&lt;/em&gt; å±æ€§å€¼ã€‚æˆ‘ä»¬ä¹Ÿä¼šä½¿ç”¨é»˜è®¤å€¼å‚æ•°ï¼Œè¿™æ ·å¦‚æœå±æ€§ä¸å­˜åœ¨ï¼Œ&lt;code&gt;getProperty&lt;/code&gt; åˆ™è¿”å› &lt;em&gt;/tmp/log&lt;/em&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;String log_dir = System.getProperty(&lt;span style="color: #a31515"&gt;&amp;quot;log_dir&amp;quot;&lt;/span&gt;, &lt;span style="color: #a31515"&gt;&amp;quot;/tmp/log&amp;quot;&lt;/span&gt;);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æœå¸Œæœ›åœ¨è¿è¡Œæ—¶å˜æ›´ç³»ç»Ÿå±æ€§ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ &lt;code&gt;System.setProperty&lt;/code&gt; æ–¹æ³•ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;System.setProperty(&lt;span style="color: #a31515"&gt;&amp;quot;log_dir&amp;quot;&lt;/span&gt;, &lt;span style="color: #a31515"&gt;&amp;quot;/tmp/log&amp;quot;&lt;/span&gt;);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æˆ‘ä»¬å¯ä»¥ä»¥å¦‚ä¸‹æ ¼å¼ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°å‘åº”ç”¨ä¼ é€’æŒ‡å®šå±æ€§æˆ–é…ç½®å€¼ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;java -jar jarName -DpropertyName=value
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ¯”å¦‚ å°† app.jar çš„ foo å±æ€§å€¼è®¾ç½®ä¸º barï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;java -jar app -Dfoo=&amp;quot;bar&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;System.getProperty è¿”å›çš„ä¸€å®šæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚&lt;/p&gt;
&lt;h2&gt;3ã€ä½¿ç”¨ System.getenv()&lt;/h2&gt;
&lt;p&gt;ç¯å¢ƒå˜é‡æ˜¯ç±»ä¼¼ Properties çš„ä¸€äº› é”®/å€¼ å¯¹ã€‚è®¸å¤šæ“ä½œç³»ç»Ÿéƒ½æä¾›ç¯å¢ƒå˜é‡çš„æ–¹å¼å‘åº”ç”¨ä¼ é€’é…ç½®ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;è®¾ç½®ç¯å¢ƒå˜é‡çš„æ–¹å¼ï¼Œå„æ“ä½œç³»ç»Ÿä¹‹é—´æœ‰æ‰€ä¸åŒã€‚ä¾‹å¦‚ï¼ŒWindows ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ§åˆ¶é¢æ¿ä¸­çš„ç³»ç»Ÿå·¥å…·ï¼ˆSystem Utilityï¼‰åº”ç”¨æ¥è®¾ç½®ï¼Œè€Œ Unix ç³»ç»Ÿåˆ™ä½¿ç”¨ shell è„šæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åˆ›å»ºä¸€ä¸ªè¿›ç¨‹æ—¶ï¼Œè¯¥è¿›ç¨‹é»˜è®¤ä¼šä»å…¶çˆ¶è¿›ç¨‹ç»§æ‰¿ä¸€ä¸ªå…‹éš†çš„ä¸Šä¸‹æ–‡ç¯å¢ƒ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ä¸‹ä»£ç ç‰‡æ®µæ¼”ç¤ºï¼šä½¿ç”¨ä¸€ä¸ª lambda è¡¨è¾¾å¼æ¥è¾“å‡ºæ‰€æœ‰ç¯å¢ƒå˜é‡ã€‚&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;System.getenv().forEach((k, v) -&amp;gt; {
    System.out.println(k + &lt;span style="color: #a31515"&gt;&amp;quot;:&amp;quot;&lt;/span&gt; + v);
});
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;getenv() è¿”å›ä¸€ä¸ªåªè¯»çš„ &lt;code&gt;Map&lt;/code&gt;&lt;/strong&gt;ã€‚å°è¯•å‘è¯¥æ˜ å°„ä¸­æ·»åŠ å€¼ï¼Œä¼šæŠ›å‡º &lt;code&gt;UnsupportedOperationException&lt;/code&gt; å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨å˜é‡åç§°ä½œä¸ºå‚æ•°è°ƒç”¨ &lt;code&gt;getenv&lt;/code&gt; æ¥è·å–å•ä¸ªå˜é‡å€¼ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;String log_dir = System.getenv(&lt;span style="color: #a31515"&gt;&amp;quot;log_dir&amp;quot;&lt;/span&gt;);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ä¸­åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹ï¼Œå¹¶å‘å…¶ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ·»åŠ æ–°çš„ç¯å¢ƒå˜é‡ã€‚&lt;/p&gt;
&lt;p&gt;Java ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ &lt;code&gt;ProcessBuilder&lt;/code&gt; ç±»æ¥åˆ›å»ºæ–°è¿›ç¨‹ï¼Œè¯¥ç±»æœ‰ä¸€ä¸ªåä¸º &lt;code&gt;environment&lt;/code&gt; çš„æ–¹æ³•ï¼Œæ­¤æ–¹æ³•è¿”å›ä¸€ä¸ª &lt;code&gt;Map&lt;/code&gt;ï¼Œä¸è¿‡è¿™ä¸ªæ˜ å°„ä¸æ˜¯åªè¯»çš„ï¼Œè¿™æ ·å°±å¯ä»¥å‘å…¶æ·»åŠ æ–°å…ƒç´ ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ProcessBuilder pb = &lt;span style="color: #0000ff"&gt;new&lt;/span&gt; ProcessBuilder(args);
Map&amp;lt;String, String&amp;gt; env = pb.environment();
env.put(&lt;span style="color: #a31515"&gt;&amp;quot;log_dir&amp;quot;&lt;/span&gt;, &lt;span style="color: #a31515"&gt;&amp;quot;/tmp/log&amp;quot;&lt;/span&gt;);
Process process = pb.start();
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;4ã€åŒºåˆ«&lt;/h2&gt;
&lt;p&gt;è¿™ä¸¤è€…æœ¬è´¨ä¸Šéƒ½æ˜¯æä¾› å­—ç¬¦ä¸²ç±»å‹ é”®å€¼ ä¿¡æ¯çš„æ˜ å°„ï¼ŒåŒºåˆ«åœ¨äºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶å˜æ›´ ç³»ç»Ÿå±æ€§ï¼ˆPropertiesï¼‰ï¼Œä½†æ˜¯ ç¯å¢ƒå˜é‡ï¼ˆEnvironment Variablesï¼‰ä»…æ˜¯æ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡çš„ä¸€ä¸ªä¸å¯å˜æ‹·è´ã€‚&lt;/li&gt;
&lt;li&gt;ä»… Java å¹³å°åŒ…å«è¿™ä¸ª ç³»ç»Ÿå±æ€§ ç‰¹æ€§ï¼Œè€Œ ç¯å¢ƒå˜é‡ åˆ™æ˜¯æ“ä½œç³»ç»Ÿå±‚é¢æä¾›ï¼Œå…¨å±€å¯ç”¨çš„ - è¿è¡Œåœ¨åŒä¸€ä¸ªæœºå™¨ä¸Šçš„æ‰€æœ‰åº”ç”¨éƒ½å¯ä»¥è®¿é—®ã€‚&lt;/li&gt;
&lt;li&gt;ç³»ç»Ÿå±æ€§ åœ¨æ‰“åŒ…åº”ç”¨æ—¶å°±å¿…é¡»å­˜åœ¨&lt;sup id="fnref:1"&gt;&lt;a class="footnote-ref" href="#fn:1"&gt;1&lt;/a&gt;&lt;/sup&gt;ï¼Œè€Œ ç¯å¢ƒå˜é‡ åˆ™ä»»æ„æ—¶åˆ»éƒ½å¯ä»¥åœ¨æ“ä½œç³»ç»Ÿä¸­åˆ›å»ºã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;5ã€æ€»ç»“ä¸€ä¸‹&lt;/h2&gt;
&lt;p&gt;è™½ç„¶è¿™ä¸¤è€…åœ¨æ¦‚å¿µä¸Šæ¯”è¾ƒç›¸ä¼¼ï¼Œä½†æ˜¯ ç³»ç»Ÿå±æ€§ å’Œ ç¯å¢ƒå˜é‡ çš„åº”ç”¨æ–¹å¼å·®åˆ«å¾ˆå¤§ã€‚&lt;/p&gt;
&lt;p&gt;äºŒé€‰ä¸€é€šå¸¸è€ƒé‡çš„æ˜¯ç”Ÿæ•ˆèŒƒå›´ã€‚ä½¿ç”¨ ç¯å¢ƒå˜é‡ï¼ŒåŒä¸€ä¸ªåº”ç”¨å¯ä»¥éƒ¨ç½²åˆ°å¤šä¸ªæœºå™¨ä¸Šè¿è¡Œä¸åŒçš„å®ä¾‹ï¼Œå¹¶åœ¨æ“ä½œç³»ç»Ÿçº§åˆ«æˆ–è€…åœ¨ AWS / Azure äº‘å¹³å°æ§åˆ¶å°ä¸­è¿›è¡Œé…ç½®ï¼Œä»¥å…æ›´æ–°é…ç½®æ—¶è¿˜å¾—é‡æ–°æ„å»ºåº”ç”¨ï¼ˆ&lt;strong&gt;è¯‘æ³¨ï¼šå…¶å®ä½¿ç”¨ ç³»ç»Ÿå±æ€§ ä¹Ÿå¯ä»¥å®ç°è¿™ä¸ªæ•ˆæœï¼Œæ¯”å¦‚åœ¨ shell è„šæœ¬ä¸­è·å–ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼Œç„¶åä½œä¸ºç³»ç»Ÿå±æ€§é€šè¿‡ Java å‘½ä»¤è¡Œå‚æ•°ä¼ é€’ç»™åº”ç”¨&lt;/strong&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;getProperty&lt;/code&gt; æ–¹æ³•åç§°æ˜¯é©¼å³°é£æ ¼ï¼Œä½† &lt;code&gt;getenv&lt;/code&gt; ä¸æ˜¯ï¼Œè°¨è®°ï¼&lt;/p&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;åŸæ–‡æ˜¯è¿™ä¹ˆå†™çš„ï¼Œä½†æˆ‘è®¤ä¸ºè¿™å¥è¯æœ‰é—®é¢˜ã€‚ç³»ç»Ÿå±æ€§æ˜æ˜å¯ä»¥åœ¨åº”ç”¨è¿è¡Œæ—¶é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šï¼Œä¹Ÿå¯ä»¥å°†å±æ€§æ–‡ä»¶æ‰“åŒ…åˆ°åº”ç”¨åŒ…ä¸­ï¼Œåœ¨è¿è¡Œæ—¶åŠ è½½ï¼ˆé€šè¿‡ &lt;code&gt;System.getProperties().load&lt;/code&gt; æ–¹æ³•ï¼‰ã€‚&amp;#160;&lt;a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="å…¶ä»–"></category><category term="ç¿»è¯‘"></category><category term="Java"></category></entry><entry><title>Java å•æµ‹ä¼´ä¾£ - mockito</title><link href="http://youngsterxyf.github.io/2019/06/17/mockito/" rel="alternate"></link><published>2019-06-17T00:00:00+08:00</published><updated>2019-06-17T00:00:00+08:00</updated><author><name>xiayf</name></author><id>tag:youngsterxyf.github.io,2019-06-17:/2019/06/17/mockito/</id><summary type="html">&lt;p&gt;å…¶å®å·¥ä½œä»¥æ¥ï¼Œæˆ‘å¾ˆå°‘å†™æµ‹è¯•/å•æµ‹ä»£ç ï¼Œä¸€æ–¹é¢æ˜¯å¤§éƒ¨åˆ†äº’è”ç½‘å…¬å¸å›¢é˜Ÿå¯¹æµ‹è¯•çš„è¦æ±‚ä¸é«˜ï¼Œå¦ä¸€æ–¹é¢æ˜¯æƒ³å†™å¥½æµ‹è¯•ä»£ç  â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;å…¶å®å·¥ä½œä»¥æ¥ï¼Œæˆ‘å¾ˆå°‘å†™æµ‹è¯•/å•æµ‹ä»£ç ï¼Œä¸€æ–¹é¢æ˜¯å¤§éƒ¨åˆ†äº’è”ç½‘å…¬å¸å›¢é˜Ÿå¯¹æµ‹è¯•çš„è¦æ±‚ä¸é«˜ï¼Œå¦ä¸€æ–¹é¢æ˜¯æƒ³å†™å¥½æµ‹è¯•ä»£ç è¿˜æŒºéš¾çš„ï¼ŒæŒºèŠ±æ—¶é—´ï¼Œå…¶ä¸­æœ€éº»çƒ¦çš„æ˜¯å¾…æµ‹ä»£ç å¯èƒ½ä¼šè®¿é—®å¤–éƒ¨èµ„æºï¼ˆæ¯”å¦‚æ•°æ®åº“ã€HTTP APIï¼‰ï¼Œå¦‚æœä¸èƒ½æ–¹ä¾¿åœ°è¿›æ¨¡æ‹Ÿè®¿é—®è¿™äº›å¤–éƒ¨èµ„æºï¼Œé‚£ä¹ˆæµ‹è¯•èµ·æ¥ä¼šéå¸¸éº»çƒ¦ã€‚&lt;/p&gt;
&lt;p&gt;ä½†ï¼Œå¯¹äºå¤æ‚é€»è¾‘ï¼Œå¦‚æœä¸ç»è¿‡ä¸¥æ ¼æµ‹è¯•ï¼Œå‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒï¼Œåˆæœ‰äº›ä¸æ”¾å¿ƒï¼Œæ²¡åº•æ°”ï¼Œæˆ–è€…åœ¨ä»£ç é‡æ„æ—¶ï¼Œå¦‚æœæ²¡æœ‰è¦†ç›–å…¨é¢çš„æµ‹è¯•ï¼Œå¾ˆéš¾è¯„ä¼°ä»£ç å˜åŠ¨å¸¦æ¥çš„å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;ç›´åˆ°é‡åˆ° &lt;a href="https://site.mockito.org/"&gt;mockito&lt;/a&gt;ï¼Œæˆ‘æ‰è§‰å¾—æ˜¯æ—¶å€™è®¤çœŸå†™å†™æµ‹è¯•ä»£ç äº†ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;a href="https://site.mockito.org/"&gt;mockito&lt;/a&gt; æä¾›ä¸¤ç§å¯¹è±¡æ¨¡æ‹Ÿæ–¹å¼ï¼š&lt;strong&gt;mock&lt;/strong&gt; å’Œ &lt;strong&gt;spy&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç®€å•æ¥è¯´ï¼Œmock æ¨¡æ‹Ÿçš„å¯¹è±¡æ˜¯ä¸€ä¸ªå®Œå…¨å‡çš„å¯¹è±¡ï¼Œåªæ˜¯å…·å¤‡æŒ‡å®šç±»å‹çš„æ¥å£ï¼Œä»¥ &lt;code&gt;java.util.List&lt;/code&gt; ä¸ºä¾‹ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #0000ff"&gt;import static&lt;/span&gt; org.mockito.Mockito.mock;

List mockedList = mock(List.class);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è™½ç„¶ List æ˜¯ä¸€ä¸ª interfaceï¼Œä¹Ÿå¯ä»¥æ¨¡æ‹Ÿå‡ºä¸€ä¸ªå¯¹è±¡å®ä¾‹ï¼Œè¿™ä¸ª mockedList å¯¹è±¡å…·å¤‡ List æ¥å£å®šä¹‰çš„æ‰€æœ‰æ–¹æ³•ï¼Œä½†æ‰€æœ‰æ–¹æ³•éƒ½ä¸å…·å¤‡å®é™…çš„è¡Œä¸ºæ“ä½œï¼Œå¯¹äºæœ‰è¿”å›å€¼çš„æ–¹æ³•ï¼Œåˆ™é»˜è®¤è¿”å›æ–¹æ³•è¿”å›ç±»å‹çš„é»˜è®¤å€¼ï¼Œæ²¡æœ‰è¿”å›å€¼çš„æ–¹æ³•ï¼Œåˆ™çº¯ç²¹æ˜¯ä¸€ä¸ªç©ºæ–¹æ³•ã€‚æ¯”å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #008000"&gt;// mockedList å¹¶ä¸ä¼šçœŸçš„æŠŠ 1 å­˜ä¸‹æ¥&lt;/span&gt;
mockedList.add(1);
&lt;span style="color: #008000"&gt;// æ‰€ä»¥ï¼Œsize() è¿”å›é»˜è®¤å€¼ï¼Œè¾“å‡º 0&lt;/span&gt;
System.out.println(mockedList.size());
&lt;span style="color: #008000"&gt;// è¾“å‡º null&lt;/span&gt;
System.out.println(mockedList.get(0));
&lt;span style="color: #008000"&gt;// è¾“å‡º null&lt;/span&gt;
System.out.println(mockedList.get(1));
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¯¹äºæ¨¡æ‹Ÿå‡ºæ¥çš„å¯¹è±¡ï¼Œå¯ä»¥ä»»æ„æŒ‡å®šå…¶æ–¹æ³•çš„è¿”å›å€¼ï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #0000ff"&gt;import static&lt;/span&gt; org.mockito.Mockito.when;

&lt;span style="color: #008000"&gt;// è°ƒç”¨ size() æ–¹æ³•æ—¶ï¼Œè¿”å› 10&lt;/span&gt;
when(mockedList.size()).willReturn(10);
when(mockedList.get(0)).willReturn(&lt;span style="color: #a31515"&gt;&amp;quot;Hello World!&amp;quot;&lt;/span&gt;);
when(mockedList.get(1)).thenReturn(&lt;span style="color: #a31515"&gt;&amp;quot;æ‚¨å¥½ï¼&amp;quot;&lt;/span&gt;);

&lt;span style="color: #008000"&gt;// è¾“å‡º 10&lt;/span&gt;
System.out.println(mockedList.size());
&lt;span style="color: #008000"&gt;// è¾“å‡º Hello World!&lt;/span&gt;
System.out.println(mockedList.get(0));
&lt;span style="color: #008000"&gt;// è¾“å‡º æ‚¨å¥½ï¼&lt;/span&gt;
System.out.println(mockedList.get(1));
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å½“ç„¶æˆ‘ä»¬å†™æµ‹è¯•ä»£ç æ—¶ï¼Œå¹¶ä¸ä¼šä½¿ç”¨ System.out.printlnï¼Œç„¶åçœ‹è¾“å‡ºï¼Œè€Œæ˜¯ä½¿ç”¨&lt;strong&gt;æ–­è¨€&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #0000ff"&gt;import static&lt;/span&gt; org.junit.Assert.assertEquals;

assertEquals(10, mockedList.size());
assertEquals(&lt;span style="color: #a31515"&gt;&amp;quot;Hello World!&amp;quot;&lt;/span&gt;, mockedList.get(0));
assertEquals(&lt;span style="color: #a31515"&gt;&amp;quot;æ‚¨å¥½ï¼&amp;quot;&lt;/span&gt;, mockedList.get(1));
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ–­è¨€æ–¹æ³•éå¸¸å¤šï¼Œä¸ä»…ä»…åªæ˜¯ assertEqualsã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºåŒä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥æ¨¡æ‹Ÿå¤šæ¬¡è°ƒç”¨è¿”å›ä¸åŒçš„å€¼ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #008000"&gt;// ä¼šè¦†ç›–ä¹‹å‰ mock çš„è¡Œä¸ºï¼šwhen(mockedList.size()).willReturn(10);&lt;/span&gt;
&lt;span style="color: #008000"&gt;// æˆ–è€…è¿™ä¹ˆå†™ï¼šwhen(mockedList.size()).willReturn(0, -1, 10);&lt;/span&gt;
when(mockedList.size()).thenReturn(0).thenReturn(-1).thenReturn(10);
assertEquals(0, mockedList.size());
assertEquals(-1, mockedList.size());
assertEquals(10, mockedList.size());
&lt;span style="color: #008000"&gt;// ç¬¬ 3 æ¬¡ä¹‹åçš„ mockedList.size() è°ƒç”¨éƒ½è¿”å› 10&lt;/span&gt;
assertEquals(10, mockedList.size());

Iterator iterator = mock(Iterator.class);
&lt;span style="color: #008000"&gt;// æˆ–è€…è¿™ä¹ˆå†™ï¼šwhen(iterator.next()).thenReturn(0, 1, 10, 1000);&lt;/span&gt;
when(iterator.next()).thenReturn(0).thenReturn(1).thenReturn(10).thenReturn(1000);
assertEquals(0, iterator.next());
assertEquals(1, iterator.next());
assertEquals(10, iterator.next());
assertEquals(1000, iterator.next());
&lt;span style="color: #008000"&gt;// ç¬¬ 4 æ¬¡ä¹‹åçš„ iterator.next() è°ƒç”¨éƒ½è¿”å› 1000&lt;/span&gt;
assertEquals(1000, iterator.next());
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿˜å¯ä»¥æ¨¡æ‹Ÿå¼‚å¸¸æŠ›å‡ºï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;List mockedList = mock(List.class);

when(mockedList.get(-1000)).thenThrow(&lt;span style="color: #0000ff"&gt;new&lt;/span&gt; RuntimeException(&lt;span style="color: #a31515"&gt;&amp;quot;å‚æ•°å¼‚å¸¸ï¼&amp;quot;&lt;/span&gt;));
&lt;span style="color: #0000ff"&gt;try&lt;/span&gt; {
    mockedList.get(-1000);
} &lt;span style="color: #0000ff"&gt;catch&lt;/span&gt; (Exception e) {
    assertTrue(e &lt;span style="color: #0000ff"&gt;instanceof&lt;/span&gt; RuntimeException);
    assertEquals(&lt;span style="color: #a31515"&gt;&amp;quot;å‚æ•°å¼‚å¸¸ï¼&amp;quot;&lt;/span&gt;, e.getMessage());
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¹Ÿå¯ä»¥åŸºäºå¤æ‚çš„é€»è¾‘æ¥æ„é€ è¿”å›å€¼ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #0000ff"&gt;import&lt;/span&gt; org.mockito.invocation.InvocationOnMock;
&lt;span style="color: #0000ff"&gt;import&lt;/span&gt; org.mockito.stubbing.Answer;

List&amp;lt;Integer&amp;gt; mockedList = mock(List.class);
when(mockedList.get(anyInt())).thenAnswer(&lt;span style="color: #0000ff"&gt;new&lt;/span&gt; EchoAnswer());

assertTrue(1 == mockedList.get(1));
assertTrue(10 == mockedList.get(10));

&lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #0000ff"&gt;class&lt;/span&gt; &lt;span style="color: #2b91af"&gt;EchoAnswer&lt;/span&gt; &lt;span style="color: #0000ff"&gt;implements&lt;/span&gt; Answer&amp;lt;Integer&amp;gt; {

    &lt;span style="color: #0000ff"&gt;public&lt;/span&gt; Integer answer(InvocationOnMock var) {
        &lt;span style="color: #0000ff"&gt;return&lt;/span&gt; var.getArgument(0);
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é™¤äº† &lt;code&gt;when(...).thenReturn(...)&lt;/code&gt; é£æ ¼çš„æµ‹è¯•æ¨¡æ‹Ÿæ–¹å¼ï¼Œè¿˜æœ‰ BDDï¼ˆBehavior Driven Development è¡Œä¸ºé©±åŠ¨å¼€å‘ï¼‰é£æ ¼çš„ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #0000ff"&gt;import static&lt;/span&gt; org.mockito.BDDMockito.given;

&lt;span style="color: #008000"&gt;// given&lt;/span&gt;
given(mockedList.get(0)).willReturn(100);
&lt;span style="color: #008000"&gt;// when&lt;/span&gt;
&lt;span style="color: #2b91af"&gt;int&lt;/span&gt; v = (&lt;span style="color: #2b91af"&gt;int&lt;/span&gt;) mockedList.get(0);
&lt;span style="color: #008000"&gt;// then&lt;/span&gt;
assertEquals(100, v);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æœæ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼Œæˆ–è€…å…¶å®ƒå¥‡è‘©çš„éœ€æ±‚ï¼Œåˆ™æ²¡æ³•ä½¿ç”¨ when.thenReturn / willReturn è¿™æ ·çš„æ¨¡æ‹Ÿæ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code&gt;doReturn(...).when(...)...&lt;/code&gt;ï¼š
&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #0000ff"&gt;import static&lt;/span&gt; org.mockito.Mockito.doThrow;
&lt;span style="color: #0000ff"&gt;import static&lt;/span&gt; org.mockito.Mockito.doReturn;

ArrayList mockedList = mock(ArrayList.class);
&lt;span style="color: #008000"&gt;// clear æ–¹æ³•æ— è¿”å›å€¼&lt;/span&gt;
doThrow(&lt;span style="color: #0000ff"&gt;new&lt;/span&gt; RuntimeException(&lt;span style="color: #a31515"&gt;&amp;quot;æ¸…é™¤å¤±è´¥&amp;quot;&lt;/span&gt;)).when(mockedList).clear();

&lt;span style="color: #0000ff"&gt;try&lt;/span&gt; {
    mockedList.clear();
} &lt;span style="color: #0000ff"&gt;catch&lt;/span&gt; (Exception e) {
    assertTrue(e &lt;span style="color: #0000ff"&gt;instanceof&lt;/span&gt; RuntimeException);
    assertEquals(&lt;span style="color: #a31515"&gt;&amp;quot;æ¸…é™¤å¤±è´¥&amp;quot;&lt;/span&gt;, e.getMessage());
}

&lt;span style="color: #008000"&gt;// æ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºæ²¡æ³•ä½¿ç”¨ æ–­è¨€ æ¥éªŒè¯ï¼Œå®é™…è¿è¡Œæ—¶ä¼šæŠ›å¼‚å¸¸&lt;/span&gt;
doReturn(10).when(mockedList).clear();
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä»ç¤ºä¾‹ä»£ç å¯ä»¥çœ‹å‡ºï¼Œ&lt;code&gt;doReturn(...).when(...)....&lt;/code&gt; ä¸ä¼šåšç±»å‹æ ¡éªŒï¼ŒmockedList.clear() è¿”å›å€¼ç±»å‹ä¸º voidï¼Œä½†æˆ‘ä»¬æ¨¡æ‹Ÿè®©å…¶è¿”å› 10ï¼›æ‰€ä»¥ï¼Œæ­£å¸¸æƒ…å†µåº”è¯¥å°½å¯èƒ½ä½¿ç”¨ &lt;code&gt;when(...).thenReturn(...)&lt;/code&gt; æˆ– &lt;code&gt;given(...).willReturn(...)&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;å‰è¿°ä»£ç ç¤ºä¾‹ä¸­ï¼Œæ¨¡æ‹Ÿæ–¹æ³•çš„å‚æ•°éƒ½åšäº†ç¡¬ç¼–ç ï¼Œå®é™…æƒ…å†µé€šå¸¸éƒ½ä¸æ˜¯è¿™ä¹ˆæµ‹è¯•ï¼Œè€Œæ˜¯æ¨¡æ‹Ÿæ–¹æ³•çš„å‚æ•°ç¬¦åˆä¸€å®šçš„è¦æ±‚å³å¯ï¼Œæ¯”å¦‚ï¼šåœ¨æŸä¸ªèŒƒå›´ä¹‹å†…ã€ç¬¦åˆç±»å‹çš„ä»»ä½•å€¼ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #0000ff"&gt;import static&lt;/span&gt; org.mockito.Mockito.anyInt;

&lt;span style="color: #008000"&gt;/*&lt;/span&gt;
&lt;span style="color: #008000"&gt;ä»¥ä»»ä½• int ç±»å‹çš„å‚æ•°è°ƒç”¨ mockedList.get æ–¹æ³•ï¼Œéƒ½è¿”å› 100&lt;/span&gt;

&lt;span style="color: #008000"&gt;å¦‚æœå†™æˆ when(mockedList.get(0)).thenReturn(100)ï¼Œåˆ™åªæœ‰ä»¥ 0 ä¸ºå‚æ•°è°ƒç”¨ mockedList.get æ–¹æ³•ï¼Œæ‰ä¼šè¿”å›100ï¼Œå…¶ä»–å‚æ•°å€¼ï¼Œè¿”å›çš„éƒ½æ˜¯é»˜è®¤å€¼ 0&lt;/span&gt;
&lt;span style="color: #008000"&gt;*/&lt;/span&gt;
when(mockedList.get(anyInt())).thenReturn(100);

assertEquals(100, mockedList.get(0));
assertEquals(100, mockedList.get(1000));
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¯ç”¨çš„å‚æ•°åŒ¹é…å™¨ï¼Œè§ org.mockito.ArgumentMatchers ç±»çš„é™æ€æ–¹æ³•åˆ—è¡¨ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å®ç° ArgumentMatcher æ¥å£ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #0000ff"&gt;package&lt;/span&gt; org.mockito;

&lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #0000ff"&gt;interface&lt;/span&gt; &lt;span style="color: #2b91af"&gt;ArgumentMatcher&lt;/span&gt;&amp;lt;T&amp;gt; {
    &lt;span style="color: #2b91af"&gt;boolean&lt;/span&gt; matches(T var1);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #0000ff"&gt;import&lt;/span&gt; org.mockito.ArgumentMatcher;
&lt;span style="color: #0000ff"&gt;import static&lt;/span&gt; org.mockito.Mockito.intThat;

when(mockedList.get(intThat(&lt;span style="color: #0000ff"&gt;new&lt;/span&gt; LimitedInt()))).thenReturn(10);

assertEquals(&lt;span style="color: #0000ff"&gt;null&lt;/span&gt;, mockedList.get(-1));
assertEquals(10, mockedList.get(1));
assertEquals(10, mockedList.get(99));
assertEquals(&lt;span style="color: #0000ff"&gt;null&lt;/span&gt;, mockedList.get(100));

&lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #0000ff"&gt;class&lt;/span&gt; &lt;span style="color: #2b91af"&gt;LimitedInt&lt;/span&gt; &lt;span style="color: #0000ff"&gt;implements&lt;/span&gt; ArgumentMatcher&amp;lt;Integer&amp;gt; {

    &lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #2b91af"&gt;boolean&lt;/span&gt; matches(Integer var) {
        &lt;span style="color: #0000ff"&gt;return&lt;/span&gt; &lt;span style="color: #0000ff"&gt;var&lt;/span&gt; &lt;span style="border: 1px solid #FF0000"&gt;&amp;gt; 0 &amp;amp;&amp;amp; &lt;/span&gt;var &amp;lt; 100;
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æœè¢«æ¨¡æ‹Ÿçš„æ–¹æ³•åŒ…å«å¤šä¸ªå‚æ•°ï¼Œé‚£ä¹ˆè¿™äº›å‚æ•°è¦ä¹ˆå…¨éƒ¨ä½¿ç”¨åŒ¹é…å™¨ï¼Œè¦ä¹ˆå…¨éƒ¨ä¸ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;æ¨¡æ‹ŸæŸäº›ç±»ï¼ˆAï¼‰çš„æ–¹æ³•ï¼Œé€šå¸¸ä¼šå°† mock å‡ºæ¥çš„å¯¹è±¡æ³¨å…¥åˆ°ä¾èµ–è¯¥ç±»å®ä¾‹çš„å…¶ä»–ç±»ï¼ˆBï¼‰ä¸­ï¼Œæ¥æ›¿ä»£çœŸå®çš„ä¾èµ–ï¼Œè¿™ç§æ–¹å¼çš„ç›®çš„æ˜¯ä¸ºäº†æµ‹è¯•ç±» B çš„è¡Œä¸ºæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚&lt;/p&gt;
&lt;p&gt;å¦ä¸€ä¸ªæµ‹è¯•éœ€æ±‚æ˜¯ï¼Œæµ‹è¯•æŸä¸ªç±» A' åœ¨æŸä¸ªä¸Šä¸‹æ–‡ç¯å¢ƒä¸­çš„è¡Œä¸ºæ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œæ¯”å¦‚ï¼š A' çš„æŸä¸ªæ–¹æ³•æ˜¯å¦è¢«è°ƒç”¨è¿‡ã€è°ƒç”¨è¿‡å‡ æ¬¡ã€è°ƒç”¨å‚æ•°æ˜¯å¦ç¬¦åˆé¢„æœŸã€å‡ ä¸ªæ–¹æ³•ä¹‹é—´çš„è°ƒç”¨æ¬¡åºæ˜¯å¦ç¬¦åˆé¢„æœŸã€æ–¹æ³•è°ƒç”¨è€—æ—¶æ˜¯å¦ç¬¦åˆé¢„æœŸç­‰ç­‰ã€‚&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #0000ff"&gt;import static&lt;/span&gt; org.mockito.Mockito.verify;
&lt;span style="color: #0000ff"&gt;import static&lt;/span&gt; org.mockito.Mockito.times;
&lt;span style="color: #0000ff"&gt;import static&lt;/span&gt; org.mockito.Mockito.never;
&lt;span style="color: #0000ff"&gt;import static&lt;/span&gt; org.mockito.Mockito.verifyZeroInteractions;

List mocked = mock(List.class);

Caller caller = &lt;span style="color: #0000ff"&gt;new&lt;/span&gt; Caller();
caller.setList(mocked);

&lt;span style="color: #008000"&gt;// è°ƒç”¨ 0 æ¬¡&lt;/span&gt;
caller.run(0);
&lt;span style="color: #008000"&gt;// éªŒè¯æ˜¯å¦ä»æ¥æ²¡è°ƒç”¨è¿‡ mocked.size()&lt;/span&gt;
verify(mocked, never()).size();
&lt;span style="color: #008000"&gt;// éªŒè¯ æ²¡æœ‰å’Œ mocked äº§ç”Ÿè¿‡ä»»ä½•äº¤äº’&lt;/span&gt;
&lt;span style="color: #008000"&gt;// å› ä¸º Caller.run ä¸­è°ƒç”¨äº† list.isEmpty()ï¼Œå®é™…äº§ç”Ÿäº†äº¤äº’ï¼Œæ‰€ä»¥è¿™è¡Œæµ‹è¯•ä¼šå¤±è´¥&lt;/span&gt;
verifyZeroInteractions(mocked);

&lt;span style="color: #008000"&gt;// è°ƒç”¨ 10 æ¬¡&lt;/span&gt;
caller.run(10);
&lt;span style="color: #008000"&gt;// éªŒè¯æ˜¯å¦è°ƒç”¨ mocked.size() 10 æ¬¡&lt;/span&gt;
verify(mocked, times(10)).size();

&lt;span style="color: #008000"&gt;// å†è°ƒç”¨ä¸€æ¬¡&lt;/span&gt;
caller.run(1);
&lt;span style="color: #008000"&gt;// æ‰€ä»¥æ˜¯ 11 æ¬¡äº†&lt;/span&gt;
verify(mocked, times(11)).size();

@Data
&lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #0000ff"&gt;class&lt;/span&gt; &lt;span style="color: #2b91af"&gt;Caller&lt;/span&gt; {
    List list;

    &lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #2b91af"&gt;void&lt;/span&gt; run(&lt;span style="color: #2b91af"&gt;int&lt;/span&gt; count) {
        &lt;span style="color: #0000ff"&gt;for&lt;/span&gt; (&lt;span style="color: #2b91af"&gt;int&lt;/span&gt; idx=0; idx &amp;lt; count; idx++) {
            list.size();
        }
        &lt;span style="color: #008000"&gt;//&lt;/span&gt;
        list.isEmpty();
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;List mocked = mock(List.class);

mocked.add(1);
mocked.add(2);

verify(mocked).add(1);

&lt;span style="color: #008000"&gt;// æ˜¯å¦æœ‰å…¶ä»–äº¤äº’æ²¡æœ‰éªŒè¯è¿‡ï¼Ÿå› ä¸º mocked è¿˜è°ƒç”¨è¿‡ mocked.add(2)ï¼Œæ‰€ä»¥è¿™å¥æµ‹è¯•ä¼šå¤±è´¥&lt;/span&gt;
verifyNoMoreInteractions(mocked);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #0000ff"&gt;import&lt;/span&gt; org.mockito.InOrder;

&lt;span style="color: #008000"&gt;// ä¹Ÿå¯ä»¥éªŒè¯è°ƒç”¨æ¬¡åº&lt;/span&gt;
List mocked1 = mock(List.class);
List mocked2 = mock(List.class);

mocked1.size();
mocked1.isEmpty();
mocked2.isEmpty();

&lt;span style="color: #008000"&gt;// ä¼šè®°å½• mocked1ã€mocked2 ä¸­æ–¹æ³•çš„è°ƒç”¨/äº¤äº’æ¬¡åºï¼Œè¦æ±‚ï¼šä¸ mocked1 çš„äº¤äº’å…ˆäº mocked2&lt;/span&gt;
InOrder inOrder = inOrder(mocked1, mocked2);
&lt;span style="color: #008000"&gt;// mocked1ã€mocked2 çš„äº¤äº’é¡ºåºå¿…é¡»å’Œ inOrder.verify ä¹‹é—´çš„é¡ºåºä¸€è‡´&lt;/span&gt;
inOrder.verify(mocked1).size();
inOrder.verify(mocked1).isEmpty();
inOrder.verify(mocked2).isEmpty();
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;hr&gt;
&lt;p&gt;ä¹Ÿå¯ä»¥éªŒè¯æŸä¸ªæ–¹æ³•è¢«è°ƒç”¨æ—¶æ‰€ä½¿ç”¨çš„å‚æ•°æ˜¯å¦ç¬¦åˆé¢„æœŸï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #0000ff"&gt;import&lt;/span&gt; org.mockito.ArgumentCaptor;

List mockedlist = mock(List.class);

Caller caller = &lt;span style="color: #0000ff"&gt;new&lt;/span&gt; Caller();
caller.setList(mockedlist);
caller.run();

&lt;span style="color: #008000"&gt;// æ•è· mockedList.add çš„è°ƒç”¨å‚æ•°&lt;/span&gt;
ArgumentCaptor&amp;lt;Integer&amp;gt; argumentCaptor = ArgumentCaptor.forClass(Integer.class);
verify(mockedlist).add(argumentCaptor.capture());
assertTrue(100 == argumentCaptor.getValue());

@Data
&lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #0000ff"&gt;class&lt;/span&gt; &lt;span style="color: #2b91af"&gt;Caller&lt;/span&gt; {
    List list;

    &lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #2b91af"&gt;void&lt;/span&gt; run() {
        list.add(100);
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;hr&gt;
&lt;p&gt;å‰é¢çš„å†…å®¹éƒ½æ˜¯ä»¥ mock ä¸ºä¾‹ï¼Œæˆ‘ä»¬å†æ¥è¯´è¯´ spyï¼Œä¸ mock çš„åŒºåˆ«ï¼š&lt;/p&gt;
&lt;p&gt;mock å‡ºæ¥çš„å¯¹è±¡æ˜¯ä¸€ä¸ªå®Œå…¨å‡çš„å¯¹è±¡ï¼Œä½† spy é€šå¸¸æ˜¯åŸºäºä¸€ä¸ªå…·ä½“çš„ç±»æˆ–ç±»å®ä¾‹ï¼Œå¯¹å…¶ç¯¡æ”¹æŸäº›æ–¹æ³•ï¼Œå¯¹äºè¢«ç¯¡æ”¹æ–¹æ³•ä¹‹å¤–çš„æ–¹æ³•ï¼Œå…¶è¡Œä¸ºéƒ½å’Œè°ƒç”¨çœŸå®å¯¹è±¡çš„æ–¹æ³•ä¸€æ ·ï¼Œä¸è¿‡å¹¶æ²¡æœ‰è°ƒç”¨çœŸå®å¯¹è±¡çš„æ–¹æ³•ï¼Œä¹Ÿä¸ä¼šå¯¹çœŸå®å¯¹è±¡äº§ç”Ÿå½±å“ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #008000"&gt;// åŸºäºä¸€ä¸ªå®é™…çš„ç±»å®ä¾‹&lt;/span&gt;
List&amp;lt;Integer&amp;gt; realList = &lt;span style="color: #0000ff"&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;(10);
List&amp;lt;Integer&amp;gt; spy = spy(realList);

spy.add(1);

&lt;span style="color: #008000"&gt;// è¢«çªƒå¬çš„å¯¹è±¡å¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–&lt;/span&gt;
assertEquals(0, realList.size());
&lt;span style="color: #008000"&gt;// é—´è°å¯¹è±¡ç¡®å®å°† 1 å­˜äº†ä¸‹æ¥&lt;/span&gt;
assertEquals(1, spy.size());
&lt;span style="color: #008000"&gt;// è¿™å¥ä¼šæŠ›å‡º java.lang.IndexOutOfBoundsExceptionï¼Œå› ä¸º realList è¿˜æ˜¯ä¸ºç©º&lt;/span&gt;
assertTrue(1 == realList.get(0));
assertTrue(1 == spy.get(0));
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¹Ÿå¯ä»¥åŸºäºä¸€ä¸ªå…·ä½“çš„ç±»æ¥æ„é€  spyï¼Œä½†è¿™æ ·æ— æ³•ä½¿ç”¨å¸¦å‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œä¹Ÿæ— æ³•æŒ‡å®šç±»å‹å‚æ•°ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;List&amp;lt;Integer&amp;gt; = spy(ArrayList.class);
assertEquals(0, spy.size());
spy.add(100);
assertEquals(1, spy.size());
assertTrue(100 == spy.get(0));

&lt;span style="color: #008000"&gt;// ç¯¡æ”¹æ–¹æ³•&lt;/span&gt;
when(spy.size()).thenReturn(-1);
assertEquals(-1, spy.size());
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å®é™…ä¸Šï¼Œmock ä¹Ÿå¯ä»¥åŸºäºå…·ä½“çš„ç±»æ¥æ„é€ ï¼Œè¿™æ—¶å¯ä»¥æŒ‡å®šæŸäº›æ–¹æ³•å®é™…è°ƒç”¨å…·ä½“ç±»çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;é™¤äº†ä½¿ç”¨ mockã€spy æ–¹æ³•æ¥æ„é€ æ¨¡æ‹Ÿå¯¹è±¡ï¼Œè¿˜å¯ä»¥é€šè¿‡æ³¨è§£æ¥æ„é€ ï¼Œä½†è¿™æ ·çš„è¯å¾—æŒ‡å®š JUnit çš„ Runner ä¸º &lt;code&gt;org.mockito.junit.MockitoJUnitRunner&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: #0000ff"&gt;import&lt;/span&gt; org.junit.Test;
&lt;span style="color: #0000ff"&gt;import&lt;/span&gt; org.junit.runner.RunWith;
&lt;span style="color: #0000ff"&gt;import&lt;/span&gt; org.mockito.Mock;
&lt;span style="color: #0000ff"&gt;import&lt;/span&gt; org.mockito.Spy;
&lt;span style="color: #0000ff"&gt;import&lt;/span&gt; org.mockito.junit.MockitoJUnitRunner;

&lt;span style="color: #0000ff"&gt;import&lt;/span&gt; java.util.ArrayList;
&lt;span style="color: #0000ff"&gt;import&lt;/span&gt; java.util.List;

&lt;span style="color: #0000ff"&gt;import static&lt;/span&gt; org.mockito.Mockito.when;
&lt;span style="color: #0000ff"&gt;import static&lt;/span&gt; org.junit.Assert.assertTrue;

@RunWith(MockitoJUnitRunner.class)
&lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #0000ff"&gt;class&lt;/span&gt; &lt;span style="color: #2b91af"&gt;testTester&lt;/span&gt; {

    @Mock
    &lt;span style="color: #0000ff"&gt;private&lt;/span&gt; List&amp;lt;Integer&amp;gt; mocked;

    @Spy
    &lt;span style="color: #0000ff"&gt;private&lt;/span&gt; ArrayList&amp;lt;Integer&amp;gt; spyed;

    @Test
    &lt;span style="color: #0000ff"&gt;public&lt;/span&gt; &lt;span style="color: #2b91af"&gt;void&lt;/span&gt; test() {
        when(mocked.isEmpty()).thenReturn(&lt;span style="color: #0000ff"&gt;false&lt;/span&gt;);
        when(spyed.isEmpty()).thenReturn(&lt;span style="color: #0000ff"&gt;false&lt;/span&gt;);

        assertTrue(!mocked.isEmpty());
        assertTrue(!spyed.isEmpty());

        mocked.add(0);
        spyed.add(0);

        assertTrue(0 == mocked.size());
        assertTrue(1 == spyed.size());
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="å…¶ä»–"></category><category term="Java"></category><category term="mockito"></category><category term="å•æµ‹"></category></entry><entry><title>ç¼–å†™æ¼‚äº®çš„ shell ä»£ç </title><link href="http://youngsterxyf.github.io/2018/05/16/beautiful-shell-code/" rel="alternate"></link><published>2018-05-16T00:00:00+08:00</published><updated>2018-05-16T00:00:00+08:00</updated><author><name>xiayf</name></author><id>tag:youngsterxyf.github.io,2018-05-16:/2018/05/16/beautiful-shell-code/</id><summary type="html">&lt;p&gt;ä½¿ç”¨ä¸‘é™‹çš„ç¼–ç¨‹è¯­è¨€ä¹Ÿèƒ½å†™å‡ºæ¼‚äº®çš„ä»£ç ã€‚&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;true_then_run() {
    condition=$1
    action=$2

    (&lt;span style="color: #a31515"&gt;${&lt;/span&gt;condition&lt;span style="color: #a31515"&gt;}&lt;/span&gt;)
    &lt;span style="color: #0000ff"&gt;if&lt;/span&gt; [ $? -eq 0 ]
    &lt;span style="color: #0000ff"&gt;then&lt;/span&gt;
        (&lt;span style="color: #a31515"&gt;${&lt;/span&gt;action&lt;span style="color: #a31515"&gt;}&lt;/span&gt;)
    &lt;span style="color: #0000ff"&gt;else&lt;/span&gt;
        echo &lt;span style="color: #a31515"&gt;&amp;quot;&amp;#39;&lt;/span&gt;$1&lt;span style="color: #a31515"&gt;&amp;#39; is false, don&amp;#39;t run &amp;#39;&lt;/span&gt;$2&lt;span style="color: #a31515"&gt;&amp;#39;&amp;quot;&lt;/span&gt;
    &lt;span style="color: #0000ff"&gt;fi&lt;/span&gt;
}

false_then_run() {
    condition=$1
    action=$2

    (&lt;span style="color: #a31515"&gt;${&lt;/span&gt;condition&lt;span style="color: #a31515"&gt;}&lt;/span&gt;)
    &lt;span style="color: #0000ff"&gt;if&lt;/span&gt; [ $? -ne 0 ]
    &lt;span style="color: #0000ff"&gt;then&lt;/span&gt;
        (&lt;span style="color: #a31515"&gt;${&lt;/span&gt;action â€¦&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;ä½¿ç”¨ä¸‘é™‹çš„ç¼–ç¨‹è¯­è¨€ä¹Ÿèƒ½å†™å‡ºæ¼‚äº®çš„ä»£ç ã€‚&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;true_then_run() {
    condition=$1
    action=$2

    (&lt;span style="color: #a31515"&gt;${&lt;/span&gt;condition&lt;span style="color: #a31515"&gt;}&lt;/span&gt;)
    &lt;span style="color: #0000ff"&gt;if&lt;/span&gt; [ $? -eq 0 ]
    &lt;span style="color: #0000ff"&gt;then&lt;/span&gt;
        (&lt;span style="color: #a31515"&gt;${&lt;/span&gt;action&lt;span style="color: #a31515"&gt;}&lt;/span&gt;)
    &lt;span style="color: #0000ff"&gt;else&lt;/span&gt;
        echo &lt;span style="color: #a31515"&gt;&amp;quot;&amp;#39;&lt;/span&gt;$1&lt;span style="color: #a31515"&gt;&amp;#39; is false, don&amp;#39;t run &amp;#39;&lt;/span&gt;$2&lt;span style="color: #a31515"&gt;&amp;#39;&amp;quot;&lt;/span&gt;
    &lt;span style="color: #0000ff"&gt;fi&lt;/span&gt;
}

false_then_run() {
    condition=$1
    action=$2

    (&lt;span style="color: #a31515"&gt;${&lt;/span&gt;condition&lt;span style="color: #a31515"&gt;}&lt;/span&gt;)
    &lt;span style="color: #0000ff"&gt;if&lt;/span&gt; [ $? -ne 0 ]
    &lt;span style="color: #0000ff"&gt;then&lt;/span&gt;
        (&lt;span style="color: #a31515"&gt;${&lt;/span&gt;action&lt;span style="color: #a31515"&gt;}&lt;/span&gt;)
    &lt;span style="color: #0000ff"&gt;else&lt;/span&gt;
        echo &lt;span style="color: #a31515"&gt;&amp;quot;&amp;#39;&lt;/span&gt;$1&lt;span style="color: #a31515"&gt;&amp;#39; is true, don&amp;#39;t run &amp;#39;&lt;/span&gt;$2&lt;span style="color: #a31515"&gt;&amp;#39;&amp;quot;&lt;/span&gt;
    &lt;span style="color: #0000ff"&gt;fi&lt;/span&gt;
}

map() {
    &lt;span style="color: #0000ff"&gt;for&lt;/span&gt; item &lt;span style="color: #0000ff"&gt;in&lt;/span&gt; $2
    &lt;span style="color: #0000ff"&gt;do&lt;/span&gt;
        ($1 &lt;span style="color: #a31515"&gt;${&lt;/span&gt;item&lt;span style="color: #a31515"&gt;}&lt;/span&gt;)
    &lt;span style="color: #0000ff"&gt;done&lt;/span&gt;
}

reduce() {
    operator=$1
    &lt;span style="color: #008000"&gt;#&lt;/span&gt;
    list=($2)
    list_len=&lt;span style="color: #a31515"&gt;${#&lt;/span&gt;list[@]&lt;span style="color: #a31515"&gt;}&lt;/span&gt;
    &lt;span style="color: #008000"&gt;#&lt;/span&gt;
    result=&lt;span style="color: #a31515"&gt;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span style="color: #0000ff"&gt;if&lt;/span&gt; [ &lt;span style="color: #a31515"&gt;${&lt;/span&gt;list_len&lt;span style="color: #a31515"&gt;}&lt;/span&gt; -gt 0 ]
    &lt;span style="color: #0000ff"&gt;then&lt;/span&gt;
        result=&lt;span style="color: #a31515"&gt;${&lt;/span&gt;list[0]&lt;span style="color: #a31515"&gt;}&lt;/span&gt;
    &lt;span style="color: #0000ff"&gt;fi&lt;/span&gt;
    &lt;span style="color: #008000"&gt;#&lt;/span&gt;
    &lt;span style="color: #0000ff"&gt;if&lt;/span&gt; [ &lt;span style="color: #a31515"&gt;${&lt;/span&gt;list_len&lt;span style="color: #a31515"&gt;}&lt;/span&gt; -gt 1 ]
    &lt;span style="color: #0000ff"&gt;then&lt;/span&gt;
        &lt;span style="color: #0000ff"&gt;for&lt;/span&gt; item &lt;span style="color: #0000ff"&gt;in&lt;/span&gt; &lt;span style="color: #a31515"&gt;${&lt;/span&gt;list[@]:1&lt;span style="color: #a31515"&gt;}&lt;/span&gt;
        &lt;span style="color: #0000ff"&gt;do&lt;/span&gt;
            result=&lt;span style="color: #0000ff"&gt;$(&lt;/span&gt;&lt;span style="color: #a31515"&gt;${&lt;/span&gt;operator&lt;span style="color: #a31515"&gt;}&lt;/span&gt; &lt;span style="color: #a31515"&gt;${&lt;/span&gt;result&lt;span style="color: #a31515"&gt;}&lt;/span&gt; &lt;span style="color: #a31515"&gt;${&lt;/span&gt;item&lt;span style="color: #a31515"&gt;}&lt;/span&gt;&lt;span style="color: #0000ff"&gt;)&lt;/span&gt;
        &lt;span style="color: #0000ff"&gt;done&lt;/span&gt;
    &lt;span style="color: #0000ff"&gt;fi&lt;/span&gt;
    echo &lt;span style="color: #a31515"&gt;${&lt;/span&gt;result&lt;span style="color: #a31515"&gt;}&lt;/span&gt;
}

filter() {
    &lt;span style="color: #0000ff"&gt;for&lt;/span&gt; item &lt;span style="color: #0000ff"&gt;in&lt;/span&gt; $2
    &lt;span style="color: #0000ff"&gt;do&lt;/span&gt;
        ($1 &lt;span style="color: #a31515"&gt;${&lt;/span&gt;item&lt;span style="color: #a31515"&gt;}&lt;/span&gt;)
        &lt;span style="color: #0000ff"&gt;if&lt;/span&gt; [ $? -eq 0 ]
        &lt;span style="color: #0000ff"&gt;then&lt;/span&gt;
            echo &lt;span style="color: #a31515"&gt;${&lt;/span&gt;item&lt;span style="color: #a31515"&gt;}&lt;/span&gt;
        &lt;span style="color: #0000ff"&gt;fi&lt;/span&gt;
    &lt;span style="color: #0000ff"&gt;done&lt;/span&gt;
}

sum() {
    v=0
    &lt;span style="color: #0000ff"&gt;for&lt;/span&gt; arg &lt;span style="color: #0000ff"&gt;in&lt;/span&gt; &lt;span style="color: #a31515"&gt;&amp;quot;&lt;/span&gt;$@&lt;span style="color: #a31515"&gt;&amp;quot;&lt;/span&gt;
    &lt;span style="color: #0000ff"&gt;do&lt;/span&gt;
        v=&lt;span style="color: #0000ff"&gt;$((&lt;/span&gt;$v+&lt;span style="color: #a31515"&gt;${&lt;/span&gt;arg&lt;span style="color: #a31515"&gt;}&lt;/span&gt;&lt;span style="color: #0000ff"&gt;))&lt;/span&gt;
    &lt;span style="color: #0000ff"&gt;done&lt;/span&gt;
    echo $v
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="å…¶ä»–"></category><category term="Bash"></category></entry><entry><title>é…ç½® Maven è‡ªåŠ¨åŒ–æ„å»º protobuf ä»£ç ä¾èµ–</title><link href="http://youngsterxyf.github.io/2018/05/14/maven-protobuf/" rel="alternate"></link><published>2018-05-14T00:00:00+08:00</published><updated>2018-05-14T00:00:00+08:00</updated><author><name>xiayf</name></author><id>tag:youngsterxyf.github.io,2018-05-14:/2018/05/14/maven-protobuf/</id><summary type="html">&lt;p&gt;1.pom.xml ä¸­æ·»åŠ å¦‚ä¸‹å±æ€§é…ç½®ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;properties&amp;gt;
    &lt;span style="color: #008000"&gt;&amp;lt;!-- protobuf paths --&amp;gt;&lt;/span&gt;
    &amp;lt;protobuf.input.directory&amp;gt;${project.basedir}/src/main/protobuf&amp;lt;/protobuf.input.directory&amp;gt;
    &amp;lt;protobuf.output.directory&amp;gt;${project.build.directory}/generated-sources&amp;lt;/protobuf.output.directory&amp;gt;
    &lt;span style="color: #008000"&gt;&amp;lt;!-- library versions --&amp;gt;&lt;/span&gt;
    &amp;lt;build-helper-maven-plugin.version&amp;gt;3.0.0&amp;lt;/build-helper-maven-plugin.version&amp;gt;
    &amp;lt;maven-antrun-plugin.version&amp;gt;1.8&amp;lt;/maven-antrun-plugin â€¦&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;1.pom.xml ä¸­æ·»åŠ å¦‚ä¸‹å±æ€§é…ç½®ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;properties&amp;gt;
    &lt;span style="color: #008000"&gt;&amp;lt;!-- protobuf paths --&amp;gt;&lt;/span&gt;
    &amp;lt;protobuf.input.directory&amp;gt;${project.basedir}/src/main/protobuf&amp;lt;/protobuf.input.directory&amp;gt;
    &amp;lt;protobuf.output.directory&amp;gt;${project.build.directory}/generated-sources&amp;lt;/protobuf.output.directory&amp;gt;
    &lt;span style="color: #008000"&gt;&amp;lt;!-- library versions --&amp;gt;&lt;/span&gt;
    &amp;lt;build-helper-maven-plugin.version&amp;gt;3.0.0&amp;lt;/build-helper-maven-plugin.version&amp;gt;
    &amp;lt;maven-antrun-plugin.version&amp;gt;1.8&amp;lt;/maven-antrun-plugin.version&amp;gt;
    &amp;lt;maven-dependency-plugin.version&amp;gt;3.0.2&amp;lt;/maven-dependency-plugin.version&amp;gt;
    &amp;lt;os-maven-plugin.version&amp;gt;1.5.0.Final&amp;lt;/os-maven-plugin.version&amp;gt;
    &amp;lt;protobuf.version&amp;gt;2.5.0&amp;lt;/protobuf.version&amp;gt;
&amp;lt;/properties&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;2.æ·»åŠ  protobuf-java åº“ä¾èµ–&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;dependencies&amp;gt;
    &amp;lt;dependency&amp;gt;
        &amp;lt;groupId&amp;gt;com.google.protobuf&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;protobuf-java&amp;lt;/artifactId&amp;gt;
        &amp;lt;version&amp;gt;${protobuf.version}&amp;lt;/version&amp;gt;
    &amp;lt;/dependency&amp;gt;
&amp;lt;/dependencies&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;3.æ·»åŠ  maven æ‰©å±•ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;build&amp;gt;
    &amp;lt;extensions&amp;gt;
        &lt;span style="color: #008000"&gt;&amp;lt;!-- provides os.detected.classifier (i.e. linux-x86_64, osx-x86_64) property --&amp;gt;&lt;/span&gt;
        &amp;lt;extension&amp;gt;
            &amp;lt;groupId&amp;gt;kr.motd.maven&amp;lt;/groupId&amp;gt;
            &amp;lt;artifactId&amp;gt;os-maven-plugin&amp;lt;/artifactId&amp;gt;
            &amp;lt;version&amp;gt;${os-maven-plugin.version}&amp;lt;/version&amp;gt;
        &amp;lt;/extension&amp;gt;
    &amp;lt;/extensions&amp;gt;
&amp;lt;/build&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;4.é…ç½®æ„å»ºæ’ä»¶ï¼š&lt;/p&gt;
&lt;div class="highlight" style="background: #ffffff"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;build&amp;gt;
    &amp;lt;plugins&amp;gt;
        &lt;span style="color: #008000"&gt;&amp;lt;!-- copy protoc binary into build directory --&amp;gt;&lt;/span&gt;
        &amp;lt;plugin&amp;gt;
            &amp;lt;groupId&amp;gt;org.apache.maven.plugins&amp;lt;/groupId&amp;gt;
            &amp;lt;artifactId&amp;gt;maven-dependency-plugin&amp;lt;/artifactId&amp;gt;
            &amp;lt;version&amp;gt;${maven-dependency-plugin.version}&amp;lt;/version&amp;gt;
            &amp;lt;executions&amp;gt;
                &amp;lt;execution&amp;gt;
                    &amp;lt;id&amp;gt;copy-protoc&amp;lt;/id&amp;gt;
                    &amp;lt;phase&amp;gt;generate-sources&amp;lt;/phase&amp;gt;
                    &amp;lt;goals&amp;gt;
                        &amp;lt;goal&amp;gt;copy&amp;lt;/goal&amp;gt;
                    &amp;lt;/goals&amp;gt;
                    &amp;lt;configuration&amp;gt;
                        &amp;lt;artifactItems&amp;gt;
                            &amp;lt;artifactItem&amp;gt;
                                &amp;lt;groupId&amp;gt;com.google.protobuf&amp;lt;/groupId&amp;gt;
                                &amp;lt;artifactId&amp;gt;protoc&amp;lt;/artifactId&amp;gt;
                                &amp;lt;version&amp;gt;${protobuf.version}&amp;lt;/version&amp;gt;
                                &amp;lt;classifier&amp;gt;${os.detected.classifier}&amp;lt;/classifier&amp;gt;
                                &amp;lt;type&amp;gt;exe&amp;lt;/type&amp;gt;
                                &amp;lt;overWrite&amp;gt;true&amp;lt;/overWrite&amp;gt;
                                &amp;lt;outputDirectory&amp;gt;${project.build.directory}&amp;lt;/outputDirectory&amp;gt;
                            &amp;lt;/artifactItem&amp;gt;
                        &amp;lt;/artifactItems&amp;gt;
                    &amp;lt;/configuration&amp;gt;
                &amp;lt;/execution&amp;gt;
            &amp;lt;/executions&amp;gt;
        &amp;lt;/plugin&amp;gt;
        &lt;span style="color: #008000"&gt;&amp;lt;!-- compile proto buffer files using copied protoc binary --&amp;gt;&lt;/span&gt;
        &amp;lt;plugin&amp;gt;
            &amp;lt;groupId&amp;gt;org.apache.maven.plugins&amp;lt;/groupId&amp;gt;
            &amp;lt;artifactId&amp;gt;maven-antrun-plugin&amp;lt;/artifactId&amp;gt;
            &amp;lt;version&amp;gt;${maven-antrun-plugin.version}&amp;lt;/version&amp;gt;
            &amp;lt;executions&amp;gt;
                &amp;lt;execution&amp;gt;
                    &amp;lt;id&amp;gt;exec-protoc&amp;lt;/id&amp;gt;
                    &amp;lt;phase&amp;gt;generate-sources&amp;lt;/phase&amp;gt;
                    &amp;lt;configuration&amp;gt;
                        &amp;lt;target&amp;gt;
                            &amp;lt;property name=&lt;span style="color: #a31515"&gt;&amp;quot;protoc.filename&amp;quot;&lt;/span&gt; value=&lt;span style="color: #a31515"&gt;&amp;quot;protoc-${protobuf.version}-${os.detected.classifier}.exe&amp;quot;&lt;/span&gt;/&amp;gt;
                            &amp;lt;property name=&lt;span style="color: #a31515"&gt;&amp;quot;protoc.filepath&amp;quot;&lt;/span&gt; value=&lt;span style="color: #a31515"&gt;&amp;quot;${project.build.directory}/${protoc.filename}&amp;quot;&lt;/span&gt;/&amp;gt;
                            &amp;lt;chmod file=&lt;span style="color: #a31515"&gt;&amp;quot;${protoc.filepath}&amp;quot;&lt;/span&gt; perm=&lt;span style="color: #a31515"&gt;&amp;quot;ugo+rx&amp;quot;&lt;/span&gt;/&amp;gt;
                            &amp;lt;mkdir dir=&lt;span style="color: #a31515"&gt;&amp;quot;${protobuf.output.directory}&amp;quot;&lt;/span&gt; /&amp;gt;
                            &amp;lt;path id=&lt;span style="color: #a31515"&gt;&amp;quot;protobuf.input.filepaths.path&amp;quot;&lt;/span&gt;&amp;gt;
                                &amp;lt;fileset dir=&lt;span style="color: #a31515"&gt;&amp;quot;${protobuf.input.directory}&amp;quot;&lt;/span&gt;&amp;gt;
                                    &amp;lt;include name=&lt;span style="color: #a31515"&gt;&amp;quot;**/*.proto&amp;quot;&lt;/span&gt;/&amp;gt;
                                &amp;lt;/fileset&amp;gt;
                            &amp;lt;/path&amp;gt;
                            &amp;lt;pathconvert pathsep=&lt;span style="color: #a31515"&gt;&amp;quot; &amp;quot;&lt;/span&gt; property=&lt;span style="color: #a31515"&gt;&amp;quot;protobuf.input.filepaths&amp;quot;&lt;/span&gt; refid=&lt;span style="color: #a31515"&gt;&amp;quot;protobuf.input.filepaths.path&amp;quot;&lt;/span&gt;/&amp;gt;
                            &amp;lt;exec executable=&lt;span style="color: #a31515"&gt;&amp;quot;${protoc.filepath}&amp;quot;&lt;/span&gt; failonerror=&lt;span style="color: #a31515"&gt;&amp;quot;true&amp;quot;&lt;/span&gt;&amp;gt;
                                &amp;lt;arg value=&lt;span style="color: #a31515"&gt;&amp;quot;-I&amp;quot;&lt;/span&gt;/&amp;gt;
                                &amp;lt;arg value=&lt;span style="color: #a31515"&gt;&amp;quot;${protobuf.input.directory}&amp;quot;&lt;/span&gt;/&amp;gt;
                                &amp;lt;arg value=&lt;span style="color: #a31515"&gt;&amp;quot;--java_out&amp;quot;&lt;/span&gt;/&amp;gt;
                                &amp;lt;arg value=&lt;span style="color: #a31515"&gt;&amp;quot;${protobuf.output.directory}&amp;quot;&lt;/span&gt;/&amp;gt;
                                &amp;lt;arg line=&lt;span style="color: #a31515"&gt;&amp;quot;${protobuf.input.filepaths}&amp;quot;&lt;/span&gt;/&amp;gt;
                            &amp;lt;/exec&amp;gt;
                        &amp;lt;/target&amp;gt;
                    &amp;lt;/configuration&amp;gt;
                    &amp;lt;goals&amp;gt;
                        &amp;lt;goal&amp;gt;run&amp;lt;/goal&amp;gt;
                    &amp;lt;/goals&amp;gt;
                &amp;lt;/execution&amp;gt;
            &amp;lt;/executions&amp;gt;
        &amp;lt;/plugin&amp;gt;
        &lt;span style="color: #008000"&gt;&amp;lt;!-- add generated proto buffer classes into the package --&amp;gt;&lt;/span&gt;
        &amp;lt;plugin&amp;gt;
            &amp;lt;groupId&amp;gt;org.codehaus.mojo&amp;lt;/groupId&amp;gt;
            &amp;lt;artifactId&amp;gt;build-helper-maven-plugin&amp;lt;/artifactId&amp;gt;
            &amp;lt;version&amp;gt;${build-helper-maven-plugin.version}&amp;lt;/version&amp;gt;
            &amp;lt;executions&amp;gt;
                &amp;lt;execution&amp;gt;
                    &amp;lt;id&amp;gt;add-classes&amp;lt;/id&amp;gt;
                    &amp;lt;phase&amp;gt;generate-sources&amp;lt;/phase&amp;gt;
                    &amp;lt;goals&amp;gt;
                        &amp;lt;goal&amp;gt;add-source&amp;lt;/goal&amp;gt;
                    &amp;lt;/goals&amp;gt;
                    &amp;lt;configuration&amp;gt;
                        &amp;lt;sources&amp;gt;
                            &amp;lt;source&amp;gt;${protobuf.output.directory}&amp;lt;/source&amp;gt;
                        &amp;lt;/sources&amp;gt;
                    &amp;lt;/configuration&amp;gt;
                &amp;lt;/execution&amp;gt;
            &amp;lt;/executions&amp;gt;
        &amp;lt;/plugin&amp;gt;
    &amp;lt;/plugins&amp;gt;
&amp;lt;/build&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;å‚è€ƒèµ„æ–™&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;http://vlkan.com/blog/post/2015/11/27/maven-protobuf/&lt;/p&gt;
&lt;p&gt;http://www.chendan.me/2017/07/02/maven-protobuf/&lt;/p&gt;</content><category term="å…¶ä»–"></category><category term="java"></category><category term="maven"></category><category term="protobuf"></category></entry><entry><title>ã€ŠPython ç¼–ç¨‹ä¹‹ç¾ã€‹è¯‘è€…åº</title><link href="http://youngsterxyf.github.io/2018/04/01/the-python-guide/" rel="alternate"></link><published>2018-04-01T00:00:00+08:00</published><updated>2018-04-01T00:00:00+08:00</updated><author><name>xiayf</name></author><id>tag:youngsterxyf.github.io,2018-04-01:/2018/04/01/the-python-guide/</id><summary type="html">&lt;p&gt;ä»æ¯•ä¸šè‡³ä»Šï¼Œåœ¨äº’è”ç½‘è¡Œä¸šä»äº‹è½¯ä»¶ç ”å‘å·¥ä½œï¼Œå°†è¿‘äº”å¹´ã€‚è¿™äº”å¹´é—´ï¼Œåšè¿‡åç«¯å¼€å‘ã€å‰ç«¯å¼€å‘ã€å¤§æ•°æ®å¤„ç†ç­‰ï¼Œä½¿ç”¨è¿‡çš„ç¼–ç¨‹è¯­ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;ä»æ¯•ä¸šè‡³ä»Šï¼Œåœ¨äº’è”ç½‘è¡Œä¸šä»äº‹è½¯ä»¶ç ”å‘å·¥ä½œï¼Œå°†è¿‘äº”å¹´ã€‚è¿™äº”å¹´é—´ï¼Œåšè¿‡åç«¯å¼€å‘ã€å‰ç«¯å¼€å‘ã€å¤§æ•°æ®å¤„ç†ç­‰ï¼Œä½¿ç”¨è¿‡çš„ç¼–ç¨‹è¯­è¨€åŒ…æ‹¬ï¼šPythonã€PHPã€Goã€Javaã€JavaScript ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;è™½è¯´ç¼–ç¨‹è¯­è¨€å„å¼‚ï¼Œä½†æˆ‘ä½¿ç”¨å®ƒä»¬æ¥å†™å„ç§é¡¹ç›®çš„ä»£ç å´ä¸€ç›´åšæŒä¸¤ç‚¹ï¼šä»£ç å¯è¯»æ€§å’Œè‡ªè§£é‡Šæ€§/è‡ªæ–‡æ¡£æ€§ï¼ˆself-documentationï¼‰ã€‚è¿™å¾ˆå¤§ç¨‹åº¦ä¸Šåº”è¯¥æ˜¯å—åˆ° Python è¯­è¨€è®¾è®¡å“²å­¦çš„å½±å“ - è¿½æ±‚ç®€å•æ˜“è¯»æ˜“æ‡‚çš„ä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;å¾ˆå¤šäººå¯èƒ½ä¼šè®¤ä¸ºè¿™ä¸¤ç‚¹å…¶å®æ˜¯ä¸€ç‚¹ - ä»£ç å¯è¯»æ€§ï¼Œä½†æˆ‘æƒ³åšç‚¹åŒºåˆ†ï¼šä»£ç å¯è¯»æ€§çªå‡ºå¯¹ä»£ç é˜…è¯»è€…è§†è§‰ä¸Šçš„å½±å“ï¼Œæ˜¯å¦å­˜åœ¨ä¸å¿…è¦çš„ç†è§£å¹²æ‰°ï¼Œæ¯”å¦‚ï¼šå¿…è¦çš„ç©ºè¡Œã€å˜é‡å®šä¹‰ä¸ä½¿ç”¨ä¹‹é—´çš„è·ç¦»ã€å‡½æ•°ä½“/é€»è¾‘åˆ†æ”¯æ˜¯å¦è¿‡é•¿ã€é€»è¾‘è¡¨è¾¾æ˜¯å¦ç›´è§‚ç­‰ç­‰ã€‚å¯è¯»æ€§é«˜çš„ä»£ç é€šå¸¸éƒ½éå¸¸æ¼‚äº®ã€èµå¿ƒæ‚¦ç›®ã€‚è‡ªè§£é‡Šæ€§ä»£ç åˆ™æ›´çªå‡ºè¯­ä¹‰å±‚é¢ï¼Œæ¯”å¦‚ï¼šå˜é‡åç§°/å‡½æ•°åç§°/ç±»åæ˜¯å¦æ°å½“ã€å‡½æ•°/æ–¹æ³•/API æ˜¯å¦å•ä¸€èŒè´£ã€å·¥ç¨‹ç›®å½•ç»“æ„/åŒ…/æ¨¡å—æ‹†åˆ†æ˜¯å¦ç¬¦åˆâ€œé«˜å†…èšä½è€¦åˆâ€åŸåˆ™ç­‰ç­‰ã€‚é•¿æœŸè¿½æ±‚è¿™ä¸¤ç‚¹ï¼Œå¯ä»¥æå¤§åœ°æå‡ä¸ªäººï¼Œç‰¹åˆ«æ˜¯å›¢é˜Ÿçš„å·¥ä½œæ•ˆç‡å’Œå·¥ä½œè´¨é‡ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ä¹¦ä½œè€… Kenneth Reitz äº 2011 å¹´å‘å¸ƒ Requests è¿™ä¸ª HTTP è¯·æ±‚å·¥å…·åº“ï¼Œæå‡ºâ€œfor humansâ€çš„ç†å¿µï¼Œå¼ºè°ƒè½¯ä»¶/å·¥å…·åº“åº”è¯¥å¯¹äººç±»å‹å¥½æ˜“ç”¨ï¼Œè¿™ä¸€ç†å¿µæœ¬è´¨ä¸Šæ˜¯å¯¹ Python å“²å­¦ï¼ˆç‰¹åˆ«æ˜¯ä¸Šè¿°ä¸¤ç‚¹ï¼‰çš„ä¸€ç§å¼•ç”³å’Œå‘æ‰¬ã€‚ä¹‹å Reitz åœ¨ä¸€äº› Pythonå¤§ä¼šä¸ŠåšæŠ€æœ¯åˆ†äº«ï¼Œå®£æ‰¬â€œfor humansâ€ç†å¿µï¼Œå¯¹ Python ç¤¾åŒºäº§ç”Ÿå·¨å¤§å½±å“ã€‚æˆ‘åœ¨ç¬¬ä¸€æ¬¡ç”¨è¿‡ Requests åº“ä¹‹åï¼Œä¾¿å¾ˆå°‘ä½¿ç”¨ Python æ ‡å‡†åº“ä¸­çš„ urllib å’Œ urllib2ï¼Œç°åœ¨æ ‡å‡†åº“æ–‡æ¡£ä¸­ä¹Ÿç‰¹åˆ«å»ºè®®å¼€å‘è€…ä½¿ç”¨ Requestsã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºå¯¹â€œfor humansâ€ç†å¿µçš„è®¤åŒï¼Œä¹Ÿå› ä¸ºç»å¸¸ä½¿ç”¨ Requestsï¼Œæ‰€ä»¥å½“ Reitz åœ¨ Github ä¸Šé‚€è¯·æˆ‘ç¿»è¯‘ Requests æ–‡æ¡£ä¸­æ–‡ç‰ˆæ—¶ï¼Œæˆ‘æ¬£ç„¶æ¥å—ï¼Œå’Œå¦ä¸€ä¸ª Python å¼€å‘è€…å…±åŒç¿»è¯‘äº† Requests æ–‡æ¡£çš„é¦–ä¸ªå®˜æ–¹ä¸­æ–‡ç¿»è¯‘ç‰ˆã€‚è¿™â€œå¦ä¸€ä¸ª Python å¼€å‘è€…â€ä¹Ÿå°±æ˜¯æœ¬ä¹¦çš„å¦ä¸€ä¸ªè¯‘è€…ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Reitz å‘èµ· â€œThe Hitchhiker's Guide to Python!â€ é¡¹ç›®ï¼ˆä¹Ÿå°±æ˜¯æœ¬ä¹¦çš„ç¤¾åŒºå¼€æºç‰ˆï¼‰åï¼Œæˆ‘ä¸€ç›´æŒç»­è·Ÿè¿›é˜…è¯»ï¼Œæ”¶è·å·¨å¤§ã€‚åæ¥å¾—çŸ¥è¿™æœ¬å¼€æºä¹¦ç±æ­£å¼å‡ºç‰ˆï¼Œæ¬£å–œè‹¥ç‹‚ï¼Œè¾—è½¬å’¨è¯¢å¤šäººï¼Œè”ç³»åˆ°åˆ˜çšè€å¸ˆ ï¼Œç”³è¯·äº†æœ¬ä¹¦çš„ç¿»è¯‘å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œåæ¥å‘ç°ç¿»è¯‘çš„å·¥ä½œé‡è¿œè¿œè¶…å‡ºé¢„ä¼°ï¼Œé™¤äº†ä¸ªäººçš„ä¸€äº›ä¸»è§‚åŸå› ï¼Œä¸»è¦å› ä¸ºæœ¬ä¹¦å†…å®¹çš„å¹¿åº¦å’Œæ·±åº¦ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¹¿åº¦ï¼šæœ¬ä¹¦ç”± Python ç¤¾åŒºæ•°ç™¾äººå…±åŒåˆ›ä½œè€Œæˆï¼Œå¯ä»¥è§†ä½œ Python å°ç™¾ç§‘å…¨ä¹¦ã€‚1-3ç« æŒ‡å¯¼è¯»è€…æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚é€‰æ‹©å®‰è£…é…ç½® Python ç‰ˆæœ¬/å‘è¡Œç‰ˆã€å¼€å‘ç¯å¢ƒç­‰ã€‚7-11ç« åˆ™é’ˆå¯¹ä¸åŒçš„åº”ç”¨åœºæ™¯ï¼Œä»å¤šä¸ªç»´åº¦ç”„é€‰å¯¹æ¯”äº†å¤§é‡çš„ Python åº“ï¼Œè¯»è€…å¯ä»¥â€œæŒ‰å›¾ç´¢éª¥â€åœ°åšå‡ºè‡ªå·±çš„é€‰æ‹©ï¼Œä»è€ŒèŠ‚çº¦å¤§é‡çš„æ—¶é—´ç²¾åŠ›ã€‚å› ä¸ºè¯‘è€…çš„ Python å¼€å‘ç»éªŒä¸»è¦é›†ä¸­åœ¨ Web å¼€å‘å’Œæ•°æ®å¤„ç†ï¼Œå¯¹äºå¾ˆå¤šåº”ç”¨åœºæ™¯ä¸‹çš„ Python åº“ä¸å¤ªç†Ÿæ‚‰ï¼Œæ‰€ä»¥ç¿»è¯‘ä¹‹å‰èŠ±è´¹äº†å¤§é‡æ—¶é—´æ¥å­¦ä¹ ç†è§£ã€‚&lt;/li&gt;
&lt;li&gt;æ·±åº¦ï¼šé’ˆå¯¹ Python ä¸­æ‰‹çš„æ ¸å¿ƒéœ€æ±‚ï¼Œæœ¬ä¹¦æ¢è®¨äº†å¤§é‡çš„æœ€ä½³å®è·µã€‚å…¶ä¸­4-5ç« é€šè¿‡å¤§é‡ç¤ºä¾‹å…·ä½“åœ°é˜é‡Šäº†â€œPython ä¹‹ç¦…â€çš„å¥å¥ç®´è¨€ï¼Œå¦‚ä½•ç¼–å†™é«˜è´¨é‡çš„ Python ä»£ç ï¼Œå¹¶ç²¾é€‰è‹¥å¹²é«˜è´¨é‡çš„çŸ¥å Python å¼€æºé¡¹ç›®ï¼Œè¯¦ç»†ä»‹ç»å¦‚ä½•é€šè¿‡é˜…è¯»æºç æ¥æå‡ç¼–ç¨‹æŠ€æœ¯æ°´å¹³ã€‚è™½è¯´ Python ç¤¾åŒºå‡ ä¹äººäººçš†çŸ¥â€œPython ä¹‹ç¦…â€ï¼Œä½†å¦‚ä½•è½åœ°åˆ°å¼€å‘å®è·µä¼°è®¡æå°‘æœ‰äººè¯´å¾—æ¸…æ¥šã€‚å¯¹ç…§ä¹¦ä¸­çš„å®ä¾‹é˜é‡Šï¼Œè¯‘è€…å‡ ç»è°ƒæ•´æ¨æ•²â€œPython ä¹‹ç¦…â€çš„è¯‘æ–‡ï¼Œæœ€ç»ˆæ•²å®šçš„è¯‘æ–‡ä¹Ÿä¸æ˜¯ç‰¹åˆ«ä»¤è‡ªå·±æ»¡æ„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç›¸æ¯”åŸè®¡åˆ’ï¼Œæœ¬ä¹¦æœ€ç»ˆå»¶æœŸè¿‘ä¸€å¹´æ‰å¾—ä»¥ç¿»è¯‘å®Œæˆã€‚é™¤äº†æ­‰æ„ï¼Œæˆ‘å†…å¿ƒæ»¡æ˜¯æ„Ÿè°¢ï¼šæ„Ÿè°¢é‚¦æ°ä¸­é€”å‹æƒ…åŠ å…¥ï¼Œå¸®å¿™ç¿»è¯‘äº†4-6ç« åˆç¨¿ï¼Œè¿™ä¸‰ç« çš„éš¾åº¦å’Œé•¿åº¦éƒ½éå¸¸å¤§ï¼›æ„Ÿè°¢ç¼–è¾‘è€å¸ˆåˆ˜çšå¯¹æˆ‘æ‹–ç¨¿çš„æ¬¡æ¬¡å®¹å¿å’Œè€å¿ƒç­‰å¾…ï¼›æ„Ÿè°¢å¦»å„¿çš„ç†è§£ï¼Œæˆ‘å¯¹ä½ ä»¬ç¼ºå°‘äº†å¤ªå¤šçš„é™ªä¼´ã€‚&lt;/p&gt;
&lt;p&gt;è™½è¯´æˆ‘å·²å°½è‡ªå·±æ‰€èƒ½åœ°ä¿è¯è¯‘æ–‡è´¨é‡ï¼Œä½†é”™è¯¯ç‘•ç–µéš¾å…ï¼Œåœ¨æ­¤ä¹Ÿè¯·è¯»è€…åŸè°…ã€‚å¸Œæœ›ä½ ä»¬é˜…è¯»æ„‰å¿«ï¼&lt;/p&gt;
&lt;p&gt;è‡³æ­¤ï¼Œæˆ‘å¦‚é‡Šé‡è´Ÿã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;å¤æ°¸é”‹&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;å†™äºä¸Šæµ·&lt;/em&gt;&lt;/p&gt;</content><category term="å…¶ä»–"></category><category term="ç¿»è¯‘"></category><category term="ä¹¦ç±"></category></entry></feed>