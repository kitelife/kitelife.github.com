<!DOCTYPE html>
<html lang="zh">
<head>

        <title>Yii源码阅读笔记 - 错误/异常处理</title>
        <meta charset="utf-8" />
        <link href="http://youngsterxyf.github.io/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="数据与智能 Full Atom Feed" />
        <link href="http://youngsterxyf.github.io/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="数据与智能 Full RSS Feed" />


        <!-- Mobile viewport optimized: j.mp/bplateviewport -->
        <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1">

        <link rel="stylesheet" type="text/css" href="../../../../theme/gumby.css" />
        <link rel="stylesheet" type="text/css" href="../../../../theme/style.css" />
        <link rel="stylesheet" type="text/css" href="../../../../theme/pygment.css" />
        <link rel="stylesheet" type="text/css" href="../../../../theme/hgxs/FZZJ-HGXSJW.css" />

        <script src="../../../../theme/js/libs/jquery-1.9.1.min.js"></script>
        <script src="../../../../theme/js/libs/modernizr-2.6.2.min.js"></script>
            <script>
              var _hmt = _hmt || [];
              (function() {
                var hm = document.createElement("script");
                hm.src = "//hm.baidu.com/hm.js?5c5d8c3fe75afeff117777b9236b96ec";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
              })();
            </script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
        <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
</head>

<body id="index" class="home">
    <div class="container">

        <div class="row">

          <header id="banner" class="body">
                  <h1 style='font-family: "FZZJ-HGXSJW";'><a href="../../../..">数据与智能 <strong></strong></a></h1>
          </header><!-- /#banner -->

            <div id="navigation" class="navbar row">
              <a href="#" gumby-trigger="#navigation &gt; ul" class="toggle"><i class="icon-menu"></i></a>

              <ul class="columns" style='font-family: "FZZJ-HGXSJW";'>
                <li><a href="../../../..">主 页</a></li>

                <li><a href="/archives.html">归 档</a></li>
                <li><a href="/pages/tech-share.html">技术分享</a></li>
                <li><a href="/pages/translation.html">技术翻译</a></li>
                <li><a href="/pages/ds.html">分布式</a></li>
                <li><a href="/pages/tools.html">工具集</a></li>
                <li><a href="/pages/links.html">链 接</a></li>
                <li><a href="/pages/aboutme.html">关于我</a></li>
                <li><a href="/feeds/rss.xml">RSS</a></li>

              </ul>
            </div>

<section id="content" class="body">
   <div class="row">
        <div class="columns">
            <header>
              <h2 class="entry-title">
                <a href="../../../../2015/09/14/read-yii-code-10/" rel="bookmark" title="Permalink to Yii源码阅读笔记 - 错误/异常处理">Yii源码阅读笔记 - 错误/异常处理</a></h2>
           
            </header>
            <footer class="post-info">
              <abbr class="published" title="2015-09-14T00:00:00+08:00">
                2015-09-14 一
              </abbr>
              <address class="vcard author">
                By <a class="url fn" href="../../../../author/youngsterxyf.html">youngsterxyf</a>
              </address>
            </footer><!-- /.post-info -->
            <div class="entry-content">
              <h3>概述</h3>
<p>PHP区分“错误”（Error）和“异常”（Exception）。“错误”通常是由PHP内部函数抛出，表示运行时问题，当然也可以通过函数<code>trigger_error</code>或<code>user_error</code>抛出一个用户级别的error/warning/notice信息。但在引入面向对象之后，相比使用<code>trigger_error</code>抛出错误，使用throw抛出异常更常用。</p>
<p>对于“错误”，PHP允许配置报告哪些级别/类型错误、是否（向用户）展示错误、是否对错误记录日志、错误日志记到哪，分别对应php.ini中的配置项：<code>error_reporting</code>、<code>display_errors</code>、<code>log_errors</code>、<code>error_log</code>。详细信息见<a href="http://php.net/manual/zh/language.errors.basics.php">这里</a>。</p>
<p>对于应用程序内层调用抛出的“异常”，一般可以在外层中使用try...catch来捕获并自定义处理过程。但对于“错误”（PHP运行时抛出或者应用程序使用trigger_error抛出的）或者对于-无法使用try...catch来捕获可能的异常/为了做到即使忘记捕获的异常也能得到自定义处理-的情况，该怎么办？对此，PHP提供了函数<code>set_error_handler</code>和<code>set_exception_handler</code>来注册错误/异常自定义处理过程。如果在程序的执行流中先后多次调用了<code>set_error_handler</code>或<code>set_exception_handler</code>，后一次注册的处理过程会覆盖前一次的，但可以通过函数<code>restore_error_handler</code>或<code>restore_exception_handler</code>来恢复前一次注册的异常处理过程。</p>
<p><em>之所以写这篇文章，是因为最近在工作中犯了一个低级错误：应用程序中有个API对于不合法的请求参数直接抛出异常（<code>throw new Exception("xxx")</code>），却忘了try...catch捕捉，导致异常被Yii框架（我们的应用基于Yii开发）通过set_exception_handler注册的方法处理 - 响应500，之后这个API被一个扫描器拼命扫，导致出现很多500响应，触发了告警。</em></p>
<h3>分析</h3>
<p>我们来看看Yii框架在哪个地方注册错误/异常处理过程？处理过程是什么样的？</p>
<p>Yii框架在请求处理初始化过程中，在<code>CApplication</code>类（见文件<code>base/CApplication.php</code>）的构造方法中调用了：</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #0000ff">&lt;?php</span>
$this-&gt;initSystemHandlers();
</code></pre></div>

<p><code>initSystemHandlers</code>的实现如下：</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #0000ff">&lt;?php</span>
<span style="color: #a31515">/**</span>
<span style="color: #a31515"> * Initializes the class autoloader and error handlers.</span>
<span style="color: #a31515"> */</span>
<span style="color: #0000ff">protected</span> <span style="color: #0000ff">function</span> initSystemHandlers()
{
    <span style="color: #008000">// 注：如果不想使用Yii框架注册的handleException，可以在初始化应用实例之前，定义常量YII_ENABLE_EXCEPTION_HANDLER值为false</span>
    <span style="color: #0000ff">if</span>(YII_ENABLE_EXCEPTION_HANDLER)
        set_exception_handler(<span style="color: #0000ff">array</span>($this,<span style="color: #a31515">&#39;handleException&#39;</span>));
    <span style="color: #008000">// 注：YII_ENABLE_ERROR_HANDLER也是如此</span>
    <span style="color: #0000ff">if</span>(YII_ENABLE_ERROR_HANDLER)
        set_error_handler(<span style="color: #0000ff">array</span>($this,<span style="color: #a31515">&#39;handleError&#39;</span>),error_reporting());
}
</code></pre></div>

<p>其中注册的方法<code>handleException</code>和<code>handleError</code>实现分别如下：</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #0000ff">&lt;?php</span>
<span style="color: #0000ff">public</span> <span style="color: #0000ff">function</span> handleException($exception)
{
    <span style="color: #008000">// disable error capturing to avoid recursive errors</span>
    <span style="color: #008000">// 这句注释是啥意思？</span>
    restore_error_handler();
    restore_exception_handler();

    <span style="color: #008000">// 生成并记录日志信息</span>
    $category=<span style="color: #a31515">&#39;exception.&#39;</span>.get_class($exception);
    <span style="color: #0000ff">if</span>($exception instanceof CHttpException)
        $category.=<span style="color: #a31515">&#39;.&#39;</span>.$exception-&gt;statusCode;
    <span style="color: #008000">// php &lt;5.2 doesn&#39;t support string conversion auto-magically</span>
    $message=$exception-&gt;__toString();
    <span style="color: #0000ff">if</span>(isset($_SERVER[<span style="color: #a31515">&#39;REQUEST_URI&#39;</span>]))
        $message.=<span style="color: #a31515">&quot;\nREQUEST_URI=&quot;</span>.$_SERVER[<span style="color: #a31515">&#39;REQUEST_URI&#39;</span>];
    <span style="color: #0000ff">if</span>(isset($_SERVER[<span style="color: #a31515">&#39;HTTP_REFERER&#39;</span>]))
        $message.=<span style="color: #a31515">&quot;\nHTTP_REFERER=&quot;</span>.$_SERVER[<span style="color: #a31515">&#39;HTTP_REFERER&#39;</span>];
    $message.=<span style="color: #a31515">&quot;\n---&quot;</span>;
    Yii::log($message,CLogger::LEVEL_ERROR,$category);

    <span style="color: #0000ff">try</span>
    {
        <span style="color: #008000">// 将异常封装成事件，并触发事件，从而触发监听该事件的处理过程</span>
        $event=<span style="color: #0000ff">new</span> CExceptionEvent($this,$exception);
        $this-&gt;onException($event);
        <span style="color: #008000">// 如果事件并没有被处理（即没有监听该事件的处理过程）或者所有处理过程都没有将事件的handled属性置为true，则还得自己处理一下</span>
        <span style="color: #0000ff">if</span>(!$event-&gt;handled)
        {
            <span style="color: #008000">// try an error handler</span>
            <span style="color: #0000ff">if</span>(($handler=$this-&gt;getErrorHandler())!==<span style="color: #0000ff">null</span>)
                $handler-&gt;handle($event);
            <span style="color: #0000ff">else</span>
                $this-&gt;displayException($exception);
        }
    }
    <span style="color: #0000ff">catch</span>(Exception $e)
    {
        $this-&gt;displayException($e);
    }

    <span style="color: #0000ff">try</span>
    {
        <span style="color: #008000">// 尝试触发onEndRequest事件</span>
        $this-&gt;end(1);
    }
    <span style="color: #0000ff">catch</span>(Exception $e)
    {
        <span style="color: #008000">// use the most primitive way to log error</span>
        $msg = get_class($e).<span style="color: #a31515">&#39;: &#39;</span>.$e-&gt;getMessage().<span style="color: #a31515">&#39; (&#39;</span>.$e-&gt;getFile().<span style="color: #a31515">&#39;:&#39;</span>.$e-&gt;getLine().<span style="color: #a31515">&quot;)\n&quot;</span>;
        $msg .= $e-&gt;getTraceAsString().<span style="color: #a31515">&quot;\n&quot;</span>;
        $msg .= <span style="color: #a31515">&quot;Previous exception:\n&quot;</span>;
        $msg .= get_class($exception).<span style="color: #a31515">&#39;: &#39;</span>.$exception-&gt;getMessage().<span style="color: #a31515">&#39; (&#39;</span>.$exception-&gt;getFile().<span style="color: #a31515">&#39;:&#39;</span>.$exception-&gt;getLine().<span style="color: #a31515">&quot;)\n&quot;</span>;
        $msg .= $exception-&gt;getTraceAsString().<span style="color: #a31515">&quot;\n&quot;</span>;
        $msg .= <span style="color: #a31515">&#39;$_SERVER=&#39;</span>.var_export($_SERVER,<span style="color: #0000ff">true</span>);
        error_log($msg);
        <span style="color: #0000ff">exit</span>(1);
    }
}
</code></pre></div>

<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #0000ff">&lt;?php</span>
<span style="color: #0000ff">public</span> <span style="color: #0000ff">function</span> handleError($code,$message,$file,$line)
{
    <span style="color: #0000ff">if</span>($code &amp; error_reporting())
    {
        <span style="color: #008000">// disable error capturing to avoid recursive errors</span>
        restore_error_handler();
        restore_exception_handler();

        <span style="color: #008000">// 生成并记录日志信息</span>
        $log=<span style="color: #a31515">&quot;$message ($file:$line)\nStack trace:\n&quot;</span>;

        <span style="color: #008000">// debug_backtrace() 产生一条 PHP 的回溯跟踪</span>
        $trace=debug_backtrace();
        <span style="color: #008000">// skip the first 3 stacks as they do not tell the error position</span>
        <span style="color: #0000ff">if</span>(count($trace)&gt;3)
            $trace=array_slice($trace,3);
        <span style="color: #0000ff">foreach</span>($trace <span style="color: #0000ff">as</span> $i=&gt;$t)
        {
            <span style="color: #0000ff">if</span>(!isset($t[<span style="color: #a31515">&#39;file&#39;</span>]))
                $t[<span style="color: #a31515">&#39;file&#39;</span>]=<span style="color: #a31515">&#39;unknown&#39;</span>;
            <span style="color: #0000ff">if</span>(!isset($t[<span style="color: #a31515">&#39;line&#39;</span>]))
                $t[<span style="color: #a31515">&#39;line&#39;</span>]=0;
            <span style="color: #0000ff">if</span>(!isset($t[<span style="color: #a31515">&#39;function&#39;</span>]))
                $t[<span style="color: #a31515">&#39;function&#39;</span>]=<span style="color: #a31515">&#39;unknown&#39;</span>;
            $log.=<span style="color: #a31515">&quot;#$i {</span>$t[<span style="color: #a31515">&#39;file&#39;</span>]<span style="color: #a31515">}({</span>$t[<span style="color: #a31515">&#39;line&#39;</span>]<span style="color: #a31515">}): &quot;</span>;
            <span style="color: #0000ff">if</span>(isset($t[<span style="color: #a31515">&#39;object&#39;</span>]) &amp;&amp; is_object($t[<span style="color: #a31515">&#39;object&#39;</span>]))
                $log.=get_class($t[<span style="color: #a31515">&#39;object&#39;</span>]).<span style="color: #a31515">&#39;-&gt;&#39;</span>;
            $log.=<span style="color: #a31515">&quot;{</span>$t[<span style="color: #a31515">&#39;function&#39;</span>]<span style="color: #a31515">}()\n&quot;</span>;
        }
        <span style="color: #0000ff">if</span>(isset($_SERVER[<span style="color: #a31515">&#39;REQUEST_URI&#39;</span>]))
            $log.=<span style="color: #a31515">&#39;REQUEST_URI=&#39;</span>.$_SERVER[<span style="color: #a31515">&#39;REQUEST_URI&#39;</span>];
        Yii::log($log,CLogger::LEVEL_ERROR,<span style="color: #a31515">&#39;php&#39;</span>);

        <span style="color: #0000ff">try</span>
        {
            <span style="color: #008000">// 将错误封装成事件，并触发</span>
            Yii::import(<span style="color: #a31515">&#39;CErrorEvent&#39;</span>,<span style="color: #0000ff">true</span>);
            $event=<span style="color: #0000ff">new</span> CErrorEvent($this,$code,$message,$file,$line);
            $this-&gt;onError($event);
            <span style="color: #008000">// 如果错误事件未被处理</span>
            <span style="color: #0000ff">if</span>(!$event-&gt;handled)
            {
                <span style="color: #008000">// try an error handler</span>
                <span style="color: #0000ff">if</span>(($handler=$this-&gt;getErrorHandler())!==<span style="color: #0000ff">null</span>)
                    $handler-&gt;handle($event);
                <span style="color: #0000ff">else</span>
                    $this-&gt;displayError($code,$message,$file,$line);
            }
        }
        <span style="color: #0000ff">catch</span>(Exception $e)
        {
            $this-&gt;displayException($e);
        }

        <span style="color: #0000ff">try</span>
        {
            <span style="color: #008000">// 尝试触发onEndRequest事件</span>
            $this-&gt;end(1);
        }
        <span style="color: #0000ff">catch</span>(Exception $e)
        {
            <span style="color: #008000">// use the most primitive way to log error</span>
            $msg = get_class($e).<span style="color: #a31515">&#39;: &#39;</span>.$e-&gt;getMessage().<span style="color: #a31515">&#39; (&#39;</span>.$e-&gt;getFile().<span style="color: #a31515">&#39;:&#39;</span>.$e-&gt;getLine().<span style="color: #a31515">&quot;)\n&quot;</span>;
            $msg .= $e-&gt;getTraceAsString().<span style="color: #a31515">&quot;\n&quot;</span>;
            $msg .= <span style="color: #a31515">&quot;Previous error:\n&quot;</span>;
            $msg .= $log.<span style="color: #a31515">&quot;\n&quot;</span>;
            $msg .= <span style="color: #a31515">&#39;$_SERVER=&#39;</span>.var_export($_SERVER,<span style="color: #0000ff">true</span>);
            error_log($msg);
            <span style="color: #0000ff">exit</span>(1);
        }
    }
}
</code></pre></div>

<p>从上面代码可以看到，方法<code>handleException</code>的关键部分（<code>handleError</code>类似）为：</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #0000ff">&lt;?php</span>
<span style="color: #008000">// 将异常封装成事件，并触发事件，从而触发监听该事件的处理过程</span>
$event=<span style="color: #0000ff">new</span> CExceptionEvent($this,$exception);
$this-&gt;onException($event);
<span style="color: #008000">// 如果事件并没有被处理（即没有监听该事件的处理过程）或者所有处理过程都没有将事件的handled属性置为true，则还得自己处理一下</span>
<span style="color: #0000ff">if</span>(!$event-&gt;handled)
{
    <span style="color: #008000">// try an error handler</span>
    <span style="color: #0000ff">if</span>(($handler=$this-&gt;getErrorHandler())!==<span style="color: #0000ff">null</span>)
        $handler-&gt;handle($event);
    <span style="color: #0000ff">else</span>
        $this-&gt;displayException($exception);
}
</code></pre></div>

<p>其中方法<code>onException</code>的实现如下：</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #0000ff">&lt;?php</span>
<span style="color: #0000ff">public</span> <span style="color: #0000ff">function</span> onException($event)
{
    $this-&gt;raiseEvent(<span style="color: #a31515">&#39;onException&#39;</span>,$event);
}
</code></pre></div>

<p><code>raiseEvent</code>方法实现如下：</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #0000ff">&lt;?php</span>
<span style="color: #0000ff">public</span> <span style="color: #0000ff">function</span> raiseEvent($name,$event)
{
    <span style="color: #008000">// 根据事件名称，如onException，找到注册到该事件的处理过程，逐个触发调用。</span>
    <span style="color: #008000">// 所有该事件注册的处理过程存放在$this-&gt;_e[$name]中</span>
    $name=strtolower($name);
    <span style="color: #0000ff">if</span>(isset($this-&gt;_e[$name]))
    {
        <span style="color: #0000ff">foreach</span>($this-&gt;_e[$name] <span style="color: #0000ff">as</span> $handler)
        {
            <span style="color: #0000ff">if</span>(is_string($handler))
                call_user_func($handler,$event);
            <span style="color: #0000ff">elseif</span>(is_callable($handler,<span style="color: #0000ff">true</span>))
            {
                <span style="color: #0000ff">if</span>(is_array($handler))
                {
                    <span style="color: #008000">// an array: 0 - object, 1 - method name</span>
                    <span style="color: #0000ff">list</span>($object,$method)=$handler;
                    <span style="color: #0000ff">if</span>(is_string($object))  <span style="color: #008000">// static method call</span>
                        call_user_func($handler,$event);
                    <span style="color: #0000ff">elseif</span>(method_exists($object,$method))
                        $object-&gt;$method($event);
                    <span style="color: #0000ff">else</span>
                        <span style="color: #0000ff">throw</span> <span style="color: #0000ff">new</span> CException(Yii::t(<span style="color: #a31515">&#39;yii&#39;</span>,<span style="color: #a31515">&#39;Event &quot;{class}.{event}&quot; is attached with an invalid handler &quot;{handler}&quot;.&#39;</span>,
                            <span style="color: #0000ff">array</span>(<span style="color: #a31515">&#39;{class}&#39;</span>=&gt;get_class($this), <span style="color: #a31515">&#39;{event}&#39;</span>=&gt;$name, <span style="color: #a31515">&#39;{handler}&#39;</span>=&gt;$handler[1])));
                }
                <span style="color: #0000ff">else</span> <span style="color: #008000">// PHP 5.3: anonymous function</span>
                    call_user_func($handler,$event);
            }
            <span style="color: #0000ff">else</span>
                <span style="color: #0000ff">throw</span> <span style="color: #0000ff">new</span> CException(Yii::t(<span style="color: #a31515">&#39;yii&#39;</span>,<span style="color: #a31515">&#39;Event &quot;{class}.{event}&quot; is attached with an invalid handler &quot;{handler}&quot;.&#39;</span>,
                    <span style="color: #0000ff">array</span>(<span style="color: #a31515">&#39;{class}&#39;</span>=&gt;get_class($this), <span style="color: #a31515">&#39;{event}&#39;</span>=&gt;$name, <span style="color: #a31515">&#39;{handler}&#39;</span>=&gt;gettype($handler))));
            <span style="color: #008000">// stop further handling if param.handled is set true</span>
            <span style="color: #0000ff">if</span>(($event instanceof CEvent) &amp;&amp; $event-&gt;handled)
                <span style="color: #0000ff">return</span>;
        }
    }
    <span style="color: #0000ff">elseif</span>(YII_DEBUG &amp;&amp; !$this-&gt;hasEvent($name))
        <span style="color: #0000ff">throw</span> <span style="color: #0000ff">new</span> CException(Yii::t(<span style="color: #a31515">&#39;yii&#39;</span>,<span style="color: #a31515">&#39;Event &quot;{class}.{event}&quot; is not defined.&#39;</span>,
            <span style="color: #0000ff">array</span>(<span style="color: #a31515">&#39;{class}&#39;</span>=&gt;get_class($this), <span style="color: #a31515">&#39;{event}&#39;</span>=&gt;$name)));
}
</code></pre></div>

<p>那么是如何注册事件的处理过程的呢？</p>
<p>在类<code>CComponent</code>（见文件<code>base/CComponent.php</code>，<code>CApplication</code>类间接继承自该类）中定义了一对方法：<code>attachEventHandler</code>（将处理过程绑定到某事件）和<code>detachEventHandler</code>（将处理过程从事件解绑）。</p>
<p>方法<code>attachEventHandler</code>的实现如下：</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #0000ff">&lt;?php</span>
<span style="color: #0000ff">public</span> <span style="color: #0000ff">function</span> attachEventHandler($name,$handler)
{
    $this-&gt;getEventHandlers($name)-&gt;add($handler);
}
</code></pre></div>

<p>其中<code>getEventHandlers</code>实现如下：</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #0000ff">&lt;?php</span>
<span style="color: #0000ff">public</span> <span style="color: #0000ff">function</span> getEventHandlers($name)
{
    <span style="color: #008000">// 可以关注一下方法hasEvent</span>
    <span style="color: #008000">// 检查是否存在$name对应的事件</span>
    <span style="color: #0000ff">if</span>($this-&gt;hasEvent($name))
    {
        $name=strtolower($name);
        <span style="color: #0000ff">if</span>(!isset($this-&gt;_e[$name]))
            $this-&gt;_e[$name]=<span style="color: #0000ff">new</span> CList;
        <span style="color: #008000">// 返回对应事件的处理过程列表</span>
        <span style="color: #0000ff">return</span> $this-&gt;_e[$name];
    }
    <span style="color: #0000ff">else</span>
        <span style="color: #0000ff">throw</span> <span style="color: #0000ff">new</span> CException(Yii::t(<span style="color: #a31515">&#39;yii&#39;</span>,<span style="color: #a31515">&#39;Event &quot;{class}.{event}&quot; is not defined.&#39;</span>,
            <span style="color: #0000ff">array</span>(<span style="color: #a31515">&#39;{class}&#39;</span>=&gt;get_class($this), <span style="color: #a31515">&#39;{event}&#39;</span>=&gt;$name)));
}
</code></pre></div>

<p>回到“方法<code>handleException</code>的关键部分”，在事件的handled属性没有置为true的情况下，会调用方法<code>getErrorHandler</code>取到内置的一个处理过程，该方法实现如下：</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #0000ff">&lt;?php</span>
<span style="color: #0000ff">public</span> <span style="color: #0000ff">function</span> getErrorHandler()
{
    <span style="color: #008000">// 获取名为errorHandler的组件，该组件默认会在CApplication类的registerCoreComponents方法中注册，</span>
    <span style="color: #008000">// 见http://blog.xiayf.cn/2014/11/13/read-yii-code-3/一文的说明</span>
    <span style="color: #0000ff">return</span> $this-&gt;getComponent(<span style="color: #a31515">&#39;errorHandler&#39;</span>);
}
</code></pre></div>

<p>名为errorHandler的组件默认为类<code>CErrorHandler</code>（见文件<code>base/CErrorHandler.php</code>），当然也可以配置覆盖默认行为。</p>
<p><code>CErrorHandler</code>类的<code>handle</code>方法实现如下：</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #0000ff">&lt;?php</span>
<span style="color: #0000ff">public</span> <span style="color: #0000ff">function</span> handle($event)
{
    <span style="color: #008000">// set event as handled to prevent it from being handled by other event handlers</span>
    $event-&gt;handled=<span style="color: #0000ff">true</span>;

    <span style="color: #0000ff">if</span>($this-&gt;discardOutput)
    {
        $gzHandler=<span style="color: #0000ff">false</span>;
        <span style="color: #0000ff">foreach</span>(ob_list_handlers() <span style="color: #0000ff">as</span> $h)
        {
            <span style="color: #0000ff">if</span>(strpos($h,<span style="color: #a31515">&#39;gzhandler&#39;</span>)!==<span style="color: #0000ff">false</span>)
                $gzHandler=<span style="color: #0000ff">true</span>;
        }
        <span style="color: #008000">// the following manual level counting is to deal with zlib.output_compression set to On</span>
        <span style="color: #008000">// for an output buffer created by zlib.output_compression set to On ob_end_clean will fail</span>
        <span style="color: #0000ff">for</span>($level=ob_get_level();$level&gt;0;--$level)
        {
            <span style="color: #0000ff">if</span>(!@ob_end_clean())
                ob_clean();
        }
        <span style="color: #008000">// reset headers in case there was an ob_start(&quot;ob_gzhandler&quot;) before</span>
        <span style="color: #0000ff">if</span>($gzHandler &amp;&amp; !headers_sent() &amp;&amp; ob_list_handlers()===<span style="color: #0000ff">array</span>())
        {
            <span style="color: #0000ff">if</span>(function_exists(<span style="color: #a31515">&#39;header_remove&#39;</span>)) <span style="color: #008000">// php &gt;= 5.3</span>
            {
                header_remove(<span style="color: #a31515">&#39;Vary&#39;</span>);
                header_remove(<span style="color: #a31515">&#39;Content-Encoding&#39;</span>);
            }
            <span style="color: #0000ff">else</span>
            {
                header(<span style="color: #a31515">&#39;Vary:&#39;</span>);
                header(<span style="color: #a31515">&#39;Content-Encoding:&#39;</span>);
            }
        }
    }

    <span style="color: #008000">// 异常和错误都可以调用handle方法</span>
    <span style="color: #0000ff">if</span>($event instanceof CExceptionEvent)
        $this-&gt;handleException($event-&gt;exception);
    <span style="color: #0000ff">else</span> <span style="color: #008000">// CErrorEvent</span>
        $this-&gt;handleError($event);
}
</code></pre></div>

<p>其中方法<code>handleException</code>和<code>handleError</code>实现分别如下：</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #0000ff">&lt;?php</span>
<span style="color: #0000ff">protected</span> <span style="color: #0000ff">function</span> handleException($exception)
{
    $app=Yii::app();
    <span style="color: #008000">// 如果是Web应用</span>
    <span style="color: #0000ff">if</span>($app instanceof CWebApplication)
    {
        <span style="color: #0000ff">if</span>(($trace=$this-&gt;getExactTrace($exception))===<span style="color: #0000ff">null</span>)
        {
            $fileName=$exception-&gt;getFile();
            $errorLine=$exception-&gt;getLine();
        }
        <span style="color: #0000ff">else</span>
        {
            $fileName=$trace[<span style="color: #a31515">&#39;file&#39;</span>];
            $errorLine=$trace[<span style="color: #a31515">&#39;line&#39;</span>];
        }

        $trace = $exception-&gt;getTrace();

        <span style="color: #0000ff">foreach</span>($trace <span style="color: #0000ff">as</span> $i=&gt;$t)
        {
            <span style="color: #0000ff">if</span>(!isset($t[<span style="color: #a31515">&#39;file&#39;</span>]))
                $trace[$i][<span style="color: #a31515">&#39;file&#39;</span>]=<span style="color: #a31515">&#39;unknown&#39;</span>;

            <span style="color: #0000ff">if</span>(!isset($t[<span style="color: #a31515">&#39;line&#39;</span>]))
                $trace[$i][<span style="color: #a31515">&#39;line&#39;</span>]=0;

            <span style="color: #0000ff">if</span>(!isset($t[<span style="color: #a31515">&#39;function&#39;</span>]))
                $trace[$i][<span style="color: #a31515">&#39;function&#39;</span>]=<span style="color: #a31515">&#39;unknown&#39;</span>;

            unset($trace[$i][<span style="color: #a31515">&#39;object&#39;</span>]);
        }

        $this-&gt;_error=$data=<span style="color: #0000ff">array</span>(
            <span style="color: #008000">// 如果抛出的异常是CHttpException类型，使用该异常自身的statusCode作为HTTP响应码，否则HTTP响应码为500</span>
            <span style="color: #008000">// 所以在有意让Yii框架来处理抛出的异常时，需要明确指定异常的类型！</span>
            <span style="color: #a31515">&#39;code&#39;</span>=&gt;($exception instanceof CHttpException)?$exception-&gt;statusCode:500,
            <span style="color: #a31515">&#39;type&#39;</span>=&gt;get_class($exception),
            <span style="color: #a31515">&#39;errorCode&#39;</span>=&gt;$exception-&gt;getCode(),
            <span style="color: #a31515">&#39;message&#39;</span>=&gt;$exception-&gt;getMessage(),
            <span style="color: #a31515">&#39;file&#39;</span>=&gt;$fileName,
            <span style="color: #a31515">&#39;line&#39;</span>=&gt;$errorLine,
            <span style="color: #a31515">&#39;trace&#39;</span>=&gt;$exception-&gt;getTraceAsString(),
            <span style="color: #a31515">&#39;traces&#39;</span>=&gt;$trace,
        );

        <span style="color: #0000ff">if</span>(!headers_sent())
            header(<span style="color: #a31515">&quot;HTTP/1.0 {</span>$data[<span style="color: #a31515">&#39;code&#39;</span>]<span style="color: #a31515">} &quot;</span>.$this-&gt;getHttpHeader($data[<span style="color: #a31515">&#39;code&#39;</span>], get_class($exception)));

        <span style="color: #008000">// 判断异常类型</span>
        <span style="color: #008000">// 对于CHttpException，也按照error来处理</span>
        <span style="color: #0000ff">if</span>($exception instanceof CHttpException || !YII_DEBUG)
            $this-&gt;render(<span style="color: #a31515">&#39;error&#39;</span>,$data);
        <span style="color: #0000ff">else</span>
        {
            <span style="color: #0000ff">if</span>($this-&gt;isAjaxRequest())
                $app-&gt;displayException($exception);
            <span style="color: #0000ff">else</span>
                $this-&gt;render(<span style="color: #a31515">&#39;exception&#39;</span>,$data);
        }
    }
    <span style="color: #008000">// 如果是终端应用（console application），则直接展示异常</span>
    <span style="color: #0000ff">else</span>
        $app-&gt;displayException($exception);
}
</code></pre></div>

<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #0000ff">&lt;?php</span>
<span style="color: #0000ff">protected</span> <span style="color: #0000ff">function</span> handleError($event)
{
    $trace=debug_backtrace();
    <span style="color: #008000">// skip the first 3 stacks as they do not tell the error position</span>
    <span style="color: #0000ff">if</span>(count($trace)&gt;3)
        $trace=array_slice($trace,3);
    $traceString=<span style="color: #a31515">&#39;&#39;</span>;
    <span style="color: #0000ff">foreach</span>($trace <span style="color: #0000ff">as</span> $i=&gt;$t)
    {
        <span style="color: #0000ff">if</span>(!isset($t[<span style="color: #a31515">&#39;file&#39;</span>]))
            $trace[$i][<span style="color: #a31515">&#39;file&#39;</span>]=<span style="color: #a31515">&#39;unknown&#39;</span>;

        <span style="color: #0000ff">if</span>(!isset($t[<span style="color: #a31515">&#39;line&#39;</span>]))
            $trace[$i][<span style="color: #a31515">&#39;line&#39;</span>]=0;

        <span style="color: #0000ff">if</span>(!isset($t[<span style="color: #a31515">&#39;function&#39;</span>]))
            $trace[$i][<span style="color: #a31515">&#39;function&#39;</span>]=<span style="color: #a31515">&#39;unknown&#39;</span>;

        $traceString.=<span style="color: #a31515">&quot;#$i {</span>$trace[$i][<span style="color: #a31515">&#39;file&#39;</span>]<span style="color: #a31515">}({</span>$trace[$i][<span style="color: #a31515">&#39;line&#39;</span>]<span style="color: #a31515">}): &quot;</span>;
        <span style="color: #0000ff">if</span>(isset($t[<span style="color: #a31515">&#39;object&#39;</span>]) &amp;&amp; is_object($t[<span style="color: #a31515">&#39;object&#39;</span>]))
            $traceString.=get_class($t[<span style="color: #a31515">&#39;object&#39;</span>]).<span style="color: #a31515">&#39;-&gt;&#39;</span>;
        $traceString.=<span style="color: #a31515">&quot;{</span>$trace[$i][<span style="color: #a31515">&#39;function&#39;</span>]<span style="color: #a31515">}()\n&quot;</span>;

        unset($trace[$i][<span style="color: #a31515">&#39;object&#39;</span>]);
    }

    $app=Yii::app();
    <span style="color: #008000">// 如果是Web应用</span>
    <span style="color: #0000ff">if</span>($app instanceof CWebApplication)
    {
        <span style="color: #008000">// 判断错误类型</span>
        <span style="color: #0000ff">switch</span>($event-&gt;code)
        {
            <span style="color: #0000ff">case</span> <span style="color: #0000ff">E_WARNING</span>:
                $type = <span style="color: #a31515">&#39;PHP warning&#39;</span>;
                <span style="color: #0000ff">break</span>;
            <span style="color: #0000ff">case</span> E_NOTICE:
                $type = <span style="color: #a31515">&#39;PHP notice&#39;</span>;
                <span style="color: #0000ff">break</span>;
            <span style="color: #0000ff">case</span> E_USER_ERROR:
                $type = <span style="color: #a31515">&#39;User error&#39;</span>;
                <span style="color: #0000ff">break</span>;
            <span style="color: #0000ff">case</span> E_USER_WARNING:
                $type = <span style="color: #a31515">&#39;User warning&#39;</span>;
                <span style="color: #0000ff">break</span>;
            <span style="color: #0000ff">case</span> E_USER_NOTICE:
                $type = <span style="color: #a31515">&#39;User notice&#39;</span>;
                <span style="color: #0000ff">break</span>;
            <span style="color: #0000ff">case</span> E_RECOVERABLE_ERROR:
                $type = <span style="color: #a31515">&#39;Recoverable error&#39;</span>;
                <span style="color: #0000ff">break</span>;
            <span style="color: #0000ff">default</span>:
                $type = <span style="color: #a31515">&#39;PHP error&#39;</span>;
        }
        <span style="color: #008000">// HTTP响应码为500</span>
        $this-&gt;_error=$data=<span style="color: #0000ff">array</span>(
            <span style="color: #a31515">&#39;code&#39;</span>=&gt;500,
            <span style="color: #a31515">&#39;type&#39;</span>=&gt;$type,
            <span style="color: #a31515">&#39;message&#39;</span>=&gt;$event-&gt;message,
            <span style="color: #a31515">&#39;file&#39;</span>=&gt;$event-&gt;file,
            <span style="color: #a31515">&#39;line&#39;</span>=&gt;$event-&gt;line,
            <span style="color: #a31515">&#39;trace&#39;</span>=&gt;$traceString,
            <span style="color: #a31515">&#39;traces&#39;</span>=&gt;$trace,
        );
        <span style="color: #0000ff">if</span>(!headers_sent())
            header(<span style="color: #a31515">&quot;HTTP/1.0 500 Internal Server Error&quot;</span>);
        <span style="color: #0000ff">if</span>($this-&gt;isAjaxRequest())
            $app-&gt;displayError($event-&gt;code,$event-&gt;message,$event-&gt;file,$event-&gt;line);
        <span style="color: #0000ff">elseif</span>(YII_DEBUG)
            <span style="color: #008000">// 开了debug，则作为exception来处理</span>
            $this-&gt;render(<span style="color: #a31515">&#39;exception&#39;</span>,$data);
        <span style="color: #0000ff">else</span>
            $this-&gt;render(<span style="color: #a31515">&#39;error&#39;</span>,$data);
    }
    <span style="color: #0000ff">else</span>
        $app-&gt;displayError($event-&gt;code,$event-&gt;message,$event-&gt;file,$event-&gt;line);
}
</code></pre></div>

<p>上面的代码最终显示异常/错误信息，是通过方法<code>render</code>、以及应用实例的<code>displayError</code>和<code>displayException</code>方法来完成。</p>
<p><strong>render</strong></p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #0000ff">&lt;?php</span>
<span style="color: #0000ff">protected</span> <span style="color: #0000ff">function</span> render($view,$data)
{
    <span style="color: #008000">// 注意这个地方，如果配置了errorAction，则可以指定目标controller的某个action来处理错误</span>
    <span style="color: #008000">/*</span>
<span style="color: #008000">     * 配置方式：</span>
<span style="color: #008000">     * &#39;components&#39; =&gt; array(</span>
<span style="color: #008000">     *      &#39;errorHandler&#39; =&gt; array(</span>
<span style="color: #008000">     *          &#39;errorAction&#39;=&gt;&#39;api/index/error&#39;,</span>
<span style="color: #008000">     *     ),</span>
<span style="color: #008000">     *     ...</span>
<span style="color: #008000">     */</span>
    <span style="color: #0000ff">if</span>($view===<span style="color: #a31515">&#39;error&#39;</span> &amp;&amp; $this-&gt;errorAction!==<span style="color: #0000ff">null</span>)
        Yii::app()-&gt;runController($this-&gt;errorAction);
    <span style="color: #0000ff">else</span>
    {
        <span style="color: #008000">// additional information to be passed to view</span>
        $data[<span style="color: #a31515">&#39;version&#39;</span>]=$this-&gt;getVersionInfo();
        $data[<span style="color: #a31515">&#39;time&#39;</span>]=time();
        $data[<span style="color: #a31515">&#39;admin&#39;</span>]=$this-&gt;adminInfo;

        <span style="color: #008000">// 看看下面getViewFile的实现</span>
        <span style="color: #0000ff">include</span>($this-&gt;getViewFile($view,$data[<span style="color: #a31515">&#39;code&#39;</span>]));
    }
}

<span style="color: #0000ff">protected</span> <span style="color: #0000ff">function</span> getViewFile($view,$code)
{
    $viewPaths=<span style="color: #0000ff">array</span>(
        Yii::app()-&gt;getTheme()===<span style="color: #0000ff">null</span> ? <span style="color: #0000ff">null</span> :  Yii::app()-&gt;getTheme()-&gt;getSystemViewPath(),
        Yii::app() instanceof CWebApplication ? Yii::app()-&gt;getSystemViewPath() : <span style="color: #0000ff">null</span>,
        YII_PATH.DIRECTORY_SEPARATOR.<span style="color: #a31515">&#39;views&#39;</span>,
    );

    <span style="color: #0000ff">foreach</span>($viewPaths <span style="color: #0000ff">as</span> $i=&gt;$viewPath)
    {
        <span style="color: #0000ff">if</span>($viewPath!==<span style="color: #0000ff">null</span>)
        {
             <span style="color: #008000">// 看看下面getViewFileInternal的实现</span>
             $viewFile=$this-&gt;getViewFileInternal($viewPath,$view,$code,$i===2?<span style="color: #a31515">&#39;en_us&#39;</span>:<span style="color: #0000ff">null</span>);
             <span style="color: #0000ff">if</span>(is_file($viewFile))
                 <span style="color: #0000ff">return</span> $viewFile;
        }
    }
}

<span style="color: #0000ff">protected</span> <span style="color: #0000ff">function</span> getViewFileInternal($viewPath,$view,$code,$srcLanguage=<span style="color: #0000ff">null</span>)
{
    $app=Yii::app();
    <span style="color: #0000ff">if</span>($view===<span style="color: #a31515">&#39;error&#39;</span>)
    {
        $viewFile=$app-&gt;findLocalizedFile($viewPath.DIRECTORY_SEPARATOR.<span style="color: #a31515">&quot;error{</span>$code<span style="color: #a31515">}.php&quot;</span>,$srcLanguage);
        <span style="color: #0000ff">if</span>(!is_file($viewFile))
            $viewFile=$app-&gt;findLocalizedFile($viewPath.DIRECTORY_SEPARATOR.<span style="color: #a31515">&#39;error.php&#39;</span>,$srcLanguage);
    }
    <span style="color: #0000ff">else</span>
        $viewFile=$viewPath.DIRECTORY_SEPARATOR.<span style="color: #a31515">&quot;exception.php&quot;</span>;
    <span style="color: #0000ff">return</span> $viewFile;
}
</code></pre></div>

<p>上面代码的逻辑是 - 对于error类型的信息，Yii会依次在以下目录中寻找名为<code>error{$code}.php</code>文件来展示错误/异常信息：</p>
<ol>
<li>WebRoot/themes/ThemeName/views/system</li>
<li>WebRoot/protected/views/system</li>
<li>yii/framework/views</li>
</ol>
<p>如果没有找到，则以相同的次序在这些目录中查找<code>error.php</code>文件。</p>
<p>对于exception类型信息，则是查找<code>exception.php</code>文件。</p>
<p>所以如果应用开发过程需要定制4xx、5xx的错误页面，可以在<code>WebRoot/protected/views/system</code>或<code>WebRoot/themes/ThemeName/views/system</code>放置对应的错误模板页面。</p>
<p><strong>displayError</strong></p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #0000ff">&lt;?php</span>
<span style="color: #0000ff">public</span> <span style="color: #0000ff">function</span> displayError($code,$message,$file,$line)
{
    <span style="color: #0000ff">if</span>(YII_DEBUG)
    {
        <span style="color: #0000ff">echo</span> <span style="color: #a31515">&quot;&lt;h1&gt;PHP Error [$code]&lt;/h1&gt;\n&quot;</span>;
        <span style="color: #0000ff">echo</span> <span style="color: #a31515">&quot;&lt;p&gt;$message ($file:$line)&lt;/p&gt;\n&quot;</span>;
        <span style="color: #0000ff">echo</span> <span style="color: #a31515">&#39;&lt;pre&gt;&#39;</span>;

        $trace=debug_backtrace();
        <span style="color: #008000">// skip the first 3 stacks as they do not tell the error position</span>
        <span style="color: #0000ff">if</span>(count($trace)&gt;3)
            $trace=array_slice($trace,3);
        <span style="color: #0000ff">foreach</span>($trace <span style="color: #0000ff">as</span> $i=&gt;$t)
        {
            <span style="color: #0000ff">if</span>(!isset($t[<span style="color: #a31515">&#39;file&#39;</span>]))
                $t[<span style="color: #a31515">&#39;file&#39;</span>]=<span style="color: #a31515">&#39;unknown&#39;</span>;
            <span style="color: #0000ff">if</span>(!isset($t[<span style="color: #a31515">&#39;line&#39;</span>]))
                $t[<span style="color: #a31515">&#39;line&#39;</span>]=0;
            <span style="color: #0000ff">if</span>(!isset($t[<span style="color: #a31515">&#39;function&#39;</span>]))
                $t[<span style="color: #a31515">&#39;function&#39;</span>]=<span style="color: #a31515">&#39;unknown&#39;</span>;
            <span style="color: #0000ff">echo</span> <span style="color: #a31515">&quot;#$i {</span>$t[<span style="color: #a31515">&#39;file&#39;</span>]<span style="color: #a31515">}({</span>$t[<span style="color: #a31515">&#39;line&#39;</span>]<span style="color: #a31515">}): &quot;</span>;
            <span style="color: #0000ff">if</span>(isset($t[<span style="color: #a31515">&#39;object&#39;</span>]) &amp;&amp; is_object($t[<span style="color: #a31515">&#39;object&#39;</span>]))
                <span style="color: #0000ff">echo</span> get_class($t[<span style="color: #a31515">&#39;object&#39;</span>]).<span style="color: #a31515">&#39;-&gt;&#39;</span>;
            <span style="color: #0000ff">echo</span> <span style="color: #a31515">&quot;{</span>$t[<span style="color: #a31515">&#39;function&#39;</span>]<span style="color: #a31515">}()\n&quot;</span>;
        }

        <span style="color: #0000ff">echo</span> <span style="color: #a31515">&#39;&lt;/pre&gt;&#39;</span>;
    }
    <span style="color: #0000ff">else</span>
    {
        <span style="color: #0000ff">echo</span> <span style="color: #a31515">&quot;&lt;h1&gt;PHP Error [$code]&lt;/h1&gt;\n&quot;</span>;
        <span style="color: #0000ff">echo</span> <span style="color: #a31515">&quot;&lt;p&gt;$message&lt;/p&gt;\n&quot;</span>;
    }
}
</code></pre></div>

<p><strong>displayException</strong></p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #0000ff">&lt;?php</span>
<span style="color: #0000ff">public</span> <span style="color: #0000ff">function</span> displayException($exception)
{
    <span style="color: #0000ff">if</span>(YII_DEBUG)
    {
        <span style="color: #0000ff">echo</span> <span style="color: #a31515">&#39;&lt;h1&gt;&#39;</span>.get_class($exception).<span style="color: #a31515">&quot;&lt;/h1&gt;\n&quot;</span>;
        <span style="color: #0000ff">echo</span> <span style="color: #a31515">&#39;&lt;p&gt;&#39;</span>.$exception-&gt;getMessage().<span style="color: #a31515">&#39; (&#39;</span>.$exception-&gt;getFile().<span style="color: #a31515">&#39;:&#39;</span>.$exception-&gt;getLine().<span style="color: #a31515">&#39;)&lt;/p&gt;&#39;</span>;
        <span style="color: #0000ff">echo</span> <span style="color: #a31515">&#39;&lt;pre&gt;&#39;</span>.$exception-&gt;getTraceAsString().<span style="color: #a31515">&#39;&lt;/pre&gt;&#39;</span>;
    }
    <span style="color: #0000ff">else</span>
    {
        <span style="color: #0000ff">echo</span> <span style="color: #a31515">&#39;&lt;h1&gt;&#39;</span>.get_class($exception).<span style="color: #a31515">&quot;&lt;/h1&gt;\n&quot;</span>;
        <span style="color: #0000ff">echo</span> <span style="color: #a31515">&#39;&lt;p&gt;&#39;</span>.$exception-&gt;getMessage().<span style="color: #a31515">&#39;&lt;/p&gt;&#39;</span>;
    }
}
</code></pre></div>

<h3>总结</h3>
<p>由上述分析可知，基于Yii框架开发应用时，有以下几点注意事项：</p>
<ul>
<li>可以通过配置组件<code>errorHandler</code>的<code>errorAction</code>属性来定制异常/错误处理过程</li>
<li>可以通过在<code>WebRoot/themes/ThemeName/views/system</code>或<code>WebRoot/protected/views/system</code>放置模板（名为<code>error{$code}.php</code>）来定制错误/异常展示方式</li>
<li>在有意抛出异常由Yii框架捕获时，需明确异常的类型是否应为<code>CHttpException</code>，只有<code>CHttpException</code>实例初始化时指定的code才能成为HTTP响应码</li>
<li>可以对事件<code>onError</code>、<code>onException</code>绑定事件处理过程，进行额外的处理，比如记录错误/异常、触发告警等</li>
</ul>
<h3>参考资料</h3>
<ul>
<li><a href="http://php.net/manual/zh/book.errorfunc.php">PHP手册 - 错误处理和日志记录</a></li>
<li><a href="http://www.yiiframework.com/doc/guide/1.1/en/topics.error">Error Handling</a></li>
<li><a href="/assets/uploads/files/PHP-Debug-Manual-public.pdf">PHP调试技术手册</a></li>
</ul>
            </div><!-- /.entry-content -->
            <div class="comments">
              <div id="gitalk-container"></div>
              <script type="text/javascript">
                const gitalk = new Gitalk({
                  clientID: '58fb3102b498bfbcb14f',
                  clientSecret: 'dd9788d7bbd9cbca1e75c9ba4db92f96dbf20180',
                  repo: 'youngsterxyf.github.com',
                  owner: 'youngsterxyf',
                  admin: ['youngsterxyf'],
                  id: location.pathname,      // Ensure uniqueness and length less than 50
                  distractionFreeMode: false  // Facebook-like distraction free mode
                });
                gitalk.render('gitalk-container');
              </script>
              <div id="disqus_thread"></div>
              <script type="text/javascript">
                var disqus_identifier = "2015/09/14/read-yii-code-10/";
                (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://xiayfblackwhite.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
              </script>
            </div>
        </div><!-- /.twelve.columns -->
 </div><!-- /.row -->
</section>

       </div><!-- /.row -->
    </div><!-- /.container -->


       <div class="container.nopad bg">


        <footer id="credits" class="row">
          <div class="seven columns left-center">

                   <address id="about" class="vcard body">
                    Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                    which takes great advantage of <a href="http://python.org">Python</a>.
                    <br />
                    Based on the <a target="_blank" href="http://gumbyframework.com">Gumby Framework</a>
                    </address>
          </div>


          <div class="seven columns">
            <div class="row">
              <ul class="socbtns">

                <li><div class="btn primary"><a href="http://github.com/youngsterxyf" target="_blank">Github</a></div></li>

                <li><div class="btn twitter"><a href="https://twitter.com/youngsterxyf" target="_blank">Twitter</a></div></li>

                <li><div class="btn warning"><a href="http://weibo.com/u/1855563263" target="_blank">Weibo</a></div></li>

                <li><div class="btn douban"><a href="http://www.douban.com/people/youngster21/" target="_blank">Douban</a></div></li>



              </ul>
            </div>
          </div>
        </footer>

    </div>


<script type="text/javascript">
    var disqus_shortname = 'xiayfblackwhite';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
  <script src="../../../../theme/js/libs/gumby.min.js"></script>
  <script src="../../../../theme/js/plugins.js"></script>
  <script src="../../../../theme/js/main.js"></script>
  <link rel="stylesheet" type="text/css" href="../../../../theme/emoji/css/basic/emojify.min.css" />
  <script src="../../../../theme/emoji/js/emojify.min.js"></script>
  <script>
    emojify.setConfig({
        img_dir : '../../../../theme/emoji/images/basic'
    });
    emojify.run();
</script>
</body>
</html>