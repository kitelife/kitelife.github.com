<!DOCTYPE html>
<html lang="zh-Hans">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta property="og:title" content="BitPacking">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://bit.xiayf.cn/">
    <meta property="og:site_name" content="BitPacking">
    <meta property="og:description" content="ç²¾è¿›ï¼Œæ±‚è¯¸å·±èº«">

    <title>BitPacking</title>
    <meta name="description" content="ç²¾è¿›ï¼Œæ±‚è¯¸å·±èº«">
    <link rel="stylesheet" href="/static/main.css">
    <link rel="canonical" href="https://bit.xiayf.cn/">
    
    <link crossorigin="" rel="shortcut icon" type="image/x-icon" href="/assets/bits_small.ico">
    
    
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    
    
</head>

<body>
<header class="site-header">
    <div class="wrapper">
        <a class="site-title" href="/">BitPacking</a>
        <nav class="site-nav">
            <a href="#" class="menu-icon">
                <svg viewBox="0 0 18 15">
                    <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
                    <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
                    <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
                </svg>
            </a>
            <div class="trigger">
                
                <a class="page-link" href="/pages/about.html">å…³äºæˆ‘</a>
                
                <a class="page-link" href="/pages/works.html">ä½œå“</a>
                
                <a class="page-link" href="/pages/linlang.html">ç³ç…</a>
                
                <a class="page-link" href="/rss.xml">RSS</a>
                
            </div>
        </nav>
    </div>
</header>
<div class="page-content">
    <div class="wrapper">
        
<div class="post">
    <header class="post-header">
        <h1 class="post-title">è¯»æ–‡ï¼šå…³äº MMAP ä¸ SSD</h1>
        <p class="post-meta">2022-09-14</p>
    </header>
    <article class="post-content">
        <p class="text-align-justify">è®¾è®¡ä¸€ç§å­˜å‚¨ï¼Œç¬¬ä¸€è¦æ˜ç¡®åº”ç”¨åœºæ™¯å’Œå­˜å‚¨ç³»ç»Ÿçš„å·¥ä½œè´Ÿè½½ï¼Œç¬¬äºŒè¦äº†è§£åº•å±‚ç¡¬ä»¶çš„ç‰¹ç‚¹ã€‚</p>
<h2>1ã€<a href='https://db.cs.cmu.edu/mmap-cidr2022/'>Are You Sure You Want to Use MMAP in Your Database Management System? </a></h2>
<p class="text-align-justify">MMAPï¼ˆMemory-mapped file I/Oï¼‰æ˜¯æ“ä½œç³»ç»Ÿæä¾›çš„ä¸€ç§åŠŸèƒ½ç‰¹æ€§ - å°†äºŒçº§å­˜å‚¨ï¼ˆç£ç›˜ã€SSDï¼‰ä¸Šä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹æ˜ å°„åˆ°ç¨‹åº/è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œç„¶åç¨‹åºå°±å¯ä»¥ä»¥æŒ‡é’ˆè®¿é—®å†…å­˜é¡µçš„æ–¹å¼æ¥è®¿é—®æ–‡ä»¶å†…å®¹ã€‚å½“ç¨‹åºè®¿é—®åˆ°æŸä¸ªå†…å­˜é¡µæ—¶ï¼Œæ“ä½œç³»ç»Ÿå°±ä¼šè‡ªåŠ¨å°†å¯¹åº”æ–‡ä»¶å†…å®¹åŠ è½½åˆ°è¯¥å†…å­˜é¡µä¸­ï¼Œå½“å†…å­˜ç”¨æ»¡äº†ï¼Œä¹Ÿä¼šè‡ªåŠ¨å‰”é™¤æŸäº›å†…å­˜é¡µã€‚</p>
<p class="text-align-justify">MMAP å…¶å®å°±ä¸€ä¸ªç°æˆçš„ç¼“å†²æ± ï¼ˆbuffer poolï¼‰ï¼Œæ ¸å¿ƒç‰¹ç‚¹å°±æ˜¯ç®€å•æ˜“ç”¨ï¼Œä¸éœ€è¦é‡å¤å¼€å‘ï¼Œç¼ºç‚¹æ˜¯åœ¨éœ€è¦æ—¶æ— æ³•ç²¾ç¡®æ§åˆ¶å…¶è¡Œä¸ºã€‚</p>
<p class="text-align-justify">ä½¿ç”¨ MMAP çš„ä¼˜åŠ¿æ˜¯ç”±æ“ä½œç³»ç»Ÿå°è£…äº†å¦‚ä¸‹åŠŸèƒ½ï¼š</p>
<ul><li>ä»ç£ç›˜è¯»æ•°æ®</li>
<li>ä¸åŒçº¿ç¨‹è¯»ç›¸åŒæ•°æ®çš„å¹¶å‘å¤„ç†</li>
<li>ç¼“å­˜å’Œç¼“å†²ç®¡ç†ï¼ˆCaching and buffer managementï¼‰</li>
<li>ä»å†…å­˜ä¸­å‰”é™¤/é©±é€å†…å­˜é¡µ</li>
<li>åŒä¸€ä¸ªæœºå™¨ä¸Šä¸åŒè¿›ç¨‹ä¹‹é—´å¯ä»¥å‹å¥½äº¤äº’ ğŸ¤”</li>
<li>è·Ÿè¸ªè„é¡µä»¥åŠå°†è„é¡µå†™å…¥ç£ç›˜ ğŸ¤”</li>
<li>ç›¸æ¯” read/write ç³»ç»Ÿè°ƒç”¨ï¼Œmmap ä¸éœ€è¦å°†å†…å­˜é¡µä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼Œè€Œæ˜¯ç›´æ¥ä»æ“ä½œç³»ç»Ÿçš„å†…å­˜é¡µç¼“å­˜ä¸­ç›´æ¥è®¿é—®å†…å­˜é¡µï¼Œæœ‰ä¸€å®šçš„æ€§èƒ½ä¼˜åŠ¿</li></ul>
<p class="text-align-justify">MMAP ç›¸å…³ POSIX APIï¼šmmapã€madviseã€mlockã€msyncã€‚</p>
<img src='https://s2.loli.net/2022/11/16/U7xMgzj36dZDGaO.jpg' title='' alt='' width='100%'/>
<p class="text-align-justify">â‘  A program calls mmap and receives a pointer to the memory-mapped file contents.</p>
<p class="text-align-justify">â‘¡ The OS reserves part of the programâ€™s virtual address space but does not load any part of the file.</p>
<p class="text-align-justify">â‘¢ The program accesses the fileâ€™s contents using the pointer.</p>
<p class="text-align-justify">â‘£ The OS attempts to retrieve the page.</p>
<p class="text-align-justify">â‘¤ Since no valid mapping exists for the specified virtual address, the OS triggers a page fault to load the referenced part of the file from secondary storage into a physical memory page.</p>
<p class="text-align-justify">â‘¥ The OS adds an entry to the page table that maps the virtual address to the new physical address.</p>
<p class="text-align-justify">â‘¦ The initiating CPU core also caches this entry in its local translation lookaside buffer (TLB) to accelerate future accesses.</p>
<p class="text-align-justify">ä¸è¿‡è®ºæ–‡ä½œè€…è®¤ä¸º mmap å­˜åœ¨ä¸€äº›æ•°æ®å®‰å…¨æ€§å’Œç³»ç»Ÿæ€§æ€§èƒ½é—®é¢˜ï¼Œä¸ºè§£å†³è¿™äº›é—®é¢˜è€Œå¼•å…¥çš„å·¥ç¨‹æˆæœ¬ä¼šæŠµæ¶ˆæ‰ç®€å•æ€§ï¼š</p>
<p class="text-align-justify"><strong>1ã€äº‹åŠ¡å®‰å…¨æ€§ï¼ˆTransactional Safetyï¼‰</strong>ï¼šç”±äºé€æ˜çš„é¡µå¼è°ƒåº¦æœºåˆ¶ï¼Œæ“ä½œç³»ç»Ÿå¯èƒ½ä¼šä»»æ„æ—¶åˆ»å°†ä¸€ä¸ªè„é¡µåˆ·åˆ°äºŒçº§å­˜å‚¨ä¸­ï¼Œä¸ç®¡å†™äº‹åŠ¡æ˜¯å¦å·²æäº¤ã€‚DBMS æ— æ³•ç»„ç»‡è¿™ç§å†…å­˜æ•°æ®åˆ·å‡ºï¼Œå¹¶ä¸”å‘ç”Ÿæ—¶ä¹Ÿä¸ä¼šæ¥æ”¶åˆ°ä»»ä½•ä¿¡å·ã€‚æ‰€ä»¥åŸºäº mmap çš„æ•°æ®åº“ç³»ç»Ÿåªèƒ½é‡‡ç”¨å¤æ‚çš„åè®®æ¥ç¡®ä¿ï¼ˆå†™/æ›´æ–°ï¼‰äº‹åŠ¡å®‰å…¨ï¼Œæ‰‹æ®µä¸Šå¤§æ¦‚åˆ†3ç§ï¼šæ“ä½œç³»ç»Ÿå†™æ—¶å¤åˆ¶ã€ç”¨æˆ·ç©ºé—´å†™æ—¶å¤åˆ¶ã€å½±å­é¡µç®¡ç†ï¼ˆshadow pagingï¼‰</p>
<p class="text-align-justify"><strong>2ã€I/O åœé¡¿ï¼ˆI/O Stallsï¼‰</strong>ï¼š</p>
<ul><li>mmap ä¸æ”¯æŒå¼‚æ­¥è¯»ï¼›è‡ªå·±æç¼“å†²æ± çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨å¼‚æ­¥ I/Oï¼ˆæ¯”å¦‚ libaioã€io_uringï¼‰æ¥é¿å…æŸ¥è¯¢æ—¶é˜»å¡çº¿ç¨‹</li>
<li>å¯¹äº mmapï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨/é€æ˜åœ°å‰”é™¤ä¸€äº›å†…å­˜é¡µï¼Œè¿™æ ·å¯èƒ½å¯¼è‡´ - å¦‚æœæŸäº›åªè¯»æŸ¥è¯¢å‘½ä¸­äº†å·²è¢«å‰”é™¤çš„å†…å­˜é¡µï¼Œå°±ä¼šæ— æ³•é¢„çŸ¥åœ°è§¦å‘é˜»å¡æ€§çš„é¡µé”™è¯¯/ç¼ºé¡µå¤„ç†</li></ul>
<p class="text-align-justify">è§£å†³æ–¹æ¡ˆï¼š1ã€ä½¿ç”¨ mlockï¼Œä¸è¿‡æ“ä½œç³»ç»Ÿå¯¹ä¸€ä¸ªè¿›ç¨‹èƒ½é”ä½çš„å†…å­˜é¡µæ•°é‡æœ‰é™åˆ¶ï¼›2ã€ä½¿ç”¨ madvise çš„ MADV_SEQUENTIAL æ ‡è®°ï¼Œä»…èƒ½é—®é¢˜çš„ä¸€éƒ¨åˆ†ï¼›3ã€ä½¿ç”¨é¢å¤–çš„çº¿ç¨‹æ¥è¿›è¡Œå†…å­˜é¡µé¢„å–ï¼Œé¿å…ä¸»çº¿ç¨‹è¢«é˜»å¡ï¼Œä¸è¿‡ä¼šå¼•å…¥è¾ƒå¤§çš„å¤æ‚æ€§</p>
<p class="text-align-justify"><strong>3ã€é”™è¯¯å¤„ç†</strong>ï¼š</p>
<p class="text-align-justify">DBMS çš„æ ¸å¿ƒèŒè´£ä¹‹ä¸€æ˜¯ç¡®ä¿æ•°æ®å®Œæ•´æ€§ - æ¯”å¦‚ï¼šæ ¡éªŒç£ç›˜æ•°æ®æ˜¯å¦æœ‰æŸå</p>
<ul><li>ä½¿ç”¨ mmapï¼ŒDBMS éœ€è¦åœ¨æ¯æ¬¡å†…å­˜é¡µè®¿é—®æ—¶æ£€æŸ¥æ ¡éªŒå’Œï¼ˆchecksumï¼‰ï¼Œå› ä¸ºå†…å­˜é¡µä¸€æ¬¡è®¿é—®ä¹‹åæ“ä½œç³»ç»Ÿå¯èƒ½ä¼šå°†è¯¥é¡µé©±é€åˆ°ç£ç›˜</li>
<li>å¦‚æœ DBMS æ˜¯ä½¿ç”¨éå†…å­˜å®‰å…¨çš„ç¼–ç¨‹è¯­è¨€ç¼–å†™çš„ï¼Œå°±æœ‰å¯èƒ½åœ¨æŒ‡é’ˆæ“ä½œæ—¶æŸåå†…å­˜é¡µå†…å®¹ï¼Œæ‰€ä»¥éœ€è¦åœ¨å†…å­˜é¡µåˆ·åˆ°äºŒçº§å­˜å‚¨ä¹‹å‰è¿›è¡Œé”™è¯¯æ£€æµ‹ï¼Œmmap ä¼šé»˜é»˜åœ°å°†æŸåçš„å†…å­˜é¡µæŒä¹…åŒ–åˆ°äºŒçº§å­˜å‚¨</li>
<li>ä½¿ç”¨ mmap ä¹Ÿæ›´éš¾ä¼˜é›…åœ°è¿›è¡Œ I/O é”™è¯¯å¤„ç†ï¼Œå’Œ mmap å†…å­˜äº¤äº’çš„ä»»ä½•ä»£ç éƒ½å¯èƒ½æŠ›å‡º SIGBUS ä¿¡å·ï¼ŒDBMS å¿…é¡»ä½¿ç”¨ä¿¡å·å¤„ç†å™¨ï¼ˆsignal handlersï¼‰æ¥å¤„ç† â“</li></ul>
<p class="text-align-justify"><strong>4ã€æ€§èƒ½é—®é¢˜ï¼ˆæœ€é‡å¤§ï¼‰</strong>ï¼š</p>
<ul><li>å¤§å®¶æ™®éè®¤ä¸º mmap æ€§èƒ½ä¼˜äºä¼ ç»Ÿæ–‡ä»¶ I/Oï¼ˆread/writeï¼‰ï¼Œå› ä¸ºå®ƒé¿å…ä¸¤ä¸ªå¼€é”€ï¼š(1) æ˜¾å¼è°ƒç”¨ read/write ç³»ç»Ÿè°ƒç”¨çš„å¼€é”€ (2) mmap ä¼šè¿”å›æŒ‡å‘æ“ä½œç³»ç»Ÿé¡µç¼“å­˜çš„é¡µæŒ‡é’ˆï¼Œå› æ­¤é¿å…äº†åˆ°ç”¨æˆ·å†…å­˜ç©ºé—´çš„ä¸€æ¬¡å†…å­˜æ‹·è´ï¼Œä¹Ÿå› æ­¤é™ä½äº†å†…å­˜å ç”¨ï¼›ç”±æ­¤ï¼Œå¤§å®¶ä¹Ÿè®¤ä¸ºåœ¨ SSD ä¸Š mmap çš„æ€§èƒ½ä¼˜åŠ¿ä¼šè¿›ä¸€æ­¥æ‰©å¤§ã€‚</li>
<li>ä¸è¿‡å®éªŒæµ‹è¯•å‘ç°ï¼šå¯¹äºé«˜å¸¦å®½çš„äºŒçº§å­˜å‚¨è®¾å¤‡ï¼ˆæ¯”å¦‚ SSDï¼‰ï¼ŒDBMS ç®¡ç†çš„æ•°æ®é‡å¤§äºå†…å­˜ç©ºé—´æ—¶ï¼Œæ“ä½œç³»ç»Ÿçš„é¡µé©±é€æœºåˆ¶ï¼ˆpage eviction mechanismsï¼‰å¤šçº¿ç¨‹æ‰©å±•æ€§æ¯”è¾ƒå·®ï¼ˆå¤‡æ³¨ï¼šå› ä¸º SSD I/O å¸¦å®½å¤§ã€è®¿é—®é€Ÿåº¦å¿«ï¼Œé¡µé©±é€æœºåˆ¶å°±å¯èƒ½æˆäº†ç“¶é¢ˆï¼‰ï¼ˆwe have found that the OSâ€™s page eviction mechanisms cannot scale beyond a few threads for larger-thanmemory DBMS workloads on high-bandwidth secondary storage devices. We believe that one of the main reasons these performance issues have gone largely unnoticed is due to historically limited file I/O bandwidthï¼‰ã€‚ç“¶é¢ˆæºäº3ä¸ªå› ç´ ï¼š
<ul><li>é¡µè¡¨äº‰ç”¨ï¼ˆpage table contentionï¼‰/ é”ï¼ˆå¤‡æ³¨ï¼šå½“å‰ linux å†…æ ¸å®ç°ä¼˜åŒ–äº†è¿™ä¸ªé—®é¢˜ï¼Œ<a href='https://github.com/torvalds/linux/blob/master/Documentation/mm/split_page_table_lock.rst'>linux/split_page_table_lock.rst at master Â· torvalds/linux (github.com)</a>ï¼‰</li>
<li>å•çº¿ç¨‹é¡µé©±é€ï¼ˆsingle-threaded page evictionï¼‰ï¼Œ<a href='https://biriukov.dev/docs/page-cache/4-page-cache-eviction-and-page-reclaim/'>Page Cache eviction and page reclaim | Viacheslav Biriukov</a></li>
<li>æ—è·¯è½¬æ¢ç¼“å†²å‡»è½ï¼ˆTLB shootdownsï¼‰ï¼šTLB shootdowns occur during page eviction when a core needs to invalidate mappings in a remote TLB. Whereas flushing the local TLB is inexpensive, issuing interprocessor interrupts to synchronize remote TLBs can take thousands of cycles
<ul><li><a href='https://juejin.cn/post/6844904084957315086'>æ·±å…¥ç†è§£ Linux å†…æ ¸--jemalloc å¼•èµ·çš„ TLB shootdown åŠä¼˜åŒ– - æ˜é‡‘ (juejin.cn)</a></li>
<li><a href='https://www.kernel.org/doc/html/v4.18/core-api/cachetlb.html'>Cache and TLB Flushing Under Linux â€” The Linux Kernel documentation</a></li></ul></li></ul></li></ul>
<p class="text-align-justify">å®éªŒåˆ†æï¼š</p>
<p class="text-align-justify">As a baseline, we used the fio storage benchmarking tool (v3.25) with direct I/O (O_DIRECT) to bypass the OS page cache. Our analysis focused exclusively on read-only workloads, which represent the best-case scenario for mmap-based DBMSs.</p>
<img src='https://s2.loli.net/2022/11/16/FlAJqH8E4K1UWvp.jpg' title='' alt='' width='100%'/>
<img src='https://s2.loli.net/2022/11/16/qhz3OQHlgaZ2YMn.jpg' title='' alt='' width='600'/>
<img src='https://s2.loli.net/2022/11/16/oczkfgLw9EMR1ue.jpg' title='' alt='' width='600'/>
<p class="text-align-justify">é‚£ä¹ˆï¼Œåˆ°åº•è¦ä¸è¦ä½¿ç”¨ mmap å‘¢ï¼Ÿç›´æ¥ä½¿ç”¨ ssdï¼Ÿè¿˜æ˜¯è‡ªå·±æä¸€ä¸ª buffer poolï¼Ÿ</p>
<p class="text-align-justify">è®ºæ–‡ä½œè€…ç»™å‡ºè¿™æ ·çš„ç»“è®ºï¼š</p>
<ul><li>ä»¥ä¸‹æƒ…å†µä¸è¦ä½¿ç”¨ mmapï¼š
<ul><li>éœ€è¦ä»¥äº‹åŠ¡å®‰å…¨çš„æ–¹å¼è¿›è¡Œæ›´æ–°æ“ä½œ</li>
<li>å¸Œæœ›å¤„ç†ç¼ºé¡µé”™è¯¯æ—¶ä¸ä¼šé˜»å¡åœ¨æ…¢ I/O ä¸Šï¼Œæˆ–è€…å¸Œæœ›æ˜ç¡®æ§åˆ¶å“ªäº›æ•°æ®åº”è¯¥åœ¨å†…å­˜ä¸­</li>
<li>å…³å¿ƒé”™è¯¯å¤„ç†ï¼Œä¹Ÿå¸Œæœ›å§‹ç»ˆè¿”å›æ­£ç¡®çš„æ•°æ®ç»“æœ</li>
<li>è¦æ±‚åœ¨å¿«é€ŸæŒä¹…åŒ–å­˜å‚¨è®¾å¤‡ï¼ˆæ¯”å¦‚ SSDï¼‰ä¸Šè·å¾—é«˜åå</li></ul></li>
<li>ä»¥ä¸‹æƒ…å†µå¯èƒ½åº”è¯¥ä½¿ç”¨ mmapï¼š
<ul><li>å†…å­˜å¯ä»¥å®¹çº³æ•´ä¸ªæ•°æ®å·¥ä½œé›†ï¼ˆæˆ–è€…è¯´æ•´ä¸ªæ•°æ®åº“ï¼‰ï¼Œå¹¶ä¸”æ˜¯åªè¯»çš„å·¥ä½œè´Ÿè½½</li>
<li>å¸Œæœ›å°†ä¸€ä¸ªäº§å“å¿«é€Ÿæ¨å‘å¸‚åœºï¼Œä¹Ÿä¸å…³æ³¨æ•°æ®ä¸€è‡´æ€§æˆ–è€…é•¿æœŸçš„å·¥ç¨‹æŠ€æœ¯å€º</li>
<li>Otherwise, never ğŸ¤£ğŸ™ƒ</li></ul></li></ul>
<p class="text-align-justify">å½©è›‹ï¼šè®ºæ–‡çš„å¥‡æ•°é¡µé¡µçœ‰  ğŸ˜‚</p>
<img src='https://s2.loli.net/2022/11/16/AIqHKTC213FYaxX.jpg' title='' alt='' width='100'/>
<h2>2ã€<a href='https://ayende.com/blog/196161-C/re-are-you-sure-you-want-to-use-mmap-in-your-database-management-system'>re: Are You Sure You Want to Use MMAP in Your Database Management System? </a></h2>
<p class="text-align-justify">æœ¬æ–‡ä½œè€…è®¤ä¸ºè‡ªå·±å®ç°ä¸€ä¸ªå†…å­˜åˆ†é¡µç®¡ç†å™¨/ç¼“å†²æ± æ¯”è¾ƒå¤æ‚ï¼Œä½¿ç”¨ mmap æ¥å®ç°å­˜å‚¨ç³»ç»Ÿä¼šå¾ˆå¿«ã€‚</p>
<p class="text-align-justify">ä¸è¿‡åæ§½äº†åŸè®ºæ–‡æ²¡æœ‰ç»™å‡ºå¯ä¾›é€‰æ‹©çš„æ›¿ä»£æ–¹æ¡ˆï¼ŒåŸºå‡†æµ‹è¯•å’Œç»“è®ºä¹‹é—´ä¹Ÿæ²¡å¤ªå¤šç›¸å…³æ€§ï¼ˆcompares apples to camelsï¼‰ï¼Œä¹Ÿä½ä¼°äº†è‡ªå·±å®ç°ä¸€ä¸ªæ›¿ä»£ mmap çš„ç¼“å†²æ± çš„å¤æ‚æ€§ã€‚</p>
<p class="text-align-justify">ä¸ç”¨ mmap çš„è¯ï¼Œè®ºæ–‡æåŠçš„é‚£äº›é—®é¢˜ï¼Œä¹Ÿæ˜¯è¦è§£å†³çš„ï¼ˆIf you arenâ€™t using mmap, on the other hand, you still need to handle all those issues. That is a key point that I believe isnâ€™t addressed in the paper. Solving those issues properly (and efficiently) is a seriously challenging task. Given that you are building a specialized solution, you can probably do better than the generic mmap, but it will absolutely have a cost. That cost is both in terms of runtime overhead as well as increased development time.ï¼‰ã€‚</p>
<p class="text-align-justify">åŸè®ºæ–‡çš„å®éªŒè¯´æ˜äº† mmap çš„æ€§èƒ½é—®é¢˜ï¼Œä½†æ˜¯æ¢ä¸ª buffer pool çš„å®ç°èƒ½ä¸èƒ½è·å¾—æ›´å¥½çš„æ€§èƒ½å‘¢ï¼Ÿè¯¥æ–‡ä½œè€…æŒæ‚²è§‚æ€åº¦ã€‚</p>
<p class="text-align-justify">å­˜å‚¨ç³»ç»Ÿå®é™…é¢å¯¹çš„å·¥ä½œè´Ÿè½½ä¸ä¼šæ˜¯å®Œå…¨çš„éšæœºè¯»ï¼ˆå†™ï¼‰æˆ–é¡ºåºæ‰«æï¼Œé€šå¸¸éƒ½å…·æœ‰ä¸€å®šçš„çƒ­ç‚¹æ•°æ®ï¼Œè¿™æ—¶ buffer pool çš„ä¼˜åŠ¿å°±ä¼šä½“ç°å‡ºæ¥ï¼Ÿ</p>
<ul><li>å…³äºâ€œé—®é¢˜ 1 - äº‹åŠ¡å®‰å…¨æ€§â€ - ä¸ç”¨ mmapï¼Œè§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ¡ˆæ²¡ä»€ä¹ˆä¸åŒï¼ˆI donâ€™t actually care if the data is written to memory behind my back. What I care about is MVCC (a totally separate concern than buffer management). The fact that Iâ€™m copying the modified data to the side means that I Can support concurrent transactions with far greater ease.ï¼‰</li>
<li>å…³äºâ€œé—®é¢˜ 2 - I/O åœé¡¿â€ - è¯¥æ–‡ä½œè€…è®¤ä¸ºç¡®å®ä¸ªé—®é¢˜ï¼ˆnot having control over the I/O means that you may incur a page fault at any timeï¼‰ï¼Œå¹¶ä¸”æ˜¯åŸºäº mmap çš„ç³»ç»Ÿè¦é¢å¯¹çš„æœ€å¤§é—®é¢˜ã€‚ä¸è¿‡å®é™…æƒ…å†µæ˜¯ linux ç³»ç»Ÿä¸­ io_uring ä¹‹å¤–çš„å¼‚æ­¥ I/O æ–¹æ¡ˆåœ¨æŸäº›æ—¶å€™å¼‚æ­¥æ“ä½œä¹Ÿä¼šæ˜¯é˜»å¡çš„ã€‚æ˜¯å¦ä½¿ç”¨ mmapï¼Œè¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆä¹Ÿæ²¡æœ‰æœ¬è´¨åŒºåˆ«ã€‚</li>
<li>å…³äºâ€œé—®é¢˜ 3 - é”™è¯¯å¤„ç†â€ - è¯¥æ–‡ä½œè€…ä»¥è‡ªå·±å¼€å‘çš„ Voron ä¸ºä¾‹è¯´æ˜å³ä½¿ä½¿ç”¨ mmapï¼Œä¹Ÿå¯ä»¥è¾ƒå¥½åœ°å®ç°æ ¡éªŒå’Œæ£€æŸ¥ï¼ˆä½¿ç”¨ä¸€ä¸ª bitmap æ¥è®°å½•å“ªäº›å†…å­˜é¡µè¢«è®¿é—®è¿‡ï¼Œåœ¨ç¬¬ä¸€æ¬¡è®¿é—®æŸä¸ªå†…å­˜é¡µçš„æ—¶å€™æ£€æŸ¥æ ¡éªŒå’Œï¼‰ï¼Œå¹¶è®¤ä¸ºç¨‹åºä¸€æ¬¡è¿è¡Œè¿‡ç¨‹ä¸­å¯¹äºæŒ‡å®šçš„ä¸€ä¸ªå†…å­˜é¡µæ£€æŸ¥ä¸€æ¬¡å°±å¯ä»¥ï¼Œå…¶ä»–æƒ…å†µä¸‹çš„æ£€æŸ¥éƒ½æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚When you use read() to get data from the disk, you have no guarantees that the data wasnâ€™t fetched from a cache along the way. So you may validate the data you read is â€œcorrectâ€, while the on disk representation is broken. For that reason, we only do the check once, instead of each time. ğŸ¤” å¥½åƒä¸æ˜¯è¿™ä¸ªç†ï¼Ÿ
<ul><li>è‡³äºå‘ç° I/O é”™è¯¯ï¼Œå¦‚ä½•å¤„ç†ï¼Ÿè¯¥æ–‡ä½œè€…è®¤ä¸ºç­”æ¡ˆåªæœ‰ä¸€ä¸ª - è®©å®ƒå´©æºƒç„¶åé‡æ–°æ¢å¤å¹¶è¿è¡Œï¼ˆCrash and then run recovery from scratchï¼‰ï¼Œå› ä¸ºå¦‚æœ I/O ç³»ç»Ÿè¿”å›äº†ä¸€ä¸ªé”™è¯¯ï¼Œåº”ç”¨é€»è¾‘ä¹Ÿä¸ä¼šæœ‰ä»»ä½•æ–¹å¼çŸ¥é“ I/O ç³»ç»Ÿçš„å½“å‰çŠ¶æ€æ˜¯ä»€ä¹ˆï¼Œåº”è¯¥æ€ä¹ˆè§£å†³ï¼Œå”¯ä¸€çš„æ–¹å¼å°±æ˜¯åœä¸‹æ¥ï¼Œé‡æ–°åŠ è½½ä¸€åˆ‡ï¼ˆåº”ç”¨ WAL è¿›è¡Œæ¢å¤ï¼‰ï¼Œå›åˆ°ä¸€ä¸ªç¨³å®šçŠ¶æ€ã€‚</li></ul></li>
<li>å…³äºâ€œé—®é¢˜ 4 - æ€§èƒ½é—®é¢˜â€ -
<ul><li>é¡µè¡¨äº‰ç”¨ï¼ˆpage table contentionï¼‰ï¼šlinux å†…æ ¸å·²ä¼˜åŒ–è§£å†³</li>
<li>å•çº¿ç¨‹é¡µé©±é€ï¼ˆsingle-threaded page evictionï¼‰ï¼šå¦‚æœå†™/æ›´æ–°é¢‘ç‡ä¸é«˜ï¼Œè„é¡µä¸å¤šçš„è¯ï¼Œä¹Ÿä¸ä¼šæˆä¸ºæ€§èƒ½ç“¶é¢ˆ</li>
<li><a href='https://stackoverflow.com/questions/3748384/what-is-tlb-shootdown'>æ—è·¯è½¬æ¢ç¼“å†²å‡»è½ï¼ˆTLB shootdownsï¼‰</a>ï¼šåœ¨ä¸€å®šæ¡ä»¶ä¸‹æ‰ä¼šæˆä¸ºæ€§èƒ½ç“¶é¢ˆï¼Œå½“ä½ çœŸçš„é‡åˆ°æ—¶åº”è¯¥ä¹Ÿä¼šå¤šèŠ±é’±ä¹°å†…å­˜æ¥è§£å†³ ğŸ¤£ğŸ™ƒï¼ˆIn order to actually observe the cost of TLS Shootdown in a significant manner, you need to have: (1) really fast I/O (2)working set that significantly exceeds memory (3) no other work that needs to be done for processing a request; In practice, if you have really fast I/O, you spent money on that, youâ€™ll more likely get more RAM as well. And you typically need to do something with the data you read, which means that you wonâ€™t notice the TLB shootdown as muchï¼‰</li></ul></li></ul>
<h2>3ã€<a href='https://www.usenix.org/system/files/conference/fast16/fast16-papers-lu.pdf'>WiscKey: Separating Keys from Values in SSD-Conscious Storage</a> /   <a href='https://dgraph.io/blog/post/badger/'>Introducing Badger: A fast key-value store written purely in Go</a></h2>
<p class="text-align-justify">WiscKey æ˜¯ä¸€ä¸ªåŸºäº LSM (Log Structured Merge)æ ‘çš„ KV å­˜å‚¨å¼•æ“ï¼Œé’ˆå¯¹ SSD çš„éšæœºè¯»å’Œé¡ºåºè¯»æ€§èƒ½ç‰¹ç‚¹ï¼Œå°† Key å’Œ Value åˆ†å¼€å­˜å‚¨ï¼Œä»¥å°½å¯èƒ½ç¼©å° I/O æ”¾å¤§é—®é¢˜ï¼Œæå‡æ€§èƒ½ã€‚</p>
<p class="text-align-justify">Value å­˜æ”¾åœ¨ Log æ–‡ä»¶ä¸­ï¼ŒLSM æ ‘ä»…å­˜å‚¨ Key å’Œ Value åœ¨ Log æ–‡ä»¶çš„ä½ç½®ä»¥åŠé•¿åº¦/å¤§å°ã€‚</p>
<p class="text-align-justify">å¯¹äº Value æ¯”è¾ƒå¤§çš„åº”ç”¨åœºæ™¯ï¼Œæ€§èƒ½ä¼˜åŠ¿æ˜æ˜¾ã€‚</p>
<img src='https://s2.loli.net/2022/11/16/y84VKqJZWMSjBu7.jpg' title='' alt='' width='500'/>
<p class="text-align-justify">å› ä¸º LSM æ ‘ä¸å­˜å‚¨ Value æœ¬èº«ï¼Œé€šå¸¸æ¯”è¾ƒå°ï¼Œå¯ä»¥å…¨éƒ¨æ”¾åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥ä¸è€ƒè™‘è·å– Value çš„å€¼ï¼Œç‚¹æŸ¥å’ŒèŒƒå›´æŸ¥æ‰¾é€Ÿåº¦éå¸¸å¿«ã€‚</p>
<p class="text-align-justify">LSM æ ‘æ¯”è¾ƒå°ï¼Œæ‰€ä»¥ Compaction æ¬¡æ•°å°‘ï¼Œé€Ÿåº¦å¿«ï¼ˆç‰¹åˆ«æ˜¯å¦‚æœæ•´ä¸ª LSM éƒ½æ”¾åœ¨å†…å­˜ä¸­çš„è¯ï¼‰ã€‚Compaction è¿‡ç¨‹ä¸­ä¸éœ€è¦è¯»å†™ Value çš„å€¼ï¼Œæ‰€ä»¥ I/O æ”¾å¤§å€æ•°è¦å°å¾ˆå¤šã€‚</p>
<img src='https://s2.loli.net/2022/11/16/2tvp5LROXG4UYrw.jpg' title='' alt='' width='500'/>
<p class="text-align-justify">ç‚¹æŸ¥è¿‡ç¨‹ï¼Œä» LSM æ ‘ä¸­è·å– Value çš„ä½ç½®å’Œå¤§å°åï¼Œéœ€è¦ä» Value Log ä¸­è·å– Value å€¼ã€‚å› ä¸º LSM æ ‘å°ï¼Œæ‰€ä»¥è¯»æ”¾å¤§å€æ•°å°ï¼Œç»¼åˆèµ·æ¥çœ‹ï¼ŒWiscKey ç‚¹æŸ¥çš„æ€§èƒ½ä¼˜åŠ¿ä¾æ—§æ˜æ˜¾ã€‚</p>
<p class="text-align-justify">èŒƒå›´æŸ¥æ‰¾/éå†è¿‡ç¨‹ï¼Œå…ˆä» LSM æ ‘ä¸­è·å¾—ç›®æ ‡èŒƒå›´å†…çš„æ‰€æœ‰ Value çš„ä½ç½®å’Œå¤§å°ï¼Œæ”¾å…¥é˜Ÿåˆ—ï¼Œä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œå¹¶å‘é¢„å–ï¼Œåˆ©ç”¨ SSD éšæœºè¯»çš„ååèƒ½åŠ›éšå¹¶å‘æ ‘è¿‘çº¿æ€§å¢é•¿çš„ç‰¹ç‚¹ã€‚</p>
<img src='https://s2.loli.net/2022/11/16/APbQlhq3nWsf47j.jpg' title='' alt='' width='500'/>
<img src='https://s2.loli.net/2022/11/16/j357k6XMfYO2udm.jpg' title='' alt='' width='400'/>
<p class="text-align-justify">Value Log ä¹Ÿéœ€è¦ GCï¼Œæ¸…ç†æ‰æ— ç”¨çš„ Value å€¼ã€‚LSM æ ‘çš„ Compaction ä¸»è¦æ˜¯ä¸ºäº†æå‡æŸ¥æ‰¾/æ£€ç´¢çš„æ€§èƒ½/æ•ˆç‡ï¼Œæ§åˆ¶è¯»æ”¾å¤§ï¼Œå‡å°‘å†…å­˜/ç£ç›˜ç©ºé—´å ç”¨æ˜¯æ¬¡è¦çš„ã€‚Value Log çš„ GC åˆ™ä¸»è¦æ˜¯ä¸ºäº†å‡å°‘å†…å­˜/ç£ç›˜ç©ºé—´å ç”¨ã€‚</p>
<p class="text-align-justify">ä¸ºäº†å®ç°åœ¨çº¿çš„è½»é‡çº§ GCï¼ŒValue Log ä¸­ä¹Ÿå­˜å‚¨äº† Keyï¼Œ</p>
<img src='https://s2.loli.net/2022/11/16/JMKxWiaCovyhgr8.jpg' title='' alt='' width='500'/>
<p class="text-align-justify">tail æŒ‡å‘ Value Log æœ‰æ•ˆå€¼èŒƒå›´å†…æ—¶åºä¸Šæœ€å…ˆå†™å…¥çš„é‚£ä¸ª value çš„ä½ç½®ã€‚</p>
<p class="text-align-justify">head æŒ‡å‘ Value Log ä¸­ä¸‹ä¸€ä¸ªæ–° value å†™å…¥çš„ä½ç½®ã€‚</p>
<p class="text-align-justify">tail å’Œ head åŠå…¶å¯¹åº”çš„ä½ç½®ä¿¡æ¯å‡ä½œä¸º kv å­˜å…¥ LSM æ ‘ä¸­ï¼ˆhead çš„æŒ‡å‘ä»€ä¹ˆæ—¶å€™ä¼šæ›´æ–°ï¼Ÿï¼šæ¯æ¬¡æœ‰æ–°å€¼å†™å…¥çš„æ—¶å€™éƒ½æ›´æ–°ï¼Ÿè¿˜æ˜¯åœ¨ GC çš„è¿‡ç¨‹ä¸­æ‰ä¼šæ›´æ–°ï¼Ÿï¼‰</p>
<p class="text-align-justify">GC çš„æµç¨‹ä¸ºï¼š</p>
<p class="text-align-justify">â‘  ä» tail æŒ‡å‘çš„ä½ç½®å¼€å§‹é¡ºåºæ‰«æä¸€å—æ•°æ®ï¼Œæ ¹æ®å…¶ä¸­çš„ key æ£€ç´¢ LSM æ ‘ï¼Œç¡®è®¤å½“å‰ value æ˜¯å¦æœ‰æ•ˆï¼ˆæ²¡æœ‰è¢«åˆ é™¤ä¹Ÿæ²¡æœ‰è¢«è¦†ç›–ï¼‰</p>
<p class="text-align-justify">â‘¡ å¦‚æœæœ‰æ•ˆåˆ™æ’å…¥åˆ° head æŒ‡å‘çš„ä½ç½®ï¼Œhead æŒ‡å‘ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªä½ç½®ï¼›å¦‚æœæ— æ•ˆï¼Œåˆ™ç›´æ¥ä¸¢å¼ƒ</p>
<p class="text-align-justify">â‘¢ ä¸€å—æ•°æ®å¤„ç†å®Œæˆåï¼Œç§»åŠ¨ tail æŒ‡å‘åˆ°ä¸‹ä¸€ä¸ªä½ç½®ï¼Œé‡Šæ”¾/å›æ”¶åŸæ¥æ•°æ®å—çš„å­˜å‚¨ç©ºé—´ï¼›ç„¶åç»§ç»­å¾ªç¯å¤„ç†</p>
<p class="text-align-justify"><strong>ç–‘é—®</strong>ï¼š1. GC è¿‡ç¨‹ä¸­æ¯æ¬¡å‘ head æ’å…¥æœ‰æ•ˆå€¼æ—¶ï¼Œæ˜¯å¦å…ˆè¦ä» LSM æ ‘ä¸­æŸ¥è¯¢æœ€æ–°æŒ‡å‘çš„ä½ç½®ï¼Ÿ2. åœ¨æ ¹æ® key ä» LSM æ ‘æŸ¥è¯¢åå°†æœ‰æ•ˆå€¼å†™å…¥ head ä½ç½®å‰ï¼Œæœ‰æ–°æ•°æ®å†™å…¥çš„è¯ï¼Œæ€ä¹ˆå¤„ç†ï¼ŸGC æœŸé—´æ˜¯å¦è¦åœæ­¢æ­£å¸¸çš„å†™æ“ä½œï¼Ÿè¿˜æ˜¯è¯´å¯¹æŸä¸ªä¸´ç•ŒåŒºåŠ é”ï¼Ÿ</p>
<p class="text-align-justify">LSM æ ‘åŸç†ï¼š</p>
<img src='https://s2.loli.net/2022/11/16/k6cHFOUluo1Ibfp.jpg' title='' alt='' width='500'/>
<img src='https://s2.loli.net/2022/11/16/17WubUhqSpCjMr5.jpg' title='' alt='' width='500'/>
<img src='https://s2.loli.net/2022/11/16/Tomk3VOEs7jduQl.jpg' title='' alt='' width='500'/>
<p class="text-align-justify"><a href='https://zhuanlan.zhihu.com/p/181498475'>LSMæ ‘è¯¦è§£ - çŸ¥ä¹ (zhihu.com)</a></p>
<h2>4ã€<a href='http://www.vldb.org/pvldb/vol14/p364-didona.pdf'>Toward a Better Understanding and Evaluation of Tree Structures on Flash SSDsï¼ˆVLDBï¼‰</a></h2>
<p class="text-align-justify">PTS - Persistent tree data structure</p>
<p class="text-align-justify">ä½¿ç”¨ LSM æ ‘ï¼ˆRocksDBï¼‰å’Œ B+ æ ‘ï¼ˆWiredTigerï¼‰æ¥åˆ†æ SSD åŸºå‡†æµ‹è¯•ï¼ˆBenchmarkingï¼‰ä¸­å¯èƒ½è¸©åˆ°çš„ 7 ä¸ªå‘ï¼ˆpitfallï¼‰ï¼š</p>
<p class="text-align-justify"><strong>ï¼ˆ1ï¼‰Running short tests / æµ‹è¯•è¿‡äºçŸ­å¹³å¿«</strong> âš¡ï¸</p>
<p class="text-align-justify">éšç€ä½¿ç”¨æ—¶é—´çš„å¢åŠ ï¼ŒSSD çš„æ€§èƒ½ä¼šä¸€å®šçš„åŠ¨æ€å˜åŒ–ã€‚</p>
<p class="text-align-justify">Because both the PTS and SSD performance vary over time, short-lived tests are unable to capture how the systems will behave under a continuousï¼ˆnon-burstyï¼‰workload.</p>
<img src='https://s2.loli.net/2022/11/16/HSuzIeC8itjndGw.jpg' title='' alt='' width='500'/>
<p class="text-align-justify">WA-Aï¼ˆåº”ç”¨/å­˜å‚¨ç³»ç»Ÿçš„å†™æ”¾å¤§ï¼‰ increases over time while the levels of the LSM-Tree fills up, and its curve flattens once the layout of the LSM tree has stabilized.</p>
<p class="text-align-justify">WA-Dï¼ˆSSD è®¾å¤‡çš„å†™æ”¾å¤§ï¼‰ increases over time because of the effect of garbage collection.</p>
<p class="text-align-justify"><strong>ï¼ˆ2ï¼‰Ignoring the device write amplification (WA-D) / å¿½è§†äº† SSD è®¾å¤‡æœ¬èº«çš„å†™æ”¾å¤§</strong> âš¡ï¸</p>
<ul><li>WA-D directly affects the throughput of the device, which strongly correlates with the application-level throughput.</li>
<li>WA-D is an essential measure of the I/O efficiency of a PTS. ç«¯åˆ°ç«¯çš„å†™æ”¾å¤§å€æ•°åº”è¯¥æ˜¯ WA-A ä¹˜ä»¥ WA-D</li>
<li>WA-D measures the flash-friendliness of a PTS.
<ul><li>A low WA-D indicates that a PTS generates a write access that does not incur much garbage collection overhead in the SSD.</li>
<li>ä»¥å‰å¤§å®¶å¯èƒ½è®¤ä¸º LSM æ ‘ï¼ˆé¡ºåºå†™ï¼‰ç›¸æ¯” B+ æ ‘ï¼ˆéšæœºå†™ï¼‰å¯¹ SSD æ›´å‹å¥½ï¼Œä½†å®æµ‹ WA-D é¢ è¦†äº†è¿™ä¸ªè®¤çŸ¥</li></ul></li></ul>
<p class="text-align-justify"><strong>ï¼ˆ3ï¼‰Ignoring the internal state of the SSD / å¿½è§†äº† SSD çš„åˆå§‹å†…éƒ¨çŠ¶æ€</strong> âš¡ï¸</p>
<img src='https://s2.loli.net/2022/11/16/pFyqSCVZnrHB1g9.jpg' title='' alt='' width='100%'/>
<blockquote><p class="text-align-justify"><strong>Trim(Discard)çš„å‡ºç°ä¸»è¦æ˜¯ä¸ºäº†æé«˜GCçš„æ•ˆç‡ä»¥åŠå‡å°‘å†™å…¥æ”¾å¤§çš„å‘ç”Ÿï¼Œæœ€å¤§ä½œç”¨æ˜¯æ¸…ç©ºå¾…åˆ é™¤çš„æ— æ•ˆæ•°æ®</strong>ã€‚åœ¨SSDæ‰§è¡Œè¯»ã€æ“¦ã€å†™æ­¥éª¤çš„æ—¶å€™ï¼Œé¢„å…ˆæŠŠæ“¦é™¤çš„æ­¥éª¤å…ˆåšäº†ï¼Œè¿™æ ·æ‰èƒ½å‘æŒ¥å‡ºSSDçš„æ€§èƒ½ï¼Œé€šå¸¸SSDæ‰é€Ÿå¾ˆå¤§ä¸€éƒ¨åˆ†åŸå› å°±æ˜¯å¾…åˆ é™¤çš„æ— æ•ˆæ•°æ®å¤ªå¤šï¼Œæ¯æ¬¡å†™å…¥çš„æ—¶å€™ä¸»æ§éƒ½è¦å…ˆåšæ¸…ç©ºå¤„ç†ï¼Œæ‰€ä»¥æ€§èƒ½å—åˆ°äº†é™åˆ¶ã€‚</p></blockquote>
<p class="text-align-justify">The steady-state performance of a PTS can greatly differ depending on the initial state of the drive, this is surprising.</p>
<p class="text-align-justify">This phenomenon is caused by how the LBA (logic block address)  access patterns of RocksDB and WiredTiger intertwine with the SSD garbage collection mechanism as a function of the initial state the drive.</p>
<p class="text-align-justify">WiredTiger only writes to a limited portion of the logical block address space.</p>
<p class="text-align-justify"><strong>ï¼ˆ4ï¼‰Ignore the dataset size / å¿½è§†äº†æ•°æ®é›†å¤§å°</strong></p>
<img src='https://s2.loli.net/2022/11/16/SlVWJfP5rO7xpNQ.jpg' title='' alt='' width='100%'/>
<p class="text-align-justify">The amount of data stored by the SSD changes its behavior and affects overall performance.</p>
<p class="text-align-justify">The performance degradation brought by the larger dataset is primarily due to the idiosyncrasiesï¼ˆç‰¹è´¨/ç‰¹ç‚¹ï¼‰ of the SSD: larger datasets lead to more valid pages in each flash block, which increases the amount of data being relocated upon performing garbage collection, i.e., the WA-D</p>
<p class="text-align-justify"><strong>ï¼ˆ5ï¼‰Ignoring the extra storage capacity a PTS needs to manage data and store additional meta-data / æœªè€ƒè™‘ç©ºé—´æ”¾å¤§ï¼ˆSpace amplificationï¼‰</strong></p>
<p class="text-align-justify">æ¶‰åŠå­˜å‚¨æˆæœ¬</p>
<p class="text-align-justify"><strong>ï¼ˆ6ï¼‰Ignoring SSD over-provisioning</strong></p>
<p class="text-align-justify">æˆæœ¬ä¸æ€§èƒ½ä¹‹é—´çš„æƒè¡¡æŠ˜ä¸­ - å¯ä»¥é¢„ç•™ä¸€éƒ¨åˆ† SSD ç©ºé—´ç»™ SSD åš GC ä½¿ç”¨ï¼Œè¿™éƒ¨åˆ†ç©ºé—´å¯¹æ–‡ä»¶ç³»ç»Ÿä¸å¯è§ã€‚</p>
<img src='https://s2.loli.net/2022/11/16/YEFp5g69mnqBe3w.jpg' title='' alt='' width='100%'/>
<p class="text-align-justify"><strong>ï¼ˆ7ï¼‰Ignoring the effect of the underlying storage technology on performance</strong></p>
<h2>5ã€SSD åŸç†ç›¸å…³èµ„æ–™</h2>
<ul><li><a href='https://zhuanlan.zhihu.com/p/102089411'>æµ…è°ˆåˆ†å¸ƒå¼å­˜å‚¨ä¹‹SSDåŸºæœ¬åŸç† - çŸ¥ä¹ (zhihu.com)</a></li>
<li><a href='https://mp.weixin.qq.com/s/_uiCsFXWjepeHSdgiUABhg'>èŠèŠ SSD çš„åŸºæœ¬åŸç† (qq.com)</a></li>
<li><a href='http://xiongduo.cn/posts/coding-for-ssds-part-1-introduction-and-table-of-contents.html'>ä¸ºSSDç¼–ç¨‹ï¼ˆ1ï¼‰ï¼šç®€ä»‹å’Œç›®å½• (xiongduo.cn)</a></li>
<li><a href='http://www.ssdfans.com/?p=8077'>SSDèƒŒåçš„ç§˜å¯†ï¼šSSDåŸºæœ¬å·¥ä½œåŸç† (ssdfans.com)</a></li></ul>
    </article>
</div>


<div class="comment">
     <script src="https://giscus.app/client.js"
        data-repo="kitelife/kitelife.github.com"
        data-repo-id="MDEwOlJlcG9zaXRvcnk4NTg1Njcx"
        data-category="giscus"
        data-category-id="DIC_kwDOAIMBx84Ctgkx"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light"
        data-lang="zh-CN"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
      </script>
    </div>



    </div>
</div>
<footer class="site-footer">
    <div class="wrapper">
        <div class="footer-col-wrapper">
            <div class="footer-col footer-col-1">
                <ul class="social-media-list">
                    <li>
                        <a href="https://github.com/kitelife" target="_blank">
                            <span class="icon icon--github">
                                <svg viewBox="0 0 16 16">
                                    <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                                </svg>
                            </span>
                            <span class="username">kitelife</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://maimai.cn/profile/detail?dstu=39580141" target="_blank">
                            <span class="icon icon--maimai">
                                <img src="https://maimai.cn/favicon.ico" width="16"/>
                            </span>
                            <span class="username">Xiayf</span>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="footer-col footer-col-2"></div>
            <div class="footer-col footer-col-3"></div>
            <div class="footer-col footer-col-4">
                <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank">
                    <img alt="Creative Commons License" src="https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-sa.svg">
                </a>
            </div>
        </div>
    </div>
</footer>


<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script>hljs.highlightAll();</script>


</body>
</html>